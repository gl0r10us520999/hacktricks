# æ¶æ„è½¯ä»¶åˆ†æ

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## å–è¯å¤‡å¿˜å•

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## åœ¨çº¿æœåŠ¡

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## ç¦»çº¿æ€æ¯’å’Œæ£€æµ‹å·¥å…·

### Yara

#### å®‰è£…
```bash
sudo apt-get install -y yara
```
#### å‡†å¤‡è§„åˆ™

ä½¿ç”¨æ­¤è„šæœ¬ä»githubä¸‹è½½å¹¶åˆå¹¶æ‰€æœ‰yaraæ¶æ„è½¯ä»¶è§„åˆ™: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
åˆ›å»º_**rules**_ç›®å½•å¹¶æ‰§è¡Œå®ƒã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º_**malware\_rules.yar**_çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ¶æ„è½¯ä»¶çš„yaraè§„åˆ™ã€‚
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### æ‰«æ
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: æ£€æŸ¥æ¶æ„è½¯ä»¶å¹¶åˆ›å»ºè§„åˆ™

æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…· [**YaraGen**](https://github.com/Neo23x0/yarGen) ä»äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆ yara è§„åˆ™ã€‚æŸ¥çœ‹è¿™äº›æ•™ç¨‹: [**ç¬¬ 1 éƒ¨åˆ†**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**ç¬¬ 2 éƒ¨åˆ†**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**ç¬¬ 3 éƒ¨åˆ†**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### å®‰è£…
```
sudo apt-get install -y clamav
```
#### æ‰«æ
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa** æ£€æµ‹å¯ç–‘çš„ **èƒ½åŠ›** åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼šPE, ELF, .NETã€‚å› æ­¤ï¼Œå®ƒä¼šæ‰¾åˆ°è¯¸å¦‚ Att\&ck ç­–ç•¥æˆ–å¯ç–‘èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼š

* æ£€æŸ¥ OutputDebugString é”™è¯¯
* ä½œä¸ºæœåŠ¡è¿è¡Œ
* åˆ›å»ºè¿›ç¨‹

åœ¨ [**Github repo**](https://github.com/mandiant/capa) ä¸­è·å–å®ƒã€‚

### IOCs

IOC ä»£è¡¨å¦¥åæŒ‡æ ‡ã€‚IOC æ˜¯ä¸€ç»„ **æ¡ä»¶ï¼Œç”¨äºè¯†åˆ«** ä¸€äº›æ½œåœ¨çš„ä¸éœ€è¦çš„è½¯ä»¶æˆ–ç¡®è®¤çš„ **æ¶æ„è½¯ä»¶**ã€‚è“é˜Ÿä½¿ç”¨è¿™ç§å®šä¹‰æ¥ **æœç´¢è¿™ç§æ¶æ„æ–‡ä»¶** åœ¨ä»–ä»¬çš„ **ç³»ç»Ÿ** å’Œ **ç½‘ç»œ** ä¸­ã€‚\
å…±äº«è¿™äº›å®šä¹‰éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå½“æ¶æ„è½¯ä»¶åœ¨è®¡ç®—æœºä¸­è¢«è¯†åˆ«å¹¶ä¸ºè¯¥æ¶æ„è½¯ä»¶åˆ›å»º IOC æ—¶ï¼Œå…¶ä»–è“é˜Ÿå¯ä»¥ä½¿ç”¨å®ƒæ›´å¿«åœ°è¯†åˆ«æ¶æ„è½¯ä»¶ã€‚

åˆ›å»ºæˆ–ä¿®æ”¹ IOC çš„å·¥å…·æ˜¯ [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\
æ‚¨å¯ä»¥ä½¿ç”¨ [**Redline**](https://www.fireeye.com/services/freeware/redline.html) ç­‰å·¥å…·æ¥ **æœç´¢è®¾å¤‡ä¸­çš„å®šä¹‰ IOC**ã€‚

### Loki

[**Loki**](https://github.com/Neo23x0/Loki) æ˜¯ä¸€ä¸ªç®€å•å¦¥åæŒ‡æ ‡çš„æ‰«æå™¨ã€‚\
æ£€æµ‹åŸºäºå››ç§æ£€æµ‹æ–¹æ³•ï¼š
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux Malware Detect

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) æ˜¯ä¸€ä¸ªé’ˆå¯¹Linuxçš„æ¶æ„è½¯ä»¶æ‰«æå™¨ï¼Œå‘å¸ƒäºGNU GPLv2è®¸å¯è¯ï¼Œæ—¨åœ¨åº”å¯¹å…±äº«æ‰˜ç®¡ç¯å¢ƒä¸­é¢ä¸´çš„å¨èƒã€‚å®ƒä½¿ç”¨æ¥è‡ªç½‘ç»œè¾¹ç¼˜å…¥ä¾µæ£€æµ‹ç³»ç»Ÿçš„å¨èƒæ•°æ®ï¼Œæå–æ­£åœ¨æ”»å‡»ä¸­ç§¯æä½¿ç”¨çš„æ¶æ„è½¯ä»¶ï¼Œå¹¶ç”Ÿæˆæ£€æµ‹ç­¾åã€‚æ­¤å¤–ï¼Œå¨èƒæ•°æ®è¿˜æ¥è‡ªç”¨æˆ·æäº¤çš„LMDç»“è´¦åŠŸèƒ½å’Œæ¶æ„è½¯ä»¶ç¤¾åŒºèµ„æºã€‚

### rkhunter

åƒ[**rkhunter**](http://rkhunter.sourceforge.net)è¿™æ ·çš„å·¥å…·å¯ä»¥ç”¨æ¥æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨çš„**rootkits**å’Œæ¶æ„è½¯ä»¶ã€‚
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå°è¯•ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­æŸ¥æ‰¾æ··æ·†å­—ç¬¦ä¸²ã€‚

### PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper) æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä¸€äº›åŸºæœ¬å†…å®¹ï¼ˆå¦‚äºŒè¿›åˆ¶æ•°æ®ã€ç†µã€URLs å’Œ IPsï¼Œä»¥åŠä¸€äº› yara è§„åˆ™ï¼‰ã€‚

### PEstudio

[PEstudio](https://www.winitor.com/download) æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥è·å– Windows å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¦‚å¯¼å…¥ã€å¯¼å‡ºã€å¤´éƒ¨ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜ä¼šæ£€æŸ¥ç—…æ¯’æ€»æ•°å¹¶æ‰¾åˆ°æ½œåœ¨çš„ Att\&ck æŠ€æœ¯ã€‚

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) æ˜¯ä¸€ä¸ªæ£€æµ‹æ–‡ä»¶æ˜¯å¦è¢« **åŠ å¯†** çš„å·¥å…·ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ‰¾åˆ° **æ‰“åŒ…å™¨**ã€‚

### NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI) æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œä½¿ç”¨å¤šç§ **ç»Ÿè®¡æ–¹æ³•** æ¥æ£€æµ‹æ–‡æœ¬/è„šæœ¬æ–‡ä»¶ä¸­çš„ **æ··æ·†** å’Œ **åŠ å¯†** å†…å®¹ã€‚NeoPI çš„é¢„æœŸç›®çš„æ˜¯å¸®åŠ© **æ£€æµ‹éšè—çš„ web shell ä»£ç **ã€‚

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) å°½åŠ›æ£€æµ‹ **æ··æ·†**/**å¯ç–‘ä»£ç ** ä»¥åŠä½¿ç”¨ **PHP** å‡½æ•°çš„æ–‡ä»¶ï¼Œè¿™äº›å‡½æ•°é€šå¸¸ç”¨äº **æ¶æ„è½¯ä»¶**/webshellsã€‚

### Apple Binary Signatures

åœ¨æ£€æŸ¥æŸäº› **æ¶æ„è½¯ä»¶æ ·æœ¬** æ—¶ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆ **æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç­¾å**ï¼Œå› ä¸ºç­¾åçš„ **å¼€å‘è€…** å¯èƒ½å·²ç»ä¸ **æ¶æ„è½¯ä»¶** æœ‰å…³ã€‚
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## æ£€æµ‹æŠ€æœ¯

### æ–‡ä»¶å †å 

å¦‚æœä½ çŸ¥é“æŸä¸ªåŒ…å«**æ–‡ä»¶**çš„æ–‡ä»¶å¤¹**æœ€åæ›´æ–°äºæŸä¸ªæ—¥æœŸ**ã€‚**æ£€æŸ¥**è¯¥**æ–‡ä»¶å¤¹**ä¸­æ‰€æœ‰**æ–‡ä»¶**çš„**åˆ›å»ºå’Œä¿®æ”¹æ—¥æœŸ**ï¼Œå¦‚æœæœ‰ä»»ä½•æ—¥æœŸæ˜¯**å¯ç–‘çš„**ï¼Œè¯·æ£€æŸ¥è¯¥æ–‡ä»¶ã€‚

### åŸºçº¿

å¦‚æœä¸€ä¸ªæ–‡ä»¶å¤¹çš„æ–‡ä»¶**ä¸åº”è¯¥è¢«ä¿®æ”¹**ï¼Œä½ å¯ä»¥è®¡ç®—è¯¥æ–‡ä»¶å¤¹**åŸå§‹æ–‡ä»¶**çš„**å“ˆå¸Œå€¼**å¹¶ä¸**å½“å‰**æ–‡ä»¶è¿›è¡Œ**æ¯”è¾ƒ**ã€‚ä»»ä½•è¢«ä¿®æ”¹çš„æ–‡ä»¶éƒ½å°†æ˜¯**å¯ç–‘çš„**ã€‚

### ç»Ÿè®¡åˆ†æ

å½“ä¿¡æ¯ä¿å­˜åœ¨æ—¥å¿—ä¸­æ—¶ï¼Œä½ å¯ä»¥**æ£€æŸ¥ç»Ÿè®¡æ•°æ®ï¼Œä¾‹å¦‚æ¯ä¸ªæ–‡ä»¶åœ¨webæœåŠ¡å™¨ä¸Šè¢«è®¿é—®çš„æ¬¡æ•°ï¼Œå› ä¸ºweb shellå¯èƒ½æ˜¯å…¶ä¸­ä¹‹ä¸€**ã€‚

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
