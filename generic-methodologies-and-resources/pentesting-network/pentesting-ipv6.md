{% hint style="success" %}
学习与实践 AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习与实践 GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}


# IPv6 基础理论

## 网络

IPv6 地址的结构旨在增强网络组织和设备交互。IPv6 地址分为：

1. **网络前缀**：前 48 位，确定网络段。
2. **子网 ID**：接下来的 16 位，用于定义网络内的特定子网。
3. **接口标识符**：最后 64 位，唯一标识子网内的设备。

虽然 IPv6 省略了 IPv4 中的 ARP 协议，但引入了 **ICMPv6**，其主要消息有两个：
- **邻居请求 (NS)**：用于地址解析的组播消息。
- **邻居通告 (NA)**：对 NS 的单播响应或自发公告。

IPv6 还包含特殊地址类型：
- **回环地址 (`::1`)**：相当于 IPv4 的 `127.0.0.1`，用于主机内部通信。
- **链路本地地址 (`FE80::/10`)**：用于本地网络活动，不用于互联网路由。处于同一本地网络的设备可以使用此范围相互发现。

### IPv6 在网络命令中的实际使用

要与 IPv6 网络交互，可以使用各种命令：
- **Ping 链路本地地址**：使用 `ping6` 检查本地设备的存在。
- **邻居发现**：使用 `ip neigh` 查看在链路层发现的设备。
- **alive6**：用于发现同一网络上设备的替代工具。

以下是一些命令示例：
```bash
ping6 –I eth0 -c 5 ff02::1 > /dev/null 2>&1
ip neigh | grep ^fe80

# Alternatively, use alive6 for neighbor discovery
alive6 eth0
```
IPv6 地址可以从设备的 MAC 地址派生，用于本地通信。以下是如何从已知的 MAC 地址派生链路本地 IPv6 地址的简化指南，以及对 IPv6 地址类型和在网络中发现 IPv6 地址的方法的简要概述。

## **从 MAC 地址派生链路本地 IPv6**

给定一个 MAC 地址 **`12:34:56:78:9a:bc`**，可以按如下方式构造链路本地 IPv6 地址：

1. 将 MAC 转换为 IPv6 格式：**`1234:5678:9abc`**
2. 在前面添加 `fe80::` 并在中间插入 `fffe`：**`fe80::1234:56ff:fe78:9abc`**
3. 反转左侧的第七位，将 `1234` 改为 `1034`：**`fe80::1034:56ff:fe78:9abc`**

## **IPv6 地址类型**

- **唯一本地地址 (ULA)**：用于本地通信，不用于公共互联网路由。前缀：**`FEC00::/7`**
- **组播地址**：用于一对多通信。发送到组播组中的所有接口。前缀：**`FF00::/8`**
- **任播地址**：用于一对最近的通信。根据路由协议发送到最近的接口。属于 **`2000::/3`** 全球单播范围。

## **地址前缀**
- **fe80::/10**：链路本地地址（类似于 169.254.x.x）
- **fc00::/7**：唯一本地单播（类似于私有 IPv4 范围，如 10.x.x.x, 172.16.x.x, 192.168.x.x）
- **2000::/3**：全球单播
- **ff02::1**：组播所有节点
- **ff02::2**：组播路由器节点

## **在网络中发现 IPv6 地址**

### 方法 1：使用链路本地地址
1. 获取网络中设备的 MAC 地址。
2. 从 MAC 地址派生链路本地 IPv6 地址。

### 方法 2：使用组播
1. 向组播地址 `ff02::1` 发送 ping，以发现本地网络上的 IPv6 地址。
```bash
service ufw stop # Stop the firewall
ping6 -I <IFACE> ff02::1 # Send a ping to multicast address
ip -6 neigh # Display the neighbor table
```
## IPv6 Man-in-the-Middle (MitM) Attacks
在IPv6网络中执行MitM攻击的几种技术包括：

- 冒充ICMPv6邻居或路由器广告。
- 使用ICMPv6重定向或“数据包过大”消息来操纵路由。
- 攻击移动IPv6（通常需要禁用IPSec）。
- 设置恶意DHCPv6服务器。


# Identifying IPv6 Addresses in the eild

## Exploring Subdomains
一种查找可能与IPv6地址相关的子域的方法是利用搜索引擎。例如，使用查询模式`ipv6.*`可能是有效的。具体来说，可以在Google中使用以下搜索命令：
```bash
site:ipv6./
```
## 利用 DNS 查询
要识别 IPv6 地址，可以查询某些 DNS 记录类型：
- **AXFR**：请求完整的区域传输，可能会揭示广泛的 DNS 记录。
- **AAAA**：直接查找 IPv6 地址。
- **ANY**：广泛查询，返回所有可用的 DNS 记录。

## 使用 Ping6 进行探测
在确定与组织相关的 IPv6 地址后，可以使用 `ping6` 工具进行探测。该工具有助于评估已识别的 IPv6 地址的响应能力，并可能有助于发现相邻的 IPv6 设备。

## 参考文献

* [http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html](http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html)
* [https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904](https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
