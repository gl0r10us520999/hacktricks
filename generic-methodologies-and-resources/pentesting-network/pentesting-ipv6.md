{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# Teor铆a b谩sica de IPv6

## Redes

Las direcciones IPv6 est谩n estructuradas para mejorar la organizaci贸n de la red y la interacci贸n de dispositivos. Una direcci贸n IPv6 se divide en:

1. **Prefijo de red**: Los primeros 48 bits, que determinan el segmento de red.
2. **ID de subred**: Los siguientes 16 bits, utilizados para definir subredes espec铆ficas dentro de la red.
3. **Identificador de interfaz**: Los 煤ltimos 64 bits, que identifican de manera 煤nica un dispositivo dentro de la subred.

Mientras que IPv6 omite el protocolo ARP encontrado en IPv4, introduce **ICMPv6** con dos mensajes principales:
- **Solicitud de vecino (NS)**: Mensajes multicast para la resoluci贸n de direcciones.
- **Anuncio de vecino (NA)**: Respuestas unicast a NS o anuncios espont谩neos.

IPv6 tambi茅n incorpora tipos de direcciones especiales:
- **Direcci贸n de loopback (`::1`)**: Equivalente a `127.0.0.1` de IPv4, para comunicaci贸n interna dentro del host.
- **Direcciones Link-Local (`FE80::/10`)**: Para actividades de red local, no para el enrutamiento por internet. Los dispositivos en la misma red local pueden descubrirse entre s铆 utilizando este rango.

### Uso pr谩ctico de IPv6 en comandos de red

Para interactuar con redes IPv6, puedes usar varios comandos:
- **Ping a direcciones Link-Local**: Verifica la presencia de dispositivos locales usando `ping6`.
- **Descubrimiento de vecinos**: Usa `ip neigh` para ver dispositivos descubiertos en la capa de enlace.
- **alive6**: Una herramienta alternativa para descubrir dispositivos en la misma red.

A continuaci贸n se presentan algunos ejemplos de comandos:
```bash
ping6 I eth0 -c 5 ff02::1 > /dev/null 2>&1
ip neigh | grep ^fe80

# Alternatively, use alive6 for neighbor discovery
alive6 eth0
```
IPv6 addresses can be derived from a device's MAC address for local communication. Here's a simplified guide on how to derive the Link-local IPv6 address from a known MAC address, and a brief overview of IPv6 address types and methods to discover IPv6 addresses within a network.

## **Deriving Link-local IPv6 from MAC Address**

Given a MAC address **`12:34:56:78:9a:bc`**, you can construct the Link-local IPv6 address as follows:

1. Convertir MAC a formato IPv6: **`1234:5678:9abc`**
2. Prepend `fe80::` e insertar `fffe` en el medio: **`fe80::1234:56ff:fe78:9abc`**
3. Invertir el s茅ptimo bit desde la izquierda, cambiando `1234` a `1034`: **`fe80::1034:56ff:fe78:9abc`**

## **IPv6 Address Types**

- **Unique Local Address (ULA)**: Para comunicaciones locales, no destinado a enrutamiento en internet p煤blico. Prefijo: **`FEC00::/7`**
- **Multicast Address**: Para comunicaci贸n de uno a muchos. Entregado a todas las interfaces en el grupo de multidifusi贸n. Prefijo: **`FF00::/8`**
- **Anycast Address**: Para comunicaci贸n de uno a m谩s cercano. Enviado a la interfaz m谩s cercana seg煤n el protocolo de enrutamiento. Parte del rango global unicast **`2000::/3`**.

## **Address Prefixes**
- **fe80::/10**: Direcciones Link-Local (similar a 169.254.x.x)
- **fc00::/7**: Unique Local-Unicast (similar a rangos IPv4 privados como 10.x.x.x, 172.16.x.x, 192.168.x.x)
- **2000::/3**: Global Unicast
- **ff02::1**: Multicast Todos los Nodos
- **ff02::2**: Multicast Nodos de Router

## **Discovering IPv6 Addresses within a Network**

### Way 1: Using Link-local Addresses
1. Obtener la direcci贸n MAC de un dispositivo dentro de la red.
2. Derivar la direcci贸n Link-local IPv6 de la direcci贸n MAC.

### Way 2: Using Multicast
1. Enviar un ping a la direcci贸n multicast `ff02::1` para descubrir direcciones IPv6 en la red local.
```bash
service ufw stop # Stop the firewall
ping6 -I <IFACE> ff02::1 # Send a ping to multicast address
ip -6 neigh # Display the neighbor table
```
## IPv6 Man-in-the-Middle (MitM) Attacks
Existen varias t茅cnicas para ejecutar ataques MitM en redes IPv6, tales como:

- Suplantaci贸n de anuncios de vecinos o enrutadores ICMPv6.
- Uso de mensajes de redirecci贸n ICMPv6 o "Paquete Demasiado Grande" para manipular el enrutamiento.
- Ataque a IPv6 m贸vil (generalmente requiere que IPSec est茅 deshabilitado).
- Configuraci贸n de un servidor DHCPv6 malicioso.


# Identifying IPv6 Addresses in the eild

## Exploring Subdomains
Un m茅todo para encontrar subdominios que est谩n potencialmente vinculados a direcciones IPv6 implica aprovechar los motores de b煤squeda. Por ejemplo, emplear un patr贸n de consulta como `ipv6.*` puede ser efectivo. Espec铆ficamente, se puede usar el siguiente comando de b煤squeda en Google:
```bash
site:ipv6./
```
## Utilizando Consultas DNS
Para identificar direcciones IPv6, se pueden consultar ciertos tipos de registros DNS:
- **AXFR**: Solicita una transferencia completa de zona, descubriendo potencialmente una amplia gama de registros DNS.
- **AAAA**: Busca directamente direcciones IPv6.
- **ANY**: Una consulta amplia que devuelve todos los registros DNS disponibles.

## Sondeo con Ping6
Despu茅s de identificar las direcciones IPv6 asociadas con una organizaci贸n, se puede utilizar la utilidad `ping6` para el sondeo. Esta herramienta ayuda a evaluar la capacidad de respuesta de las direcciones IPv6 identificadas y tambi茅n puede ayudar a descubrir dispositivos IPv6 adyacentes.

## Referencias

* [http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html](http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html)
* [https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904](https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
