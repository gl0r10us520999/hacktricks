{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# IPv6 基本理論

## ネットワーク

IPv6 アドレスは、ネットワークの組織化とデバイスの相互作用を強化するように構造化されています。IPv6 アドレスは次のように分かれています：

1. **ネットワークプレフィックス**：最初の 48 ビットで、ネットワークセグメントを決定します。
2. **サブネット ID**：次の 16 ビットで、ネットワーク内の特定のサブネットを定義するために使用されます。
3. **インターフェース識別子**：最後の 64 ビットで、サブネット内のデバイスを一意に識別します。

IPv6 は、IPv4 に見られる ARP プロトコルを省略していますが、2 つの主要なメッセージを持つ **ICMPv6** を導入しています：
- **隣接要求 (NS)**：アドレス解決のためのマルチキャストメッセージ。
- **隣接広告 (NA)**：NS へのユニキャスト応答または自発的な通知。

IPv6 には特別なアドレスタイプも含まれています：
- **ループバックアドレス (`::1`)**：IPv4 の `127.0.0.1` に相当し、ホスト内の内部通信に使用されます。
- **リンクローカルアドレス (`FE80::/10`)**：ローカルネットワーク活動用で、インターネットルーティングには使用されません。同じローカルネットワーク上のデバイスは、この範囲を使用して互いに発見できます。

### ネットワークコマンドにおける IPv6 の実用的な使用法

IPv6 ネットワークと対話するために、さまざまなコマンドを使用できます：
- **リンクローカルアドレスの Ping**：`ping6` を使用してローカルデバイスの存在を確認します。
- **隣接発見**：`ip neigh` を使用してリンク層で発見されたデバイスを表示します。
- **alive6**：同じネットワーク上のデバイスを発見するための代替ツールです。

以下はコマンドの例です：
```bash
ping6 –I eth0 -c 5 ff02::1 > /dev/null 2>&1
ip neigh | grep ^fe80

# Alternatively, use alive6 for neighbor discovery
alive6 eth0
```
IPv6アドレスは、ローカル通信のためにデバイスのMACアドレスから導出できます。以下は、既知のMACアドレスからリンクローカルIPv6アドレスを導出するための簡略化されたガイドと、ネットワーク内のIPv6アドレスの種類と発見方法の簡単な概要です。

## **MACアドレスからリンクローカルIPv6を導出する**

MACアドレス **`12:34:56:78:9a:bc`** が与えられた場合、リンクローカルIPv6アドレスを次のように構築できます：

1. MACをIPv6形式に変換： **`1234:5678:9abc`**
2. `fe80::`を前に付け、中間に`fffe`を挿入： **`fe80::1234:56ff:fe78:9abc`**
3. 左から7ビットを反転し、`1234`を`1034`に変更： **`fe80::1034:56ff:fe78:9abc`**

## **IPv6アドレスの種類**

- **ユニークローカルアドレス (ULA)**：ローカル通信のためのもので、公共インターネットのルーティングには使用されません。プレフィックス： **`FEC00::/7`**
- **マルチキャストアドレス**：1対多の通信のためのもの。マルチキャストグループ内のすべてのインターフェースに配信されます。プレフィックス： **`FF00::/8`**
- **エニキャストアドレス**：1対最寄りの通信のためのもの。ルーティングプロトコルに従って最も近いインターフェースに送信されます。**`2000::/3`** グローバルユニキャスト範囲の一部です。

## **アドレスプレフィックス**
- **fe80::/10**：リンクローカルアドレス（169.254.x.xに類似）
- **fc00::/7**：ユニークローカルユニキャスト（プライベートIPv4範囲の10.x.x.x、172.16.x.x、192.168.x.xに類似）
- **2000::/3**：グローバルユニキャスト
- **ff02::1**：マルチキャスト全ノード
- **ff02::2**：マルチキャストルーターノード

## **ネットワーク内のIPv6アドレスの発見**

### 方法1：リンクローカルアドレスを使用
1. ネットワーク内のデバイスのMACアドレスを取得します。
2. MACアドレスからリンクローカルIPv6アドレスを導出します。

### 方法2：マルチキャストを使用
1. マルチキャストアドレス `ff02::1` にpingを送信して、ローカルネットワーク上のIPv6アドレスを発見します。
```bash
service ufw stop # Stop the firewall
ping6 -I <IFACE> ff02::1 # Send a ping to multicast address
ip -6 neigh # Display the neighbor table
```
## IPv6 Man-in-the-Middle (MitM) Attacks
IPv6ネットワークでMitM攻撃を実行するためのいくつかの技術が存在します。例えば：

- ICMPv6隣接またはルーター広告のスプーフィング。
- ICMPv6リダイレクトまたは「パケットが大きすぎます」メッセージを使用してルーティングを操作する。
- モバイルIPv6を攻撃する（通常、IPSecを無効にする必要があります）。
- 悪意のあるDHCPv6サーバーを設定する。

# Identifying IPv6 Addresses in the eild

## Exploring Subdomains
IPv6アドレスに関連する可能性のあるサブドメインを見つける方法は、検索エンジンを活用することです。例えば、`ipv6.*`のようなクエリパターンを使用することが効果的です。具体的には、次の検索コマンドをGoogleで使用できます：
```bash
site:ipv6./
```
## DNSクエリの利用
IPv6アドレスを特定するために、特定のDNSレコードタイプをクエリできます：
- **AXFR**: 完全なゾーン転送を要求し、広範囲のDNSレコードを明らかにする可能性があります。
- **AAAA**: IPv6アドレスを直接探します。
- **ANY**: 利用可能なすべてのDNSレコードを返す広範なクエリです。

## Ping6によるプロービング
組織に関連するIPv6アドレスを特定した後、`ping6`ユーティリティを使用してプロービングできます。このツールは、特定されたIPv6アドレスの応答性を評価するのに役立ち、隣接するIPv6デバイスを発見するのにも役立つかもしれません。

## 参考文献

* [http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html](http://www.firewall.cx/networking-topics/protocols/877-ipv6-subnetting-how-to-subnet-ipv6.html)
* [https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904](https://www.sans.org/reading-room/whitepapers/detection/complete-guide-ipv6-attack-defense-33904)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
