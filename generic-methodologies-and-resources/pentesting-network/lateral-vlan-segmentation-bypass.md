# Lateral VLAN Segmentation Bypass

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Si un acc√®s direct √† un switch est disponible, la segmentation VLAN peut √™tre contourn√©e. Cela implique de reconfigurer le port connect√© en mode trunk, d'√©tablir des interfaces virtuelles pour les VLAN cibles et de d√©finir des adresses IP, soit dynamiquement (DHCP), soit statiquement, selon le sc√©nario (**pour plus de d√©tails, consultez [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)).**

Dans un premier temps, l'identification du port connect√© sp√©cifique est requise. Cela peut g√©n√©ralement √™tre accompli par le biais de messages CDP, ou en recherchant le port via le masque **include**.

**Si CDP n'est pas op√©rationnel, l'identification du port peut √™tre tent√©e en recherchant l'adresse MAC** :
```
SW1(config)# show mac address-table | include 0050.0000.0500
```
Avant de passer en mode trunk, une liste des VLAN existants doit √™tre compil√©e et leurs identifiants d√©termin√©s. Ces identifiants sont ensuite assign√©s √† l'interface, permettant l'acc√®s √† divers VLAN via le trunk. Le port utilis√©, par exemple, est associ√© au VLAN 10.
```
SW1# show vlan brief
```
**La transition vers le mode trunk implique d'entrer en mode de configuration de l'interface**:
```
SW1(config)# interface GigabitEthernet 0/2
SW1(config-if)# switchport trunk encapsulation dot1q
SW1(config-if)# switchport mode trunk
```
Le passage en mode trunk perturbera temporairement la connectivit√©, mais cela peut √™tre r√©tabli par la suite.

Des interfaces virtuelles sont ensuite cr√©√©es, des ID VLAN leur sont attribu√©s et elles sont activ√©es :
```bash
sudo vconfig add eth0 10
sudo vconfig add eth0 20
sudo vconfig add eth0 50
sudo vconfig add eth0 60
sudo ifconfig eth0.10 up
sudo ifconfig eth0.20 up
sudo ifconfig eth0.50 up
sudo ifconfig eth0.60 up
```
Ensuite, une demande d'adresse est faite via DHCP. Alternativement, dans les cas o√π DHCP n'est pas viable, les adresses peuvent √™tre configur√©es manuellement :
```bash
sudo dhclient -v eth0.10
sudo dhclient -v eth0.20
sudo dhclient -v eth0.50
sudo dhclient -v eth0.60
```
Exemple pour d√©finir manuellement une adresse IP statique sur une interface (VLAN 10) :
```bash
sudo ifconfig eth0.10 10.10.10.66 netmask 255.255.255.0
```
La connectivit√© est test√©e en initiant des requ√™tes ICMP vers les passerelles par d√©faut pour les VLANs 10, 20, 50 et 60.

En fin de compte, ce processus permet de contourner la segmentation VLAN, facilitant ainsi un acc√®s illimit√© √† tout r√©seau VLAN et pr√©parant le terrain pour des actions ult√©rieures.

## R√©f√©rences

* [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
