# GLBP & HSRP Attacks

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## FHRP åŠ«æŒæ¦‚è¿°

### FHRP çš„è§è§£
FHRP æ—¨åœ¨é€šè¿‡å°†å¤šä¸ªè·¯ç”±å™¨åˆå¹¶ä¸ºä¸€ä¸ªè™šæ‹Ÿå•å…ƒæ¥æä¾›ç½‘ç»œçš„é²æ£’æ€§ï¼Œä»è€Œå¢å¼ºè´Ÿè½½åˆ†é…å’Œå®¹é”™èƒ½åŠ›ã€‚æ€ç§‘ç³»ç»Ÿå…¬å¸åœ¨è¿™ä¸€å¥—åè®®ä¸­å¼•å…¥äº† GLBP å’Œ HSRP ç­‰é‡è¦åè®®ã€‚

### GLBP åè®®è§è§£
æ€ç§‘åˆ›å»ºçš„ GLBP åœ¨ TCP/IP åè®®æ ˆä¸Šè¿è¡Œï¼Œä½¿ç”¨ UDP åœ¨ 3222 ç«¯å£è¿›è¡Œé€šä¿¡ã€‚GLBP ç»„ä¸­çš„è·¯ç”±å™¨æ¯ 3 ç§’äº¤æ¢ä¸€æ¬¡â€œhelloâ€æ•°æ®åŒ…ã€‚å¦‚æœè·¯ç”±å™¨åœ¨ 10 ç§’å†…æœªå‘é€è¿™äº›æ•°æ®åŒ…ï¼Œåˆ™è¢«è®¤ä¸ºå¤„äºç¦»çº¿çŠ¶æ€ã€‚ç„¶è€Œï¼Œè¿™äº›å®šæ—¶å™¨å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥è¿›è¡Œä¿®æ”¹ã€‚

### GLBP æ“ä½œå’Œè´Ÿè½½åˆ†é…
GLBP çš„çªå‡ºä¹‹å¤„åœ¨äºé€šè¿‡ä½¿ç”¨å•ä¸ªè™šæ‹Ÿ IP å’Œå¤šä¸ªè™šæ‹Ÿ MAC åœ°å€åœ¨è·¯ç”±å™¨ä¹‹é—´å®ç°è´Ÿè½½åˆ†é…ã€‚åœ¨ GLBP ç»„ä¸­ï¼Œæ¯ä¸ªè·¯ç”±å™¨éƒ½å‚ä¸æ•°æ®åŒ…è½¬å‘ã€‚ä¸ HSRP/VRRP ä¸åŒï¼ŒGLBP é€šè¿‡å¤šç§æœºåˆ¶æä¾›çœŸæ­£çš„è´Ÿè½½å‡è¡¡ï¼š

- **ä¸»æœºä¾èµ–è´Ÿè½½å‡è¡¡ï¼š** ä¸ºä¸»æœºä¿æŒä¸€è‡´çš„ AVF MAC åœ°å€åˆ†é…ï¼Œè¿™å¯¹ç¨³å®šçš„ NAT é…ç½®è‡³å…³é‡è¦ã€‚
- **è½®è¯¢è´Ÿè½½å‡è¡¡ï¼š** é»˜è®¤æ–¹æ³•ï¼Œåœ¨è¯·æ±‚ä¸»æœºä¹‹é—´äº¤æ›¿åˆ†é… AVF MAC åœ°å€ã€‚
- **åŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡ï¼š** æ ¹æ®é¢„å®šä¹‰çš„â€œæƒé‡â€æŒ‡æ ‡åˆ†é…è´Ÿè½½ã€‚

### GLBP ä¸­çš„å…³é”®ç»„ä»¶å’Œæœ¯è¯­
- **AVGï¼ˆæ´»åŠ¨è™šæ‹Ÿç½‘å…³ï¼‰ï¼š** ä¸»è¦è·¯ç”±å™¨ï¼Œè´Ÿè´£åˆ†é… MAC åœ°å€ç»™å¯¹ç­‰è·¯ç”±å™¨ã€‚
- **AVFï¼ˆæ´»åŠ¨è™šæ‹Ÿè½¬å‘å™¨ï¼‰ï¼š** æŒ‡å®šç®¡ç†ç½‘ç»œæµé‡çš„è·¯ç”±å™¨ã€‚
- **GLBP ä¼˜å…ˆçº§ï¼š** å†³å®š AVG çš„æŒ‡æ ‡ï¼Œé»˜è®¤å€¼ä¸º 100ï¼ŒèŒƒå›´åœ¨ 1 åˆ° 255 ä¹‹é—´ã€‚
- **GLBP æƒé‡ï¼š** åæ˜ è·¯ç”±å™¨çš„å½“å‰è´Ÿè½½ï¼Œå¯ä»¥æ‰‹åŠ¨æˆ–é€šè¿‡å¯¹è±¡è·Ÿè¸ªè¿›è¡Œè°ƒæ•´ã€‚
- **GLBP è™šæ‹Ÿ IP åœ°å€ï¼š** ä½œä¸ºæ‰€æœ‰è¿æ¥è®¾å¤‡çš„ç½‘ç»œé»˜è®¤ç½‘å…³ã€‚

åœ¨äº¤äº’ä¸­ï¼ŒGLBP ä½¿ç”¨ä¿ç•™çš„ç»„æ’­åœ°å€ 224.0.0.102 å’Œ UDP ç«¯å£ 3222ã€‚è·¯ç”±å™¨æ¯ 3 ç§’å‘é€ä¸€æ¬¡â€œhelloâ€æ•°æ®åŒ…ï¼Œå¦‚æœåœ¨ 10 ç§’å†…é”™è¿‡ä¸€ä¸ªæ•°æ®åŒ…ï¼Œåˆ™è¢«è§†ä¸ºéæ“ä½œçŠ¶æ€ã€‚

### GLBP æ”»å‡»æœºåˆ¶
æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§å€¼ï¼ˆ255ï¼‰çš„ GLBP æ•°æ®åŒ…æˆä¸ºä¸»è¦è·¯ç”±å™¨ã€‚è¿™å¯èƒ½å¯¼è‡´ DoS æˆ– MITM æ”»å‡»ï¼Œå…è®¸æµé‡æ‹¦æˆªæˆ–é‡å®šå‘ã€‚

### ä½¿ç”¨ Loki æ‰§è¡Œ GLBP æ”»å‡»
[Loki](https://github.com/raizo62/loki_on_kali) å¯ä»¥é€šè¿‡æ³¨å…¥ä¼˜å…ˆçº§å’Œæƒé‡è®¾ç½®ä¸º 255 çš„æ•°æ®åŒ…æ¥æ‰§è¡Œ GLBP æ”»å‡»ã€‚æ”»å‡»å‰çš„æ­¥éª¤åŒ…æ‹¬ä½¿ç”¨ Wireshark ç­‰å·¥å…·æ”¶é›†è™šæ‹Ÿ IP åœ°å€ã€èº«ä»½éªŒè¯å­˜åœ¨æ€§å’Œè·¯ç”±å™¨ä¼˜å…ˆçº§å€¼ç­‰ä¿¡æ¯ã€‚

æ”»å‡»æ­¥éª¤ï¼š
1. åˆ‡æ¢åˆ°æ··æ‚æ¨¡å¼å¹¶å¯ç”¨ IP è½¬å‘ã€‚
2. ç¡®å®šç›®æ ‡è·¯ç”±å™¨å¹¶è·å–å…¶ IPã€‚
3. ç”Ÿæˆä¸€ä¸ª Gratuitous ARPã€‚
4. æ³¨å…¥ä¸€ä¸ªæ¶æ„ GLBP æ•°æ®åŒ…ï¼Œå†’å…… AVGã€‚
5. ä¸ºæ”»å‡»è€…çš„ç½‘ç»œæ¥å£åˆ†é…ä¸€ä¸ªæ¬¡è¦ IP åœ°å€ï¼Œé•œåƒ GLBP è™šæ‹Ÿ IPã€‚
6. å®æ–½ SNAT ä»¥å®ç°å®Œæ•´çš„æµé‡å¯è§æ€§ã€‚
7. è°ƒæ•´è·¯ç”±ä»¥ç¡®ä¿é€šè¿‡åŸå§‹ AVG è·¯ç”±å™¨ç»§ç»­è®¿é—®äº’è”ç½‘ã€‚

é€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤ï¼Œæ”»å‡»è€…å°†è‡ªå·±å®šä½ä¸ºâ€œä¸­é—´äººâ€ï¼Œèƒ½å¤Ÿæ‹¦æˆªå’Œåˆ†æç½‘ç»œæµé‡ï¼ŒåŒ…æ‹¬æœªåŠ å¯†æˆ–æ•æ„Ÿæ•°æ®ã€‚

ä»¥ä¸‹æ˜¯æ‰€éœ€çš„å‘½ä»¤ç‰‡æ®µï¼š
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
ç›‘æ§å’Œæ‹¦æˆªæµé‡å¯ä»¥ä½¿ç”¨ net-creds.py æˆ–ç±»ä¼¼å·¥å…·æ¥æ•è·å’Œåˆ†ææµç»è¢«æ”»é™·ç½‘ç»œçš„æ•°æ®ã€‚

### HSRP åŠ«æŒçš„è¢«åŠ¨è§£é‡ŠåŠå‘½ä»¤ç»†èŠ‚

#### HSRPï¼ˆçƒ­å¤‡ä»½è·¯ç”±å™¨/å†—ä½™åè®®ï¼‰æ¦‚è¿°
HSRP æ˜¯ä¸€ç§æ€ç§‘ä¸“æœ‰åè®®ï¼Œæ—¨åœ¨å®ç°ç½‘ç»œç½‘å…³å†—ä½™ã€‚å®ƒå…è®¸å°†å¤šä¸ªç‰©ç†è·¯ç”±å™¨é…ç½®ä¸ºä¸€ä¸ªå…±äº« IP åœ°å€çš„å•ä¸€é€»è¾‘å•å…ƒã€‚è¯¥é€»è¾‘å•å…ƒç”±ä¸€ä¸ªä¸»è¦è·¯ç”±å™¨ç®¡ç†ï¼Œè´Ÿè´£æµé‡çš„å¼•å¯¼ã€‚ä¸ä½¿ç”¨ä¼˜å…ˆçº§å’Œæƒé‡ç­‰æŒ‡æ ‡è¿›è¡Œè´Ÿè½½å‡è¡¡çš„ GLBP ä¸åŒï¼ŒHSRP ä¾èµ–äºå•ä¸ªæ´»åŠ¨è·¯ç”±å™¨è¿›è¡Œæµé‡ç®¡ç†ã€‚

#### HSRP ä¸­çš„è§’è‰²å’Œæœ¯è¯­
- **HSRP æ´»åŠ¨è·¯ç”±å™¨**ï¼šå……å½“ç½‘å…³çš„è®¾å¤‡ï¼Œç®¡ç†æµé‡æµåŠ¨ã€‚
- **HSRP å¤‡ç”¨è·¯ç”±å™¨**ï¼šå¤‡ç”¨è·¯ç”±å™¨ï¼Œå‡†å¤‡åœ¨æ´»åŠ¨è·¯ç”±å™¨æ•…éšœæ—¶æ¥ç®¡ã€‚
- **HSRP ç»„**ï¼šä¸€ç»„è·¯ç”±å™¨åä½œå½¢æˆä¸€ä¸ªå•ä¸€çš„å¼¹æ€§è™šæ‹Ÿè·¯ç”±å™¨ã€‚
- **HSRP MAC åœ°å€**ï¼šåœ¨ HSRP è®¾ç½®ä¸­åˆ†é…ç»™é€»è¾‘è·¯ç”±å™¨çš„è™šæ‹Ÿ MAC åœ°å€ã€‚
- **HSRP è™šæ‹Ÿ IP åœ°å€**ï¼šHSRP ç»„çš„è™šæ‹Ÿ IP åœ°å€ï¼Œä½œä¸ºè¿æ¥è®¾å¤‡çš„é»˜è®¤ç½‘å…³ã€‚

#### HSRP ç‰ˆæœ¬
HSRP æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒHSRPv1 å’Œ HSRPv2ï¼Œä¸»è¦åœ¨ç»„å®¹é‡ã€å¤šæ’­ IP ä½¿ç”¨å’Œè™šæ‹Ÿ MAC åœ°å€ç»“æ„ä¸Šæœ‰æ‰€ä¸åŒã€‚è¯¥åè®®åˆ©ç”¨ç‰¹å®šçš„å¤šæ’­ IP åœ°å€è¿›è¡ŒæœåŠ¡ä¿¡æ¯äº¤æ¢ï¼Œæ¯ 3 ç§’å‘é€ä¸€æ¬¡ Hello æ•°æ®åŒ…ã€‚å¦‚æœåœ¨ 10 ç§’å†…æœªæ”¶åˆ°æ•°æ®åŒ…ï¼Œåˆ™å‡å®šè·¯ç”±å™¨å¤„äºéæ´»åŠ¨çŠ¶æ€ã€‚

#### HSRP æ”»å‡»æœºåˆ¶
HSRP æ”»å‡»æ¶‰åŠé€šè¿‡æ³¨å…¥æœ€å¤§ä¼˜å…ˆçº§å€¼å¼ºè¡Œæ¥ç®¡æ´»åŠ¨è·¯ç”±å™¨çš„è§’è‰²ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸­é—´äººï¼ˆMITMï¼‰æ”»å‡»ã€‚æ”»å‡»å‰çš„å…³é”®æ­¥éª¤åŒ…æ‹¬æ”¶é›†æœ‰å…³ HSRP è®¾ç½®çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ Wireshark è¿›è¡Œæµé‡åˆ†æã€‚

#### ç»•è¿‡ HSRP è®¤è¯çš„æ­¥éª¤
1. å°†åŒ…å« HSRP æ•°æ®çš„ç½‘ç»œæµé‡ä¿å­˜ä¸º .pcap æ–‡ä»¶ã€‚
```shell
tcpdump -w hsrp_traffic.pcap
```
2. ä½¿ç”¨ hsrp2john.py ä» .pcap æ–‡ä»¶ä¸­æå– MD5 å“ˆå¸Œã€‚
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. ä½¿ç”¨ John the Ripper ç ´è§£ MD5 å“ˆå¸Œã€‚
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**ä½¿ç”¨ Loki æ‰§è¡Œ HSRP æ³¨å…¥**

1. å¯åŠ¨ Loki ä»¥è¯†åˆ« HSRP å¹¿å‘Šã€‚
2. å°†ç½‘ç»œæ¥å£è®¾ç½®ä¸ºæ··æ‚æ¨¡å¼å¹¶å¯ç”¨ IP è½¬å‘ã€‚
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. ä½¿ç”¨ Loki é’ˆå¯¹ç‰¹å®šè·¯ç”±å™¨ï¼Œè¾“å…¥ç ´è§£çš„ HSRP å¯†ç ï¼Œå¹¶æ‰§è¡Œå¿…è¦çš„é…ç½®ä»¥å†’å……æ´»åŠ¨è·¯ç”±å™¨ã€‚
4. åœ¨è·å¾—æ´»åŠ¨è·¯ç”±å™¨è§’è‰²åï¼Œé…ç½®æ‚¨çš„ç½‘ç»œæ¥å£å’Œ IP è¡¨ä»¥æ‹¦æˆªåˆæ³•æµé‡ã€‚
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. ä¿®æ”¹è·¯ç”±è¡¨ä»¥é€šè¿‡å‰æ´»åŠ¨è·¯ç”±å™¨è·¯ç”±æµé‡ã€‚
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. ä½¿ç”¨ net-creds.py æˆ–ç±»ä¼¼å·¥å…·ä»æ‹¦æˆªçš„æµé‡ä¸­æ•è·å‡­æ®ã€‚
```shell
sudo python2 net-creds.py -i eth0
```

æ‰§è¡Œè¿™äº›æ­¥éª¤ä½¿æ”»å‡»è€…èƒ½å¤Ÿæ‹¦æˆªå’Œæ“çºµæµé‡ï¼Œç±»ä¼¼äº GLBP åŠ«æŒçš„è¿‡ç¨‹ã€‚è¿™çªæ˜¾äº† HSRP ç­‰å†—ä½™åè®®çš„è„†å¼±æ€§ä»¥åŠå¯¹å¼ºå¤§å®‰å…¨æªæ–½çš„éœ€æ±‚ã€‚

## å‚è€ƒæ–‡çŒ®
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
