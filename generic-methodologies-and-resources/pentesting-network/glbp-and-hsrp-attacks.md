# Mashambulizi ya GLBP & HSRP

{% hint style="success" %}
Jifunze & zoezi la Udukuzi wa AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Mafunzo ya HackTricks AWS Timu Nyekundu Mtaalam (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Jifunze & zoezi la Udukuzi wa GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Mafunzo ya HackTricks GCP Timu Nyekundu Mtaalam (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa michango**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Maelezo ya Utekaji wa FHRP

### Mbinu za FHRP
FHRP imeundwa kutoa nguvu ya mtandao kwa kuunganisha rutuba nyingi kuwa kitengo kimoja cha kubunifu, hivyo kuboresha usambazaji wa mzigo na uvumilivu wa hitilafu. Cisco Systems iliingiza itifaki maarufu katika mfululizo huu, kama vile GLBP na HSRP.

### Mbinu za Itifaki ya GLBP
Uumbaji wa Cisco, GLBP, hufanya kazi kwenye safu ya TCP/IP, ikichukua UDP kwenye bandari 3222 kwa mawasiliano. Rutuba katika kikundi cha GLBP hubadilishana pakiti za "hello" kila baada ya sekunde 3. Ikiwa rutuba haiwezi kutuma pakiti hizi kwa sekunde 10, inadhaniwa kuwa haipo. Walakini, muda huu si wa kudumu na unaweza kubadilishwa.

### Uendeshaji wa GLBP na Usambazaji wa Mzigo
GLBP inajitokeza kwa kuwezesha usambazaji wa mzigo kati ya rutuba kwa kutumia anwani moja ya IP ya kubunifu pamoja na anwani nyingi za MAC za kubunifu. Katika kikundi cha GLBP, kila rutuba inashiriki katika kusonga pakiti. Tofauti na HSRP/VRRP, GLBP hutoa usambazaji wa kweli wa mzigo kupitia njia kadhaa:

- **Usambazaji wa Mzigo Unaotegemea Mwenyeji:** Unahifadhi ugawaji wa anwani ya MAC ya AVF kwa mwenyeji, muhimu kwa miundo thabiti ya NAT.
- **Usambazaji wa Mzigo wa Round-Robin:** Njia ya msingi, kubadilisha ugawaji wa anwani ya MAC ya AVF kati ya wenyewe wanaoomba.
- **Usambazaji wa Mzigo wa Round-Robin Uliopimwa:** Inagawa mzigo kulingana na metriki iliyowekwa ya "Uzito".

### Vipengele muhimu na Istilahi katika GLBP
- **AVG (Lango la Kibunifu cha Kazi):** Rutuba kuu, inayowajibika kwa kugawa anwani za MAC kwa rutuba wenzake.
- **AVF (Mbeba Mbele wa Kibunifu cha Kazi):** Rutuba iliyoteuliwa kusimamia trafiki ya mtandao.
- **Kipaumbele cha GLBP:** Metriki inayodhibiti AVG, ikitoka kwa msingi wa 100 na kati ya 1 na 255.
- **Uzito wa GLBP:** Inaonyesha mzigo wa sasa kwenye rutuba, inayoweza kurekebishwa kwa mikono au kupitia Kufuatilia Vitu.
- **Anwani ya IP ya Kibunifu ya GLBP:** Inatumika kama lango la kawaida la mtandao kwa vifaa vyote vilivyounganishwa.

Kwa mwingiliano, GLBP hutumia anwani ya multicast iliyohifadhiwa 224.0.0.102 na bandari ya UDP 3222. Rutuba hutoa pakiti za "hello" kila baada ya sekunde 3, na zinachukuliwa kutokuwa na uendeshaji ikiwa pakiti inakosa kwa kipindi cha sekunde 10.

### Mbinu ya Mashambulizi ya GLBP
Mshambuliaji anaweza kuwa rutuba kuu kwa kutuma pakiti ya GLBP yenye thamani kubwa ya kipaumbele (255). Hii inaweza kusababisha mashambulizi ya DoS au MITM, kuruhusu udukuzi au uelekezaji wa trafiki.

### Kutekeleza Mashambulizi ya GLBP na Loki
[Loki](https://github.com/raizo62/loki_on_kali) inaweza kutekeleza mashambulizi ya GLBP kwa kuingiza pakiti na kipaumbele na uzito uliowekwa kwa 255. Hatua za kabla ya mashambulizi ni pamoja na kukusanya habari kama anwani ya IP ya kubunifu, uwepo wa uthibitishaji, na thamani za kipaumbele za rutuba kwa kutumia zana kama Wireshark.

Hatua za Mashambulizi:
1. Badilisha kwa hali ya kusikiliza na wezesha kusonga IP.
2. Tambua rutuba ya lengo na upate anwani yake ya IP.
3. Zalisha ARP ya bure.
4. Ingiza pakiti ya GLBP yenye nia mbaya, ukiiga AVG.
5. Tenga anwani ya IP ya pili kwa kiolesura cha mtandao cha mshambuliaji, ikilinganisha na anwani ya IP ya kubunifu ya GLBP.
6. Tekeleza SNAT kwa uonekano kamili wa trafiki.
7. Badilisha mwelekeo ili kuhakikisha upatikanaji wa mtandao unaendelea kupitia rutuba ya asili ya AVG.

Kwa kufuata hatua hizi, mshambuliaji anajipanga kama "mtu katikati," mwenye uwezo wa kuingilia na kuchambua trafiki ya mtandao, ikiwa ni pamoja na data isiyo na usimbaji au nyeti.

Kwa mfano, hapa kuna vipande vya amri vinavyohitajika:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
Kufuatilia na kuingilia kati trafiki inaweza kufanywa kwa kutumia net-creds.py au zana kama hizo kuchukua na kuchambua data inayopita kupitia mtandao uliokumbwa.

### Maelezo ya Kusubiri ya Utekaji wa HSRP na Maelezo ya Amri

#### Maelezo ya Jumla ya Utekaji wa HSRP (Itikadi ya Msimamo wa Moto wa Router/Itifaki ya Redundancy)
HSRP ni itifaki ya kipekee ya Cisco iliyoundwa kwa ajili ya redundansi ya lango la mtandao. Inaruhusu usanidi wa rutuba za mwili nyingi katika kitengo kimoja la mantiki lenye anwani ya IP iliyoshirikiwa. Kitengo hiki la mantiki linasimamiwa na router ya msingi inayowajibika kwa kuongoza trafiki. Tofauti na GLBP, ambayo hutumia vipimo kama kipaumbele na uzito kwa usawa wa mzigo, HSRP inategemea router moja tu ya aktivi kwa usimamizi wa trafiki.

#### Majukumu na Istilahi katika HSRP
- **Router ya Aktivi ya HSRP**: Kifaa kinachofanya kazi kama lango, kusimamia mtiririko wa trafiki.
- **Router ya Kusubiri ya HSRP**: Router ya ziada, tayari kuchukua nafasi ikiwa router ya aktivi inashindwa.
- **Kikundi cha HSRP**: Seti ya rutuba zinazoshirikiana ili kuunda router ya kubadilika ya kawaida moja.
- **Anwani ya MAC ya HSRP**: Anwani ya MAC ya kubadilika iliyopewa router ya mantiki katika usanidi wa HSRP.
- **Anwani ya IP ya Kibadilika ya HSRP**: Anwani ya IP ya kubadilika ya kikundi cha HSRP, ikifanya kazi kama lango la msingi kwa vifaa vilivyounganishwa.

#### Toleo za HSRP
HSRP inakuja katika toleo mbili, HSRPv1 na HSRPv2, zikitofautiana hasa katika uwezo wa kikundi, matumizi ya IP ya multicast, na muundo wa anwani ya MAC ya kubadilika. Itifaki hutumia anwani maalum za IP za multicast kwa kubadilishana habari ya huduma, na pakiti za Hello hutumwa kila baada ya sekunde 3. Router inachukuliwa kuwa haifanyi kazi ikiwa hakuna pakiti inayopokelewa ndani ya kipindi cha sekunde 10.

#### Mbinu ya Utekaji wa HSRP
Mbinu za HSRP zinahusisha kuchukua jukumu la Router ya Aktivi kwa kuingiza thamani ya kipaumbele ya juu. Hii inaweza kusababisha shambulio la Man-In-The-Middle (MITM). Hatua muhimu kabla ya shambulio ni kukusanya data kuhusu usanidi wa HSRP, ambayo inaweza kufanywa kwa kutumia Wireshark kwa uchambuzi wa trafiki.

#### Hatua za Kupitisha Uthibitishaji wa HSRP
1. Hifadhi trafiki ya mtandao inayohusisha data ya HSRP kama faili ya .pcap.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. Chambua hashi za MD5 kutoka kwa faili ya .pcap kwa kutumia hsrp2john.py.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. Gonga hashi za MD5 kwa kutumia John the Ripper.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Kutekeleza Uingizaji wa HSRP na Loki**

1. Anzisha Loki kutambua matangazo ya HSRP.
2. Weka kiolesura cha mtandao kwenye hali ya kusikiliza na wezesha kusonga kwa IP.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Tumia Loki kulenga router maalum, ingiza nenosiri lililovunjwa la HSRP, na fanya usanidi unaohitajika kujifanya kuwa Router ya Aktivi.
4. Baada ya kupata jukumu la Router ya Aktivi, sanidi kiolesura chako cha mtandao na meza za IP kuingilia trafiki halali.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Badilisha meza ya uhamishaji kuelekeza trafiki kupitia Router ya zamani ya Aktivi.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Tumia net-creds.py au zana kama hiyo kuchukua vibali kutoka kwa trafiki iliyonaswa.
```shell
sudo python2 net-creds.py -i eth0
```

Kutekeleza hatua hizi humpa mshambuliaji nafasi ya kuingilia na kubadilisha trafiki, sawa na utaratibu wa utekaji wa GLBP. Hii inaonyesha udhaifu katika itifaki za redundansi kama HSRP na haja ya hatua imara za usalama.
