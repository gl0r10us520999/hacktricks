# GLBP ve HSRP Saldırıları

{% hint style="success" %}
AWS Hacking'i öğrenin ve uygulayın:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve uygulayın: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katılın veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **HackTricks** ve **HackTricks Cloud** github depolarına PR göndererek hacking püf noktalarını paylaşın.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## FHRP Kaçırma Genel Bakış

### FHRP Hakkında Bilgiler
FHRP, birden fazla yönlendiriciyi tek bir sanal birim haline getirerek ağın sağlamlığını sağlamayı amaçlayan bir protokol grubudur, böylece yük dağıtımı ve hata toleransı artırılır. Cisco Systems, bu pakette GLBP ve HSRP gibi önde gelen protokoller tanıttı.

### GLBP Protokolü Hakkında Bilgiler
Cisco'nun oluşturduğu GLBP, TCP/IP yığınında çalışır ve iletişim için UDP'yi 3222 numaralı portta kullanır. GLBP grubundaki yönlendiriciler, 3 saniyelik aralıklarla "hello" paketleri alışverişi yapar. Bir yönlendirici bu paketleri 10 saniye boyunca göndermezse, çevrimdışı olarak kabul edilir. Bununla birlikte, bu zamanlayıcılar sabit değildir ve değiştirilebilir.

### GLBP İşlemleri ve Yük Dağıtımı
GLBP, tek bir sanal IP ile birleştirilmiş birden fazla sanal MAC adresi kullanarak yönlendiriciler arasında yük dağıtımını sağlayarak öne çıkar. Bir GLBP grubunda, her yönlendirici paket iletimine dahil olur. HSRP/VRRP'nin aksine, GLBP, şu mekanizmalar aracılığıyla gerçek yük dengelemesi sunar:

- **Ana Bilgisayara Bağımlı Yük Dengeleme:** Bir ana bilgisayara sürekli AVF MAC adresi atamasını sağlar, istikrarlı NAT yapılandırmaları için önemlidir.
- **Round-Robin Yük Dengeleme:** Alternatif AVF MAC adresi atama yaklaşımı, istekte bulunan ana bilgisayarlar arasında dönüşümlüdür.
- **Ağırlıklı Round-Robin Yük Dengeleme:** Önceden belirlenmiş "Ağırlık" metriklerine göre yükü dağıtır.

### GLBP'de Ana Bileşenler ve Terimler
- **AVG (Aktif Sanal Ağ Geçidi):** MAC adreslerini eş yönlendiricilere atamaktan sorumlu ana yönlendirici.
- **AVF (Aktif Sanal Yönlendirici):** Ağ trafiğini yönetmek için belirlenen bir yönlendirici.
- **GLBP Önceliği:** AVG'yi belirleyen bir ölçüt, varsayılan olarak 100'den başlar ve 1 ile 255 arasında değişir.
- **GLBP Ağırlık:** Bir yönlendiricideki mevcut yükü yansıtır, manuel olarak veya Nesne İzleme aracılığıyla ayarlanabilir.
- **GLBP Sanal IP Adresi:** Bağlı tüm cihazlar için ağın varsayılan ağ geçidi olarak hizmet verir.

Etkileşimler için GLBP, 224.0.0.102 ayrılmış çoklu yayın adresini ve UDP portunu 3222 kullanır. Yönlendiriciler, 3 saniyelik aralıklarla "hello" paketleri gönderir ve bir paket 10 saniyelik bir süre içinde kaçırılırsa işlevsiz kabul edilir.

### GLBP Saldırı Mekanizması
Bir saldırgan, en yüksek öncelik değerine (255) sahip bir GLBP paketi göndererek ana yönlendirici haline gelebilir. Bu, trafik yakalama veya yönlendirme izni veren DoS veya MITM saldırılarına yol açabilir.

### Loki ile GLBP Saldırısı Gerçekleştirme
[Loki](https://github.com/raizo62/loki_on_kali), önceden öncelik ve ağırlık değerleri 255'e ayarlanmış bir paket enjekte ederek bir GLBP saldırısı gerçekleştirebilir. Saldırı öncesi adımlar, Wireshark gibi araçlar kullanılarak sanal IP adresi, kimlik doğrulama varlığı ve yönlendirici öncelik değerlerini toplamayı içerir.

Saldırı Adımları:
1. Promiskü moduna geçin ve IP yönlendirmeyi etkinleştirin.
2. Hedef yönlendiriciyi tanımlayın ve IP'sini alın.
3. Bir İstek Üzerine ARP oluşturun.
4. AVG'yi taklit eden kötü amaçlı bir GLBP paketi enjekte edin.
5. Saldırganın ağ arabirimine ikincil bir IP adresi atayın ve GLBP sanal IP'yi yansıtacak şekilde yapılandırın.
6. Tam trafik görünürlüğü için SNAT uygulayın.
7. İnternet erişimini orijinal AVG yönlendiricisi üzerinden devam ettirmek için yönlendirmeyi ayarlayın.

Bu adımları takip ederek, saldırgan kendisini ağ trafiğini, şifrelenmemiş veya hassas verileri de içeren bir "ortadaki adam" olarak konumlandırır.

Demonstrasyon için gereken komut parçaları aşağıda verilmiştir:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
### HSRP Saldırı Mekanizması

HSRP saldırıları, En Yüksek Öncelik Değerini enjekte ederek Etkin Yönlendirici'nin rolünü zorla ele geçirmeyi içerir. Bu, Orta Adam (MITM) saldırısına yol açabilir. Temel saldırı öncesi adımlar arasında HSRP kurulumu hakkında veri toplamak bulunur, bu Wireshark kullanılarak trafiğin analiz edilmesiyle gerçekleştirilebilir.

#### HSRP Kimlik Doğrulamasını Atlayma Adımları
1. HSRP verilerini içeren ağ trafiğini .pcap dosyası olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. .pcap dosyasından MD5 karma değerlerini hsrp2john.py kullanarak çıkarın.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 karma değerlerini kırın.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Loki ile HSRP Enjeksiyonu Gerçekleştirme**

1. HSRP reklamlarını tanımlamak için Loki'yi başlatın.
2. Ağ arayüzünü promiscuous moduna ayarlayın ve IP yönlendirmeyi etkinleştirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi belirli yönlendiriciyi hedeflemek için kullanın, kırılmış HSRP şifresini girin ve Etkin Yönlendirici'yi taklit etmek için gerekli yapılandırmaları yapın.
4. Etkin Yönlendirici rolünü aldıktan sonra, ağ arayüzünü ve IP tablolarını yapılandırarak meşru trafiği engelleyin.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Trafik yönlendirmek için yönlendirme tablosunu değiştirin ve önceki Etkin Yönlendirici üzerinden yönlendirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafiğe ait kimlik bilgilerini almak için net-creds.py veya benzer bir yardımcı programı kullanın.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adımları uygulamak, saldırganı trafiği engellemek ve manipüle etmek için bir konuma yerleştirir, GLBP ele geçirmesi için yapılan işleme benzer. Bu, HSRP gibi yedeklilik protokollerindeki zafiyeti ve sağlam güvenlik önlemlerine olan ihtiyacı vurgular.
