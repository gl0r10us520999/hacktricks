# GLBP & HSRP Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## FHRP Hijacking Overview

### Insights into FHRP
FHRPã¯ã€è¤‡æ•°ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å˜ä¸€ã®ä»®æƒ³ãƒ¦ãƒ‹ãƒƒãƒˆã«çµ±åˆã™ã‚‹ã“ã¨ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å …ç‰¢æ€§ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€è² è·åˆ†æ•£ã¨éšœå®³è€æ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚Cisco Systemsã¯ã€ã“ã®ã‚¹ã‚¤ãƒ¼ãƒˆã«ãŠã„ã¦GLBPã‚„HSRPãªã©ã®ä¸»è¦ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å°å…¥ã—ã¾ã—ãŸã€‚

### GLBP Protocol Insights
CiscoãŒä½œæˆã—ãŸGLBPã¯ã€TCP/IPã‚¹ã‚¿ãƒƒã‚¯ä¸Šã§æ©Ÿèƒ½ã—ã€ãƒãƒ¼ãƒˆ3222ã®UDPã‚’ä½¿ç”¨ã—ã¦é€šä¿¡ã—ã¾ã™ã€‚GLBPã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã¯ã€3ç§’ã”ã¨ã«ã€Œhelloã€ãƒ‘ã‚±ãƒƒãƒˆã‚’äº¤æ›ã—ã¾ã™ã€‚ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒã“ã‚Œã‚‰ã®ãƒ‘ã‚±ãƒƒãƒˆã‚’10ç§’é–“é€ä¿¡ã—ãªã„å ´åˆã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã¨è¦‹ãªã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã‚‰ã®ã‚¿ã‚¤ãƒãƒ¼ã¯å›ºå®šã•ã‚Œã¦ãŠã‚‰ãšã€å¤‰æ›´å¯èƒ½ã§ã™ã€‚

### GLBP Operations and Load Distribution
GLBPã¯ã€å˜ä¸€ã®ä»®æƒ³IPã¨è¤‡æ•°ã®ä»®æƒ³MACã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãƒ«ãƒ¼ã‚¿ãƒ¼é–“ã§è² è·åˆ†æ•£ã‚’å¯èƒ½ã«ã™ã‚‹ã“ã¨ã§éš›ç«‹ã£ã¦ã„ã¾ã™ã€‚GLBPã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã¯ã€ã™ã¹ã¦ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒãƒ‘ã‚±ãƒƒãƒˆè»¢é€ã«é–¢ä¸ã—ã¾ã™ã€‚HSRP/VRRPã¨ã¯ç•°ãªã‚Šã€GLBPã¯è¤‡æ•°ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’é€šã˜ã¦çœŸã®è² è·åˆ†æ•£ã‚’æä¾›ã—ã¾ã™ï¼š

- **Host-Dependent Load Balancing:** ãƒ›ã‚¹ãƒˆã«å¯¾ã—ã¦ä¸€è²«ã—ãŸAVF MACã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰²ã‚Šå½“ã¦ã‚’ç¶­æŒã—ã€å®‰å®šã—ãŸNATæ§‹æˆã«ä¸å¯æ¬ ã§ã™ã€‚
- **Round-Robin Load Balancing:** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€è¦æ±‚ã™ã‚‹ãƒ›ã‚¹ãƒˆé–“ã§AVF MACã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰²ã‚Šå½“ã¦ã‚’äº¤äº’ã«è¡Œã„ã¾ã™ã€‚
- **Weighted Round-Robin Load Balancing:** äº‹å‰å®šç¾©ã•ã‚ŒãŸã€ŒWeightã€ãƒ¡ãƒˆãƒªãƒƒã‚¯ã«åŸºã¥ã„ã¦è² è·ã‚’åˆ†æ•£ã—ã¾ã™ã€‚

### Key Components and Terminologies in GLBP
- **AVG (Active Virtual Gateway):** MACã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ”ã‚¢ãƒ«ãƒ¼ã‚¿ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ä¸»ãªãƒ«ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚
- **AVF (Active Virtual Forwarder):** ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«æŒ‡å®šã•ã‚ŒãŸãƒ«ãƒ¼ã‚¿ãƒ¼ã§ã™ã€‚
- **GLBP Priority:** AVGã‚’æ±ºå®šã™ã‚‹ãƒ¡ãƒˆãƒªãƒƒã‚¯ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯100ã§ã€1ã‹ã‚‰255ã®ç¯„å›²ã§ã™ã€‚
- **GLBP Weight:** ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ç¾åœ¨ã®è² è·ã‚’åæ˜ ã—ã€æ‰‹å‹•ã¾ãŸã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’é€šã˜ã¦èª¿æ•´å¯èƒ½ã§ã™ã€‚
- **GLBP Virtual IP Address:** ã™ã¹ã¦ã®æ¥ç¶šãƒ‡ãƒã‚¤ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

GLBPã¯ã€äºˆç´„ã•ã‚ŒãŸãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹224.0.0.102ã¨UDPãƒãƒ¼ãƒˆ3222ã‚’ä½¿ç”¨ã—ã¦ç›¸äº’ä½œç”¨ã—ã¾ã™ã€‚ãƒ«ãƒ¼ã‚¿ãƒ¼ã¯3ç§’ã”ã¨ã«ã€Œhelloã€ãƒ‘ã‚±ãƒƒãƒˆã‚’é€ä¿¡ã—ã€10ç§’é–“ãƒ‘ã‚±ãƒƒãƒˆãŒæ¬ è½ã—ãŸå ´åˆã¯éç¨¼åƒã¨è¦‹ãªã•ã‚Œã¾ã™ã€‚

### GLBP Attack Mechanism
æ”»æ’ƒè€…ã¯ã€å„ªå…ˆåº¦å€¤ï¼ˆ255ï¼‰ãŒæœ€ã‚‚é«˜ã„GLBPãƒ‘ã‚±ãƒƒãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€ä¸»ãƒ«ãƒ¼ã‚¿ãƒ¼ã«ãªã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€DoSã¾ãŸã¯MITMæ”»æ’ƒãŒç™ºç”Ÿã—ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®å‚å—ã¾ãŸã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

### Executing a GLBP Attack with Loki
[Loki](https://github.com/raizo62/loki_on_kali)ã¯ã€å„ªå…ˆåº¦ã¨é‡ã¿ã‚’255ã«è¨­å®šã—ãŸãƒ‘ã‚±ãƒƒãƒˆã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§GLBPæ”»æ’ƒã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚æ”»æ’ƒå‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ã¯ã€Wiresharkãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ä»®æƒ³IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€èªè¨¼ã®æœ‰ç„¡ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ã®å„ªå…ˆåº¦å€¤ãªã©ã®æƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã¾ã™ã€‚

Attack Steps:
1. ãƒ—ãƒ­ãƒŸã‚¹ã‚­ãƒ£ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã€IPè»¢é€ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
2. å¯¾è±¡ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ç‰¹å®šã—ã€ãã®IPã‚’å–å¾—ã—ã¾ã™ã€‚
3. Gratuitous ARPã‚’ç”Ÿæˆã—ã¾ã™ã€‚
4. AVGã‚’å½è£…ã—ãŸæ‚ªæ„ã®ã‚ã‚‹GLBPãƒ‘ã‚±ãƒƒãƒˆã‚’æ³¨å…¥ã—ã¾ã™ã€‚
5. æ”»æ’ƒè€…ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«GLBPä»®æƒ³IPã‚’ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã—ãŸäºŒæ¬¡IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
6. å®Œå…¨ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®å¯è¦–æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«SNATã‚’å®Ÿè£…ã—ã¾ã™ã€‚
7. å…ƒã®AVGãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’é€šã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã«å¾“ã†ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã€Œä¸­é–“è€…ã€ã¨ã—ã¦ä½ç½®ã¥ã‘ã‚‰ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‚å—ã—ã€è§£æã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚æš—å·åŒ–ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’å«ã¿ã¾ã™ã€‚

For demonstration, here are the required command snippets:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ç›£è¦–ã¨å‚å—ã¯ã€net-creds.pyã‚„åŒæ§˜ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ä¾µå®³ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æµã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã€åˆ†æã™ã‚‹ã“ã¨ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### HSRPãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã®å—å‹•çš„èª¬æ˜ã¨ã‚³ãƒãƒ³ãƒ‰ã®è©³ç´°

#### HSRPï¼ˆãƒ›ãƒƒãƒˆã‚¹ã‚¿ãƒ³ãƒã‚¤ãƒ«ãƒ¼ã‚¿/å†—é•·ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰ã®æ¦‚è¦
HSRPã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®å†—é•·æ€§ã®ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸCiscoã®ç‹¬è‡ªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ã€‚è¤‡æ•°ã®ç‰©ç†ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å…±æœ‰IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤å˜ä¸€ã®è«–ç†ãƒ¦ãƒ‹ãƒƒãƒˆã«æ§‹æˆã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã®è«–ç†ãƒ¦ãƒ‹ãƒƒãƒˆã¯ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æŒ‡ç¤ºã™ã‚‹è²¬ä»»ã‚’æŒã¤ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ«ãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã¾ã™ã€‚GLBPã¨ã¯ç•°ãªã‚Šã€HSRPã¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç®¡ç†ã®ãŸã‚ã«å˜ä¸€ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼ã«ä¾å­˜ã—ã¾ã™ã€‚

#### HSRPã«ãŠã‘ã‚‹å½¹å‰²ã¨ç”¨èª
- **HSRPã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼**: ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦æ©Ÿèƒ½ã—ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç®¡ç†ã™ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã€‚
- **HSRPã‚¹ã‚¿ãƒ³ãƒã‚¤ãƒ«ãƒ¼ã‚¿ãƒ¼**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒæ•…éšœã—ãŸå ´åˆã«å¼•ãç¶™ãæº–å‚™ãŒã§ãã¦ã„ã‚‹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ«ãƒ¼ã‚¿ãƒ¼ã€‚
- **HSRPã‚°ãƒ«ãƒ¼ãƒ—**: å˜ä¸€ã®è€éšœå®³æ€§ã®ã‚ã‚‹ä»®æƒ³ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å½¢æˆã™ã‚‹ãŸã‚ã«å”åŠ›ã™ã‚‹ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ã‚»ãƒƒãƒˆã€‚
- **HSRP MACã‚¢ãƒ‰ãƒ¬ã‚¹**: HSRPè¨­å®šã«ãŠã„ã¦è«–ç†ãƒ«ãƒ¼ã‚¿ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸä»®æƒ³MACã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
- **HSRPä»®æƒ³IPã‚¢ãƒ‰ãƒ¬ã‚¹**: æ¥ç¶šã•ã‚ŒãŸãƒ‡ãƒã‚¤ã‚¹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹HSRPã‚°ãƒ«ãƒ¼ãƒ—ã®ä»®æƒ³IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚

#### HSRPã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
HSRPã«ã¯ã€ã‚°ãƒ«ãƒ¼ãƒ—å®¹é‡ã€ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆIPã®ä½¿ç”¨ã€ãŠã‚ˆã³ä»®æƒ³MACã‚¢ãƒ‰ãƒ¬ã‚¹æ§‹é€ ãŒä¸»ã«ç•°ãªã‚‹HSRPv1ã¨HSRPv2ã®2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±äº¤æ›ã®ãŸã‚ã«ç‰¹å®šã®ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åˆ©ç”¨ã—ã€Helloãƒ‘ã‚±ãƒƒãƒˆã¯3ç§’ã”ã¨ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚10ç§’é–“ãƒ‘ã‚±ãƒƒãƒˆãŒå—ä¿¡ã•ã‚Œãªã„å ´åˆã€ãƒ«ãƒ¼ã‚¿ãƒ¼ã¯éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¨è¦‹ãªã•ã‚Œã¾ã™ã€‚

#### HSRPæ”»æ’ƒãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
HSRPæ”»æ’ƒã¯ã€æœ€å¤§å„ªå…ˆåº¦å€¤ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼ã®å½¹å‰²ã‚’å¼·åˆ¶çš„ã«å¼•ãç¶™ãã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Man-In-The-Middleï¼ˆMITMï¼‰æ”»æ’ƒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒå‰ã®é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã«ã¯ã€HSRPè¨­å®šã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹ã“ã¨ãŒå«ã¾ã‚Œã€ã“ã‚Œã¯Wiresharkã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ†æã‚’è¡Œã†ã“ã¨ã§å®Ÿæ–½ã§ãã¾ã™ã€‚

#### HSRPèªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹æ‰‹é †
1. HSRPãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’.pcapãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
```shell
tcpdump -w hsrp_traffic.pcap
```
2. hsrp2john.pyã‚’ä½¿ç”¨ã—ã¦.pcapãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰MD5ãƒãƒƒã‚·ãƒ¥ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripperã‚’ä½¿ç”¨ã—ã¦MD5ãƒãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒ©ãƒƒã‚¯ã—ã¾ã™ã€‚
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Lokiã‚’ä½¿ç”¨ã—ãŸHSRPã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ**

1. Lokiã‚’èµ·å‹•ã—ã¦HSRPåºƒå‘Šã‚’ç‰¹å®šã—ã¾ã™ã€‚
2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒŸã‚¹ã‚­ãƒ£ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®šã—ã€IPãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Lokiã‚’ä½¿ç”¨ã—ã¦ç‰¹å®šã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã€ã‚¯ãƒ©ãƒƒã‚¯ã—ãŸHSRPãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å½è£…ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚
4. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼ã®å½¹å‰²ã‚’å–å¾—ã—ãŸå¾Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨IPãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¨­å®šã—ã¦æ­£å½“ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‚å—ã—ã¾ã™ã€‚
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¤‰æ›´ã—ã¦ã€ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ä»¥å‰ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ«ãƒ¼ã‚¿ãƒ¼çµŒç”±ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. net-creds.pyã‚„åŒæ§˜ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ã€å‚å—ã—ãŸãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‹ã‚‰è³‡æ ¼æƒ…å ±ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚
```shell
sudo python2 net-creds.py -i eth0
```

ã“ã‚Œã‚‰ã®æ‰‹é †ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‚å—ã—ã€æ“ä½œã™ã‚‹ç«‹å ´ã«ç½®ã‹ã‚Œã€GLBPãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã®æ‰‹é †ã¨é¡ä¼¼ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€HSRPã®ã‚ˆã†ãªå†—é•·æ€§ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è„†å¼±æ€§ã¨ã€å …ç‰¢ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å¿…è¦æ€§ã‚’å¼·èª¿ã—ã¦ã„ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
