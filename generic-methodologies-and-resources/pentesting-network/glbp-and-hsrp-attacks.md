# GLBP & HSRP SaldÄ±rÄ±larÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## FHRP KaÃ§Ä±rma Genel GÃ¶rÃ¼nÃ¼mÃ¼

### FHRP HakkÄ±nda Bilgiler
FHRP, birden fazla yÃ¶nlendiriciyi tek bir sanal birimde birleÅŸtirerek aÄŸ dayanÄ±klÄ±lÄ±ÄŸÄ± saÄŸlamak iÃ§in tasarlanmÄ±ÅŸtÄ±r ve bÃ¶ylece yÃ¼k daÄŸÄ±lÄ±mÄ±nÄ± ve hata toleransÄ±nÄ± artÄ±rÄ±r. Cisco Systems, bu pakette GLBP ve HSRP gibi Ã¶nde gelen protokoller tanÄ±tmÄ±ÅŸtÄ±r.

### GLBP ProtokolÃ¼ HakkÄ±nda Bilgiler
Cisco'nun yarattÄ±ÄŸÄ± GLBP, TCP/IP yÄ±ÄŸÄ±nÄ±nda Ã§alÄ±ÅŸÄ±r ve iletiÅŸim iÃ§in 3222 numaralÄ± portta UDP kullanÄ±r. GLBP grubundaki yÃ¶nlendiriciler, 3 saniyelik aralÄ±klarla "hello" paketleri deÄŸiÅŸ tokuÅŸ eder. Bir yÃ¶nlendirici bu paketleri 10 saniye boyunca gÃ¶ndermezse, Ã§evrimdÄ±ÅŸÄ± olduÄŸu varsayÄ±lÄ±r. Ancak, bu zamanlayÄ±cÄ±lar sabit deÄŸildir ve deÄŸiÅŸtirilebilir.

### GLBP Ä°ÅŸlemleri ve YÃ¼k DaÄŸÄ±tÄ±mÄ±
GLBP, tek bir sanal IP ile birden fazla sanal MAC adresi kullanarak yÃ¶nlendiriciler arasÄ±nda yÃ¼k daÄŸÄ±tÄ±mÄ±nÄ± saÄŸlama yeteneÄŸi ile Ã¶ne Ã§Ä±kar. Bir GLBP grubunda, her yÃ¶nlendirici paket iletimine katÄ±lÄ±r. HSRP/VRRP'nin aksine, GLBP, birkaÃ§ mekanizma aracÄ±lÄ±ÄŸÄ±yla gerÃ§ek yÃ¼k dengelemesi sunar:

- **Host-Dependent Load Balancing:** Bir hosta sÃ¼rekli AVF MAC adresi atamasÄ±nÄ± sÃ¼rdÃ¼rÃ¼r, bu da kararlÄ± NAT yapÄ±landÄ±rmalarÄ± iÃ§in gereklidir.
- **Round-Robin Load Balancing:** VarsayÄ±lan yaklaÅŸÄ±m, istek yapan hostlar arasÄ±nda AVF MAC adresi atamasÄ±nÄ± sÄ±rayla yapar.
- **Weighted Round-Robin Load Balancing:** YÃ¼kÃ¼ Ã¶nceden tanÄ±mlanmÄ±ÅŸ "AÄŸÄ±rlÄ±k" metriklerine gÃ¶re daÄŸÄ±tÄ±r.

### GLBP'deki Ana BileÅŸenler ve Terimler
- **AVG (Aktif Sanal GeÃ§it):** MAC adreslerini eÅŸ yÃ¶nlendiricilere tahsis etmekten sorumlu ana yÃ¶nlendirici.
- **AVF (Aktif Sanal Ä°letici):** AÄŸ trafiÄŸini yÃ¶netmekle gÃ¶revlendirilmiÅŸ bir yÃ¶nlendirici.
- **GLBP Ã–nceliÄŸi:** AVG'yi belirleyen bir metrik, varsayÄ±lan olarak 100 ile baÅŸlar ve 1 ile 255 arasÄ±nda deÄŸiÅŸir.
- **GLBP AÄŸÄ±rlÄ±ÄŸÄ±:** Bir yÃ¶nlendiricinin mevcut yÃ¼kÃ¼nÃ¼ yansÄ±tÄ±r, manuel olarak veya Nesne Takibi aracÄ±lÄ±ÄŸÄ±yla ayarlanabilir.
- **GLBP Sanal IP Adresi:** TÃ¼m baÄŸlÄ± cihazlar iÃ§in aÄŸÄ±n varsayÄ±lan geÃ§idi olarak hizmet eder.

GLBP, etkileÅŸimler iÃ§in 224.0.0.102 rezerve edilmiÅŸ Ã§oklu yayÄ±n adresini ve UDP 3222 portunu kullanÄ±r. YÃ¶nlendiriciler, 3 saniyelik aralÄ±klarla "hello" paketleri gÃ¶nderir ve 10 saniyelik bir sÃ¼re iÃ§inde bir paket kaÃ§Ä±rÄ±lÄ±rsa, Ã§alÄ±ÅŸmÄ±yor olarak kabul edilir.

### GLBP SaldÄ±rÄ± MekanizmasÄ±
Bir saldÄ±rgan, en yÃ¼ksek Ã¶ncelik deÄŸeri (255) ile bir GLBP paketi gÃ¶ndererek ana yÃ¶nlendirici olabilir. Bu, trafik kesintisi veya yÃ¶nlendirmesi saÄŸlayarak DoS veya MITM saldÄ±rÄ±larÄ±na yol aÃ§abilir.

### Loki ile GLBP SaldÄ±rÄ±sÄ± GerÃ§ekleÅŸtirme
[Loki](https://github.com/raizo62/loki_on_kali), Ã¶ncelik ve aÄŸÄ±rlÄ±ÄŸÄ± 255 olarak ayarlanmÄ±ÅŸ bir paket enjekte ederek GLBP saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilir. SaldÄ±rÄ± Ã¶ncesi adÄ±mlar, sanal IP adresi, kimlik doÄŸrulama varlÄ±ÄŸÄ± ve yÃ¶nlendirici Ã¶ncelik deÄŸerleri gibi bilgilerin toplanmasÄ±nÄ± iÃ§erir; bu, Wireshark gibi araÃ§lar kullanÄ±larak yapÄ±lÄ±r.

SaldÄ±rÄ± AdÄ±mlarÄ±:
1. Promiscuous moduna geÃ§in ve IP yÃ¶nlendirmesini etkinleÅŸtirin.
2. Hedef yÃ¶nlendiriciyi belirleyin ve IP'sini alÄ±n.
3. Bir Gratuitous ARP oluÅŸturun.
4. AVG'yi taklit eden kÃ¶tÃ¼ niyetli bir GLBP paketi enjekte edin.
5. SaldÄ±rganÄ±n aÄŸ arayÃ¼zÃ¼ne, GLBP sanal IP'sini yansÄ±tan bir ikincil IP adresi atayÄ±n.
6. Tam trafik gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ iÃ§in SNAT uygulayÄ±n.
7. Orijinal AVG yÃ¶nlendiricisi Ã¼zerinden internet eriÅŸiminin devam etmesini saÄŸlamak iÃ§in yÃ¶nlendirmeyi ayarlayÄ±n.

Bu adÄ±mlarÄ± izleyerek, saldÄ±rgan kendisini "orta adam" olarak konumlandÄ±rÄ±r ve aÄŸ trafiÄŸini, ÅŸifrelenmemiÅŸ veya hassas verileri dahil olmak Ã¼zere, kesip analiz edebilir.

Demonstrasyon iÃ§in gerekli komut parÃ§acÄ±klarÄ±:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
Monitoring and intercepting traffic can be done using net-creds.py or similar tools to capture and analyze data flowing through the compromised network.

### Passive Explanation of HSRP Hijacking with Command Details

#### Overview of HSRP (Hot Standby Router/Redundancy Protocol)
HSRP, Cisco'ya ait bir protokoldÃ¼r ve aÄŸ geÃ§idi yedekliliÄŸi iÃ§in tasarlanmÄ±ÅŸtÄ±r. Birden fazla fiziksel yÃ¶nlendiricinin tek bir mantÄ±ksal birim olarak yapÄ±landÄ±rÄ±lmasÄ±na ve paylaÅŸÄ±lan bir IP adresi ile yÃ¶netilmesine olanak tanÄ±r. Bu mantÄ±ksal birim, trafiÄŸi yÃ¶nlendirmekten sorumlu birincil yÃ¶nlendirici tarafÄ±ndan yÃ¶netilir. YÃ¼k dengelemesi iÃ§in Ã¶ncelik ve aÄŸÄ±rlÄ±k gibi metrikler kullanan GLBP'nin aksine, HSRP, trafik yÃ¶netimi iÃ§in tek bir aktif yÃ¶nlendiriciye dayanÄ±r.

#### Roles and Terminology in HSRP
- **HSRP Aktif YÃ¶nlendirici**: Trafik akÄ±ÅŸÄ±nÄ± yÃ¶neten geÃ§it olarak hareket eden cihaz.
- **HSRP Bekleme YÃ¶nlendirici**: Aktif yÃ¶nlendirici arÄ±zalandÄ±ÄŸÄ±nda devralmaya hazÄ±r yedek yÃ¶nlendirici.
- **HSRP Grubu**: Tek bir dayanÄ±klÄ± sanal yÃ¶nlendirici oluÅŸturmak iÃ§in iÅŸbirliÄŸi yapan yÃ¶nlendiriciler seti.
- **HSRP MAC Adresi**: HSRP kurulumundaki mantÄ±ksal yÃ¶nlendiriciye atanan sanal MAC adresi.
- **HSRP Sanal IP Adresi**: HSRP grubunun sanal IP adresi, baÄŸlÄ± cihazlar iÃ§in varsayÄ±lan geÃ§it olarak iÅŸlev gÃ¶rÃ¼r.

#### HSRP Versions
HSRP, grup kapasitesi, Ã§oklu IP kullanÄ±mÄ± ve sanal MAC adresi yapÄ±sÄ± aÃ§Ä±sÄ±ndan farklÄ±lÄ±k gÃ¶steren iki versiyona sahiptir: HSRPv1 ve HSRPv2. Protokol, hizmet bilgisi alÄ±ÅŸveriÅŸi iÃ§in belirli Ã§oklu IP adreslerini kullanÄ±r ve her 3 saniyede bir Hello paketleri gÃ¶nderir. 10 saniyelik bir aralÄ±k iÃ§inde paket alÄ±nmazsa, bir yÃ¶nlendirici pasif kabul edilir.

#### HSRP Attack Mechanism
HSRP saldÄ±rÄ±larÄ±, maksimum Ã¶ncelik deÄŸeri enjekte ederek Aktif YÃ¶nlendirici'nin rolÃ¼nÃ¼ zorla devralmayÄ± iÃ§erir. Bu, Man-In-The-Middle (MITM) saldÄ±rÄ±sÄ±na yol aÃ§abilir. SaldÄ±rÄ± Ã¶ncesi temel adÄ±mlar, HSRP kurulumuna dair veri toplamayÄ± iÃ§erir; bu, trafik analizi iÃ§in Wireshark kullanÄ±larak yapÄ±labilir.

#### Steps for Bypassing HSRP Authentication
1. HSRP verilerini iÃ§eren aÄŸ trafiÄŸini .pcap dosyasÄ± olarak kaydedin.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. .pcap dosyasÄ±ndan MD5 hash'lerini hsrp2john.py kullanarak Ã§Ä±karÄ±n.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. John the Ripper kullanarak MD5 hash'lerini kÄ±rÄ±n.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Executing HSRP Injection with Loki**

1. HSRP reklamlarÄ±nÄ± tanÄ±mlamak iÃ§in Loki'yi baÅŸlatÄ±n.
2. AÄŸ arayÃ¼zÃ¼nÃ¼ promiscuous moda ayarlayÄ±n ve IP yÃ¶nlendirmesini etkinleÅŸtirin.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Loki'yi belirli yÃ¶nlendiriciye hedef almak iÃ§in kullanÄ±n, kÄ±rÄ±lmÄ±ÅŸ HSRP ÅŸifresini girin ve Aktif YÃ¶nlendirici'yi taklit etmek iÃ§in gerekli yapÄ±landÄ±rmalarÄ± yapÄ±n.
4. Aktif YÃ¶nlendirici rolÃ¼nÃ¼ kazandÄ±ktan sonra, aÄŸ arayÃ¼zÃ¼nÃ¼zÃ¼ ve IP tablolarÄ±nÄ±zÄ± meÅŸru trafiÄŸi yakalamak iÃ§in yapÄ±landÄ±rÄ±n.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. TrafiÄŸi eski Aktif YÃ¶nlendirici Ã¼zerinden yÃ¶nlendirmek iÃ§in yÃ¶nlendirme tablosunu deÄŸiÅŸtirin.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Yakalanan trafikten kimlik bilgilerini almak iÃ§in net-creds.py veya benzeri bir yardÄ±mcÄ± program kullanÄ±n.
```shell
sudo python2 net-creds.py -i eth0
```

Bu adÄ±mlarÄ± uygulamak, saldÄ±rganÄ± trafiÄŸi yakalamak ve manipÃ¼le etmek iÃ§in bir konuma getirir; bu, GLBP kaÃ§Ä±rma prosedÃ¼rÃ¼yle benzerdir. Bu, HSRP gibi yedeklilik protokollerindeki zayÄ±flÄ±ÄŸÄ± ve saÄŸlam gÃ¼venlik Ã¶nlemlerine olan ihtiyacÄ± vurgular.


## References
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
