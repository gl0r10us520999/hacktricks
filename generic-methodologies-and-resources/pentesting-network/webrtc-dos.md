# WebRTC DoS

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

**Este problema foi encontrado neste post do blog:** [**https://www.rtcsec.com/article/novel-dos-vulnerability-affecting-webrtc-media-servers/**](https://www.rtcsec.com/article/novel-dos-vulnerability-affecting-webrtc-media-servers/)

A vulnerabilidade descrita nos servidores de m√≠dia WebRTC surge de uma **condi√ß√£o de corrida** durante a inicializa√ß√£o das sess√µes de m√≠dia, especificamente entre a **verifica√ß√£o de consentimento de m√≠dia ICE** e a **inicia√ß√£o de tr√°fego DTLS**. Aqui est√° uma an√°lise detalhada:

### Origem da Vulnerabilidade

1. **Aloca√ß√£o de Porta UDP:** Quando um usu√°rio inicia uma chamada WebRTC, o servidor de m√≠dia aloca portas UDP para gerenciar os fluxos de m√≠dia, com o IP e a porta comunicados via sinaliza√ß√£o.
2. **Processos ICE e STUN:** O navegador do usu√°rio utiliza ICE para verifica√ß√£o de consentimento de m√≠dia, utilizando STUN para determinar o caminho de conex√£o para o servidor de m√≠dia.
3. **Sess√£o DTLS:** Ap√≥s a verifica√ß√£o bem-sucedida do STUN, uma sess√£o DTLS √© iniciada para estabelecer chaves mestres SRTP, mudando para SRTP para o fluxo de m√≠dia.

### Mecanismo de Explora√ß√£o

* **Explora√ß√£o da Condi√ß√£o de Corrida:** Um atacante pode explorar uma condi√ß√£o de corrida enviando uma mensagem DTLS ClientHello antes do usu√°rio leg√≠timo, potencialmente usando um conjunto de cifras inv√°lido como `TLS_NULL_WITH_NULL_NULL`. Isso causa um erro DTLS no servidor, impedindo que a sess√£o SRTP seja estabelecida.

### Processo de Ataque

* **Escaneamento de Portas:** O atacante precisa adivinhar quais portas UDP est√£o lidando com sess√µes de m√≠dia recebidas, enviando mensagens ClientHello com o conjunto de cifras nulo para essas portas para acionar a vulnerabilidade.
* **Diagrama do Ataque:** A sequ√™ncia envolve v√°rias mensagens ClientHello enviadas pelo atacante para o servidor, intercaladas com sinaliza√ß√µes leg√≠timas e mensagens DTLS, levando a uma falha de handshake devido ao conjunto de cifras err√¥neo.

### Testes e Mitiga√ß√£o

* **Testes Seguros:** Usando ferramentas como Scapy, os atacantes reproduzem mensagens DTLS ClientHello direcionadas a portas de m√≠dia espec√≠ficas. Para testes √©ticos, modifica√ß√µes no Chromium (por exemplo, `JsepTransport::AddRemoteCandidates`) foram usadas para imitar o comportamento da v√≠tima de forma segura.
* **Medidas de Mitiga√ß√£o:** As solu√ß√µes envolvem descartar pacotes de endere√ßos n√£o verificados, conforme implementado em vers√µes mais recentes de bibliotecas como libnice. A solu√ß√£o principal enfatiza confiar no processo de verifica√ß√£o ICE e processar apenas pacotes de combina√ß√µes de IP e porta validadas.

### Cen√°rios N√£o Vulner√°veis

* **Configura√ß√µes do Servidor DTLS:** Inst√¢ncias em que o navegador atua como um servidor DTLS ou quando o servidor de m√≠dia n√£o usa portas ef√™meras para sess√µes de m√≠dia n√£o s√£o suscet√≠veis a essa vulnerabilidade.

### Conclus√£o

Essa vulnerabilidade destaca o delicado equil√≠brio nos processos de inicializa√ß√£o de sess√µes de m√≠dia e a necessidade de mecanismos de verifica√ß√£o e temporiza√ß√£o precisos para prevenir a explora√ß√£o. Os desenvolvedores s√£o aconselhados a implementar corre√ß√µes de seguran√ßa recomendadas e garantir processos de verifica√ß√£o robustos para mitigar tais vulnerabilidades.

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
