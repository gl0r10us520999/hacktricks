# WebRTC DoS

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

**Dieses Problem wurde in diesem Blogbeitrag gefunden:** [**https://www.rtcsec.com/article/novel-dos-vulnerability-affecting-webrtc-media-servers/**](https://www.rtcsec.com/article/novel-dos-vulnerability-affecting-webrtc-media-servers/)

Die beschriebene Schwachstelle in WebRTC-Medienservern ergibt sich aus einer **Rennbedingung** w√§hrend der Initialisierung von Mediensitzungen, insbesondere zwischen der **ICE-Medienzustimmungs√ºberpr√ºfung** und der **DTLS-Verkehrsinitiierung**. Hier ist eine detaillierte Aufschl√ºsselung:

### Ursprung der Schwachstelle

1. **UDP-Portzuweisung:** Wenn ein Benutzer einen WebRTC-Anruf initiiert, weist der Medienserver UDP-Ports zur Verarbeitung der Medienstr√∂me zu, wobei die IP und der Port √ºber Signalisierung kommuniziert werden.
2. **ICE- und STUN-Prozesse:** Der Browser des Benutzers verwendet ICE zur √úberpr√ºfung der Medienzustimmung und nutzt STUN, um den Verbindungsweg zum Medienserver zu bestimmen.
3. **DTLS-Sitzung:** Nach erfolgreicher STUN-√úberpr√ºfung beginnt eine DTLS-Sitzung, um SRTP-Master-Schl√ºssel zu etablieren, und wechselt zu SRTP f√ºr den Medienstream.

### Ausbeutungsmechanismus

* **Ausnutzung der Rennbedingung:** Ein Angreifer kann eine Rennbedingung ausnutzen, indem er eine DTLS ClientHello-Nachricht vor dem legitimen Benutzer sendet, m√∂glicherweise unter Verwendung einer ung√ºltigen Cipher-Suite wie `TLS_NULL_WITH_NULL_NULL`. Dies verursacht einen DTLS-Fehler auf dem Server, wodurch die SRTP-Sitzung nicht eingerichtet werden kann.

### Angriffsprozess

* **Port-Scanning:** Der Angreifer muss erraten, welche UDP-Ports eingehende Mediensitzungen verarbeiten, und sendet ClientHello-Nachrichten mit der Null-Cipher-Suite an diese Ports, um die Schwachstelle auszul√∂sen.
* **Diagramm des Angriffs:** Die Sequenz umfasst mehrere ClientHello-Nachrichten, die vom Angreifer an den Server gesendet werden, durchsetzt mit legitimer Signalisierung und DTLS-Nachrichten, was zu einem Handshake-Fehler aufgrund der fehlerhaften Cipher-Suite f√ºhrt.

### Testen und Minderung

* **Sicheres Testen:** Mit Tools wie Scapy spielen Angreifer DTLS ClientHello-Nachrichten ab, die auf bestimmte Medienports abzielen. F√ºr ethisches Testen wurden Modifikationen an Chromium (z. B. `JsepTransport::AddRemoteCandidates`) verwendet, um das Verhalten des Opfers sicher zu imitieren.
* **Minderungsma√ünahmen:** L√∂sungen beinhalten das Verwerfen von Paketen von nicht verifizierten Adressen, wie in neueren Versionen von Bibliotheken wie libnice implementiert. Die prim√§re L√∂sung betont das Vertrauen in den ICE-√úberpr√ºfungsprozess und die Verarbeitung von Paketen nur von validierten IP- und Portkombinationen.

### Nicht anf√§llige Szenarien

* **DTLS-Serverkonfigurationen:** F√§lle, in denen der Browser als DTLS-Server fungiert oder wenn der Medienserver keine ephemeral Ports f√ºr Mediensitzungen verwendet, sind nicht anf√§llig f√ºr diese Schwachstelle.

### Fazit

Diese Schwachstelle hebt das empfindliche Gleichgewicht in den Prozessen zur Initialisierung von Mediensitzungen hervor und die Notwendigkeit pr√§ziser Zeit- und √úberpr√ºfungsmechanismen, um eine Ausnutzung zu verhindern. Entwicklern wird geraten, empfohlene Sicherheitsfixes zu implementieren und robuste √úberpr√ºfungsprozesse sicherzustellen, um solche Schwachstellen zu mindern.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
