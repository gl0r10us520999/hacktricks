# Evil Twin EAP-TLS

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή bug bounty**: **εγγραφείτε** στο **Intigriti**, μια premium **πλατφόρμα bug bounty που δημιουργήθηκε από hackers, για hackers**! Ελάτε μαζί μας στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) σήμερα, και αρχίστε να κερδίζετε βραβεία έως **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

Σε κάποια στιγμή χρειάστηκε να χρησιμοποιήσω τη προτεινόμενη λύση από την ανάρτηση παρακάτω αλλά τα βήματα στο [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) δεν λειτουργούσαν πια σε σύγχρονο kali (2019v3).\
Ούτως ή άλλως, είναι εύκολο να τα κάνετε να λειτουργήσουν.\
Απλά χρειάζεται να κατεβάσετε το hostapd-2.6 από εδώ: [https://w1.fi/releases/](https://w1.fi/releases/) και πριν την επανασύνταξη του hostapd-wpe εγκαταστήστε: `apt-get install libssl1.0-dev`

### Ανάλυση και Εκμετάλλευση EAP-TLS σε Ασύρματα Δίκτυα

#### Ιστορικό: EAP-TLS σε Ασύρματα Δίκτυα
Το EAP-TLS είναι ένα πρωτόκολλο ασφαλείας που παρέχει αμοιβαία πιστοποίηση μεταξύ πελάτη και διακομιστή χρησιμοποιώντας πιστοποιητικά. Η σύνδεση δημιουργείται μόνο εάν και οι δύο, ο πελάτης και ο διακομιστής, πιστοποιήσουν τα πιστοποιητικά του άλλου.

#### Πρόκληση που Αντιμετωπίστηκε
Κατά τη διάρκεια μιας αξιολόγησης, εντοπίστηκε ένα ενδιαφέρον σφάλμα κατά τη χρήση του εργαλείου `hostapd-wpe`. Το εργαλείο απέρριψε τη σύνδεση του πελάτη λόγω του ότι το πιστοποιητικό του πελάτη ήταν υπογεγραμμένο από μια άγνωστη Αρχή Πιστοποίησης (CA). Αυτό υποδήλωνε ότι ο πελάτης δεν εμπιστευόταν το πιστοποιητικό του ψεύτικου διακομιστή, υποδεικνύοντας χαλαρές ρυθμίσεις ασφαλείας από την πλευρά του πελάτη.

#### Στόχος: Ρύθμιση Επίθεσης Man-in-the-Middle (MiTM)
Ο στόχος ήταν να τροποποιηθεί το εργαλείο ώστε να αποδέχεται οποιοδήποτε πιστοποιητικό πελάτη. Αυτό θα επέτρεπε τη δημιουργία σύνδεσης με το κακόβουλο ασύρματο δίκτυο και θα ενεργοποιούσε μια επίθεση MiTM, πιθανώς καταγράφοντας κωδικούς πρόσβασης σε απλό κείμενο ή άλλα ευαίσθητα δεδομένα.

#### Λύση: Τροποποίηση του `hostapd-wpe`
Η ανάλυση του πηγαίου κώδικα του `hostapd-wpe` αποκάλυψε ότι η επικύρωση του πιστοποιητικού πελάτη ελέγχεται από μια παράμετρο (`verify_peer`) στη λειτουργία OpenSSL `SSL_set_verify`. Αλλάζοντας την τιμή αυτής της παραμέτρου από 1 (επικύρωση) σε 0 (μη επικύρωση), το εργαλείο έγινε να αποδέχεται οποιοδήποτε πιστοποιητικό πελάτη.

#### Εκτέλεση της Επίθεσης
1. **Έλεγχος Περιβάλλοντος:** Χρησιμοποιήστε το `airodump-ng` για να παρακολουθήσετε ασύρματα δίκτυα και να εντοπίσετε στόχους.
2. **Ρύθμιση Ψεύτικου AP:** Εκτελέστε το τροποποιημένο `hostapd-wpe` για να δημιουργήσετε ένα ψεύτικο Access Point (AP) που μιμείται το στοχευμένο δίκτυο.
3. **Προσαρμογή Captive Portal:** Προσαρμόστε τη σελίδα σύνδεσης του captive portal ώστε να φαίνεται νόμιμη και οικεία στον στοχευμένο χρήστη.
4. **Επίθεση De-authentication:** Προαιρετικά, εκτελέστε μια επίθεση de-auth για να αποσυνδέσετε τον πελάτη από το νόμιμο δίκτυο και να τον συνδέσετε στο ψεύτικο AP.
5. **Καταγραφή Κωδικών Πρόσβασης:** Μόλις ο πελάτης συνδεθεί στο ψεύτικο AP και αλληλεπιδράσει με το captive portal, οι κωδικοί πρόσβασης του καταγράφονται.

#### Παρατηρήσεις από την Επίθεση
- Σε υπολογιστές Windows, το σύστημα μπορεί να συνδεθεί αυτόματα στο ψεύτικο AP, παρουσιάζοντας το captive portal όταν επιχειρείται πλοήγηση στο διαδίκτυο.
- Σε iPhone, ο χρήστης μπορεί να προειδοποιηθεί να αποδεχτεί ένα νέο πιστοποιητικό και στη συνέχεια να παρουσιαστεί με το captive portal.

#### Συμπέρασμα
Ενώ το EAP-TLS θεωρείται ασφαλές, η αποτελεσματικότητά του εξαρτάται σε μεγάλο βαθμό από τη σωστή ρύθμιση και τη προσεκτική συμπεριφορά των τελικών χρηστών. Λάθος ρυθμισμένες συσκευές ή ανυποψίαστοι χρήστες που αποδέχονται κακόβουλα πιστοποιητικά μπορούν να υπονομεύσουν την ασφάλεια ενός δικτύου προστατευμένου από EAP-TLS.

Για περισσότερες λεπτομέρειες ελέγξτε το https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Αναφορές
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Συμβουλή bug bounty**: **εγγραφείτε** στο **Intigriti**, μια premium **πλατφόρμα bug bounty που δημιουργήθηκε από hackers, για hackers**! Ελάτε μαζί μας στο [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) σήμερα, και αρχίστε να κερδίζετε βραβεία έως **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
