# Evil Twin EAP-TLS

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Melde dich an** bei **Intigriti**, einer Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Schlie√üe dich uns an unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) heute und beginne, Pr√§mien von bis zu **100.000 $** zu verdienen!

{% embed url="https://go.intigriti.com/hacktricks" %}

Irgendwann musste ich die vorgeschlagene L√∂sung aus dem untenstehenden Beitrag verwenden, aber die Schritte in [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) funktionierten in modernem Kali (2019v3) nicht mehr.\
Trotzdem ist es einfach, sie zum Laufen zu bringen.\
Du musst nur hostapd-2.6 von hier herunterladen: [https://w1.fi/releases/](https://w1.fi/releases/) und vor der erneuten Kompilierung von hostapd-wpe installieren: `apt-get install libssl1.0-dev`

### Analysieren und Ausnutzen von EAP-TLS in Drahtlosen Netzwerken

#### Hintergrund: EAP-TLS in Drahtlosen Netzwerken
EAP-TLS ist ein Sicherheitsprotokoll, das eine gegenseitige Authentifizierung zwischen Client und Server unter Verwendung von Zertifikaten bereitstellt. Die Verbindung wird nur hergestellt, wenn sowohl der Client als auch der Server die Zertifikate des jeweils anderen authentifizieren.

#### Aufgetretene Herausforderung
W√§hrend einer Bewertung trat ein interessantes Problem auf, als das Tool `hostapd-wpe` verwendet wurde. Das Tool wies die Verbindung des Clients zur√ºck, da das Zertifikat des Clients von einer unbekannten Zertifizierungsstelle (CA) signiert war. Dies deutete darauf hin, dass der Client dem Zertifikat des gef√§lschten Servers nicht vertraute, was auf nachl√§ssige Sicherheitskonfigurationen auf der Client-Seite hinwies.

#### Ziel: Einrichtung eines Man-in-the-Middle (MiTM) Angriffs
Das Ziel war es, das Tool so zu modifizieren, dass es jedes Client-Zertifikat akzeptiert. Dies w√ºrde die Herstellung einer Verbindung mit dem b√∂sartigen drahtlosen Netzwerk erm√∂glichen und einen MiTM-Angriff erm√∂glichen, der potenziell Klartext-Anmeldeinformationen oder andere sensible Daten erfassen k√∂nnte.

#### L√∂sung: Modifizierung von `hostapd-wpe`
Die Analyse des Quellcodes von `hostapd-wpe` ergab, dass die Validierung des Client-Zertifikats durch einen Parameter (`verify_peer`) in der OpenSSL-Funktion `SSL_set_verify` gesteuert wurde. Durch √Ñndern des Wertes dieses Parameters von 1 (validieren) auf 0 (nicht validieren) wurde das Tool so konfiguriert, dass es jedes Client-Zertifikat akzeptiert.

#### Ausf√ºhrung des Angriffs
1. **Umgebungspr√ºfung:** Verwende `airodump-ng`, um drahtlose Netzwerke zu √ºberwachen und Ziele zu identifizieren.
2. **Einrichten eines gef√§lschten AP:** F√ºhre das modifizierte `hostapd-wpe` aus, um einen gef√§lschten Access Point (AP) zu erstellen, der das Zielnetzwerk nachahmt.
3. **Anpassung des Captive Portals:** Passe die Anmeldeseite des Captive Portals an, damit sie legitim und vertraut f√ºr den Zielbenutzer erscheint.
4. **De-Authentifizierungsangriff:** F√ºhre optional einen De-Auth-Angriff durch, um den Client vom legitimen Netzwerk zu trennen und ihn mit dem gef√§lschten AP zu verbinden.
5. **Erfassung von Anmeldeinformationen:** Sobald der Client mit dem gef√§lschten AP verbunden ist und mit dem Captive Portal interagiert, werden seine Anmeldeinformationen erfasst.

#### Beobachtungen aus dem Angriff
- Auf Windows-Maschinen k√∂nnte das System automatisch mit dem gef√§lschten AP verbinden und das Captive Portal anzeigen, wenn eine Webnavigation versucht wird.
- Auf einem iPhone k√∂nnte der Benutzer aufgefordert werden, ein neues Zertifikat zu akzeptieren, und dann wird ihm das Captive Portal angezeigt.

#### Fazit
Obwohl EAP-TLS als sicher gilt, h√§ngt seine Wirksamkeit stark von der korrekten Konfiguration und dem vorsichtigen Verhalten der Endbenutzer ab. Fehlkonfigurierte Ger√§te oder ahnungslose Benutzer, die betr√ºgerische Zertifikate akzeptieren, k√∂nnen die Sicherheit eines durch EAP-TLS gesch√ºtzten Netzwerks untergraben.

F√ºr weitere Details siehe https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referenzen
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug-Bounty-Tipp**: **Melde dich an** bei **Intigriti**, einer Premium-**Bug-Bounty-Plattform, die von Hackern f√ºr Hacker erstellt wurde**! Schlie√üe dich uns an unter [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) heute und beginne, Pr√§mien von bis zu **100.000 $** zu verdienen!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
