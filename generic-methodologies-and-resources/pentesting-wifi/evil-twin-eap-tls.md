# Evil Twin EAP-TLS

{% hint style="success" %}
Impara e pratica il hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Impara e pratica il hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Suggerimento bug bounty**: **iscriviti** a **Intigriti**, una premium **piattaforma di bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi, e inizia a guadagnare ricompense fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

A un certo punto ho avuto bisogno di utilizzare la soluzione proposta dal post qui sotto, ma i passaggi in [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) non funzionavano pi√π su kali moderno (2019v3).\
Comunque, √® facile farli funzionare.\
√à sufficiente scaricare hostapd-2.6 da qui: [https://w1.fi/releases/](https://w1.fi/releases/) e prima di ricompilare hostapd-wpe installare: `apt-get install libssl1.0-dev`

### Analisi e sfruttamento di EAP-TLS nelle reti wireless

#### Contesto: EAP-TLS nelle reti wireless
EAP-TLS √® un protocollo di sicurezza che fornisce autenticazione reciproca tra client e server utilizzando certificati. La connessione viene stabilita solo se sia il client che il server autenticano i certificati dell'altro.

#### Problema Incontrato
Durante una valutazione, √® stato riscontrato un errore interessante quando si utilizzava lo strumento `hostapd-wpe`. Lo strumento ha rifiutato la connessione del client a causa del certificato del client firmato da un'Autorit√† di Certificazione (CA) sconosciuta. Questo indicava che il client non si fidava del certificato del server falso, evidenziando configurazioni di sicurezza poco rigorose sul lato client.

#### Obiettivo: Impostare un attacco Man-in-the-Middle (MiTM)
L'obiettivo era modificare lo strumento per accettare qualsiasi certificato del client. Questo avrebbe consentito di stabilire una connessione con la rete wireless malevola e abilitare un attacco MiTM, potenzialmente catturando credenziali in chiaro o altri dati sensibili.

#### Soluzione: Modifica di `hostapd-wpe`
L'analisi del codice sorgente di `hostapd-wpe` ha rivelato che la validazione del certificato del client era controllata da un parametro (`verify_peer`) nella funzione OpenSSL `SSL_set_verify`. Cambiando il valore di questo parametro da 1 (convalida) a 0 (non convalidare), lo strumento √® stato reso in grado di accettare qualsiasi certificato del client.

#### Esecuzione dell'attacco
1. **Controllo dell'ambiente:** Usa `airodump-ng` per monitorare le reti wireless e identificare i target.
2. **Impostare un AP falso:** Esegui il `hostapd-wpe` modificato per creare un Access Point (AP) falso che imita la rete target.
3. **Personalizzazione del portale captive:** Personalizza la pagina di accesso del portale captive per apparire legittima e familiare all'utente target.
4. **Attacco di de-autenticazione:** Facoltativamente, esegui un attacco di de-auth per disconnettere il client dalla rete legittima e collegarlo all'AP falso.
5. **Cattura delle credenziali:** Una volta che il client si connette all'AP falso e interagisce con il portale captive, le sue credenziali vengono catturate.

#### Osservazioni dall'attacco
- Su macchine Windows, il sistema potrebbe connettersi automaticamente all'AP falso, presentando il portale captive quando si tenta di navigare sul web.
- Su un iPhone, all'utente potrebbe essere chiesto di accettare un nuovo certificato e poi presentato con il portale captive.

#### Conclusione
Sebbene EAP-TLS sia considerato sicuro, la sua efficacia dipende fortemente dalla corretta configurazione e dal comportamento cauto degli utenti finali. Dispositivi mal configurati o utenti ignari che accettano certificati non autorizzati possono compromettere la sicurezza di una rete protetta da EAP-TLS.

Per ulteriori dettagli controlla https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Riferimenti
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Suggerimento bug bounty**: **iscriviti** a **Intigriti**, una premium **piattaforma di bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi, e inizia a guadagnare ricompense fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Impara e pratica il hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Impara e pratica il hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}
