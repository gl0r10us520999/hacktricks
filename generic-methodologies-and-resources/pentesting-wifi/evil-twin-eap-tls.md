# Evil Twin EAP-TLS

{% hint style="success" %}
Ucz się i ćwicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz się i ćwicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się trikami hackingowymi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Wskazówka dotycząca bug bounty**: **zarejestruj się** w **Intigriti**, premium **platformie bug bounty stworzonej przez hackerów, dla hackerów**! Dołącz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) już dziś i zacznij zarabiać nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

W pewnym momencie musiałem skorzystać z proponowanego rozwiązania z poniższego posta, ale kroki w [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) nie działały już w nowoczesnym kali (2019v3).\
Tak czy inaczej, łatwo jest je uruchomić.\
Musisz tylko pobrać hostapd-2.6 stąd: [https://w1.fi/releases/](https://w1.fi/releases/) i przed ponownym kompilowaniem hostapd-wpe zainstalować: `apt-get install libssl1.0-dev`

### Analiza i wykorzystanie EAP-TLS w sieciach bezprzewodowych

#### Tło: EAP-TLS w sieciach bezprzewodowych
EAP-TLS to protokół bezpieczeństwa zapewniający wzajemną autoryzację między klientem a serwerem za pomocą certyfikatów. Połączenie jest nawiązywane tylko wtedy, gdy zarówno klient, jak i serwer uwierzytelniają certyfikaty drugiej strony.

#### Napotkane wyzwanie
Podczas oceny napotkano interesujący błąd przy użyciu narzędzia `hostapd-wpe`. Narzędzie odrzuciło połączenie klienta z powodu certyfikatu klienta podpisanego przez nieznaną jednostkę certyfikującą (CA). Wskazywało to, że klient ufał certyfikatowi fałszywego serwera, co sugerowało luźne konfiguracje zabezpieczeń po stronie klienta.

#### Cel: Ustawienie ataku Man-in-the-Middle (MiTM)
Celem było zmodyfikowanie narzędzia, aby akceptowało dowolny certyfikat klienta. Umożliwiłoby to nawiązanie połączenia z złośliwą siecią bezprzewodową i przeprowadzenie ataku MiTM, potencjalnie przechwytując dane uwierzytelniające w postaci czystego tekstu lub inne wrażliwe dane.

#### Rozwiązanie: Modyfikacja `hostapd-wpe`
Analiza kodu źródłowego `hostapd-wpe` ujawniła, że walidacja certyfikatu klienta była kontrolowana przez parametr (`verify_peer`) w funkcji OpenSSL `SSL_set_verify`. Zmieniając wartość tego parametru z 1 (waliduj) na 0 (nie waliduj), narzędzie zaczęło akceptować dowolny certyfikat klienta.

#### Wykonanie ataku
1. **Sprawdzenie środowiska:** Użyj `airodump-ng`, aby monitorować sieci bezprzewodowe i zidentyfikować cele.
2. **Ustawienie fałszywego AP:** Uruchom zmodyfikowane `hostapd-wpe`, aby stworzyć fałszywy punkt dostępu (AP) imitujący docelową sieć.
3. **Dostosowanie portalu przechwytującego:** Dostosuj stronę logowania portalu przechwytującego, aby wyglądała na wiarygodną i znajomą dla docelowego użytkownika.
4. **Atak deautoryzacyjny:** Opcjonalnie przeprowadź atak deautoryzacyjny, aby rozłączyć klienta z legalnej sieci i połączyć go z fałszywym AP.
5. **Przechwytywanie danych uwierzytelniających:** Gdy klient połączy się z fałszywym AP i wejdzie w interakcję z portalem przechwytującym, jego dane uwierzytelniające zostaną przechwycone.

#### Obserwacje z ataku
- Na komputerach z systemem Windows system może automatycznie połączyć się z fałszywym AP, prezentując portal przechwytujący, gdy próbuje się przeglądać strony internetowe.
- Na iPhonie użytkownik może być poproszony o zaakceptowanie nowego certyfikatu, a następnie zaprezentowany zostanie portal przechwytujący.

#### Wnioski
Chociaż EAP-TLS uważany jest za bezpieczny, jego skuteczność w dużej mierze zależy od prawidłowej konfiguracji i ostrożnego zachowania użytkowników końcowych. Źle skonfigurowane urządzenia lub nieświadomi użytkownicy akceptujący nieautoryzowane certyfikaty mogą podważyć bezpieczeństwo sieci chronionej EAP-TLS.

Aby uzyskać więcej informacji, sprawdź https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referencje
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Wskazówka dotycząca bug bounty**: **zarejestruj się** w **Intigriti**, premium **platformie bug bounty stworzonej przez hackerów, dla hackerów**! Dołącz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) już dziś i zacznij zarabiać nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Ucz się i ćwicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz się i ćwicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się trikami hackingowymi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
{% endhint %}
