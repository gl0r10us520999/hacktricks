# Evil Twin EAP-TLS

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty savet**: **prijavite se** za **Intigriti**, premium **bug bounty platformu koju su kreirali hakeri, za hakere**! Pridružite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i počnite da zarađujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

U nekom trenutku sam morao da koristim predloženo rešenje iz posta ispod, ali koraci u [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) više nisu radili u modernom kali (2019v3).\
U svakom slučaju, lako je naterati ih da rade.\
Samo treba da preuzmete hostapd-2.6 odavde: [https://w1.fi/releases/](https://w1.fi/releases/) i pre nego što ponovo kompajlirate hostapd-wpe instalirajte: `apt-get install libssl1.0-dev`

### Analiza i iskorišćavanje EAP-TLS u bežičnim mrežama

#### Pozadina: EAP-TLS u bežičnim mrežama
EAP-TLS je bezbednosni protokol koji pruža uzajamnu autentifikaciju između klijenta i servera koristeći sertifikate. Veza se uspostavlja samo ako klijent i server autentifikuju sertifikate jedni drugih.

#### Izazov na koji se naišlo
Tokom procene, naišao sam na zanimljivu grešku prilikom korišćenja alata `hostapd-wpe`. Alat je odbio vezu klijenta zbog toga što je sertifikat klijenta potpisan od strane nepoznate sertifikacione vlasti (CA). To je ukazalo na to da klijent nije verovao sertifikatu lažnog servera, što ukazuje na labave bezbednosne konfiguracije na strani klijenta.

#### Cilj: Postavljanje napada Man-in-the-Middle (MiTM)
Cilj je bio modifikovati alat da prihvati bilo koji sertifikat klijenta. To bi omogućilo uspostavljanje veze sa zloćudnom bežičnom mrežom i omogućilo MiTM napad, potencijalno hvatajući plaintext akreditive ili druge osetljive podatke.

#### Rešenje: Modifikacija `hostapd-wpe`
Analiza izvornog koda `hostapd-wpe` otkrila je da je validacija sertifikata klijenta kontrolisana parametrima (`verify_peer`) u OpenSSL funkciji `SSL_set_verify`. Promenom vrednosti ovog parametra sa 1 (validiraj) na 0 (ne validiraj), alat je bio podešen da prihvati bilo koji sertifikat klijenta.

#### Izvršenje napada
1. **Provera okruženja:** Koristite `airodump-ng` za praćenje bežičnih mreža i identifikaciju ciljeva.
2. **Postavljanje lažnog AP-a:** Pokrenite modifikovani `hostapd-wpe` da kreirate lažni pristupni tačku (AP) koji imitira ciljanju mrežu.
3. **Prilagođavanje captive portala:** Prilagodite stranicu za prijavu captive portala da izgleda legitimno i poznato ciljanom korisniku.
4. **Napad de-autentifikacije:** Opcionalno, izvršite de-autentifikacijski napad da biste isključili klijenta iz legitimne mreže i povezali ga sa lažnim AP-om.
5. **Hvatanje akreditiva:** Kada se klijent poveže na lažni AP i interaguje sa captive portalom, njihovi akreditivi se hvataju.

#### Zapažanja iz napada
- Na Windows mašinama, sistem može automatski da se poveže na lažni AP, prikazujući captive portal kada se pokuša web navigacija.
- Na iPhone-u, korisnik može biti upitan da prihvati novi sertifikat, a zatim mu se prikazuje captive portal.

#### Zaključak
Iako se EAP-TLS smatra sigurnim, njegova efikasnost u velikoj meri zavisi od ispravne konfiguracije i opreznog ponašanja krajnjih korisnika. Pogrešno konfigurisani uređaji ili nesvesni korisnici koji prihvataju lažne sertifikate mogu oslabiti bezbednost mreže zaštićene EAP-TLS-om.

Za više detalja proverite https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Reference
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty savet**: **prijavite se** za **Intigriti**, premium **bug bounty platformu koju su kreirali hakeri, za hakere**! Pridružite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas, i počnite da zarađujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
