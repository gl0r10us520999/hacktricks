# Evil Twin EAP-TLS

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de bug bounty**: **regístrate** en **Intigriti**, una **plataforma de bug bounty premium creada por hackers, para hackers**! Únete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

En algún momento necesité usar la solución propuesta por el post a continuación, pero los pasos en [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) ya no funcionaban en kali moderno (2019v3).\
De todos modos, es fácil hacer que funcionen.\
Solo necesitas descargar el hostapd-2.6 desde aquí: [https://w1.fi/releases/](https://w1.fi/releases/) y antes de compilar nuevamente hostapd-wpe instala: `apt-get install libssl1.0-dev`

### Analizando y Explotando EAP-TLS en Redes Inalámbricas

#### Antecedentes: EAP-TLS en Redes Inalámbricas
EAP-TLS es un protocolo de seguridad que proporciona autenticación mutua entre el cliente y el servidor utilizando certificados. La conexión solo se establece si tanto el cliente como el servidor autentican los certificados del otro.

#### Desafío Encontrado
Durante una evaluación, se encontró un error interesante al usar la herramienta `hostapd-wpe`. La herramienta rechazó la conexión del cliente debido a que el certificado del cliente estaba firmado por una Autoridad de Certificación (CA) desconocida. Esto indicaba que el cliente confiaba en el certificado del servidor falso, lo que apuntaba a configuraciones de seguridad laxas en el lado del cliente.

#### Objetivo: Configuración de un Ataque Man-in-the-Middle (MiTM)
El objetivo era modificar la herramienta para aceptar cualquier certificado de cliente. Esto permitiría establecer una conexión con la red inalámbrica maliciosa y habilitar un ataque MiTM, capturando potencialmente credenciales en texto plano u otros datos sensibles.

#### Solución: Modificando `hostapd-wpe`
El análisis del código fuente de `hostapd-wpe` reveló que la validación del certificado del cliente estaba controlada por un parámetro (`verify_peer`) en la función de OpenSSL `SSL_set_verify`. Al cambiar el valor de este parámetro de 1 (validar) a 0 (no validar), se hizo que la herramienta aceptara cualquier certificado de cliente.

#### Ejecución del Ataque
1. **Verificación del Entorno:** Usa `airodump-ng` para monitorear redes inalámbricas e identificar objetivos.
2. **Configurar AP Falso:** Ejecuta el `hostapd-wpe` modificado para crear un Punto de Acceso (AP) falso que imite la red objetivo.
3. **Personalización del Portal Cautivo:** Personaliza la página de inicio de sesión del portal cautivo para que parezca legítima y familiar para el usuario objetivo.
4. **Ataque de Desautenticación:** Opcionalmente, realiza un ataque de desautenticación para desconectar al cliente de la red legítima y conectarlo al AP falso.
5. **Captura de Credenciales:** Una vez que el cliente se conecta al AP falso e interactúa con el portal cautivo, se capturan sus credenciales.

#### Observaciones del Ataque
- En máquinas con Windows, el sistema puede conectarse automáticamente al AP falso, presentando el portal cautivo cuando se intenta navegar por la web.
- En un iPhone, se puede solicitar al usuario que acepte un nuevo certificado y luego se le presenta el portal cautivo.

#### Conclusión
Si bien EAP-TLS se considera seguro, su efectividad depende en gran medida de la configuración correcta y del comportamiento cauteloso de los usuarios finales. Dispositivos mal configurados o usuarios desprevenidos que aceptan certificados falsos pueden socavar la seguridad de una red protegida por EAP-TLS.

Para más detalles, consulta https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referencias
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de bug bounty**: **regístrate** en **Intigriti**, una **plataforma de bug bounty premium creada por hackers, para hackers**! Únete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
