# Evil Twin EAP-TLS

{% hint style="success" %}
AWSハッキングを学び、実践する:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングを学び、実践する: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してハッキングトリックを共有してください。**

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**バグバウンティのヒント**: **ハッカーによって、ハッカーのために作られたプレミアム**バグバウンティプラットフォーム**である**Intigriti**に**サインアップ**してください！今日、[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加し、最大**$100,000**のバウンティを獲得し始めましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

ある時、以下の投稿で提案された解決策を使用する必要がありましたが、[https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe)の手順は、最新のKali（2019v3）では機能しなくなっていました。\
それでも、これらを機能させるのは簡単です。\
ここからhostapd-2.6をダウンロードするだけです: [https://w1.fi/releases/](https://w1.fi/releases/) そして、再度hostapd-wpeをコンパイルする前に、次のコマンドを実行します: `apt-get install libssl1.0-dev`

### 無線ネットワークにおけるEAP-TLSの分析と悪用

#### 背景: 無線ネットワークにおけるEAP-TLS
EAP-TLSは、クライアントとサーバー間で相互認証を提供するセキュリティプロトコルです。接続は、クライアントとサーバーの両方が互いの証明書を認証した場合にのみ確立されます。

#### 遭遇した課題
評価中に、`hostapd-wpe`ツールを使用しているときに興味深いエラーが発生しました。このツールは、クライアントの証明書が不明な認証局（CA）によって署名されているため、クライアントの接続を拒否しました。これは、クライアントが偽のサーバーの証明書を信頼していることを示しており、クライアント側のセキュリティ設定が緩いことを示唆しています。

#### 目的: 中間者攻撃（MiTM）の設定
目的は、ツールを修正して任意のクライアント証明書を受け入れることでした。これにより、悪意のある無線ネットワークとの接続が確立され、MiTM攻撃が可能になり、平文の認証情報やその他の機密データを捕捉できるようになります。

#### 解決策: `hostapd-wpe`の修正
`hostapd-wpe`のソースコードの分析により、クライアント証明書の検証がOpenSSL関数`SSL_set_verify`のパラメータ（`verify_peer`）によって制御されていることが明らかになりました。このパラメータの値を1（検証する）から0（検証しない）に変更することで、ツールは任意のクライアント証明書を受け入れるようになりました。

#### 攻撃の実行
1. **環境チェック:** `airodump-ng`を使用して無線ネットワークを監視し、ターゲットを特定します。
2. **偽APの設定:** 修正された`hostapd-wpe`を実行して、ターゲットネットワークを模倣する偽のアクセスポイント（AP）を作成します。
3. **キャプティブポータルのカスタマイズ:** キャプティブポータルのログインページをターゲットユーザーにとって信頼できるものに見えるようにカスタマイズします。
4. **デオーセンティケーション攻撃:** オプションで、クライアントを正当なネットワークから切断し、偽APに接続させるためにデオーセンティケーション攻撃を実行します。
5. **認証情報の捕捉:** クライアントが偽APに接続し、キャプティブポータルと対話すると、その認証情報が捕捉されます。

#### 攻撃からの観察
- Windowsマシンでは、システムが自動的に偽APに接続し、ウェブナビゲーションを試みるとキャプティブポータルが表示されることがあります。
- iPhoneでは、ユーザーが新しい証明書を受け入れるように求められ、その後キャプティブポータルが表示されることがあります。

#### 結論
EAP-TLSは安全と見なされていますが、その効果は正しい設定とエンドユーザーの慎重な行動に大きく依存します。設定ミスのあるデバイスや、悪意のある証明書を受け入れる無防備なユーザーは、EAP-TLSで保護されたネットワークのセキュリティを損なう可能性があります。

詳細については、https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/を確認してください。

## 参考文献
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**バグバウンティのヒント**: **ハッカーによって、ハッカーのために作られたプレミアム**バグバウンティプラットフォーム**である**Intigriti**に**サインアップ**してください！今日、[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加し、最大**$100,000**のバウンティを獲得し始めましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
AWSハッキングを学び、実践する:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングを学び、実践する: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してハッキングトリックを共有してください。**

</details>
{% endhint %}
