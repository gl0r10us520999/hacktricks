# イービルツイン EAP-TLS

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、ハッキングテクニックを共有してください。

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**バグバウンティのヒント**: **Intigriti**に**サインアップ**してください。ハッカーによって作成されたプレミアム**バグバウンティプラットフォーム**！[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) で参加し、最大**$100,000**のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

ある時点で、以下の投稿で提案されたソリューションを使用する必要がありましたが、[https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe)の手順は、現代のKali（2019v3）では機能しませんでした。\
とにかく、それらを機能させるのは簡単です。\
ここから`hostapd-2.6`をダウンロードするだけです：[https://w1.fi/releases/](https://w1.fi/releases/) そして再度`hostapd-wpe`をコンパイルする前に、`apt-get install libssl1.0-dev`をインストールしてください。

### ワイヤレスネットワークにおけるEAP-TLSの分析と悪用

#### 背景：ワイヤレスネットワークにおけるEAP-TLS
EAP-TLSは、証明書を使用してクライアントとサーバー間の相互認証を提供するセキュリティプロトコルです。クライアントとサーバーがお互いの証明書を認証する場合にのみ接続が確立されます。

#### 遭遇した課題
アセスメント中に、`hostapd-wpe`ツールを使用する際に興味深いエラーが発生しました。ツールは、クライアントの証明書が不明な認証局（CA）によって署名されているため、クライアントの接続を拒否しました。これは、クライアントが偽のサーバー証明書を信頼していないことを示し、クライアント側のセキュリティ設定が緩いことを示しています。

#### 目標：中間者攻撃（MiTM）の設定
目標は、ツールを変更して任意のクライアント証明書を受け入れることでした。これにより、悪意のある無線ネットワークとの接続が確立され、MiTM攻撃が可能となり、平文の資格情報やその他の機密データをキャプチャすることができます。

#### 解決策：`hostapd-wpe`の修正
`hostapd-wpe`のソースコードの分析により、クライアント証明書の検証がOpenSSL関数`SSL_set_verify`内のパラメータ（`verify_peer`）によって制御されていることがわかりました。このパラメータの値を1（検証する）から0（検証しない）に変更することで、ツールは任意のクライアント証明書を受け入れるようになりました。

#### 攻撃の実行
1. **環境チェック:** `airodump-ng`を使用してワイヤレスネットワークを監視し、ターゲットを特定します。
2. **偽のAPの設定:** 修正された`hostapd-wpe`を実行して、ターゲットネットワークを模倣する偽のアクセスポイント（AP）を作成します。
3. **キャプティブポータルのカスタマイズ:** キャプティブポータルのログインページをカスタマイズして、ターゲットユーザーにとって合法的で馴染みやすいものに見せます。
4. **De-authentication攻撃:** オプションで、クライアントを正規のネットワークから切断し、偽のAPに接続させるためにde-auth攻撃を実行します。
5. **資格情報のキャプチャ:** クライアントが偽のAPに接続し、キャプティブポータルとやり取りすると、彼らの資格情報がキャプチャされます。

#### 攻撃からの観察
- Windowsマシンでは、Webナビゲーションを試みると、システムが自動的に偽のAPに接続し、キャプティブポータルが表示される場合があります。
- iPhoneでは、ユーザーに新しい証明書を受け入れるよう促され、その後キャプティブポータルが表示される場合があります。

#### 結論
EAP-TLSは安全とされていますが、その効果は正しい構成とエンドユーザーの慎重な行動に大きく依存しています。誤った設定されたデバイスや悪意のないユーザーがローグ証明書を受け入れることで、EAP-TLSで保護されたネットワークのセキュリティが損なわれる可能性があります。

詳細については、https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/ をご覧ください。

## 参考文献
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**バグバウンティのヒント**: **Intigriti**に**サインアップ**してください。ハッカーによって作成されたプレミアム**バグバウンティプラットフォーム**！[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) で参加し、最大**$100,000**のバウンティを獲得しましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、ハッキングテクニックを共有してください。

</details>
{% endhint %}
