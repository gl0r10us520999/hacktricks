# Evil Twin EAP-TLS

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 춰Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de recompensa por errores**: **Reg칤strate** en **Intigriti**, una plataforma de **recompensas por errores premium creada por hackers, para hackers**. 춰칔nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

En alg칰n momento necesit칠 utilizar la soluci칩n propuesta en el post a continuaci칩n, pero los pasos en [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) ya no funcionaban en Kali moderno (2019v3).\
De todos modos, es f치cil hacer que funcionen.\
Solo necesitas descargar el hostapd-2.6 desde aqu칤: [https://w1.fi/releases/](https://w1.fi/releases) y antes de compilar nuevamente hostapd-wpe instala: `apt-get install libssl1.0-dev`

### An치lisis y Explotaci칩n de EAP-TLS en Redes Inal치mbricas

#### Antecedentes: EAP-TLS en Redes Inal치mbricas
EAP-TLS es un protocolo de seguridad que proporciona autenticaci칩n mutua entre el cliente y el servidor utilizando certificados. La conexi칩n solo se establece si tanto el cliente como el servidor autentican los certificados del otro.

#### Desaf칤o Encontrado
Durante una evaluaci칩n, se encontr칩 un error interesante al usar la herramienta `hostapd-wpe`. La herramienta rechaz칩 la conexi칩n del cliente debido a que el certificado del cliente estaba firmado por una Autoridad de Certificaci칩n (CA) desconocida. Esto indicaba que el cliente no confiaba en el certificado del servidor falso, lo que apunta a configuraciones de seguridad laxas en el lado del cliente.

#### Objetivo: Configurar un Ataque de Hombre en el Medio (MiTM)
El objetivo era modificar la herramienta para aceptar cualquier certificado de cliente. Esto permitir칤a el establecimiento de una conexi칩n con la red inal치mbrica maliciosa y habilitar칤a un ataque MiTM, capturando potencialmente credenciales en texto plano u otros datos sensibles.

#### Soluci칩n: Modificar `hostapd-wpe`
El an치lisis del c칩digo fuente de `hostapd-wpe` revel칩 que la validaci칩n del certificado del cliente estaba controlada por un par치metro (`verify_peer`) en la funci칩n OpenSSL `SSL_set_verify`. Al cambiar el valor de este par치metro de 1 (validar) a 0 (no validar), se hizo que la herramienta aceptara cualquier certificado de cliente.

#### Ejecuci칩n del Ataque
1. **Verificaci칩n del Entorno:** Utiliza `airodump-ng` para monitorear redes inal치mbricas e identificar objetivos.
2. **Configurar un AP Falso:** Ejecuta el `hostapd-wpe` modificado para crear un Punto de Acceso (AP) falso imitando la red objetivo.
3. **Personalizaci칩n del Portal Cautivo:** Personaliza la p치gina de inicio de sesi칩n del portal cautivo para que parezca leg칤tima y familiar para el usuario objetivo.
4. **Ataque de Desautenticaci칩n:** Opcionalmente, realiza un ataque de desautenticaci칩n para desconectar al cliente de la red leg칤tima y conectarlo al AP falso.
5. **Captura de Credenciales:** Una vez que el cliente se conecta al AP falso e interact칰a con el portal cautivo, se capturan sus credenciales.

#### Observaciones del Ataque
- En m치quinas con Windows, el sistema podr칤a conectarse autom치ticamente al AP falso, presentando el portal cautivo al intentar la navegaci칩n web.
- En un iPhone, al usuario se le podr칤a pedir que acepte un nuevo certificado y luego se le presentar칤a el portal cautivo.

#### Conclusi칩n
Si bien EAP-TLS se considera seguro, su efectividad depende en gran medida de la configuraci칩n correcta y del comportamiento cauteloso de los usuarios finales. Dispositivos mal configurados o usuarios desprevenidos que aceptan certificados falsos pueden socavar la seguridad de una red protegida con EAP-TLS.

Para m치s detalles, consulta https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referencias
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de recompensa por errores**: **Reg칤strate** en **Intigriti**, una plataforma de **recompensas por errores premium creada por hackers, para hackers**. 춰칔nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 춰Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
