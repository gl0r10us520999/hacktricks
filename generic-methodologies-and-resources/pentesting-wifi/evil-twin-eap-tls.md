# Evil Twin EAP-TLS

{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**上关注我们。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**漏洞赏金提示**：**注册** **Intigriti**，一个由黑客为黑客创建的高级**漏洞赏金平台**！今天就加入我们 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达 **$100,000** 的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

在某个时候，我需要使用下面帖子中提出的解决方案，但 [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) 中的步骤在现代 Kali (2019v3) 中不再有效。\
不过，让它们工作很简单。\
您只需从这里下载 hostapd-2.6：[https://w1.fi/releases/](https://w1.fi/releases/)，并在重新编译 hostapd-wpe 之前安装：`apt-get install libssl1.0-dev`

### 分析和利用无线网络中的 EAP-TLS

#### 背景：无线网络中的 EAP-TLS
EAP-TLS 是一种安全协议，通过使用证书提供客户端和服务器之间的相互认证。只有在客户端和服务器相互验证对方的证书后，连接才会建立。

#### 遇到的挑战
在评估过程中，使用 `hostapd-wpe` 工具时遇到了一个有趣的错误。该工具拒绝了客户端的连接，因为客户端的证书是由未知的证书颁发机构 (CA) 签名的。这表明客户端确实信任假服务器的证书，指向客户端侧的安全配置松懈。

#### 目标：设置中间人攻击 (MiTM)
目标是修改该工具以接受任何客户端证书。这将允许与恶意无线网络建立连接，并启用 MiTM 攻击，可能捕获明文凭据或其他敏感数据。

#### 解决方案：修改 `hostapd-wpe`
对 `hostapd-wpe` 源代码的分析显示，客户端证书验证由 OpenSSL 函数 `SSL_set_verify` 中的一个参数 (`verify_peer`) 控制。通过将该参数的值从 1（验证）更改为 0（不验证），该工具被修改为接受任何客户端证书。

#### 攻击执行
1. **环境检查：** 使用 `airodump-ng` 监控无线网络并识别目标。
2. **设置假 AP：** 运行修改后的 `hostapd-wpe` 创建一个模仿目标网络的假接入点 (AP)。
3. **捕获门户定制：** 定制捕获门户的登录页面，使其看起来合法且熟悉目标用户。
4. **去认证攻击：** 可选地执行去认证攻击，以将客户端从合法网络断开并连接到假 AP。
5. **捕获凭据：** 一旦客户端连接到假 AP 并与捕获门户交互，他们的凭据将被捕获。

#### 攻击观察
- 在 Windows 机器上，系统可能会自动连接到假 AP，当尝试进行网页导航时会呈现捕获门户。
- 在 iPhone 上，用户可能会被提示接受新证书，然后呈现捕获门户。

#### 结论
虽然 EAP-TLS 被认为是安全的，但其有效性在很大程度上依赖于正确的配置和用户的谨慎行为。配置错误的设备或不知情的用户接受恶意证书可能会破坏 EAP-TLS 保护网络的安全性。

有关更多详细信息，请查看 https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## 参考文献
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**漏洞赏金提示**：**注册** **Intigriti**，一个由黑客为黑客创建的高级**漏洞赏金平台**！今天就加入我们 [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)，开始赚取高达 **$100,000** 的赏金！

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**上关注我们。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}
