# Evil Twin EAP-TLS

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Wskaz贸wka dotyczca bug bounty**: **zarejestruj si** w **Intigriti**, premium **platformie bug bounty stworzonej przez hacker贸w, dla hacker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

W pewnym momencie musiaem skorzysta z proponowanego rozwizania z poni偶szego posta, ale kroki w [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) nie dziaay ju偶 w nowoczesnym kali (2019v3).\
Tak czy inaczej, atwo jest je uruchomi.\
Musisz tylko pobra hostapd-2.6 std: [https://w1.fi/releases/](https://w1.fi/releases/) i przed ponownym kompilowaniem hostapd-wpe zainstalowa: `apt-get install libssl1.0-dev`

### Analiza i wykorzystanie EAP-TLS w sieciach bezprzewodowych

#### To: EAP-TLS w sieciach bezprzewodowych
EAP-TLS to protok贸 bezpieczestwa zapewniajcy wzajemn autoryzacj midzy klientem a serwerem za pomoc certyfikat贸w. Poczenie jest nawizywane tylko wtedy, gdy zar贸wno klient, jak i serwer uwierzytelniaj certyfikaty drugiej strony.

#### Napotkane wyzwanie
Podczas oceny napotkano interesujcy bd przy u偶yciu narzdzia `hostapd-wpe`. Narzdzie odrzucio poczenie klienta z powodu certyfikatu klienta podpisanego przez nieznan jednostk certyfikujc (CA). Wskazywao to, 偶e klient ufa certyfikatowi faszywego serwera, co sugerowao lu藕ne konfiguracje zabezpiecze po stronie klienta.

#### Cel: Ustawienie ataku Man-in-the-Middle (MiTM)
Celem byo zmodyfikowanie narzdzia, aby akceptowao dowolny certyfikat klienta. Umo偶liwioby to nawizanie poczenia z zoliw sieci bezprzewodow i przeprowadzenie ataku MiTM, potencjalnie przechwytujc dane uwierzytelniajce w postaci czystego tekstu lub inne wra偶liwe dane.

#### Rozwizanie: Modyfikacja `hostapd-wpe`
Analiza kodu 藕r贸dowego `hostapd-wpe` ujawnia, 偶e walidacja certyfikatu klienta bya kontrolowana przez parametr (`verify_peer`) w funkcji OpenSSL `SSL_set_verify`. Zmieniajc warto tego parametru z 1 (waliduj) na 0 (nie waliduj), narzdzie zaczo akceptowa dowolny certyfikat klienta.

#### Wykonanie ataku
1. **Sprawdzenie rodowiska:** U偶yj `airodump-ng`, aby monitorowa sieci bezprzewodowe i zidentyfikowa cele.
2. **Ustawienie faszywego AP:** Uruchom zmodyfikowane `hostapd-wpe`, aby stworzy faszywy punkt dostpu (AP) imitujcy docelow sie.
3. **Dostosowanie portalu przechwytujcego:** Dostosuj stron logowania portalu przechwytujcego, aby wygldaa na wiarygodn i znajom dla docelowego u偶ytkownika.
4. **Atak deautoryzacyjny:** Opcjonalnie przeprowad藕 atak deautoryzacyjny, aby rozczy klienta z legalnej sieci i poczy go z faszywym AP.
5. **Przechwytywanie danych uwierzytelniajcych:** Gdy klient poczy si z faszywym AP i wejdzie w interakcj z portalem przechwytujcym, jego dane uwierzytelniajce zostan przechwycone.

#### Obserwacje z ataku
- Na komputerach z systemem Windows system mo偶e automatycznie poczy si z faszywym AP, prezentujc portal przechwytujcy, gdy pr贸buje si przeglda strony internetowe.
- Na iPhonie u偶ytkownik mo偶e by poproszony o zaakceptowanie nowego certyfikatu, a nastpnie zaprezentowany zostanie portal przechwytujcy.

#### Wnioski
Chocia偶 EAP-TLS uwa偶any jest za bezpieczny, jego skuteczno w du偶ej mierze zale偶y od prawidowej konfiguracji i ostro偶nego zachowania u偶ytkownik贸w kocowych. 殴le skonfigurowane urzdzenia lub niewiadomi u偶ytkownicy akceptujcy nieautoryzowane certyfikaty mog podwa偶y bezpieczestwo sieci chronionej EAP-TLS.

Aby uzyska wicej informacji, sprawd藕 https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referencje
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Wskaz贸wka dotyczca bug bounty**: **zarejestruj si** w **Intigriti**, premium **platformie bug bounty stworzonej przez hacker贸w, dla hacker贸w**! Docz do nas na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) ju偶 dzi i zacznij zarabia nagrody do **100 000 USD**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
