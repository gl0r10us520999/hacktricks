# Evil Twin EAP-TLS

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de bug bounty**: **reg铆strate** en **Intigriti**, una **plataforma de bug bounty premium creada por hackers, para hackers**! nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

En alg煤n momento necesit茅 usar la soluci贸n propuesta por el post a continuaci贸n, pero los pasos en [https://github.com/OpenSecurityResearch/hostapd-wpe](https://github.com/OpenSecurityResearch/hostapd-wpe) ya no funcionaban en kali moderno (2019v3).\
De todos modos, es f谩cil hacer que funcionen.\
Solo necesitas descargar el hostapd-2.6 desde aqu铆: [https://w1.fi/releases/](https://w1.fi/releases/) y antes de compilar nuevamente hostapd-wpe instala: `apt-get install libssl1.0-dev`

### Analizando y Explotando EAP-TLS en Redes Inal谩mbricas

#### Antecedentes: EAP-TLS en Redes Inal谩mbricas
EAP-TLS es un protocolo de seguridad que proporciona autenticaci贸n mutua entre el cliente y el servidor utilizando certificados. La conexi贸n solo se establece si tanto el cliente como el servidor autentican los certificados del otro.

#### Desaf铆o Encontrado
Durante una evaluaci贸n, se encontr贸 un error interesante al usar la herramienta `hostapd-wpe`. La herramienta rechaz贸 la conexi贸n del cliente debido a que el certificado del cliente estaba firmado por una Autoridad de Certificaci贸n (CA) desconocida. Esto indicaba que el cliente confiaba en el certificado del servidor falso, lo que apuntaba a configuraciones de seguridad laxas en el lado del cliente.

#### Objetivo: Configuraci贸n de un Ataque Man-in-the-Middle (MiTM)
El objetivo era modificar la herramienta para aceptar cualquier certificado de cliente. Esto permitir铆a establecer una conexi贸n con la red inal谩mbrica maliciosa y habilitar un ataque MiTM, capturando potencialmente credenciales en texto plano u otros datos sensibles.

#### Soluci贸n: Modificando `hostapd-wpe`
El an谩lisis del c贸digo fuente de `hostapd-wpe` revel贸 que la validaci贸n del certificado del cliente estaba controlada por un par谩metro (`verify_peer`) en la funci贸n de OpenSSL `SSL_set_verify`. Al cambiar el valor de este par谩metro de 1 (validar) a 0 (no validar), se hizo que la herramienta aceptara cualquier certificado de cliente.

#### Ejecuci贸n del Ataque
1. **Verificaci贸n del Entorno:** Usa `airodump-ng` para monitorear redes inal谩mbricas e identificar objetivos.
2. **Configurar AP Falso:** Ejecuta el `hostapd-wpe` modificado para crear un Punto de Acceso (AP) falso que imite la red objetivo.
3. **Personalizaci贸n del Portal Cautivo:** Personaliza la p谩gina de inicio de sesi贸n del portal cautivo para que parezca leg铆tima y familiar para el usuario objetivo.
4. **Ataque de Desautenticaci贸n:** Opcionalmente, realiza un ataque de desautenticaci贸n para desconectar al cliente de la red leg铆tima y conectarlo al AP falso.
5. **Captura de Credenciales:** Una vez que el cliente se conecta al AP falso e interact煤a con el portal cautivo, se capturan sus credenciales.

#### Observaciones del Ataque
- En m谩quinas con Windows, el sistema puede conectarse autom谩ticamente al AP falso, presentando el portal cautivo cuando se intenta navegar por la web.
- En un iPhone, se puede solicitar al usuario que acepte un nuevo certificado y luego se le presenta el portal cautivo.

#### Conclusi贸n
Si bien EAP-TLS se considera seguro, su efectividad depende en gran medida de la configuraci贸n correcta y del comportamiento cauteloso de los usuarios finales. Dispositivos mal configurados o usuarios desprevenidos que aceptan certificados falsos pueden socavar la seguridad de una red protegida por EAP-TLS.

Para m谩s detalles, consulta https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/

## Referencias
* [https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/](https://versprite.com/blog/application-security/eap-tls-wireless-infrastructure/)

<img src="../../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consejo de bug bounty**: **reg铆strate** en **Intigriti**, una **plataforma de bug bounty premium creada por hackers, para hackers**! nete a nosotros en [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) hoy, y comienza a ganar recompensas de hasta **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
