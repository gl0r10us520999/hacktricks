# SMTP Smuggling

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundinformationen

Diese Art von Schwachstelle wurde [**urspr√ºnglich in diesem Beitrag entdeckt**](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/), in dem erkl√§rt wird, dass es m√∂glich ist, **Diskrepanzen in der Interpretation des SMTP-Protokolls** beim Abschluss einer E-Mail auszunutzen, was es einem Angreifer erm√∂glicht, weitere E-Mails im Text der legitimen E-Mail zu schmuggeln und andere Benutzer der betroffenen Domain (wie admin@outlook.com) zu impersonieren, indem er Verteidigungen wie SPF umgeht.

### Warum

Das liegt daran, dass im SMTP-Protokoll die **Daten der Nachricht**, die in der E-Mail gesendet werden sollen, von einem Benutzer (Angreifer) kontrolliert werden, der speziell gestaltete Daten senden k√∂nnte, die Unterschiede in den Parsern ausnutzen, die zus√§tzliche E-Mails im Empf√§nger schmuggeln. Siehe dieses illustrierte Beispiel aus dem urspr√ºnglichen Beitrag:

<figure><img src="../../.gitbook/assets/image (8) (1) (1) (1) (1).png" alt=""><figcaption><p><a href="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png">https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_12/SMTP_Smuggling-Overview__09_.png</a></p></figcaption></figure>

### Wie

Um diese Schwachstelle auszunutzen, muss ein Angreifer einige Daten senden, die der **Outbound SMTP-Server f√ºr nur 1 E-Mail h√§lt, w√§hrend der Inbound SMTP-Server denkt, dass es mehrere E-Mails gibt**.

Die Forscher entdeckten, dass verschiedene **Inbound-Server unterschiedliche Zeichen als das Ende der Daten** der E-Mail-Nachricht betrachten, die Outbound-Server nicht tun.\
Zum Beispiel ist ein regul√§res Ende der Daten `\r\n.\r`. Aber wenn der Inbound SMTP-Server auch `\n.` unterst√ºtzt, k√∂nnte ein Angreifer einfach **diese Daten in seiner E-Mail hinzuf√ºgen und beginnen, die SMTP-Befehle** neuer E-Mails anzugeben, um sie wie im vorherigen Bild zu schmuggeln.

Nat√ºrlich k√∂nnte dies nur funktionieren, wenn der **Outbound SMTP-Server diese Daten** nicht auch als das Ende der Nachrichtendaten behandelt, denn in diesem Fall w√ºrde er 2 E-Mails anstelle von nur 1 sehen, sodass dies letztendlich die Desynchronisation ist, die in dieser Schwachstelle ausgenutzt wird.

Potenzielle Desynchronisationsdaten:

* `\n.`
* `\n.\r`

Beachte auch, dass SPF umgangen wird, denn wenn du eine E-Mail von `admin@outlook.com` von einer E-Mail von `user@outlook.com` schmuggelst, **ist der Absender immer noch `outlook.com`.**

## **Referenzen**

* [https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/](https://sec-consult.com/blog/detail/smtp-smuggling-spoofing-e-mails-worldwide/)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
