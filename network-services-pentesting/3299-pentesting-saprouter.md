{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
Este √© um resumo do post de [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Entendendo a Penetra√ß√£o do SAProuter com Metasploit

O SAProuter atua como um proxy reverso para sistemas SAP, principalmente para controlar o acesso entre a internet e redes internas SAP. Ele √© comumente exposto √† internet permitindo a passagem da porta TCP 3299 atrav√©s de firewalls organizacionais. Essa configura√ß√£o torna o SAProuter um alvo atraente para pentesting, pois pode servir como um gateway para redes internas de alto valor.

**Escaneamento e Coleta de Informa√ß√µes**

Inicialmente, um escaneamento √© realizado para identificar se um SAP router est√° em execu√ß√£o em um determinado IP usando o m√≥dulo **sap_service_discovery**. Esta etapa √© crucial para estabelecer a presen√ßa de um SAP router e sua porta aberta.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Ap√≥s a descoberta, uma investiga√ß√£o adicional na configura√ß√£o do roteador SAP √© realizada com o m√≥dulo **sap_router_info_request** para potencialmente revelar detalhes da rede interna.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**Enumerando Servi√ßos Internos**

Com as informa√ß√µes obtidas da rede interna, o m√≥dulo **sap_router_portscanner** √© usado para sondar hosts e servi√ßos internos atrav√©s do SAProuter, permitindo uma compreens√£o mais profunda das redes internas e das configura√ß√µes de servi√ßos.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
A flexibilidade deste m√≥dulo em direcionar inst√¢ncias e portas SAP espec√≠ficas o torna uma ferramenta eficaz para explora√ß√£o detalhada da rede interna.

**Enumera√ß√£o Avan√ßada e Mapeamento de ACL**

A varredura adicional pode revelar como as Listas de Controle de Acesso (ACLs) est√£o configuradas no SAProuter, detalhando quais conex√µes s√£o permitidas ou bloqueadas. Esta informa√ß√£o √© fundamental para entender as pol√≠ticas de seguran√ßa e as potenciais vulnerabilidades.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**Enumera√ß√£o Cega de Hosts Internos**

Em cen√°rios onde as informa√ß√µes diretas do SAProuter s√£o limitadas, t√©cnicas como a enumera√ß√£o cega podem ser aplicadas. Essa abordagem tenta adivinhar e verificar a exist√™ncia de nomes de hosts internos, revelando potenciais alvos sem endere√ßos IP diretos.

**Aproveitando Informa√ß√µes para Pentesting**

Tendo mapeado a rede e identificado servi√ßos acess√≠veis, os testadores de penetra√ß√£o podem utilizar as capacidades de proxy do Metasploit para pivotar atrav√©s do SAProuter para uma explora√ß√£o e explora√ß√£o adicionais de servi√ßos SAP internos.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Conclus√£o**

Esta abordagem destaca a import√¢ncia de configura√ß√µes seguras do SAProuter e ressalta o potencial de acesso a redes internas por meio de testes de penetra√ß√£o direcionados. Proteger adequadamente os roteadores SAP e entender seu papel na arquitetura de seguran√ßa da rede √© crucial para proteger contra acessos n√£o autorizados.

Para informa√ß√µes mais detalhadas sobre m√≥dulos do Metasploit e seu uso, visite [o banco de dados da Rapid7](http://www.rapid7.com/db).

## **Refer√™ncias**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
