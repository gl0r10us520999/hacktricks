{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
```text
PORT     STATE SERVICE    VERSION
3299/tcp open  saprouter?
```
Ceci est un r√©sum√© du post de [https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/](https://blog.rapid7.com/2014/01/09/piercing-saprouter-with-metasploit/)

## Comprendre la p√©n√©tration de SAProuter avec Metasploit

SAProuter agit comme un proxy inverse pour les syst√®mes SAP, principalement pour contr√¥ler l'acc√®s entre Internet et les r√©seaux SAP internes. Il est couramment expos√© √† Internet en permettant le port TCP 3299 √† travers les pare-feu organisationnels. Cette configuration rend SAProuter une cible attrayante pour le pentesting car elle peut servir de passerelle vers des r√©seaux internes de grande valeur.

**Analyse et collecte d'informations**

Initialement, un scan est effectu√© pour identifier si un routeur SAP fonctionne sur une IP donn√©e en utilisant le module **sap_service_discovery**. Cette √©tape est cruciale pour √©tablir la pr√©sence d'un routeur SAP et de son port ouvert.
```text
msf> use auxiliary/scanner/sap/sap_service_discovery
msf auxiliary(sap_service_discovery) > set RHOSTS 1.2.3.101
msf auxiliary(sap_service_discovery) > run
```
Suite √† la d√©couverte, une enqu√™te plus approfondie sur la configuration du routeur SAP est effectu√©e avec le module **sap_router_info_request** pour potentiellement r√©v√©ler des d√©tails sur le r√©seau interne.
```text
msf auxiliary(sap_router_info_request) > use auxiliary/scanner/sap/sap_router_info_request
msf auxiliary(sap_router_info_request) > set RHOSTS 1.2.3.101
msf auxiliary(sap_router_info_request) > run
```
**√ânum√©ration des services internes**

Avec les informations obtenues sur le r√©seau interne, le module **sap_router_portscanner** est utilis√© pour sonder les h√¥tes et services internes via le SAProuter, permettant une compr√©hension plus approfondie des r√©seaux internes et des configurations de services.
```text
msf auxiliary(sap_router_portscanner) > set INSTANCES 00-50
msf auxiliary(sap_router_portscanner) > set PORTS 32NN
```
La flexibilit√© de ce module √† cibler des instances SAP sp√©cifiques et des ports en fait un outil efficace pour une exploration d√©taill√©e du r√©seau interne.

**√ânum√©ration Avanc√©e et Cartographie des ACL**

Un scan suppl√©mentaire peut r√©v√©ler comment les Listes de Contr√¥le d'Acc√®s (ACL) sont configur√©es sur le SAProuter, d√©taillant quelles connexions sont autoris√©es ou bloqu√©es. Cette information est essentielle pour comprendre les politiques de s√©curit√© et les vuln√©rabilit√©s potentielles.
```text
msf auxiliary(sap_router_portscanner) > set MODE TCP
msf auxiliary(sap_router_portscanner) > set PORTS 80,32NN
```
**√ânum√©ration √† l'aveugle des h√¥tes internes**

Dans les sc√©narios o√π les informations directes du SAProuter sont limit√©es, des techniques comme l'√©num√©ration √† l'aveugle peuvent √™tre appliqu√©es. Cette approche tente de deviner et de v√©rifier l'existence de noms d'h√¥tes internes, r√©v√©lant des cibles potentielles sans adresses IP directes.

**Exploitation des informations pour le pentesting**

Apr√®s avoir cartographi√© le r√©seau et identifi√© les services accessibles, les testeurs de p√©n√©tration peuvent utiliser les capacit√©s de proxy de Metasploit pour pivoter √† travers le SAProuter pour une exploration et une exploitation suppl√©mentaires des services SAP internes.
```text
msf auxiliary(sap_hostctrl_getcomputersystem) > set Proxies sapni:1.2.3.101:3299
msf auxiliary(sap_hostctrl_getcomputersystem) > set RHOSTS 192.168.1.18
msf auxiliary(sap_hostctrl_getcomputersystem) > run
```
**Conclusion**

Cette approche souligne l'importance des configurations s√©curis√©es de SAProuter et met en √©vidence le potentiel d'acc√®s aux r√©seaux internes gr√¢ce √† des tests de p√©n√©tration cibl√©s. S√©curiser correctement les routeurs SAP et comprendre leur r√¥le dans l'architecture de s√©curit√© r√©seau est crucial pour se prot√©ger contre les acc√®s non autoris√©s.

Pour des informations plus d√©taill√©es sur les modules Metasploit et leur utilisation, visitez [la base de donn√©es de Rapid7](http://www.rapid7.com/db).

## **References**

* [https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/](https://www.rapid7.com/blog/post/2014/01/09/piercing-saprouter-with-metasploit/)

## Shodan

* `port:3299 !HTTP Network packet too big`



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
