# 3260 - Pentesting ISCSI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

From [Wikipedia](https://en.wikipedia.org/wiki/ISCSI):

> In computing, **iSCSI**ã¯**Internet Small Computer Systems Interface**ã®ç•¥ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ–½è¨­ã‚’ãƒªãƒ³ã‚¯ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆIPï¼‰ãƒ™ãƒ¼ã‚¹ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°æ¨™æº–ã§ã™ã€‚ã“ã‚Œã¯ã€TCP/IPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§SCSIã‚³ãƒãƒ³ãƒ‰ã‚’é‹ã¶ã“ã¨ã«ã‚ˆã£ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒã‚¤ã‚¹ã¸ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚iSCSIã¯ã€ã‚¤ãƒ³ãƒˆãƒ©ãƒãƒƒãƒˆä¸Šã§ã®ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚’ä¿ƒé€²ã—ã€é•·è·é›¢ã«ã‚ãŸã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç®¡ç†ã‚’è¡Œã†ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒªã‚¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆLANï¼‰ã€åºƒåŸŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆWANï¼‰ã€ã¾ãŸã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ä»‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã€å ´æ‰€ã«ä¾å­˜ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨å–å¾—ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
>
> ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã‚¤ãƒ‹ã‚·ã‚¨ãƒ¼ã‚¿ãƒ¼ã¨å‘¼ã°ã‚Œã‚‹ï¼‰ãŒãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãƒ¼ä¸Šã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒã‚¤ã‚¹ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰ã«SCSIã‚³ãƒãƒ³ãƒ‰ï¼ˆCDBï¼‰ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆSANï¼‰ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ã‚Šã€çµ„ç¹”ãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ãƒ¬ã‚¤ã«çµ±åˆã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ãªã©ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ­ãƒ¼ã‚«ãƒ«ã«æ¥ç¶šã•ã‚ŒãŸSCSIãƒ‡ã‚£ã‚¹ã‚¯ã®å¹»æƒ³ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã¯ä¸»ã«ãƒ•ã‚¡ã‚¤ãƒãƒ¼ãƒãƒ£ãƒãƒ«ã¨ç«¶åˆã—ã¾ã™ãŒã€é€šå¸¸å°‚ç”¨ã®ã‚±ãƒ¼ãƒ–ãƒ«ã‚’å¿…è¦ã¨ã™ã‚‹å¾“æ¥ã®ãƒ•ã‚¡ã‚¤ãƒãƒ¼ãƒãƒ£ãƒãƒ«ã¨ã¯ç•°ãªã‚Šã€iSCSIã¯æ—¢å­˜ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’ä½¿ç”¨ã—ã¦é•·è·é›¢ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆ:** 3260
```
PORT     STATE SERVICE VERSION
3260/tcp open  iscsi?
```
## åˆ—æŒ™
```
nmap -sV --script=iscsi-info -p 3260 192.168.xx.xx
```
ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€èªè¨¼ãŒå¿…è¦ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚

### [ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹](../generic-methodologies-and-resources/brute-force.md#iscsi)

### [Linuxã§ISCSIã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How\_to\_set\_up\_and\_use\_iSCSI\_target\_on\_Linux)

**æ³¨æ„:** ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒç™ºè¦‹ã•ã‚Œã‚‹ã¨ã€ç•°ãªã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸‹ã«ãƒªã‚¹ãƒˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€iSCSIã‚µãƒ¼ãƒ“ã‚¹ãŒNATã¾ãŸã¯ä»®æƒ³IPã‚’ä»‹ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ç™ºç”Ÿã™ã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå ´åˆã€`iscsiadmin`ã¯æ¥ç¶šã«å¤±æ•—ã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ç™ºè¦‹æ´»å‹•ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«ä½œæˆã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¨ã€ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«å«ã¾ã‚Œã‚‹`default`ãƒ•ã‚¡ã‚¤ãƒ«ã®2ã¤ã®èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚

ä¾‹ãˆã°ã€ãƒãƒ¼ãƒˆ3260ã§123.123.123.123ã®iSCSIã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«æ¥ç¶šã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚iSCSIã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å…¬é–‹ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ã¯å®Ÿéš›ã«ã¯192.168.1.2ã§ã™ãŒã€NATã‚’ä»‹ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚isciadmã¯ã€_å…¬é–‹_ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã¯ãªãã€_å†…éƒ¨_ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[...]
```
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«æ¬¡ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™:
```
/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/
```
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«æ¥ç¶šã™ã‚‹ãŸã‚ã«å¿…è¦ãªã™ã¹ã¦ã®è¨­å®šãŒå«ã¾ã‚ŒãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚

1. `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/` ã®åå‰ã‚’ `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/` ã«å¤‰æ›´ã—ã¾ã™ã€‚
2. `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default` å†…ã§ã€`node.conn[0].address` è¨­å®šã‚’192.168.1.2ã®ä»£ã‚ã‚Šã«123.123.123.123ã‚’æŒ‡ã™ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€æ¬¡ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ï¼š`sed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`

ãƒªãƒ³ã‚¯ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ãƒã‚¦ãƒ³ãƒˆã§ãã¾ã™ã€‚

### [Windowsã§ISCSIã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476\(v=ws.10\)?redirectedfrom=MSDN)

## **æ‰‹å‹•åˆ—æŒ™**
```bash
sudo apt-get install open-iscsi
```
Example from [iscsiadm docs](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm):

ã¾ãšæœ€åˆã«ã€IPã®èƒŒå¾Œã«ã‚ã‚‹**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**ã®åå‰ã‚’**ç™ºè¦‹ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382
[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382
```
_Note that it will show the I**P and port of the interfaces** where you can **reach** those **targets**. It can even **show internal IPs or different IPs** from the one you used._

ãã®å¾Œã€å„è¡Œã®å°åˆ·ã•ã‚ŒãŸæ–‡å­—åˆ—ã®**2ç•ªç›®ã®éƒ¨åˆ†ã‚’ã‚­ãƒ£ãƒƒãƒ**ã—ã¾ã™ï¼ˆæœ€åˆã®è¡Œã‹ã‚‰ã®_iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_ï¼‰ãã—ã¦**ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã¾ã™**:
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --login
Logging in to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] (multiple)
Login to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ãã®å¾Œã€`â€“logout`ã‚’ä½¿ç”¨ã—ã¦**logout**ã§ãã¾ã™ã€‚
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --logout
Logging out of session [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260]
Logout of [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
ç§ãŸã¡ã¯**ã‚ˆã‚Šå¤šãã®æƒ…å ±**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€**ãªã—**ã§`--login`/`--logout`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã ã‘ã§
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260
# BEGIN RECORD 2.0-873
node.name = iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
node.tpgt = 1
node.startup = manual
node.leading_login = No
iface.hwaddress = <empty>
iface.ipaddress = <empty>
iface.iscsi_ifacename = default
iface.net_ifacename = <empty>
iface.transport_name = tcp
iface.initiatorname = <empty>
iface.bootproto = <empty>
iface.subnet_mask = <empty>
iface.gateway = <empty>
iface.ipv6_autocfg = <empty>
iface.linklocal_autocfg = <empty>
iface.router_autocfg = <empty>
iface.ipv6_linklocal = <empty>
iface.ipv6_router = <empty>
iface.state = <empty>
iface.vlan_id = 0
iface.vlan_priority = 0
iface.vlan_state = <empty>
iface.iface_num = 0
iface.mtu = 0
iface.port = 0
node.discovery_address = 192.168.xx.xx
node.discovery_port = 3260
node.discovery_type = send_targets
node.session.initial_cmdsn = 0
node.session.initial_login_retry_max = 8
node.session.xmit_thread_priority = -20
node.session.cmds_max = 128
node.session.queue_depth = 32
node.session.nr_sessions = 1
node.session.auth.authmethod = None
node.session.auth.username = <empty>
node.session.auth.password = <empty>
node.session.auth.username_in = <empty>
node.session.auth.password_in = <empty>
node.session.timeo.replacement_timeout = 120
node.session.err_timeo.abort_timeout = 15
node.session.err_timeo.lu_reset_timeout = 30
node.session.err_timeo.tgt_reset_timeout = 30
node.session.err_timeo.host_reset_timeout = 60
node.session.iscsi.FastAbort = Yes
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
node.session.iscsi.FirstBurstLength = 262144
node.session.iscsi.MaxBurstLength = 16776192
node.session.iscsi.DefaultTime2Retain = 0
node.session.iscsi.DefaultTime2Wait = 2
node.session.iscsi.MaxConnections = 1
node.session.iscsi.MaxOutstandingR2T = 1
node.session.iscsi.ERL = 0
node.conn[0].address = 192.168.xx.xx
node.conn[0].port = 3260
node.conn[0].startup = manual
node.conn[0].tcp.window_size = 524288
node.conn[0].tcp.type_of_service = 0
node.conn[0].timeo.logout_timeout = 15
node.conn[0].timeo.login_timeout = 15
node.conn[0].timeo.auth_timeout = 45
node.conn[0].timeo.noop_out_interval = 5
node.conn[0].timeo.noop_out_timeout = 5
node.conn[0].iscsi.MaxXmitDataSegmentLength = 0
node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144
node.conn[0].iscsi.HeaderDigest = None
node.conn[0].iscsi.DataDigest = None
node.conn[0].iscsi.IFMarker = No
node.conn[0].iscsi.OFMarker = No
# END RECORD
```
**åŸºæœ¬çš„ãªã‚µãƒ–ãƒãƒƒãƒˆåˆ—æŒ™ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯** [**iscsiadm**](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability\_Analysis/isciadm) **ã§å…¥æ‰‹å¯èƒ½ã§ã™ã€‚**

## **Shodan**

* `port:3260 AuthMethod`

## **å‚è€ƒæ–‡çŒ®**

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
