# 3260 - Pentesting ISCSI

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>!HackTricks</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Basic Information

From [Wikipedia](https://en.wikipedia.org/wiki/ISCSI):

> In computing, **iSCSI** is an acronym for **Internet Small Computer Systems Interface**, an Internet Protocol (IP)-based storage networking standard for linking data storage facilities. It provides block-level access to storage devices by carrying SCSI commands over a TCP/IP network. iSCSI is used to facilitate data transfers over intranets and to manage storage over long distances. It can be used to transmit data over local area networks (LANs), wide area networks (WANs), or the Internet and can enable location-independent data storage and retrieval.
>
> The protocol allows clients (called initiators) to send SCSI commands (CDBs) to storage devices (targets) on remote servers. It is a storage area network (SAN) protocol, allowing organizations to consolidate storage into storage arrays while providing clients (such as database and web servers) with the illusion of locally attached SCSI disks. It mainly competes with Fibre Channel, but unlike traditional Fibre Channel which usually requires dedicated cabling, iSCSI can be run over long distances using existing network infrastructure.

**Default port:** 3260
```
PORT     STATE SERVICE VERSION
3260/tcp open  iscsi?
```
## Enumeration

### Service Discovery

#### iSCSI Discovery

iSCSI discovery is the process of identifying iSCSI targets on a network. This can be done using the `iscsiadm` command-line tool. The following command can be used to discover iSCSI targets:

```plaintext
iscsiadm -m discovery -t sendtargets -p <target_ip>
```

Replace `<target_ip>` with the IP address of the target system.

#### iSCSI Target Enumeration

Once the iSCSI targets have been discovered, the next step is to enumerate the available targets. This can be done using the `iscsiadm` command-line tool as well. The following command can be used to enumerate the iSCSI targets:

```plaintext
iscsiadm -m node -l
```

This command will list all the available iSCSI targets.

### Banner Grabbing

Banner grabbing is the process of retrieving information from network services banners. This can be done using tools like `telnet` or `nc` (netcat). The following command can be used to grab the banner of an iSCSI target:

```plaintext
telnet <target_ip> <port>
```

Replace `<target_ip>` with the IP address of the target system and `<port>` with the port number of the iSCSI service (default is 3260).

### Port Scanning

Port scanning is the process of scanning a target system for open ports. This can be done using tools like `nmap`. The following command can be used to scan for open ports on a target system:

```plaintext
nmap -p <port> <target_ip>
```

Replace `<port>` with the port number to scan and `<target_ip>` with the IP address of the target system.

### SNMP Enumeration

Simple Network Management Protocol (SNMP) enumeration is the process of gathering information from SNMP-enabled devices. This can be done using tools like `snmpwalk` or `snmpenum`. The following command can be used to enumerate SNMP information:

```plaintext
snmpwalk -c public -v1 <target_ip>
```

Replace `<target_ip>` with the IP address of the target system.
```
nmap -sV --script=iscsi-info -p 3260 192.168.xx.xx
```
**ghItlh:** qar'a'wI' jatlh authentication lo'laHbe'chugh.

### [Brute force](../generic-methodologies-and-resources/brute-force.md#iscsi)

### [Mount ISCSI on Linux](https://www.synology.com/en-us/knowledgebase/DSM/tutorial/Virtualization/How\_to\_set\_up\_and\_use\_iSCSI\_target\_on\_Linux)

**ghItlh:** targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI' targhpu'wI'wI'
```
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
192.168.1.2:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[...]
```
**Klingon Translation:**

**This command will create a directory in your filesystem like this:**

**Klingon Translation:**

**tlhIngan Hol:**

**'ejDI' vItlhutlh. HochDI' vItlhutlh.**

**Markdown Syntax:**

```
**tlhIngan Hol:**

**'ejDI' vItlhutlh. HochDI' vItlhutlh.**
```

**HTML Syntax:**

```html
<strong>tlhIngan Hol:</strong>

<strong>'ejDI' vItlhutlh. HochDI' vItlhutlh.</strong>
```
```
/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/
```
### [Mount ISCSI on Windows](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee338476\(v=ws.10\)?redirectedfrom=MSDN)

## **Manual enumeration**

1. Rename `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/192.168.1.2\,3260\,1/` to `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/`
2. Within `/etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`, change the `node.conn[0].address` setting to point to 123.123.123.123 instead of 192.168.1.2. This could be done with a command such as `sed -i 's/192.168.1.2/123.123.123.123/g' /etc/iscsi/nodes/iqn.1992-05.com.emc:fl1001433000190000-3-vnxe/123.123.123.123\,3260\,1/default`

You may now mount the target as per the instructions in the link.
```bash
sudo apt-get install open-iscsi
```
Example from [iscsiadm docs](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm):

**QaStaHvIS** **mIw** **tlhap** **ghItlh** **IP** **Daq** **Dochmey** **ghItlh** **tlhIngan** **ghItlh** **DIvI':**
```bash
iscsiadm -m discovery -t sendtargets -p 123.123.123.123:3260
123.123.123.123:3260,1 iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
[2a01:211:7b7:1223:211:32ff:fea9:fab9]:3260,1 iqn.2000-01.com.synology:asd3.Target-1.d0280fd382
[fe80::211:3232:fab9:1223]:3260,1 iqn.2000-01.com.synology:Oassdx.Target-1.d0280fd382
```
_Note that it will show the I**P and port of the interfaces** where you can **reach** those **targets**. It can even **show internal IPs or different IPs** from the one you used._

Then you **catch the 2nd part of the printed string of each line** (_iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_ from the first line) and **try to login**:

---

_Note that it will show the I**P and port of the interfaces** where you can **reach** those **targets**. It can even **show internal IPs or different IPs** from the one you used._

Then you **catch the 2nd part of the printed string of each line** (_iqn.1992-05.com.emc:fl1001433000190000-3-vnxe_ from the first line) and **try to login**:
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --login
Logging in to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] (multiple)
Login to [iface: default, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
**Qapla'**. **logout** vItlhutlh `‚Äìlogout` lo'laHbe'.
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260 --logout
Logging out of session [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260]
Logout of [sid: 6, target: iqn.1992-05.com.emc:fl1001433000190000-3-vnxe, portal: 123.123.123.123,3260] successful.
```
**QawmoH** **chel** **ghItlh** **vItlhutlh** **--login**/**--logout** **lo'laH** **ghItlhutlh** **ghaH** **vItlhutlh** **'e'** **vItlhutlh** **ghaH** **vItlhutlh** **'e'**
```bash
iscsiadm -m node --targetname="iqn.1992-05.com.emc:fl1001433000190000-3-vnxe" -p 123.123.123.123:3260
# BEGIN RECORD 2.0-873
node.name = iqn.1992-05.com.emc:fl1001433000190000-3-vnxe
node.tpgt = 1
node.startup = manual
node.leading_login = No
iface.hwaddress = <empty>
iface.ipaddress = <empty>
iface.iscsi_ifacename = default
iface.net_ifacename = <empty>
iface.transport_name = tcp
iface.initiatorname = <empty>
iface.bootproto = <empty>
iface.subnet_mask = <empty>
iface.gateway = <empty>
iface.ipv6_autocfg = <empty>
iface.linklocal_autocfg = <empty>
iface.router_autocfg = <empty>
iface.ipv6_linklocal = <empty>
iface.ipv6_router = <empty>
iface.state = <empty>
iface.vlan_id = 0
iface.vlan_priority = 0
iface.vlan_state = <empty>
iface.iface_num = 0
iface.mtu = 0
iface.port = 0
node.discovery_address = 192.168.xx.xx
node.discovery_port = 3260
node.discovery_type = send_targets
node.session.initial_cmdsn = 0
node.session.initial_login_retry_max = 8
node.session.xmit_thread_priority = -20
node.session.cmds_max = 128
node.session.queue_depth = 32
node.session.nr_sessions = 1
node.session.auth.authmethod = None
node.session.auth.username = <empty>
node.session.auth.password = <empty>
node.session.auth.username_in = <empty>
node.session.auth.password_in = <empty>
node.session.timeo.replacement_timeout = 120
node.session.err_timeo.abort_timeout = 15
node.session.err_timeo.lu_reset_timeout = 30
node.session.err_timeo.tgt_reset_timeout = 30
node.session.err_timeo.host_reset_timeout = 60
node.session.iscsi.FastAbort = Yes
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
node.session.iscsi.FirstBurstLength = 262144
node.session.iscsi.MaxBurstLength = 16776192
node.session.iscsi.DefaultTime2Retain = 0
node.session.iscsi.DefaultTime2Wait = 2
node.session.iscsi.MaxConnections = 1
node.session.iscsi.MaxOutstandingR2T = 1
node.session.iscsi.ERL = 0
node.conn[0].address = 192.168.xx.xx
node.conn[0].port = 3260
node.conn[0].startup = manual
node.conn[0].tcp.window_size = 524288
node.conn[0].tcp.type_of_service = 0
node.conn[0].timeo.logout_timeout = 15
node.conn[0].timeo.login_timeout = 15
node.conn[0].timeo.auth_timeout = 45
node.conn[0].timeo.noop_out_interval = 5
node.conn[0].timeo.noop_out_timeout = 5
node.conn[0].iscsi.MaxXmitDataSegmentLength = 0
node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144
node.conn[0].iscsi.HeaderDigest = None
node.conn[0].iscsi.DataDigest = None
node.conn[0].iscsi.IFMarker = No
node.conn[0].iscsi.OFMarker = No
# END RECORD
```
**ghItlh script automate basic subnet enumeration process available at** [**iscsiadm**](https://github.com/bitvijays/Pentest-Scripts/tree/master/Vulnerability\_Analysis/isciadm)

## **Shodan**

* `port:3260 AuthMethod`

## **References**

* [https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html](https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html)
* [https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm](https://ptestmethod.readthedocs.io/en/latest/LFF-IPS-P2-VulnerabilityAnalysis.html#iscsiadm)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
