<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をチェックしてください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加するか**、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローしてください。**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>


# コンテンツオーバーレイ

印刷物の外観を操作する簡単な方法の一つは、オーバーレイを**使用する**ことです。\
[**PCL**](./#pcl)には、ドキュメントの上に**オーバーレイマクロ**を置くための文書化された機能があります。残念ながら、この機能は**現在の印刷ジョブに限定されており**、永続的にすることはできません。\
[**PostScript**](./#postscript-ps)はデフォルトではそのような機能を提供していませんが、現在のページを印刷するために含まれているshowpageオペレータを**再定義する**ことでプログラムすることができます。攻撃者はそこに**フック**して、自分のコードを実行し、その後オペレータの元のバージョンを呼び出すことができます。\
したがって、彼女は印刷されるすべてのページにカスタムEPSファイルをオーバーレイすることができます。このハックは、ドキュメントのハードコピーに**任意のグラフィックやフォントを追加する**ために使用できます（白紙のページをオーバーレイしてからカスタムコンテンツを追加することで、ドキュメントの外観を完全に変更することが可能です）。\
明らかに、このようなアプローチが成功するためには、プリンタドライバとしてPostScriptが使用されており、`StartJobPassword`が設定されていない場合に限ります。

![](http://hacking-printers.net/wiki/images/thumb/9/93/Overlay.jpg/300px-Overlay.jpg)

**この攻撃をテストする方法は？**

psモードで[**PRET**](https://github.com/RUB-NDS/PRET)の`cross`または`overlay`コマンドを使用し、切断してから任意のドキュメントを印刷します。
```
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> overlay overlays/smiley.eps
printer:/> cross whoa "HACKED"
printer:/> exit
```
# コンテンツの置換

攻撃者が既存のドキュメントの上にオーバーレイを配置できたとしても、元のドキュメントの正確な構造がわからない限り、**特定の値を変更する**ことはできません。時にはカスタムコンテンツを追加するだけでなく、既存のドキュメントの一部を**解析して置換**したい場合もあります。\
PostScriptファイル内のテキストを置換する問題は、レンダリングされたドキュメントから**文字列を抽出する問題**に帰着されます。これは簡単ではありません。なぜなら、文字列はPostScriptプログラム自体によって動的に構築される可能性があるからです。したがって、ドキュメントのソースコード内で単純な解析と置換を行うことは選択肢になりません。\
**再定義された`show`オペレーター**を使用することができます。showオペレーターは、現在のページの特定の位置に描画される文字列を入力として受け取ります。オペレーターを再定義することで、**テキスト**をエレガントに**抽出**することができます。このアプローチは、文字列が**描画される直前**に、ターゲットを絞った**検索と置換**にも使用できます。\
このアプローチは、プリンターに直接送信される**LaTeX**ベースのPostScriptドキュメントに対しては**成功**しますが、文字列の代わりにその表現の**ラスターグラフィックスを生成する** **GIMP**によって生成されたPostScriptファイルでは**失敗**します。CUPSによって処理された場合、PostScript自体を含むあらゆるドキュメントフォーマットでも同じ問題が発生します。理論的には、このような言語構造も解析されるべきであり、さらなる研究の対象となるべきです。

**この攻撃をテストする方法は？**

[**PRET**](https://github.com/RUB-NDS/PRET)のpsモードで`replace`コマンドを使用し、次に切断して「DEF」という文字を含むPostScriptドキュメントを印刷します：
```
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> replace "ABC" "DEF"
printer:/> exit
```
<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>
