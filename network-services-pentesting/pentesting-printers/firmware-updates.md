```markdown
<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Les dangers des mises √† jour de firmware malveillantes sont bien connus et ont √©t√© discut√©s pr√©c√©demment par [\[1\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-1) et [\[2\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-2). Contrairement √† d'autres appareils en r√©seau, **il est courant pour les imprimantes de d√©ployer des mises √† jour de firmware comme des travaux d'impression ordinaires**. Cela ouvre une large porte aux attaquants car l'acc√®s aux fonctionnalit√©s d'impression est g√©n√©ralement un faible obstacle. On ne peut que sp√©culer sur la motivation de telles d√©cisions de conception peu s√©curis√©es, mais il semble logique que des raisons historiques jouent un r√¥le : les imprimantes √©taient autrefois connect√©es par c√¢ble parall√®le ou USB. Sans connectivit√© r√©seau, la s√©curit√© √©tait moins importante et sans serveur web prot√©g√© par mot de passe ou fonctionnalit√© similaire, le canal d'impression √©tait le seul moyen d'envoyer des donn√©es √† l'appareil.

Des attaques de modification de firmware contre des imprimantes en r√©seau ont √©t√© d√©montr√©es par [\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3) pour les appareils HP, par [\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4) pour la s√©rie Canon PIXMA et par [\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5) et [\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6) pour divers mod√®les Xerox. Comme contre-mesure, les fabricants d'imprimantes ont commenc√© √† signer num√©riquement leur firmware [\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7).

## Fabricants

Pour donner un aper√ßu des proc√©dures de d√©ploiement de firmware, 1 400 fichiers de firmware pour les 10 principaux fabricants d'imprimantes ont √©t√© t√©l√©charg√©s et syst√©matiquement cat√©goris√©s par [\[8\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-8). Les r√©sultats sont les suivants.

### HP

Le firmware peut √™tre t√©l√©charg√© depuis [support.hp.com](http://support.hp.com/) ou directement depuis [ftp.hp.com](ftp://ftp.hp.com/pub/networking/software/pfirmware/) via FTP. 419 fichiers au format traditionnel de mise √† jour de firmware √† distance HP \(`.rfu`\) et 206 binaires ‚ÄòHP FutureSmart‚Äô plus r√©cents \(`.bdl`\) peuvent √™tre r√©cup√©r√©s. Les fichiers `.rfu` contiennent des commandes PJL propri√©taires comme `@PJL UPGRADE SIZE=‚Ä¶`, indiquant que les mises √† jour de firmware sont d√©ploy√©es comme des travaux d'impression normaux. Cela a √©t√© d√©montr√© par [\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3) et a conduit HP √† signer num√©riquement tout leur firmware d'imprimante depuis mars 2012 [\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7).

### Canon

Le firmware est disponible sur [www.canon.com/support](http://www.canon.com/support/). Cependant, Canon exige un num√©ro de s√©rie d'appareil valide pour t√©l√©charger un firmware. Selon [\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4), qui ont pu modifier le firmware pour la s√©rie Canon PIXMA, ‚Äòil n'y a pas de signature (la bonne mani√®re de faire) mais il a une tr√®s faible encryption‚Äô. Selon une correspondance par courriel avec un repr√©sentant du support technique de Canon, ‚Äòle firmware doit √™tre sign√© num√©riquement par Canon pour qu'il soit accept√© par l'imprimante‚Äô.

### Epson

Le firmware peut √™tre t√©l√©charg√© depuis [epson.com](http://epson.com/) et via FTP depuis [download.epson-europe.com](ftp://download.epson-europe.com/). Les fichiers se pr√©sentent sous forme de fichiers auto-extractibles WinZip `.exe` et peuvent √™tre d√©compress√©s en utilisant unp[\[9\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-9). Les fichiers `.efu` contenus peuvent √™tre analys√©s en utilisant Binwalk[\[10\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-10) qui extrait le firmware r√©el. On peut obtenir 49 fichiers `.rcx` de format inconnu \(‚ÄòSEIKO EPSON EpsonNet Form‚Äô\) et neuf fichiers `.prn` contenant des commandes PJL \(`@PJL ENTER LANGUAGE=DOWNLOAD`\). Epson n'a publi√© aucune information sur les m√©canismes de protection. Le firmware publi√© avant 2016 n'appliquait pas de signature de code et pouvait √™tre manipul√© comme le montre [\[11\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-11). Ils ‚Äòcroient que d'√©normes quantit√©s d'appareils produits depuis 1999 \[‚Ä¶\] pourraient √™tre vuln√©rables‚Äô.

### Dell

Le firmware peut √™tre obtenu depuis [downloads.dell.com](http://downloads.dell.com/) et depuis [ftp.us.dell.com/printer](ftp://ftp.us.dell.com/printer). Les fichiers peuvent √™tre d√©compress√©s en utilisant unp et les fichiers `.zip` inclus peuvent √™tre extraits avec une variante de unzip. Dell ne produit aucun appareil d'impression, mais rebadge les produits d'autres fabricants. Par cons√©quent, une grande vari√©t√© de fichiers de firmware, incluant 18 fichiers `.hd` contenant `@PJL FIRMWARE=‚Ä¶`, 25 fichiers `.prn` contenant `@PJL ENTER LANGUAGE=DOWNLOAD` et 30 fichiers `.fls`/`.fly` contenant `@PJL LPROGRAMRIP` ont √©t√© trouv√©s. Concernant les m√©canismes de protection, Dell n'a publi√© aucune information disponible publiquement.

### Brother

Le firmware ne peut pas √™tre facilement t√©l√©charg√©. Au lieu de cela, un binaire Windows doit √™tre ex√©cut√© qui v√©rifie les imprimantes disponibles et demande des liens de t√©l√©chargement pour le dernier firmware √† partir d'un service web. En devinant les bons param√®tres, on est capable d'obtenir les liens pour 98 fichiers. Les fichiers de firmware ne doivent pas √™tre d√©compress√©s car ils sont d√©j√† au format brut. 79 fichiers ont l'extension `.djf` et contiennent `@PJL EXECUTE BRDOWNLOAD`, tandis que 9 fichiers `.blf` contiennent `@PJL ENTER LANGUAGE=PCL`. Brother n'a publi√© aucune information disponible publiquement sur les m√©canismes de protection.

### Lexmark

Le firmware est disponible sur [support.lexmark.com](http://support.lexmark.com/) et peut √™tre d√©compress√© en utilisant unp. 63 fichiers `fls` ont pu √™tre obtenus contenant l'en-t√™te PJL `@PJL LPROGRAMRIP` pour installer le firmware. Le livre blanc sur la s√©curit√© de Lexmark affirme que ‚Äòles paquets doivent √™tre crypt√©s avec un algorithme de cryptage sym√©trique via une cl√© qui est connue uniquement de Lexmark et est int√©gr√©e de mani√®re s√©curis√©e dans tous les appareils. Cependant, la mesure de s√©curit√© la plus forte vient du fait que tous les paquets de firmware doivent inclure plusieurs signatures num√©riques RSA 2048 bits de Lexmark. Si ces signatures ne sont pas valides \[...\] le firmware est rejet√©‚Äô [\[12\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-12).

### Samsung

Le firmware peut √™tre t√©l√©charg√© depuis [www.samsung.com/us/support/download](http://www.samsung.com/us/support/download). Les fichiers r√©cup√©r√©s viennent soit sous forme d'archives zip, soit d'ex√©cutables Windows qui peuvent √™tre ex√©cut√©s dans wine et d√©compress√©s en utilisant unp. De cette mani√®re, 33 fichiers `.hd` commen√ßant par `@PJL FIRMWARE` et des fichiers `.prn` associ√©s contenant `@PJL DEFAULT SWUPGRADE=ON` ont pu √™tre obtenus. Samsung n'a publi√© aucune information disponible publiquement sur les m√©canismes de protection.

### Xerox

Le firmware est disponible publiquement sur [www.support.xerox.com](http://www.support.xerox.com/). Les fichiers t√©l√©charg√©s sont au format zip et peuvent √™tre d√©compress√©s en utilisant unzip. Les fichiers de firmware sont dans diff√©rents formats : 16 fichiers `.hd` incluant `@PJL FIRMWARE=‚Ä¶`, 36 fichiers PostScript pour les appareils plus anciens et 35 fichiers `.dlm` qui est le format utilis√© actuellement par Xerox et inclut des signatures num√©riques. Un d√©faut dans le processus de d√©ploiement cependant a √©t√© trouv√© par [\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5) et √©tendu par [\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6), menant √† une ex√©cution de code √† distance ‚Äì la cl√© priv√©e et l'outil utilis√© pour la signature de code √©taient contenus dans le firmware lui-m√™me.

### Ricoh

Le ‚ÄòCentre de T√©l√©chargement de Firmware‚Äô sur [support.ricoh.com](https://support.ricoh.com/) n'est pas ouvert au grand public. Heureusement, l'interweb contient des liens directs vers quelques pages de t√©l√©chargement de pilotes/firmware, donc on est capable d'obtenir 31 fichiers de firmware en utilisant une simple recherche Google \(`site:support.ricoh.com firmware`\). Les fichiers peuvent √™tre d√©compress√©s en utilisant unp. 14 fichiers `.bin` contiennent `@PJL RSYSTEMUPDATE SIZE=‚Ä¶` tandis que 15 fichiers `.brn` sont associ√©s √† un `settings.ini`, incluant `@PJL FWDOWNLOAD` et `USERID=sysadm, PASSWORD=sysadm`. Ricoh ne fournit aucune information √† jour sur les m√©canismes de protection. Dans un livre blanc datant de 2007, Ricoh affirme que ‚Äòseuls les techniciens de service ont un mot de passe et un compte d√©di√© pour effectuer des mises √† jour de firmware‚Äô [\[13\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-13).

### Kyocera

Kyocera ne publie pas de firmware pour les utilisateurs finaux. Cependant, dans un forum de revendeurs Kyocera disponible publiquement, des t√©l√©chargements de firmware pour divers mod√®les sont li√©s : [ftp.kdaconnect.com](ftp://ftp.kdaconnect.com/). Les fichiers peuvent √™tre d√©compress√©s en utilisant unp et contiennent des images cramfs[\[14\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-14) et squashfs[\[15\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-15) montables ainsi que des formats binaires propri√©taires. Le firmware est d√©ploy√© comme un travail d'impression avec `!R! UPGR'SYS';EXIT;` pr√©fix√© ‚Äì la commande de mise √† niveau du langage de description de page PRESCRIBE [\[16\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-16). Kyocera n'a publi√© aucune information disponible publiquement sur les m√©canismes de protection.

### Konica

Bien que non activement promu, le firmware pour les imprimantes Konica Minolta peut √™tre t√©l√©charg√© depuis [download6.konicaminolta.eu](http://download6.konicaminolta.eu/). Les appareils connect√©s √† Internet plus r√©cents ont la capacit√© d'effectuer des mises √† jour de firmware eux-m√™mes. Les fichiers compress√©s viennent dans diff√©rents formats et peuvent √™tre d√©compress√©s en utilisant unp, unzip et tar, ce qui r√©sulte en 38 fichiers binaires propri√©taires `.bin`, 20 modules d'imprimante ‚Äòsoftload‚Äô bas√©s sur PostScript pour les appareils plus anciens et 14 fichiers d'extensions diff√©rentes contenant des commandes PJL comme `@PJL ENTER LANGUAGE=FIRMUPDATE`. Le livre blanc sur la s√©curit√© de Konica Minolta affirme que le firmware est v√©rifi√© en utilisant une ‚Äòvaleur de hachage‚Äô [\[17\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-17). On peut douter que ce sch√©ma soit cryptographiquement s√©curis√©.

## R√©sultats

Sur dix fabricants analys√©s, neuf utilisent des commandes [PJL](http://hacking-printers.net/wiki/index.php/PJL) pour toutes ou au moins certaines de leurs proc√©dures de mise √† jour de firmware, ce qui est un fort indicateur que les mises √† jour sont d√©ploy√©es comme des travaux d'impression ordinaires. Le fabricant restant ‚Äì Kyocera ‚Äì applique le langage de description de page PRESCRIBE. On peut donc affirmer qu'il est courant dans l'industrie de l'impression d'installer de nouveaux firmwares via le canal d'impression lui-m√™me et nommer un **d√©faut de conception majeur** pr√©sent dans presque tous les appareils d'impression : **donn√©es et code sur le m√™me canal**. Cependant, l'exploitation de ce probl√®me est difficile car pour la plupart des fabricants, aucune d√©claration raisonn√©e sur les m√©canismes de protection ne peut √™tre faite. Une analyse approfondie des attaques de modification de firmware devrait donc faire partie des recherches futures. Un r√©sum√© des en-t√™tes de fichiers ou des types pour tous les fichiers de firmware obtenus est donn√© ci-dessous :

| Fabricant | Extension | Quantit√© | En-t√™te de fichier ou type |
| :--- | :--- | :--- | :--- |
| HP | rfu | 419 | @PJL UPGRADE SIZE=‚Ä¶ |
| bdl | 206 | Format binaire FutureSmart |  |
| Epson | rcx | 49 | SEIKO EPSON EpsonNet Form |
| prn | 9 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| brn | 7 | Binaire inconnu, inclut fichier de configuration |  |
| Dell | fls, fly | 30 | @PJL LPROGRAMRIP |
| prn | 25 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| hd | 18 | @PJL FIRMWARE=‚Ä¶ |  |
| brn | 3 | Binaire inconnu, inclut fichier de configuration |  |
| ps | 2 | PostScript \(titre : Mise √† jour du firmware\) |  |
| pjl | 1 | @PJL ENTER LANGUAGE=FLASH |  |
| Brother | djf | 79 | @PJL EXECUTE BRDOWNLOAD |
| blf | 9 | @PJL ENTER LANGUAGE=PCL |  |
| Lexmark | fls | 63 | @PJL LPROGRAMRIP |
| bin, fls | 6 | Format binaire inconnu |  |
| Samsung | hd | 33 | @PJL FIRMWARE=‚Ä¶ |
| fls, hd0 | 4 | @PJL DEFAULT P1284VALUE=‚Ä¶ |  |
| Xerox | ps | 36 | PostScript \(titre : Mise √† jour du firmware\) |
| dlm | 35 | Module chargeable dynamiquement Xerox |  |
| prn, bin | 20 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| hd | 16 | @PJL
