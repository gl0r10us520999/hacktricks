<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Los peligros de las actualizaciones de firmware maliciosas son bien conocidos y se han discutido anteriormente por [\[1\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-1) y [\[2\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-2). A diferencia de otros dispositivos en red, **es com√∫n que las impresoras implementen actualizaciones de firmware como trabajos de impresi√≥n ordinarios**. Esto abre una amplia puerta para los atacantes porque el acceso a la funcionalidad de impresi√≥n suele ser un obst√°culo bajo. Solo se puede especular sobre la motivaci√≥n de tales decisiones de dise√±o inseguras, pero parece l√≥gico que razones hist√≥ricas jueguen un papel: las impresoras sol√≠an estar conectadas por cable paralelo o USB. Sin conectividad de red, la seguridad era menos importante y sin un servidor web protegido por contrase√±a o funcionalidades similares, el canal de impresi√≥n era la √∫nica forma de enviar datos al dispositivo.

Los ataques de modificaci√≥n de firmware contra impresoras de red han sido demostrados por [\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3) para dispositivos HP, por [\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4) para la serie Canon PIXMA y por [\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5) y [\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6) para varios modelos de Xerox. Como contramedida, los fabricantes de impresoras comenzaron a firmar digitalmente su firmware [\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7).

## Fabricantes

Para dar una visi√≥n general de los procedimientos de implementaci√≥n de firmware, se han descargado y categorizado sistem√°ticamente 1,400 archivos de firmware de los 10 principales fabricantes de impresoras por [\[8\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-8). Los resultados son los siguientes.

### HP

El firmware se puede descargar desde [support.hp.com](http://support.hp.com/) o directamente desde [ftp.hp.com](ftp://ftp.hp.com/pub/networking/software/pfirmware/) v√≠a FTP. Se pueden obtener 419 archivos en el formato tradicional de actualizaci√≥n de firmware remoto de HP \(`.rfu`\) y 206 binarios m√°s nuevos de ‚ÄòHP FutureSmart‚Äô \(`.bdl`\). Los archivos `.rfu` contienen comandos PJL propietarios como `@PJL UPGRADE SIZE=‚Ä¶`, indicando que las actualizaciones de firmware se implementan como trabajos de impresi√≥n normales. Esto ha sido demostrado por [\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3) y caus√≥ que HP firmara digitalmente todo su firmware de impresora desde marzo de 2012 [\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7).

### Canon

El firmware est√° disponible en [www.canon.com/support](http://www.canon.com/support/). Sin embargo, Canon requiere un n√∫mero de serie v√°lido del dispositivo para descargar cualquier firmware. Seg√∫n [\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4), quienes pudieron modificar el firmware para la serie Canon PIXMA, ‚Äòno hay firma \(la forma correcta de hacerlo\) pero s√≠ tiene un cifrado muy d√©bil‚Äô. Seg√∫n la correspondencia por correo electr√≥nico con un representante de soporte t√©cnico de Canon, ‚Äòel firmware tiene que estar firmado digitalmente por Canon para que sea aceptado por la impresora‚Äô.

### Epson

El firmware se puede descargar desde [epson.com](http://epson.com/) y v√≠a FTP desde [download.epson-europe.com](ftp://download.epson-europe.com/). Los archivos vienen como archivos autoextra√≠bles WinZip `.exe` y se pueden desempaquetar usando unp[\[9\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-9). Los archivos `.efu` contenidos se pueden analizar usando Binwalk[\[10\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-10) que extrae el firmware real. Se pueden obtener 49 archivos `.rcx` de formato desconocido \(‚ÄòSEIKO EPSON EpsonNet Form‚Äô\) y nueve archivos `.prn` que contienen comandos PJL \(`@PJL ENTER LANGUAGE=DOWNLOAD`\). Epson no ha publicado ninguna informaci√≥n sobre mecanismos de protecci√≥n. El firmware lanzado antes de 2016 no aplicaba la firma de c√≥digo y pod√≠a ser manipulado como se muestra en [\[11\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-11). Ellos ‚Äòcreen que enormes cantidades de dispositivos producidos desde 1999 \[‚Ä¶\] podr√≠an ser vulnerables‚Äô.

### Dell

El firmware se puede obtener desde [downloads.dell.com](http://downloads.dell.com/) y desde [ftp.us.dell.com/printer](ftp://ftp.us.dell.com/printer). Los archivos se pueden desempaquetar usando unp y los archivos `.zip` incluidos se pueden extraer con una variante de unzip. Dell no produce dispositivos de impresi√≥n, sino que cambia la marca de los productos de otros fabricantes. Por lo tanto, se encontr√≥ una amplia variedad de archivos de firmware, incluyendo 18 archivos `.hd` que contienen `@PJL FIRMWARE=‚Ä¶`, 25 archivos `.prn` que contienen `@PJL ENTER LANGUAGE=DOWNLOAD` y 30 archivos `.fls`/`.fly` que contienen `@PJL LPROGRAMRIP`. En cuanto a mecanismos de protecci√≥n, Dell no ha publicado ninguna informaci√≥n disponible p√∫blicamente.

### Brother

El firmware no se puede descargar f√°cilmente. En su lugar, se debe ejecutar un binario de Windows que verifica las impresoras disponibles y solicita enlaces de descarga para el firmware m√°s reciente desde un servicio web. Adivinando los par√°metros correctos, se pueden obtener los enlaces para 98 archivos. Los archivos de firmware no necesitan ser desempaquetados ya que ya vienen en formato crudo. 79 archivos tienen la extensi√≥n `.djf` y contienen `@PJL EXECUTE BRDOWNLOAD`, mientras que 9 archivos `.blf` contienen `@PJL ENTER LANGUAGE=PCL`. Brother no ha publicado ninguna informaci√≥n disponible p√∫blicamente sobre mecanismos de protecci√≥n.

### Lexmark

El firmware est√° disponible en [support.lexmark.com](http://support.lexmark.com/) y se puede desempaquetar usando unp. Se pudieron obtener 63 archivos `fls` que contienen el encabezado PJL `@PJL LPROGRAMRIP` para instalar el firmware. El libro blanco de seguridad de Lexmark afirma que ‚Äòlos paquetes deben estar cifrados con un algoritmo de cifrado sim√©trico a trav√©s de una clave que solo es conocida por Lexmark y est√° incrustada de forma segura en todos los dispositivos. Sin embargo, la medida de seguridad m√°s fuerte proviene de requerir que todos los paquetes de firmware deben incluir m√∫ltiples firmas digitales RSA de 2048 bits de Lexmark. Si estas firmas no son v√°lidas \[...\] el firmware se descarta‚Äô [\[12\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-12).

### Samsung

El firmware se puede descargar desde [www.samsung.com/us/support/download](http://www.samsung.com/us/support/download). Los archivos recuperados vienen ya sea como archivos zip o ejecutables de Windows que se pueden ejecutar en wine y desempaquetar m√°s adelante usando unp. De esta manera, se pudieron obtener 33 archivos `.hd` que comienzan con `@PJL FIRMWARE` y archivos `.prn` asociados que contienen `@PJL DEFAULT SWUPGRADE=ON`. Samsung no ha publicado ninguna informaci√≥n disponible p√∫blicamente sobre mecanismos de protecci√≥n.

### Xerox

El firmware est√° disponible p√∫blicamente en [www.support.xerox.com](http://www.support.xerox.com/). Los archivos descargados vienen en formato zip y se pueden desempaquetar usando unzip. Los archivos de firmware est√°n en diferentes formatos: 16 archivos `.hd` que incluyen `@PJL FIRMWARE=‚Ä¶`, 36 archivos PostScript para dispositivos m√°s antiguos y 35 archivos `.dlm` que es el formato utilizado actualmente por Xerox e incluye firmas digitales. Sin embargo, se encontr√≥ un defecto en el proceso de implementaci√≥n por [\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5) y extendido por [\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6), lo que lleva a la ejecuci√≥n remota de c√≥digo: la clave privada y la herramienta utilizada para la firma de c√≥digo estaban contenidas en el propio firmware.

### Ricoh

El ‚ÄòCentro de Descarga de Firmware‚Äô en [support.ricoh.com](https://support.ricoh.com/) no est√° abierto al p√∫blico en general. Afortunadamente, la web contiene enlaces directos a un par de p√°ginas de descarga de controladores/firmware, por lo que se pueden obtener 31 archivos de firmware utilizando una simple b√∫squeda en Google \(`site:support.ricoh.com firmware`\). Los archivos se pueden desempaquetar usando unp. 14 archivos `.bin` contienen `@PJL RSYSTEMUPDATE SIZE=‚Ä¶` mientras que 15 archivos `.brn` est√°n asociados con un `settings.ini`, incluyendo `@PJL FWDOWNLOAD` y `USERID=sysadm, PASSWORD=sysadm`. Ricoh no proporciona ninguna informaci√≥n actualizada sobre mecanismos de protecci√≥n. En un libro blanco que data de 2007, Ricoh afirma que ‚Äòsolo los t√©cnicos de servicio tienen una contrase√±a y una cuenta dedicada para realizar actualizaciones de firmware‚Äô [\[13\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-13).

### Kyocera

Kyocera no libera firmware a los usuarios finales. Sin embargo, en un foro de distribuidores de Kyocera disponible p√∫blicamente, se enlazan descargas de firmware para varios modelos: [ftp.kdaconnect.com](ftp://ftp.kdaconnect.com/). Los archivos se pueden desempaquetar usando unp y contienen im√°genes montables cramfs[\[14\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-14) y squashfs[\[15\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-15) as√≠ como formatos binarios propietarios. El firmware se implementa como un trabajo de impresi√≥n con `!R! UPGR'SYS';EXIT;` antepuesto: el comando de actualizaci√≥n del lenguaje de descripci√≥n de p√°gina PRESCRIBE [\[16\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-16). Kyocera no ha publicado ninguna informaci√≥n disponible p√∫blicamente sobre mecanismos de protecci√≥n.

### Konica

Aunque no se promociona activamente, el firmware para impresoras Konica Minolta se puede descargar desde [download6.konicaminolta.eu](http://download6.konicaminolta.eu/). Los dispositivos m√°s nuevos conectados a Internet tienen la capacidad de realizar actualizaciones de firmware por s√≠ mismos. Los archivos comprimidos vienen en diferentes formatos y se pueden desempaquetar usando unp, unzip y tar, lo que resulta en 38 archivos binarios propietarios `.bin`, 20 m√≥dulos de impresora ‚Äòsoftload‚Äô basados en PostScript para dispositivos m√°s antiguos y 14 archivos de diferentes extensiones que contienen comandos PJL como `@PJL ENTER LANGUAGE=FIRMUPDATE`. El libro blanco de seguridad de Konica Minolta afirma que el firmware se verifica utilizando un ‚Äòvalor hash‚Äô [\[17\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-17). Se puede dudar de que tal esquema sea criptogr√°ficamente seguro.

## Resultados

De los diez fabricantes analizados, nueve utilizan comandos [PJL](http://hacking-printers.net/wiki/index.php/PJL) para todos o al menos algunos de sus procedimientos de actualizaci√≥n de firmware, lo que es un fuerte indicador de que las actualizaciones se implementan como trabajos de impresi√≥n ordinarios. El fabricante restante ‚Äì Kyocera ‚Äì aplica el lenguaje de descripci√≥n de p√°gina PRESCRIBE. Por lo tanto, se puede afirmar que es com√∫n en la industria de la impresi√≥n instalar nuevo firmware a trav√©s del propio canal de impresi√≥n y nombrar un **defecto de dise√±o importante** presente en casi cualquier dispositivo de impresora: **datos y c√≥digo sobre el mismo canal**. Sin embargo, la explotaci√≥n de este problema es dif√≠cil ya que para la mayor√≠a de los fabricantes no se puede hacer una declaraci√≥n razonada sobre los mecanismos de protecci√≥n. Por lo tanto, un an√°lisis en profundidad de los ataques de modificaci√≥n de firmware deber√≠a ser parte de la investigaci√≥n futura. A continuaci√≥n se presenta un resumen de encabezados de archivos o tipos para todos los archivos de firmware obtenidos:

| Fabricante | Extensi√≥n | Cantidad | Encabezado de archivo o tipo |
| :--- | :--- | :--- | :--- |
| HP | rfu | 419 | @PJL UPGRADE SIZE=‚Ä¶ |
| bdl | 206 | Formato binario FutureSmart |  |
| Epson | rcx | 49 | Formato SEIKO EPSON EpsonNet |
| prn | 9 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| brn | 7 | Binario desconocido, incluye archivo de configuraci√≥n |  |
| Dell | fls, fly | 30 | @PJL LPROGRAMRIP |
| prn | 25 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| hd | 18 | @PJL FIRMWARE=‚Ä¶ |  |
| brn | 3 | Binario desconocido, incluye archivo de configuraci√≥n |  |
| ps | 2 | PostScript \(t√≠tulo: Actualizaci√≥n de Firmware\) |  |
| pjl | 1 | @PJL ENTER LANGUAGE=FLASH |  |
| Brother | djf | 79 | @PJL EXECUTE BRDOWNLOAD |
| blf | 9 | @PJL ENTER LANGUAGE=PCL |  |
| Lexmark | fls | 63 | @PJL LPROGRAMRIP |
| bin, fls | 6 | Formato binario desconocido |  |
| Samsung | hd | 33 | @PJL FIRMWARE=‚Ä¶ |
| fls, hd0 | 4 | @PJL DEFAULT P1284VALUE=‚Ä¶ |  |
| Xerox | ps | 36 | PostScript \(t√≠tulo: Actualizaci√≥n de Firmware\) |
| dlm | 35 | M√≥dulo Cargable Din√°mico de Xerox |  |
| prn, bin | 20 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| hd | 16 | @PJL FIRMWARE=‚Ä¶ |  |
| brn | 10 | Binario desconocido, incluye archivo de configuraci√≥n |  |
| bin | 10 | @PJL SET JOBATTR="@SWDL" |  |
| fls, hd, hde | 8 | @PJL DEFAULT P1284VALUE=‚Ä¶ |  |
| fls, xfc | 4 | @PJL ENTER LANGUAGE=XFLASH |  |
| pjl | 3 | @PJL FSDOWNLOAD \[nombre\].rpm |  |
| axf | 3 | Ejecutable AIF de RISC OS |  |
| Ricoh | brn | 15 | @PJL FWDOWNLOAD‚Ä¶ |
| bin | 14 | @PJL RSYSTEMUPDATE SIZE=‚Ä¶ |  |
