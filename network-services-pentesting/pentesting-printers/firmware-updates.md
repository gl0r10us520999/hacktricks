<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


Os perigos de atualiza√ß√µes de firmware maliciosas s√£o bem conhecidos e foram discutidos anteriormente por [\[1\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-1) e [\[2\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-2). Ao contr√°rio de outros dispositivos de rede, **√© comum que impressoras implantem atualiza√ß√µes de firmware como trabalhos de impress√£o comuns**. Isso abre um amplo portal para atacantes, pois o acesso √† funcionalidade de impress√£o geralmente √© um obst√°culo baixo. S√≥ se pode especular sobre a motiva√ß√£o para tais decis√µes de design inseguras, mas parece l√≥gico que raz√µes hist√≥ricas desempenhem um papel: as impressoras costumavam ser conectadas por cabo paralelo ou USB. Sem conectividade de rede, a seguran√ßa era menos importante e sem um servidor web protegido por senha ou funcionalidade semelhante, o canal de impress√£o era a √∫nica maneira de enviar dados ao dispositivo.

Ataques de modifica√ß√£o de firmware contra impressoras de rede foram demonstrados por [\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3) para dispositivos HP, por [\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4) para a s√©rie Canon PIXMA e por [\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5) e [\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6) para v√°rios modelos Xerox. Como contramedida, fabricantes de impressoras come√ßaram a assinar digitalmente seus firmwares [\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7).

## Fabricantes

Para dar uma vis√£o geral dos procedimentos de implanta√ß√£o de firmware, 1.400 arquivos de firmware dos 10 principais fabricantes de impressoras foram baixados e sistematicamente categorizados por [\[8\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-8). Os resultados s√£o os seguintes.

### HP

O firmware pode ser baixado de [support.hp.com](http://support.hp.com/) ou diretamente de [ftp.hp.com](ftp://ftp.hp.com/pub/networking/software/pfirmware/) via FTP. 419 arquivos no formato tradicional de atualiza√ß√£o remota de firmware da HP \(`.rfu`\) e 206 bin√°rios ‚ÄòHP FutureSmart‚Äô mais recentes \(`.bdl`\) podem ser recuperados. Os arquivos `.rfu` cont√™m comandos PJL propriet√°rios como `@PJL UPGRADE SIZE=‚Ä¶`, indicando que as atualiza√ß√µes de firmware s√£o implantadas como trabalhos de impress√£o normais. Isso foi demonstrado por [\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3) e fez com que a HP assinasse digitalmente todo o seu firmware de impressora desde mar√ßo de 2012 [\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7).

### Canon

O firmware est√° dispon√≠vel em [www.canon.com/support](http://www.canon.com/support/). No entanto, a Canon exige um n√∫mero de s√©rie v√°lido do dispositivo para baixar qualquer firmware. De acordo com [\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4), que conseguiram modificar o firmware para a s√©rie Canon PIXMA, ‚Äòn√£o h√° assinatura (a maneira correta de fazer isso), mas possui uma criptografia muito fraca‚Äô. De acordo com a correspond√™ncia por e-mail com um representante de suporte t√©cnico da Canon, ‚Äòo firmware precisa ser assinado digitalmente pela Canon para que seja aceito pela impressora‚Äô.

### Epson

O firmware pode ser baixado de [epson.com](http://epson.com/) e via FTP de [download.epson-europe.com](ftp://download.epson-europe.com/). Os arquivos v√™m como arquivos `.exe` autoextra√≠veis do WinZip e podem ser descompactados usando unp[\[9\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-9). Os arquivos `.efu` contidos podem ser analisados ‚Äã‚Äãusando Binwalk[\[10\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-10) que extrai o firmware real. Pode-se obter 49 arquivos `.rcx` de formato desconhecido \(‚ÄòSEIKO EPSON EpsonNet Form‚Äô\) e nove arquivos `.prn` contendo comandos PJL \(`@PJL ENTER LANGUAGE=DOWNLOAD`\). A Epson n√£o publicou nenhuma informa√ß√£o sobre mecanismos de prote√ß√£o. O firmware lan√ßado antes de 2016 n√£o aplicava assinatura de c√≥digo e poderia ser manipulado como mostrado por [\[11\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-11). Eles ‚Äòacreditam que grandes quantidades dos dispositivos produzidos desde 1999 \[‚Ä¶\] podem ser vulner√°veis‚Äô.

### Dell

O firmware pode ser obtido de [downloads.dell.com](http://downloads.dell.com/) e de [ftp.us.dell.com/printer](ftp://ftp.us.dell.com/printer). Os arquivos podem ser descompactados usando unp e os arquivos `.zip` inclu√≠dos podem ser extra√≠dos com uma variante do unzip. A Dell n√£o produz dispositivos de impress√£o, mas rebatiza os produtos de outros fabricantes. Portanto, uma grande variedade de arquivos de firmware, incluindo 18 arquivos `.hd` contendo `@PJL FIRMWARE=‚Ä¶`, 25 arquivos `.prn` contendo `@PJL ENTER LANGUAGE=DOWNLOAD` e 30 arquivos `.fls`/`.fly` contendo `@PJL LPROGRAMRIP` foram encontrados. Em rela√ß√£o aos mecanismos de prote√ß√£o, a Dell n√£o divulgou nenhuma informa√ß√£o publicamente dispon√≠vel.

### Brother

O firmware n√£o pode ser facilmente baixado. Em vez disso, √© necess√°rio executar um bin√°rio do Windows que verifica as impressoras dispon√≠veis e solicita links de download para o firmware mais recente de um servi√ßo da web. Ao adivinhar os par√¢metros corretos, √© poss√≠vel obter os links para 98 arquivos. Os arquivos de firmware n√£o precisam ser descompactados, pois j√° v√™m em formato bruto. 79 arquivos t√™m a extens√£o `.djf` e cont√™m `@PJL EXECUTE BRDOWNLOAD`, enquanto 9 arquivos `.blf` cont√™m `@PJL ENTER LANGUAGE=PCL`. A Brother n√£o divulgou nenhuma informa√ß√£o publicamente dispon√≠vel sobre mecanismos de prote√ß√£o.

### Lexmark

O firmware est√° dispon√≠vel em [support.lexmark.com](http://support.lexmark.com/) e pode ser descompactado usando unp. 63 arquivos `fls` puderam ser obtidos contendo o cabe√ßalho PJL `@PJL LPROGRAMRIP` para instalar o firmware. O whitepaper de seguran√ßa da Lexmark afirma que ‚Äòos pacotes devem ser criptografados com um algoritmo de criptografia sim√©trica por meio de uma chave que √© conhecida apenas pela Lexmark e est√° embutida de forma segura em todos os dispositivos. No entanto, a medida de seguran√ßa mais forte vem da exig√™ncia de que todos os pacotes de firmware devem incluir m√∫ltiplas assinaturas digitais RSA de 2048 bits da Lexmark. Se essas assinaturas n√£o forem v√°lidas \[...\] o firmware √© descartado‚Äô [\[12\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-12).

### Samsung

O firmware pode ser baixado de [www.samsung.com/us/support/download](http://www.samsung.com/us/support/download). Os arquivos recuperados v√™m como arquivos zip ou execut√°veis do Windows que podem ser executados no wine e descompactados usando unp. Desta forma, foram obtidos 33 arquivos `.hd` come√ßando com `@PJL FIRMWARE` e arquivos `.prn` associados contendo `@PJL DEFAULT SWUPGRADE=ON`. A Samsung n√£o divulgou nenhuma informa√ß√£o publicamente dispon√≠vel sobre mecanismos de prote√ß√£o.

### Xerox

O firmware est√° dispon√≠vel publicamente em [www.support.xerox.com](http://www.support.xerox.com/). Os arquivos baixados v√™m em formato zip e podem ser descompactados usando unzip. Os arquivos de firmware est√£o em diferentes formatos: 16 arquivos `.hd` incluindo `@PJL FIRMWARE=‚Ä¶`, 36 arquivos PostScript para dispositivos mais antigos e 35 arquivos `.dlm` que √© o formato atualmente usado pela Xerox e inclui assinaturas digitais. Um defeito no processo de implanta√ß√£o, no entanto, foi encontrado por [\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5) e estendido por [\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6), levando √† execu√ß√£o remota de c√≥digo ‚Äì a chave privada e a ferramenta usada para assinatura de c√≥digo estavam contidas no pr√≥prio firmware.

### Ricoh

O ‚ÄòCentro de Download de Firmware‚Äô em [support.ricoh.com](https://support.ricoh.com/) n√£o est√° aberto ao p√∫blico em geral. Felizmente, a internet cont√©m links diretos para algumas p√°ginas de download de drivers/firmware, ent√£o √© poss√≠vel obter 31 arquivos de firmware usando uma simples pesquisa no Google \(`site:support.ricoh.com firmware`\). Os arquivos podem ser descompactados usando unp. 14 arquivos `.bin` cont√™m `@PJL RSYSTEMUPDATE SIZE=‚Ä¶` enquanto 15 arquivos `.brn` est√£o associados a um `settings.ini`, incluindo `@PJL FWDOWNLOAD` e `USERID=sysadm, PASSWORD=sysadm`. A Ricoh n√£o fornece nenhuma informa√ß√£o atualizada sobre mecanismos de prote√ß√£o. Em um whitepaper de 2007, a Ricoh afirma que ‚Äòapenas t√©cnicos de servi√ßo t√™m uma senha e conta dedicada para fazer atualiza√ß√µes de firmware‚Äô [\[13\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-13).

### Kyocera

A Kyocera n√£o libera firmware para usu√°rios finais. No entanto, em um f√≥rum de revendedores Kyocera publicamente dispon√≠vel, downloads de firmware para v√°rios modelos s√£o vinculados: [ftp.kdaconnect.com](ftp://ftp.kdaconnect.com/). Os arquivos podem ser descompactados usando unp e cont√™m imagens cramfs[\[14\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-14) e squashfs[\[15\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-15) mont√°veis, bem como formatos bin√°rios propriet√°rios. O firmware √© implantado como um trabalho de impress√£o com `!R! UPGR'SYS';EXIT;` precedendo ‚Äì o comando de atualiza√ß√£o da linguagem de descri√ß√£o de p√°gina PRESCRIBE [\[16\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-16). A Kyocera n√£o divulgou nenhuma informa√ß√£o publicamente dispon√≠vel sobre mecanismos de prote√ß√£o.

### Konica

Embora n√£o seja promovido ativamente, o firmware para impressoras Konica Minolta pode ser baixado de [download6.konicaminolta.eu](http://download6.konicaminolta.eu/). Dispositivos mais novos conectados √† Internet t√™m a capacidade de realizar atualiza√ß√µes de firmware por conta pr√≥pria. Arquivos compactados v√™m em diferentes formatos e podem ser descompactados usando unp, unzip e tar, resultando em 38 arquivos bin√°rios propriet√°rios `.bin`, 20 m√≥dulos de impressora ‚Äòsoftload‚Äô baseados em PostScript para dispositivos mais antigos e 14 arquivos de diferentes extens√µes contendo comandos PJL como `@PJL ENTER LANGUAGE=FIRMUPDATE`. O whitepaper de seguran√ßa da Konica Minolta afirma que o firmware √© verificado usando um ‚Äòvalor de hash‚Äô [\[17\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-17). Pode-se duvidar que tal esquema seja criptograficamente seguro.

## Resultados

Dos dez fabricantes analisados, nove usam comandos [PJL](http://hacking-printers.net/wiki/index.php/PJL) para todos ou pelo menos alguns de seus procedimentos de atualiza√ß√£o de firmware, o que √© um forte indicador de que as atualiza√ß√µes s√£o implantadas como trabalhos de impress√£o comuns. O fabricante restante ‚Äì Kyocera ‚Äì aplica a linguagem de descri√ß√£o de p√°gina PRESCRIBE. Portanto, pode-se afirmar que √© comum na ind√∫stria de impress√£o instalar novo firmware pelo pr√≥prio canal de impress√£o e nomear um **grande defeito de design** presente em quase qualquer dispositivo de impressora: **dados e c√≥digo pelo mesmo canal**. No entanto, a explora√ß√£o deste problema √© dif√≠cil, pois para a maioria dos fabricantes n√£o se pode fazer uma declara√ß√£o fundamentada sobre mecanismos de prote√ß√£o. Uma an√°lise aprofundada de ataques de modifica√ß√£o de firmware deve, portanto, fazer parte de pesquisas futuras. Um resumo dos cabe√ßalhos de arquivos ou tipos para todos os arquivos de firmware obtidos √© dado abaixo:

| Fabricante | Extens√£o | Quantidade | Cabe√ßalho de arquivo ou tipo |
| :--- | :--- | :--- | :--- |
| HP | rfu | 419 | @PJL UPGRADE SIZE=‚Ä¶ |
| bdl | 206 | Formato bin√°rio FutureSmart |  |
| Epson | rcx | 49 | SEIKO EPSON EpsonNet Form |
| prn | 9 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| brn | 7 | Bin√°rio desconhecido, inclui arquivo de configura√ß√£o |  |
| Dell | fls, fly | 30 | @PJL LPROGRAMRIP |
| prn | 25 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| hd | 18 | @PJL FIRMWARE=‚Ä¶ |  |
| brn | 3 | Bin√°rio desconhecido, inclui arquivo de configura√ß√£o |  |
| ps | 2 | PostScript \(t√≠tulo: Atualiza√ß√£o de Firmware\) |  |
| pjl | 1 | @PJL ENTER LANGUAGE=FLASH |  |
| Brother | djf | 79 | @PJL EXECUTE BRDOWNLOAD |
| blf | 9 | @PJL ENTER LANGUAGE=PCL |  |
| Lexmark | fls | 63 | @PJL LPROGRAMRIP |
| bin, fls | 6 | Formato bin√°rio desconhecido |  |
| Samsung | hd | 33 | @PJL FIRMWARE=‚Ä¶ |
| fls, hd0 | 4 | @PJL DEFAULT P1284VALUE=‚Ä¶ |  |
| Xerox | ps | 36 | PostScript \(t√≠tulo: Atualiza√ß√£o de Firmware\) |
| dlm | 35 | M√≥dulo Carreg√°vel Din√¢mico Xerox |  |
| prn, bin | 20 | @PJL ENTER LANGUAGE=DOWNLOAD |  |
| hd | 16 | @PJL FIRMWARE=‚Ä¶ |  |
| brn | 10 | Bin√°rio desconhecido, inclui arquivo de configura√ß√£o |  |
| bin | 10 | @PJL SET JOBATTR="@SWDL" |  |
| fls, hd, hde | 8 | @PJL DEFAULT P1284VALUE=‚Ä¶ |  |
| fls, xfc | 4 | @PJL ENTER LANGUAGE=XFLASH |  |
| pjl | 3 | @PJL FSDOWN
