<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* あなたの**会社をHackTricksで宣伝したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加する**、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**のPRを[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリに提出して、あなたのハッキングのコツを共有してください。

</details>


悪意のあるファームウェアアップデートの危険性はよく知られており、早期に[\[1\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-1)と[\[2\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-2)によって議論されています。しかし、他のネットワークデバイスとは対照的に、**プリンターは通常の印刷ジョブとしてファームウェアアップデートを展開することが一般的です**。これにより、印刷機能へのアクセスは通常低いハードルであるため、攻撃者に広いゲートウェイが開かれます。このような不安全な設計決定の動機については推測するしかありませんが、歴史的な理由が関係していると考えるのは論理的です：プリンターはかつて並列またはUSBケーブルで接続されていました。ネットワーク接続がなければ、セキュリティはそれほど重要ではなく、パスワードで保護されたWebサーバーや類似の機能がなければ、印刷チャネルがデバイスにデータを送信する唯一の方法でした。

ネットワークプリンターに対するファームウェア改変攻撃は、HPデバイスに対して[\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3)、Canon PIXMAシリーズに対して[\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4)、さまざまなXeroxモデルに対して[\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5)および[\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6)によって実証されています。対策として、プリンターメーカーはファームウェアにデジタル署名を開始しました[\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7)。

## ベンダー

ファームウェア展開手順の概要を提供するために、トップ10のプリンターメーカーの1,400のファームウェアファイルがダウンロードされ、[\[8\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-8)によって体系的に分類されました。結果は以下の通りです。

### HP

ファームウェアは[support.hp.com](http://support.hp.com/)からダウンロードすることができます。またはFTPを介して[ftp.hp.com](ftp://ftp.hp.com/pub/networking/software/pfirmware/)から直接取得できます。HPの従来のリモートファームウェアアップデート\(`.rfu`\)形式の419ファイルと、新しい「HP FutureSmart」バイナリ\(`.bdl`\)の206ファイルを取得できます。`.rfu`ファイルには、ファームウェアアップデートが通常の印刷ジョブとして展開されることを示す独自のPJLコマンド`@PJL UPGRADE SIZE=…`が含まれています。これは[\[3\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-cui2011print-3)によって実証され、HPは2012年3月以降、すべてのプリンターファームウェアにデジタル署名を行っています[\[7\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-hp2012rfu-7)。

### Canon

ファームウェアは[www.canon.com/support](http://www.canon.com/support/)で入手できます。しかし、Canonは有効なデバイスシリアル番号がないとファームウェアをダウンロードできません。[\[4\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-jordon2014wrestling-4)によると、Canon PIXMAシリーズのファームウェアを改変することができましたが、「署名はありません（正しい方法です）が、非常に弱い暗号化があります」。Canonの技術サポート担当者との電子メールでのやり取りによると、「ファームウェアはCanonによってデジタル署名されていなければならず、プリンターに受け入れられるためには」。

### Epson

ファームウェアは[epson.com](http://epson.com/)からダウンロードでき、FTPを介して[download.epson-europe.com](ftp://download.epson-europe.com/)からも入手できます。ファイルはWinZip自己解凍`.exe`ファイルとして提供され、unp[\[9\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-9)を使用して解凍できます。含まれている`.efu`ファイルはBinwalk[\[10\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-10)を使用して分析でき、実際のファームウェアを抽出します。49個の未知の形式の`.rcx`ファイル（「SEIKO EPSON EpsonNet Form」）と、PJLコマンド`@PJL ENTER LANGUAGE=DOWNLOAD`を含む9個の`.prn`ファイルを入手できます。Epsonは保護メカニズムに関する情報を公開していません。2016年以前にリリースされたファームウェアはコード署名を適用しておらず、[\[11\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-11)によって示されたように操作可能でした。彼らは「1999年以降に製造された大量のデバイスが脆弱である可能性があると信じています」。

### Dell

ファームウェアは[downloads.dell.com](http://downloads.dell.com/)および[ftp.us.dell.com/printer](ftp://ftp.us.dell.com/printer)から入手できます。ファイルはunpを使用して解凍でき、含まれている`.zip`ファイルはunzipのバリアントを使用して抽出できます。Dellは印刷デバイスを製造していませんが、他のベンダーの製品を再ブランドしています。したがって、`@PJL FIRMWARE=…`を含む18個の`.hd`ファイル、`@PJL ENTER LANGUAGE=DOWNLOAD`を含む25個の`.prn`ファイル、`@PJL LPROGRAMRIP`を含む30個の`.fls`/`.fly`ファイルなど、さまざまなファームウェアファイルが見つかりました。保護メカニズムに関して、Dellは公に利用可能な情報をリリースしていません。

### Brother

ファームウェアは簡単にダウンロードできません。代わりに、利用可能なプリンターをチェックし、最新のファームウェアのダウンロードリンクをWebサービスから要求するWindowsバイナリを実行する必要があります。正しいパラメーターを推測することで、98個のファイルのリンクを取得することができます。ファームウェアファイルは解凍する必要はなく、すでに生の形式で提供されています。79個の`.djf`ファイルには`@PJL EXECUTE BRDOWNLOAD`が含まれており、9個の`.blf`ファイルには`@PJL ENTER LANGUAGE=PCL`が含まれています。Brotherは保護メカニズムに関する公に利用可能な情報をリリースしていません。

### Lexmark

ファームウェアは[support.lexmark.com](http://support.lexmark.com/)から入手でき、unpを使用して解凍できます。63個の`fls`ファイルを入手でき、ファームウェアをインストールするためのPJLヘッダー`@PJL LPROGRAMRIP`が含まれています。Lexmarkのセキュリティホワイトペーパーは、「パッケージは、Lexmarkのみが知っているキーを介して対称暗号化アルゴリズムで暗号化する必要があり、すべてのデバイスに安全に組み込まれています。ただし、最も強力なセキュリティ対策は、すべてのファームウェアパッケージにLexmarkからの複数のデジタル2048ビットRSA署名が含まれていることを要求することから来ます。これらの署名が有効でない場合\[...\]ファームウェアは破棄されます」[\[12\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-12)と主張しています。

### Samsung

ファームウェアは[www.samsung.com/us/support/download](http://www.samsung.com/us/support/download)からダウンロードできます。取得したファイルはzipアーカイブまたはWindows実行可能ファイルとして提供され、wineで実行してさらにunpを使用して解凍できます。この方法で、`@PJL FIRMWARE`で始まる33個の`.hd`ファイルと、`@PJL DEFAULT SWUPGRADE=ON`を含む関連する`.prn`ファイルを入手できます。Samsungは保護メカニズムに関する公に利用可能な情報をリリースしていません。

### Xerox

ファームウェアは[www.support.xerox.com](http://www.support.xerox.com/)で公開されています。ダウンロードしたファイルはzip形式で提供され、unzipを使用して解凍できます。ファームウェアファイルは異なる形式であり、`@PJL FIRMWARE=…`を含む16個の`.hd`ファイル、古いデバイス用の36個のPostScriptファイル、現在Xeroxが使用している形式でありデジタル署名が含まれている35個の`.dlm`ファイルがあります。しかし、[\[5\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-heiland2011patched-5)と[\[6\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-weidenbach2016pwn-6)によって見つかった展開プロセスの欠陥により、リモートコード実行が可能になりました – プライベートキーとコード署名に使用されるツールがファームウェア自体に含まれていました。

### Ricoh

[support.ricoh.com](https://support.ricoh.com/)の「ファームウェアダウンロードセンター」は一般公開されていません。幸いなことに、インターネットにはドライバー/ファームウェアのダウンロードページへの直接リンクがいくつか含まれているため、単純なGoogle検索\(`site:support.ricoh.com firmware`\)を使用して31個のファームウェアファイルを入手できます。ファイルはunpを使用して解凍できます。14個の`.bin`ファイルには`@PJL RSYSTEMUPDATE SIZE=…`が含まれており、15個の`.brn`ファイルは`settings.ini`を含み、`@PJL FWDOWNLOAD`と`USERID=sysadm, PASSWORD=sysadm`が含まれています。Ricohは保護メカニズムに関する最新の情報を提供していません。2007年に遡るホワイトペーパーで、Ricohは「サービス技術者のみがファームウェアアップデートを行うためのパスワードと専用アカウントを持っています」と主張しています[\[13\]](http://hacking-printers.net/wiki/index.php/Firmware_updates#cite_note-13)。

### Kyocera

Kyoceraはエンドユーザーにファームウェアをリリースしていません。しかし、公に利用可能なKyoceraディーラーフォーラムでは、さまざまなモデルのファームウェアダウンロードがリンクされています：
