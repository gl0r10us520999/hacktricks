# NextJS

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Next.js UygulamasÄ±nÄ±n Genel Mimarisi

### Tipik Dosya YapÄ±sÄ±

Standart bir Next.js projesi, yÃ¶nlendirme, API uÃ§ noktalarÄ± ve statik varlÄ±k yÃ¶netimi gibi Ã¶zelliklerini kolaylaÅŸtÄ±ran belirli bir dosya ve dizin yapÄ±sÄ±nÄ± takip eder. Ä°ÅŸte tipik bir dÃ¼zen:
```lua
my-nextjs-app/
â”œâ”€â”€ node_modules/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ hello/
â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ Home.module.css
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api.ts
â”œâ”€â”€ .env.local
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ yarn.lock / package-lock.json

```
### Temel Dizinler ve Dosyalar

* **public/:** GÃ¶rseller, fontlar ve diÄŸer dosyalar gibi statik varlÄ±klarÄ± barÄ±ndÄ±rÄ±r. Buradaki dosyalar kÃ¶k yol (`/`) Ã¼zerinden eriÅŸilebilir.
* **app/:** UygulamanÄ±zÄ±n sayfalarÄ±, dÃ¼zenleri, bileÅŸenleri ve API yollarÄ± iÃ§in merkezi dizin. GeliÅŸmiÅŸ yÃ¶nlendirme Ã¶zellikleri ve sunucu-mÃ¼ÅŸteri bileÅŸen ayrÄ±mÄ± saÄŸlayan **App Router** paradigmasÄ±nÄ± benimser.
* **app/layout.tsx:** UygulamanÄ±z iÃ§in kÃ¶k dÃ¼zeni tanÄ±mlar, tÃ¼m sayfalarÄ±n etrafÄ±nÄ± sarar ve baÅŸlÄ±klar, alt bilgiler ve navigasyon Ã§ubuklarÄ± gibi tutarlÄ± UI Ã¶ÄŸeleri saÄŸlar.
* **app/page.tsx:** KÃ¶k yol `/` iÃ§in giriÅŸ noktasÄ± olarak hizmet eder, ana sayfayÄ± render eder.
* **app/\[route]/page.tsx:** Statik ve dinamik yollarÄ± yÃ¶netir. `app/` iÃ§indeki her klasÃ¶r bir yol segmentini temsil eder ve bu klasÃ¶rlerdeki `page.tsx`, yolun bileÅŸenine karÅŸÄ±lÄ±k gelir.
* **app/api/:** HTTP isteklerini yÃ¶neten sunucusuz iÅŸlevler oluÅŸturmanÄ±za olanak tanÄ±yan API yollarÄ±nÄ± iÃ§erir. Bu yollar geleneksel `pages/api` dizinini deÄŸiÅŸtirir.
* **app/components/:** FarklÄ± sayfalar ve dÃ¼zenler arasÄ±nda kullanÄ±labilecek yeniden kullanÄ±labilir React bileÅŸenlerini barÄ±ndÄ±rÄ±r.
* **app/styles/:** BileÅŸen kapsamlÄ± stil iÃ§in global CSS dosyalarÄ±nÄ± ve CSS ModÃ¼llerini iÃ§erir.
* **app/utils/:** Uygulama genelinde paylaÅŸÄ±labilecek yardÄ±mcÄ± modÃ¼ller, yardÄ±mcÄ± iÅŸlevler ve diÄŸer UI dÄ±ÅŸÄ± mantÄ±klarÄ± iÃ§erir.
* **.env.local:** Yerel geliÅŸtirme ortamÄ±na Ã¶zgÃ¼ ortam deÄŸiÅŸkenlerini saklar. Bu deÄŸiÅŸkenler **versiyon kontrolÃ¼ne** dahil edilmez.
* **next.config.js:** Webpack yapÄ±landÄ±rmalarÄ±, ortam deÄŸiÅŸkenleri ve gÃ¼venlik ayarlarÄ± dahil olmak Ã¼zere Next.js davranÄ±ÅŸÄ±nÄ± Ã¶zelleÅŸtirir.
* **tsconfig.json:** Proje iÃ§in TypeScript ayarlarÄ±nÄ± yapÄ±landÄ±rÄ±r, tÃ¼r kontrolÃ¼ ve diÄŸer TypeScript Ã¶zelliklerini etkinleÅŸtirir.
* **package.json:** Proje baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ±, betikleri ve meta verileri yÃ¶netir.
* **README.md:** Proje hakkÄ±nda belgeler ve bilgiler saÄŸlar, kurulum talimatlarÄ±, kullanÄ±m kÄ±lavuzlarÄ± ve diÄŸer ilgili detaylarÄ± iÃ§erir.
* **yarn.lock / package-lock.json:** Projenin baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ± belirli sÃ¼rÃ¼mlere kilitler, farklÄ± ortamlar arasÄ±nda tutarlÄ± kurulumlar saÄŸlar.

## Next.js'de Ä°stemci TarafÄ±

### `app` Dizininde Dosya TabanlÄ± YÃ¶nlendirme

`app` dizini, en son Next.js sÃ¼rÃ¼mlerinde yÃ¶nlendirmenin temel taÅŸÄ±dÄ±r. YollarÄ± tanÄ±mlamak iÃ§in dosya sistemini kullanÄ±r, bu da yol yÃ¶netimini sezgisel ve Ã¶lÃ§eklenebilir hale getirir.

<details>

<summary>KÃ¶k Yol /'u YÃ¶netme</summary>

**Dosya YapÄ±sÄ±:**
```arduino
my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Anahtar Dosyalar:**

* **`app/page.tsx`**: KÃ¶k yoluna `/` gelen istekleri iÅŸler.
* **`app/layout.tsx`**: UygulamanÄ±n dÃ¼zenini tanÄ±mlar, tÃ¼m sayfalarÄ±n etrafÄ±nÄ± sarar.

**Uygulama:**
```tsx
tsxCopy code// app/page.tsx

export default function HomePage() {
return (
<div>
<h1>Welcome to the Home Page!</h1>
<p>This is the root route.</p>
</div>
);
}
```
**AÃ§Ä±klama:**

* **Yol TanÄ±mÄ±:** `app` dizininin altÄ±ndaki `page.tsx` dosyasÄ± `/` yoluna karÅŸÄ±lÄ±k gelir.
* **Renderlama:** Bu bileÅŸen ana sayfa iÃ§eriÄŸini renderlar.
* **DÃ¼zen Entegrasyonu:** `HomePage` bileÅŸeni, baÅŸlÄ±klar, alt bilgiler ve diÄŸer ortak Ã¶ÄŸeleri iÃ§erebilen `layout.tsx` ile sarÄ±lmÄ±ÅŸtÄ±r.

</details>

<details>

<summary>DiÄŸer Statik YollarÄ± YÃ¶netme</summary>



**Ã–rnek: `/about` Yolu**

**Dosya YapÄ±sÄ±:**
```arduino
arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Uygulama:**
```tsx
// app/about/page.tsx

export default function AboutPage() {
return (
<div>
<h1>About Us</h1>
<p>Learn more about our mission and values.</p>
</div>
);
}
```
**AÃ§Ä±klama:**

* **Yol TanÄ±mÄ±:** `about` klasÃ¶rÃ¼ iÃ§indeki `page.tsx` dosyasÄ± `/about` yoluna karÅŸÄ±lÄ±k gelir.
* **Renderlama:** Bu bileÅŸen, hakkÄ±nda sayfasÄ± iÃ§in iÃ§eriÄŸi renderlar.

</details>

<details>

<summary>Dinamik Yollar</summary>

Dinamik yollar, deÄŸiÅŸken segmentlere sahip yollarÄ± yÃ¶netmeyi saÄŸlar ve uygulamalarÄ±n ID'ler, slug'lar gibi parametrelere dayalÄ± iÃ§erik gÃ¶stermesine olanak tanÄ±r.

**Ã–rnek: `/posts/[id]` Yolu**

**Dosya YapÄ±sÄ±:**
```arduino
arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ posts/
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Uygulama:**
```tsx
tsxCopy code// app/posts/[id]/page.tsx

import { useRouter } from 'next/navigation';

interface PostProps {
params: { id: string };
}

export default function PostPage({ params }: PostProps) {
const { id } = params;
// Fetch post data based on 'id'

return (
<div>
<h1>Post #{id}</h1>
<p>This is the content of post {id}.</p>
</div>
);
}
```
**AÃ§Ä±klama:**

* **Dinamik Segment:** `[id]`, URL'den `id` parametresini yakalayan bir dinamik segmenti belirtir.
* **Parametrelere EriÅŸim:** `params` nesnesi, bileÅŸen iÃ§inde eriÅŸilebilen dinamik parametreleri iÃ§erir.
* **Yol EÅŸleÅŸmesi:** `/posts/*` ile eÅŸleÅŸen herhangi bir yol, Ã¶rneÄŸin `/posts/1`, `/posts/abc` vb., bu bileÅŸen tarafÄ±ndan iÅŸlenecektir.

</details>

<details>

<summary>Ä°Ã§ Ä°Ã§e Yollar</summary>



Next.js, dizin yapÄ±sÄ±nÄ± yansÄ±tan hiyerarÅŸik yol yapÄ±larÄ± iÃ§in iÃ§ iÃ§e yÃ¶nlendirmeyi destekler.

**Ã–rnek: `/dashboard/settings/profile` Yolu**

**Dosya YapÄ±sÄ±:**
```arduino
arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Uygulama:**
```tsx
tsxCopy code// app/dashboard/settings/profile/page.tsx

export default function ProfileSettingsPage() {
return (
<div>
<h1>Profile Settings</h1>
<p>Manage your profile information here.</p>
</div>
);
}
```
**AÃ§Ä±klama:**

* **Derin YerleÅŸtirme:** `dashboard/settings/profile/` iÃ§indeki `page.tsx` dosyasÄ±, `/dashboard/settings/profile` rotasÄ±na karÅŸÄ±lÄ±k gelir.
* **HiyerarÅŸi YansÄ±masÄ±:** Dizin yapÄ±sÄ±, URL yolunu yansÄ±tarak bakÄ±m kolaylÄ±ÄŸÄ± ve netlik saÄŸlar.

</details>

<details>

<summary>Her Åeye Uyan Rotalar</summary>

Her ÅŸeye uyan rotalar, birden fazla iÃ§ iÃ§e segmenti veya bilinmeyen yollarÄ± yÃ¶netir, rota yÃ¶netiminde esneklik saÄŸlar.

**Ã–rnek: `/*` RotasÄ±**

**Dosya YapÄ±sÄ±:**
```arduino
my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ [..slug]/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Uygulama:**
```tsx
// app/[...slug]/page.tsx

interface CatchAllProps {
params: { slug: string[] };
}

export default function CatchAllPage({ params }: CatchAllProps) {
const { slug } = params;
const fullPath = `/${slug.join('/')}`;

return (
<div>
<h1>Catch-All Route</h1>
<p>You have navigated to: {fullPath}</p>
</div>
);
}
```
**AÃ§Ä±klama:**

* **Catch-All Segment:** `[...slug]` kalan tÃ¼m yol segmentlerini bir dizi olarak yakalar.
* **KullanÄ±m:** KullanÄ±cÄ± tarafÄ±ndan oluÅŸturulan yollar, iÃ§ iÃ§e kategoriler gibi dinamik yÃ¶nlendirme senaryolarÄ±nÄ± yÃ¶netmek iÃ§in yararlÄ±dÄ±r.
* **Yol EÅŸleÅŸtirme:** `/anything/here`, `/foo/bar/baz` gibi yollar bu bileÅŸen tarafÄ±ndan iÅŸlenir.

</details>

### Potansiyel Ä°stemci TarafÄ± GÃ¼venlik AÃ§Ä±klarÄ±

Next.js gÃ¼venli bir temel saÄŸlasa da, yanlÄ±ÅŸ kodlama uygulamalarÄ± gÃ¼venlik aÃ§Ä±klarÄ± oluÅŸturabilir. Ana istemci tarafÄ± gÃ¼venlik aÃ§Ä±klarÄ± ÅŸunlardÄ±r:

<details>

<summary>Cross-Site Scripting (XSS)</summary>

XSS saldÄ±rÄ±larÄ±, kÃ¶tÃ¼ niyetli betiklerin gÃ¼venilir web sitelerine enjekte edilmesiyle gerÃ§ekleÅŸir. SaldÄ±rganlar, kullanÄ±cÄ±larÄ±n tarayÄ±cÄ±larÄ±nda betikleri Ã§alÄ±ÅŸtÄ±rarak verileri Ã§alabilir veya kullanÄ±cÄ± adÄ±na eylemler gerÃ§ekleÅŸtirebilir.

**GÃ¼venlik AÃ§Ä±ÄŸÄ± Olan Kod Ã–rneÄŸi:**
```jsx
// Dangerous: Injecting user input directly into HTML
function Comment({ userInput }) {
return <div dangerouslySetInnerHTML={{ __html: userInput }} />;
}
```
**Neden ZayÄ±f:** GÃ¼venilmeyen girdi ile `dangerouslySetInnerHTML` kullanmak, saldÄ±rganlarÄ±n kÃ¶tÃ¼ niyetli betikler enjekte etmesine olanak tanÄ±r.

</details>

<details>

<summary>Ä°stemci TarafÄ± Åablon Enjeksiyonu</summary>

KullanÄ±cÄ± girdilerinin ÅŸablonlarda yanlÄ±ÅŸ bir ÅŸekilde iÅŸlenmesi durumunda meydana gelir, bu da saldÄ±rganlarÄ±n ÅŸablonlarÄ± veya ifadeleri enjekte edip Ã§alÄ±ÅŸtÄ±rmasÄ±na olanak tanÄ±r.

**ZayÄ±f Kodu Ã–rneÄŸi:**
```jsx
import React from 'react';
import ejs from 'ejs';

function RenderTemplate({ template, data }) {
const html = ejs.render(template, data);
return <div dangerouslySetInnerHTML={{ __html: html }} />;
}
```
**Neden ZayÄ±f:** EÄŸer `template` veya `data` kÃ¶tÃ¼ niyetli iÃ§erik iÃ§eriyorsa, istenmeyen kodun Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±na yol aÃ§abilir.

</details>

<details>

<summary>Ä°stemci Yol GeÃ§iÅŸi</summary>

Bu, saldÄ±rganlarÄ±n istemci tarafÄ± yollarÄ±nÄ± manipÃ¼le ederek istenmeyen eylemler gerÃ§ekleÅŸtirmesine olanak tanÄ±yan bir zayÄ±flÄ±ktÄ±r; Ã¶rneÄŸin, Cross-Site Request Forgery (CSRF). Sunucu tarafÄ± yol geÃ§iÅŸinin aksine, bu zayÄ±flÄ±k sunucunun dosya sistemini hedef almak yerine, meÅŸru API isteklerini kÃ¶tÃ¼ niyetli uÃ§ noktalara yÃ¶nlendirmek iÃ§in istemci tarafÄ± mekanizmalarÄ±nÄ± istismar etmeye odaklanÄ±r.

**ZayÄ±f Kod Ã–rneÄŸi:**

Bir Next.js uygulamasÄ±, kullanÄ±cÄ±larÄ±n dosya yÃ¼klemesine ve indirmesine olanak tanÄ±r. Ä°ndirme Ã¶zelliÄŸi istemci tarafÄ±nda uygulanmÄ±ÅŸtÄ±r; burada kullanÄ±cÄ±lar indirmek iÃ§in dosya yolunu belirtebilir.
```jsx
// pages/download.js
import { useState } from 'react';

export default function DownloadPage() {
const [filePath, setFilePath] = useState('');

const handleDownload = () => {
fetch(`/api/files/${filePath}`)
.then(response => response.blob())
.then(blob => {
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = filePath;
a.click();
});
};

return (
<div>
<h1>Download File</h1>
<input
type="text"
value={filePath}
onChange={(e) => setFilePath(e.target.value)}
placeholder="Enter file path"
/>
<button onClick={handleDownload}>Download</button>
</div>
);
}
```
#### SaldÄ±rÄ± Senaryosu

1. **SaldÄ±rganÄ±n AmacÄ±**: `filePath`'i manipÃ¼le ederek kritik bir dosyayÄ± (Ã¶rneÄŸin, `admin/config.json`) silmek iÃ§in bir CSRF saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirmek.
2. **CSPT'yi SÃ¶mÃ¼rmek**:
* **KÃ¶tÃ¼ AmaÃ§lÄ± Girdi**: SaldÄ±rgan, `../deleteFile/config.json` gibi manipÃ¼le edilmiÅŸ bir `filePath` ile bir URL oluÅŸturur.
* **SonuÃ§lanan API Ã‡aÄŸrÄ±sÄ±**: Ä°stemci tarafÄ±ndaki kod, `/api/files/../deleteFile/config.json` adresine bir istek gÃ¶nderir.
* **Sunucunun Ä°ÅŸlemesi**: Sunucu `filePath`'i doÄŸrulamÄ±yorsa, isteÄŸi iÅŸler ve hassas dosyalarÄ± silme veya ifÅŸa etme riski taÅŸÄ±r.
3. **CSRF'yi GerÃ§ekleÅŸtirme**:
* **HazÄ±rlanan BaÄŸlantÄ±**: SaldÄ±rgan, kurbanÄ±na manipÃ¼le edilmiÅŸ `filePath` ile indirme isteÄŸini tetikleyen bir baÄŸlantÄ± gÃ¶nderir veya kÃ¶tÃ¼ amaÃ§lÄ± bir script gÃ¶mÃ¼lÃ¼ bir ÅŸekilde iletir.
* **SonuÃ§**: Kurban, farkÄ±nda olmadan iÅŸlemi gerÃ§ekleÅŸtirir ve yetkisiz dosya eriÅŸimi veya silme ile sonuÃ§lanÄ±r.

#### Neden ZayÄ±f

* **Girdi DoÄŸrulama EksikliÄŸi**: Ä°stemci tarafÄ±, keyfi `filePath` girdilerine izin vererek yol geÃ§iÅŸine olanak tanÄ±r.
* **Ä°stemci Girdilerine GÃ¼venme**: Sunucu tarafÄ±ndaki API, `filePath`'i temizlemeden gÃ¼venip iÅŸler.
* **Potansiyel API Eylemleri**: EÄŸer API uÃ§ noktasÄ± durum deÄŸiÅŸtiren eylemler gerÃ§ekleÅŸtiriyorsa (Ã¶rneÄŸin, dosya silme, deÄŸiÅŸtirme), CSPT aracÄ±lÄ±ÄŸÄ±yla sÃ¶mÃ¼rÃ¼lebilir.

</details>

## Next.js'de Sunucu TarafÄ±

### Sunucu TarafÄ± Render'Ä± (SSR)

Sayfalar her istekte sunucuda render edilir, bÃ¶ylece kullanÄ±cÄ± tamamen render edilmiÅŸ HTML alÄ±r. Bu durumda, istekleri iÅŸlemek iÃ§in kendi Ã¶zel sunucunuzu oluÅŸturmalÄ±sÄ±nÄ±z.

**KullanÄ±m DurumlarÄ±:**

* SÄ±k sÄ±k deÄŸiÅŸen dinamik iÃ§erik.
* Arama motorlarÄ±nÄ±n tamamen render edilmiÅŸ sayfayÄ± tarayabilmesi nedeniyle SEO optimizasyonu.

**Uygulama:**
```jsx
// pages/index.js
export async function getServerSideProps(context) {
const res = await fetch('https://api.example.com/data');
const data = await res.json();
return { props: { data } };
}

function HomePage({ data }) {
return <div>{data.title}</div>;
}

export default HomePage;
```
### Statik Site OluÅŸturma (SSG)

Sayfalar, inÅŸa zamanÄ± Ã¶nceden iÅŸlenir, bu da daha hÄ±zlÄ± yÃ¼kleme sÃ¼releri ve azaltÄ±lmÄ±ÅŸ sunucu yÃ¼kÃ¼ saÄŸlar.

**KullanÄ±m DurumlarÄ±:**

* SÄ±k deÄŸiÅŸmeyen iÃ§erikler.
* Bloglar, belgeler, pazarlama sayfalarÄ±.

**Uygulama:**
```jsx
// pages/index.js
export async function getStaticProps() {
const res = await fetch('https://api.example.com/data');
const data = await res.json();
return { props: { data }, revalidate: 60 }; // Revalidate every 60 seconds
}

function HomePage({ data }) {
return <div>{data.title}</div>;
}

export default HomePage;
```
### Sunucusuz Fonksiyonlar (API YollarÄ±)

Next.js, sunucusuz fonksiyonlar olarak API uÃ§ noktalarÄ±nÄ±n oluÅŸturulmasÄ±na olanak tanÄ±r. Bu fonksiyonlar, Ã¶zel bir sunucuya ihtiyaÃ§ duymadan talep Ã¼zerine Ã§alÄ±ÅŸÄ±r.

**KullanÄ±m DurumlarÄ±:**

* Form gÃ¶nderimlerini iÅŸleme.
* VeritabanlarÄ±yla etkileÅŸim.
* Verileri iÅŸleme veya Ã¼Ã§Ã¼ncÃ¼ taraf API'lerle entegrasyon.

**Uygulama:**

Next.js 13 ile birlikte `app` dizininin tanÄ±tÄ±lmasÄ±, yÃ¶nlendirme ve API yÃ¶netimini daha esnek ve gÃ¼Ã§lÃ¼ hale getirmiÅŸtir. Bu modern yaklaÅŸÄ±m, dosya tabanlÄ± yÃ¶nlendirme sistemiyle yakÄ±ndan uyumlu olup, sunucu ve istemci bileÅŸenleri desteÄŸi gibi geliÅŸtirilmiÅŸ yetenekler sunar.

#### Temel YÃ¶nlendirme Ä°ÅŸleyici

**Dosya YapÄ±sÄ±:**
```go
my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello/
â”‚           â””â”€â”€ route.js
â”œâ”€â”€ package.json
â””â”€â”€ ...
```
**Uygulama:**
```javascript
// app/api/hello/route.js

export async function POST(request) {
return new Response(JSON.stringify({ message: 'Hello from App Router!' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

// Client-side fetch to access the API endpoint
fetch('/api/submit', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ name: 'John Doe' }),
})
.then((res) => res.json())
.then((data) => console.log(data));
```
**AÃ§Ä±klama:**

* **Konum:** API yollarÄ± `app/api/` dizini altÄ±nda yer alÄ±r.
* **Dosya Ä°simlendirme:** Her API uÃ§ noktasÄ±, iÃ§inde bir `route.js` veya `route.ts` dosyasÄ± bulunan kendi klasÃ¶rÃ¼nde bulunur.
* **Ä°hracat FonksiyonlarÄ±:** Tek bir varsayÄ±lan ihracat yerine, belirli HTTP yÃ¶ntem fonksiyonlarÄ± (Ã¶rneÄŸin, `GET`, `POST`) ihraÃ§ edilir.
* **YanÄ±t YÃ¶netimi:** YanÄ±tlarÄ± dÃ¶ndÃ¼rmek iÃ§in `Response` yapÄ±cÄ±sÄ±nÄ± kullanÄ±n, bu da baÅŸlÄ±klar ve durum kodlarÄ± Ã¼zerinde daha fazla kontrol saÄŸlar.

#### DiÄŸer yollar ve yÃ¶ntemler nasÄ±l yÃ¶netilir:

<details>

<summary>Belirli HTTP YÃ¶ntemlerini YÃ¶netme</summary>



Next.js 13+ aynÄ± `route.js` veya `route.ts` dosyasÄ± iÃ§inde belirli HTTP yÃ¶ntemleri iÃ§in iÅŸleyiciler tanÄ±mlamanÄ±za olanak tanÄ±r, bu da daha net ve dÃ¼zenli bir kodu teÅŸvik eder.

**Ã–rnek:**
```javascript
// app/api/users/[id]/route.js

export async function GET(request, { params }) {
const { id } = params;
// Fetch user data based on 'id'
return new Response(JSON.stringify({ userId: id, name: 'Jane Doe' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

export async function PUT(request, { params }) {
const { id } = params;
// Update user data based on 'id'
return new Response(JSON.stringify({ message: `User ${id} updated.` }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

export async function DELETE(request, { params }) {
const { id } = params;
// Delete user based on 'id'
return new Response(JSON.stringify({ message: `User ${id} deleted.` }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
```
**AÃ§Ä±klama:**

* **Birden Fazla Ä°hracat:** Her HTTP yÃ¶ntemi (`GET`, `PUT`, `DELETE`) kendi ihraÃ§ edilen fonksiyonuna sahiptir.
* **Parametreler:** Ä°kinci argÃ¼man, `params` aracÄ±lÄ±ÄŸÄ±yla rota parametrelerine eriÅŸim saÄŸlar.
* **GeliÅŸmiÅŸ YanÄ±tlar:** YanÄ±t nesneleri Ã¼zerinde daha fazla kontrol, hassas baÅŸlÄ±k ve durum kodu yÃ¶netimi saÄŸlar.

</details>

<details>

<summary>Her Åeye Uyan ve Ä°Ã§ Ä°Ã§e Rotalar</summary>



Next.js 13+ , daha dinamik ve Ã¶lÃ§eklenebilir API yapÄ±larÄ± saÄŸlamak iÃ§in her ÅŸeye uyan rotalar ve iÃ§ iÃ§e API rotalarÄ± gibi geliÅŸmiÅŸ yÃ¶nlendirme Ã¶zelliklerini destekler.

**Her Åeye Uyan Rota Ã–rneÄŸi:**
```javascript
// app/api/[...slug]/route.js

export async function GET(request, { params }) {
const { slug } = params;
// Handle dynamic nested routes
return new Response(JSON.stringify({ slug }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
```
**AÃ§Ä±klama:**

* **SÃ¶zdizimi:** `[...]` tÃ¼m iÃ§ iÃ§e geÃ§miÅŸ yollarÄ± yakalayan bir kapsayÄ±cÄ± segmenti belirtir.
* **KullanÄ±m:** FarklÄ± rota derinliklerini veya dinamik segmentleri iÅŸlemek iÃ§in gereken API'ler iÃ§in yararlÄ±dÄ±r.

**Ä°Ã§ Ä°Ã§e GeÃ§miÅŸ Rotalar Ã–rneÄŸi:**
```javascript
// app/api/posts/[postId]/comments/[commentId]/route.js

export async function GET(request, { params }) {
const { postId, commentId } = params;
// Fetch specific comment for a post
return new Response(JSON.stringify({ postId, commentId, comment: 'Great post!' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
```
**AÃ§Ä±klama:**

* **Derin YerleÅŸtirme:** Kaynak iliÅŸkilerini yansÄ±tan hiyerarÅŸik API yapÄ±larÄ± iÃ§in olanak tanÄ±r.
* **Parametre EriÅŸimi:** `params` nesnesi aracÄ±lÄ±ÄŸÄ±yla birden fazla rota parametresine kolayca eriÅŸim saÄŸlar.

</details>

<details>

<summary>Next.js 12 ve Ã–ncesinde API RotalarÄ±nÄ± YÃ¶netme</summary>

## `pages` Dizini Ä°Ã§indeki API RotalarÄ± (Next.js 12 ve Ã–ncesi)

Next.js 13, `app` dizinini tanÄ±ttÄ±ktan ve yÃ¶nlendirme yeteneklerini geliÅŸtirdikten Ã¶nce, API rotalarÄ± esasen `pages` dizini iÃ§inde tanÄ±mlanÄ±yordu. Bu yaklaÅŸÄ±m hala yaygÄ±n olarak kullanÄ±lmakta ve Next.js 12 ve Ã¶nceki sÃ¼rÃ¼mlerde desteklenmektedir.

#### Temel API RotasÄ±

**Dosya YapÄ±sÄ±:**
```go
goCopy codemy-nextjs-app/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello.js
â”œâ”€â”€ package.json
â””â”€â”€ ...
```
**Uygulama:**
```javascript
javascriptCopy code// pages/api/hello.js

export default function handler(req, res) {
res.status(200).json({ message: 'Hello, World!' });
}
```
**AÃ§Ä±klama:**

* **Konum:** API yollarÄ± `pages/api/` dizini altÄ±nda bulunur.
* **Ä°hracat:** Ä°ÅŸlev tanÄ±mlamak iÃ§in `export default` kullanÄ±n.
* **Fonksiyon Ä°mzasÄ±:** Ä°ÅŸlev, `req` (HTTP isteÄŸi) ve `res` (HTTP yanÄ±tÄ±) nesnelerini alÄ±r.
* **YÃ¶nlendirme:** Dosya adÄ± (`hello.js`), `/api/hello` uÃ§ noktasÄ±na karÅŸÄ±lÄ±k gelir.

#### Dinamik API YollarÄ±

**Dosya YapÄ±sÄ±:**
```bash
bashCopy codemy-nextjs-app/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ users/
â”‚           â””â”€â”€ [id].js
â”œâ”€â”€ package.json
â””â”€â”€ ...
```
**Uygulama:**
```javascript
javascriptCopy code// pages/api/users/[id].js

export default function handler(req, res) {
const {
query: { id },
method,
} = req;

switch (method) {
case 'GET':
// Fetch user data based on 'id'
res.status(200).json({ userId: id, name: 'John Doe' });
break;
case 'PUT':
// Update user data based on 'id'
res.status(200).json({ message: `User ${id} updated.` });
break;
case 'DELETE':
// Delete user based on 'id'
res.status(200).json({ message: `User ${id} deleted.` });
break;
default:
res.setHeader('Allow', ['GET', 'PUT', 'DELETE']);
res.status(405).end(`Method ${method} Not Allowed`);
}
}
```
**AÃ§Ä±klama:**

* **Dinamik Segmentler:** Kare parantezler (`[id].js`) dinamik rota segmentlerini belirtir.
* **Parametrelere EriÅŸim:** Dinamik parametreye eriÅŸmek iÃ§in `req.query.id` kullanÄ±n.
* **YÃ¶ntemleri YÃ¶netme:** FarklÄ± HTTP yÃ¶ntemlerini (`GET`, `PUT`, `DELETE`, vb.) yÃ¶netmek iÃ§in koÅŸullu mantÄ±k kullanÄ±n.

#### FarklÄ± HTTP YÃ¶ntemlerini YÃ¶netme

Temel API rota Ã¶rneÄŸi tÃ¼m HTTP yÃ¶ntemlerini tek bir fonksiyon iÃ§inde yÃ¶netirken, kodunuzu her yÃ¶ntemi aÃ§Ä±kÃ§a yÃ¶netmek iÃ§in yapÄ±landÄ±rabilirsiniz, bu da daha iyi bir netlik ve sÃ¼rdÃ¼rÃ¼lebilirlik saÄŸlar.

**Ã–rnek:**
```javascript
javascriptCopy code// pages/api/posts.js

export default async function handler(req, res) {
const { method } = req;

switch (method) {
case 'GET':
// Handle GET request
res.status(200).json({ message: 'Fetching posts.' });
break;
case 'POST':
// Handle POST request
res.status(201).json({ message: 'Post created.' });
break;
default:
res.setHeader('Allow', ['GET', 'POST']);
res.status(405).end(`Method ${method} Not Allowed`);
}
}
```
**En Ä°yi Uygulamalar:**

* **EndiÅŸelerin AyrÄ±lmasÄ±:** FarklÄ± HTTP yÃ¶ntemleri iÃ§in mantÄ±ÄŸÄ± net bir ÅŸekilde ayÄ±rÄ±n.
* **YanÄ±t TutarlÄ±lÄ±ÄŸÄ±:** Ä°stemci tarafÄ±nda kolay kullanÄ±m iÃ§in tutarlÄ± yanÄ±t yapÄ±larÄ± saÄŸlayÄ±n.
* **Hata YÃ¶netimi:** Desteklenmeyen yÃ¶ntemleri ve beklenmeyen hatalarÄ± nazikÃ§e yÃ¶netin.

</details>

### CORS YapÄ±landÄ±rmasÄ±

API rotalarÄ±nÄ±za hangi kÃ¶kenlerin eriÅŸebileceÄŸini kontrol edin, Cross-Origin Resource Sharing (CORS) zafiyetlerini azaltÄ±n.

**KÃ¶tÃ¼ YapÄ±landÄ±rma Ã–rneÄŸi:**
```javascript
// app/api/data/route.js

export async function GET(request) {
return new Response(JSON.stringify({ data: 'Public Data' }), {
status: 200,
headers: {
'Access-Control-Allow-Origin': '*', // Allows any origin
'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
},
});
}
```
Not edin ki **CORS, tÃ¼m API yollarÄ±nda da yapÄ±landÄ±rÄ±labilir** **`middleware.ts`** dosyasÄ± iÃ§inde:
```javascript
// app/middleware.ts

import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
const allowedOrigins = ['https://yourdomain.com', 'https://sub.yourdomain.com'];
const origin = request.headers.get('Origin');

const response = NextResponse.next();

if (allowedOrigins.includes(origin || '')) {
response.headers.set('Access-Control-Allow-Origin', origin || '');
response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');
// If credentials are needed:
// response.headers.set('Access-Control-Allow-Credentials', 'true');
}

// Handle preflight requests
if (request.method === 'OPTIONS') {
return new Response(null, {
status: 204,
headers: response.headers,
});
}

return response;
}

export const config = {
matcher: '/api/:path*', // Apply to all API routes
};

```
**Problem:**

* **`Access-Control-Allow-Origin: '*'`:** Herhangi bir web sitesinin API'ye eriÅŸmesine izin verir, bu da kÃ¶tÃ¼ niyetli sitelerin API'nizle sÄ±nÄ±rsÄ±z etkileÅŸimde bulunmasÄ±na olanak tanÄ±yabilir.
* **GeniÅŸ YÃ¶ntem Ä°zni:** TÃ¼m yÃ¶ntemlere izin vermek, saldÄ±rganlarÄ±n istenmeyen eylemler gerÃ§ekleÅŸtirmesine olanak tanÄ±yabilir.

**SaldÄ±rganlarÄ±n bunu nasÄ±l istismar ettiÄŸi:**

SaldÄ±rganlar, API'nize istek gÃ¶nderen kÃ¶tÃ¼ niyetli web siteleri oluÅŸturabilir, bu da veri alma, veri manipÃ¼lasyonu veya kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ kullanÄ±cÄ±lar adÄ±na istenmeyen eylemleri tetikleme gibi iÅŸlevleri kÃ¶tÃ¼ye kullanmalarÄ±na neden olabilir.

{% content-ref url="../../pentesting-web/cors-bypass.md" %}
[cors-bypass.md](../../pentesting-web/cors-bypass.md)
{% endcontent-ref %}

## Sunucu kodunun Ä°stemci TarafÄ±nda AÃ§Ä±ÄŸa Ã‡Ä±kmasÄ±

**Sunucu tarafÄ±ndan kullanÄ±lan kodun istemci tarafÄ±nda da kullanÄ±lmasÄ±nÄ± saÄŸlamak kolaydÄ±r**, bir kod dosyasÄ±nÄ±n istemci tarafÄ±nda asla aÃ§Ä±ÄŸa Ã§Ä±kmadÄ±ÄŸÄ±ndan emin olmanÄ±n en iyi yolu, dosyanÄ±n baÅŸÄ±nda bu import'u kullanmaktÄ±r:
```js
import "server-only";
```
## Ana Dosyalar ve Rolleri

### `middleware.ts` / `middleware.js`

**Konum:** Projenin kÃ¶kÃ¼nde veya `src/` iÃ§inde.

**AmaÃ§:** Bir isteÄŸin iÅŸlenmesinden Ã¶nce sunucu tarafÄ±nda sunucusuz iÅŸlevde kodu Ã§alÄ±ÅŸtÄ±rarak, kimlik doÄŸrulama, yÃ¶nlendirmeler veya yanÄ±tlarÄ± deÄŸiÅŸtirme gibi gÃ¶revleri yerine getirir.

**Ä°ÅŸlem AkÄ±ÅŸÄ±:**

1. **Gelen Ä°stek:** Middleware isteÄŸi yakalar.
2. **Ä°ÅŸleme:** Ä°steÄŸe baÄŸlÄ± olarak iÅŸlemler gerÃ§ekleÅŸtirir (Ã¶rneÄŸin, kimlik doÄŸrulama kontrolÃ¼).
3. **YanÄ±t DeÄŸiÅŸikliÄŸi:** YanÄ±tÄ± deÄŸiÅŸtirebilir veya kontrolÃ¼ bir sonraki iÅŸleyiciye geÃ§irebilir.

**Ã–rnek KullanÄ±m DurumlarÄ±:**

* Kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ kullanÄ±cÄ±larÄ± yÃ¶nlendirme.
* Ã–zel baÅŸlÄ±klar ekleme.
* Ä°stekleri gÃ¼nlÃ¼ÄŸe kaydetme.

**Ã–rnek KonfigÃ¼rasyon:**
```typescript
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(req: NextRequest) {
const url = req.nextUrl.clone();
if (!req.cookies.has('token')) {
url.pathname = '/login';
return NextResponse.redirect(url);
}
return NextResponse.next();
}

export const config = {
matcher: ['/protected/:path*'],
};
```
### `next.config.js`

**Konum:** Projenin kÃ¶kÃ¼.

**AmaÃ§:** Next.js davranÄ±ÅŸÄ±nÄ± yapÄ±landÄ±rÄ±r, Ã¶zellikleri etkinleÅŸtirir veya devre dÄ±ÅŸÄ± bÄ±rakÄ±r, webpack yapÄ±landÄ±rmalarÄ±nÄ± Ã¶zelleÅŸtirir, ortam deÄŸiÅŸkenlerini ayarlar ve Ã§eÅŸitli gÃ¼venlik Ã¶zelliklerini yapÄ±landÄ±rÄ±r.

**Ana GÃ¼venlik YapÄ±landÄ±rmalarÄ±:**

<details>

<summary>GÃ¼venlik BaÅŸlÄ±klarÄ±</summary>

GÃ¼venlik baÅŸlÄ±klarÄ±, tarayÄ±cÄ±lara iÃ§eriÄŸi nasÄ±l iÅŸleyecekleri konusunda talimat vererek uygulamanÄ±zÄ±n gÃ¼venliÄŸini artÄ±rÄ±r. Cross-Site Scripting (XSS), Clickjacking ve MIME tÃ¼rÃ¼ sniffing gibi Ã§eÅŸitli saldÄ±rÄ±larÄ± azaltmaya yardÄ±mcÄ± olurlar:

* Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP)
* X-Frame-Options
* X-Content-Type-Options
* Strict-Transport-Security (HSTS)
* Referrer Policy

**Ã–rnekler:**
```javascript
// next.config.js

module.exports = {
async headers() {
return [
{
source: '/(.*)', // Apply to all routes
headers: [
{
key: 'X-Frame-Options',
value: 'DENY',
},
{
key: 'Content-Security-Policy',
value: "default-src *; script-src 'self' 'unsafe-inline' 'unsafe-eval';",
},
{
key: 'X-Content-Type-Options',
value: 'nosniff',
},
{
key: 'Strict-Transport-Security',
value: 'max-age=63072000; includeSubDomains; preload', // Enforces HTTPS
},
{
key: 'Referrer-Policy',
value: 'no-referrer', // Completely hides referrer
},
// Additional headers...
],
},
];
},
};
```
</details>

<details>

<summary>GÃ¶rÃ¼ntÃ¼ Optimizasyon AyarlarÄ±</summary>

Next.js, performans iÃ§in gÃ¶rÃ¼ntÃ¼leri optimize eder, ancak yanlÄ±ÅŸ yapÄ±landÄ±rmalar gÃ¼venlik aÃ§Ä±klarÄ±na yol aÃ§abilir; Ã¶rneÄŸin, gÃ¼venilmeyen kaynaklarÄ±n kÃ¶tÃ¼ niyetli iÃ§erik enjekte etmesine izin vermek.

**KÃ¶tÃ¼ YapÄ±landÄ±rma Ã–rneÄŸi:**
```javascript
// next.config.js

module.exports = {
images: {
domains: ['*'], // Allows images from any domain
},
};
```
**Problem:**

* **`'*'`:** Herhangi bir dÄ±ÅŸ kaynaktan, gÃ¼venilir olmayan veya kÃ¶tÃ¼ niyetli alanlar dahil, gÃ¶rÃ¼ntÃ¼lerin yÃ¼klenmesine izin verir. SaldÄ±rganlar, kÃ¶tÃ¼ niyetli yÃ¼kler veya kullanÄ±cÄ±larÄ± yanÄ±ltan iÃ§erikler iÃ§eren gÃ¶rÃ¼ntÃ¼leri barÄ±ndÄ±rabilir.
* BaÅŸka bir sorun, **herkesin bir gÃ¶rÃ¼ntÃ¼ yÃ¼kleyebileceÄŸi bir alanÄ±** (Ã¶rneÄŸin `raw.githubusercontent.com`) izin vermek olabilir.

**How attackers abuse it:**

KÃ¶tÃ¼ niyetli kaynaklardan gÃ¶rÃ¼ntÃ¼ler enjekte ederek, saldÄ±rganlar kimlik avÄ± saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirebilir, yanÄ±ltÄ±cÄ± bilgiler gÃ¶sterebilir veya gÃ¶rÃ¼ntÃ¼ iÅŸleme kÃ¼tÃ¼phanelerindeki zayÄ±flÄ±klarÄ± istismar edebilir.

</details>

<details>

<summary>Environment Variables Exposure</summary>

API anahtarlarÄ± ve veritabanÄ± kimlik bilgileri gibi hassas bilgileri, bunlarÄ± istemciye ifÅŸa etmeden gÃ¼venli bir ÅŸekilde yÃ¶netin.

#### a. Exposing Sensitive Variables

**Bad Configuration Example:**
```javascript
// next.config.js

module.exports = {
env: {
SECRET_API_KEY: process.env.SECRET_API_KEY, // Exposed to the client
NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL, // Correctly prefixed for client
},
};
```
**Problem:**

* **`SECRET_API_KEY`:** `NEXT_PUBLIC_` Ã¶n eki olmadan, Next.js deÄŸiÅŸkenleri istemciye aÃ§maz. Ancak, yanlÄ±ÅŸlÄ±kla Ã¶n ek verilirse (Ã¶rneÄŸin, `NEXT_PUBLIC_SECRET_API_KEY`), istemci tarafÄ±nda eriÅŸilebilir hale gelir.

**How attackers abuse it:**

EÄŸer hassas deÄŸiÅŸkenler istemciye aÃ§Ä±lÄ±rsa, saldÄ±rganlar bunlarÄ± istemci tarafÄ± kodunu veya aÄŸ isteklerini inceleyerek alabilir, API'lere, veritabanlarÄ±na veya diÄŸer hizmetlere yetkisiz eriÅŸim kazanabilirler.

</details>

<details>

<summary>Redirects</summary>

UygulamanÄ±z iÃ§inde URL yÃ¶nlendirmelerini ve yeniden yazmalarÄ±nÄ± yÃ¶netin, kullanÄ±cÄ±larÄ±n uygun ÅŸekilde yÃ¶nlendirilmesini saÄŸlayÄ±n ve aÃ§Ä±k yÃ¶nlendirme gÃ¼venlik aÃ§Ä±klarÄ± oluÅŸturmaktan kaÃ§Ä±nÄ±n.

#### a. Open Redirect Vulnerability

**Bad Configuration Example:**
```javascript
// next.config.js

module.exports = {
async redirects() {
return [
{
source: '/redirect',
destination: (req) => req.query.url, // Dynamically redirects based on query parameter
permanent: false,
},
];
},
};
```
**Problem:**

* **Dinamik Hedef:** KullanÄ±cÄ±larÄ±n herhangi bir URL belirtmesine izin verir, aÃ§Ä±k yÃ¶nlendirme saldÄ±rÄ±larÄ±na olanak tanÄ±r.
* **KullanÄ±cÄ± Girdisine GÃ¼venme:** KullanÄ±cÄ±lar tarafÄ±ndan saÄŸlanan URL'lere doÄŸrulama olmadan yÃ¶nlendirme, kimlik avÄ±, kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m daÄŸÄ±tÄ±mÄ± veya kimlik bilgisi hÄ±rsÄ±zlÄ±ÄŸÄ±na yol aÃ§abilir.

**SaldÄ±rganlarÄ±n bunu nasÄ±l kÃ¶tÃ¼ye kullandÄ±ÄŸÄ±:**

SaldÄ±rganlar, sizin alan adÄ±nÄ±zdan geliyormuÅŸ gibi gÃ¶rÃ¼nen URL'ler oluÅŸturabilir, ancak kullanÄ±cÄ±larÄ± kÃ¶tÃ¼ amaÃ§lÄ± sitelere yÃ¶nlendirebilir. Ã–rneÄŸin:
```bash
https://yourdomain.com/redirect?url=https://malicious-site.com
```
KullanÄ±cÄ±lar, orijinal alan adÄ±na gÃ¼venerek, farkÄ±nda olmadan zararlÄ± web sitelerine gidebilirler.

</details>

<details>

<summary>Webpack YapÄ±landÄ±rmasÄ±</summary>

Next.js uygulamanÄ±z iÃ§in Webpack yapÄ±landÄ±rmalarÄ±nÄ± Ã¶zelleÅŸtirin; bu, dikkatli bir ÅŸekilde ele alÄ±nmadÄ±ÄŸÄ±nda gÃ¼venlik aÃ§Ä±klarÄ± oluÅŸturabilir.

#### a. Hassas ModÃ¼lleri AÃ§Ä±ÄŸa Ã‡Ä±karma

**KÃ¶tÃ¼ YapÄ±landÄ±rma Ã–rneÄŸi:**
```javascript
// next.config.js

module.exports = {
webpack: (config, { isServer }) => {
if (!isServer) {
config.resolve.alias['@sensitive'] = path.join(__dirname, 'secret-folder');
}
return config;
},
};
```
**Sorun:**

* **Hassas YollarÄ± AÃ§Ä±ÄŸa Ã‡Ä±karma:** Hassas dizinlerin takma adÄ±nÄ± vermek ve istemci tarafÄ± eriÅŸimine izin vermek, gizli bilgilerin sÄ±zmasÄ±na neden olabilir.
* **SÄ±rlarÄ± Paketleme:** Hassas dosyalar istemci iÃ§in paketlenirse, iÃ§erikleri kaynak haritalarÄ± veya istemci tarafÄ± kodunu inceleyerek eriÅŸilebilir hale gelir.

**SaldÄ±rganlarÄ±n bunu nasÄ±l kÃ¶tÃ¼ye kullandÄ±ÄŸÄ±:**

SaldÄ±rganlar, uygulamanÄ±n dizin yapÄ±sÄ±na eriÅŸebilir veya bunu yeniden oluÅŸturabilir, bu da hassas dosyalarÄ± veya verileri bulup istismar etme potansiyeli taÅŸÄ±r.

</details>

### `pages/_app.js` ve `pages/_document.js`

#### **`pages/_app.js`**

**AmaÃ§:** VarsayÄ±lan App bileÅŸenini geÃ§ersiz kÄ±lar, global durum, stiller ve dÃ¼zen bileÅŸenleri iÃ§in olanak tanÄ±r.

**KullanÄ±m DurumlarÄ±:**

* Global CSS ekleme.
* DÃ¼zen sarmalayÄ±cÄ±larÄ± ekleme.
* Durum yÃ¶netim kÃ¼tÃ¼phanelerini entegre etme.

**Ã–rnek:**
```jsx
// pages/_app.js
import '../styles/globals.css';

function MyApp({ Component, pageProps }) {
return <Component {...pageProps} />;
}

export default MyApp;
```
#### **`pages/_document.js`**

**AmaÃ§:** VarsayÄ±lan Belgeyi geÃ§ersiz kÄ±lar, HTML ve Body etiketlerinin Ã¶zelleÅŸtirilmesine olanak tanÄ±r.

**KullanÄ±m DurumlarÄ±:**

* `<html>` veya `<body>` etiketlerini deÄŸiÅŸtirme.
* Meta etiketleri veya Ã¶zel betikler ekleme.
* ÃœÃ§Ã¼ncÃ¼ taraf yazÄ± tiplerini entegre etme.

**Ã–rnek:**
```jsx
// pages/_document.js
import Document, { Html, Head, Main, NextScript } from 'next/document';

class MyDocument extends Document {
render() {
return (
<Html lang="en">
<Head>
{/* Custom fonts or meta tags */}
</Head>
<body>
<Main />
<NextScript />
</body>
</Html>
);
}
}

export default MyDocument;
```
### Ã–zel Sunucu (Ä°steÄŸe BaÄŸlÄ±)

**AmaÃ§:** Next.js yerleÅŸik bir sunucu ile birlikte gelse de, Ã¶zel yÃ¶nlendirme veya mevcut arka uÃ§ hizmetleri ile entegrasyon gibi geliÅŸmiÅŸ kullanÄ±m senaryolarÄ± iÃ§in Ã¶zel bir sunucu oluÅŸturabilirsiniz.

**Not:** Ã–zel bir sunucu kullanmak, Ã¶zellikle Next.js'in yerleÅŸik sunucusu iÃ§in optimize eden Vercel gibi platformlarda daÄŸÄ±tÄ±m seÃ§eneklerini sÄ±nÄ±rlayabilir.

**Ã–rnek:**
```javascript
// server.js
const express = require('express');
const next = require('next');

const dev = process.env.NODE_ENV !== 'production';
const app = next({ dev });
const handle = app.getRequestHandler();

app.prepare().then(() => {
const server = express();

// Custom route
server.get('/a', (req, res) => {
return app.render(req, res, '/a');
});

// Default handler
server.all('*', (req, res) => {
return handle(req, res);
});

server.listen(3000, (err) => {
if (err) throw err;
console.log('> Ready on http://localhost:3000');
});
});
```
***

## Ek Mimari ve GÃ¼venlik Dikkatleri

### Ortam DeÄŸiÅŸkenleri ve YapÄ±landÄ±rma

**AmaÃ§:** Hassas bilgileri ve yapÄ±landÄ±rma ayarlarÄ±nÄ± kod tabanÄ±nÄ±n dÄ±ÅŸÄ±nda yÃ¶netmek.

**En Ä°yi Uygulamalar:**

* **`.env` DosyalarÄ±nÄ± KullanÄ±n:** API anahtarlarÄ± gibi deÄŸiÅŸkenleri `.env.local` iÃ§inde saklayÄ±n (versiyon kontrolÃ¼nden hariÃ§).
* **DeÄŸiÅŸkenlere GÃ¼venli EriÅŸim:** Ortam deÄŸiÅŸkenlerine eriÅŸmek iÃ§in `process.env.VARIABLE_NAME` kullanÄ±n.
* **Gizli Bilgileri Ä°stemci TarafÄ±nda Asla AÃ§Ä±ÄŸa Ã‡Ä±karmayÄ±n:** Hassas deÄŸiÅŸkenlerin yalnÄ±zca sunucu tarafÄ±nda kullanÄ±ldÄ±ÄŸÄ±ndan emin olun.

**Ã–rnek:**
```javascript
// next.config.js
module.exports = {
env: {
API_KEY: process.env.API_KEY, // Accessible on both client and server
SECRET_KEY: process.env.SECRET_KEY, // Be cautious if accessible on the client
},
};
```
**Not:** DeÄŸiÅŸkenleri yalnÄ±zca sunucu tarafÄ±nda kÄ±sÄ±tlamak iÃ§in, `env` nesnesinden Ã§Ä±karÄ±n veya istemciye maruz kalma iÃ§in `NEXT_PUBLIC_` ile Ã¶neki ekleyin.

### Kimlik DoÄŸrulama ve Yetkilendirme

**YaklaÅŸÄ±m:**

* **Oturum TabanlÄ± Kimlik DoÄŸrulama:** KullanÄ±cÄ± oturumlarÄ±nÄ± yÃ¶netmek iÃ§in Ã§erezleri kullanÄ±n.
* **Token TabanlÄ± Kimlik DoÄŸrulama:** Durumsuz kimlik doÄŸrulama iÃ§in JWT'leri uygulayÄ±n.
* **ÃœÃ§Ã¼ncÃ¼ Taraf SaÄŸlayÄ±cÄ±lar:** `next-auth` gibi kÃ¼tÃ¼phaneler kullanarak OAuth saÄŸlayÄ±cÄ±larÄ±yla (Ã¶rn. Google, GitHub) entegre olun.

**GÃ¼venlik UygulamalarÄ±:**

* **GÃ¼venli Ã‡erezler:** `HttpOnly`, `Secure` ve `SameSite` niteliklerini ayarlayÄ±n.
* **Åifre Hashleme:** Åifreleri saklamadan Ã¶nce her zaman hashleyin.
* **Girdi DoÄŸrulama:** Girdi doÄŸrulama ve temizleme ile enjeksiyon saldÄ±rÄ±larÄ±nÄ± Ã¶nleyin.

**Ã–rnek:**
```javascript
// pages/api/login.js
import { sign } from 'jsonwebtoken';
import { serialize } from 'cookie';

export default async function handler(req, res) {
const { username, password } = req.body;

// Validate user credentials
if (username === 'admin' && password === 'password') {
const token = sign({ username }, process.env.JWT_SECRET, { expiresIn: '1h' });
res.setHeader('Set-Cookie', serialize('auth', token, { path: '/', httpOnly: true, secure: true, sameSite: 'strict' }));
res.status(200).json({ message: 'Logged in' });
} else {
res.status(401).json({ error: 'Invalid credentials' });
}
}
```
### Performans Optimizasyonu

**Stratejiler:**

* **GÃ¶rÃ¼ntÃ¼ Optimizasyonu:** Otomatik gÃ¶rÃ¼ntÃ¼ optimizasyonu iÃ§in Next.js'in `next/image` bileÅŸenini kullanÄ±n.
* **Kod BÃ¶lme:** Dinamik iÃ§e aktarmalarÄ± kullanarak kodu bÃ¶lÃ¼n ve baÅŸlangÄ±Ã§ yÃ¼kleme sÃ¼relerini azaltÄ±n.
* **Ã–nbellekleme:** API yanÄ±tlarÄ± ve statik varlÄ±klar iÃ§in Ã¶nbellekleme stratejileri uygulayÄ±n.
* **Tembel YÃ¼kleme:** BileÅŸenleri veya varlÄ±klarÄ± yalnÄ±zca ihtiyaÃ§ duyulduÄŸunda yÃ¼kleyin.

**Ã–rnek:**
```jsx
// Dynamic Import with Code Splitting
import dynamic from 'next/dynamic';

const HeavyComponent = dynamic(() => import('../components/HeavyComponent'), {
loading: () => <p>Loading...</p>,
});
```
{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
