# NextJS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## OpÅ¡ta arhitektura Next.js aplikacije

### TipiÄna struktura fajlova

Standardni Next.js projekat prati specifiÄnu strukturu fajlova i direktorijuma koja olakÅ¡ava njegove funkcije kao Å¡to su rutiranje, API krajnje taÄke i upravljanje statiÄkim resursima. Evo tipiÄnog rasporeda:
```lua
my-nextjs-app/
â”œâ”€â”€ node_modules/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ hello/
â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ Home.module.css
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api.ts
â”œâ”€â”€ .env.local
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ yarn.lock / package-lock.json

```
### Osnovne Direktorije i Fajlovi

* **public/:** SadrÅ¾i statiÄke resurse kao Å¡to su slike, fontovi i drugi fajlovi. Fajlovi ovde su dostupni na korenskom putu (`/`).
* **app/:** Centralna direktorija za stranice, rasporede, komponente i API rute vaÅ¡e aplikacije. Obuhvata **App Router** paradigmu, omoguÄ‡avajuÄ‡i napredne funkcije usmeravanja i razdvajanje server-klijent komponenti.
* **app/layout.tsx:** DefiniÅ¡e osnovni raspored za vaÅ¡u aplikaciju, obavijajuÄ‡i sve stranice i pruÅ¾ajuÄ‡i dosledne UI elemente kao Å¡to su zaglavlja, podnoÅ¾ja i navigacione trake.
* **app/page.tsx:** SluÅ¾i kao ulazna taÄka za osnovnu rutu `/`, renderujuÄ‡i poÄetnu stranicu.
* **app/\[route]/page.tsx:** Rukuje statiÄnim i dinamiÄnim rutama. Svaka fascikla unutar `app/` predstavlja segment rute, a `page.tsx` unutar tih fascikli odgovara komponenti rute.
* **app/api/:** SadrÅ¾i API rute, omoguÄ‡avajuÄ‡i vam da kreirate serverless funkcije koje obraÄ‘uju HTTP zahteve. Ove rute zamenjuju tradicionalnu `pages/api` direktoriju.
* **app/components/:** SadrÅ¾i ponovo upotrebljive React komponente koje se mogu koristiti na razliÄitim stranicama i rasporedima.
* **app/styles/:** SadrÅ¾i globalne CSS fajlove i CSS Module za stilizovanje ograniÄeno na komponente.
* **app/utils/:** UkljuÄuje pomoÄ‡ne funkcije, pomoÄ‡ne module i drugu logiku koja nije UI, a koja se moÅ¾e deliti Å¡irom aplikacije.
* **.env.local:** ÄŒuva promenljive okruÅ¾enja specifiÄne za lokalno razvojno okruÅ¾enje. Ove promenljive **nisu** ukljuÄene u kontrolu verzija.
* **next.config.js:** PrilagoÄ‘ava ponaÅ¡anje Next.js, ukljuÄujuÄ‡i webpack konfiguracije, promenljive okruÅ¾enja i bezbednosne postavke.
* **tsconfig.json:** KonfiguriÅ¡e TypeScript postavke za projekat, omoguÄ‡avajuÄ‡i proveru tipova i druge TypeScript funkcije.
* **package.json:** Upravljanje zavisnostima projekta, skriptama i metapodacima.
* **README.md:** PruÅ¾a dokumentaciju i informacije o projektu, ukljuÄujuÄ‡i uputstva za postavljanje, smernice za koriÅ¡Ä‡enje i druge relevantne detalje.
* **yarn.lock / package-lock.json:** ZakljuÄava zavisnosti projekta na specifiÄne verzije, osiguravajuÄ‡i dosledne instalacije Å¡irom razliÄitih okruÅ¾enja.

## Klijentska Strana u Next.js

### Ruting na Bazi Fajlova u `app` Direktoriji

Direktorija `app` je kamen temeljac rutiranja u najnovijim verzijama Next.js. IskoriÅ¡Ä‡ava datoteÄni sistem za definisanje ruta, ÄineÄ‡i upravljanje rutama intuitivnim i skalabilnim.

<details>

<summary>Rukovanje Korenskim Putem /</summary>

**Struktura Fajlova:**
```arduino
my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**KljuÄne datoteke:**

* **`app/page.tsx`**: Obradjuje zahteve za korenski put `/`.
* **`app/layout.tsx`**: DefiniÅ¡e raspored za aplikaciju, obavijajuÄ‡i sve stranice.

**Implementacija:**
```tsx
tsxCopy code// app/page.tsx

export default function HomePage() {
return (
<div>
<h1>Welcome to the Home Page!</h1>
<p>This is the root route.</p>
</div>
);
}
```
**ObjaÅ¡njenje:**

* **Definicija Rute:** Datoteka `page.tsx` direktno ispod `app` direktorijuma odgovara `/` ruti.
* **Renderovanje:** Ova komponenta renderuje sadrÅ¾aj za poÄetnu stranicu.
* **Integracija Rasporeda:** `HomePage` komponenta je obavijena `layout.tsx`, koja moÅ¾e ukljuÄivati zaglavlja, podnoÅ¾ja i druge zajedniÄke elemente.

</details>

<details>

<summary>Obrada Ostalih Statickih Putanja</summary>



**Primer: `/about` Ruta**

**Struktura Datoteka:**
```arduino
arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Implementacija:**
```tsx
// app/about/page.tsx

export default function AboutPage() {
return (
<div>
<h1>About Us</h1>
<p>Learn more about our mission and values.</p>
</div>
);
}
```
**ObjaÅ¡njenje:**

* **Definicija Rute:** Datoteka `page.tsx` unutar `about` foldera odgovara ruti `/about`.
* **Renderovanje:** Ova komponenta renderuje sadrÅ¾aj za stranicu o nama.

</details>

<details>

<summary>DinamiÄke Rute</summary>

DinamiÄke rute omoguÄ‡avaju rukovanje putanjama sa promenljivim segmentima, omoguÄ‡avajuÄ‡i aplikacijama da prikazuju sadrÅ¾aj na osnovu parametara kao Å¡to su ID-ovi, slug-ovi, itd.

**Primer: `/posts/[id]` Ruta**

**Struktura Datoteka:**
```arduino
arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ posts/
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Implementacija:**
```tsx
tsxCopy code// app/posts/[id]/page.tsx

import { useRouter } from 'next/navigation';

interface PostProps {
params: { id: string };
}

export default function PostPage({ params }: PostProps) {
const { id } = params;
// Fetch post data based on 'id'

return (
<div>
<h1>Post #{id}</h1>
<p>This is the content of post {id}.</p>
</div>
);
}
```
**ObjaÅ¡njenje:**

* **DinamiÄki Segment:** `[id]` oznaÄava dinamiÄki segment u ruti, hvatajuÄ‡i `id` parametar iz URL-a.
* **Pristup Parametrima:** `params` objekat sadrÅ¾i dinamiÄke parametre, dostupne unutar komponente.
* **UsklaÄ‘ivanje Ruta:** Svaka putanja koja se poklapa sa `/posts/*`, kao Å¡to su `/posts/1`, `/posts/abc`, itd., biÄ‡e obraÄ‘ena od strane ove komponente.

</details>

<details>

<summary>UgnjeÅ¾dene Rute</summary>



Next.js podrÅ¾ava ugnjeÅ¾dene rute, omoguÄ‡avajuÄ‡i hijerarhijske strukture ruta koje odraÅ¾avaju raspored direktorijuma.

**Primer: `/dashboard/settings/profile` Ruta**

**Struktura Fajlova:**
```arduino
arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Implementacija:**
```tsx
tsxCopy code// app/dashboard/settings/profile/page.tsx

export default function ProfileSettingsPage() {
return (
<div>
<h1>Profile Settings</h1>
<p>Manage your profile information here.</p>
</div>
);
}
```
**ObjaÅ¡njenje:**

* **Duboko UgnjeÅ¾denje:** Datoteka `page.tsx` unutar `dashboard/settings/profile/` odgovara ruti `/dashboard/settings/profile`.
* **Refleksija Hijerarhije:** Struktura direktorijuma odraÅ¾ava URL putanju, poboljÅ¡avajuÄ‡i odrÅ¾ivost i jasnoÄ‡u.

</details>

<details>

<summary>Catch-All Rute</summary>

Catch-all rute obraÄ‘uju viÅ¡e ugnjeÅ¾denih segmenata ili nepoznatih putanja, pruÅ¾ajuÄ‡i fleksibilnost u obradi ruta.

**Primer: `/*` Ruta**

**Struktura Datoteka:**
```arduino
my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ [..slug]/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
```
**Implementacija:**
```tsx
// app/[...slug]/page.tsx

interface CatchAllProps {
params: { slug: string[] };
}

export default function CatchAllPage({ params }: CatchAllProps) {
const { slug } = params;
const fullPath = `/${slug.join('/')}`;

return (
<div>
<h1>Catch-All Route</h1>
<p>You have navigated to: {fullPath}</p>
</div>
);
}
```
**ObjaÅ¡njenje:**

* **Catch-All Segment:** `[...slug]` hvata sve preostale delove putanje kao niz.
* **Upotreba:** Korisno za rukovanje dinamiÄkim scenarijima usmeravanja kao Å¡to su putanje koje generiÅ¡u korisnici, ugnjeÅ¾dene kategorije, itd.
* **UsklaÄ‘ivanje Ruta:** Putanje kao Å¡to su `/anything/here`, `/foo/bar/baz`, itd., se obraÄ‘uju od strane ove komponente.

</details>

### Potencijalne Ranljivosti na Klijentskoj Strani

Dok Next.js pruÅ¾a sigurnu osnovu, nepravilne prakse kodiranja mogu uvesti ranjivosti. KljuÄne ranjivosti na klijentskoj strani ukljuÄuju:

<details>

<summary>Cross-Site Scripting (XSS)</summary>

XSS napadi se deÅ¡avaju kada se zlonamerni skripti ubacuju u pouzdane veb sajtove. NapadaÄi mogu izvrÅ¡avati skripte u pregledaÄima korisnika, kraduÄ‡i podatke ili obavljajuÄ‡i radnje u ime korisnika.

**Primer Ranljivog Koda:**
```jsx
// Dangerous: Injecting user input directly into HTML
function Comment({ userInput }) {
return <div dangerouslySetInnerHTML={{ __html: userInput }} />;
}
```
**ZaÅ¡to je ranjiv:** KoriÅ¡Ä‡enje `dangerouslySetInnerHTML` sa nepouzdanim ulazom omoguÄ‡ava napadaÄima da ubace zlonamerne skripte.

</details>

<details>

<summary>Injekcija Å ablona na Klijentskoj Strani</summary>

DogaÄ‘a se kada se korisniÄki unosi nepravilno obraÄ‘uju u Å¡ablonima, omoguÄ‡avajuÄ‡i napadaÄima da ubace i izvrÅ¡e Å¡ablone ili izraze.

**Primer Ranjivog Koda:**
```jsx
import React from 'react';
import ejs from 'ejs';

function RenderTemplate({ template, data }) {
const html = ejs.render(template, data);
return <div dangerouslySetInnerHTML={{ __html: html }} />;
}
```
**ZaÅ¡to je ranjiv:** Ako `template` ili `data` sadrÅ¾e zlonamerni sadrÅ¾aj, to moÅ¾e dovesti do izvrÅ¡enja nepredviÄ‘enog koda.

</details>

<details>

<summary>Klijentska putanja prolaska</summary>

To je ranjivost koja omoguÄ‡ava napadaÄima da manipuliÅ¡u putanjama na klijentskoj strani kako bi izvrÅ¡ili nepredviÄ‘ene radnje, kao Å¡to je Cross-Site Request Forgery (CSRF). Za razliku od prolaska putanje na serverskoj strani, koji cilja na datoteÄni sistem servera, CSPT se fokusira na iskoriÅ¡Ä‡avanje mehanizama na klijentskoj strani kako bi preusmerio legitimne API zahteve na zlonamerne krajnje taÄke.

**Primer ranjivog koda:**

A Next.js aplikacija omoguÄ‡ava korisnicima da otpremaju i preuzimaju datoteke. Funkcija preuzimanja je implementirana na klijentskoj strani, gde korisnici mogu da navedu putanju datoteke za preuzimanje.
```jsx
// pages/download.js
import { useState } from 'react';

export default function DownloadPage() {
const [filePath, setFilePath] = useState('');

const handleDownload = () => {
fetch(`/api/files/${filePath}`)
.then(response => response.blob())
.then(blob => {
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = filePath;
a.click();
});
};

return (
<div>
<h1>Download File</h1>
<input
type="text"
value={filePath}
onChange={(e) => setFilePath(e.target.value)}
placeholder="Enter file path"
/>
<button onClick={handleDownload}>Download</button>
</div>
);
}
```
#### Napad Scenarijo

1. **Cilj NapadaÄa**: IzvrÅ¡iti CSRF napad da obriÅ¡e kritiÄnu datoteku (npr., `admin/config.json`) manipulacijom `filePath`.
2. **IskoriÅ¡Ä‡avanje CSPT**:
* **Zlonamerni Unos**: NapadaÄ kreira URL sa manipulisanom `filePath` kao Å¡to je `../deleteFile/config.json`.
* **Rezultantni API Poziv**: Klijentski kod Å¡alje zahtev na `/api/files/../deleteFile/config.json`.
* **Rukovanje Servera**: Ako server ne validira `filePath`, obraÄ‘uje zahtev, potencijalno briÅ¡uÄ‡i ili izlaÅ¾uÄ‡i osetljive datoteke.
3. **IzvrÅ¡avanje CSRF**:
* **Kreirana Veza**: NapadaÄ Å¡alje Å¾rtvi link ili ugraÄ‘uje zlonamerni skript koji pokreÄ‡e zahtev za preuzimanje sa manipulisanom `filePath`.
* **Ishod**: Å½rtva nesvesno izvrÅ¡ava akciju, Å¡to dovodi do neovlaÅ¡Ä‡enog pristupa ili brisanja datoteka.

#### ZaÅ¡to je Ranjiv

* **Nedostatak Validacije Unosa**: Klijentska strana dozvoljava proizvoljne `filePath` unose, omoguÄ‡avajuÄ‡i prelazak putanje.
* **Verovanje Klijentskim Unosima**: Server-side API veruje i obraÄ‘uje `filePath` bez sanitizacije.
* **Potencijalne API Akcije**: Ako API krajnja taÄka izvrÅ¡ava akcije koje menjaju stanje (npr., brisanje, modifikacija datoteka), moÅ¾e se iskoristiti putem CSPT.

</details>

## Server-Side u Next.js

### Server-Side Rendering (SSR)

Stranice se renderuju na serveru pri svakom zahtevu, osiguravajuÄ‡i da korisnik dobije potpuno renderovani HTML. U ovom sluÄaju trebate kreirati svoj vlastiti prilagoÄ‘eni server za obradu zahteva.

**Upotrebe:**

* DinamiÄki sadrÅ¾aj koji se Äesto menja.
* SEO optimizacija, jer pretraÅ¾ivaÄi mogu indeksirati potpuno renderovanu stranicu.

**Implementacija:**
```jsx
// pages/index.js
export async function getServerSideProps(context) {
const res = await fetch('https://api.example.com/data');
const data = await res.json();
return { props: { data } };
}

function HomePage({ data }) {
return <div>{data.title}</div>;
}

export default HomePage;
```
### Static Site Generation (SSG)

Stranice se prethodno renderuju u vreme izgradnje, Å¡to rezultira brÅ¾im vremenima uÄitavanja i smanjenim optereÄ‡enjem servera.

**Use Cases:**

* SadrÅ¾aj koji se ne menja Äesto.
* Blogovi, dokumentacija, marketinÅ¡ke stranice.

**Implementation:**
```jsx
// pages/index.js
export async function getStaticProps() {
const res = await fetch('https://api.example.com/data');
const data = await res.json();
return { props: { data }, revalidate: 60 }; // Revalidate every 60 seconds
}

function HomePage({ data }) {
return <div>{data.title}</div>;
}

export default HomePage;
```
### Serverless Functions (API Routes)

Next.js omoguÄ‡ava kreiranje API krajnjih taÄaka kao serverless funkcija. Ove funkcije se izvrÅ¡avaju na zahtev bez potrebe za posveÄ‡enim serverom.

**Use Cases:**

* Obrada slanja obrazaca.
* Interakcija sa bazama podataka.
* Obrada podataka ili integracija sa treÄ‡im stranama API-ima.

**Implementation:**

Sa uvoÄ‘enjem `app` direktorijuma u Next.js 13, rutiranje i API obrada su postali fleksibilniji i moÄ‡niji. Ovaj moderni pristup se blisko usklaÄ‘uje sa sistemom rutiranja zasnovanim na datotekama, ali uvodi poboljÅ¡ane moguÄ‡nosti, ukljuÄujuÄ‡i podrÅ¡ku za server i klijentske komponente.

#### Basic Route Handler

**File Structure:**
```go
my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello/
â”‚           â””â”€â”€ route.js
â”œâ”€â”€ package.json
â””â”€â”€ ...
```
**Implementacija:**
```javascript
// app/api/hello/route.js

export async function POST(request) {
return new Response(JSON.stringify({ message: 'Hello from App Router!' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

// Client-side fetch to access the API endpoint
fetch('/api/submit', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ name: 'John Doe' }),
})
.then((res) => res.json())
.then((data) => console.log(data));
```
**ObjaÅ¡njenje:**

* **Lokacija:** API rute se nalaze u `app/api/` direktorijumu.
* **Naziv fajlova:** Svaki API endpoint se nalazi u svojoj fascikli koja sadrÅ¾i `route.js` ili `route.ts` fajl.
* **Izvezene funkcije:** Umesto jednog podrazumevanog izvoza, specifiÄne funkcije HTTP metoda (npr., `GET`, `POST`) se izvoze.
* **Obrada odgovora:** Koristite `Response` konstruktor za vraÄ‡anje odgovora, omoguÄ‡avajuÄ‡i veÄ‡u kontrolu nad header-ima i status kodovima.

#### Kako obraditi druge putanje i metode:

<details>

<summary>Obrada specifiÄnih HTTP metoda</summary>



Next.js 13+ omoguÄ‡ava definisanje handler-a za specifiÄne HTTP metode unutar istog `route.js` ili `route.ts` fajla, promoviÅ¡uÄ‡i jasniji i organizovaniji kod.

**Primer:**
```javascript
// app/api/users/[id]/route.js

export async function GET(request, { params }) {
const { id } = params;
// Fetch user data based on 'id'
return new Response(JSON.stringify({ userId: id, name: 'Jane Doe' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

export async function PUT(request, { params }) {
const { id } = params;
// Update user data based on 'id'
return new Response(JSON.stringify({ message: `User ${id} updated.` }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

export async function DELETE(request, { params }) {
const { id } = params;
// Delete user based on 'id'
return new Response(JSON.stringify({ message: `User ${id} deleted.` }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
```
**ObjaÅ¡njenje:**

* **ViÅ¡estruki Izvozi:** Svaka HTTP metoda (`GET`, `PUT`, `DELETE`) ima svoju funkciju za izvoz.
* **Parametri:** Drugi argument omoguÄ‡ava pristup parametrima rute putem `params`.
* **PoboljÅ¡ani Odgovori:** VeÄ‡a kontrola nad objektima odgovora, omoguÄ‡avajuÄ‡i precizno upravljanje zaglavljem i status kodom.

</details>

<details>

<summary>Catch-All i UgnjeÅ¾dene Rute</summary>



Next.js 13+ podrÅ¾ava napredne funkcije usmeravanja kao Å¡to su catch-all rute i ugnjeÅ¾dene API rute, omoguÄ‡avajuÄ‡i dinamiÄnije i skalabilnije API strukture.

**Primer Catch-All Rute:**
```javascript
// app/api/[...slug]/route.js

export async function GET(request, { params }) {
const { slug } = params;
// Handle dynamic nested routes
return new Response(JSON.stringify({ slug }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
```
**ObjaÅ¡njenje:**

* **Sintaksa:** `[...]` oznaÄava segment koji obuhvata sve, hvatajuÄ‡i sve ugnjeÅ¾dene putanje.
* **Upotreba:** Korisno za API-je koji treba da obrade razliÄite dubine ruta ili dinamiÄke segmente.

**Primer ugnjeÅ¾denih ruta:**
```javascript
// app/api/posts/[postId]/comments/[commentId]/route.js

export async function GET(request, { params }) {
const { postId, commentId } = params;
// Fetch specific comment for a post
return new Response(JSON.stringify({ postId, commentId, comment: 'Great post!' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
```
**ObjaÅ¡njenje:**

* **Duboko UgnjeÅ¾denje:** OmoguÄ‡ava hijerarhijske API strukture, odraÅ¾avajuÄ‡i odnose resursa.
* **Pristup Parametrima:** Lako pristupite viÅ¡e parametara rute putem `params` objekta.

</details>

<details>

<summary>Rukovanje API rutama u Next.js 12 i ranije</summary>

## API Rute u `pages` Direktorijumu (Next.js 12 i ranije)

Pre nego Å¡to je Next.js 13 uveo `app` direktorijum i poboljÅ¡ane moguÄ‡nosti rutiranja, API rute su se prvenstveno definisale unutar `pages` direktorijuma. Ovaj pristup se i dalje Å¡iroko koristi i podrÅ¾ava u Next.js 12 i ranijim verzijama.

#### Osnovna API Ruta

**Struktura Fajlova:**
```go
goCopy codemy-nextjs-app/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello.js
â”œâ”€â”€ package.json
â””â”€â”€ ...
```
**Implementacija:**
```javascript
javascriptCopy code// pages/api/hello.js

export default function handler(req, res) {
res.status(200).json({ message: 'Hello, World!' });
}
```
**ObjaÅ¡njenje:**

* **Lokacija:** API rute se nalaze u `pages/api/` direktorijumu.
* **Izvoz:** Koristite `export default` da definiÅ¡ete funkciju handler.
* **Potpis funkcije:** Handler prima `req` (HTTP zahtev) i `res` (HTTP odgovor) objekte.
* **Ruting:** Ime fajla (`hello.js`) se mapira na krajnju taÄku `/api/hello`.

#### DinamiÄke API Rute

**Struktura fajla:**
```bash
bashCopy codemy-nextjs-app/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ users/
â”‚           â””â”€â”€ [id].js
â”œâ”€â”€ package.json
â””â”€â”€ ...
```
**Implementacija:**
```javascript
javascriptCopy code// pages/api/users/[id].js

export default function handler(req, res) {
const {
query: { id },
method,
} = req;

switch (method) {
case 'GET':
// Fetch user data based on 'id'
res.status(200).json({ userId: id, name: 'John Doe' });
break;
case 'PUT':
// Update user data based on 'id'
res.status(200).json({ message: `User ${id} updated.` });
break;
case 'DELETE':
// Delete user based on 'id'
res.status(200).json({ message: `User ${id} deleted.` });
break;
default:
res.setHeader('Allow', ['GET', 'PUT', 'DELETE']);
res.status(405).end(`Method ${method} Not Allowed`);
}
}
```
**ObjaÅ¡njenje:**

* **DinamiÄki segmenti:** Kvadratne zagrade (`[id].js`) oznaÄavaju dinamiÄke delove rute.
* **Pristup parametrima:** Koristite `req.query.id` za pristup dinamiÄkom parametru.
* **Rukovanje metodama:** Iskoristite uslovnu logiku za rukovanje razliÄitim HTTP metodama (`GET`, `PUT`, `DELETE`, itd.).

#### Rukovanje razliÄitim HTTP metodama

Dok osnovni primer API rute obraÄ‘uje sve HTTP metode unutar jedne funkcije, moÅ¾ete strukturirati svoj kod da obraÄ‘uje svaku metodu eksplicitno radi bolje jasnoÄ‡e i odrÅ¾ivosti.

**Primer:**
```javascript
javascriptCopy code// pages/api/posts.js

export default async function handler(req, res) {
const { method } = req;

switch (method) {
case 'GET':
// Handle GET request
res.status(200).json({ message: 'Fetching posts.' });
break;
case 'POST':
// Handle POST request
res.status(201).json({ message: 'Post created.' });
break;
default:
res.setHeader('Allow', ['GET', 'POST']);
res.status(405).end(`Method ${method} Not Allowed`);
}
}
```
**Najbolje Prakse:**

* **Razdvajanje Zabrinutosti:** Jasno razdvojiti logiku za razliÄite HTTP metode.
* **Doslednost Odgovora:** Osigurati dosledne strukture odgovora radi lakÅ¡eg rukovanja na klijentskoj strani.
* **Obrada GreÅ¡aka:** Elegantno obraditi nepodrÅ¾ane metode i neoÄekivane greÅ¡ke.

</details>

### CORS Konfiguracija

Kontrolisati koje izvore mogu pristupiti vaÅ¡im API rutama, smanjujuÄ‡i ranjivosti vezane za deljenje resursa izmeÄ‘u razliÄitih izvora (CORS).

**LoÅ¡ Primer Konfiguracije:**
```javascript
// app/api/data/route.js

export async function GET(request) {
return new Response(JSON.stringify({ data: 'Public Data' }), {
status: 200,
headers: {
'Access-Control-Allow-Origin': '*', // Allows any origin
'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
},
});
}
```
Napomena da se **CORS takoÄ‘e moÅ¾e konfigurisati u svim API rutama** unutar **`middleware.ts`** datoteke:
```javascript
// app/middleware.ts

import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
const allowedOrigins = ['https://yourdomain.com', 'https://sub.yourdomain.com'];
const origin = request.headers.get('Origin');

const response = NextResponse.next();

if (allowedOrigins.includes(origin || '')) {
response.headers.set('Access-Control-Allow-Origin', origin || '');
response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');
// If credentials are needed:
// response.headers.set('Access-Control-Allow-Credentials', 'true');
}

// Handle preflight requests
if (request.method === 'OPTIONS') {
return new Response(null, {
status: 204,
headers: response.headers,
});
}

return response;
}

export const config = {
matcher: '/api/:path*', // Apply to all API routes
};

```
**Problem:**

* **`Access-Control-Allow-Origin: '*'`:** Dozvoljava bilo kojoj veb stranici da pristupi API-ju, potencijalno omoguÄ‡avajuÄ‡i zlonamernim sajtovima da komuniciraju sa vaÅ¡im API-jem bez ograniÄenja.
* **Å iroko dozvoljene metode:** Dozvoljavanje svih metoda moÅ¾e omoguÄ‡iti napadaÄima da izvrÅ¡e neÅ¾eljene radnje.

**Kako napadaÄi to koriste:**

NapadaÄi mogu kreirati zlonamerne veb stranice koje Å¡alju zahteve vaÅ¡em API-ju, potencijalno zloupotrebljavajuÄ‡i funkcionalnosti kao Å¡to su preuzimanje podataka, manipulacija podacima ili pokretanje neÅ¾eljenih radnji u ime autentifikovanih korisnika.

{% content-ref url="../../pentesting-web/cors-bypass.md" %}
[cors-bypass.md](../../pentesting-web/cors-bypass.md)
{% endcontent-ref %}

### IzloÅ¾enost server koda na klijentskoj strani

Lako je **koristiti kod koji koristi server takoÄ‘e u kodu koji je izloÅ¾en i koristi se na klijentskoj strani**, najbolji naÄin da se osigura da datoteka koda nikada nije izloÅ¾ena na klijentskoj strani je koriÅ¡Ä‡enje ovog uvoza na poÄetku datoteke:
```js
import "server-only";
```
## KljuÄne datoteke i njihove uloge

### `middleware.ts` / `middleware.js`

**Lokacija:** Korenski deo projekta ili unutar `src/`.

**Svrha:** IzvrÅ¡ava kod u server-side serverless funkciji pre nego Å¡to se zahtev obradi, omoguÄ‡avajuÄ‡i zadatke kao Å¡to su autentifikacija, preusmeravanja ili modifikovanje odgovora.

**Tok izvrÅ¡enja:**

1. **Dolazni zahtev:** Middleware presreÄ‡e zahtev.
2. **Obrada:** IzvrÅ¡ava operacije na osnovu zahteva (npr. provera autentifikacije).
3. **Modifikacija odgovora:** MoÅ¾e izmeniti odgovor ili preneti kontrolu sledeÄ‡em handleru.

**Primeri koriÅ¡Ä‡enja:**

* Preusmeravanje neautentifikovanih korisnika.
* Dodavanje prilagoÄ‘enih zaglavlja.
* Zapisivanje zahteva.

**Primer konfiguracije:**
```typescript
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(req: NextRequest) {
const url = req.nextUrl.clone();
if (!req.cookies.has('token')) {
url.pathname = '/login';
return NextResponse.redirect(url);
}
return NextResponse.next();
}

export const config = {
matcher: ['/protected/:path*'],
};
```
### `next.config.js`

**Lokacija:** Korenski direktorijum projekta.

**Svrha:** KonfiguriÅ¡e ponaÅ¡anje Next.js, omoguÄ‡avajuÄ‡i ili onemoguÄ‡avajuÄ‡i funkcije, prilagoÄ‘avajuÄ‡i webpack konfiguracije, postavljajuÄ‡i promenljive okruÅ¾enja i konfiguriÅ¡uÄ‡i nekoliko bezbednosnih funkcija.

**KljuÄne bezbednosne konfiguracije:**

<details>

<summary>Bezbednosni zaglavlja</summary>

Bezbednosna zaglavlja poboljÅ¡avaju bezbednost vaÅ¡e aplikacije tako Å¡to upuÄ‡uju pretraÅ¾ivaÄe kako da rukuju sadrÅ¾ajem. PomaÅ¾u u ublaÅ¾avanju raznih napada kao Å¡to su Cross-Site Scripting (XSS), Clickjacking i MIME type sniffing:

* Content Security Policy (CSP)
* X-Frame-Options
* X-Content-Type-Options
* Strict-Transport-Security (HSTS)
* Referrer Policy

**Primeri:**
```javascript
// next.config.js

module.exports = {
async headers() {
return [
{
source: '/(.*)', // Apply to all routes
headers: [
{
key: 'X-Frame-Options',
value: 'DENY',
},
{
key: 'Content-Security-Policy',
value: "default-src *; script-src 'self' 'unsafe-inline' 'unsafe-eval';",
},
{
key: 'X-Content-Type-Options',
value: 'nosniff',
},
{
key: 'Strict-Transport-Security',
value: 'max-age=63072000; includeSubDomains; preload', // Enforces HTTPS
},
{
key: 'Referrer-Policy',
value: 'no-referrer', // Completely hides referrer
},
// Additional headers...
],
},
];
},
};
```
</details>

<details>

<summary>PodeÅ¡avanja optimizacije slika</summary>

Next.js optimizuje slike za performanse, ali pogreÅ¡na podeÅ¡avanja mogu dovesti do sigurnosnih ranjivosti, kao Å¡to je omoguÄ‡avanje nepouzdanim izvorima da ubace zlonamerni sadrÅ¾aj.

**Primer loÅ¡eg podeÅ¡avanja:**
```javascript
// next.config.js

module.exports = {
images: {
domains: ['*'], // Allows images from any domain
},
};
```
**Problem:**

* **`'*'`:** Dozvoljava uÄitavanje slika iz bilo kojeg spoljnog izvora, ukljuÄujuÄ‡i nepouzdane ili zlonamerne domene. NapadaÄi mogu hostovati slike koje sadrÅ¾e zlonamerne payload-e ili sadrÅ¾aj koji obmanjuje korisnike.
* Drugi problem moÅ¾e biti dozvoliti domenu **gde bilo ko moÅ¾e da otpremi sliku** (kao Å¡to je `raw.githubusercontent.com`)

**Kako napadaÄi to zloupotrebljavaju:**

Ubacivanjem slika iz zlonamernih izvora, napadaÄi mogu izvesti phishing napade, prikazati obmanjujuÄ‡e informacije ili iskoristiti ranjivosti u bibliotekama za renderovanje slika.

</details>

<details>

<summary>IzloÅ¾enost promenljivih okruÅ¾enja</summary>

Upravljajte osetljivim informacijama kao Å¡to su API kljuÄevi i kredencijali za bazu podataka na siguran naÄin bez izlaganja klijentu.

#### a. Izlaganje osetljivih promenljivih

**LoÅ¡ primer konfiguracije:**
```javascript
// next.config.js

module.exports = {
env: {
SECRET_API_KEY: process.env.SECRET_API_KEY, // Exposed to the client
NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL, // Correctly prefixed for client
},
};
```
**Problem:**

* **`SECRET_API_KEY`:** Bez `NEXT_PUBLIC_` prefiksa, Next.js ne izlaÅ¾e varijable klijentu. MeÄ‘utim, ako se greÅ¡kom doda prefiks (npr., `NEXT_PUBLIC_SECRET_API_KEY`), postaje dostupno na strani klijenta.

**Kako napadaÄi to zloupotrebljavaju:**

Ako su osetljive varijable izloÅ¾ene klijentu, napadaÄi ih mogu preuzeti pregledanjem koda na strani klijenta ili mreÅ¾nih zahteva, stiÄuÄ‡i neovlaÅ¡Ä‡en pristup API-ima, bazama podataka ili drugim uslugama.

</details>

<details>

<summary>Preusmeravanja</summary>

Upravljajte URL preusmeravanjima i prepisivanjima unutar vaÅ¡e aplikacije, osiguravajuÄ‡i da su korisnici pravilno usmereni bez uvoÄ‘enja ranjivosti otvorenog preusmeravanja.

#### a. Ranjivost otvorenog preusmeravanja

**Primer loÅ¡e konfiguracije:**
```javascript
// next.config.js

module.exports = {
async redirects() {
return [
{
source: '/redirect',
destination: (req) => req.query.url, // Dynamically redirects based on query parameter
permanent: false,
},
];
},
};
```
**Problem:**

* **DinamiÄka destinacija:** OmoguÄ‡ava korisnicima da navedu bilo koju URL adresu, Å¡to omoguÄ‡ava napade otvorenog preusmeravanja.
* **Verovanje korisniÄkom unosu:** Preusmeravanje na URL adrese koje su pruÅ¾ili korisnici bez validacije moÅ¾e dovesti do fiÅ¡inga, distribucije malvera ili kraÄ‘e akreditiva.

**Kako napadaÄi to zloupotrebljavaju:**

NapadaÄi mogu kreirati URL adrese koje izgledaju kao da potiÄu sa vaÅ¡e domene, ali preusmeravaju korisnike na zlonamerne sajtove. Na primer:
```bash
https://yourdomain.com/redirect?url=https://malicious-site.com
```
Korisnici koji veruju originalnoj domeni mogu nesvesno navigirati do Å¡tetnih veb sajtova.

</details>

<details>

<summary>Webpack Konfiguracija</summary>

Prilagodite Webpack konfiguracije za vaÅ¡u Next.js aplikaciju, koje mogu nenamerno uvesti sigurnosne ranjivosti ako se ne rukuje paÅ¾ljivo.

#### a. Izlaganje Osetljivih Modula

**LoÅ¡ Primer Konfiguracije:**
```javascript
// next.config.js

module.exports = {
webpack: (config, { isServer }) => {
if (!isServer) {
config.resolve.alias['@sensitive'] = path.join(__dirname, 'secret-folder');
}
return config;
},
};
```
**Problem:**

* **Izlaganje osetljivih putanja:** Aliasiranje osetljivih direktorijuma i omoguÄ‡avanje pristupa sa klijentske strane moÅ¾e dovesti do curenja poverljivih informacija.
* **Pakovanje tajni:** Ako su osetljivi fajlovi pakovani za klijenta, njihov sadrÅ¾aj postaje dostupan putem izvornih mapa ili inspekcijom koda sa klijentske strane.

**Kako napadaÄi to zloupotrebljavaju:**

NapadaÄi mogu pristupiti ili rekonstruisati strukturu direktorijuma aplikacije, potencijalno pronalazeÄ‡i i koristeÄ‡i osetljive fajlove ili podatke.

</details>

### `pages/_app.js` i `pages/_document.js`

#### **`pages/_app.js`**

**Svrha:** Preuzima podrazumevanu App komponentu, omoguÄ‡avajuÄ‡i globalno stanje, stilove i komponente rasporeda.

**Upotreba:**

* Umetanje globalnog CSS-a.
* Dodavanje omotaÄa rasporeda.
* Integracija biblioteka za upravljanje stanjem.

**Primer:**
```jsx
// pages/_app.js
import '../styles/globals.css';

function MyApp({ Component, pageProps }) {
return <Component {...pageProps} />;
}

export default MyApp;
```
#### **`pages/_document.js`**

**Svrha:** Preuzima podrazumevani Dokument, omoguÄ‡avajuÄ‡i prilagoÄ‘avanje HTML i Body tagova.

**SluÄajevi koriÅ¡Ä‡enja:**

* Modifikovanje `<html>` ili `<body>` tagova.
* Dodavanje meta tagova ili prilagoÄ‘enih skripti.
* Integracija fontova treÄ‡ih strana.

**Primer:**
```jsx
// pages/_document.js
import Document, { Html, Head, Main, NextScript } from 'next/document';

class MyDocument extends Document {
render() {
return (
<Html lang="en">
<Head>
{/* Custom fonts or meta tags */}
</Head>
<body>
<Main />
<NextScript />
</body>
</Html>
);
}
}

export default MyDocument;
```
### ĞŸÑ€Ğ¸Ğ»Ğ°Ğ³Ğ¾Ñ’ĞµĞ½Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€ (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ½Ğ¾)

**Ğ¡Ğ²Ñ€Ñ…Ğ°:** Ğ”Ğ¾Ğº Next.js Ğ´Ğ¾Ğ»Ğ°Ğ·Ğ¸ ÑĞ° ÑƒĞ³Ñ€Ğ°Ñ’ĞµĞ½Ğ¸Ğ¼ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼, Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ ĞºÑ€ĞµĞ¸Ñ€Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ³Ğ¾Ñ’ĞµĞ½Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€ Ğ·Ğ° Ğ½Ğ°Ğ¿Ñ€ĞµĞ´Ğ½Ğµ ÑĞ»ÑƒÑ‡Ğ°Ñ˜ĞµĞ²Ğµ ĞºĞ°Ğ¾ ÑˆÑ‚Ğ¾ ÑÑƒ Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ³Ğ¾Ñ’ĞµĞ½Ğ¾ Ñ€ÑƒÑ‚Ğ¸Ñ€Ğ°ÑšĞµ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ˜Ğ° ÑĞ° Ğ¿Ğ¾ÑÑ‚Ğ¾Ñ˜ĞµÑ›Ğ¸Ğ¼ Ğ¿Ğ¾Ğ·Ğ°Ğ´Ğ¸Ğ½ÑĞºĞ¸Ğ¼ ÑƒÑĞ»ÑƒĞ³Ğ°Ğ¼Ğ°.

**ĞĞ°Ğ¿Ğ¾Ğ¼ĞµĞ½Ğ°:** ĞšĞ¾Ñ€Ğ¸ÑÑ‚ĞµÑšĞµ Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ³Ğ¾Ñ’ĞµĞ½Ğ¾Ğ³ ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ¼Ğ¾Ğ¶Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ñ‚Ğ¸ Ğ¾Ğ¿Ñ†Ğ¸Ñ˜Ğµ Ñ€Ğ°ÑĞ¿Ğ¾Ñ€ĞµÑ’Ğ¸Ğ²Ğ°ÑšĞ°, Ğ¿Ğ¾ÑĞµĞ±Ğ½Ğ¾ Ğ½Ğ° Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼Ğ° ĞºĞ°Ğ¾ ÑˆÑ‚Ğ¾ Ñ˜Ğµ Vercel ĞºĞ¾Ñ˜Ğµ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·ÑƒÑ˜Ñƒ Ğ·Ğ° ÑƒĞ³Ñ€Ğ°Ñ’ĞµĞ½Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€ Next.js.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```javascript
// server.js
const express = require('express');
const next = require('next');

const dev = process.env.NODE_ENV !== 'production';
const app = next({ dev });
const handle = app.getRequestHandler();

app.prepare().then(() => {
const server = express();

// Custom route
server.get('/a', (req, res) => {
return app.render(req, res, '/a');
});

// Default handler
server.all('*', (req, res) => {
return handle(req, res);
});

server.listen(3000, (err) => {
if (err) throw err;
console.log('> Ready on http://localhost:3000');
});
});
```
***

## Dodatne Arhitektonske i Bezbednosne Razmatranja

### Promenljive OkruÅ¾enja i Konfiguracija

**Svrha:** Upravljanje osetljivim informacijama i podeÅ¡avanjima konfiguracije van koda.

**Najbolje Prakse:**

* **Koristite `.env` Fajlove:** ÄŒuvajte promenljive poput API kljuÄeva u `.env.local` (iskljuÄeno iz kontrole verzija).
* **Pristupajte Promenljivim Bezbedno:** Koristite `process.env.VARIABLE_NAME` za pristup promenljivim okruÅ¾enja.
* **Nikada ne IzlaÅ¾ite Tajne na Klijentu:** Osigurajte da se osetljive promenljive koriste samo na serverskoj strani.

**Primer:**
```javascript
// next.config.js
module.exports = {
env: {
API_KEY: process.env.API_KEY, // Accessible on both client and server
SECRET_KEY: process.env.SECRET_KEY, // Be cautious if accessible on the client
},
};
```
**Napomena:** Da biste ograniÄili promenljive samo na server, izostavite ih iz `env` objekta ili ih prefiksirajte sa `NEXT_PUBLIC_` za izlaganje klijentu.

### Autentifikacija i Autorizacija

**Pristup:**

* **Autentifikacija zasnovana na sesiji:** Koristite kolaÄiÄ‡e za upravljanje korisniÄkim sesijama.
* **Autentifikacija zasnovana na tokenima:** Implementirajte JWT-ove za stateless autentifikaciju.
* **TreÄ‡e strane:** Integracija sa OAuth provajderima (npr. Google, GitHub) koristeÄ‡i biblioteke kao Å¡to je `next-auth`.

**Prakse bezbednosti:**

* **Sigurni kolaÄiÄ‡i:** Postavite atribute `HttpOnly`, `Secure` i `SameSite`.
* **Hashovanje lozinki:** Uvek hashujte lozinke pre nego Å¡to ih saÄuvate.
* **Validacija unosa:** SpreÄite napade injekcijom validacijom i sanitizacijom unosa.

**Primer:**
```javascript
// pages/api/login.js
import { sign } from 'jsonwebtoken';
import { serialize } from 'cookie';

export default async function handler(req, res) {
const { username, password } = req.body;

// Validate user credentials
if (username === 'admin' && password === 'password') {
const token = sign({ username }, process.env.JWT_SECRET, { expiresIn: '1h' });
res.setHeader('Set-Cookie', serialize('auth', token, { path: '/', httpOnly: true, secure: true, sameSite: 'strict' }));
res.status(200).json({ message: 'Logged in' });
} else {
res.status(401).json({ error: 'Invalid credentials' });
}
}
```
### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ˜Ğ° Ğ¿ĞµÑ€Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ½ÑĞ¸

**Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ˜Ğµ:**

* **ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ˜Ğ° ÑĞ»Ğ¸ĞºĞ°:** ĞšĞ¾Ñ€Ğ¸ÑÑ‚Ğ¸Ñ‚Ğµ Next.js-Ğ¾Ğ² `next/image` ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñƒ Ğ·Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚ÑĞºÑƒ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ˜Ñƒ ÑĞ»Ğ¸ĞºĞ°.
* **ĞŸĞ¾Ğ´ĞµĞ»Ğ° ĞºĞ¾Ğ´Ğ°:** Ğ˜ÑĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¸Ñ‚Ğµ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞºĞµ ÑƒĞ²Ğ¾Ğ·Ğµ Ğ·Ğ° Ğ¿Ğ¾Ğ´ĞµĞ»Ğ° ĞºĞ¾Ğ´Ğ° Ğ¸ ÑĞ¼Ğ°ÑšĞµÑšĞµ Ğ¿Ğ¾Ñ‡ĞµÑ‚Ğ½Ğ¾Ğ³ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ° ÑƒÑ‡Ğ¸Ñ‚Ğ°Ğ²Ğ°ÑšĞ°.
* **ĞšĞµÑˆĞ¸Ñ€Ğ°ÑšĞµ:** Ğ˜Ğ¼Ğ¿Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ°Ñ˜Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ˜Ğµ ĞºĞµÑˆĞ¸Ñ€Ğ°ÑšĞ° Ğ·Ğ° API Ğ¾Ğ´Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğµ Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡ĞºĞµ Ñ€ĞµÑÑƒÑ€ÑĞµ.
* **Ğ›ĞµĞ½Ğ¸ ÑƒÑ‡Ğ¸Ñ‚Ğ°Ğ²Ğ°ÑšĞµ:** Ğ£Ñ‡Ğ¸Ñ‚Ğ°Ğ²Ğ°Ñ˜Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ñ€ĞµÑÑƒÑ€ÑĞµ ÑĞ°Ğ¼Ğ¾ ĞºĞ°Ğ´Ğ° ÑÑƒ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ½Ğ¸.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```jsx
// Dynamic Import with Code Splitting
import dynamic from 'next/dynamic';

const HeavyComponent = dynamic(() => import('../components/HeavyComponent'), {
loading: () => <p>Loading...</p>,
});
```
{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
