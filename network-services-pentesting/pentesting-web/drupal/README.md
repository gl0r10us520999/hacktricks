# Drupal

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Discovery

* Î•Î»Î­Î³Î¾Ï„Îµ **meta**
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **Node**: Î¤Î¿ Drupal **ÎµÏ…ÏÎµÏ„Î·ÏÎ¹Î¬Î¶ÎµÎ¹ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½ÏŒ Ï„Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚**. ÎˆÎ½Î±Ï‚ ÎºÏŒÎ¼Î²Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎºÏÎ±Ï„Î¬ Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ** ÏŒÏ€Ï‰Ï‚ Î¼Î¹Î± Î±Î½Î¬ÏÏ„Î·ÏƒÎ· blog, Î´Î·Î¼Î¿ÏƒÎºÏŒÏ€Î·ÏƒÎ·, Î¬ÏÎ¸ÏÎ¿, Îº.Î»Ï€. ÎŸÎ¹ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ URI Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï„Î·Ï‚ Î¼Î¿ÏÏ†Î®Ï‚ `/node/<nodeid>`.
```bash
curl drupal-site.com/node/1
```
## Enumeration

### ÎˆÎºÎ´Î¿ÏƒÎ·

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ `/CHANGELOG.txt`
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
ÎŸÎ¹ Î½ÎµÏŒÏ„ÎµÏÎµÏ‚ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… Drupal Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® Î±Ï€Î¿ÎºÎ»ÎµÎ¯Î¿Ï…Î½ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± `CHANGELOG.txt` ÎºÎ±Î¹ `README.txt`.
{% endhint %}

### Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½

Î¤Î¿ Drupal Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ **Ï„ÏÎµÎ¹Ï‚ Ï„ÏÏ€Î¿Ï…Ï‚ Ï‡ÏÎ·ÏƒÏ„ÏÎ½** Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®:

1. **`Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚`**: Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î­Ï‡ÎµÎ¹ Ï€Î»Î®ÏÎ· Î­Î»ÎµÎ³Ï‡Î¿ Ï€Î¬Î½Ï‰ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± Drupal.
2. **`Î•Ï€Î¹ÎºÏ…ÏÏ‰Î¼Î­Î½Î¿Ï‚ Î§ÏÎ®ÏƒÏ„Î·Ï‚`**: Î‘Ï…Ï„Î¿Î¯ Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¿Ï…Î½ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Î· Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ±Î¹ Î· ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î¬ÏÎ¸ÏÏ‰Î½ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î¬ Ï„Î¿Ï…Ï‚.
3. **`Î‘Î½ÏÎ½Ï…Î¼Î¿Ï‚`**: ÎŒÎ»Î¿Î¹ Î¿Î¹ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„ÎµÏ‚ Ï„Î·Ï‚ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î¸ÎµÏ‰ÏÎ¿ÏÎ½Ï„Î±Î¹ Î±Î½ÏÎ½Ï…Î¼Î¿Î¹. Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Î±Ï…Ï„Î¿Î¯ Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î¼ÏŒÎ½Î¿ Î½Î± Î´Î¹Î±Î²Î¬Î¶Î¿Ï…Î½ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚.

**Î“Î¹Î± Î½Î± Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ:**

* **ÎÎ± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½:** Î‘Ï€Î»Î¬ Î±Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ `/user/1`, `/user/2`, `/user/3`... Î¼Î­Ï‡ÏÎ¹ Î½Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ±Ï†ÎµÎ¯ Î­Î½Î± ÏƒÏ†Î¬Î»Î¼Î± Ï€Î¿Ï… Î½Î± Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÎ¹ ÏŒÏ„Î¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹.
* **ÎœÎ·Ï„ÏÏÎ¿**: Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ `/user/register` ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Î±Î½ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± ÎµÎ¯Î½Î±Î¹ Î®Î´Î· ÎºÎ±Ï„ÎµÎ¹Î»Î·Î¼Î¼Î­Î½Î¿, Î¸Î± Ï…Ï€Î¿Î´ÎµÎ¹Ï‡Î¸ÎµÎ¯ ÏƒÎµ Î­Î½Î± ÏƒÏ†Î¬Î»Î¼Î± Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®.
* **Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÎºÏ‰Î´Î¹ÎºÎ¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚**: Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± ÎµÏ€Î±Î½Î±Ï†Î­ÏÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Î¸Î± Ï…Ï€Î¿Î´ÎµÎ¹Ï‡Î¸ÎµÎ¯ ÏƒÎ±Ï†ÏÏ‚ ÏƒÎµ Î­Î½Î± Î¼Î®Î½Ï…Î¼Î± ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚.

### ÎšÏÏ…Ï†Î­Ï‚ ÏƒÎµÎ»Î¯Î´ÎµÏ‚

Î‘Ï€Î»Î¬ Î²ÏÎµÎ¯Ï„Îµ Î½Î­ÎµÏ‚ ÏƒÎµÎ»Î¯Î´ÎµÏ‚ ÎºÎ¿Î¹Ï„Î¬Î¶Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿ **`/node/FUZZ`** ÏŒÏ€Î¿Ï… **`FUZZ`** ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ (Î±Ï€ÏŒ 1 Î­Ï‰Ï‚ 1000 Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±).

### Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Ï‰Î½ Î¼Î¿Î½Î¬Î´Ï‰Î½
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î•ÏÎ³Î±Î»ÎµÎ¯Î±
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCE

Î‘Î½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± Î¹ÏƒÏ„Î¿Ï Ï„Î¿Ï… Drupal, ÎµÎ»Î­Î³Î¾Ï„Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ RCE:

{% content-ref url="drupal-rce.md" %}
[drupal-rce.md](drupal-rce.md)
{% endcontent-ref %}

## Î‘Ï€ÏŒ XSS ÏƒÎµ RCE

* [**Drupalwned**](https://github.com/nowak0x01/Drupalwned): Î£ÎµÎ½Î¬ÏÎ¹Î¿ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ Drupal Ï€Î¿Ï… **Î±Î½ÎµÎ²Î¬Î¶ÎµÎ¹ XSS ÏƒÎµ RCE Î® Î¬Î»Î»ÎµÏ‚ ÎºÏÎ¯ÏƒÎ¹Î¼ÎµÏ‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚.** Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, ÎµÎ»Î­Î³Î¾Ï„Îµ [**Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html). Î Î±ÏÎ­Ï‡ÎµÎ¹ **Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· Î³Î¹Î± Ï„Î¹Ï‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Drupal 7.X.X, 8.X.X, 9.X.X ÎºÎ±Î¹ 10.X.X, ÎºÎ±Î¹ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î±:**
* _**Î‘ÏÎ¾Î·ÏƒÎ· Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½:**_ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î±Î½ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ„Î¿ Drupal.
* _**(RCE) Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î ÏÎ¿Ï„ÏÏ€Î¿Ï…:**_ Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Ï‰Î½ Ï€ÏÎ¿Ï„ÏÏ€Ï‰Î½ Î¼Îµ backdoor ÏƒÏ„Î¿ Drupal.

## ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

### Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï„Î¿ settings.php

{% code overflow="wrap" %}
```bash
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### Î•Î¾Î±Î³Ï‰Î³Î® Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Ï€ÏŒ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½

{% code overflow="wrap" %}
```bash
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
{% endcode %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
