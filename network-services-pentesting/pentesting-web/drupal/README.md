# Drupal

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## ç™ºè¦‹

* **ãƒ¡ã‚¿**ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **ãƒãƒ¼ãƒ‰**: Drupal **ã¯ãƒãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã—ã¾ã™**ã€‚ãƒãƒ¼ãƒ‰ã¯ **ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã€æŠ•ç¥¨ã€è¨˜äº‹ãªã©** ä½•ã§ã‚‚ **ä¿æŒã§ãã¾ã™**ã€‚ãƒšãƒ¼ã‚¸ã®URIã¯é€šå¸¸ `/node/<nodeid>` ã®å½¢å¼ã§ã™ã€‚
```bash
curl drupal-site.com/node/1
```
## åˆ—æŒ™

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³

* `/CHANGELOG.txt` ã‚’ç¢ºèªã™ã‚‹
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
æ–°ã—ã„Drupalã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`CHANGELOG.txt`ã¨`README.txt`ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚
{% endhint %}

### ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ—æŒ™

Drupalã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**3ç¨®é¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š

1. **`Administrator`**: ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯Drupalã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«å¯¾ã—ã¦å®Œå…¨ãªåˆ¶å¾¡ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
2. **`Authenticated User`**: ã“ã‚Œã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€æ¨©é™ã«åŸºã¥ã„ã¦è¨˜äº‹ã®è¿½åŠ ã‚„ç·¨é›†ãªã©ã®æ“ä½œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
3. **`Anonymous`**: ã™ã¹ã¦ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆè¨ªå•è€…ã¯åŒ¿åã¨ã—ã¦æŒ‡å®šã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã“ã‚Œã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æŠ•ç¨¿ã‚’èª­ã‚€ã“ã¨ã®ã¿è¨±å¯ã•ã‚Œã¦ã„ã¾ã™ã€‚

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åˆ—æŒ™ã™ã‚‹ã«ã¯ï¼š**

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å–å¾—ã™ã‚‹**: `/user/1`ã€`/user/2`ã€`/user/3`...ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¤ºã™ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹ã¾ã§ç¶šã‘ã¾ã™ã€‚
* **ç™»éŒ²**: `/user/register`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½œæˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€åå‰ãŒã™ã§ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ã§ç¤ºã•ã‚Œã¾ã™ã€‚
* **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã‚ˆã†ã¨ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ˜ç¢ºã«ç¤ºã•ã‚Œã¾ã™ã€‚

### éš ã—ãƒšãƒ¼ã‚¸

**`/node/FUZZ`**ã‚’èª¿ã¹ã¦æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚ã“ã“ã§**`FUZZ`**ã¯æ•°å­—ï¼ˆä¾‹ãˆã°1ã‹ã‚‰1000ã¾ã§ï¼‰ã§ã™ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
## è‡ªå‹•ãƒ„ãƒ¼ãƒ«
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCE

Drupalã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã¯ã€RCEã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã“ã‚Œã‚‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="drupal-rce.md" %}
[drupal-rce.md](drupal-rce.md)
{% endcontent-ref %}

## From XSS to RCE

* [**Drupalwned**](https://github.com/nowak0x01/Drupalwned): XSSã‚’RCEã¾ãŸã¯ãã®ä»–ã®é‡å¤§ãªè„†å¼±æ€§ã«æ˜‡æ ¼ã•ã›ã‚‹Drupalã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚è©³ç´°ã«ã¤ã„ã¦ã¯[**ã“ã®æŠ•ç¨¿**](https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**Drupalãƒãƒ¼ã‚¸ãƒ§ãƒ³7.X.Xã€8.X.Xã€9.X.Xã€10.X.Xã‚’ã‚µãƒãƒ¼ãƒˆã—ã€æ¬¡ã®ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ï¼š**
* _**ç‰¹æ¨©æ˜‡æ ¼ï¼š**_ Drupalã«ç®¡ç†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚
* _**(RCE) ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼š**_ Drupalã«ãƒãƒƒã‚¯ãƒ‰ã‚¢ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

## Post Exploitation

### Read settings.php

{% code overflow="wrap" %}
```bash
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### DBã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹

{% code overflow="wrap" %}
```bash
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
{% endcode %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
