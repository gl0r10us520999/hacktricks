# Sicurezza di ImageMagick

{% hint style="success" %}
Impara e pratica il hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Impara e pratica il hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}

Controlla ulteriori dettagli in [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

ImageMagick, una libreria versatile per l'elaborazione delle immagini, presenta una sfida nella configurazione della sua politica di sicurezza a causa delle sue ampie opzioni e della mancanza di documentazione dettagliata online. Gli utenti spesso creano politiche basate su fonti frammentate di internet, portando a potenziali misconfigurazioni. La libreria supporta una vasta gamma di oltre 100 formati di immagine, ognuno dei quali contribuisce alla sua complessit√† e profilo di vulnerabilit√†, come dimostrano gli incidenti di sicurezza storici.

## Verso Politiche pi√π Sicure
Per affrontare queste sfide, √® stato [sviluppato uno strumento](https://imagemagick-secevaluator.doyensec.com/) per aiutare nella progettazione e nell'audit delle politiche di sicurezza di ImageMagick. Questo strumento √® radicato in una ricerca approfondita e mira a garantire che le politiche non siano solo robuste, ma anche prive di scappatoie che potrebbero essere sfruttate.

## Approccio Allowlist vs Denylist
Storicamente, le politiche di ImageMagick si basavano su un approccio denylist, in cui a specifici coders veniva negato l'accesso. Tuttavia, i cambiamenti in ImageMagick 6.9.7-7 hanno spostato questo paradigma, abilitando un approccio allowlist. Questo approccio nega prima l'accesso a tutti i coders e poi concede selettivamente l'accesso a quelli fidati, migliorando la postura di sicurezza.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Case Sensitivity in Policies
√à fondamentale notare che i modelli di policy in ImageMagick sono sensibili al maiuscolo. Pertanto, garantire che i codici e i moduli siano correttamente scritti in maiuscolo nelle policy √® vitale per prevenire permessi non intenzionali.

## Resource Limits
ImageMagick √® soggetto ad attacchi di denial of service se non configurato correttamente. Impostare limiti di risorse espliciti nella policy √® essenziale per prevenire tali vulnerabilit√†.

## Policy Fragmentation
Le policy possono essere frammentate tra diverse installazioni di ImageMagick, portando a potenziali conflitti o sovrascritture. Si consiglia di localizzare e verificare i file di policy attivi utilizzando comandi come:
```shell
$ find / -iname policy.xml
```
## Una Politica Iniziale e Ristrettiva
√à stato proposto un modello di politica restrittiva, incentrato su limitazioni rigorose delle risorse e controlli di accesso. Questo modello serve come base per sviluppare politiche personalizzate che si allineano con i requisiti specifici dell'applicazione.

L'efficacia di una politica di sicurezza pu√≤ essere confermata utilizzando il comando `identify -list policy` in ImageMagick. Inoltre, lo [strumento di valutazione](https://imagemagick-secevaluator.doyensec.com/) menzionato in precedenza pu√≤ essere utilizzato per affinare la politica in base alle esigenze individuali.

## Riferimenti
* [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
