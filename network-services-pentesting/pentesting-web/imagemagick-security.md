# Seguridad de ImageMagick

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

Consulta m치s detalles en [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

ImageMagick, una vers치til biblioteca de procesamiento de im치genes, presenta un desaf칤o en la configuraci칩n de su pol칤tica de seguridad debido a sus amplias opciones y la falta de documentaci칩n detallada en l칤nea. Los usuarios a menudo crean pol칤ticas basadas en fuentes fragmentadas de internet, lo que lleva a posibles configuraciones incorrectas. La biblioteca admite una vasta gama de m치s de 100 formatos de imagen, cada uno contribuyendo a su complejidad y perfil de vulnerabilidad, como lo demuestran los incidentes de seguridad hist칩ricos.

## Hacia Pol칤ticas M치s Seguras
Para abordar estos desaf칤os, se ha [desarrollado una herramienta](https://imagemagick-secevaluator.doyensec.com/) para ayudar en el dise침o y auditor칤a de las pol칤ticas de seguridad de ImageMagick. Esta herramienta se basa en una extensa investigaci칩n y tiene como objetivo garantizar que las pol칤ticas no solo sean robustas, sino tambi칠n libres de lagunas que puedan ser explotadas.

## Enfoque de Lista Permitida vs Lista Denegada
Hist칩ricamente, las pol칤ticas de ImageMagick se basaban en un enfoque de lista denegada, donde se negaba el acceso a codificadores espec칤ficos. Sin embargo, los cambios en ImageMagick 6.9.7-7 cambiaron este paradigma, permitiendo un enfoque de lista permitida. Este enfoque primero niega el acceso a todos los codificadores y luego otorga acceso selectivamente a los de confianza, mejorando la postura de seguridad.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Sensibilidad a May칰sculas en Pol칤ticas
Es crucial notar que los patrones de pol칤ticas en ImageMagick son sensibles a may칰sculas. Como tal, asegurar que los codificadores y m칩dulos est칠n correctamente en may칰sculas en las pol칤ticas es vital para prevenir permisos no intencionados.

## L칤mites de Recursos
ImageMagick es propenso a ataques de denegaci칩n de servicio si no est치 configurado correctamente. Establecer l칤mites de recursos expl칤citos en la pol칤tica es esencial para prevenir tales vulnerabilidades.

## Fragmentaci칩n de Pol칤ticas
Las pol칤ticas pueden estar fragmentadas a trav칠s de diferentes instalaciones de ImageMagick, lo que lleva a posibles conflictos o sobrescrituras. Se recomienda localizar y verificar los archivos de pol칤ticas activos utilizando comandos como:
```shell
$ find / -iname policy.xml
```
## Una Pol칤tica Inicial, Restrictiva
Se ha propuesto una plantilla de pol칤tica restrictiva, centrada en limitaciones de recursos estrictas y controles de acceso. Esta plantilla sirve como base para desarrollar pol칤ticas personalizadas que se alineen con los requisitos espec칤ficos de la aplicaci칩n.

La efectividad de una pol칤tica de seguridad se puede confirmar utilizando el comando `identify -list policy` en ImageMagick. Adem치s, la [herramienta evaluadora](https://imagemagick-secevaluator.doyensec.com/) mencionada anteriormente se puede utilizar para refinar la pol칤tica seg칰n las necesidades individuales.

## Referencias
* [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
