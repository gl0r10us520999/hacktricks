# ImageMagick-Sicherheit

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

√úberpr√ºfen Sie weitere Details in [**https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)

ImageMagick, eine vielseitige Bildverarbeitungsbibliothek, stellt eine Herausforderung bei der Konfiguration ihrer Sicherheitsrichtlinien dar, aufgrund ihrer umfangreichen Optionen und des Mangels an detaillierter Online-Dokumentation. Benutzer erstellen oft Richtlinien basierend auf fragmentierten Internetquellen, was zu potenziellen Fehlkonfigurationen f√ºhren kann. Die Bibliothek unterst√ºtzt eine Vielzahl von √ºber 100 Bildformaten, die jeweils zu ihrer Komplexit√§t und ihrem Schwachstellenprofil beitragen, wie historische Sicherheitsvorf√§lle zeigen.

## Auf dem Weg zu sichereren Richtlinien
Um diese Herausforderungen anzugehen, wurde ein [Tool entwickelt](https://imagemagick-secevaluator.doyensec.com/), das bei der Gestaltung und Pr√ºfung der Sicherheitsrichtlinien von ImageMagick hilft. Dieses Tool basiert auf umfangreicher Forschung und zielt darauf ab, sicherzustellen, dass die Richtlinien nicht nur robust, sondern auch frei von Schlupfl√∂chern sind, die ausgenutzt werden k√∂nnten.

## Allowlist- vs. Denylist-Ansatz
Historisch gesehen basierten die ImageMagick-Richtlinien auf einem Denylist-Ansatz, bei dem bestimmten Codierern der Zugang verweigert wurde. √Ñnderungen in ImageMagick 6.9.7-7 verschoben jedoch dieses Paradigma und erm√∂glichten einen Allowlist-Ansatz. Dieser Ansatz verweigert zun√§chst allen Codierern den Zugang und gew√§hrt dann selektiv vertrauensw√ºrdigen Codierern Zugang, was die Sicherheitslage verbessert.
```xml
...
<policy domain="coder" rights="none" pattern="*" />
<policy domain="coder" rights="read | write" pattern="{GIF,JPEG,PNG,WEBP}" />
...
```
## Gro√ü- und Kleinschreibung in Richtlinien
Es ist wichtig zu beachten, dass Richtlinienmuster in ImageMagick gro√ü- und kleinschreibungsempfindlich sind. Daher ist es entscheidend, dass Codierer und Module in den Richtlinien korrekt gro√ügeschrieben werden, um unbeabsichtigte Berechtigungen zu verhindern.

## Ressourcenlimits
ImageMagick ist anf√§llig f√ºr Denial-of-Service-Angriffe, wenn es nicht richtig konfiguriert ist. Das Festlegen expliziter Ressourcenlimits in der Richtlinie ist entscheidend, um solche Schwachstellen zu verhindern.

## Richtlinienfragmentierung
Richtlinien k√∂nnen √ºber verschiedene ImageMagick-Installationen fragmentiert sein, was zu potenziellen Konflikten oder √úberschreibungen f√ºhren kann. Es wird empfohlen, die aktiven Richtliniendateien mit Befehlen wie: zu lokalisieren und zu √ºberpr√ºfen:
```shell
$ find / -iname policy.xml
```
## Eine Einsteiger-, Restriktive Richtlinie
Eine restriktive Richtlinienevorlage wurde vorgeschlagen, die sich auf strenge Ressourcenbeschr√§nkungen und Zugangskontrollen konzentriert. Diese Vorlage dient als Grundlage f√ºr die Entwicklung ma√ügeschneiderter Richtlinien, die mit den spezifischen Anforderungen der Anwendung √ºbereinstimmen.

Die Wirksamkeit einer Sicherheitsrichtlinie kann mit dem Befehl `identify -list policy` in ImageMagick best√§tigt werden. Dar√ºber hinaus kann das zuvor erw√§hnte [evaluator tool](https://imagemagick-secevaluator.doyensec.com/) verwendet werden, um die Richtlinie basierend auf individuellen Bed√ºrfnissen zu verfeinern.

## Referenzen
* [https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html**](https://blog.doyensec.com/2023/01/10/imagemagick-security-policy-evaluator.html)



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
