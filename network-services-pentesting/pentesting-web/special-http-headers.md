# Specijalni HTTP zaglavlja

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Liste reÄi i alati

* [https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers](https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous/Web/http-request-headers)
* [https://github.com/rfc-st/humble](https://github.com/rfc-st/humble)

## Zaglavlja za promenu lokacije

Prepisivanje **IP izvora**:

* `X-Originating-IP: 127.0.0.1`
* `X-Forwarded-For: 127.0.0.1`
* `X-Forwarded: 127.0.0.1`
* `Forwarded-For: 127.0.0.1`
* `X-Forwarded-Host: 127.0.0.1`
* `X-Remote-IP: 127.0.0.1`
* `X-Remote-Addr: 127.0.0.1`
* `X-ProxyUser-Ip: 127.0.0.1`
* `X-Original-URL: 127.0.0.1`
* `Client-IP: 127.0.0.1`
* `X-Client-IP: 127.0.0.1`
* `X-Host: 127.0.0.1`
* `True-Client-IP: 127.0.0.1`
* `Cluster-Client-IP: 127.0.0.1`
* `Via: 1.0 fred, 1.1 127.0.0.1`
* `Connection: close, X-Forwarded-For` (Proverite hop-by-hop zaglavlja)

Prepisivanje **lokacije**:

* `X-Original-URL: /admin/console`
* `X-Rewrite-URL: /admin/console`

## Hop-by-Hop zaglavlja

Hop-by-hop zaglavlje je zaglavlje koje je dizajnirano da bude obraÄ‘eno i konzumirano od strane proksija koji trenutno obraÄ‘uje zahtev, za razliku od zaglavlja end-to-end.

* `Connection: close, X-Forwarded-For`

{% content-ref url="../../pentesting-web/abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../../pentesting-web/abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Request Smuggling

* `Content-Length: 30`
* `Transfer-Encoding: chunked`

{% content-ref url="../../pentesting-web/http-request-smuggling/" %}
[http-request-smuggling](../../pentesting-web/http-request-smuggling/)
{% endcontent-ref %}

## Cache zaglavlja

**Zaglavlja server keÅ¡a**:

* **`X-Cache`** u odgovoru moÅ¾e imati vrednost **`miss`** kada zahtev nije keÅ¡iran i vrednost **`hit`** kada je keÅ¡iran
* SliÄno ponaÅ¡anje u zaglavlju **`Cf-Cache-Status`**
* **`Cache-Control`** oznaÄava da li se resurs keÅ¡ira i kada Ä‡e biti sledeÄ‡i put keÅ¡iran: `Cache-Control: public, max-age=1800`
* **`Vary`** se Äesto koristi u odgovoru da **oznaÄi dodatna zaglavlja** koja se tretiraju kao **deo keÅ¡ kljuÄa** Äak i ako su obiÄno nekljuÄevi.
* **`Age`** definiÅ¡e vreme u sekundama koliko je objekat bio u proksi keÅ¡u.
* **`Server-Timing: cdn-cache; desc=HIT`** takoÄ‘e oznaÄava da je resurs keÅ¡iran

{% content-ref url="../../pentesting-web/cache-deception/" %}
[cache-deception](../../pentesting-web/cache-deception/)
{% endcontent-ref %}

**Lokalna keÅ¡ zaglavlja**:

* `Clear-Site-Data`: Zaglavlje koje oznaÄava keÅ¡ koji treba ukloniti: `Clear-Site-Data: "cache", "cookies"`
* `Expires`: SadrÅ¾i datum/vreme kada odgovor treba da istekne: `Expires: Wed, 21 Oct 2015 07:28:00 GMT`
* `Pragma: no-cache` isto kao `Cache-Control: no-cache`
* `Warning`: **`Warning`** opÅ¡te HTTP zaglavlje sadrÅ¾i informacije o moguÄ‡im problemima sa statusom poruke. MoÅ¾e se pojaviti viÅ¡e od jednog `Warning` zaglavlja u odgovoru. `Warning: 110 anderson/1.3.37 "Response is stale"`

## Uslovi

* Zahtevi koji koriste ova zaglavlja: **`If-Modified-Since`** i **`If-Unmodified-Since`** Ä‡e dobiti odgovor sa podacima samo ako zaglavlje odgovora\*\*`Last-Modified`\*\* sadrÅ¾i drugaÄije vreme.
* Uslovni zahtevi koristeÄ‡i **`If-Match`** i **`If-None-Match`** koriste Etag vrednost tako da web server poÅ¡alje sadrÅ¾aj odgovora ako su podaci (Etag) promenjeni. `Etag` se uzima iz HTTP odgovora.
* Vrednost **Etag** se obiÄno **izraÄunava** na osnovu **sadrÅ¾aja** odgovora. Na primer, `ETag: W/"37-eL2g8DEyqntYlaLp5XLInBWsjWI"` oznaÄava da je `Etag` **Sha1** od **37 bajtova**.

## Zahtevi opsega

* **`Accept-Ranges`**: OznaÄava da li server podrÅ¾ava zahteve opsega, i ako da, u kojoj jedinici se opseg moÅ¾e izraziti. `Accept-Ranges: <range-unit>`
* **`Range`**: OznaÄava deo dokumenta koji server treba da vrati.
* **`If-Range`**: Stvara uslovni zahtev opsega koji se ispunjava samo ako dati etag ili datum odgovara udaljenom resursu. Koristi se da se spreÄi preuzimanje dva opsega iz nekompatibilnih verzija resursa.
* **`Content-Range`**: OznaÄava gde u punom telu poruke pripada delimiÄna poruka.

## Informacije o telu poruke

* **`Content-Length`:** VeliÄina resursa, u decimalnom broju bajtova.
* **`Content-Type`**: OznaÄava medijski tip resursa
* **`Content-Encoding`**: Koristi se za specifikaciju algoritma kompresije.
* **`Content-Language`**: Opisuje ljudski jezik(e) namenjene publici, tako da omoguÄ‡ava korisniku da razlikuje prema vlastitom preferiranom jeziku.
* **`Content-Location`**: OznaÄava alternativnu lokaciju za vraÄ‡ene podatke.

Iz perspektive pentesta, ove informacije su obiÄno "beskorisne", ali ako je resurs **zaÅ¡tiÄ‡en** 401 ili 403 i moÅ¾ete pronaÄ‡i neki **naÄin** da **dobijete** ove **informacije**, to bi moglo biti **zanimljivo.**\
Na primer, kombinacija **`Range`** i **`Etag`** u HEAD zahtevu moÅ¾e otkriti sadrÅ¾aj stranice putem HEAD zahteva:

* Zahtev sa zaglavljem `Range: bytes=20-20` i sa odgovorom koji sadrÅ¾i `ETag: W/"1-eoGvPlkaxxP4HqHv6T3PNhV9g3Y"` otkriva da je SHA1 bajta 20 `ETag: eoGvPlkaxxP4HqHv6T3PNhV9g3Y`

## Informacije o serveru

* `Server: Apache/2.4.1 (Unix)`
* `X-Powered-By: PHP/5.3.3`

## Kontrole

* **`Allow`**: Ovo zaglavlje se koristi za komunikaciju HTTP metoda koje resurs moÅ¾e obraditi. Na primer, moÅ¾e biti specificirano kao `Allow: GET, POST, HEAD`, Å¡to oznaÄava da resurs podrÅ¾ava ove metode.
* **`Expect`**: Koristi se od strane klijenta da prenese oÄekivanja koja server treba da ispuni kako bi zahtev bio uspeÅ¡no obraÄ‘en. UobiÄajena upotreba ukljuÄuje zaglavlje `Expect: 100-continue`, koje signalizira da klijent namerava da poÅ¡alje veliki paket podataka. Klijent traÅ¾i `100 (Continue)` odgovor pre nego Å¡to nastavi sa prenosom. Ovaj mehanizam pomaÅ¾e u optimizaciji koriÅ¡Ä‡enja mreÅ¾e ÄekajuÄ‡i potvrdu servera.

## Preuzimanja

* **`Content-Disposition`** zaglavlje u HTTP odgovorima usmerava da li bi datoteka trebala biti prikazana **inline** (unutar veb stranice) ili tretirana kao **prilog** (preuzeta). Na primer:
```
Content-Disposition: attachment; filename="filename.jpg"
```
Ovo znaÄi da je datoteka pod nazivom "filename.jpg" namenjena preuzimanju i Äuvanju.

## Bezbednosni Headeri

### Politika Bezbednosti SadrÅ¾aja (CSP) <a href="#csp" id="csp"></a>

{% content-ref url="../../pentesting-web/content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../../pentesting-web/content-security-policy-csp-bypass/)
{% endcontent-ref %}

### **Poverljivi Tipovi**

SprovodeÄ‡i Poverljive Tipove putem CSP-a, aplikacije se mogu zaÅ¡tititi od DOM XSS napada. Poverljivi Tipovi osiguravaju da se samo posebno izraÄ‘eni objekti, u skladu sa uspostavljenim bezbednosnim politikama, mogu koristiti u opasnim pozivima web API-ja, Äime se podrazumevano osigurava JavaScript kod.
```javascript
// Feature detection
if (window.trustedTypes && trustedTypes.createPolicy) {
// Name and create a policy
const policy = trustedTypes.createPolicy('escapePolicy', {
createHTML: str => str.replace(/\</g, '&lt;').replace(/>/g, '&gt;');
});
}
```

```javascript
// Assignment of raw strings is blocked, ensuring safety.
el.innerHTML = 'some string'; // Throws an exception.
const escaped = policy.createHTML('<img src=x onerror=alert(1)>');
el.innerHTML = escaped;  // Results in safe assignment.
```
### **X-Content-Type-Options**

Ova zaglavlja spreÄavaju MIME tip sniffing, praksu koja moÅ¾e dovesti do XSS ranjivosti. Osigurava da pregledaÄi poÅ¡tuju MIME tipove koje je odredio server.
```
X-Content-Type-Options: nosniff
```
### **X-Frame-Options**

Da bi se borili protiv clickjackinga, ovaj header ograniÄava kako se dokumenti mogu ugraditi u `<frame>`, `<iframe>`, `<embed>`, ili `<object>` tagove, preporuÄujuÄ‡i svim dokumentima da eksplicitno navedu svoja dopuÅ¡tenja za ugradnju.
```
X-Frame-Options: DENY
```
### **Cross-Origin Resource Policy (CORP) i Cross-Origin Resource Sharing (CORS)**

CORP je kljuÄan za odreÄ‘ivanje koje resurse mogu uÄitati veb sajtovi, smanjujuÄ‡i cross-site leak-ove. CORS, s druge strane, omoguÄ‡ava fleksibilniji mehanizam deljenja resursa izmeÄ‘u razliÄitih izvora, opuÅ¡tajuÄ‡i politiku istog izvora pod odreÄ‘enim uslovima.
```
Cross-Origin-Resource-Policy: same-origin
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true
```
### **Cross-Origin Embedder Policy (COEP) i Cross-Origin Opener Policy (COOP)**

COEP i COOP su kljuÄni za omoguÄ‡avanje izolacije izmeÄ‘u razliÄitih izvora, znaÄajno smanjujuÄ‡i rizik od napada sliÄnih Spectre-u. Oni kontroliÅ¡u uÄitavanje resursa iz drugih izvora i interakciju sa prozorima iz drugih izvora, redom.
```
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin-allow-popups
```
### **HTTP Strict Transport Security (HSTS)**

Na kraju, HSTS je bezbednosna funkcija koja prisiljava pretraÅ¾ivaÄe da komuniciraju sa serverima samo preko sigurnih HTTPS veza, Äime se poboljÅ¡ava privatnost i bezbednost.
```
Strict-Transport-Security: max-age=3153600
```
## Reference

* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
* [https://web.dev/security-headers/](https://web.dev/security-headers/)
* [https://web.dev/articles/security-headers](https://web.dev/articles/security-headers)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
