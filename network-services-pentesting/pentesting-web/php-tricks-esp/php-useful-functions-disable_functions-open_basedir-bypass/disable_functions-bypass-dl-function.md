<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>! 'ej</summary>

HackTricks vItlhutlh:

* **HackTricks vItlhutlh** 'ej **HackTricks PDF** Download **tlhInganpu'** **'oH** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) **qaStaHvIS** **tlhInganpu'** **advertised company** **tlhInganpu'** **ghItlhvam**.
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) **ghItlhvam**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) **ghItlhvam**, **exclusive NFTs** [**tlhInganpu'**](https://opensea.io/collection/the-peass-family) **ghItlhvam**
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) **'ej** [**telegram group**](https://t.me/peass) **'ej** **follow** **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) **'ej** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos**.

</details>

**'oH** **ghItlhvam:**

![image](https://user-images.githubusercontent.com/84577967/174675487-a4c4ca06-194f-4725-85af-231a2f35d56c.png)

**`dl`** **PHP function** 'oH, **PHP extensions** **load** **ghItlhvam**. **bypass `disable_functions` 'ej arbitrary commands execute** **ghItlhvam** **bypass** **'e'** **'oH** **'e'** **'e'**:

* **`dl` function** **present** **environment** **'ej** **disabled** **not**
* **PHP Extension** **compiled** **major version** (PHP API version) **server** **using** **(phpinfo output** **vItlhutlh** **jImej)**
* **PHP extension** **located** **directory** **defined** **`extension_dir`** **directive** **(phpinfo output** **vItlhutlh** **jImej)**. **attacker** **server** **abuse** **trying** **unprobeable** **directory** **write access** **have** **probably** **requirement** **abuse** **technique** **prevent**.

**'ej** **requirements** **meet** **bypass disable_functions** **post** **reading** **continue** [**https://antichat.com/threads/70763/**](https://antichat.com/threads/70763/) **ghItlhvam**. **Summary** **'e'**:

[dl function](http://www.php.net/manual/en/function.dl.php) **PHP extensions** **load** **script execution** **ghItlhvam**. **PHP extensions**, **C/C++ written**, **PHP functionality** **enhance**. **attacker**, **`dl` function** **disabled** **noticed**, **custom PHP extension** **create** **decides** **system commands** **execute**.

### **Attacker** **Steps Taken**:

1. **PHP Version Identification:**
- **attacker** **PHP version** **determine** **script** (`<?php echo 'PHP Version is '.PHP_VERSION; ?>`) **using**.

2. **PHP Source Acquisition:**
- **PHP source** **official PHP website** [PHP website](http://www.php.net/downloads.php) **'ej** **archive** [archive](http://museum.php.net) **'e'** **older** **version**.

3. **Local PHP Setup:**
- **specific PHP version** **extract** **install** **attacker** **system**.

4. **Extension Creation:**
- **PHP extensions** **create** **study** [creating PHP extensions](http://www.php.net/manual/en/zend.creating.php) **'ej** **PHP source code** **inspect**.
- **focus** **[exec function](http://www.php.net/manual/en/function.exec.php)** **functionality** **duplicate** **ext/standard/exec.c** **located**.

### **Custom Extension** **Compiling** **Notes**:

1. **ZEND_MODULE_API_NO:**
- **`ZEND_MODULE_API_NO`** **bypass.c** **match** **current Zend Extension Build** **retrievable**:
```bash
php -i | grep "Zend Extension Build" |awk -F"API4" '{print $2}' | awk -F"," '{print $1}'
```

2. **PHP_FUNCTION Modification:**
- **recent PHP versions** (5, 7, 8), **`PHP_FUNCTION(bypass_exec)`** **adjustment** **need**. **provided code snippet** **modification** **details**.

### **Custom Extension Files**:

- **bypass.c**:
- **custom extension** **core functionality** **implement**.
- **php_bypass.h**:
- **Header file**, **extension properties** **define**.
- **config.m4**:
- **`phpize`** **build environment** **configure** **custom extension** **used**.

### **Extension Building**:

1. **Compilation Commands:**
- **`phpize`**, **`./configure`**, **`make`** **compile** **extension** **use**.
- **Resulting `bypass.so`** **modules subdirectory** **located**.

2. **Cleanup:**
- **`make clean`** **`phpize --clean`** **compilation** **after** **run**.

### **Uploading** **Executing** **Victim Host**:

1. **Version Compatibility:**
- **attacker** **victim** **PHP API versions** **ensure** **match**.

2. **Extension Loading:**
- **`dl` function** **utilize**, **restrictions** **circumvent** **relative paths** **script** **automate** **process** **using**.

3. **Script Execution:**
- **attacker** **uploads** **bypass.so** **PHP script** **victim** **server**.
- **script** **`dl_local` function** **dynamically load** **bypass.so** **'ej** **`cmd` query parameter** **passed** **bypass_exec** **call**.

### **Command Execution**:

- **attacker** **commands execute** **accessing**: `http://www.example.com/script.php?cmd=<command>`


**Detailed walkthrough** **process** **PHP extension** **create** **deploy** **system commands execute** **exploit** **`dl` function**, **disabled** **ideally** **prevent** **security breaches**.


<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>! 'ej</summary>

HackTricks vItlhutlh:

* **HackTricks vItlhutlh** 'ej **HackTricks PDF** Download **tlhInganpu'** **'oH** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) **qaStaHvIS** **tlhInganpu'** **advertised company** **tlhInganpu'** **ghItlhvam**.
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) **ghItlhvam**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) **ghItlhvam**, **exclusive NFTs** [**tlhInganpu'**](https://opensea.io/collection/the-peass-family) **ghItlhvam**
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) **'ej** [**telegram group**](https://t.me/peass) **'ej** **follow** **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) **'ej** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos**.

</details>
