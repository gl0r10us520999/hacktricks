# PHP SSRF

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### SSRF PHP functions

‡§ï‡•Å‡§õ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ú‡•à‡§∏‡•á **file\_get\_contents(), fopen(), file(), md5\_file()** URL ‡§ï‡•ã ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡•ç‡§π‡•á‡§Ç ‡§µ‡•á ‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á ‡§ú‡§ø‡§∏‡§∏‡•á **‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ SSRF ‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡§æ‡§Å** ‡§¨‡§® ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç ‡§Ø‡§¶‡§ø ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:
```php
file_get_contents("http://127.0.0.1:8081");
fopen("http://127.0.0.1:8081", "r");
file("http://127.0.0.1:8081");
md5_file("http://127.0.0.1:8081");
```
### Wordpress SSRF via DNS Rebinding

‡§ú‡•à‡§∏‡§æ ‡§ï‡§ø [**‡§á‡§∏ ‡§¨‡•ç‡§≤‡•â‡§ó ‡§™‡•ã‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§ù‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à**](https://patchstack.com/articles/exploring-the-unpatched-wordpress-ssrf), ‡§Ø‡§π‡§æ‡§Ç ‡§§‡§ï ‡§ï‡§ø Wordpress ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® **`wp_safe_remote_get`** DNS rebinding ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á ‡§Ø‡§π ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á SSRF ‡§π‡§Æ‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§ú‡•ã ‡§Ø‡§π ‡§ï‡•â‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§µ‡§π ‡§π‡•à **wp\_http\_validate\_ur**l, ‡§ú‡•ã ‡§Ø‡§π ‡§ú‡§æ‡§Ç‡§ö‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ï‡•â‡§≤ `http://` ‡§Ø‡§æ `https://` ‡§π‡•à ‡§î‡§∞ ‡§ï‡§ø ‡§™‡•ã‡§∞‡•ç‡§ü **80**, **443**, ‡§î‡§∞ **8080** ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§è‡§ï ‡§π‡•à, ‡§≤‡•á‡§ï‡§ø‡§® ‡§Ø‡§π **DNS rebinding ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•à**‡•§

‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§π‡•à‡§Ç:

* `wp_safe_remote_request()`
* `wp_safe_remote_post()`
* `wp_safe_remote_head()`
* `WP_REST_URL_Details_Controller::get_remote_url()`
* `download_url()`
* `wp_remote_fopen()`
* `WP_oEmbed::discover()`

### CRLF

‡§á‡§∏‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ, ‡§ï‡•Å‡§õ ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§Æ‡•á‡§Ç, ‡§™‡§ø‡§õ‡§≤‡•á ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç CRLF "‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡•ã‡§Ç" ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§π‡•á‡§°‡§∞ ‡§≠‡•á‡§ú‡§®‡§æ ‡§≠‡•Ä ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:
```php
# The following will create a header called from with value Hi and
# an extra header "Injected: I HAVE IT"
ini_set("from", "Hi\r\nInjected: I HAVE IT");
file_get_contents("http://127.0.0.1:8081");

GET / HTTP/1.1
From: Hi
Injected: I HAVE IT
Host: 127.0.0.1:8081
Connection: close

# Any of the previously mentioned functions will send those headers
```
{% hint style="warning" %}
‡§á‡§∏ CRLF vuln ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§á‡§∏ ‡§¨‡§ó ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç [https://bugs.php.net/bug.php?id=81680\&edit=1](https://bugs.php.net/bug.php?id=81680\&edit=1)
{% endhint %}

‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§á‡§® ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§π‡•á‡§°‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§Ö‡§®‡•ç‡§Ø ‡§§‡§∞‡•Ä‡§ï‡•á ‡§π‡•ã ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•à‡§∏‡•á:
```php
$url = "";

$options = array(
'http'=>array(
'method'=>"GET",
'header'=>"Accept-language: en\r\n" .
"Cookie: foo=bar\r\n" .  // check function.stream-context-create on php.net
"User-Agent: Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B334b Safari/531.21.102011-10-16 20:23:10\r\n" // i.e. An iPad
)
);

$context = stream_context_create($options);
$file = file_get_contents($url, false, $context);
```
{% hint style="success" %}
‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å**](https://github.com/sponsors/carlospolop) ‡§¶‡•á‡§ñ‡•á‡§Ç!
* **‡§π‡§Æ‡§æ‡§∞‡•á ‡§∏‡§æ‡§• ‡§ú‡•Å‡§°‡§º‡•á‡§Ç** üí¨ [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Ø‡§æ **‡§π‡§Æ‡•á‡§Ç** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ‡§™‡§∞ ‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç‡•§**
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞** [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ‡§ó‡§ø‡§ü‡§π‡§¨ ‡§∞‡§ø‡§™‡•ã‡§ú‡§ø‡§ü‡§∞‡•Ä ‡§Æ‡•á‡§Ç PRs ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§

</details>
{% endhint %}
