# Moodle

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_fluent polish written and spoken required_).

{% embed url="https://www.stmcyber.com/careers" %}

## Automatic Scans

### droopescan
```bash
pip3 install droopescan
droopescan scan moodle -u http://moodle.example.com/<moodle_path>/

[+] Plugins found:
forum http://moodle.schooled.htb/moodle/mod/forum/
http://moodle.schooled.htb/moodle/mod/forum/upgrade.txt
http://moodle.schooled.htb/moodle/mod/forum/version.php

[+] No themes found.

[+] Possible version(s):
3.10.0-beta

[+] Possible interesting urls found:
Static readme file. - http://moodle.schooled.htb/moodle/README.txt
Admin panel - http://moodle.schooled.htb/moodle/login/

[+] Scan finished (0:00:05.643539 elapsed)
```
#### moodlescan

moodlescan is a tool used for scanning and enumerating Moodle instances. It can be used to gather information about the Moodle installation, such as version number, installed plugins, and potential vulnerabilities.

To use moodlescan, you need to provide the target Moodle URL. The tool will then perform various checks and tests to gather information about the Moodle instance.

Some of the checks performed by moodlescan include:

- **Version Detection**: moodlescan will attempt to determine the version of Moodle installed on the target system. This information can be useful for identifying potential vulnerabilities that may exist in the specific version.

- **Plugin Enumeration**: moodlescan will enumerate the installed plugins on the Moodle instance. This can help identify any outdated or vulnerable plugins that may be present.

- **User Enumeration**: moodlescan will attempt to enumerate the users registered on the Moodle instance. This can be useful for identifying potential targets for further exploitation.

- **Directory Enumeration**: moodlescan will perform directory enumeration to identify any exposed files or directories on the Moodle instance. This can help identify any sensitive information that may be accessible.

- **Vulnerability Scanning**: moodlescan will perform vulnerability scanning to identify any known vulnerabilities in the Moodle instance. This can help identify potential entry points for exploitation.

Overall, moodlescan is a powerful tool for scanning and enumerating Moodle instances. It can help identify potential vulnerabilities and weaknesses in the Moodle installation, allowing for more effective penetration testing and security assessments.
```bash
#Install from https://github.com/inc0d3/moodlescan
python3 moodlescan.py -k -u http://moodle.example.com/<moodle_path>/

Version 0.7 - Dic/2020
.............................................................................................................

By Victor Herrera - supported by www.incode.cl

.............................................................................................................

Getting server information http://moodle.schooled.htb/moodle/ ...

server         	: Apache/2.4.46 (FreeBSD) PHP/7.4.15
x-powered-by   	: PHP/7.4.15
x-frame-options	: sameorigin
last-modified  	: Wed, 07 Apr 2021 21:33:41 GMT

Getting moodle version...

Version found via /admin/tool/lp/tests/behat/course_competencies.feature : Moodle v3.9.0-beta

Searching vulnerabilities...


Vulnerabilities found: 0

Scan completed.
```
### CMSMap

CMSMap is a Python-based Content Management System (CMS) scanner that helps in identifying the CMS used by a website. It can also enumerate users, plugins, and themes, and perform various other tasks related to CMS security assessment.

#### Installation

To install CMSMap, you can use the following command:

```bash
pip install cmsmap
```

#### Usage

To scan a website for CMS information, you can use the following command:

```bash
cmsmap http://example.com
```

This will display the CMS information, including the version, plugins, and themes used by the website.

#### Features

CMSMap provides the following features:

- CMS identification: It can identify the CMS used by a website.
- User enumeration: It can enumerate the users registered on the website.
- Plugin enumeration: It can enumerate the plugins installed on the website.
- Theme enumeration: It can enumerate the themes used by the website.
- Version detection: It can detect the version of the CMS used by the website.
- Vulnerability scanning: It can scan for known vulnerabilities in the CMS.
- Backup file detection: It can detect backup files left on the server.
- Directory listing: It can check if directory listing is enabled on the server.
- Robots.txt analysis: It can analyze the robots.txt file for interesting information.

#### Conclusion

CMSMap is a powerful tool for CMS security assessment. It provides a wide range of features that can help in identifying vulnerabilities and securing CMS-based websites.
```bash
pip3 install git+https://github.com/dionach/CMSmap.git
cmsmap http://moodle.example.com/<moodle_path>
```
### CVEs

**CVEs**:

**moodle** version vulnerabilities can be found at [**https://snyk.io/vuln/composer:moodle%2Fmoodle**](https://snyk.io/vuln/composer:moodle%2Fmoodle)

## **RCE**

To perform **RCE** on **moodle**, follow these steps:

1. Obtain the **manager** role.
2. Access the **"Site administration"** tab.
3. **Activate** the necessary option (if required). Refer to the moodle privilege escalation PoC: [https://github.com/HoangKien1020/CVE-2020-14321](https://github.com/HoangKien1020/CVE-2020-14321).
4. Install the provided plugin, which contains the **classic pentest-monkey php rev shell**. Before uploading, decompress the plugin, change the IP and port of the revshell, and compress it again.

    {% file src="../../.gitbook/assets/moodle-rce-plugin.zip" %}

    Alternatively, you can use the plugin from [https://github.com/HoangKien1020/Moodle\_RCE](https://github.com/HoangKien1020/Moodle\_RCE) to obtain a regular PHP shell with the "cmd" parameter.

To launch the malicious plugin, access:
```bash
http://domain.com/<moodle_path>/blocks/rce/lang/en/block_rce.php?cmd=id
```
## POST

### Find database credentials

### tlhIngan Hol Translation:

## POST

### yIvbe'pu' Database credentials

### HTML Translation:

<h2>POST</h2>

<h3>Find database credentials</h3>
```bash
find / -name "config.php" 2>/dev/null | grep "moodle/config.php"
```
### qawHaq Credentials vItlhutlh

#### Description
The first step in a web application penetration test is to identify and exploit vulnerabilities in the target system. One common target for attackers is the database, as it often contains valuable information such as user credentials. In this section, we will explore techniques to dump credentials from a database.

#### Methodology
1. **Identify the database**: Determine the type of database used by the web application. Common databases include MySQL, PostgreSQL, and Oracle.

2. **Enumerate database users**: Use techniques such as SQL injection or brute-forcing to identify the database users.

3. **Dump the credentials**: Once the database users are identified, extract the credentials from the database. This can be done using various methods, such as:

   - **SQL queries**: Execute SQL queries to retrieve the credentials from the database tables.
   - **File system access**: If the database stores credentials in configuration files, gain access to the file system and extract the credentials.
   - **Hash cracking**: If the passwords are stored as hashes, use password cracking tools to recover the plaintext passwords.

4. **Validate the credentials**: Test the extracted credentials by attempting to log in to the web application or other services using the obtained credentials.

#### Tools
- **SQLMap**: A popular tool for automated SQL injection and database enumeration.
- **John the Ripper**: A password cracking tool that can be used to crack hashed passwords.

#### Example
Here is an example of using SQLMap to dump credentials from a MySQL database:

```bash
sqlmap -u "http://example.com/login.php?id=1" --dump-all
```

This command instructs SQLMap to perform a SQL injection attack on the specified URL and dump all the data from the database.

#### Mitigation
To prevent credential dumping attacks, it is important to follow secure coding practices and implement proper security measures, such as:

- **Input validation**: Implement strict input validation to prevent SQL injection attacks.
- **Least privilege**: Ensure that database users have the minimum necessary privileges to perform their tasks.
- **Secure password storage**: Store passwords securely by using strong hashing algorithms and salting techniques.
- **Regular updates**: Keep the database software and applications up to date with the latest security patches.

#### Conclusion
Dumping credentials from a database is a common technique used by attackers to gain unauthorized access to web applications. By understanding the methodology and implementing proper security measures, organizations can protect their databases and prevent credential leaks.
```bash
/usr/local/bin/mysql -u <username> --password=<password> -e "use moodle; select email,username,password from mdl_user; exit"
```
<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_fluent polish written and spoken required_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
