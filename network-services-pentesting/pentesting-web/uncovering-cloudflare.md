# Uncovering CloudFlare

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Common Techniques to Uncover Cloudflare

* Alanın **tarihi DNS kayıtlarını** veren bir hizmet kullanabilirsiniz. Belki web sayfası daha önce kullanılan bir IP adresinde çalışıyordur.
* **Tarihi SSL sertifikalarını** kontrol ederek de aynı sonuca ulaşabilirsiniz; bu sertifikalar orijinal IP adresine işaret ediyor olabilir.
* Ayrıca **IP'lere doğrudan işaret eden diğer alt alan adlarının DNS kayıtlarını** kontrol edin; diğer alt alan adlarının aynı sunucuya işaret etmesi mümkündür (belki FTP, mail veya başka bir hizmet sunmak için).
* Eğer web uygulaması içinde bir **SSRF bulursanız**, bunu sunucunun IP adresini elde etmek için kötüye kullanabilirsiniz.
* Shodan gibi tarayıcılarda web sayfasının benzersiz bir dizesini arayın (belki google ve benzerlerinde?). Belki bu içerikle bir IP adresi bulabilirsiniz.
* Benzer bir şekilde, benzersiz bir dize aramak yerine, [https://github.com/karma9874/CloudFlare-IP](https://github.com/karma9874/CloudFlare-IP) aracıyla veya [https://github.com/pielco11/fav-up](https://github.com/pielco11/fav-up) ile favicon simgesini arayabilirsiniz.
* Bu çok sık çalışmayacak çünkü sunucu IP adresiyle erişildiğinde aynı yanıtı göndermelidir, ama asla bilemezsiniz.

## Tools to uncover Cloudflare

* Alan adını [http://www.crimeflare.org:82/cfs.html](http://www.crimeflare.org:82/cfs.html) veya [https://crimeflare.herokuapp.com](https://crimeflare.herokuapp.com) içinde arayın. Ya da [CloudPeler](https://github.com/zidansec/CloudPeler) aracını kullanın (bu API'yi kullanır).
* Alan adını [https://leaked.site/index.php?resolver/cloudflare.0/](https://leaked.site/index.php?resolver/cloudflare.0/) içinde arayın.
* [**CloudFlair**](https://github.com/christophetd/CloudFlair), alan adını içeren Censys sertifikalarını kullanarak arama yapacak bir araçtır, ardından bu sertifikalar içindeki IPv4'leri arayacak ve nihayetinde bu IP'lerdeki web sayfasına erişmeye çalışacaktır.
* [**CloakQuest3r**](https://github.com/spyboy-productions/CloakQuest3r): CloakQuest3r, Cloudflare ve diğer alternatifler tarafından korunan web sitelerinin gerçek IP adresini ortaya çıkarmak için titizlikle hazırlanmış güçlü bir Python aracıdır. Temel misyonu, Cloudflare'ın koruyucu kalkanının arkasında gizlenmiş web sunucularının gerçek IP adresini doğru bir şekilde belirlemektir.
* [Censys](https://search.censys.io/)
* [Shodan](https://shodan.io/)
* [Bypass-firewalls-by-DNS-history](https://github.com/vincentcox/bypass-firewalls-by-DNS-history)
* Web sayfasının bulunduğu potansiyel IP'ler setine sahipseniz, [https://github.com/hakluke/hakoriginfinder](https://github.com/hakluke/hakoriginfinder) kullanabilirsiniz.
```bash
# You can check if the tool is working with
prips 1.0.0.0/30 | hakoriginfinder -h one.one.one.one

# If you know the company is using AWS you could use the previous tool to search the
## web page inside the EC2 IPs
DOMAIN=something.com
WIDE_REGION=us
for ir in `curl https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | select(.region|test("^us")) | .ip_prefix'`; do
echo "Checking $ir"
prips $ir | hakoriginfinder -h "$DOMAIN"
done
```
## Uncovering Cloudflare from Cloud infrastructure

Not edin ki bu AWS makineleri için yapılmış olsa da, bu herhangi bir başka bulut sağlayıcısı için de yapılabilir.

Bu sürecin daha iyi bir tanımı için kontrol edin:

{% embed url="https://trickest.com/blog/cloudflare-bypass-discover-ip-addresses-aws/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
```bash
# Find open ports
sudo masscan --max-rate 10000 -p80,443 $(curl -s https://ip-ranges.amazonaws.com/ip-ranges.json | jq -r '.prefixes[] | select(.service=="EC2") | .ip_prefix' | tr '\n' ' ') | grep "open"  > all_open.txt
# Format results
cat all_open.txt | sed 's,.*port \(.*\)/tcp on \(.*\),\2:\1,' | tr -d " " > all_open_formated.txt
# Search actual web pages
httpx -silent -threads 200 -l all_open_formated.txt -random-agent -follow-redirects -json -no-color -o webs.json
# Format web results and remove eternal redirects
cat webs.json | jq -r "select((.failed==false) and (.chain_status_codes | length) < 9) | .url" | sort -u > aws_webs.json

# Search via Host header
httpx -json -no-color -list aws_webs.json -header Host: cloudflare.malwareworld.com -threads 250 -random-agent -follow-redirects -o web_checks.json
```
## Cloudflare'ı Cloudflare ile Aşmak

### Kimlik Doğrulamalı Kaynak Çekimleri

Bu mekanizma, **Cloudflare’ın ters proxy** sunucuları ile **kaynak** sunucusu arasındaki bağlantıları **kimlik doğrulamak için** **istemci** [**SSL sertifikaları**](https://socradar.io/how-to-monitor-your-ssl-certificates-expiration-easily-and-why/) kullanır ve buna **mTLS** denir.

Kendi sertifikasını yapılandırmak yerine, müşteriler Cloudflare’ın sertifikasını kullanarak Cloudflare'dan gelen herhangi bir bağlantıya izin verebilirler, **kiracıdan bağımsız olarak**.

{% hint style="danger" %}
Bu nedenle, bir saldırgan sadece **Cloudflare'da bir alan adı ayarlayıp Cloudflare'ın sertifikasını kullanarak** bunu **kurban** alan adı **IP** adresine yönlendirebilir. Bu şekilde, alan adını tamamen korumasız bırakarak, Cloudflare gönderilen istekleri korumayacaktır.
{% endhint %}

Daha fazla bilgi [**burada**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

### Cloudflare IP Adreslerini Beyaz Listeye Alma

Bu, **Cloudflare’ın** IP adresi aralıklarından gelmeyen bağlantıları **reddedecektir**. Bu, bir saldırganın sadece **Cloudflare'da kendi alan adını** kurbanın **IP** adresine yönlendirmesi durumunda önceki kurulum için de savunmasızdır.

Daha fazla bilgi [**burada**](https://socradar.io/cloudflare-protection-bypass-vulnerability-on-threat-actors-radar/).

## Scraping için Cloudflare'ı Aşmak

### Önbellek

Bazen sadece web sayfasını kazımak için Cloudflare'ı aşmak istersiniz. Bunun için bazı seçenekler vardır:

* Google önbelleğini kullanın: `https://webcache.googleusercontent.com/search?q=cache:https://www.petsathome.com/shop/en/pets/dog`
* [https://archive.org/web/](https://archive.org/web/) gibi diğer önbellek hizmetlerini kullanın.

### Araçlar

Aşağıdaki gibi bazı araçlar, Cloudflare'ın scraping'e karşı korumasını aşabilir (veya aşabilmiştir):

* [https://github.com/sarperavci/CloudflareBypassForScraping](https://github.com/sarperavci/CloudflareBypassForScraping)

### Cloudflare Çözücüleri

Bir dizi Cloudflare çözücüsü geliştirilmiştir:

* [FlareSolverr](https://github.com/FlareSolverr/FlareSolverr)
* [cloudscraper](https://github.com/VeNoMouS/cloudscraper) [Rehber burada](https://scrapeops.io/python-web-scraping-playbook/python-cloudscraper/)
* [cloudflare-scrape](https://github.com/Anorov/cloudflare-scrape)
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)
* [Cloudflare-IUAM-Solver](https://github.com/ninja-beans/cloudflare-iuam-solver)
* [cloudflare-bypass](https://github.com/devgianlu/cloudflare-bypass) \[Arşivlendi]
* [CloudflareSolverRe](https://github.com/RyuzakiH/CloudflareSolverRe)

### Güçlendirilmiş Başsız Tarayıcılar <a href="#option-4-scrape-with-fortified-headless-browsers" id="option-4-scrape-with-fortified-headless-browsers"></a>

Otomatik bir tarayıcı olarak algılanmayan bir başsız tarayıcı kullanın (bunun için özelleştirmeniz gerekebilir). Bazı seçenekler:

* **Puppeteer:** [puppeteer](https://github.com/puppeteer/puppeteer) için [gizlilik eklentisi](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth).
* **Playwright:** [gizlilik eklentisi](https://www.npmjs.com/package/playwright-stealth) yakında Playwright'a geliyor. Gelişmeleri [burada](https://github.com/berstend/puppeteer-extra/issues/454) ve [burada](https://github.com/berstend/puppeteer-extra/tree/master/packages/playwright-extra) takip edin.
* **Selenium:** [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver) optimize edilmiş bir Selenium Chromedriver yaması.

### Cloudflare Yerleşik Bypass ile Akıllı Proxy <a href="#option-5-smart-proxy-with-cloudflare-built-in-bypass" id="option-5-smart-proxy-with-cloudflare-built-in-bypass"></a>

**Akıllı proxyler**, Cloudflare'ın güvenlik önlemlerini aşmayı hedefleyen özel şirketler tarafından sürekli güncellenmektedir (çünkü bu onların işidir).

Bunlardan bazıları:

* [ScraperAPI](https://www.scraperapi.com/?fp\_ref=scrapeops)
* [Scrapingbee](https://www.scrapingbee.com/?fpr=scrapeops)
* [Oxylabs](https://oxylabs.go2cloud.org/aff\_c?offer\_id=7\&aff\_id=379\&url\_id=32)
* [Smartproxy](https://prf.hn/click/camref:1100loxdG/\[p\_id:1100l442001]/destination:https%3A%2F%2Fsmartproxy.com%2Fscraping%2Fweb) kendi Cloudflare bypass mekanizmaları ile tanınmaktadır.

Optimize edilmiş bir çözüm arayanlar için, [ScrapeOps Proxy Aggregator](https://scrapeops.io/proxy-aggregator/) öne çıkmaktadır. Bu hizmet, 20'den fazla proxy sağlayıcısını tek bir API'de entegre ederek, hedef alan adlarınız için en iyi ve en maliyet etkin proxy'yi otomatik olarak seçer ve böylece Cloudflare'ın savunmalarını aşmak için üstün bir seçenek sunar.

### Cloudflare Anti-Bot Korumasını Tersine Mühendislik <a href="#option-6-reverse-engineer-cloudflare-anti-bot-protection" id="option-6-reverse-engineer-cloudflare-anti-bot-protection"></a>

Cloudflare'ın anti-bot önlemlerini tersine mühendislik yapmak, akıllı proxy sağlayıcıları tarafından kullanılan bir taktiktir ve çok sayıda başsız tarayıcı çalıştırmanın yüksek maliyetinden kaçınarak geniş çaplı web scraping için uygundur.

**Avantajlar:** Bu yöntem, Cloudflare'ın kontrollerini hedef alan son derece verimli bir bypass oluşturulmasına olanak tanır, büyük ölçekli operasyonlar için idealdir.

**Dezavantajlar:** Dezavantajı, Cloudflare'ın kasıtlı olarak belirsiz anti-bot sistemini anlamak ve kandırmakla ilgili karmaşıklıktır; bu, farklı stratejileri test etmek ve Cloudflare korumalarını güçlendirdikçe bypass'ı güncellemek için sürekli çaba gerektirir.

Bunu nasıl yapacağınız hakkında daha fazla bilgi için [orijinal makaleye](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/) bakın.

## Referanslar

* [https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/](https://scrapeops.io/web-scraping-playbook/how-to-bypass-cloudflare/)

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuçlarını paylaşmak için [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.**

</details>
{% endhint %}
