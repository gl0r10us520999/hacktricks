# 9200 - Pentesting Elasticsearch

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>

**Get a hacker's perspective on your web apps, network, and cloud**

**Find and report critical, exploitable vulnerabilities with real business impact.** Use our 20+ custom tools to map the attack surface, find security issues that let you escalate privileges, and use automated exploits to collect essential evidence, turning your hard work into persuasive reports.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

## Basic information

Elasticsearch je **distribuirani**, **otvoreni izvor** pretra≈æivaƒç i analitiƒçki motor za **sve vrste podataka**. Poznat je po svojoj **brzini**, **skalabilnosti** i **jednostavnim REST API-jima**. Izgraƒëen na Apache Lucene, prvi put je objavljen 2010. godine od strane Elasticsearch N.V. (sada poznat kao Elastic). Elasticsearch je osnovna komponenta Elastic Stack-a, kolekcije alata otvorenog koda za unos podataka, obogaƒáivanje, skladi≈°tenje, analizu i vizualizaciju. Ova kolekcija, koja se obiƒçno naziva ELK Stack, takoƒëe ukljuƒçuje Logstash i Kibana, a sada ima i lagane agente za slanje podataka nazvane Beats.

### ≈†ta je Elasticsearch indeks?

Elasticsearch **indeks** je kolekcija **povezanih dokumenata** pohranjenih kao **JSON**. Svaki dokument se sastoji od **kljuƒçeva** i njihovih odgovarajuƒáih **vrednosti** (stringovi, brojevi, booleani, datumi, nizovi, geolokacije, itd.).

Elasticsearch koristi efikasnu strukturu podataka nazvanu **inverzni indeks** kako bi olak≈°ao brza pretra≈æivanja punog teksta. Ovaj indeks navodi svaku jedinstvenu reƒç u dokumentima i identifikuje dokumente u kojima se svaka reƒç pojavljuje.

Tokom procesa indeksiranja, Elasticsearch pohranjuje dokumente i konstruira inverzni indeks, omoguƒáavajuƒái pretra≈æivanje gotovo u realnom vremenu. **Index API** se koristi za dodavanje ili a≈æuriranje JSON dokumenata unutar odreƒëenog indeksa.

**Podrazumevani port**: 9200/tcp

## Manual Enumeration

### Banner

Protokol koji se koristi za pristup Elasticsearch-u je **HTTP**. Kada mu pristupite putem HTTP-a, pronaƒái ƒáete neke zanimljive informacije: `http://10.10.10.115:9200/`

![](<../.gitbook/assets/image (294).png>)

Ako ne vidite taj odgovor prilikom pristupa `/`, pogledajte sledeƒáu sekciju.

### Authentication

**Podrazumevano, Elasticsearch nema omoguƒáenu autentifikaciju**, tako da podrazumevano mo≈æete pristupiti svemu unutar baze podataka bez kori≈°ƒáenja bilo kakvih akreditiva.

Mo≈æete proveriti da li je autentifikacija onemoguƒáena zahtevom na:
```bash
curl -X GET "ELASTICSEARCH-SERVER:9200/_xpack/security/user"
{"error":{"root_cause":[{"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."}],"type":"exception","reason":"Security must be explicitly enabled when using a [basic] license. Enable security by setting [xpack.security.enabled] to [true] in the elasticsearch.yml file and restart the node."},"status":500}
```
**Meƒëutim**, ako po≈°aljete zahtev na `/` i dobijete odgovor poput sledeƒáeg:
```bash
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"security\" charset=\"UTF-8\""}},"status":401}
```
To ƒáe znaƒçiti da je autentifikacija konfigurisana i **potrebne su vam va≈æeƒáe kredencijale** da biste dobili bilo kakve informacije iz elasticsearch-a. Zatim, mo≈æete [**poku≈°ati da bruteforce-ujete**](../generic-methodologies-and-resources/brute-force.md#elasticsearch) (koristi HTTP basic auth, tako da se mo≈æe koristiti bilo ≈°ta ≈°to BF HTTP basic auth mo≈æe).\
Evo vam **lista podrazumevanih korisniƒçkih imena**: _**elastic** (superuser), remote\_monitoring\_user, beats\_system, logstash\_system, kibana, kibana\_system, apm\_system,_ \_anonymous\_._ Starije verzije Elasticsearch-a imaju podrazumevanu lozinku **changeme** za ovog korisnika.
```
curl -X GET http://user:password@IP:9200/
```
### Osnovna Enumeracija Korisnika
```bash
#List all roles on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/role"

#List all users on the system:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user"

#Get more information about the rights of an user:
curl -X GET "ELASTICSEARCH-SERVER:9200/_security/user/<USERNAME>"
```
### Elastic Info

Evo nekoliko krajnjih taƒçaka koje mo≈æete **pristupiti putem GET** da **dobijete** neke **informacije** o elasticsearch:

| \_cat                           | /\_cluster                    | /\_security               |
| ------------------------------- | ----------------------------- | ------------------------- |
| /\_cat/segments                 | /\_cluster/allocation/explain | /\_security/user          |
| /\_cat/shards                   | /\_cluster/settings           | /\_security/privilege     |
| /\_cat/repositories             | /\_cluster/health             | /\_security/role\_mapping |
| /\_cat/recovery                 | /\_cluster/state              | /\_security/role          |
| /\_cat/plugins                  | /\_cluster/stats              | /\_security/api\_key      |
| /\_cat/pending\_tasks           | /\_cluster/pending\_tasks     |                           |
| /\_cat/nodes                    | /\_nodes                      |                           |
| /\_cat/tasks                    | /\_nodes/usage                |                           |
| /\_cat/templates                | /\_nodes/hot\_threads         |                           |
| /\_cat/thread\_pool             | /\_nodes/stats                |                           |
| /\_cat/ml/trained\_models       | /\_tasks                      |                           |
| /\_cat/transforms/\_all         | /\_remote/info                |                           |
| /\_cat/aliases                  |                               |                           |
| /\_cat/allocation               |                               |                           |
| /\_cat/ml/anomaly\_detectors    |                               |                           |
| /\_cat/count                    |                               |                           |
| /\_cat/ml/data\_frame/analytics |                               |                           |
| /\_cat/ml/datafeeds             |                               |                           |
| /\_cat/fielddata                |                               |                           |
| /\_cat/health                   |                               |                           |
| /\_cat/indices                  |                               |                           |
| /\_cat/master                   |                               |                           |
| /\_cat/nodeattrs                |                               |                           |
| /\_cat/nodes                    |                               |                           |

Ove krajnje taƒçke su [**uzete iz dokumentacije**](https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html) gde mo≈æete **pronaƒái vi≈°e**.\
Takoƒëe, ako pristupite `/_cat`, odgovor ƒáe sadr≈æati `/_cat/*` krajnje taƒçke koje podr≈æava instanca.

U `/_security/user` (ako je autentifikacija omoguƒáena) mo≈æete videti koji korisnik ima ulogu `superuser`.

### Indices

Mo≈æete **prikupiti sve indekse** pristupajuƒái `http://10.10.10.115:9200/_cat/indices?v`
```
health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  open   .kibana 6tjAYZrgQ5CwwR0g6VOoRg   1   0          1            0        4kb            4kb
yellow open   quotes  ZG2D1IqkQNiNZmi2HRImnQ   5   1        253            0    262.7kb        262.7kb
yellow open   bank    eSVpNfCfREyYoVigNWcrMw   5   1       1000            0    483.2kb        483.2kb
```
Da biste dobili **informacije o tome koja vrsta podataka je saƒçuvana unutar indeksa**, mo≈æete pristupiti: `http://host:9200/<index>` u ovom sluƒçaju `http://10.10.10.115:9200/bank`

![](<../.gitbook/assets/image (342).png>)

### Dump index

Ako ≈æelite da **izbacite sav sadr≈æaj** indeksa, mo≈æete pristupiti: `http://host:9200/<index>/_search?pretty=true` kao `http://10.10.10.115:9200/bank/_search?pretty=true`

![](<../.gitbook/assets/image (914).png>)

_Uzmite trenutak da uporedite sadr≈æaj svakog dokumenta (unosa) unutar bank indeksa i polja ovog indeksa koja smo videli u prethodnom odeljku._

Dakle, u ovom trenutku mo≈æete primetiti da **postoji polje pod nazivom "total" unutar "hits"** koje ukazuje da je **1000 dokumenata pronaƒëeno** unutar ovog indeksa, ali je samo 10 vraƒáeno. To je zato ≈°to **podrazumevano postoji limit od 10 dokumenata**.\
Ali, sada kada znate da **ovaj indeks sadr≈æi 1000 dokumenata**, mo≈æete **izbaciti sve njih** tako ≈°to ƒáete naznaƒçiti broj unosa koje ≈æelite da izbacite u **`size`** parametru: `http://10.10.10.115:9200/quotes/_search?pretty=true&size=1000`asd\
&#xNAN;_&#x4E;ote: Ako naznaƒçite veƒái broj, svi unosi ƒáe biti izbaƒçeni u svakom sluƒçaju, na primer, mogli biste naznaƒçiti `size=9999` i biƒáe ƒçudno ako ima vi≈°e unosa (ali trebate proveriti)._

### Dump all

Da biste izbacili sve, mo≈æete jednostavno otiƒái na **istu putanju kao pre, ali bez naznaƒçavanja bilo kog indeksa** `http://host:9200/_search?pretty=true` kao `http://10.10.10.115:9200/_search?pretty=true`\
Zapamtite da ƒáe u ovom sluƒçaju biti primenjen **podrazumevani limit od 10** rezultata. Mo≈æete koristiti `size` parametar da izbacite **veƒái broj rezultata**. Proƒçitajte prethodni odeljak za vi≈°e informacija.

### Search

Ako tra≈æite neke informacije, mo≈æete uraditi **sirovu pretragu po svim indeksima** odlaskom na `http://host:9200/_search?pretty=true&q=<search_term>` kao u `http://10.10.10.115:9200/_search?pretty=true&q=Rockwell`

![](<../.gitbook/assets/image (335).png>)

Ako ≈æelite samo da **pretra≈æujete unutar indeksa**, mo≈æete jednostavno **naznaƒçiti** ga u **putanji**: `http://host:9200/<index>/_search?pretty=true&q=<search_term>`

_Napomena da q parametar koji se koristi za pretragu sadr≈æaja **podr≈æava regularne izraze**_

Takoƒëe mo≈æete koristiti ne≈°to poput [https://github.com/misalabs/horuz](https://github.com/misalabs/horuz) za fuzzing elasticsearch servisa.

### Write permissions

Mo≈æete proveriti svoja prava pisanja poku≈°avajuƒái da kreirate novi dokument unutar novog indeksa pokretanjem neƒçega poput sledeƒáeg:
```bash
curl -X POST '10.10.10.115:9200/bookindex/books' -H 'Content-Type: application/json' -d'
{
"bookId" : "A00-3",
"author" : "Sankaran",
"publisher" : "Mcgrahill",
"name" : "how to get a job"
}'
```
That cmd will create a **new index** called `bookindex` with a document of type `books` that has the attributes "_bookId_", "_author_", "_publisher_" and "_name_"

Notice how the **new index appears now in the list**:

![](<../.gitbook/assets/image (130).png>)

And note the **automatically created properties**:

![](<../.gitbook/assets/image (434).png>)

## Automatska Enumeracija

Neki alati ƒáe dobiti neke od podataka predstavljenih ranije:
```bash
msf > use auxiliary/scanner/elasticsearch/indices_enum
```
{% embed url="https://github.com/theMiddleBlue/nmap-elasticsearch-nse" %}

## Shodan

* `port:9200 elasticsearch`

<figure><img src="../.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>

**Dobijte perspektivu hakera o va≈°im veb aplikacijama, mre≈æi i oblaku**

**Pronaƒëite i prijavite kritiƒçne, iskoristive ranjivosti sa stvarnim poslovnim uticajem.** Koristite na≈°ih 20+ prilagoƒëenih alata za mapiranje napadaƒçke povr≈°ine, pronala≈æenje bezbednosnih problema koji vam omoguƒáavaju da eskalirate privilegije, i koristite automatizovane eksploate za prikupljanje su≈°tinskih dokaza, pretvarajuƒái va≈° trud u uverljive izve≈°taje.

{% embed url="https://pentest-tools.com/?utm_term=jul2024&utm_medium=link&utm_source=hacktricks&utm_campaign=spons" %}

{% hint style="success" %}
Uƒçite i ve≈æbajte AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Uƒçite i ve≈æbajte GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
