# 5353/UDP マルチキャスト DNS (mDNS) と DNS-SD

{% hint style="success" %}
AWS ハッキングを学び、実践する:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP ハッキングを学び、実践する: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください!
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **ハッキングのトリックを共有するには、[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを送信してください。**

</details>
{% endhint %}

## **基本情報**

**マルチキャスト DNS (mDNS)** は、従来の DNS サーバーを必要とせずにローカルネットワーク内で **DNS のような操作** を可能にします。これは **UDP ポート 5353** で動作し、デバイスが互いにおよびそのサービスを発見することを可能にし、さまざまな IoT デバイスで一般的に見られます。**DNS サービス発見 (DNS-SD)** は、mDNS とともに使用されることが多く、標準の DNS クエリを通じてネットワーク上で利用可能なサービスを特定するのに役立ちます。
```
PORT     STATE SERVICE
5353/udp open  zeroconf
```
### **mDNSの動作**

標準DNSサーバーがない環境では、mDNSはデバイスが**.local**で終わるドメイン名を解決することを可能にし、マルチキャストアドレス**224.0.0.251**（IPv4）または**FF02::FB**（IPv6）にクエリを送信します。mDNSの重要な側面には、レコードの有効性を示す**生存時間（TTL）**値や、ユニキャストとマルチキャストクエリを区別する**QUビット**が含まれます。セキュリティの観点から、mDNSの実装はパケットの送信元アドレスがローカルサブネットと一致することを確認することが重要です。

### **DNS-SDの機能**

DNS-SDは、サービスタイプをそのインスタンスにマッピングするポインタレコード（PTR）をクエリすることによってネットワークサービスの発見を促進します。サービスは、**_\<Service>.\_tcpまたは\_\<Service>.\_udp**パターンを使用して**.local**ドメイン内で識別され、対応する**SRV**および**TXTレコード**が発見され、詳細なサービス情報が提供されます。

### **ネットワーク探索**

#### **nmapの使用**

mDNSサービスのためにローカルネットワークをスキャンするための便利なコマンドは：
```bash
nmap -Pn -sUC -p5353 [target IP address]
```
このコマンドは、オープンなmDNSポートとそれらを通じて広告されているサービスを特定するのに役立ちます。

#### **Pholusを使用したネットワーク列挙**

mDNSリクエストを積極的に送信し、トラフィックをキャプチャするために、**Pholus**ツールを次のように利用できます：
```bash
sudo python3 pholus3.py [network interface] -rq -stimeout 10
```
## 攻撃

### **mDNSプロービングの悪用**

攻撃ベクトルは、mDNSプローブに対して偽の応答を送信し、すべての潜在的な名前がすでに使用中であることを示唆することで、新しいデバイスがユニークな名前を選択するのを妨げることを含みます。これは、次のように実行できます:
```bash
sudo python pholus.py [network interface] -afre -stimeout 1000
```
この技術は、新しいデバイスがネットワーク上でサービスを登録するのを効果的にブロックします。

**要約すると**、mDNSとDNS-SDの仕組みを理解することは、ネットワーク管理とセキュリティにとって重要です。**nmap**や**Pholus**のようなツールは、ローカルネットワークサービスに関する貴重な洞察を提供し、潜在的な脆弱性を認識することで攻撃からの保護に役立ちます。

### スプーフィング/ MitM

このサービスで実行できる最も興味深い攻撃は、**クライアントと実際のサーバー間の通信でMitMを実行する**ことです。あなたは、機密ファイル（プリンターとの通信をMitM）や資格情報（Windows認証）を取得できるかもしれません。\
詳細については、以下を確認してください：

{% content-ref url="../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

## 参考文献

* [Practical IoT Hacking: The Definitive Guide to Attacking the Internet of Things](https://books.google.co.uk/books/about/Practical\_IoT\_Hacking.html?id=GbYEEAAAQBAJ\&redir\_esc=y)

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **ハッキングのトリックを共有するには、[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>
{% endhint %}
