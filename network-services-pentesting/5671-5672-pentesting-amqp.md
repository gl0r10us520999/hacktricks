# 5671,5672 - Pentesting AMQP

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## 基本情報

[cloudamqp](https://www.cloudamqp.com/blog/2015-05-18-part1-rabbitmq-for-beginners-what-is-rabbitmq.html)から:

> **RabbitMQ**は、_メッセージブローカー_または_キュー管理者_としても知られる**メッセージキューイングソフトウェア**です。簡単に言えば、メッセージを転送するためにアプリケーションが接続するキューが定義されたソフトウェアです。\
> **メッセージにはあらゆる種類の情報を含めることができます**。例えば、別のアプリケーション（別のサーバー上にある可能性もある）で開始すべきプロセスやタスクに関する情報を含むことができますし、単純なテキストメッセージである場合もあります。キュー管理ソフトウェアは、受信アプリケーションが接続してキューからメッセージを取得するまでメッセージを保存します。受信アプリケーションはその後、メッセージを処理します。\
定義元。

**デフォルトポート**: 5672,5671
```
PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
```
## 列挙

### 手動
```python
import amqp
#By default it uses default credentials "guest":"guest"
conn = amqp.connection.Connection(host="<IP>", port=5672, virtual_host="/")
conn.connect()
for k, v in conn.server_properties.items():
print(k, v)
```
### 自動
```bash
nmap -sV -Pn -n -T4 -p 5672 --script amqp-info <IP>

PORT     STATE SERVICE VERSION
5672/tcp open  amqp    RabbitMQ 3.1.5 (0-9)
| amqp-info:
|   capabilities:
|     publisher_confirms: YES
|     exchange_exchange_bindings: YES
|     basic.nack: YES
|     consumer_cancel_notify: YES
|   copyright: Copyright (C) 2007-2013 GoPivotal, Inc.
|   information: Licensed under the MPL.  See http://www.rabbitmq.com/
|   platform: Erlang/OTP
|   product: RabbitMQ
|   version: 3.1.5
|   mechanisms: PLAIN AMQPLAIN
|_  locales: en_US
```
### ブルートフォース

* [**AMQPプロトコルブルートフォース**](../generic-methodologies-and-resources/brute-force.md#amqp-activemq-rabbitmq-qpid-joram-and-solace)
* [**STOMPプロトコルブルートフォース**](../generic-methodologies-and-resources/brute-force.md#stomp-activemq-rabbitmq-hornetq-and-openmq)

## その他のRabbitMQポート

[https://www.rabbitmq.com/networking.html](https://www.rabbitmq.com/networking.html) では、**RabbitMQがいくつかのポートを使用している**ことがわかります：

* **1883, 8883**: （TLSなしおよびTLSありの[MQTTクライアント](http://mqtt.org)、[**ここでMQTTのペンテストについて詳しく学ぶ**](1883-pentesting-mqtt-mosquitto.md)）。
* **4369: epmd**、RabbitMQノードとCLIツールによって使用されるピア発見サービス。[**このサービスのペンテストについて詳しく学ぶ**](4369-pentesting-erlang-port-mapper-daemon-epmd.md)。
* **5672, 5671**: TLSなしおよびTLSありのAMQP 0-9-1および1.0クライアントによって使用される
* **15672**: [HTTP API](https://www.rabbitmq.com/management.html)クライアント、[管理UI](https://www.rabbitmq.com/management.html)および[rabbitmqadmin](https://www.rabbitmq.com/management-cli.html)（[管理プラグイン](https://www.rabbitmq.com/management.html)が有効な場合のみ）。[**このサービスのペンテストについて詳しく学ぶ**](15672-pentesting-rabbitmq-management.md)。
* 15674: STOMP-over-WebSocketsクライアント（[Web STOMPプラグイン](https://www.rabbitmq.com/web-stomp.html)が有効な場合のみ）
* 15675: MQTT-over-WebSocketsクライアント（[Web MQTTプラグイン](https://www.rabbitmq.com/web-mqtt.html)が有効な場合のみ）
* 15692: Prometheusメトリクス（[Prometheusプラグイン](https://www.rabbitmq.com/prometheus.html)が有効な場合のみ）
* 25672: ノード間およびCLIツールの通信に使用される（Erlang分散サーバーポート）で、動的範囲から割り当てられます（デフォルトでは単一ポートに制限され、AMQPポート + 20000として計算されます）。これらのポートで外部接続が本当に必要でない限り（例：クラスターが[フェデレーション](https://www.rabbitmq.com/federation.html)を使用している場合や、CLIツールがサブネット外のマシンで使用されている場合）、これらのポートは公開されるべきではありません。詳細については[ネットワーキングガイド](https://www.rabbitmq.com/networking.html)を参照してください。**これらのポートのうち、インターネット上で開いているのは9つだけです**。
* 35672-35682: ノードとの通信のためにCLIツールによって使用される（Erlang分散クライアントポート）で、動的範囲から割り当てられます（サーバー分散ポート + 10000からサーバー分散ポート + 10010として計算されます）。詳細については[ネットワーキングガイド](https://www.rabbitmq.com/networking.html)を参照してください。
* 61613, 61614: TLSなしおよびTLSありの[STOMPクライアント](https://stomp.github.io/stomp-specification-1.2.html)（[STOMPプラグイン](https://www.rabbitmq.com/stomp.html)が有効な場合のみ）。このポートが開いているデバイスは10未満で、主にDHTノード用のUDPです。

## Shodan

* `AMQP`

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してハッキングトリックを共有してください。**

</details>
{% endhint %}
