# Memcache-Befehle

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Befehle Cheat-Sheet

**Von** [**https://lzone.de/cheat-sheet/memcached**](https://lzone.de/cheat-sheet/memcached)

Die unterst√ºtzten Befehle (die offiziellen und einige inoffizielle) sind im [doc/protocol.txt](https://github.com/memcached/memcached/blob/master/doc/protocol.txt) Dokument dokumentiert.

Leider ist die Syntaxbeschreibung nicht wirklich klar und ein einfacher Hilfe-Befehl, der die vorhandenen Befehle auflistet, w√§re viel besser. Hier ist eine √úbersicht der Befehle, die du im [Quellcode](https://github.com/memcached/memcached) finden kannst (Stand 19.08.2016):

| Befehl                | Beschreibung                                                  | Beispiel                                                                                                                                                                                                                                     |
| --------------------- | ------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| get                   | Liest einen Wert                                             | `get mykey`                                                                                                                                                                                                                                 |
| set                   | Setzt einen Schl√ºssel bedingungslos                         | <p><code>set mykey &#x3C;flags> &#x3C;ttl> &#x3C;size></code><br><br>&#x3C;p>Stelle sicher, dass du \r\n als Zeilenumbr√ºche verwendest, wenn du Unix-CLI-Tools verwendest. Zum Beispiel&#x3C;/p> <code>printf "set mykey 0 60 4\r\ndata\r\n" | nc localhost 11211</code></p> |
| add                   | F√ºgt einen neuen Schl√ºssel hinzu                             | `add newkey 0 60 5`                                                                                                                                                                                                                         |
| replace               | √úberschreibt einen vorhandenen Schl√ºssel                     | `replace key 0 60 5`                                                                                                                                                                                                                        |
| append                | F√ºgt Daten zu einem vorhandenen Schl√ºssel hinzu              | `append key 0 60 15`                                                                                                                                                                                                                        |
| prepend               | F√ºgt Daten vor einem vorhandenen Schl√ºssel hinzu             | `prepend key 0 60 15`                                                                                                                                                                                                                       |
| incr                  | Erh√∂ht den numerischen Schl√ºsselwert um eine gegebene Zahl   | `incr mykey 2`                                                                                                                                                                                                                              |
| decr                  | Verringert den numerischen Schl√ºsselwert um eine gegebene Zahl| `decr mykey 5`                                                                                                                                                                                                                              |
| delete                | L√∂scht einen vorhandenen Schl√ºssel                            | `delete mykey`                                                                                                                                                                                                                              |
| flush\_all            | Ung√ºltig machen aller Elemente sofort                        | `flush_all`                                                                                                                                                                                                                                 |
| flush\_all            | Ung√ºltig machen aller Elemente in n Sekunden                 | `flush_all 900`                                                                                                                                                                                                                             |
| stats                 | Gibt allgemeine Statistiken aus                              | `stats`                                                                                                                                                                                                                                     |
|                       | Gibt Speichermetriken aus                                    | `stats slabs`                                                                                                                                                                                                                               |
|                       | Gibt Statistiken zur h√∂heren Ebene der Zuweisung aus         | `stats malloc`                                                                                                                                                                                                                              |
|                       | Gibt Informationen zu den Elementen aus                      | `stats items`                                                                                                                                                                                                                               |
|                       |                                                             | `stats detail`                                                                                                                                                                                                                              |
|                       |                                                             | `stats sizes`                                                                                                                                                                                                                               |
|                       | Setzt die Statistikz√§hler zur√ºck                             | `stats reset`                                                                                                                                                                                                                               |
| lru\_crawler metadump | Gibt (die meisten) Metadaten f√ºr (alle) Elemente im Cache aus| `lru_crawler metadump all`                                                                                                                                                                                                                  |
| version               | Gibt die Serverversion aus                                   | `version`                                                                                                                                                                                                                                   |
| verbosity             | Erh√∂ht das Protokollniveau                                   | `verbosity`                                                                                                                                                                                                                                 |
| quit                  | Beendet die Sitzung                                          | `quit`                                                                                                                                                                                                                                      |

#### Verkehrsstatisiken <a href="#traffic-statistics" id="traffic-statistics"></a>

Du kannst die aktuellen Verkehrsstatisiken mit dem Befehl abfragen
```
stats
```
Sie erhalten eine Auflistung, die die Anzahl der Verbindungen, Bytes ein/aus und vieles mehr anzeigt.

Beispielausgabe:
```
STAT pid 14868
STAT uptime 175931
STAT time 1220540125
STAT version 1.2.2
STAT pointer_size 32
STAT rusage_user 620.299700
STAT rusage_system 1545.703017
STAT curr_items 228
STAT total_items 779
STAT bytes 15525
STAT curr_connections 92
STAT total_connections 1740
STAT connection_structures 165
STAT cmd_get 7411
STAT cmd_set 28445156
STAT get_hits 5183
STAT get_misses 2228
STAT evictions 0
STAT bytes_read 2112768087
STAT bytes_written 1000038245
STAT limit_maxbytes 52428800
STAT threads 1
END
```
#### Speicherstatistiken <a href="#memory-statistics" id="memory-statistics"></a>

Sie k√∂nnen die aktuellen Speicherstatistiken abfragen, indem Sie
```
stats slabs
```
```markdown
# Memcache-Befehle

## Grundlegende Befehle

- `set`: Setzt einen Wert in den Cache.
- `get`: Ruft einen Wert aus dem Cache ab.
- `delete`: L√∂scht einen Wert aus dem Cache.
- `flush_all`: L√∂scht alle Werte im Cache.

## Erweiterte Befehle

- `incr`: Erh√∂ht den Wert eines Schl√ºssels um einen bestimmten Betrag.
- `decr`: Verringert den Wert eines Schl√ºssels um einen bestimmten Betrag.
- `stats`: Gibt Statistiken √ºber den Memcache-Server zur√ºck.
- `version`: Gibt die Version des Memcache-Servers zur√ºck.

## Beispiel

```bash
set mykey 0 900 9
123456789
```
```
```
STAT 1:chunk_size 80
STAT 1:chunks_per_page 13107
STAT 1:total_pages 1
STAT 1:total_chunks 13107
STAT 1:used_chunks 13106
STAT 1:free_chunks 1
STAT 1:free_chunks_end 12886
STAT 2:chunk_size 100
STAT 2:chunks_per_page 10485
STAT 2:total_pages 1
STAT 2:total_chunks 10485
STAT 2:used_chunks 10484
STAT 2:free_chunks 1
STAT 2:free_chunks_end 10477
[...]
STAT active_slabs 3
STAT total_malloced 3145436
END
```
Wenn Sie sich nicht sicher sind, ob Sie gen√ºgend Speicher f√ºr Ihre memcached-Instanz haben, achten Sie immer auf die ‚Äûevictions‚Äú-Z√§hler, die durch den Befehl ‚Äûstats‚Äú angegeben werden. Wenn Sie gen√ºgend Speicher f√ºr die Instanz haben, sollte der ‚Äûevictions‚Äú-Z√§hler 0 oder zumindest nicht steigend sein.

#### Welche Schl√ºssel werden verwendet? <a href="#which-keys-are-used" id="which-keys-are-used"></a>

Es gibt keine integrierte Funktion, um direkt die aktuelle Menge an Schl√ºsseln zu bestimmen. Sie k√∂nnen jedoch den
```
stats items
```
Befehl, um zu bestimmen, wie viele Schl√ºssel existieren.
```
stats items
STAT items:1:number 220
STAT items:1:age 83095
STAT items:2:number 7
STAT items:2:age 1405
[...]
END
```
Dies hilft zumindest zu sehen, ob Schl√ºssel verwendet werden. Um die Schl√ºsselnamen aus einem PHP-Skript, das bereits auf den Memcache zugreift, zu dumpen, k√∂nnen Sie den PHP-Code von [100days.de](http://100days.de/serendipity/archives/55-Dumping-MemcacheD-Content-Keys-with-PHP.html) verwenden.


<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
