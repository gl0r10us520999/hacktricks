# rpcclient enumeration

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Vertiefen Sie Ihr Fachwissen in **Mobilsicherheit** mit der 8kSec Academy. Meistern Sie die Sicherheit von iOS und Android durch unsere selbstgesteuerten Kurse und erhalten Sie ein Zertifikat:

{% embed url="https://academy.8ksec.io/" %}

### √úbersicht √ºber Relative Identifiers (RID) und Security Identifiers (SID)

**Relative Identifiers (RID)** und **Security Identifiers (SID)** sind Schl√ºsselkomponenten in Windows-Betriebssystemen zur eindeutigen Identifizierung und Verwaltung von Objekten, wie Benutzern und Gruppen, innerhalb einer Netzwerkdom√§ne.

- **SIDs** dienen als eindeutige Identifikatoren f√ºr Dom√§nen und stellen sicher, dass jede Dom√§ne unterscheidbar ist.
- **RIDs** werden an SIDs angeh√§ngt, um eindeutige Identifikatoren f√ºr Objekte innerhalb dieser Dom√§nen zu erstellen. Diese Kombination erm√∂glicht eine pr√§zise Verfolgung und Verwaltung von Objektberechtigungen und Zugriffskontrollen.

Ein Benutzer namens `pepe` k√∂nnte beispielsweise einen eindeutigen Identifikator haben, der die SID der Dom√§ne mit seiner spezifischen RID kombiniert, dargestellt in hexadezimaler (`0x457`) und dezimaler (`1111`) Form. Dies ergibt einen vollst√§ndigen und eindeutigen Identifikator f√ºr pepe innerhalb der Dom√§ne wie: `S-1-5-21-1074507654-1937615267-42093643874-1111`.


### **Enumeration mit rpcclient**

Das **`rpcclient`**-Dienstprogramm von Samba wird verwendet, um mit **RPC-Endpunkten √ºber benannte Pipes** zu interagieren. Nach der **Herstellung einer SMB-Sitzung**, die oft Anmeldeinformationen erfordert, k√∂nnen die folgenden Befehle an die SAMR-, LSARPC- und LSARPC-DS-Schnittstellen ausgegeben werden.

#### Serverinformationen

* Um **Serverinformationen** zu erhalten: wird der Befehl `srvinfo` verwendet.

#### Auflistung von Benutzern

* **Benutzer k√∂nnen aufgelistet werden** mit: `querydispinfo` und `enumdomusers`.
* **Details eines Benutzers** mit: `queryuser <0xrid>`.
* **Gruppen eines Benutzers** mit: `queryusergroups <0xrid>`.
* **Die SID eines Benutzers wird abgerufen** mit: `lookupnames <username>`.
* **Aliase von Benutzern** mit: `queryuseraliases [builtin|domain] <sid>`.
```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```
#### Aufz√§hlung von Gruppen

* **Gruppen** mit: `enumdomgroups`.
* **Details einer Gruppe** mit: `querygroup <0xrid>`.
* **Mitglieder einer Gruppe** durch: `querygroupmem <0xrid>`.

#### Aufz√§hlung von Aliasgruppen

* **Aliasgruppen** mit: `enumalsgroups <builtin|domain>`.
* **Mitglieder einer Aliasgruppe** mit: `queryaliasmem builtin|domain <0xrid>`.

#### Aufz√§hlung von Dom√§nen

* **Dom√§nen** mit: `enumdomains`.
* **Die SID einer Dom√§ne wird abgerufen** durch: `lsaquery`.
* **Dom√§neninformationen werden erhalten** durch: `querydominfo`.

#### Aufz√§hlung von Freigaben

* **Alle verf√ºgbaren Freigaben** mit: `netshareenumall`.
* **Informationen √ºber eine spezifische Freigabe werden abgerufen** mit: `netsharegetinfo <share>`.

#### Zus√§tzliche Operationen mit SIDs

* **SIDs nach Namen** mit: `lookupnames <username>`.
* **Weitere SIDs** durch: `lsaenumsid`.
* **RID-Zyklus zur √úberpr√ºfung weiterer SIDs** wird durchgef√ºhrt mit: `lookupsids <sid>`.

#### **Zus√§tzliche Befehle**

| **Befehl**          | **Schnittstelle**                                                                                                                                     | **Beschreibung**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                              | Benutzerinformationen abrufen                                                                                                            |
| querygroup          | Gruppeninformationen abrufen                                                                                                                      |                                                                                                                                           |
| querydominfo        | Dom√§neninformationen abrufen                                                                                                                     |                                                                                                                                           |
| enumdomusers        | Dom√§nenbenutzer auflisten                                                                                                                         |                                                                                                                                           |
| enumdomgroups       | Dom√§nengruppen auflisten                                                                                                                          |                                                                                                                                           |
| createdomuser       | Einen Dom√§nenbenutzer erstellen                                                                                                                   |                                                                                                                                           |
| deletedomuser       | Einen Dom√§nenbenutzer l√∂schen                                                                                                                     |                                                                                                                                           |
| lookupnames         | LSARPC                                                                                                                                            | Benutzernamen in SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) Werte umschauen |
| lookupsids          | SIDs in Benutzernamen umschauen (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) Zyklus) |                                                                                                                                           |
| lsaaddacctrights    | Rechte zu einem Benutzerkonto hinzuf√ºgen                                                                                                           |                                                                                                                                           |
| lsaremoveacctrights | Rechte von einem Benutzerkonto entfernen                                                                                                           |                                                                                                                                           |
| dsroledominfo       | LSARPC-DS                                                                                                                                         | Prim√§re Dom√§neninformationen abrufen                                                                                                     |
| dsenumdomtrusts     | Vertrauensw√ºrdige Dom√§nen innerhalb eines AD-Waldes auflisten                                                                                     |                                                                                                                                           |

Um **besser zu verstehen**, wie die Tools _**samrdump**_ **und** _**rpcdump**_ funktionieren, sollten Sie [**Pentesting MSRPC**](../135-pentesting-msrpc.md) lesen.


<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Vertiefen Sie Ihr Fachwissen in **Mobiler Sicherheit** mit der 8kSec Academy. Meistern Sie die Sicherheit von iOS und Android durch unsere selbstgesteuerten Kurse und erhalten Sie ein Zertifikat:

{% embed url="https://academy.8ksec.io/" %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
