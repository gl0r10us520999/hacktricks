# macOS XPC ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ö‡•á‡§ï

{% hint style="success" %}
‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡§∞‡•á‡§Ç AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡§∞‡•á‡§Ç GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å**](https://github.com/sponsors/carlospolop) ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç!
* **‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç** üí¨ [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Ø‡§æ **‡§π‡§Æ‡•á‡§Ç** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ‡§™‡§∞ ‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç‡•§**
* ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ‡§ó‡§ø‡§ü‡§π‡§¨ ‡§∞‡§ø‡§™‡•ã‡§ú‡§ø‡§ü‡§∞‡•Ä ‡§Æ‡•á‡§Ç PR ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§

</details>
{% endhint %}

## XPC ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ö‡•á‡§ï

‡§ú‡§¨ ‡§è‡§ï XPC ‡§∏‡•á‡§µ‡§æ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§Ø‡§π ‡§ú‡§æ‡§Ç‡§ö‡•á‡§ó‡§æ ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§π‡•à‡•§ ‡§Ø‡•á ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§‡§É ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§π‡•à‡§Ç:

1. ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó **‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§è‡§ï Apple-‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§è ‡§ó‡§è** ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à (‡§ú‡•ã ‡§ï‡•á‡§µ‡§≤ Apple ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à)‡•§
* ‡§Ø‡§¶‡§ø ‡§Ø‡§π **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**, ‡§§‡•ã ‡§è‡§ï ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§è‡§ï **‡§®‡§ï‡§≤‡•Ä ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞** ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§
2. ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ **‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞** ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à (‡§ü‡•Ä‡§Æ ‡§Ü‡§à‡§°‡•Ä ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§®)‡•§
* ‡§Ø‡§¶‡§ø ‡§Ø‡§π **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**, ‡§§‡•ã Apple ‡§∏‡•á **‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§°‡•á‡§µ‡§≤‡§™‡§∞ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞** ‡§∏‡§æ‡§á‡§®‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§î‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
3. ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ **‡§è‡§ï ‡§â‡§ö‡§ø‡§§ ‡§¨‡§Ç‡§°‡§≤ ‡§Ü‡§à‡§°‡•Ä** ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à‡•§
* ‡§Ø‡§¶‡§ø ‡§Ø‡§π **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**, ‡§§‡•ã **‡§â‡§∏‡•Ä ‡§∏‡§Ç‡§ó‡§†‡§® ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§è ‡§ó‡§è** ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ü‡•Ç‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó XPC ‡§∏‡•á‡§µ‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
4. (4 ‡§Ø‡§æ 5) ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Ç **‡§è‡§ï ‡§â‡§ö‡§ø‡§§ ‡§∏‡•â‡§´‡§º‡•ç‡§ü‡§µ‡•á‡§Ø‡§∞ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ** ‡§π‡•à‡•§
* ‡§Ø‡§¶‡§ø ‡§Ø‡§π **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**, ‡§§‡•ã ‡§è‡§ï ‡§™‡•Å‡§∞‡§æ‡§®‡§æ, ‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü, ‡§ú‡•ã ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•à, XPC ‡§∏‡•á‡§µ‡§æ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§≠‡§≤‡•á ‡§π‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•ã‡§Ç‡•§
5. (4 ‡§Ø‡§æ 5) ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§ñ‡§§‡§∞‡§®‡§æ‡§ï ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ **‡§è‡§ï ‡§π‡§æ‡§∞‡•ç‡§°‡§®‡§° ‡§∞‡§®‡§ü‡§æ‡§á‡§Æ** ‡§π‡•à (‡§ú‡•à‡§∏‡•á ‡§ï‡§ø ‡§µ‡•á ‡§ú‡•ã ‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Ø‡§æ DYLD env vars ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç)‡•§
* ‡§Ø‡§¶‡§ø ‡§Ø‡§π **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à**, ‡§§‡•ã ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü **‡§ï‡•ã‡§° ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤** ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
6. ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§è‡§ï **‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞** ‡§π‡•à ‡§ú‡•ã ‡§á‡§∏‡•á ‡§∏‡•á‡§µ‡§æ ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π Apple ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•à‡•§
7. **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§®** ‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó **‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§ï‡•á ‡§ë‡§°‡§ø‡§ü ‡§ü‡•ã‡§ï‡§®** ‡§™‡§∞ **‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§** ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è **‡§á‡§∏‡§ï‡•á ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§Ü‡§à‡§°‡•Ä** (**PID**) ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡•Ç‡§∞‡•ç‡§µ **PID ‡§™‡•Å‡§®: ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡§Æ‡§≤‡•ã‡§Ç** ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§§‡§æ ‡§π‡•à‡•§
* ‡§°‡•á‡§µ‡§≤‡§™‡§∞‡•ç‡§∏ **‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä ‡§ë‡§°‡§ø‡§ü ‡§ü‡•ã‡§ï‡§®** API ‡§ï‡•â‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π **‡§®‡§ø‡§ú‡•Ä** ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è Apple ‡§á‡§∏‡•á **‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡§Æ‡§Ø ‡§¨‡§¶‡§≤** ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§ï‡•á ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§, ‡§®‡§ø‡§ú‡•Ä API ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó Mac App Store ‡§ê‡§™‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§
* ‡§Ø‡§¶‡§ø ‡§µ‡§ø‡§ß‡§ø **`processIdentifier`** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ø‡§π ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
* **`xpc_dictionary_get_audit_token`** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó **`xpc_connection_get_audit_token`** ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§¨‡§æ‡§¶ ‡§µ‡§æ‡§≤‡§æ ‡§≠‡•Ä [‡§ï‡•Å‡§õ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à](https://sector7.computest.nl/post/2023-10-xpc-audit-token-spoofing/)‡•§

### ‡§∏‡§Ç‡§ö‡§æ‡§∞ ‡§π‡§Æ‡§≤‡•á

PID ‡§™‡•Å‡§®: ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡§Æ‡§≤‡•á ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç:

{% content-ref url="macos-pid-reuse.md" %}
[macos-pid-reuse.md](macos-pid-reuse.md)
{% endcontent-ref %}

‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è **`xpc_connection_get_audit_token`** ‡§π‡§Æ‡§≤‡•á ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç:

{% content-ref url="macos-xpc_connection_get_audit_token-attack.md" %}
[macos-xpc\_connection\_get\_audit\_token-attack.md](macos-xpc\_connection\_get\_audit\_token-attack.md)
{% endcontent-ref %}

### Trustcache - ‡§°‡§æ‡§â‡§®‡§ó‡•ç‡§∞‡•á‡§° ‡§π‡§Æ‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ

Trustcache ‡§è‡§ï ‡§∞‡§ï‡•ç‡§∑‡§æ‡§§‡•ç‡§Æ‡§ï ‡§µ‡§ø‡§ß‡§ø ‡§π‡•à ‡§ú‡•ã Apple Silicon ‡§Æ‡§∂‡•Ä‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∂ ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à ‡§ú‡•ã Apple ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•á CDHSAH ‡§ï‡§æ ‡§è‡§ï ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§ï‡•á‡§µ‡§≤ ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§ó‡•à‡§∞-‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§¨‡§æ‡§á‡§®‡§∞‡•Ä ‡§ï‡•ã ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§ ‡§ú‡•ã ‡§°‡§æ‡§â‡§®‡§ó‡•ç‡§∞‡•á‡§° ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§ï‡•á ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§§‡§æ ‡§π‡•à‡•§

### ‡§ï‡•ã‡§° ‡§â‡§¶‡§æ‡§π‡§∞‡§£

‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§á‡§∏ **‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§®** ‡§ï‡•ã **`shouldAcceptNewConnection`** ‡§®‡§æ‡§Æ‡§ï ‡§è‡§ï ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

{% code overflow="wrap" %}
```objectivec
- (BOOL)listener:(NSXPCListener *)listener shouldAcceptNewConnection:(NSXPCConnection *)newConnection {
//Check connection
return YES;
}
```
{% endcode %}

‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü NSXPCConnection ‡§Æ‡•á‡§Ç ‡§è‡§ï **‡§®‡§ø‡§ú‡•Ä** ‡§™‡•ç‡§∞‡•â‡§™‡§∞‡•ç‡§ü‡•Ä **`auditToken`** ‡§π‡•à (‡§ú‡•ã ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è ‡§≤‡•á‡§ï‡§ø‡§® ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à) ‡§î‡§∞ ‡§è‡§ï **‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï** ‡§™‡•ç‡§∞‡•â‡§™‡§∞‡•ç‡§ü‡•Ä **`processIdentifier`** ‡§π‡•à (‡§ú‡•ã ‡§â‡§™‡§Ø‡•ã‡§ó ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è)‡•§

‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§ï‡•Å‡§õ ‡§á‡§∏ ‡§§‡§∞‡§π ‡§∏‡•á ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à:

{% code overflow="wrap" %}
```objectivec
[...]
SecRequirementRef requirementRef = NULL;
NSString requirementString = @"anchor apple generic and identifier \"xyz.hacktricks.service\" and certificate leaf [subject.CN] = \"TEAMID\" and info [CFBundleShortVersionString] >= \"1.0\"";
/* Check:
- Signed by a cert signed by Apple
- Check the bundle ID
- Check the TEAMID of the signing cert
- Check the version used
*/

// Check the requirements with the PID (vulnerable)
SecRequirementCreateWithString(requirementString, kSecCSDefaultFlags, &requirementRef);
SecCodeCheckValidity(code, kSecCSDefaultFlags, requirementRef);

// Check the requirements wuing the auditToken (secure)
SecTaskRef taskRef = SecTaskCreateWithAuditToken(NULL, ((ExtendedNSXPCConnection*)newConnection).auditToken);
SecTaskValidateForRequirement(taskRef, (__bridge CFStringRef)(requirementString))
```
{% endcode %}

‡§Ø‡§¶‡§ø ‡§è‡§ï ‡§°‡•á‡§µ‡§≤‡§™‡§∞ ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§ï‡•á ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§µ‡§π ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§Ø‡§π ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§á‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à:

{% code overflow="wrap" %}
```objectivec
[...]
CFDictionaryRef csInfo = NULL;
SecCodeCopySigningInformation(code, kSecCSDynamicInformation, &csInfo);
uint32_t csFlags = [((__bridge NSDictionary *)csInfo)[(__bridge NSString *)kSecCodeInfoStatus] intValue];
const uint32_t cs_hard = 0x100;        // don't load invalid page.
const uint32_t cs_kill = 0x200;        // Kill process if page is invalid
const uint32_t cs_restrict = 0x800;    // Prevent debugging
const uint32_t cs_require_lv = 0x2000; // Library Validation
const uint32_t cs_runtime = 0x10000;   // hardened runtime
if ((csFlags & (cs_hard | cs_require_lv)) {
return Yes; // Accept connection
}
```
{% endcode %}

{% hint style="success" %}
‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å**](https://github.com/sponsors/carlospolop) ‡§¶‡•á‡§ñ‡•á‡§Ç!
* **‡§π‡§Æ‡§æ‡§∞‡•á** üí¨ [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç ‡§Ø‡§æ **‡§π‡§Æ‡•á‡§Ç** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ‡§™‡§∞ ‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç‡•§**
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞** [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ‡§ó‡§ø‡§ü‡§π‡§¨ ‡§∞‡§ø‡§™‡•ã‡§ú‡§ø‡§ü‡§∞‡•Ä ‡§Æ‡•á‡§Ç PRs ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§

</details>
{% endhint %}
