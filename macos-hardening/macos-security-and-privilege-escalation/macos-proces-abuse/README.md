# macOS Process Abuse

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Processes Basic Information

ÌîÑÎ°úÏÑ∏Ïä§Îäî Ïã§Ìñâ Ï§ëÏù∏ Ïã§Ìñâ ÌååÏùºÏùò Ïù∏Ïä§ÌÑ¥Ïä§Ïù¥ÏßÄÎßå, ÌîÑÎ°úÏÑ∏Ïä§Îäî ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÏßÄ ÏïäÍ≥†, Ïù¥Îäî Ïä§Î†àÎìúÏûÖÎãàÎã§. Îî∞ÎùºÏÑú **ÌîÑÎ°úÏÑ∏Ïä§Îäî Ïã§Ìñâ Ï§ëÏù∏ Ïä§Î†àÎìúÎ•º ÏúÑÌïú Ïª®ÌÖåÏù¥ÎÑàÏùº ÎøêÏûÖÎãàÎã§**. Î©îÎ™®Î¶¨, ÏÑ§Î™ÖÏûê, Ìè¨Ìä∏, Í∂åÌïú Îì±ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§...

Ï†ÑÌÜµÏ†ÅÏúºÎ°ú, ÌîÑÎ°úÏÑ∏Ïä§Îäî **`fork`**Î•º Ìò∏Ï∂úÌïòÏó¨ Îã§Î•∏ ÌîÑÎ°úÏÑ∏Ïä§ ÎÇ¥ÏóêÏÑú ÏãúÏûëÎêòÏóàÏúºÎ©∞, Ïù¥Îäî ÌòÑÏû¨ ÌîÑÎ°úÏÑ∏Ïä§Ïùò Ï†ïÌôïÌïú Î≥µÏÇ¨Î≥∏ÏùÑ ÏÉùÏÑ±ÌïòÍ≥†, Í∑∏ ÌõÑ **ÏûêÏãù ÌîÑÎ°úÏÑ∏Ïä§**Îäî ÏùºÎ∞òÏ†ÅÏúºÎ°ú **`execve`**Î•º Ìò∏Ï∂úÌïòÏó¨ ÏÉàÎ°úÏö¥ Ïã§Ìñâ ÌååÏùºÏùÑ Î°úÎìúÌïòÍ≥† Ïã§ÌñâÌï©ÎãàÎã§. Í∑∏Îü∞ Îã§Ïùå, **`vfork`**Í∞Ä ÎèÑÏûÖÎêòÏñ¥ Î©îÎ™®Î¶¨ Î≥µÏÇ¨ ÏóÜÏù¥ Ïù¥ ÌîÑÎ°úÏÑ∏Ïä§Î•º Îçî Îπ†Î•¥Í≤å ÎßåÎì§ÏóàÏäµÎãàÎã§.\
Í∑∏ ÌõÑ **`posix_spawn`**Ïù¥ ÎèÑÏûÖÎêòÏñ¥ **`vfork`**ÏôÄ **`execve`**Î•º ÌïòÎÇòÏùò Ìò∏Ï∂úÎ°ú Í≤∞Ìï©ÌïòÍ≥† ÌîåÎûòÍ∑∏Î•º ÏàòÏö©ÌñàÏäµÎãàÎã§:

* `POSIX_SPAWN_RESETIDS`: Ïú†Ìö® IDÎ•º Ïã§Ï†ú IDÎ°ú Ïû¨ÏÑ§Ï†ï
* `POSIX_SPAWN_SETPGROUP`: ÌîÑÎ°úÏÑ∏Ïä§ Í∑∏Î£π ÏÜåÏÜç ÏÑ§Ï†ï
* `POSUX_SPAWN_SETSIGDEF`: Ïã†Ìò∏ Í∏∞Î≥∏ ÎèôÏûë ÏÑ§Ï†ï
* `POSIX_SPAWN_SETSIGMASK`: Ïã†Ìò∏ ÎßàÏä§ÌÅ¨ ÏÑ§Ï†ï
* `POSIX_SPAWN_SETEXEC`: ÎèôÏùºÌïú ÌîÑÎ°úÏÑ∏Ïä§ÏóêÏÑú exec (Îçî ÎßéÏùÄ ÏòµÏÖòÏù¥ ÏûàÎäî `execve`ÏôÄ Ïú†ÏÇ¨)
* `POSIX_SPAWN_START_SUSPENDED`: ÏãúÏûë Ïãú ÏùºÏãú Ï§ëÏßÄ
* `_POSIX_SPAWN_DISABLE_ASLR`: ASLR ÏóÜÏù¥ ÏãúÏûë
* `_POSIX_SPAWN_NANO_ALLOCATOR:` libmallocÏùò Nano Ìï†ÎãπÍ∏∞ ÏÇ¨Ïö©
* `_POSIX_SPAWN_ALLOW_DATA_EXEC:` Îç∞Ïù¥ÌÑ∞ ÏÑ∏Í∑∏Î®ºÌä∏ÏóêÏÑú `rwx` ÌóàÏö©
* `POSIX_SPAWN_CLOEXEC_DEFAULT`: exec(2)ÏóêÏÑú Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Î™®Îì† ÌååÏùº ÏÑ§Î™ÖÏûê Îã´Í∏∞
* `_POSIX_SPAWN_HIGH_BITS_ASLR:` ASLR Ïä¨ÎùºÏù¥ÎìúÏùò ÎÜíÏùÄ ÎπÑÌä∏ Î¨¥ÏûëÏúÑÌôî

Í≤åÎã§Í∞Ä, `posix_spawn`ÏùÄ ÏÉùÏÑ±Îêú ÌîÑÎ°úÏÑ∏Ïä§Ïùò ÏùºÎ∂Ä Ï∏°Î©¥ÏùÑ Ï†úÏñ¥ÌïòÎäî **`posix_spawnattr`** Î∞∞Ïó¥ÏùÑ ÏßÄÏ†ïÌï† Ïàò ÏûàÏúºÎ©∞, ÏÑ§Î™ÖÏûêÏùò ÏÉÅÌÉúÎ•º ÏàòÏ†ïÌïòÍ∏∞ ÏúÑÌï¥ **`posix_spawn_file_actions`**Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.

ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä Ï¢ÖÎ£åÎêòÎ©¥ **Î∂ÄÎ™® ÌîÑÎ°úÏÑ∏Ïä§Ïóê Î∞òÌôò ÏΩîÎìúÎ•º Ï†ÑÏÜ°**Ìï©ÎãàÎã§(Î∂ÄÎ™®Í∞Ä Ï¢ÖÎ£åÎêú Í≤ΩÏö∞ ÏÉàÎ°úÏö¥ Î∂ÄÎ™®Îäî PID 1)ÏôÄ Ìï®Íªò Ïã†Ìò∏ `SIGCHLD`Î•º Î≥¥ÎÉÖÎãàÎã§. Î∂ÄÎ™®Îäî `wait4()` ÎòêÎäî `waitid()`Î•º Ìò∏Ï∂úÌïòÏó¨ Ïù¥ Í∞íÏùÑ Í∞ÄÏ†∏ÏôÄÏïº ÌïòÎ©∞, Í∑∏ ÏùºÏù¥ Î∞úÏÉùÌï† ÎïåÍπåÏßÄ ÏûêÏãùÏùÄ Ï¢ÄÎπÑ ÏÉÅÌÉúÏóê Î®∏Î¨ºÎ©∞ Ïó¨Ï†ÑÌûà ÎÇòÏó¥ÎêòÏßÄÎßå ÏûêÏõêÏùÑ ÏÜåÎ™®ÌïòÏßÄ ÏïäÏäµÎãàÎã§.

### PIDs

PIDÎäî ÌîÑÎ°úÏÑ∏Ïä§ ÏãùÎ≥ÑÏûêÎ°ú, Í≥†Ïú†Ìïú ÌîÑÎ°úÏÑ∏Ïä§Î•º ÏãùÎ≥ÑÌï©ÎãàÎã§. XNUÏóêÏÑú **PID**Îäî **64ÎπÑÌä∏**Ïù¥Î©∞ Îã®Ï°∞Î°≠Í≤å Ï¶ùÍ∞ÄÌïòÍ≥† **Ï†àÎåÄ Îû©ÌïëÎêòÏßÄ ÏïäÏäµÎãàÎã§**(ÎÇ®Ïö© Î∞©ÏßÄÎ•º ÏúÑÌï¥).

### Process Groups, Sessions & Coalations

**ÌîÑÎ°úÏÑ∏Ïä§**Îäî **Í∑∏Î£π**Ïóê ÏÇΩÏûÖÎêòÏñ¥ Îçî ÏâΩÍ≤å Ï≤òÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§. ÏòàÎ•º Îì§Ïñ¥, ÏÖ∏ Ïä§ÌÅ¨Î¶ΩÌä∏Ïùò Î™ÖÎ†πÏùÄ ÎèôÏùºÌïú ÌîÑÎ°úÏÑ∏Ïä§ Í∑∏Î£πÏóê ÏûàÏùÑ Í≤ÉÏù¥ÎØÄÎ°ú, ÏòàÎ•º Îì§Ïñ¥ killÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ **Ìï®Íªò Ïã†Ìò∏Î•º Î≥¥ÎÇº Ïàò ÏûàÏäµÎãàÎã§**.\
ÎòêÌïú **ÏÑ∏ÏÖòÏóê ÌîÑÎ°úÏÑ∏Ïä§Î•º Í∑∏Î£πÌôîÌïòÎäî Í≤ÉÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§**. ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä ÏÑ∏ÏÖòÏùÑ ÏãúÏûëÌï† Îïå(`setsid(2)`), ÏûêÏãù ÌîÑÎ°úÏÑ∏Ïä§Îäî ÏÑ∏ÏÖò ÎÇ¥Ïóê ÏÑ§Ï†ïÎêòÎ©∞, ÏûêÏã†ÎßåÏùò ÏÑ∏ÏÖòÏùÑ ÏãúÏûëÌïòÏßÄ ÏïäÎäî Ìïú Í∑∏Î†áÏäµÎãàÎã§.

CoalitionÏùÄ DarwinÏóêÏÑú ÌîÑÎ°úÏÑ∏Ïä§Î•º Í∑∏Î£πÌôîÌïòÎäî Îòê Îã§Î•∏ Î∞©Î≤ïÏûÖÎãàÎã§. CoalitionÏóê Í∞ÄÏûÖÌïú ÌîÑÎ°úÏÑ∏Ïä§Îäî ÌíÄ Î¶¨ÏÜåÏä§Ïóê Ï†ëÍ∑ºÌï† Ïàò ÏûàÏúºÎ©∞, ÏõêÏû• Í≥µÏú† ÎòêÎäî JetsamÏóê ÏßÅÎ©¥Ìï† Ïàò ÏûàÏäµÎãàÎã§. CoalitionÏùÄ Îã§ÏñëÌïú Ïó≠Ìï†ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏäµÎãàÎã§: Î¶¨Îçî, XPC ÏÑúÎπÑÏä§, ÌôïÏû•.

### Credentials & Personae

Í∞Å ÌîÑÎ°úÏÑ∏Ïä§Îäî ÏãúÏä§ÌÖú ÎÇ¥ÏóêÏÑú **Í∂åÌïúÏùÑ ÏãùÎ≥ÑÌïòÎäî ÏûêÍ≤© Ï¶ùÎ™Ö**ÏùÑ Î≥¥Ïú†Ìï©ÎãàÎã§. Í∞Å ÌîÑÎ°úÏÑ∏Ïä§Îäî ÌïòÎÇòÏùò Í∏∞Î≥∏ `uid`ÏôÄ ÌïòÎÇòÏùò Í∏∞Î≥∏ `gid`Î•º Í∞ÄÏßÄÎ©∞(Ïó¨Îü¨ Í∑∏Î£πÏóê ÏÜçÌï† Ïàò ÏûàÏùå).\
Ïù¥ÏßÑ ÌååÏùºÏù¥ `setuid/setgid` ÎπÑÌä∏Î•º Í∞ÄÏßÄÍ≥† ÏûàÎã§Î©¥ ÏÇ¨Ïö©Ïûê Î∞è Í∑∏Î£π IDÎ•º Î≥ÄÍ≤ΩÌïòÎäî Í≤ÉÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§.\
ÏÉàÎ°úÏö¥ uids/gidsÎ•º **ÏÑ§Ï†ïÌïòÎäî Ïó¨Îü¨ Ìï®Ïàò**Í∞Ä ÏûàÏäµÎãàÎã§.

ÏãúÏä§ÌÖú Ìò∏Ï∂ú **`persona`**Îäî **ÎåÄÏ≤¥** ÏûêÍ≤© Ï¶ùÎ™Ö ÏÑ∏Ìä∏Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌéòÎ•¥ÏÜåÎÇòÎ•º Ï±ÑÌÉùÌïòÎ©¥ uid, gid Î∞è Í∑∏Î£π Î©§Î≤ÑÏã≠ÏùÑ **Ìïú Î≤àÏóê** Í∞ÄÏ†ïÌï©ÎãàÎã§. [**ÏÜåÏä§ ÏΩîÎìú**](https://github.com/apple/darwin-xnu/blob/main/bsd/sys/persona.h)ÏóêÏÑú Íµ¨Ï°∞Ï≤¥Î•º Ï∞æÏùÑ Ïàò ÏûàÏäµÎãàÎã§:
```c
struct kpersona_info { uint32_t persona_info_version;
uid_t    persona_id; /* overlaps with UID */
int      persona_type;
gid_t    persona_gid;
uint32_t persona_ngroups;
gid_t    persona_groups[NGROUPS];
uid_t    persona_gmuid;
char     persona_name[MAXLOGNAME + 1];

/* TODO: MAC policies?! */
}
```
## Ïä§Î†àÎìú Í∏∞Î≥∏ Ï†ïÎ≥¥

1. **POSIX Ïä§Î†àÎìú (pthreads):** macOSÎäî C/C++Ïùò ÌëúÏ§Ä Ïä§Î†àÎî© APIÏùò ÏùºÎ∂ÄÏù∏ POSIX Ïä§Î†àÎìú(`pthreads`)Î•º ÏßÄÏõêÌï©ÎãàÎã§. macOSÏùò pthreads Íµ¨ÌòÑÏùÄ `/usr/lib/system/libsystem_pthread.dylib`Ïóê ÏûàÏúºÎ©∞, Ïù¥Îäî Í≥µÍ∞úÏ†ÅÏúºÎ°ú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú `libpthread` ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑú Í∞ÄÏ†∏Ïò® Í≤ÉÏûÖÎãàÎã§. Ïù¥ ÎùºÏù¥Î∏åÎü¨Î¶¨Îäî Ïä§Î†àÎìúÎ•º ÏÉùÏÑ±ÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÎäî Îç∞ ÌïÑÏöîÌïú Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.
2. **Ïä§Î†àÎìú ÏÉùÏÑ±:** `pthread_create()` Ìï®ÏàòÎäî ÏÉàÎ°úÏö¥ Ïä§Î†àÎìúÎ•º ÏÉùÏÑ±ÌïòÎäî Îç∞ ÏÇ¨Ïö©Îê©ÎãàÎã§. ÎÇ¥Î∂ÄÏ†ÅÏúºÎ°ú Ïù¥ Ìï®ÏàòÎäî XNU Ïª§ÎÑê(Ï¶â, macOSÍ∞Ä Í∏∞Î∞òÏúºÎ°ú ÌïòÎäî Ïª§ÎÑê)Ïóê ÌäπÏ†ïÌïú Ï†ÄÏàòÏ§Ä ÏãúÏä§ÌÖú Ìò∏Ï∂úÏù∏ `bsdthread_create()`Î•º Ìò∏Ï∂úÌï©ÎãàÎã§. Ïù¥ ÏãúÏä§ÌÖú Ìò∏Ï∂úÏùÄ Ïä§Î†àÎìú ÎèôÏûëÏùÑ ÏßÄÏ†ïÌïòÎäî `pthread_attr`(ÏÜçÏÑ±)ÏóêÏÑú ÌååÏÉùÎêú Îã§ÏñëÌïú ÌîåÎûòÍ∑∏Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§. Ïó¨Í∏∞ÏóêÎäî Ïä§ÏºÄÏ§ÑÎßÅ Ï†ïÏ±ÖÍ≥º Ïä§ÌÉù ÌÅ¨Í∏∞Í∞Ä Ìè¨Ìï®Îê©ÎãàÎã§.
* **Í∏∞Î≥∏ Ïä§ÌÉù ÌÅ¨Í∏∞:** ÏÉàÎ°úÏö¥ Ïä§Î†àÎìúÏùò Í∏∞Î≥∏ Ïä§ÌÉù ÌÅ¨Í∏∞Îäî 512 KBÎ°ú, ÏùºÎ∞òÏ†ÅÏù∏ ÏûëÏóÖÏóêÎäî Ï∂©Î∂ÑÌïòÏßÄÎßå Îçî ÎßéÍ±∞ÎÇò Ï†ÅÏùÄ Í≥µÍ∞ÑÏù¥ ÌïÑÏöîÌï† Í≤ΩÏö∞ Ïä§Î†àÎìú ÏÜçÏÑ±ÏùÑ ÌÜµÌï¥ Ï°∞Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.
3. **Ïä§Î†àÎìú Ï¥àÍ∏∞Ìôî:** `__pthread_init()` Ìï®ÏàòÎäî Ïä§Î†àÎìú ÏÑ§Ï†ï Ï§ëÏóê Ï§ëÏöîÌïòÎ©∞, `env[]` Ïù∏ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ïä§ÌÉùÏùò ÏúÑÏπòÏôÄ ÌÅ¨Í∏∞Ïóê ÎåÄÌïú ÏÑ∏Î∂Ä Ï†ïÎ≥¥Î•º Ìè¨Ìï®Ìï† Ïàò ÏûàÎäî ÌôòÍ≤Ω Î≥ÄÏàòÎ•º Íµ¨Î¨∏ Î∂ÑÏÑùÌï©ÎãàÎã§.

#### macOSÏùò Ïä§Î†àÎìú Ï¢ÖÎ£å

1. **Ïä§Î†àÎìú Ï¢ÖÎ£å:** Ïä§Î†àÎìúÎäî ÏùºÎ∞òÏ†ÅÏúºÎ°ú `pthread_exit()`Î•º Ìò∏Ï∂úÌïòÏó¨ Ï¢ÖÎ£åÎê©ÎãàÎã§. Ïù¥ Ìï®ÏàòÎäî Ïä§Î†àÎìúÍ∞Ä ÍπîÎÅîÌïòÍ≤å Ï¢ÖÎ£åÎêòÎèÑÎ°ù ÌïòÎ©∞, ÌïÑÏöîÌïú Ï†ïÎ¶¨Î•º ÏàòÌñâÌïòÍ≥† Ïä§Î†àÎìúÍ∞Ä Î™®Îì† Ï°∞Ïù∏ÏûêÏóêÍ≤å Î∞òÌôò Í∞íÏùÑ Î≥¥ÎÇº Ïàò ÏûàÎèÑÎ°ù Ìï©ÎãàÎã§.
2. **Ïä§Î†àÎìú Ï†ïÎ¶¨:** `pthread_exit()`Î•º Ìò∏Ï∂úÌïòÎ©¥ `pthread_terminate()` Ìï®ÏàòÍ∞Ä Ìò∏Ï∂úÎêòÏñ¥ Î™®Îì† Í¥ÄÎ†® Ïä§Î†àÎìú Íµ¨Ï°∞Î•º Ï†úÍ±∞Ìï©ÎãàÎã§. Ïù¥ Ìï®ÏàòÎäî Mach Ïä§Î†àÎìú Ìè¨Ìä∏Î•º Ìï¥Ï†úÌïòÍ≥†(MachÎäî XNU Ïª§ÎÑêÏùò ÌÜµÏã† ÌïòÏúÑ ÏãúÏä§ÌÖú) Ïä§Î†àÎìúÏôÄ Í¥ÄÎ†®Îêú Ïª§ÎÑê ÏàòÏ§Ä Íµ¨Ï°∞Î•º Ï†úÍ±∞ÌïòÎäî ÏãúÏä§ÌÖú Ìò∏Ï∂úÏù∏ `bsdthread_terminate`Î•º Ìò∏Ï∂úÌï©ÎãàÎã§.

#### ÎèôÍ∏∞Ìôî Î©îÏª§ÎãàÏ¶ò

Í≥µÏú† ÏûêÏõêÏóê ÎåÄÌïú Ï†ëÍ∑ºÏùÑ Í¥ÄÎ¶¨ÌïòÍ≥† Í≤ΩÏüÅ Ï°∞Í±¥ÏùÑ ÌîºÌïòÍ∏∞ ÏúÑÌï¥ macOSÎäî Ïó¨Îü¨ ÎèôÍ∏∞Ìôî ÏõêÏãú ÌÉÄÏûÖÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. Ïù¥Îäî Îç∞Ïù¥ÌÑ∞ Î¨¥Í≤∞ÏÑ±Í≥º ÏãúÏä§ÌÖú ÏïàÏ†ïÏÑ±ÏùÑ Î≥¥Ïû•ÌïòÍ∏∞ ÏúÑÌï¥ Îã§Ï§ë Ïä§Î†àÎî© ÌôòÍ≤ΩÏóêÏÑú Ï§ëÏöîÌï©ÎãàÎã§:

1. **ÎÆ§ÌÖçÏä§:**
* **ÏùºÎ∞ò ÎÆ§ÌÖçÏä§ (ÏÑúÎ™Ö: 0x4D555458):** Î©îÎ™®Î¶¨ ÏÇ¨Ïö©ÎüâÏù¥ 60Î∞îÏù¥Ìä∏(ÎÆ§ÌÖçÏä§ 56Î∞îÏù¥Ìä∏ + ÏÑúÎ™Ö 4Î∞îÏù¥Ìä∏)Ïù∏ ÌëúÏ§Ä ÎÆ§ÌÖçÏä§ÏûÖÎãàÎã§.
* **Îπ†Î•∏ ÎÆ§ÌÖçÏä§ (ÏÑúÎ™Ö: 0x4d55545A):** ÏùºÎ∞ò ÎÆ§ÌÖçÏä§ÏôÄ Ïú†ÏÇ¨ÌïòÏßÄÎßå Îçî Îπ†Î•∏ ÏûëÏóÖÏùÑ ÏúÑÌï¥ ÏµúÏ†ÅÌôîÎêú Í≤ÉÏúºÎ°ú, ÌÅ¨Í∏∞Îäî 60Î∞îÏù¥Ìä∏ÏûÖÎãàÎã§.
2. **Ï°∞Í±¥ Î≥ÄÏàò:**
* ÌäπÏ†ï Ï°∞Í±¥Ïù¥ Î∞úÏÉùÌï† ÎïåÍπåÏßÄ ÎåÄÍ∏∞ÌïòÎäî Îç∞ ÏÇ¨Ïö©ÎêòÎ©∞, ÌÅ¨Í∏∞Îäî 44Î∞îÏù¥Ìä∏(40Î∞îÏù¥Ìä∏ + 4Î∞îÏù¥Ìä∏ ÏÑúÎ™Ö)ÏûÖÎãàÎã§.
* **Ï°∞Í±¥ Î≥ÄÏàò ÏÜçÏÑ± (ÏÑúÎ™Ö: 0x434e4441):** Ï°∞Í±¥ Î≥ÄÏàòÏùò Íµ¨ÏÑ± ÏÜçÏÑ±ÏúºÎ°ú, ÌÅ¨Í∏∞Îäî 12Î∞îÏù¥Ìä∏ÏûÖÎãàÎã§.
3. **Ìïú Î≤à Î≥ÄÏàò (ÏÑúÎ™Ö: 0x4f4e4345):**
* Ï¥àÍ∏∞Ìôî ÏΩîÎìúÍ∞Ä Ìïú Î≤àÎßå Ïã§ÌñâÎêòÎèÑÎ°ù Î≥¥Ïû•Ìï©ÎãàÎã§. ÌÅ¨Í∏∞Îäî 12Î∞îÏù¥Ìä∏ÏûÖÎãàÎã§.
4. **ÏùΩÍ∏∞-Ïì∞Í∏∞ Ïû†Í∏à:**
* ÎèôÏãúÏóê Ïó¨Îü¨ ÎèÖÏûêÍ∞Ä ÏûàÍ±∞ÎÇò Ìïú ÏûëÏÑ±ÏûêÍ∞Ä ÏûàÏùÑ Ïàò ÏûàÎèÑÎ°ù ÌïòÏó¨ Í≥µÏú† Îç∞Ïù¥ÌÑ∞Ïóê ÎåÄÌïú Ìö®Ïú®Ï†ÅÏù∏ Ï†ëÍ∑ºÏùÑ Ï¥âÏßÑÌï©ÎãàÎã§.
* **ÏùΩÍ∏∞ Ïì∞Í∏∞ Ïû†Í∏à (ÏÑúÎ™Ö: 0x52574c4b):** ÌÅ¨Í∏∞Îäî 196Î∞îÏù¥Ìä∏ÏûÖÎãàÎã§.
* **ÏùΩÍ∏∞ Ïì∞Í∏∞ Ïû†Í∏à ÏÜçÏÑ± (ÏÑúÎ™Ö: 0x52574c41):** ÏùΩÍ∏∞-Ïì∞Í∏∞ Ïû†Í∏àÏùò ÏÜçÏÑ±ÏúºÎ°ú, ÌÅ¨Í∏∞Îäî 20Î∞îÏù¥Ìä∏ÏûÖÎãàÎã§.

{% hint style="success" %}
Ïù¥ Í∞ùÏ≤¥Ïùò ÎßàÏßÄÎßâ 4Î∞îÏù¥Ìä∏Îäî Ïò§Î≤ÑÌîåÎ°úÏö∞Î•º Í∞êÏßÄÌïòÎäî Îç∞ ÏÇ¨Ïö©Îê©ÎãàÎã§.
{% endhint %}

### Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàò (TLV)

**Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàò (TLV)**Îäî Mach-O ÌååÏùº(Ï¶â, macOSÏùò Ïã§Ìñâ ÌååÏùº ÌòïÏãù) Îß•ÎùΩÏóêÏÑú Îã§Ï§ë Ïä§Î†àÎìú Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóêÏÑú **Í∞Å Ïä§Î†àÎìú**Ïóê ÌäπÏ†ïÌïú Î≥ÄÏàòÎ•º ÏÑ†Ïñ∏ÌïòÎäî Îç∞ ÏÇ¨Ïö©Îê©ÎãàÎã§. Ïù¥Îäî Í∞Å Ïä§Î†àÎìúÍ∞Ä Î≥ÄÏàòÏùò Î≥ÑÎèÑ Ïù∏Ïä§ÌÑ¥Ïä§Î•º Í∞ÄÏßÄÎèÑÎ°ù ÌïòÏó¨ Ï∂©ÎèåÏùÑ ÌîºÌïòÍ≥† Îç∞Ïù¥ÌÑ∞ Î¨¥Í≤∞ÏÑ±ÏùÑ Ïú†ÏßÄÌï† Ïàò ÏûàÎäî Î∞©Î≤ïÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. 

C Î∞è Í¥ÄÎ†® Ïñ∏Ïñ¥ÏóêÏÑúÎäî **`__thread`** ÌÇ§ÏõåÎìúÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàòÎ•º ÏÑ†Ïñ∏Ìï† Ïàò ÏûàÏäµÎãàÎã§. Îã§ÏùåÏùÄ ÏòàÏ†úÏóêÏÑú ÏûëÎèôÌïòÎäî Î∞©ÏãùÏûÖÎãàÎã§:
```c
cCopy code__thread int tlv_var;

void main (int argc, char **argv){
tlv_var = 10;
}
```
Ïù¥ Ïä§ÎãàÌé´ÏùÄ `tlv_var`Î•º Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàòÎ°ú Ï†ïÏùòÌï©ÎãàÎã§. Ïù¥ ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎäî Í∞Å Ïä§Î†àÎìúÎäî ÏûêÏã†Ïùò `tlv_var`Î•º Í∞ÄÏßÄÎ©∞, Ìïú Ïä§Î†àÎìúÍ∞Ä `tlv_var`Ïóê Í∞ÄÌïú Î≥ÄÍ≤ΩÏùÄ Îã§Î•∏ Ïä§Î†àÎìúÏùò `tlv_var`Ïóê ÏòÅÌñ•ÏùÑ ÎØ∏ÏπòÏßÄ ÏïäÏäµÎãàÎã§.

Mach-O Î∞îÏù¥ÎÑàÎ¶¨ÏóêÏÑú Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàòÏôÄ Í¥ÄÎ†®Îêú Îç∞Ïù¥ÌÑ∞Îäî ÌäπÏ†ï ÏÑπÏÖòÏúºÎ°ú Íµ¨ÏÑ±Îê©ÎãàÎã§:

* **`__DATA.__thread_vars`**: Ïù¥ ÏÑπÏÖòÏùÄ Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàòÏóê ÎåÄÌïú Î©îÌÉÄÎç∞Ïù¥ÌÑ∞, Ï¶â Î≥ÄÏàòÏùò Ïú†ÌòïÍ≥º Ï¥àÍ∏∞Ìôî ÏÉÅÌÉúÎ•º Ìè¨Ìï®Ìï©ÎãàÎã§.
* **`__DATA.__thread_bss`**: Ïù¥ ÏÑπÏÖòÏùÄ Î™ÖÏãúÏ†ÅÏúºÎ°ú Ï¥àÍ∏∞ÌôîÎêòÏßÄ ÏïäÏùÄ Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàòÏóê ÏÇ¨Ïö©Îê©ÎãàÎã§. Ïù¥Îäî Ï†úÎ°ú Ï¥àÍ∏∞ÌôîÎêú Îç∞Ïù¥ÌÑ∞Ïóê Ìï†ÎãπÎêú Î©îÎ™®Î¶¨Ïùò ÏùºÎ∂ÄÏûÖÎãàÎã§.

Mach-OÎäî Ïä§Î†àÎìúÍ∞Ä Ï¢ÖÎ£åÎê† Îïå Ïä§Î†àÎìú Î°úÏª¨ Î≥ÄÏàòÎ•º Í¥ÄÎ¶¨ÌïòÍ∏∞ ÏúÑÌï¥ **`tlv_atexit`**ÎùºÎäî ÌäπÏ†ï APIÎ•º Ï†úÍ≥µÌï©ÎãàÎã§. Ïù¥ APIÎ•º ÏÇ¨Ïö©ÌïòÎ©¥ Ïä§Î†àÎìúÍ∞Ä Ï¢ÖÎ£åÎê† Îïå Ïä§Î†àÎìú Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º Ï†ïÎ¶¨ÌïòÎäî **ÏÜåÎ©∏Ïûê**Î•º Îì±Î°ùÌï† Ïàò ÏûàÏäµÎãàÎã§.

### Ïä§Î†àÎî© Ïö∞ÏÑ†ÏàúÏúÑ

Ïä§Î†àÎìú Ïö∞ÏÑ†ÏàúÏúÑÎ•º Ïù¥Ìï¥ÌïòÎ†§Î©¥ Ïö¥ÏòÅ Ï≤¥Ï†úÍ∞Ä Ïñ¥Îñ§ Ïä§Î†àÎìúÎ•º Ïñ∏Ï†ú Ïã§ÌñâÌï†ÏßÄÎ•º Í≤∞Ï†ïÌïòÎäî Î∞©ÏãùÏùÑ ÏÇ¥Ìé¥Î¥êÏïº Ìï©ÎãàÎã§. Ïù¥ Í≤∞Ï†ïÏùÄ Í∞Å Ïä§Î†àÎìúÏóê Ìï†ÎãπÎêú Ïö∞ÏÑ†ÏàúÏúÑ ÏàòÏ§ÄÏóê ÏùòÌï¥ ÏòÅÌñ•ÏùÑ Î∞õÏäµÎãàÎã§. macOS Î∞è Ïú†ÎãâÏä§ Í≥ÑÏó¥ ÏãúÏä§ÌÖúÏóêÏÑúÎäî `nice`, `renice`, QoS(ÏÑúÎπÑÏä§ ÌíàÏßà) ÌÅ¥ÎûòÏä§ÏôÄ Í∞ôÏùÄ Í∞úÎÖêÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ïù¥Î•º Ï≤òÎ¶¨Ìï©ÎãàÎã§.

#### NiceÏôÄ Renice

1. **Nice:**
* ÌîÑÎ°úÏÑ∏Ïä§Ïùò `nice` Í∞íÏùÄ Ïö∞ÏÑ†ÏàúÏúÑÏóê ÏòÅÌñ•ÏùÑ ÎØ∏ÏπòÎäî Ïà´ÏûêÏûÖÎãàÎã§. Î™®Îì† ÌîÑÎ°úÏÑ∏Ïä§Îäî -20(Í∞ÄÏû• ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ)ÏóêÏÑú 19(Í∞ÄÏû• ÎÇÆÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ)ÍπåÏßÄÏùò nice Í∞íÏùÑ Í∞ÄÏßëÎãàÎã§. ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä ÏÉùÏÑ±Îê† Îïå Í∏∞Î≥∏ nice Í∞íÏùÄ ÏùºÎ∞òÏ†ÅÏúºÎ°ú 0ÏûÖÎãàÎã§.
* ÎÇÆÏùÄ nice Í∞í( -20Ïóê Í∞ÄÍπåÏö¥)ÏùÄ ÌîÑÎ°úÏÑ∏Ïä§Î•º Îçî "Ïù¥Í∏∞Ï†Å"ÏúºÎ°ú ÎßåÎì§Ïñ¥, Îçî ÎÜíÏùÄ nice Í∞íÏùÑ Í∞ÄÏßÑ Îã§Î•∏ ÌîÑÎ°úÏÑ∏Ïä§Ïóê ÎπÑÌï¥ Îçî ÎßéÏùÄ CPU ÏãúÍ∞ÑÏùÑ Î∂ÄÏó¨Ìï©ÎãàÎã§.
2. **Renice:**
* `renice`Îäî Ïù¥ÎØ∏ Ïã§Ìñâ Ï§ëÏù∏ ÌîÑÎ°úÏÑ∏Ïä§Ïùò nice Í∞íÏùÑ Î≥ÄÍ≤ΩÌïòÎäî Îç∞ ÏÇ¨Ïö©ÎêòÎäî Î™ÖÎ†πÏûÖÎãàÎã§. Ïù¥Îäî ÌîÑÎ°úÏÑ∏Ïä§Ïùò Ïö∞ÏÑ†ÏàúÏúÑÎ•º ÎèôÏ†ÅÏúºÎ°ú Ï°∞Ï†ïÌïòÎäî Îç∞ ÏÇ¨Ïö©Îê† Ïàò ÏûàÏúºÎ©∞, ÏÉàÎ°úÏö¥ nice Í∞íÏóê Îî∞Îùº CPU ÏãúÍ∞Ñ Ìï†ÎãπÏùÑ Ï¶ùÍ∞ÄÏãúÌÇ§Í±∞ÎÇò Í∞êÏÜåÏãúÌÇ¨ Ïàò ÏûàÏäµÎãàÎã§.
* ÏòàÎ•º Îì§Ïñ¥, ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä ÏùºÏãúÏ†ÅÏúºÎ°ú Îçî ÎßéÏùÄ CPU Î¶¨ÏÜåÏä§Í∞Ä ÌïÑÏöîÌïòÎã§Î©¥ `renice`Î•º ÏÇ¨Ïö©ÌïòÏó¨ nice Í∞íÏùÑ ÎÇÆÏ∂ú Ïàò ÏûàÏäµÎãàÎã§.

#### ÏÑúÎπÑÏä§ ÌíàÏßà(QoS) ÌÅ¥ÎûòÏä§

QoS ÌÅ¥ÎûòÏä§Îäî ÌäπÌûà **Grand Central Dispatch (GCD)**Î•º ÏßÄÏõêÌïòÎäî macOSÏôÄ Í∞ôÏùÄ ÏãúÏä§ÌÖúÏóêÏÑú Ïä§Î†àÎìú Ïö∞ÏÑ†ÏàúÏúÑÎ•º Ï≤òÎ¶¨ÌïòÎäî Î≥¥Îã§ ÌòÑÎåÄÏ†ÅÏù∏ Ï†ëÍ∑º Î∞©ÏãùÏûÖÎãàÎã§. QoS ÌÅ¥ÎûòÏä§Îäî Í∞úÎ∞úÏûêÍ∞Ä ÏûëÏóÖÏùò Ï§ëÏöîÏÑ±Ïù¥ÎÇò Í∏¥Í∏âÏÑ±Ïóê Îî∞Îùº Îã§ÏñëÌïú ÏàòÏ§ÄÏúºÎ°ú ÏûëÏóÖÏùÑ **Î∂ÑÎ•ò**Ìï† Ïàò ÏûàÍ≤å Ìï©ÎãàÎã§. macOSÎäî Ïù¥Îü¨Ìïú QoS ÌÅ¥ÎûòÏä§Î•º Í∏∞Î∞òÏúºÎ°ú Ïä§Î†àÎìú Ïö∞ÏÑ†ÏàúÏúÑÎ•º ÏûêÎèôÏúºÎ°ú Í¥ÄÎ¶¨Ìï©ÎãàÎã§:

1. **ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö©:**
* Ïù¥ ÌÅ¥ÎûòÏä§Îäî ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏôÄ ÏÉÅÌò∏ÏûëÏö© Ï§ëÏù¥Í±∞ÎÇò Ï¢ãÏùÄ ÏÇ¨Ïö©Ïûê Í≤ΩÌóòÏùÑ Ï†úÍ≥µÌïòÍ∏∞ ÏúÑÌï¥ Ï¶âÍ∞ÅÏ†ÅÏù∏ Í≤∞Í≥ºÍ∞Ä ÌïÑÏöîÌïú ÏûëÏóÖÏùÑ ÏúÑÌïú Í≤ÉÏûÖÎãàÎã§. Ïù¥Îü¨Ìïú ÏûëÏóÖÏùÄ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Î∞òÏùëÏ†ÅÏúºÎ°ú Ïú†ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ Í∞ÄÏû• ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑÎ•º Î∂ÄÏó¨Î∞õÏäµÎãàÎã§(Ïòà: Ïï†ÎãàÎ©îÏù¥ÏÖò ÎòêÎäî Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨).
2. **ÏÇ¨Ïö©Ïûê ÏãúÏûë:**
* ÏÇ¨Ïö©ÏûêÍ∞Ä ÏãúÏûëÌïòÍ≥† Ï¶âÍ∞ÅÏ†ÅÏù∏ Í≤∞Í≥ºÎ•º Í∏∞ÎåÄÌïòÎäî ÏûëÏóÖÏúºÎ°ú, Î¨∏ÏÑúÎ•º Ïó¥Í±∞ÎÇò Í≥ÑÏÇ∞Ïù¥ ÌïÑÏöîÌïú Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎäî Í≤ÉÍ≥º Í∞ôÏùÄ ÏûëÏóÖÏûÖÎãàÎã§. Ïù¥Îì§ÏùÄ ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑÎ•º Í∞ÄÏßÄÏßÄÎßå ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö©Î≥¥Îã§Îäî ÎÇÆÏäµÎãàÎã§.
3. **Ïú†Ìã∏Î¶¨Ìã∞:**
* Ïù¥Îü¨Ìïú ÏûëÏóÖÏùÄ Ïû•Í∏∞ Ïã§ÌñâÎêòÎ©∞ ÏùºÎ∞òÏ†ÅÏúºÎ°ú ÏßÑÌñâ ÌëúÏãúÍ∏∞Î•º ÌëúÏãúÌï©ÎãàÎã§(Ïòà: ÌååÏùº Îã§Ïö¥Î°úÎìú, Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞). Ïù¥Îì§ÏùÄ ÏÇ¨Ïö©Ïûê ÏãúÏûë ÏûëÏóÖÎ≥¥Îã§ Ïö∞ÏÑ†ÏàúÏúÑÍ∞Ä ÎÇÆÏúºÎ©∞ Ï¶âÏãú ÏôÑÎ£åÎê† ÌïÑÏöîÎäî ÏóÜÏäµÎãàÎã§.
4. **Î∞±Í∑∏ÎùºÏö¥Îìú:**
* Ïù¥ ÌÅ¥ÎûòÏä§Îäî Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú ÏûëÎèôÌïòÎ©∞ ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎäî Î≥¥Ïù¥ÏßÄ ÏïäÎäî ÏûëÏóÖÏùÑ ÏúÑÌïú Í≤ÉÏûÖÎãàÎã§. Ïù¥Îü¨Ìïú ÏûëÏóÖÏùÄ Ïù∏Îç±Ïã±, ÎèôÍ∏∞Ìôî ÎòêÎäî Î∞±ÏóÖÍ≥º Í∞ôÏùÄ ÏûëÏóÖÏùº Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îì§ÏùÄ Í∞ÄÏû• ÎÇÆÏùÄ Ïö∞ÏÑ†ÏàúÏúÑÎ•º Í∞ÄÏßÄÎ©∞ ÏãúÏä§ÌÖú ÏÑ±Îä•Ïóê ÎØ∏ÏπòÎäî ÏòÅÌñ•Ïù¥ ÏµúÏÜåÌôîÎê©ÎãàÎã§.

QoS ÌÅ¥ÎûòÏä§Î•º ÏÇ¨Ïö©ÌïòÎ©¥ Í∞úÎ∞úÏûêÎäî Ï†ïÌôïÌïú Ïö∞ÏÑ†ÏàúÏúÑ Ïà´ÏûêÎ•º Í¥ÄÎ¶¨Ìï† ÌïÑÏöîÍ∞Ä ÏóÜÏúºÎ©∞, ÏûëÏóÖÏùò ÏÑ±Í≤©Ïóê ÏßëÏ§ëÌïòÍ≥† ÏãúÏä§ÌÖúÏù¥ CPU Î¶¨ÏÜåÏä§Î•º ÏµúÏ†ÅÌôîÌïòÎèÑÎ°ù Ìï† Ïàò ÏûàÏäµÎãàÎã§.

ÎòêÌïú, Ïä§Î†àÎìú Ïä§ÏºÄÏ§ÑÎßÅ Ï†ïÏ±ÖÏù¥ ÏûàÏúºÎ©∞, Ïù¥Îäî Ïä§ÏºÄÏ§ÑÎü¨Í∞Ä Í≥†Î†§Ìï† Ïä§ÏºÄÏ§ÑÎßÅ Îß§Í∞úÎ≥ÄÏàò ÏßëÌï©ÏùÑ ÏßÄÏ†ïÌïòÎäî ÌùêÎ¶ÑÏûÖÎãàÎã§. Ïù¥Îäî `thread_policy_[set/get]`Î•º ÏÇ¨Ïö©ÌïòÏó¨ ÏàòÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îäî Í≤ΩÏüÅ Ï°∞Í±¥ Í≥µÍ≤©Ïóê Ïú†Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.

## MacOS ÌîÑÎ°úÏÑ∏Ïä§ ÎÇ®Ïö©

MacOSÎäî Îã§Î•∏ Ïö¥ÏòÅ Ï≤¥Ï†úÏôÄ ÎßàÏ∞¨Í∞ÄÏßÄÎ°ú **ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä ÏÉÅÌò∏ÏûëÏö©ÌïòÍ≥†, ÌÜµÏã†ÌïòÎ©∞, Îç∞Ïù¥ÌÑ∞Î•º Í≥µÏú†ÌïòÎäî** Îã§ÏñëÌïú Î∞©Î≤ïÍ≥º Î©îÏª§ÎãàÏ¶òÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. Ïù¥Îü¨Ìïú Í∏∞Ïà†ÏùÄ Ìö®Ïú®Ï†ÅÏù∏ ÏãúÏä§ÌÖú Í∏∞Îä•Ïóê ÌïÑÏàòÏ†ÅÏù¥ÏßÄÎßå, ÏúÑÌòë ÌñâÏúÑÏûêÏóê ÏùòÌï¥ **ÏïÖÏùòÏ†ÅÏù∏ ÌôúÎèôÏùÑ ÏàòÌñâÌïòÎäî Îç∞ ÎÇ®Ïö©Îê† Ïàò ÏûàÏäµÎãàÎã§.**

### ÎùºÏù¥Î∏åÎü¨Î¶¨ Ï£ºÏûÖ

ÎùºÏù¥Î∏åÎü¨Î¶¨ Ï£ºÏûÖÏùÄ Í≥µÍ≤©ÏûêÍ∞Ä **ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä ÏïÖÏÑ± ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î°úÎìúÌïòÎèÑÎ°ù Í∞ïÏ†úÌïòÎäî** Í∏∞Ïà†ÏûÖÎãàÎã§. Ï£ºÏûÖÎêú ÌõÑ, ÎùºÏù¥Î∏åÎü¨Î¶¨Îäî ÎåÄÏÉÅ ÌîÑÎ°úÏÑ∏Ïä§Ïùò Ïª®ÌÖçÏä§Ìä∏ÏóêÏÑú Ïã§ÌñâÎêòÏñ¥ Í≥µÍ≤©ÏûêÏóêÍ≤å ÌîÑÎ°úÏÑ∏Ïä§ÏôÄ ÎèôÏùºÌïú Í∂åÌïúÍ≥º Ï†ëÍ∑ºÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.

{% content-ref url="macos-library-injection/" %}
[macos-library-injection](macos-library-injection/)
{% endcontent-ref %}

### Ìï®Ïàò ÌõÑÌÇπ

Ìï®Ïàò ÌõÑÌÇπÏùÄ ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ ÏΩîÎìú ÎÇ¥ÏóêÏÑú **Ìï®Ïàò Ìò∏Ï∂ú** ÎòêÎäî Î©îÏãúÏßÄÎ•º Í∞ÄÎ°úÏ±ÑÎäî Í≤ÉÏùÑ Ìè¨Ìï®Ìï©ÎãàÎã§. Ìï®ÏàòÎ•º ÌõÑÌÇπÌï®ÏúºÎ°úÏç® Í≥µÍ≤©ÏûêÎäî ÌîÑÎ°úÏÑ∏Ïä§Ïùò **ÎèôÏûëÏùÑ ÏàòÏ†ï**ÌïòÍ±∞ÎÇò ÎØºÍ∞êÌïú Îç∞Ïù¥ÌÑ∞Î•º Í¥ÄÏ∞∞ÌïòÍ±∞ÎÇò Ïã§Ìñâ ÌùêÎ¶ÑÏùÑ Ï†úÏñ¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.

{% content-ref url="macos-function-hooking.md" %}
[macos-function-hooking.md](macos-function-hooking.md)
{% endcontent-ref %}

### ÌîÑÎ°úÏÑ∏Ïä§ Í∞Ñ ÌÜµÏã†

ÌîÑÎ°úÏÑ∏Ïä§ Í∞Ñ ÌÜµÏã†(IPC)ÏùÄ Î≥ÑÎèÑÏùò ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä **Îç∞Ïù¥ÌÑ∞Î•º Í≥µÏú†ÌïòÍ≥† ÍµêÌôòÌïòÎäî** Îã§ÏñëÌïú Î∞©Î≤ïÏùÑ ÎÇòÌÉÄÎÉÖÎãàÎã§. IPCÎäî ÎßéÏùÄ Ìï©Î≤ïÏ†ÅÏù∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóê ÌïÑÏàòÏ†ÅÏù¥ÏßÄÎßå, ÌîÑÎ°úÏÑ∏Ïä§ Í≤©Î¶¨Î•º Î¨¥ÎÑàÎú®Î¶¨Í±∞ÎÇò ÎØºÍ∞êÌïú Ï†ïÎ≥¥Î•º Ïú†Ï∂úÌïòÍ±∞ÎÇò Î¨¥Îã® ÏûëÏóÖÏùÑ ÏàòÌñâÌïòÎäî Îç∞ ÎÇ®Ïö©Îê† Ïàò ÏûàÏäµÎãàÎã§.

{% content-ref url="macos-ipc-inter-process-communication/" %}
[macos-ipc-inter-process-communication](macos-ipc-inter-process-communication/)
{% endcontent-ref %}

### Electron Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ï£ºÏûÖ

ÌäπÏ†ï ÌôòÍ≤Ω Î≥ÄÏàòÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ïã§ÌñâÎêú Electron Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÄ ÌîÑÎ°úÏÑ∏Ïä§ Ï£ºÏûÖÏóê Ï∑®ÏïΩÌï† Ïàò ÏûàÏäµÎãàÎã§:

{% content-ref url="macos-electron-applications-injection.md" %}
[macos-electron-applications-injection.md](macos-electron-applications-injection.md)
{% endcontent-ref %}

### Chromium Ï£ºÏûÖ

`--load-extension` Î∞è `--use-fake-ui-for-media-stream` ÌîåÎûòÍ∑∏Î•º ÏÇ¨Ïö©ÌïòÏó¨ **Î∏åÎùºÏö∞Ï†Ä ÎÇ¥ Í≥µÍ≤©**ÏùÑ ÏàòÌñâÌïòÏó¨ ÌÇ§ ÏûÖÎ†•, Ìä∏ÎûòÌîΩ, Ïø†ÌÇ§Î•º ÌõîÏπòÍ≥† ÌéòÏù¥ÏßÄÏóê Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ï£ºÏûÖÌï† Ïàò ÏûàÏäµÎãàÎã§:

{% content-ref url="macos-chromium-injection.md" %}
[macos-chromium-injection.md](macos-chromium-injection.md)
{% endcontent-ref %}

### ÎçîÎü¨Ïö¥ NIB

NIB ÌååÏùºÏùÄ **ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§(UI) ÏöîÏÜå**ÏôÄ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÎÇ¥ÏóêÏÑúÏùò ÏÉÅÌò∏ÏûëÏö©ÏùÑ Ï†ïÏùòÌï©ÎãàÎã§. Í∑∏Îü¨ÎÇò Ïù¥Îì§ÏùÄ **ÏûÑÏùòÏùò Î™ÖÎ†πÏùÑ Ïã§ÌñâÌï† Ïàò ÏûàÏúºÎ©∞** **GatekeeperÎäî** Ïù¥ÎØ∏ Ïã§ÌñâÎêú Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥ **NIB ÌååÏùºÏù¥ ÏàòÏ†ïÎêú Í≤ΩÏö∞** Ïã§ÌñâÎêòÎäî Í≤ÉÏùÑ ÎßâÏßÄ ÏïäÏäµÎãàÎã§. Îî∞ÎùºÏÑú Ïù¥Îì§ÏùÄ ÏûÑÏùòÏùò ÌîÑÎ°úÍ∑∏Îû®Ïù¥ ÏûÑÏùòÏùò Î™ÖÎ†πÏùÑ Ïã§ÌñâÌïòÎèÑÎ°ù ÎßåÎìúÎäî Îç∞ ÏÇ¨Ïö©Îê† Ïàò ÏûàÏäµÎãàÎã§:

{% content-ref url="macos-dirty-nib.md" %}
[macos-dirty-nib.md](macos-dirty-nib.md)
{% endcontent-ref %}

### Java Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ï£ºÏûÖ

ÌäπÏ†ï Java Í∏∞Îä•(Ïòà: **`_JAVA_OPTS`** ÌôòÍ≤Ω Î≥ÄÏàò)ÏùÑ ÎÇ®Ïö©ÌïòÏó¨ Java Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥ **ÏûÑÏùòÏùò ÏΩîÎìú/Î™ÖÎ†πÏùÑ Ïã§ÌñâÌïòÎèÑÎ°ù** ÎßåÎì§ Ïàò ÏûàÏäµÎãàÎã§.

{% content-ref url="macos-java-apps-injection.md" %}
[macos-java-apps-injection.md](macos-java-apps-injection.md)
{% endcontent-ref %}

### .Net Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ï£ºÏûÖ

**.Net ÎîîÎ≤ÑÍπÖ Í∏∞Îä•**ÏùÑ ÎÇ®Ïö©ÌïòÏó¨ .Net Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóê ÏΩîÎìúÎ•º Ï£ºÏûÖÌï† Ïàò ÏûàÏäµÎãàÎã§(Ïù¥Îäî macOS Î≥¥Ìò∏(Îü∞ÌÉÄÏûÑ Í∞ïÌôî)Î°ú Î≥¥Ìò∏ÎêòÏßÄ ÏïäÏùå).

{% content-ref url="macos-.net-applications-injection.md" %}
[macos-.net-applications-injection.md](macos-.net-applications-injection.md)
{% endcontent-ref %}

### Perl Ï£ºÏûÖ

Perl Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÏûÑÏùòÏùò ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎèÑÎ°ù ÎßåÎìúÎäî Îã§ÏñëÌïú ÏòµÏÖòÏùÑ ÌôïÏù∏ÌïòÏã≠ÏãúÏò§:

{% content-ref url="macos-perl-applications-injection.md" %}
[macos-perl-applications-injection.md](macos-perl-applications-injection.md)
{% endcontent-ref %}

### Ruby Ï£ºÏûÖ

Ruby ÌôòÍ≤Ω Î≥ÄÏàòÎ•º ÎÇ®Ïö©ÌïòÏó¨ ÏûÑÏùòÏùò Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÏûÑÏùòÏùò ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎèÑÎ°ù ÎßåÎì§ Ïàò ÏûàÏäµÎãàÎã§:

{% content-ref url="macos-ruby-applications-injection.md" %}
[macos-ruby-applications-injection.md](macos-ruby-applications-injection.md)
{% endcontent-ref %}

### Python Ï£ºÏûÖ

ÌôòÍ≤Ω Î≥ÄÏàò **`PYTHONINSPECT`**Í∞Ä ÏÑ§Ï†ïÎêòÎ©¥ Python ÌîÑÎ°úÏÑ∏Ïä§Îäî ÏôÑÎ£åÎêòÎ©¥ Python CLIÎ°ú ÎìúÎ°≠Îê©ÎãàÎã§. ÎòêÌïú **`PYTHONSTARTUP`**ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÎåÄÌôîÌòï ÏÑ∏ÏÖò ÏãúÏûë Ïãú Ïã§ÌñâÌï† Python Ïä§ÌÅ¨Î¶ΩÌä∏Î•º ÏßÄÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.\
Í∑∏Îü¨ÎÇò **`PYTHONINSPECT`**Í∞Ä ÎåÄÌôîÌòï ÏÑ∏ÏÖòÏùÑ ÏÉùÏÑ±Ìï† Îïå **`PYTHONSTARTUP`** Ïä§ÌÅ¨Î¶ΩÌä∏Îäî Ïã§ÌñâÎêòÏßÄ ÏïäÏäµÎãàÎã§.

**`PYTHONPATH`** Î∞è **`PYTHONHOME`**Í≥º Í∞ôÏùÄ Îã§Î•∏ ÌôòÍ≤Ω Î≥ÄÏàòÎèÑ Python Î™ÖÎ†πÏù¥ ÏûÑÏùòÏùò ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎèÑÎ°ù ÎßåÎìúÎäî Îç∞ Ïú†Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.

**`pyinstaller`**Î°ú Ïª¥ÌååÏùºÎêú Ïã§Ìñâ ÌååÏùºÏùÄ ÎÇ¥Ïû• PythonÏùÑ ÏÇ¨Ïö©ÌïòÎçîÎùºÎèÑ Ïù¥Îü¨Ìïú ÌôòÍ≤Ω Î≥ÄÏàòÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäîÎã§Îäî Ï†êÏóê Ïú†ÏùòÌïòÏã≠ÏãúÏò§.

{% hint style="danger" %}
Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú ÌôòÍ≤Ω Î≥ÄÏàòÎ•º ÎÇ®Ïö©ÌïòÏó¨ PythonÏù¥ ÏûÑÏùòÏùò ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎèÑÎ°ù ÎßåÎìúÎäî Î∞©Î≤ïÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏóàÏäµÎãàÎã§.\
Í∑∏Îü¨ÎÇò ÎåÄÎ∂ÄÎ∂ÑÏùò ÏÇ¨ÎûåÎì§ÏùÄ **Hombrew**Î•º ÏÇ¨Ïö©ÌïòÏó¨ PythonÏùÑ ÏÑ§ÏπòÌïòÎ©∞, Ïù¥Îäî Í∏∞Î≥∏ Í¥ÄÎ¶¨Ïûê ÏÇ¨Ïö©ÏûêÏóêÍ≤å **Ïì∞Í∏∞ Í∞ÄÎä•Ìïú ÏúÑÏπò**Ïóê PythonÏùÑ ÏÑ§ÏπòÌï©ÎãàÎã§. Îã§ÏùåÍ≥º Í∞ôÏùÄ Î∞©Î≤ïÏúºÎ°ú Ïù¥Î•º ÌÉàÏ∑®Ìï† Ïàò ÏûàÏäµÎãàÎã§:
```bash
mv /opt/homebrew/bin/python3 /opt/homebrew/bin/python3.old
cat > /opt/homebrew/bin/python3 <<EOF
#!/bin/bash
# Extra hijack code
/opt/homebrew/bin/python3.old "$@"
EOF
chmod +x /opt/homebrew/bin/python3
```
Even **root** will run this code when running python.
{% endhint %}

## Detection

### Shield

[**Shield**](https://theevilbit.github.io/shield/) ([**Github**](https://github.com/theevilbit/Shield))Îäî **ÌîÑÎ°úÏÑ∏Ïä§ Ï£ºÏûÖ** ÏûëÏóÖÏùÑ **ÌÉêÏßÄÌïòÍ≥† Ï∞®Îã®**Ìï† Ïàò ÏûàÎäî Ïò§Ìîà ÏÜåÏä§ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏûÖÎãàÎã§:

* **ÌôòÍ≤Ω Î≥ÄÏàò ÏÇ¨Ïö©**: Îã§Ïùå ÌôòÍ≤Ω Î≥ÄÏàò Ï§ë ÌïòÎÇòÏùò Ï°¥Ïû¨Î•º Î™®ÎãàÌÑ∞ÎßÅÌï©ÎãàÎã§: **`DYLD_INSERT_LIBRARIES`**, **`CFNETWORK_LIBRARY_PATH`**, **`RAWCAMERA_BUNDLE_PATH`** Î∞è **`ELECTRON_RUN_AS_NODE`**
* **`task_for_pid`** Ìò∏Ï∂ú ÏÇ¨Ïö©: Ìïú ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä Îã§Î•∏ ÌîÑÎ°úÏÑ∏Ïä§Ïùò **ÏûëÏóÖ Ìè¨Ìä∏**Î•º ÏñªÏúºÎ†§ Ìï† ÎïåÎ•º Ï∞æÏäµÎãàÎã§. Ïù¥Îäî ÌîÑÎ°úÏÑ∏Ïä§Ïóê ÏΩîÎìúÎ•º Ï£ºÏûÖÌï† Ïàò ÏûàÍ≤å Ìï¥Ï§çÎãàÎã§.
* **Electron Ïï± Îß§Í∞úÎ≥ÄÏàò**: ÎàÑÍµ∞Í∞Ä **`--inspect`**, **`--inspect-brk`** Î∞è **`--remote-debugging-port`** Î™ÖÎ†πÏ§Ñ Ïù∏ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÎîîÎ≤ÑÍπÖ Î™®ÎìúÏóêÏÑú Electron Ïï±ÏùÑ ÏãúÏûëÌïòÍ≥†, Îî∞ÎùºÏÑú ÏΩîÎìú Ï£ºÏûÖÏùÑ Ìï† Ïàò ÏûàÏäµÎãàÎã§.
* **Ïã¨Î≥ºÎ¶≠ ÎßÅÌÅ¨** ÎòêÎäî **ÌïòÎìú ÎßÅÌÅ¨** ÏÇ¨Ïö©: ÏùºÎ∞òÏ†ÅÏúºÎ°ú Í∞ÄÏû• ÌùîÌïú ÎÇ®Ïö©ÏùÄ **Ïö∞Î¶¨ ÏÇ¨Ïö©Ïûê Í∂åÌïúÏúºÎ°ú ÎßÅÌÅ¨Î•º ÏÉùÏÑ±ÌïòÍ≥†**, **Îçî ÎÜíÏùÄ Í∂åÌïú** ÏúÑÏπòÎ•º Í∞ÄÎ¶¨ÌÇ§Í≤å ÌïòÎäî Í≤ÉÏûÖÎãàÎã§. ÌïòÎìú ÎßÅÌÅ¨ÏôÄ Ïã¨Î≥ºÎ¶≠ ÎßÅÌÅ¨ Î™®ÎëêÏóê ÎåÄÌïú ÌÉêÏßÄÎäî Îß§Ïö∞ Í∞ÑÎã®Ìï©ÎãàÎã§. ÎßÅÌÅ¨Î•º ÏÉùÏÑ±ÌïòÎäî ÌîÑÎ°úÏÑ∏Ïä§Ïùò **Í∂åÌïú ÏàòÏ§Ä**Ïù¥ ÎåÄÏÉÅ ÌååÏùºÍ≥º Îã§Î•¥Î©¥ **Í≤ΩÍ≥†**Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§. Î∂àÌñâÌûàÎèÑ Ïã¨Î≥ºÎ¶≠ ÎßÅÌÅ¨Ïùò Í≤ΩÏö∞, ÏÉùÏÑ± Ï†ÑÏóê ÎßÅÌÅ¨Ïùò Î™©Ï†ÅÏßÄÏóê ÎåÄÌïú Ï†ïÎ≥¥Í∞Ä ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê Ï∞®Îã®Ïù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§. Ïù¥Îäî AppleÏùò EndpointSecuriy ÌîÑÎ†àÏûÑÏõåÌÅ¨Ïùò Ï†úÌïú ÏÇ¨Ìï≠ÏûÖÎãàÎã§.

### Îã§Î•∏ ÌîÑÎ°úÏÑ∏Ïä§ÏóêÏÑú Ìò∏Ï∂úÌïú Ìï®Ïàò

[**Ïù¥ Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏**](https://knight.sc/reverse%20engineering/2019/04/15/detecting-task-modifications.html)ÏóêÏÑú **`task_name_for_pid`** Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Îã§Î•∏ **ÌîÑÎ°úÏÑ∏Ïä§Í∞Ä ÌîÑÎ°úÏÑ∏Ïä§Ïóê ÏΩîÎìúÎ•º Ï£ºÏûÖÌïòÎäî** Ï†ïÎ≥¥Î•º ÏñªÍ≥†, Í∑∏ Îã§Î•∏ ÌîÑÎ°úÏÑ∏Ïä§Ïóê ÎåÄÌïú Ï†ïÎ≥¥Î•º ÏñªÎäî Î∞©Î≤ïÏùÑ Ï∞æÏùÑ Ïàò ÏûàÏäµÎãàÎã§.

Ïù¥ Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïòÎ†§Î©¥ ÌîÑÎ°úÏÑ∏Ïä§Î•º Ïã§ÌñâÌïòÎäî Í≤ÉÍ≥º **Í∞ôÏùÄ uid**Ïó¨Ïïº ÌïòÍ±∞ÎÇò **root**Ïó¨Ïïº Ìï©ÎãàÎã§ (Í∑∏Î¶¨Í≥† Ïù¥ Ìï®ÏàòÎäî ÌîÑÎ°úÏÑ∏Ïä§Ïóê ÎåÄÌïú Ï†ïÎ≥¥Î•º Î∞òÌôòÌïòÎ©∞, ÏΩîÎìúÎ•º Ï£ºÏûÖÌïòÎäî Î∞©Î≤ïÏùÄ Î∞òÌôòÌïòÏßÄ ÏïäÏäµÎãàÎã§).

## References

* [https://theevilbit.github.io/shield/](https://theevilbit.github.io/shield/)
* [https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
