# macOS Authorizations DB & Authd



{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Athorizarions DB**

`/var/db/auth.db` рдореЗрдВ рд╕реНрдерд┐рдд рдбреЗрдЯрд╛рдмреЗрд╕ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдСрдкрд░реЗрд╢рдиреЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ рдСрдкрд░реЗрд╢рди рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди** рдореЗрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЖрдорддреМрд░ рдкрд░ **XPC рд╕реЗрд╡рд╛рдУрдВ** рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХрд┐ **рдХреНрдпрд╛ рдХреЙрд▓рд┐рдВрдЧ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рдХреНрд░рд┐рдпрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗред

рд╢реБрд░реБрдЖрдд рдореЗрдВ, рдпрд╣ рдбреЗрдЯрд╛рдмреЗрд╕ `/System/Library/Security/authorization.plist` рдХреА рд╕рд╛рдордЧреНрд░реА рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░, рдХреБрдЫ рд╕реЗрд╡рд╛рдПрдБ рдЗрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдЕрдиреНрдп рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЬреЛрдбрд╝рдиреЗ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддреА рд╣реИрдВред

рдирд┐рдпрдо рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдЕрдВрджрд░ `rules` рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЙрд▓рдо рд╣реЛрддреЗ рд╣реИрдВ:

* **id**: рдкреНрд░рддреНрдпреЗрдХ рдирд┐рдпрдо рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрдврд╝рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рд╛рдердорд┐рдХ рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред
* **name**: рдирд┐рдпрдо рдХрд╛ рдЕрджреНрд╡рд┐рддреАрдп рдирд╛рдо рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕реЗ рдкрд╣рдЪрд╛рдирдиреЗ рдФрд░ рдЕрдзрд┐рдХреГрдд рдкреНрд░рдгрд╛рд▓реА рдХреЗ рднреАрддрд░ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **type**: рдирд┐рдпрдо рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЕрдзрд┐рдХреГрдд рддрд░реНрдХ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 1 рдпрд╛ 2 рдХреЗ рдорд╛рдиреЛрдВ рддрдХ рд╕реАрдорд┐рдд рд╣реИред
* **class**: рдирд┐рдпрдо рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд░реНрдЧ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкреВрд░реНрдгрд╛рдВрдХ рд╣реИред
* "allow" рдЕрдиреБрдорддрд┐ рдХреЗ рд▓рд┐рдП, "deny" рдЕрд╕реНрд╡реАрдХреГрддрд┐ рдХреЗ рд▓рд┐рдП, "user" рдпрджрд┐ рд╕рдореВрд╣ рд╕рдВрдкрддреНрддрд┐ рдиреЗ рдПрдХ рд╕рдореВрд╣ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рд╕рджрд╕реНрдпрддрд╛ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, "rule" рдПрдХ рдирд┐рдпрдо рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рдгреА рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, "evaluate-mechanisms" рдХреЗ рдмрд╛рдж рдПрдХ `mechanisms` рд╕рд░рдгреА рд╣реЛрддреА рд╣реИ рдЬреЛ рдпрд╛ рддреЛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╣реЛрддреА рд╣реИ рдпрд╛ `/System/Library/CoreServices/SecurityAgentPlugins/` рдпрд╛ /Library/Security//SecurityAgentPlugins рдХреЗ рдЕрдВрджрд░ рдПрдХ рдмрдВрдбрд▓ рдХрд╛ рдирд╛рдо рд╣реЛрддрд╛ рд╣реИред
* **group**: рд╕рдореВрд╣-рдЖрдзрд╛рд░рд┐рдд рдЕрдзрд┐рдХреГрдд рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред
* **kofn**: "k-of-n" рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╕реЗ рдХрд┐рддрдиреЗ рдЙрдкрдирд┐рдпрдореЛрдВ рдХреЛ рд╕рдВрддреБрд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
* **timeout**: рдЙрд╕ рдЕрд╡рдзрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдирд┐рдпрдо рджреНрд╡рд╛рд░рд╛ рджреА рдЧрдИ рдЕрдзрд┐рдХреГрдд рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗрдХрдВрдб рдореЗрдВ рд╣реЛрддреА рд╣реИред
* **flags**: рдирд┐рдпрдо рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рднрд┐рдиреНрди рдзреНрд╡рдЬреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред
* **tries**: рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдордд рдЕрдзрд┐рдХреГрдд рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред
* **version**: рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рдЕрдкрдбреЗрдЯ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИред
* **created**: рдСрдбрд┐рдЯрд┐рдВрдЧ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рд╕рдордп рд░рд┐рдХреЙрд░реНрдб рдХрд░рддрд╛ рд╣реИред
* **modified**: рдирд┐рдпрдо рдореЗрдВ рдХрд┐рдП рдЧрдП рдЕрдВрддрд┐рдо рд╕рдВрд╢реЛрдзрди рдХрд╛ рд╕рдордп рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред
* **hash**: рдирд┐рдпрдо рдХреА рдЕрдЦрдВрдбрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдХрд╛ рд╣реИрд╢ рдорд╛рди рд░рдЦрддрд╛ рд╣реИред
* **identifier**: рдирд┐рдпрдо рдХреЗ рд▓рд┐рдП рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрднреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рдЬреИрд╕реЗ UUID, рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
* **requirement**: рдирд┐рдпрдо рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЕрдзрд┐рдХреГрдд рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдФрд░ рддрдВрддреНрд░реЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрдХреНрд░рдорд┐рдд рдбреЗрдЯрд╛ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред
* **comment**: рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдФрд░ рд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдорд╛рдирд╡-рдкрдардиреАрдп рд╡рд┐рд╡рд░рдг рдпрд╛ рдЯрд┐рдкреНрдкрдгреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

### Example
```bash
# List by name and comments
sudo sqlite3 /var/db/auth.db "select name, comment from rules"

# Get rules for com.apple.tcc.util.admin
security authorizationdb read com.apple.tcc.util.admin
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>class</key>
<string>rule</string>
<key>comment</key>
<string>For modification of TCC settings.</string>
<key>created</key>
<real>701369782.01043606</real>
<key>modified</key>
<real>701369782.01043606</real>
<key>rule</key>
<array>
<string>authenticate-admin-nonshared</string>
</array>
<key>version</key>
<integer>0</integer>
</dict>
</plist>
```
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ [https://www.dssw.co.uk/reference/authorization-rights/authenticate-admin-nonshared/](https://www.dssw.co.uk/reference/authorization-rights/authenticate-admin-nonshared/) рдкрд░ `authenticate-admin-nonshared` рдХрд╛ рдЕрд░реНрде рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```json
{
'allow-root' : 'false',
'authenticate-user' : 'true',
'class' : 'user',
'comment' : 'Authenticate as an administrator.',
'group' : 'admin',
'session-owner' : 'false',
'shared' : 'false',
'timeout' : '30',
'tries' : '10000',
'version' : '1'
}
```
## Authd

рдпрд╣ рдПрдХ рдбреЗрдорди рд╣реИ рдЬреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ред рдпрд╣ `XPCServices/` рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдПрдХ XPC рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдиреЗ рд▓реЙрдЧ рдХреЛ `/var/log/authd.log` рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдИ `Security.framework` APIs рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `AuthorizationExecuteWithPrivileges` рдЪрд▓рд╛рддреЗ рд╕рдордп: `security execute-with-privileges /bin/ls`

рдпрд╣ `/usr/libexec/security_authtrampoline /bin/ls` рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдлреЛрд░реНрдХ рдФрд░ рдПрдХреНрд╕реЗрдХ рдХрд░реЗрдЧрд╛, рдЬреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ ls рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рдорд╛рдВрдЧрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░реЙрдореНрдкреНрдЯ рдореЗрдВ рдкреВрдЫреЗрдЧрд╛:

<figure><img src="../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
