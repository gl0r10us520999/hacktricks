# macOS Sandbox

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

MacOS Sandbox (—Å–ø–æ—á–∞—Ç–∫—É –Ω–∞–∑–∏–≤–∞–≤—Å—è Seatbelt) **–æ–±–º–µ–∂—É—î –ø—Ä–æ–≥—Ä–∞–º–∏**, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –¥–æ **–¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –¥—ñ–π, –∑–∞–∑–Ω–∞—á–µ–Ω–∏—Ö —É –ø—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ**, –∑ —è–∫–∏–º –ø—Ä–∞—Ü—é—î –ø—Ä–æ–≥—Ä–∞–º–∞. –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏, —â–æ **–ø—Ä–æ–≥—Ä–∞–º–∞ –±—É–¥–µ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–æ –æ—á—ñ–∫—É–≤–∞–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤**.

–ë—É–¥—å-—è–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑ **–ø—Ä–∞–≤–æ–º** **`com.apple.security.app-sandbox`** –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ. **–ë—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ Apple** –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, —ñ –≤—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –∑ **App Store –º–∞—é—Ç—å —Ü–µ –ø—Ä–∞–≤–æ**. –¢–æ–º—É –∫—ñ–ª—å–∫–∞ –ø—Ä–æ–≥—Ä–∞–º –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.

–©–æ–± –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏, —â–æ –ø—Ä–æ—Ü–µ—Å –º–æ–∂–µ –∞–±–æ –Ω–µ –º–æ–∂–µ —Ä–æ–±–∏—Ç–∏, **–ø—ñ—Å–æ—á–Ω–∏—Ü—è –º–∞—î —Ö—É–∫–∏** –ø—Ä–∞–∫—Ç–∏—á–Ω–æ –≤ –±—É–¥—å-—è–∫—ñ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó, —è–∫—É –ø—Ä–æ—Ü–µ—Å –º–æ–∂–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ (–≤–∫–ª—é—á–∞—é—á–∏ –±—ñ–ª—å—à—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **MACF**. –û–¥–Ω–∞–∫, –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ **–ø—Ä–∞–≤** –ø—Ä–æ–≥—Ä–∞–º–∏, –ø—ñ—Å–æ—á–Ω–∏—Ü—è –º–æ–∂–µ –±—É—Ç–∏ –±—ñ–ª—å—à –ø–æ–±–ª–∞–∂–ª–∏–≤–æ—é –¥–æ –ø—Ä–æ—Ü–µ—Å—É.

–î–µ—è–∫—ñ –≤–∞–∂–ª–∏–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ:

* **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —è–¥—Ä–∞** `/System/Library/Extensions/Sandbox.kext`
* **–ü—Ä–∏–≤–∞—Ç–Ω–∞ —Ä–∞–º–∫–∞** `/System/Library/PrivateFrameworks/AppSandbox.framework`
* **–î–µ–º–æ–Ω**, —â–æ –ø—Ä–∞—Ü—é—î –≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–º—É –ø—Ä–æ—Å—Ç–æ—Ä—ñ `/usr/libexec/sandboxd`
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏** `~/Library/Containers`

### Containers

–ö–æ–∂–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ –º–∞—Ç–∏–º–µ —Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É `~/Library/Containers/{CFBundleIdentifier}` :
```bash
ls -l ~/Library/Containers
total 0
drwx------@ 4 username  staff  128 May 23 20:20 com.apple.AMPArtworkAgent
drwx------@ 4 username  staff  128 May 23 20:13 com.apple.AMPDeviceDiscoveryAgent
drwx------@ 4 username  staff  128 Mar 24 18:03 com.apple.AVConference.Diagnostic
drwx------@ 4 username  staff  128 Mar 25 14:14 com.apple.Accessibility-Settings.extension
drwx------@ 4 username  staff  128 Mar 25 14:10 com.apple.ActionKit.BundledIntentHandler
[...]
```
–í—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–∂–Ω–æ—ó –ø–∞–ø–∫–∏ –∑ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–æ–º –ø–∞–∫–µ—Ç–∞ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **plist** —Ç–∞ **–∫–∞—Ç–∞–ª–æ–≥ –¥–∞–Ω–∏—Ö** –ø—Ä–æ–≥—Ä–∞–º–∏ –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é, —è–∫–∞ —ñ–º—ñ—Ç—É—î –ø–∞–ø–∫—É Home:
```bash
cd /Users/username/Library/Containers/com.apple.Safari
ls -la
total 104
drwx------@   4 username  staff    128 Mar 24 18:08 .
drwx------  348 username  staff  11136 May 23 20:57 ..
-rw-r--r--    1 username  staff  50214 Mar 24 18:08 .com.apple.containermanagerd.metadata.plist
drwx------   13 username  staff    416 Mar 24 18:05 Data

ls -l Data
total 0
drwxr-xr-x@  8 username  staff   256 Mar 24 18:08 CloudKit
lrwxr-xr-x   1 username  staff    19 Mar 24 18:02 Desktop -> ../../../../Desktop
drwx------   2 username  staff    64 Mar 24 18:02 Documents
lrwxr-xr-x   1 username  staff    21 Mar 24 18:02 Downloads -> ../../../../Downloads
drwx------  35 username  staff  1120 Mar 24 18:08 Library
lrwxr-xr-x   1 username  staff    18 Mar 24 18:02 Movies -> ../../../../Movies
lrwxr-xr-x   1 username  staff    17 Mar 24 18:02 Music -> ../../../../Music
lrwxr-xr-x   1 username  staff    20 Mar 24 18:02 Pictures -> ../../../../Pictures
drwx------   2 username  staff    64 Mar 24 18:02 SystemData
drwx------   2 username  staff    64 Mar 24 18:02 tmp
```
{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Å–∏–º–≤–æ–ª—ñ—á–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —ñ—Å–Ω—É—é—Ç—å –¥–ª—è "–≤—Ç–µ—á—ñ" –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ —Ç–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—à–∏—Ö –ø–∞–ø–æ–∫, –¥–æ–¥–∞—Ç–æ–∫ –≤—Å–µ —â–µ –ø–æ–≤–∏–Ω–µ–Ω **–º–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∏** –¥–ª—è —ó—Ö –¥–æ—Å—Ç—É–ø—É. –¶—ñ –¥–æ–∑–≤–æ–ª–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **`.plist`** –≤ `RedirectablePaths`.
{% endhint %}

**`SandboxProfileData`** - —Ü–µ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ CFData, –∑–∞–∫–æ–¥–æ–≤–∞–Ω—ñ –≤ B64.
```bash
# Get container config
## You need FDA to access the file, not even just root can read it
plutil -convert xml1 .com.apple.containermanagerd.metadata.plist -o -

# Binary sandbox profile
<key>SandboxProfileData</key>
<data>
AAAhAboBAAAAAAgAAABZAO4B5AHjBMkEQAUPBSsGPwsgASABHgEgASABHwEf...

# In this file you can find the entitlements:
<key>Entitlements</key>
<dict>
<key>com.apple.MobileAsset.PhishingImageClassifier2</key>
<true/>
<key>com.apple.accounts.appleaccount.fullaccess</key>
<true/>
<key>com.apple.appattest.spi</key>
<true/>
<key>keychain-access-groups</key>
<array>
<string>6N38VWS5BX.ru.keepcoder.Telegram</string>
<string>6N38VWS5BX.ru.keepcoder.TelegramShare</string>
</array>
[...]

# Some parameters
<key>Parameters</key>
<dict>
<key>_HOME</key>
<string>/Users/username</string>
<key>_UID</key>
<string>501</string>
<key>_USER</key>
<string>username</string>
[...]

# The paths it can access
<key>RedirectablePaths</key>
<array>
<string>/Users/username/Downloads</string>
<string>/Users/username/Documents</string>
<string>/Users/username/Library/Calendars</string>
<string>/Users/username/Desktop</string>
<key>RedirectedPaths</key>
<array/>
[...]
```
{% hint style="warning" %}
–í—Å–µ, —â–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è/–º–æ–¥–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è –ø—ñ—Å–æ—á–Ω–∏—Ü–µ—é, –æ—Ç—Ä–∏–º–∞—î **–∞—Ç—Ä–∏–±—É—Ç –∫–∞—Ä–∞–Ω—Ç–∏–Ω—É**. –¶–µ –∑–∞–ø–æ–±—ñ–≥–∞—Ç–∏–º–µ –ø—Ä–æ—Å—Ç–æ—Ä—É –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –∞–∫—Ç–∏–≤—É—é—á–∏ Gatekeeper, —è–∫—â–æ –ø—ñ—Å–æ—á–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞–º–∞–≥–∞—Ç–∏–º–µ—Ç—å—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ —â–æ—Å—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`open`**.
{% endhint %}

## –ü—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ

–ü—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ - —Ü–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏, —è–∫—ñ –≤–∫–∞–∑—É—é—Ç—å, —â–æ –±—É–¥–µ **–¥–æ–∑–≤–æ–ª–µ–Ω–æ/–∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ** –≤ —Ü—ñ–π **–ø—ñ—Å–æ—á–Ω–∏—Ü—ñ**. –í–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å **–ú–æ–≤—É –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ (SBPL)**, —è–∫–∞ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ [**Scheme**](https://en.wikipedia.org/wiki/Scheme\_\(programming\_language\)) –º–æ–≤—ñ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è.

–û—Å—å –ø—Ä–∏–∫–ª–∞–¥:
```scheme
(version 1) ; First you get the version

(deny default) ; Then you shuold indicate the default action when no rule applies

(allow network*) ; You can use wildcards and allow everything

(allow file-read* ; You can specify where to apply the rule
(subpath "/Users/username/")
(literal "/tmp/afile")
(regex #"^/private/etc/.*")
)

(allow mach-lookup
(global-name "com.apple.analyticsd")
)
```
{% hint style="success" %}
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ [**–¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è**](https://reverse.put.as/2011/09/14/apple-sandbox-guide-v1-0/) **—â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ –¥—ñ—ó, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –∞–±–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ.**

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó –ø—Ä–æ—Ñ—ñ–ª—é –Ω–∞–∑–≤–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π –∑–∞–º—ñ–Ω—é—é—Ç—å—Å—è —ó—Ö–Ω—ñ–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –≤ –º–∞—Å–∏–≤—ñ, –≤—ñ–¥–æ–º–æ–º—É dylib —Ç–∞ kext, —â–æ —Ä–æ–±–∏—Ç—å —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é –∫–æ—Ä–æ—Ç—à–æ—é —ñ –≤–∞–∂—á–æ—é –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è.
{% endhint %}

–í–∞–∂–ª–∏–≤—ñ **—Å–∏—Å—Ç–µ–º–Ω—ñ —Å–ª—É–∂–±–∏** —Ç–∞–∫–æ–∂ –ø—Ä–∞—Ü—é—é—Ç—å —É —Å–≤–æ—ó—Ö –≤–ª–∞—Å–Ω–∏—Ö –∫–∞—Å—Ç–æ–º–Ω–∏—Ö **–ø—ñ—Å–æ—á–Ω–∏—Ü—è—Ö**, —Ç–∞–∫–∏—Ö —è–∫ —Å–ª—É–∂–±–∞ `mdnsresponder`. –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ü—ñ –∫–∞—Å—Ç–æ–º–Ω—ñ **–ø—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ** —É:

* **`/usr/share/sandbox`**
* **`/System/Library/Sandbox/Profiles`**
* –Ü–Ω—à—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞ –∞–¥—Ä–µ—Å–æ—é [https://github.com/s7ephen/OSX-Sandbox--Seatbelt--Profiles](https://github.com/s7ephen/OSX-Sandbox--Seatbelt--Profiles).

–î–æ–¥–∞—Ç–∫–∏ –∑ **App Store** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å **–ø—Ä–æ—Ñ—ñ–ª—å** **`/System/Library/Sandbox/Profiles/application.sb`**. –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤ —Ü—å–æ–º—É –ø—Ä–æ—Ñ—ñ–ª—ñ, —è–∫ –ø—Ä–∞–≤–∞, —Ç–∞–∫—ñ —è–∫ **`com.apple.security.network.server`**, –¥–æ–∑–≤–æ–ª—è—é—Ç—å –ø—Ä–æ—Ü–µ—Å—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ä–µ–∂—É.

SIP - —Ü–µ –ø—Ä–æ—Ñ—ñ–ª—å –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –∑–≤–∞–Ω–∏–π platform\_profile —É /System/Library/Sandbox/rootless.conf

### –ü—Ä–∏–∫–ª–∞–¥–∏ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ

–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ –∑ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º –ø—Ä–æ—Ñ—ñ–ª–µ–º –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:
```bash
sandbox-exec -f example.sb /Path/To/The/Application
```
{% tabs %}
{% tab title="touch" %}
{% code title="touch.sb" %}
```scheme
(version 1)
(deny default)
(allow file* (literal "/tmp/hacktricks.txt"))
```
{% endcode %}
```bash
# This will fail because default is denied, so it cannot execute touch
sandbox-exec -f touch.sb touch /tmp/hacktricks.txt
# Check logs
log show --style syslog --predicate 'eventMessage contains[c] "sandbox"' --last 30s
[...]
2023-05-26 13:42:44.136082+0200  localhost kernel[0]: (Sandbox) Sandbox: sandbox-exec(41398) deny(1) process-exec* /usr/bin/touch
2023-05-26 13:42:44.136100+0200  localhost kernel[0]: (Sandbox) Sandbox: sandbox-exec(41398) deny(1) file-read-metadata /usr/bin/touch
2023-05-26 13:42:44.136321+0200  localhost kernel[0]: (Sandbox) Sandbox: sandbox-exec(41398) deny(1) file-read-metadata /var
2023-05-26 13:42:52.701382+0200  localhost kernel[0]: (Sandbox) 5 duplicate reports for Sandbox: sandbox-exec(41398) deny(1) file-read-metadata /var
[...]
```
{% code title="touch2.sb" %}
```scheme
(version 1)
(deny default)
(allow file* (literal "/tmp/hacktricks.txt"))
(allow process* (literal "/usr/bin/touch"))
; This will also fail because:
; 2023-05-26 13:44:59.840002+0200  localhost kernel[0]: (Sandbox) Sandbox: touch(41575) deny(1) file-read-metadata /usr/bin/touch
; 2023-05-26 13:44:59.840016+0200  localhost kernel[0]: (Sandbox) Sandbox: touch(41575) deny(1) file-read-data /usr/bin/touch
; 2023-05-26 13:44:59.840028+0200  localhost kernel[0]: (Sandbox) Sandbox: touch(41575) deny(1) file-read-data /usr/bin
; 2023-05-26 13:44:59.840034+0200  localhost kernel[0]: (Sandbox) Sandbox: touch(41575) deny(1) file-read-metadata /usr/lib/dyld
; 2023-05-26 13:44:59.840050+0200  localhost kernel[0]: (Sandbox) Sandbox: touch(41575) deny(1) sysctl-read kern.bootargs
; 2023-05-26 13:44:59.840061+0200  localhost kernel[0]: (Sandbox) Sandbox: touch(41575) deny(1) file-read-data /
```
{% endcode %}

{% code title="touch3.sb" %}
```scheme
(version 1)
(deny default)
(allow file* (literal "/private/tmp/hacktricks.txt"))
(allow process* (literal "/usr/bin/touch"))
(allow file-read-data (literal "/"))
; This one will work
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è**, –Ω–∞–ø–∏—Å–∞–Ω–µ **Apple**, —è–∫–µ –ø—Ä–∞—Ü—é—î –Ω–∞ **Windows**, **–Ω–µ –º–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∑–∞—Ö–æ–¥—ñ–≤ –±–µ–∑–ø–µ–∫–∏**, —Ç–∞–∫–∏—Ö —è–∫ –ø—ñ—Å–æ—á–Ω–∏—Ü—è –¥–ª—è –¥–æ–¥–∞—Ç–∫—ñ–≤.
{% endhint %}

–ü—Ä–∏–∫–ª–∞–¥–∏ –æ–±—Ö–æ–¥—É:

* [https://lapcatsoftware.com/articles/sandbox-escape.html](https://lapcatsoftware.com/articles/sandbox-escape.html)
* [https://desi-jarvis.medium.com/office365-macos-sandbox-escape-fcce4fa4123c](https://desi-jarvis.medium.com/office365-macos-sandbox-escape-fcce4fa4123c) (–≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑–∞ –º–µ–∂–∞–º–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –Ω–∞–∑–≤–∞ —è–∫–∏—Ö –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `~$`).

### –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ

#### –ß–µ—Ä–µ–∑ –ø—Ä–æ—Ñ—ñ–ª—å

–ú–æ–∂–ª–∏–≤–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —è–∫—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—è –≤–∏–∫–æ–Ω—É—î —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –¥—ñ—è. –î–ª—è —Ü—å–æ–≥–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å:

{% code title="trace.sb" %}
```scheme
(version 1)
(trace /tmp/trace.out)
```
{% endcode %}

–ê –ø–æ—Ç—ñ–º –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ–Ω–∞–π—Ç–µ —â–æ—Å—å, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π –ø—Ä–æ—Ñ—ñ–ª—å:
```bash
sandbox-exec -f /tmp/trace.sb /bin/ls
```
In `/tmp/trace.out` –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –∫–æ–∂–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, —â–æ –≤–∏–∫–æ–Ω—É–≤–∞–ª–∞—Å—è —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –≤–æ–Ω–∞ –≤–∏–∫–ª–∏–∫–∞–ª–∞—Å—è (—Ç–æ–±—Ç–æ, –±–∞–≥–∞—Ç–æ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤).

–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä **`-t`**: `sandbox-exec -t /path/trace.out -p "(version 1)" /bin/ls`

#### –ß–µ—Ä–µ–∑ API

–§—É–Ω–∫—Ü—ñ—è `sandbox_set_trace_path`, –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–∞ `libsystem_sandbox.dylib`, –¥–æ–∑–≤–æ–ª—è—î –≤–∫–∞–∑–∞—Ç–∏ —ñ–º'—è —Ñ–∞–π–ª—É —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è, –∫—É–¥–∏ –±—É–¥—É—Ç—å –∑–∞–ø–∏—Å–∞–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.\
–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –∑—Ä–æ–±–∏—Ç–∏ —â–æ—Å—å –ø–æ–¥—ñ–±–Ω–µ, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ `sandbox_vtrace_enable()` —ñ –æ—Ç—Ä–∏–º–∞–≤—à–∏ –∂—É—Ä–Ω–∞–ª–∏ –ø–æ–º–∏–ª–æ–∫ –∑ –±—É—Ñ–µ—Ä–∞, –≤–∏–∫–ª–∏–∫–∞–≤—à–∏ `sandbox_vtrace_report()`.

### –Ü–Ω—Å–ø–µ–∫—Ü—ñ—è –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ

`libsandbox.dylib` –µ–∫—Å–ø–æ—Ä—Ç—É—î —Ñ—É–Ω–∫—Ü—ñ—é –ø—ñ–¥ –Ω–∞–∑–≤–æ—é sandbox\_inspect\_pid, —è–∫–∞ –Ω–∞–¥–∞—î —Å–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω—É –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ –ø—Ä–æ—Ü–µ—Å—É (–≤–∫–ª—é—á–∞—é—á–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è). –û–¥–Ω–∞–∫ –ª–∏—à–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é.

### –ü—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ MacOS —Ç–∞ iOS

MacOS –∑–±–µ—Ä—ñ–≥–∞—î —Å–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ —É –¥–≤–æ—Ö –º—ñ—Å—Ü—è—Ö: **/usr/share/sandbox/** —Ç–∞ **/System/Library/Sandbox/Profiles**.

–Ü —è–∫—â–æ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –¥–æ–¥–∞—Ç–æ–∫ –º–∞—î –ø—Ä–∞–≤–æ _**com.apple.security.app-sandbox**_, —Å–∏—Å—Ç–µ–º–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î –ø—Ä–æ—Ñ—ñ–ª—å **/System/Library/Sandbox/Profiles/application.sb** –¥–æ —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É.

–í iOS –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø—Ä–æ—Ñ—ñ–ª—å –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è **container** —ñ –º–∏ –Ω–µ –º–∞—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è SBPL. –£ –ø–∞–º'—è—Ç—ñ —Ü—è –ø—ñ—Å–æ—á–Ω–∏—Ü—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —è–∫ –±—ñ–Ω–∞—Ä–Ω–µ –¥–µ—Ä–µ–≤–æ Allow/Deny –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –∑ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π SBPL —É –¥–æ–¥–∞—Ç–∫–∞—Ö App Store

–ú–æ–∂–ª–∏–≤–æ, —â–æ –∫–æ–º–ø–∞–Ω—ñ—ó –º–æ–∂—É—Ç—å –∑–º—É—Å–∏—Ç–∏ —Å–≤–æ—ó –¥–æ–¥–∞—Ç–∫–∏ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ **–∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–º–∏ –ø—Ä–æ—Ñ—ñ–ª—è–º–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ** (–∑–∞–º—ñ—Å—Ç—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º). –í–æ–Ω–∏ –ø–æ–≤–∏–Ω–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–æ **`com.apple.security.temporary-exception.sbpl`**, —è–∫–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏ Apple.

–ú–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø—Ä–∞–≤–∞ –≤ **`/System/Library/Sandbox/Profiles/application.sb:`**
```scheme
(sandbox-array-entitlement
"com.apple.security.temporary-exception.sbpl"
(lambda (string)
(let* ((port (open-input-string string)) (sbpl (read port)))
(with-transparent-redirection (eval sbpl)))))
```
–¶–µ **–æ—Ü—ñ–Ω–∏—Ç—å —Ä—è–¥–æ–∫ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –ø—Ä–∞–≤–∞** —è–∫ –ø—Ä–æ—Ñ—ñ–ª—å Sandbox.

### –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è —Ç–∞ –¥–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—é Sandbox

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç **`sandbox-exec`** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—ó `sandbox_compile_*` –∑ `libsandbox.dylib`. –û—Å–Ω–æ–≤–Ω—ñ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: `sandbox_compile_file` (–æ—á—ñ–∫—É—î —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É, –ø–∞—Ä–∞–º–µ—Ç—Ä `-f`), `sandbox_compile_string` (–æ—á—ñ–∫—É—î —Ä—è–¥–æ–∫, –ø–∞—Ä–∞–º–µ—Ç—Ä `-p`), `sandbox_compile_name` (–æ—á—ñ–∫—É—î –Ω–∞–∑–≤—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä `-n`), `sandbox_compile_entitlements` (–æ—á—ñ–∫—É—î plist –ø—Ä–∞–≤).

–¶—è —Ä–µ–≤–µ—Ä—Å–æ–≤–∞–Ω–∞ —Ç–∞ [**–≤—ñ–¥–∫—Ä–∏—Ç–∞ –≤–µ—Ä—Å—ñ—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É sandbox-exec**](https://newosxbook.com/src.jl?tree=listings\&file=/sandbox\_exec.c) –¥–æ–∑–≤–æ–ª—è—î **`sandbox-exec`** –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å sandbox —É —Ñ–∞–π–ª.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —â–æ–± –æ–±–º–µ–∂–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –≤—ñ–Ω –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `sandbox_spawnattrs_set[container/profilename]` —ñ –ø–µ—Ä–µ–¥–∞—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–±–æ –≤–∂–µ —ñ—Å–Ω—É—é—á–∏–π –ø—Ä–æ—Ñ—ñ–ª—å.

## –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ –æ–±—Ö—ñ–¥ Sandbox

–ù–∞ macOS, –Ω–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ iOS, –¥–µ –ø—Ä–æ—Ü–µ—Å–∏ –∑ —Å–∞–º–æ–≥–æ –ø–æ—á–∞—Ç–∫—É —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ —è–¥—Ä–æ–º, **–ø—Ä–æ—Ü–µ—Å–∏ –ø–æ–≤–∏–Ω–Ω—ñ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ —É—á–∞—Å—Ç—å —É sandbox**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –Ω–∞ macOS –ø—Ä–æ—Ü–µ—Å –Ω–µ –æ–±–º–µ–∂—É—î—Ç—å—Å—è sandbox, –ø–æ–∫–∏ –≤—ñ–Ω –∞–∫—Ç–∏–≤–Ω–æ –Ω–µ –≤–∏—Ä—ñ—à–∏—Ç—å —É–≤—ñ–π—Ç–∏ –≤ –Ω—å–æ–≥–æ, —Ö–æ—á–∞ –ø—Ä–æ–≥—Ä–∞–º–∏ –∑ App Store –∑–∞–≤–∂–¥–∏ —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ.

–ü—Ä–æ—Ü–µ—Å–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–∑–æ–ª—é—é—Ç—å—Å—è –∑ userland, –∫–æ–ª–∏ –≤–æ–Ω–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è, —è–∫—â–æ —É –Ω–∏—Ö —î –ø—Ä–∞–≤–æ: `com.apple.security.app-sandbox`. –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –¥–∏–≤—ñ—Ç—å—Å—è:

{% content-ref url="macos-sandbox-debug-and-bypass/" %}
[macos-sandbox-debug-and-bypass](macos-sandbox-debug-and-bypass/)
{% endcontent-ref %}

## **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è Sandbox**

–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª—è—é—Ç—å –Ω–∞–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –æ–±'—î–∫—Ç—É —ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –æ–¥–Ω—É –∑ —Ñ—É–Ω–∫—Ü—ñ–π:

* `sandbox_issue_extension`
* `sandbox_extension_issue_file[_with_new_type]`
* `sandbox_extension_issue_mach`
* `sandbox_extension_issue_iokit_user_client_class`
* `sandbox_extension_issue_iokit_registry_rentry_class`
* `sandbox_extension_issue_generic`
* `sandbox_extension_issue_posix_ipc`

–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–º—É —Å–ª–æ—Ç—ñ –º—ñ—Ç–∫–∏ MACF, –¥–æ—Å—Ç—É–ø–Ω–æ–º—É –∑ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—É. –ù–∞—Å—Ç—É–ø–Ω–∏–π **`sbtool`** –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ü—ñ—î—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∑–∞–∑–≤–∏—á–∞–π –Ω–∞–¥–∞—é—Ç—å—Å—è –¥–æ–∑–≤–æ–ª–µ–Ω–∏–º–∏ –ø—Ä–æ—Ü–µ—Å–∞–º–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `tccd` –Ω–∞–¥–∞—Å—Ç—å —Ç–æ–∫–µ–Ω —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è `com.apple.tcc.kTCCServicePhotos`, –∫–æ–ª–∏ –ø—Ä–æ—Ü–µ—Å –Ω–∞–º–∞–≥–∞–≤—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π —ñ –æ—Ç—Ä–∏–º–∞–≤ –¥–æ–∑–≤—ñ–ª —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ XPC. –¢–æ–¥—ñ –ø—Ä–æ—Ü–µ—Å—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ —Å–ø–æ–∂–∏—Ç–∏ —Ç–æ–∫–µ–Ω —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è, —â–æ–± –≤—ñ–Ω –±—É–≤ –¥–æ–¥–∞–Ω–∏–π –¥–æ –Ω—å–æ–≥–æ.\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ç–æ–∫–µ–Ω–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —î –¥–æ–≤–≥–∏–º–∏ —à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–∏–º–∏ —á–∏—Å–ª–∞–º–∏, —è–∫—ñ –∫–æ–¥—É—é—Ç—å –Ω–∞–¥–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏. –û–¥–Ω–∞–∫ —É –Ω–∏—Ö –Ω–µ–º–∞—î –∂–æ—Ä—Å—Ç–∫–æ –∑–∞–∫–æ–¥–æ–≤–∞–Ω–æ–≥–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ–≥–æ PID, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –±—É–¥—å-—è–∫–∏–π –ø—Ä–æ—Ü–µ—Å –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —Ç–æ–∫–µ–Ω–∞ –º–æ–∂–µ –±—É—Ç–∏ **—Å–ø–æ–∂–∏—Ç–∏–π –∫—ñ–ª—å–∫–æ–º–∞ –ø—Ä–æ—Ü–µ—Å–∞–º–∏**.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥—É–∂–µ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –ø—Ä–∞–≤–∞–º–∏, —Ç–æ–º—É –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–µ–≤–Ω–∏—Ö –ø—Ä–∞–≤ –º–æ–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥–∞–≤–∞—Ç–∏ –ø–µ–≤–Ω—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è.

### **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ PID**

[**–ó–≥—ñ–¥–Ω–æ –∑ —Ü–∏–º**](https://www.youtube.com/watch?v=mG715HcDgO8\&t=3011s), —Ñ—É–Ω–∫—Ü—ñ—ó **`sandbox_check`** (—Ü–µ `__mac_syscall`), –º–æ–∂—É—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ **—á–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è —á–∏ –Ω—ñ** sandbox —É –ø–µ–≤–Ω–æ–º—É PID, —Ç–æ–∫–µ–Ω—ñ –∞—É–¥–∏—Ç—É –∞–±–æ —É–Ω—ñ–∫–∞–ª—å–Ω–æ–º—É ID.

[**–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç sbtool**](http://newosxbook.com/src.jl?tree=listings\&file=sbtool.c) (–∑–Ω–∞–π–¥—ñ—Ç—å –π–æ–≥–æ [—Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–º —Ç—É—Ç](https://newosxbook.com/articles/hitsb.html)) –º–æ–∂–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–µ PID –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ–≤–Ω—ñ –¥—ñ—ó:
```bash
sbtool <pid> mach #Check mac-ports (got from launchd with an api)
sbtool <pid> file /tmp #Check file access
sbtool <pid> inspect #Gives you an explanation of the sandbox profile and extensions
sbtool <pid> all
```
### \[un]suspend

–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –ø—Ä–∏–∑—É–ø–∏–Ω–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—ó `sandbox_suspend` —Ç–∞ `sandbox_unsuspend` –∑ `libsystem_sandbox.dylib`.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∏–∑—É–ø–∏–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –¥–µ—è–∫—ñ –ø—Ä–∞–≤–∞, —â–æ–± –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏ –≤–∏–∫–ª–∏–∫, —Ç–∞–∫—ñ —è–∫:

* com.apple.private.security.sandbox-manager
* com.apple.security.print
* com.apple.security.temporary-exception.audio-unit-host

## mac\_syscall

–¶–µ–π —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫ (#381) –æ—á—ñ–∫—É—î –æ–¥–∏–Ω —Ä—è–¥–æ–∫ —è–∫ –ø–µ—Ä—à–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç, —è–∫–∏–π –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –º–æ–¥—É–ª—å –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –∞ –ø–æ—Ç—ñ–º –∫–æ–¥ —É –¥—Ä—É–≥–æ–º—É –∞—Ä–≥—É–º–µ–Ω—Ç—ñ, —è–∫–∏–π –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –¢—Ä–µ—Ç—ñ–π –∞—Ä–≥—É–º–µ–Ω—Ç –∑–∞–ª–µ–∂–∞—Ç–∏–º–µ –≤—ñ–¥ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó.

–í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó `___sandbox_ms` –æ–±–≥–æ—Ä—Ç–∞—î `mac_syscall`, –≤–∫–∞–∑—É—é—á–∏ –≤ –ø–µ—Ä—à–æ–º—É –∞—Ä–≥—É–º–µ–Ω—Ç—ñ `"Sandbox"`, —Ç–∞–∫ —Å–∞–º–æ —è–∫ `___sandbox_msp` —î –æ–±–≥–æ—Ä—Ç–∫–æ—é –¥–ª—è `mac_set_proc` (#387). –î–∞–ª—ñ –¥–µ—è–∫—ñ –∑ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏—Ö –∫–æ–¥—ñ–≤ `___sandbox_ms` –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ —Ü—ñ–π —Ç–∞–±–ª–∏—Ü—ñ:

* **set\_profile (#0)**: –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∞–±–æ –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å –¥–æ –ø—Ä–æ—Ü–µ—Å—É.
* **platform\_policy (#1)**: –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏, —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ (–≤–∞—Ä—ñ—é—î—Ç—å—Å—è –º—ñ–∂ macOS —Ç–∞ iOS).
* **check\_sandbox (#2)**: –í–∏–∫–æ–Ω–∞—Ç–∏ —Ä—É—á–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **note (#3)**: –î–æ–¥–∞—Ç–∏ –∞–Ω–æ—Ç–∞—Ü—ñ—é –¥–æ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **container (#4)**: –ü—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ –∞–Ω–æ—Ç–∞—Ü—ñ—é –¥–æ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –∑–∞–∑–≤–∏—á–∞–π –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –∞–±–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
* **extension\_issue (#5)**: –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è –ø—Ä–æ—Ü–µ—Å—É.
* **extension\_consume (#6)**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–∞–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è.
* **extension\_release (#7)**: –í–∏–≤—ñ–ª—å–Ω–∏—Ç–∏ –ø–∞–º'—è—Ç—å, –ø–æ–≤'—è–∑–∞–Ω—É –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–º —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º.
* **extension\_update\_file (#8)**: –ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —ñ—Å–Ω—É—é—á–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É –≤ –º–µ–∂–∞—Ö –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **extension\_twiddle (#9)**: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ —ñ—Å–Ω—É—é—á–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, TextEdit, rtf, rtfd).
* **suspend (#10)**: –¢–∏–º—á–∞—Å–æ–≤–æ –ø—Ä–∏–∑—É–ø–∏–Ω–∏—Ç–∏ –≤—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ (–≤–∏–º–∞–≥–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –ø—Ä–∞–≤).
* **unsuspend (#11)**: –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –≤—Å—ñ —Ä–∞–Ω—ñ—à–µ –ø—Ä–∏–∑—É–ø–∏–Ω–µ–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **passthrough\_access (#12)**: –î–æ–∑–≤–æ–ª–∏—Ç–∏ –ø—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—É, –æ–±—Ö–æ–¥—è—á–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **set\_container\_path (#13)**: (—Ç—ñ–ª—å–∫–∏ iOS) –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —à–ª—è—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –≥—Ä—É–ø–∏ –¥–æ–¥–∞—Ç–∫—ñ–≤ –∞–±–æ ID –ø—ñ–¥–ø–∏—Å—É.
* **container\_map (#14)**: (—Ç—ñ–ª—å–∫–∏ iOS) –û—Ç—Ä–∏–º–∞—Ç–∏ —à–ª—è—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ `containermanagerd`.
* **sandbox\_user\_state\_item\_buffer\_send (#15)**: (iOS 10+) –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ —Ä–µ–∂–∏–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **inspect (#16)**: –ù–∞–¥–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ—Ü–µ—Å, —â–æ –ø—Ä–∞—Ü—é—î –≤ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **dump (#18)**: (macOS 11) –í–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É.
* **vtrace (#19)**: –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–±–æ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.
* **builtin\_profile\_deactivate (#20)**: (macOS < 11) –î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –Ω–∞–∑–≤–∞–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `pe_i_can_has_debugger`).
* **check\_bulk (#21)**: –í–∏–∫–æ–Ω–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π `sandbox_check` –≤ –æ–¥–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É.
* **reference\_retain\_by\_audit\_token (#28)**: –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞—Ö –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ.
* **reference\_release (#29)**: –í–∏–≤—ñ–ª—å–Ω–∏—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∑–±–µ—Ä–µ–∂–µ–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–∏–π —Ç–æ–∫–µ–Ω.
* **rootless\_allows\_task\_for\_pid (#30)**: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–æ `task_for_pid` (—Å—Ö–æ–∂–µ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `csr`).
* **rootless\_whitelist\_push (#31)**: (macOS) –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ–∞–π–ª –º–∞–Ω—ñ—Ñ–µ—Å—Ç—É —Å–∏—Å—Ç–µ–º–Ω–æ—ó —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ (SIP).
* **rootless\_whitelist\_check (preflight) (#32)**: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ–∞–π–ª –º–∞–Ω—ñ—Ñ–µ—Å—Ç—É SIP –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º.
* **rootless\_protected\_volume (#33)**: (macOS) –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ SIP –∑–∞—Ö–∏—Å—Ç–∏ –¥–æ –¥–∏—Å–∫–∞ –∞–±–æ —Ä–æ–∑–¥—ñ–ª—É.
* **rootless\_mkdir\_protected (#34)**: –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ SIP/DataVault –∑–∞—Ö–∏—Å—Ç –¥–æ –ø—Ä–æ—Ü–µ—Å—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ç–∞–ª–æ–≥—É.

## Sandbox.kext

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ iOS —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —è–¥—Ä–∞ –º—ñ—Å—Ç–∏—Ç—å **–∂–æ—Ä—Å—Ç–∫–æ –∑–∞–∫–æ–¥–æ–≤–∞–Ω—ñ –≤—Å—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ–≥–º–µ–Ω—Ç–∞ `__TEXT.__const`, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —ó—Ö –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –ù–∞—Å—Ç—É–ø–Ω—ñ —î –¥–µ—è–∫–∏–º–∏ —Ü—ñ–∫–∞–≤–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —è–¥—Ä–∞:

* **`hook_policy_init`**: –í—ñ–Ω –ø—ñ–¥–∫–ª—é—á–∞—î `mpo_policy_init` —ñ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è `mac_policy_register`. –í—ñ–Ω –≤–∏–∫–æ–Ω—É—î –±—ñ–ª—å—à—ñ—Å—Ç—å —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ. –í—ñ–Ω —Ç–∞–∫–æ–∂ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î SIP.
* **`hook_policy_initbsd`**: –ù–∞–ª–∞—à—Ç–æ–≤—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å sysctl, —Ä–µ—î—Å—Ç—Ä—É—é—á–∏ `security.mac.sandbox.sentinel`, `security.mac.sandbox.audio_active` —Ç–∞ `security.mac.sandbox.debug_mode` (—è–∫—â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ `PE_i_can_has_debugger`).
* **`hook_policy_syscall`**: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `mac_syscall` –∑ "Sandbox" —è–∫ –ø–µ—Ä—à–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç —ñ –∫–æ–¥–æ–º, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—é, —É –¥—Ä—É–≥–æ–º—É. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä switch –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–æ–¥—É –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –∑–∞–ø–∏—Ç—É–≤–∞–Ω–æ–≥–æ –∫–æ–¥—É.

### MACF Hooks

**`Sandbox.kext`** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±—ñ–ª—å—à–µ —Å—Ç–∞ —Ö—É–∫—ñ–≤ —á–µ—Ä–µ–∑ MACF. –ë—ñ–ª—å—à—ñ—Å—Ç—å —Ö—É–∫—ñ–≤ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å –¥–µ—è–∫—ñ —Ç—Ä–∏–≤—ñ–∞–ª—å–Ω—ñ –≤–∏–ø–∞–¥–∫–∏, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥—ñ—é, —è–∫—â–æ –Ω—ñ, –≤–æ–Ω–∏ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å **`cred_sb_evalutate`** –∑ **–æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏** –∑ MACF —Ç–∞ –Ω–æ–º–µ—Ä–æ–º, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î **–æ–ø–µ—Ä–∞—Ü—ñ—ó**, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏, —ñ **–±—É—Ñ–µ—Ä–æ–º** –¥–ª—è –≤–∏—Ö–æ–¥—É.

–î–æ–±—Ä–∏–º –ø—Ä–∏–∫–ª–∞–¥–æ–º —Ü—å–æ–≥–æ —î —Ñ—É–Ω–∫—Ü—ñ—è **`_mpo_file_check_mmap`**, —è–∫–∞ –ø—ñ–¥–∫–ª—é—á–∏–ª–∞ **`mmap`** —ñ —è–∫–∞ –ø–æ—á–Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏, —á–∏ –±—É–¥–µ –Ω–æ–≤–∞ –ø–∞–º'—è—Ç—å –∑–∞–ø–∏—Å—É–≤–∞–Ω–æ—é (—ñ —è–∫—â–æ –Ω—ñ, –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è), –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å, —á–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–æ–Ω–∞ –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ –∫–µ—à—É dyld, —ñ —è–∫—â–æ —Ç–∞–∫, –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –∞ –Ω–∞—Ä–µ—à—Ç—ñ –≤–∏–∫–ª–∏—á–µ **`sb_evaluate_internal`** (–∞–±–æ –æ–¥–Ω—É –∑ –π–æ–≥–æ –æ–±–≥–æ—Ä—Ç–æ–∫) –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ–¥–∞–ª—å—à–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –¥–æ–∑–≤–æ–ª—É.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –∑ —Å–æ—Ç–µ–Ω—å —Ö—É–∫—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—ñ—Å–æ—á–Ω–∏—Ü—è, —î 3, —è–∫—ñ –æ—Å–æ–±–ª–∏–≤–æ —Ü—ñ–∫–∞–≤—ñ:

* `mpo_proc_check_for`: –ó–∞—Å—Ç–æ—Å–æ–≤—É—î –ø—Ä–æ—Ñ—ñ–ª—å, —è–∫—â–æ —Ü–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ, —ñ —è–∫—â–æ –≤—ñ–Ω –Ω–µ –±—É–≤ —Ä–∞–Ω—ñ—à–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∏–π.
* `mpo_vnode_check_exec`: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –ø—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é, –∞ —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –∑–∞–±–æ—Ä–æ–Ω—è—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è SUID/SGID.
* `mpo_cred_label_update_execve`: –¶–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –º—ñ—Ç–∫–∞. –¶–µ –Ω–∞–π–¥–æ–≤—à–∏–π, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π, –∞–ª–µ —â–µ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–∏–π. –í—ñ–Ω –≤–∏–∫–æ–Ω–∞—î –¥—ñ—ó, —Ç–∞–∫—ñ —è–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ, –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø—ñ—Å–æ—á–Ω–∏—Ü—ñ –¥–æ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö kauth, –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ mach –ø–æ—Ä—Ç—ñ–≤...

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **`_cred_sb_evalutate`** —î –æ–±–≥–æ—Ä—Ç–∫–æ—é –Ω–∞–¥ **`sb_evaluate_internal`**, —ñ —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –æ—Ç—Ä–∏–º—É—î –ø–µ—Ä–µ–¥–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—î –æ—Ü—ñ–Ω–∫—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—é **`eval`**, —è–∫–∞ –∑–∞–∑–≤–∏—á–∞–π –æ—Ü—ñ–Ω—é—î **–ø—Ä–æ—Ñ—ñ–ª—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏**, —è–∫–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –≤—Å—ñ—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, –∞ –ø–æ—Ç—ñ–º **—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å –ø—Ä–æ—Ü–µ—Å—É**. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –ø—Ä–æ—Ñ—ñ–ª—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ —î –æ–¥–Ω–∏–º –∑ –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ **SIP** –≤ macOS.

## Sandboxd

–ü—ñ—Å–æ—á–Ω–∏—Ü—è —Ç–∞–∫–æ–∂ –º–∞—î –¥–µ–º–æ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –ø—Ä–∞—Ü—é—î, –≤—ñ–¥–∫—Ä–∏–≤–∞—é—á–∏ XPC Mach —Å–µ—Ä–≤—ñ—Å `com.apple.sandboxd` —ñ –ø—Ä–∏–≤'—è–∑—É—é—á–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –ø–æ—Ä—Ç 14 (`HOST_SEATBELT_PORT`), —è–∫–∏–π —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —è–¥—Ä–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–ª—è –∑–≤'—è–∑–∫—É –∑ –Ω–∏–º. –í—ñ–Ω –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ MIG.

## References

* [**\*OS Internals Volume III**](https://newosxbook.com/home.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
