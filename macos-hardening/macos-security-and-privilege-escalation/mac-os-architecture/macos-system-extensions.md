# macOS рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}

## рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди / рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪрд╛

рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╡рд┐рдкрд░реАрдд, **рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ** рди рдХрд┐ рдХрд░реНрдиреЗрд▓ рд╕реНрдерд╛рди рдореЗрдВ, рдЬрд┐рд╕рд╕реЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдЦрд░рд╛рдмреА рдХреЗ рдХрд╛рд░рдг рд╕рд┐рд╕реНрдЯрдо рдХреНрд░реИрд╢ рдХрд╛ рдЬреЛрдЦрд┐рдо рдХрдо рд╣реЛрддрд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (606).png" alt="https://knight.sc/images/system-extension-internals-1.png"><figcaption></figcaption></figure>

рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рддреАрди рдкреНрд░рдХрд╛рд░ рд╣реИрдВ: **DriverKit** рдПрдХреНрд╕рдЯреЗрдВрд╢рди, **Network** рдПрдХреНрд╕рдЯреЗрдВрд╢рди, рдФрд░ **Endpoint Security** рдПрдХреНрд╕рдЯреЗрдВрд╢рдиред

### **DriverKit рдПрдХреНрд╕рдЯреЗрдВрд╢рди**

DriverKit рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХрд╛ рдПрдХ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рд╣реИ рдЬреЛ **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕рдорд░реНрдерди** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдбрд┐рд╡рд╛рдЗрд╕ рдбреНрд░рд╛рдЗрд╡рд░реЛрдВ (рдЬреИрд╕реЗ USB, Serial, NIC, рдФрд░ HID рдбреНрд░рд╛рдЗрд╡рд░) рдХреЛ рдХрд░реНрдиреЗрд▓ рд╕реНрдерд╛рди рдХреЗ рдмрдЬрд╛рдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред DriverKit рдврд╛рдВрдЪрд╛ **рдХреБрдЫ I/O рдХрд┐рдЯ рд╡рд░реНрдЧреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ** рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдХрд░реНрдиреЗрд▓ рд╕рд╛рдорд╛рдиреНрдп I/O рдХрд┐рдЯ рдШрдЯрдирд╛рдУрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдореЗрдВ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрди рдбреНрд░рд╛рдЗрд╡рд░реЛрдВ рдХреЗ рдЪрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдкреНрд░рджрд╛рди рд╣реЛрддрд╛ рд╣реИред

### **Network рдПрдХреНрд╕рдЯреЗрдВрд╢рди**

Network рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдиреЗрдЯрд╡рд░реНрдХ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред Network рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдХрдИ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

* **рдРрдк рдкреНрд░реЙрдХреНрд╕реА**: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ VPN рдХреНрд▓рд╛рдЗрдВрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдкреНрд░рд╡рд╛рд╣-рдЙрдиреНрдореБрдЦ, рдХрд╕реНрдЯрдо VPN рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдХрдиреЗрдХреНрд╢рдиреЛрдВ (рдпрд╛ рдкреНрд░рд╡рд╛рд╣реЛрдВ) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИ рди рдХрд┐ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкреИрдХреЗрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред
* **рдкреИрдХреЗрдЯ рдЯрдирд▓**: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ VPN рдХреНрд▓рд╛рдЗрдВрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдкреИрдХреЗрдЯ-рдЙрдиреНрдореБрдЦ, рдХрд╕реНрдЯрдо VPN рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкреИрдХреЗрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред
* **рдбреЗрдЯрд╛ рдлрд╝рд┐рд▓реНрдЯрд░**: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдЯрд╡рд░реНрдХ "рдкреНрд░рд╡рд╛рд╣реЛрдВ" рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рд╡рд╛рд╣ рд╕реНрддрд░ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдбреЗрдЯрд╛ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдпрд╛ рд╕рдВрд╢реЛрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **рдкреИрдХреЗрдЯ рдлрд╝рд┐рд▓реНрдЯрд░**: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдкреИрдХреЗрдЯ рд╕реНрддрд░ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдбреЗрдЯрд╛ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдпрд╛ рд╕рдВрд╢реЛрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* **DNS рдкреНрд░реЙрдХреНрд╕реА**: рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдХрд╕реНрдЯрдо DNS рдкреНрд░рджрд╛рддрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ DNS рдЕрдиреБрд░реЛрдзреЛрдВ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдпрд╛ рд╕рдВрд╢реЛрдзрди рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪрд╛

рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдПрдХ рдврд╛рдВрдЪрд╛ рд╣реИ рдЬреЛ Apple рджреНрд╡рд╛рд░рд╛ macOS рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП API рдХрд╛ рдПрдХ рд╕реЗрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдХреНрд░реЗрддрд╛рдУрдВ рдФрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрд╛рдж рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдЬрд╛ рд╕рдХреЗред

рдпрд╣ рдврд╛рдВрдЪрд╛ **рд╕рд┐рд╕реНрдЯрдо рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП API рдХрд╛ рдПрдХ рд╕рдВрдЧреНрд░рд╣** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рд╖реНрдкрд╛рджрди, рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдгрд╛рд▓реА рдШрдЯрдирд╛рдПрдБ, рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рдХрд░реНрдиреЗрд▓ рдШрдЯрдирд╛рдПрдБред

рдЗрд╕ рдврд╛рдВрдЪреЗ рдХрд╛ рдореБрдЦреНрдп рднрд╛рдЧ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдХ рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди (KEXT) рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛ **`/System/Library/Extensions/EndpointSecurity.kext`** рдкрд░ рд╕реНрдерд┐рдд рд╣реИред рдпрд╣ KEXT рдХрдИ рдкреНрд░рдореБрдЦ рдШрдЯрдХреЛрдВ рд╕реЗ рдмрдирд╛ рд╣реИ:

* **EndpointSecurityDriver**: рдпрд╣ рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП "рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ" рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рдпрд╣ OS рдФрд░ Endpoint Security рдврд╛рдВрдЪреЗ рдХреЗ рдмреАрдЪ рдмрд╛рддрдЪреАрдд рдХрд╛ рдореБрдЦреНрдп рдмрд┐рдВрджреБ рд╣реИред
* **EndpointSecurityEventManager**: рдпрд╣ рдШрдЯрдХ рдХрд░реНрдиреЗрд▓ рд╣реБрдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред рдХрд░реНрдиреЗрд▓ рд╣реБрдХ рдврд╛рдВрдЪреЗ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдХреЗ рд╕рд┐рд╕реНрдЯрдо рдШрдЯрдирд╛рдУрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред
* **EndpointSecurityClientManager**: рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВ рдФрд░ рдЬрд┐рдиреНрд╣реЗрдВ рдШрдЯрдирд╛ рд╕реВрдЪрдирд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
* **EndpointSecurityMessageManager**: рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рд╕рдВрджреЗрд╢ рдФрд░ рдШрдЯрдирд╛ рд╕реВрдЪрдирд╛рдПрдБ рднреЗрдЬрддрд╛ рд╣реИред

рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪрд╛ рдЬрд┐рди рдШрдЯрдирд╛рдУрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

* рдлрд╝рд╛рдЗрд▓ рдШрдЯрдирд╛рдПрдБ
* рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдШрдЯрдирд╛рдПрдБ
* рд╕реЙрдХреЗрдЯ рдШрдЯрдирд╛рдПрдБ
* рдХрд░реНрдиреЗрд▓ рдШрдЯрдирд╛рдПрдБ (рдЬреИрд╕реЗ рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд▓реЛрдб/рдЕрдирд▓реЛрдб рдХрд░рдирд╛ рдпрд╛ I/O рдХрд┐рдЯ рдбрд┐рд╡рд╛рдЗрд╕ рдЦреЛрд▓рдирд╛)

### рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪреЗ рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛

<figure><img src="../../../.gitbook/assets/image (1068).png" alt="https://www.youtube.com/watch?v=jaVkpM1UqOs"><figcaption></figcaption></figure>

рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪреЗ рдХреЗ рд╕рд╛рде **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд╕реНрдерд╛рди рд╕рдВрдЪрд╛рд░** IOUserClient рд╡рд░реНрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИред рдХреЙрд▓рд░ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЙрдкрд╡рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

* **EndpointSecurityDriverClient**: рдЗрд╕рдХреЗ рд▓рд┐рдП `com.apple.private.endpoint-security.manager` рдЕрдзрд┐рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ `endpointsecurityd` рдХреЗ рдкрд╛рд╕ рд╣реЛрддреА рд╣реИред
* **EndpointSecurityExternalClient**: рдЗрд╕рдХреЗ рд▓рд┐рдП `com.apple.developer.endpoint-security.client` рдЕрдзрд┐рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдорддреМрд░ рдкрд░ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд┐рд╕реЗ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдврд╛рдВрдЪреЗ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди:**`libEndpointSecurity.dylib`** рд╡рд╣ C рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд░реНрдиреЗрд▓ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ KEXT рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП I/O рдХрд┐рдЯ (`IOKit`) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИред

**`endpointsecurityd`** рдПрдХ рдкреНрд░рдореБрдЦ рд╕рд┐рд╕реНрдЯрдо рдбреЗрдореЙрди рд╣реИ рдЬреЛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдмреВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рдиред **рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдирдХреЗ `Info.plist` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **`NSEndpointSecurityEarlyBoot`** рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдмреВрдЯ рдЙрдкрдЪрд╛рд░ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред

рдПрдХ рдЕрдиреНрдп рд╕рд┐рд╕реНрдЯрдо рдбреЗрдореЙрди, **`sysextd`**, **рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХреЛ рдорд╛рдиреНрдп рдХрд░рддрд╛ рд╣реИ** рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдЪрд┐рдд рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдлрд┐рд░ рдпрд╣ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдореЙрди рд╕реЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддрд╛ рд╣реИред **`SystemExtensions.framework`** рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХреЛ рд╕рдХреНрд░рд┐рдп рдФрд░ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред

## ESF рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛

ESF рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рд░реЗрдб рдЯреАрдорд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЛ рдХреИрд╕реЗ рдЯрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдХреЛрдИ рднреА рдЬрд╛рдирдХрд╛рд░реА рджрд┐рд▓рдЪрд╕реНрдк рд▓рдЧрддреА рд╣реИред

### CVE-2021-30965

рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ **рдкреВрд░реНрдг рдбрд┐рд╕реНрдХ рдПрдХреНрд╕реЗрд╕ рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рдЪрд▓рдиреЗ рд╕реЗ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИ:
```bash
tccutil reset All
```
For **рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА** about this bypass and related ones check the talk [#OBTS v5.0: "The Achilles Heel of EndpointSecurity" - Fitzl Csaba](https://www.youtube.com/watch?v=lQO7tvNCoTI)

At the end this was fixed by giving the new permission **`kTCCServiceEndpointSecurityClient`** to the security app managed by **`tccd`** so `tccutil` won't clear its permissions preventing it from running.

## References

* [**OBTS v3.0: "Endpoint Security & Insecurity" - Scott Knight**](https://www.youtube.com/watch?v=jaVkpM1UqOs)
* [**https://knight.sc/reverse%20engineering/2019/08/24/system-extension-internals.html**](https://knight.sc/reverse%20engineering/2019/08/24/system-extension-internals.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
