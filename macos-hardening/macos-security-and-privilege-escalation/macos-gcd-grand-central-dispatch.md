# macOS GCD - Grand Central Dispatch

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**рдЧреНрд░реИрдВрдб рд╕реЗрдВрдЯреНрд░рд▓ рдбрд┐рд╕реНрдкреИрдЪ (GCD),** рдЬрд┐рд╕реЗ **libdispatch** (`libdispatch.dyld`) рдХреЗ рдирд╛рдо рд╕реЗ рднреА рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, macOS рдФрд░ iOS рджреЛрдиреЛрдВ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИред рдпрд╣ рдПрдХ рддрдХрдиреАрдХ рд╣реИ рдЬрд┐рд╕реЗ Apple рдиреЗ рдорд▓реНрдЯреАрдХреЛрд░ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдкрд░ рд╕рдорд╡рд░реНрддреА (рдорд▓реНрдЯреАрдереНрд░реЗрдбреЗрдб) рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╕рдорд░реНрдерди рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рд╣реИред

**GCD** **FIFO рдХрддрд╛рд░реЗрдВ** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдЖрдкрдХрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ **рдмреНрд▓реЙрдХ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕** рдХреЗ рд░реВрдк рдореЗрдВ **рдХрд╛рд░реНрдп рдкреНрд░рд╕реНрддреБрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред рдбрд┐рд╕реНрдкреИрдЪ рдХрддрд╛рд░реЛрдВ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЧрдП рдмреНрд▓реЙрдХ **рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдереНрд░реЗрдбреНрд╕ рдХреЗ рдкреВрд▓ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред** GCD рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдбрд┐рд╕реНрдкреИрдЪ рдХрддрд╛рд░реЛрдВ рдореЗрдВ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдереНрд░реЗрдбреНрд╕ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЙрдкрд▓рдмреНрдз рдХреЛрд░ рдкрд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрдбреНрдпреВрд▓ рдХрд░рддрд╛ рд╣реИред

{% hint style="success" %}
рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, **рд╕рдорд╛рдирд╛рдВрддрд░** рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ **GCD рдХреЛ рдХреЛрдб рдХреЗ рдмреНрд▓реЙрдХ рднреЗрдЬ рд╕рдХрддреА рд╣реИрдВ**, рдЬреЛ рдЙрдирдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдзреНрдпрд╛рди рд░рдЦреЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдирдП рдереНрд░реЗрдбреНрд╕ рдирд╣реАрдВ рдмрдирд╛рддреАрдВ; **GCD рджрд┐рдП рдЧрдП рдХреЛрдб рдХреЛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдереНрд░реЗрдбреНрд╕ рдХреЗ рдкреВрд▓ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ** (рдЬреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛рдиреБрд╕рд╛рд░ рдмрдврд╝ рдпрд╛ рдШрдЯ рд╕рдХрддрд╛ рд╣реИ)ред
{% endhint %}

рдпрд╣ рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдмрд╣реБрдд рд╕рд╣рд╛рдпрдХ рд╣реИ, рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рдереНрд░реЗрдбреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрд╣реБрдд рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрджрд░реНрд╢ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ **рдорд╣рд╛рди рд╕рдорд╛рдирд╛рдВрддрд░рддрд╛** (рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕рд┐рдВрдЧ?) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдпрд╛ рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рдореБрдЦреНрдп рдереНрд░реЗрдб рдХреЛ рдЕрд╡рд░реБрджреНрдз рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП: рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, iOS рдкрд░ рдореБрдЦреНрдп рдереНрд░реЗрдб UI рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреЛрдИ рднреА рдЕрдиреНрдп рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЬреЛ рдРрдк рдХреЛ рд▓рдЯрдХрд╛рдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддреА рд╣реИ (рдЦреЛрдЬ, рд╡реЗрдм рддрдХ рдкрд╣реБрдВрдЪ, рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдирд╛...) рдЗрд╕ рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред

### Blocks

рдПрдХ рдмреНрд▓реЙрдХ рдПрдХ **рд╕реНрд╡рддрдВрддреНрд░ рдХреЛрдб рдХрд╛ рдЦрдВрдб** рд╣реИ (рдЬреИрд╕реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдЬрд┐рд╕рдореЗрдВ рддрд░реНрдХ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдорд╛рди рд▓реМрдЯрд╛рддрд╛ рд╣реИ) рдФрд░ рдпрд╣ рдмрд╛рдЙрдВрдб рд╡реЗрд░рд┐рдПрдмрд▓ рднреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХрдВрдкрд╛рдЗрд▓рд░ рд╕реНрддрд░ рдкрд░ рдмреНрд▓реЙрдХ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддреЗ, рд╡реЗ `os_object`s рд╣реЛрддреЗ рд╣реИрдВред рдЗрди рд╡рд╕реНрддреБрдУрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рджреЛ рд╕рдВрд░рдЪрдирд╛рдУрдВ рд╕реЗ рдмрдирд╛ рд╣реЛрддрд╛ рд╣реИ:

* **рдмреНрд▓реЙрдХ рд▓рд┐рдЯрд░рд▓**:&#x20;
* рдпрд╣ **`isa`** рдлрд╝реАрд▓реНрдб рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдмреНрд▓реЙрдХ рдХреА рдХрдХреНрд╖рд╛ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ:
* `NSConcreteGlobalBlock` (рдмреНрд▓реЙрдХ `__DATA.__const` рд╕реЗ)
* `NSConcreteMallocBlock` (рд╣реАрдк рдореЗрдВ рдмреНрд▓реЙрдХ)
* `NSConcreateStackBlock` (рд╕реНрдЯреИрдХ рдореЗрдВ рдмреНрд▓реЙрдХ)
* рдЗрд╕рдореЗрдВ **`flags`** рд╣реЛрддреЗ рд╣реИрдВ (рдЬреЛ рдмреНрд▓реЙрдХ рд╡рд┐рд╡рд░рдг рдореЗрдВ рдЙрдкрд╕реНрдерд┐рдд рдлрд╝реАрд▓реНрдб рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ) рдФрд░ рдХреБрдЫ рдЖрд░рдХреНрд╖рд┐рдд рдмрд╛рдЗрдЯреНрд╕
* рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░
* рдмреНрд▓реЙрдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░
* рдЖрдпрд╛рддрд┐рдд рдмреНрд▓реЙрдХ рд╡реЗрд░рд┐рдПрдмрд▓ (рдпрджрд┐ рдХреЛрдИ рд╣реЛ)
* **рдмреНрд▓реЙрдХ рд╡рд┐рд╡рд░рдг**: рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░ рдЙрд╕ рдбреЗрдЯрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЙрдкрд╕реНрдерд┐рдд рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдлрд╝реНрд▓реИрдЧ рдореЗрдВ рд╕рдВрдХреЗрддрд┐рдд рд╣реИ)
* рдЗрд╕рдореЗрдВ рдХреБрдЫ рдЖрд░рдХреНрд╖рд┐рдд рдмрд╛рдЗрдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ
* рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░
* рдЗрд╕рдореЗрдВ рдЖрдорддреМрд░ рдкрд░ рдПрдХ Objective-C рд╢реИрд▓реА рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдпрд╣ рдкрддрд╛ рдЪрд▓ рд╕рдХреЗ рдХрд┐ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд▓рд┐рдП рдХрд┐рддрдиреА рдЬрдЧрд╣ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдлреНрд▓реИрдЧ `BLOCK_HAS_SIGNATURE`)
* рдпрджрд┐ рд╡реЗрд░рд┐рдПрдмрд▓ рд╕рдВрджрд░реНрднрд┐рдд рд╣реИрдВ, рддреЛ рдЗрд╕ рдмреНрд▓реЙрдХ рдореЗрдВ рдПрдХ рдХреЙрдкреА рд╣реЗрд▓реНрдкрд░ (рд╢реБрд░реБрдЖрдд рдореЗрдВ рдорд╛рди рдХреА рдХреЙрдкреА рдХрд░рдирд╛) рдФрд░ рдбрд┐рд╕реНрдкреЛрдЬрд╝ рд╣реЗрд▓реНрдкрд░ (рдЗрд╕реЗ рдореБрдХреНрдд рдХрд░рдирд╛) рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░ рднреА рд╣реЛрдВрдЧреЗред

### Queues

рдПрдХ рдбрд┐рд╕реНрдкреИрдЪ рдХрддрд╛рд░ рдПрдХ рдирд╛рдорд┐рдд рд╡рд╕реНрддреБ рд╣реИ рдЬреЛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдмреНрд▓реЙрдХреЛрдВ рдХрд╛ FIFO рдХреНрд░рдо рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред

рдмреНрд▓реЙрдХреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрддрд╛рд░реЛрдВ рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпреЗ 2 рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ: `DISPATCH_QUEUE_SERIAL` рдФрд░ `DISPATCH_QUEUE_CONCURRENT`ред рдмреЗрд╢рдХ, **рд╢реНрд░реГрдВрдЦрд▓рд╛рдмрджреНрдз** рд╡рд╛рд▓рд╛ **рд░реЗрд╕ рдХрдВрдбреАрд╢рди** рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдмреНрд▓реЙрдХ рддрдм рддрдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓рд╛ рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛ рдЧрдпрд╛ рд╣реИред рд▓реЗрдХрд┐рди **рджреВрд╕рд░реЗ рдкреНрд░рдХрд╛рд░ рдХреА рдХрддрд╛рд░ рдореЗрдВ рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрддрд╛рд░реЗрдВ:

* `.main-thread`: `dispatch_get_main_queue()` рд╕реЗ
* `.libdispatch-manager`: GCD рдХрд╛ рдХрддрд╛рд░ рдкреНрд░рдмрдВрдзрдХ
* `.root.libdispatch-manager`: GCD рдХрд╛ рдХрддрд╛рд░ рдкреНрд░рдмрдВрдзрдХ
* `.root.maintenance-qos`: рд╕рдмрд╕реЗ рдХрдо рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдп
* `.root.maintenance-qos.overcommit`
* `.root.background-qos`: `DISPATCH_QUEUE_PRIORITY_BACKGROUND` рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрд▓рдмреНрдз
* `.root.background-qos.overcommit`
* `.root.utility-qos`: `DISPATCH_QUEUE_PRIORITY_NON_INTERACTIVE` рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрд▓рдмреНрдз
* `.root.utility-qos.overcommit`
* `.root.default-qos`: `DISPATCH_QUEUE_PRIORITY_DEFAULT` рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрд▓рдмреНрдз
* `.root.background-qos.overcommit`
* `.root.user-initiated-qos`: `DISPATCH_QUEUE_PRIORITY_HIGH` рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрд▓рдмреНрдз
* `.root.background-qos.overcommit`
* `.root.user-interactive-qos`: рд╕рдмрд╕реЗ рдЙрдЪреНрдЪ рдкреНрд░рд╛рдердорд┐рдХрддрд╛
* `.root.background-qos.overcommit`

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рд╣реЛрдЧрд╛ рдЬреЛ **рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕рдордп рдХреМрди рд╕реЗ рдереНрд░реЗрдбреНрд╕ рдХреМрди рд╕реА рдХрддрд╛рд░реЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рддреЗ рд╣реИрдВ** (рдХрдИ рдереНрд░реЗрдбреНрд╕ рдПрдХ рд╣реА рдХрддрд╛рд░ рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдПрдХ рд╣реА рдереНрд░реЗрдб рд╡рд┐рднрд┐рдиреНрди рдХрддрд╛рд░реЛрдВ рдореЗрдВ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ)

#### Attributtes

рдЬрдм **`dispatch_queue_create`** рдХреЗ рд╕рд╛рде рдПрдХ рдХрддрд╛рд░ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рддреАрд╕рд░рд╛ рддрд░реНрдХ рдПрдХ `dispatch_queue_attr_t` рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рдпрд╛ рддреЛ `DISPATCH_QUEUE_SERIAL` (рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ NULL рд╣реИ) рдпрд╛ `DISPATCH_QUEUE_CONCURRENT` рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ `dispatch_queue_attr_t` рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реИ рдЬреЛ рдХрддрд╛рд░ рдХреЗ рдХреБрдЫ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

### Dispatch objects

libdispatch рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХрдИ рд╡рд╕реНрддреБрдПрдБ рд╣реИрдВ рдФрд░ рдХрддрд╛рд░реЗрдВ рдФрд░ рдмреНрд▓реЙрдХ рдХреЗрд╡рд▓ рдЙрдирдореЗрдВ рд╕реЗ 2 рд╣реИрдВред рдЗрди рд╡рд╕реНрддреБрдУрдВ рдХреЛ `dispatch_object_create` рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* `block`
* `data`: рдбреЗрдЯрд╛ рдмреНрд▓реЙрдХ
* `group`: рдмреНрд▓реЙрдХреЛрдВ рдХрд╛ рд╕рдореВрд╣
* `io`: Async I/O рдЕрдиреБрд░реЛрдз
* `mach`: Mach рдкреЛрд░реНрдЯ
* `mach_msg`: Mach рд╕рдВрджреЗрд╢
* `pthread_root_queue`: pthread рдереНрд░реЗрдб рдкреВрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдХрддрд╛рд░ рдФрд░ рдХрд╛рд░реНрдп рдХрддрд╛рд░ рдирд╣реАрдВ
* `queue`
* `semaphore`
* `source`: рдЗрд╡реЗрдВрдЯ рд╕реНрд░реЛрдд

## Objective-C

Objective-C рдореЗрдВ рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд▓реЙрдХ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ:

* [**dispatch\_async**](https://developer.apple.com/documentation/dispatch/1453057-dispatch\_async): рдПрдХ рдбрд┐рд╕реНрдкреИрдЪ рдХрддрд╛рд░ рдкрд░ рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд▓реЙрдХ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рддреБрд░рдВрдд рд▓реМрдЯрддрд╛ рд╣реИред
* [**dispatch\_sync**](https://developer.apple.com/documentation/dispatch/1452870-dispatch\_sync): рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд▓реЙрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕ рдмреНрд▓реЙрдХ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд▓реМрдЯрддрд╛ рд╣реИред
* [**dispatch\_once**](https://developer.apple.com/documentation/dispatch/1447169-dispatch\_once): рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЬреАрд╡рдирдХрд╛рд▓ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдПрдХ рдмреНрд▓реЙрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИред
* [**dispatch\_async\_and\_wait**](https://developer.apple.com/documentation/dispatch/3191901-dispatch\_async\_and\_wait): рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╛рд░реНрдп рдЖрдЗрдЯрдо рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХреЗрд╡рд▓ рддрдм рд▓реМрдЯрддрд╛ рд╣реИ рдЬрдм рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдирд╛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред [**`dispatch_sync`**](https://developer.apple.com/documentation/dispatch/1452870-dispatch\_sync) рдХреЗ рд╡рд┐рдкрд░реАрдд, рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдмреНрд▓реЙрдХ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдХрддрд╛рд░ рдХреЗ рд╕рднреА рдЧреБрдгреЛрдВ рдХрд╛ рд╕рдореНрдорд╛рди рдХрд░рддрд╛ рд╣реИред

рдпреЗ рдлрд╝рдВрдХреНрд╢рди рдЗрди рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ: [**`dispatch_queue_t`**](https://developer.apple.com/documentation/dispatch/dispatch\_queue\_t) **`queue,`** [**`dispatch_block_t`**](https://developer.apple.com/documentation/dispatch/dispatch\_block\_t) **`block`**

рдпрд╣ рдПрдХ **рдмреНрд▓реЙрдХ рдХрд╛ рд╕рдВрд░рдЪрдирд╛** рд╣реИ:
```c
struct Block {
void *isa; // NSConcreteStackBlock,...
int flags;
int reserved;
void *invoke;
struct BlockDescriptor *descriptor;
// captured variables go here
};
```
рдФрд░ рдпрд╣ **`dispatch_async`** рдХреЗ рд╕рд╛рде **parallelism** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ:
```objectivec
#import <Foundation/Foundation.h>

// Define a block
void (^backgroundTask)(void) = ^{
// Code to be executed in the background
for (int i = 0; i < 10; i++) {
NSLog(@"Background task %d", i);
sleep(1);  // Simulate a long-running task
}
};

int main(int argc, const char * argv[]) {
@autoreleasepool {
// Create a dispatch queue
dispatch_queue_t backgroundQueue = dispatch_queue_create("com.example.backgroundQueue", NULL);

// Submit the block to the queue for asynchronous execution
dispatch_async(backgroundQueue, backgroundTask);

// Continue with other work on the main queue or thread
for (int i = 0; i < 10; i++) {
NSLog(@"Main task %d", i);
sleep(1);  // Simulate a long-running task
}
}
return 0;
}
```
## Swift

**`libswiftDispatch`** рдПрдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИ рдЬреЛ **Swift bindings** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ Grand Central Dispatch (GCD) рдврд╛рдВрдЪреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рдореВрд▓ рд░реВрдк рд╕реЗ C рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред\
**`libswiftDispatch`** рдкреБрд╕реНрддрдХрд╛рд▓рдп C GCD APIs рдХреЛ рдПрдХ рдЕрдзрд┐рдХ Swift-рдлреНрд░реЗрдВрдбрд▓реА рдЗрдВрдЯрд░рдлреЗрд╕ рдореЗрдВ рд▓рдкреЗрдЯрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ Swift рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП GCD рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЖрд╕рд╛рди рдФрд░ рдЕрдзрд┐рдХ рд╕рд╣рдЬ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

* **`DispatchQueue.global().sync{ ... }`**
* **`DispatchQueue.global().async{ ... }`**
* **`let onceToken = DispatchOnce(); onceToken.perform { ... }`**
* **`async await`**
* **`var (data, response) = await URLSession.shared.data(from: URL(string: "https://api.example.com/getData"))`**

**Code example**:
```swift
import Foundation

// Define a closure (the Swift equivalent of a block)
let backgroundTask: () -> Void = {
for i in 0..<10 {
print("Background task \(i)")
sleep(1)  // Simulate a long-running task
}
}

// Entry point
autoreleasepool {
// Create a dispatch queue
let backgroundQueue = DispatchQueue(label: "com.example.backgroundQueue")

// Submit the closure to the queue for asynchronous execution
backgroundQueue.async(execute: backgroundTask)

// Continue with other work on the main queue
for i in 0..<10 {
print("Main task \(i)")
sleep(1)  // Simulate a long-running task
}
}
```
## Frida

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд Frida рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХрдИ `dispatch`** рдлрд╝рдВрдХреНрд╢рдВрд╕ рдореЗрдВ рд╣реБрдХ рдХрд░рдиреЗ рдФрд░ рдХрддрд╛рд░ рдХрд╛ рдирд╛рдо, рдмреИрдХрдЯреНрд░реЗрд╕ рдФрд░ рдмреНрд▓реЙрдХ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: [**https://github.com/seemoo-lab/frida-scripts/blob/main/scripts/libdispatch.js**](https://github.com/seemoo-lab/frida-scripts/blob/main/scripts/libdispatch.js)
```bash
frida -U <prog_name> -l libdispatch.js

dispatch_sync
Calling queue: com.apple.UIKit._UIReusePool.reuseSetAccess
Callback function: 0x19e3a6488 UIKitCore!__26-[_UIReusePool addObject:]_block_invoke
Backtrace:
0x19e3a6460 UIKitCore!-[_UIReusePool addObject:]
0x19e3a5db8 UIKitCore!-[UIGraphicsRenderer _enqueueContextForReuse:]
0x19e3a57fc UIKitCore!+[UIGraphicsRenderer _destroyCGContext:withRenderer:]
[...]
```
## Ghidra

рд╡рд░реНрддрдорд╛рди рдореЗрдВ Ghidra рди рддреЛ ObjectiveC **`dispatch_block_t`** рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕рдордЭрддрд╛ рд╣реИ, рди рд╣реА **`swift_dispatch_block`** рдХреЛред

рддреЛ рдЕрдЧрд░ рдЖрдк рдЗрд╕реЗ рд╕рдордЭрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдмрд╕ **рдЗрдирдХреА рдШреЛрд╖рдгрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

<figure><img src="../../.gitbook/assets/image (1160).png" alt="" width="563"><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (1162).png" alt="" width="563"><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (1163).png" alt="" width="563"><figcaption></figcaption></figure>

рдлрд┐рд░, рдХреЛрдб рдореЗрдВ рдПрдХ рдЬрдЧрд╣ рдЦреЛрдЬреЗрдВ рдЬрд╣рд╛рдБ рдЗрдиреНрд╣реЗрдВ **рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**:

{% hint style="success" %}
"block" рдХреЗ рд╕рднреА рд╕рдВрджрд░реНрднреЛрдВ рдХреЛ рдиреЛрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рд╕рдордЭ рд╕рдХреЗрдВ рдХрд┐ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред
{% endhint %}

<figure><img src="../../.gitbook/assets/image (1164).png" alt="" width="563"><figcaption></figcaption></figure>

рд╡реЗрд░рд┐рдПрдмрд▓ рдкрд░ рд░рд╛рдЗрдЯ-рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ -> рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЯрд╛рдЗрдк рдХрд░реЗрдВ рдФрд░ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ **`swift_dispatch_block`** рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ:

<figure><img src="../../.gitbook/assets/image (1165).png" alt="" width="563"><figcaption></figcaption></figure>

Ghidra рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдм рдХреБрдЫ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦ рджреЗрдЧрд╛:

<figure><img src="../../.gitbook/assets/image (1166).png" alt="" width="563"><figcaption></figcaption></figure>

## References

* [**\*OS Internals, Volume I: User Mode. By Jonathan Levin**](https://www.amazon.com/MacOS-iOS-Internals-User-Mode/dp/099105556X)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
