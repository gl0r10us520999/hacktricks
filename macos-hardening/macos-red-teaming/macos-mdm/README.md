# macOS MDM

{% hint style="success" %}
**AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:**<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
**GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:** <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕**](https://github.com/carlospolop/hacktricks) **рдФрд░ [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

**macOS MDM рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:**

* [https://www.youtube.com/watch?v=ku8jZe-MHUU](https://www.youtube.com/watch?v=ku8jZe-MHUU)
* [https://duo.com/labs/research/mdm-me-maybe](https://duo.com/labs/research/mdm-me-maybe)

## рдореВрд▓рднреВрдд

### **MDM (рдореЛрдмрд╛рдЗрд▓ рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдмрдВрдзрди) рдЕрд╡рд▓реЛрдХрди**

[рдореЛрдмрд╛рдЗрд▓ рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдмрдВрдзрди](https://en.wikipedia.org/wiki/Mobile\_device\_management) (MDM) рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдорд╛рд░реНрдЯрдлреЛрди, рд▓реИрдкрдЯреЙрдк рдФрд░ рдЯреИрдмрд▓реЗрдЯ рдЬреИрд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдЕрдВрддрдпрдЬ рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ Apple рдХреЗ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореЛрдВ (iOS, macOS, tvOS) рдХреЗ рд▓рд┐рдП, рдЗрд╕рдореЗрдВ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ, рдПрдкреАрдЖрдИ рдФрд░ рдЕрднреНрдпрд╛рд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред MDM рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдПрдХ рд╕рдВрдЧрдд MDM рд╕рд░реНрд╡рд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╡реНрдпрд╛рдкрд╛рд░ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдпрд╛ рдУрдкрди-рд╕реЛрд░реНрд╕ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ [MDM Protocol](https://developer.apple.com/enterprise/documentation/MDM-Protocol-Reference.pdf) рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдореБрдЦреНрдп рдмрд┐рдВрджреБрдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдкрд░ рдХреЗрдВрджреНрд░реАрдХреГрдд рдирд┐рдпрдВрддреНрд░рдгред
* MDM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ MDM рд╕рд░реНрд╡рд░ рдкрд░ рдирд┐рд░реНрднрд░рддрд╛ред
* MDM рд╕рд░реНрд╡рд░ рдХреА рдХреНрд╖рдорддрд╛ рд╡рд┐рднрд┐рдиреНрди рдХрдорд╛рдВрдбреЛрдВ рдХреЛ рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдореЗрдВ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд░рд┐рдореЛрдЯ рдбреЗрдЯрд╛ рдорд┐рдЯрд╛рдирд╛ рдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реНрдерд╛рдкрдирд╛ред

### **DEP (рдбрд┐рд╡рд╛рдЗрд╕ рдПрдирд░реЛрд▓рдореЗрдВрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо) рдХреА рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА**

Apple рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ [рдбрд┐рд╡рд╛рдЗрд╕ рдПрдирд░реЛрд▓рдореЗрдВрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо](https://www.apple.com/business/site/docs/DEP\_Guide.pdf) (DEP) iOS, macOS рдФрд░ tvOS рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЗ рд▓рд┐рдП рдЬреАрд░реНрдг-рд╕реНрдкрд░реНрд╢ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕реБрдЧрдо рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдореЛрдмрд╛рдЗрд▓ рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдмрдВрдзрди (MDM) рдХрд╛ рд╕рдорд╛рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИред DEP рдПрдирд░реЛрд▓рдореЗрдВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЛ рдмреЙрдХреНрд╕ рд╕реЗ рдирд┐рдХрд╛рд▓рддреЗ рд╣реА рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдиреНрдпреВрдирддрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХреЗ рд╕рд╛рдеред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд╣рд▓реБрдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рдХреНрд░рд┐рдпрдг рдХреЗ рджреМрд░рд╛рди рдкреВрд░реНрд╡-рдирд┐рд░реНрдзрд╛рд░рд┐рдд MDM рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рд╕реНрд╡рдд: рдкрдВрдЬреАрдХрд░рдг рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ред
* рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдирдП рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЗ рд▓рд┐рдП рд▓рд╛рднрдХрд╛рд░реА, рд▓реЗрдХрд┐рди рдкреБрдирд░реНрдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реЛ рд░рд╣реЗ рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЗ рд▓рд┐рдП рднреА рд▓рд╛рдЧреВред
* рдПрдХ рд╕рд░рд▓ рд╕реЗрдЯрдЕрдк рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдбрд┐рд╡рд╛рдЗрд╕ рддреНрд╡рд░рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдЧрдардирд╛рддреНрдордХ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред

### **рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдЪрд╛рд░**

DEP рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдкрдВрдЬреАрдХрд░рдг рдХреА рд╕реБрд╡рд┐рдзрд╛, рдЬреЛ рд▓рд╛рднрдХрд╛рд░реА рд╣реИ, рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рднреА рдЙрдард╛ рд╕рдХрддреА рд╣реИред рдпрджрд┐ MDM рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдЪрд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рд╕рдореНрдорд┐рд▓рд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╢реНрд░реЗрд╖реНрдареАрдХрд░рдг рдХрд░рдХреЗ рдЕрдкрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рд╕рдВрдЧрдарди рдХреЗ MDM рд╕рд░реНрд╡рд░ рдкрд░ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдореБрдЦреНрдпрддрдГ рдЫрд▓рд╛рд╡рд╛ рдХрд░рддреЗ рд╣реБрдПред

{% hint style="danger" %}
**рд╕реБрд░рдХреНрд╖рд╛ рдЪреЗрддрд╛рд╡рдиреА**: рд╕рд░рд▓рд┐рдд DEP рдкрдВрдЬреАрдХрд░рдг рд╕рдВрдЧрдарди рдХреЗ MDM рд╕рд░реНрд╡рд░ рдкрд░ рдЕрдирдзрд┐рдХреГрдд рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдпрджрд┐ рдЙрдЪрд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реИрдВред
{% endhint %}

### **SCEP (рд╕рд┐рдореНрдкрд▓ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдПрдирд░реЛрд▓рдореЗрдВрдЯ рдкреНрд░реЛрдЯреЛрдХреЙрд▓) рдХреНрдпрд╛ рд╣реИ?**

* рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рдкреБрд░рд╛рдирд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓, TLS рдФрд░ HTTPS рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдирд╣реАрдВ рдереЗ рдЬрдм рдпрд╣ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред
* рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ **рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рд╕рд╛рдЗрдирд┐рдВрдЧ рдЕрдиреБрд░реЛрдз** (CSR) рднреЗрдЬрдиреЗ рдХрд╛ рдПрдХ рдорд╛рдирдХреАрдХреГрдд рддрд░реАрдХрд╛ рджреЗрддрд╛ рд╣реИред рдЧреНрд░рд╛рд╣рдХ рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛ред

### **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░реЛрдлрд╛рдЗрд▓ рдХреНрдпрд╛ рд╣реИрдВ (рдЬрд┐рд╕реЗ рдореЛрдмрд╛рдЗрд▓рдХреЙрдиреНрдлрд┐рдЧреНрд╕ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)?**

* Apple рдХрд╛ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рддрд░реАрдХрд╛ **рд╕рд┐рд╕реНрдЯрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗрдЯ рдХрд░рдиреЗ/рд▓рд╛рдЧреВ рдХрд░рдиреЗ** рдХрд╛ред
* рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк рдЬрд┐рд╕рдореЗрдВ рдХрдИ payloads рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
* рдкреНрд░реЙрдкрд░реНрдЯреА рд╕реВрдЪрд┐рдпреЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ (рд╡рд╣ XML рдкреНрд░рдХрд╛рд░ рдХрд╛)ред
* "рдЙрдирдХреА рдореВрд▓ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ, рдЙрдирдХреА рдкреВрд░реНрдгрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрдирдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдЗрди рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред" рдореВрд▓рднреВрдд тАФ рдкреГрд╖реНрда 70, iOS рд╕реБрд░рдХреНрд╖рд╛ рдЧрд╛рдЗрдб, рдЬрдирд╡рд░реА 2018ред

## рдкреНрд░реЛрдЯреЛрдХреЙрд▓

### MDM

* APNs (**Apple рд╕рд░реНрд╡рд░**) + RESTful API (**MDM рд╡реЗрдВрдбрд░** рд╕рд░реНрд╡рд░) рдХрд╛ рд╕рдВрдпреЛрдЬрди
* **рд╕рдВрдЪрд╛рд░** рдПрдХ **рдбрд┐рд╡рд╛рдЗрд╕** рдФрд░ рдПрдХ **рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдмрдВрдзрди** **рдЙрддреНрдкрд╛рдж** рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рд╣реЛрддрд╛ рд╣реИ
* **рдХрдорд╛рдВрдб** MDM рд╕реЗ рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рдкреНрд▓рд┐рд╕реНрдЯ-рдХреЛрдбрд┐рдд рд╢рдмреНрджрдХреЛрд╢реЛрдВ рдореЗрдВ рдкрд╣реБрдВрдЪрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ
* рд╕рднреА рдУрд╡рд░ **HTTPS**ред MDM рд╕рд░реНрд╡рд░ (рдФрд░ рд╕рд╛рдорд╛рдиреНрдпрдд: рдкрд┐рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ) рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
* Apple MDM рд╡реЗрдВрдбрд░ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ **APNs рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ

### DEP

* **3 рдПрдкреАрдЖрдИ**: 1 рд░рд┐рд╕реЗрд▓рд░реЛрдВ рдХреЗ рд▓рд┐рдП, 1 MDM рд╡реЗрдВрдбрд░реЛрдВ рдХреЗ рд▓рд┐рдП, 1 рдбрд┐рд╡рд╛рдЗрд╕ рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП (рдЕрдирджрд╕реНрддрд╛рд╡реЗрдЬрд┐рдд):
* рдЙрд╕реЗ рдЬрд┐рд╕реЗ [DEP "рдХреНрд▓рд╛рдЙрдб рд╕реЗрд╡рд╛" рдПрдкреАрдЖрдИ](https://developer.apple.com/enterprise/documentation/MDM-Protocol-Reference.pdf) рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ MDM рд╕рд░реНрд╡рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ DEP рдкреНрд░реЛрдлрд╛рдЗрд▓реЛрдВ рдХреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* [рдПрдкреНрдкрд▓ рдЕрдзрд┐рдХреГрдд рд░рд┐рд╕реЗрд▓рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ DEP рдПрдкреАрдЖрдИ](https://applecareconnect.apple.com/api-docs/depuat/html/WSImpManual.html) рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рдХреЛ рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░рдиреЗ, рдирд╛рдорд╛рдВрдХрди рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рд▓реЗрди-рджреЗрди рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* рдЕрдирджрд╕реНрддрд╛рд╡реЗрдЬрд┐рдд рдирд┐рдЬреА DEP рдПрдкреАрдЖрдИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдкреНрдкрд▓ рдбрд┐рд╡рд╛рдЗрд╕реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдирдХреЗ DEP рдкреНрд░реЛрдл
### **рдЪрд░рдг 4: DEP рдЪреЗрдХ-рдЗрди - рд╕рдХреНрд░рд┐рдпрдг рд░рд┐рдХреЙрд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛**

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдпрд╣ рд╣рд┐рд╕реНрд╕рд╛ рдЬрдм **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рд▓реА рдмрд╛рд░ Mac рдХреЛ рдмреВрдЯ рдХрд░рддрд╛ рд╣реИ** (рдпрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╛рдл рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж) рд╣реЛрддрд╛ рд╣реИ

![](<../../../.gitbook/assets/image (1044).png>)

рдпрд╛ `sudo profiles show -type enrollment` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп

* **рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЙрдкрдХрд░рдг DEP рд╕рдХреНрд╖рдо рд╣реИ**
* рд╕рдХреНрд░рд┐рдпрдг рд░рд┐рдХреЙрд░реНрдб DEP тАЬрдкреНрд░реЛрдлрд╝рд╛рдЗрд▓тАЭ рдХреЗ рд▓рд┐рдП рдЖрдВрддрд░рд┐рдХ рдирд╛рдо рд╣реИ
* рдЙрдкрдХрд░рдг рдХреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реА рдкреНрд░рд╛рд░рдВрдн рд╣реЛрддрд╛ рд╣реИ
* **`CPFetchActivationRecord`** рджреНрд╡рд╛рд░рд╛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* **`cloudconfigurationd`** рджреНрд╡рд╛рд░рд╛ XPC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред **"рд╕реЗрдЯрдЕрдк рд╕рд╣рд╛рдпрдХ**" (рдЬрдм рдЙрдкрдХрд░рдг рдкрд╣рд▓реА рдмрд╛рд░ рдмреВрдЯ рд╣реЛрддрд╛ рд╣реИ) рдпрд╛ **`profiles`** рдХрдорд╛рдВрдб рдЗрд╕ рдбреЗрдорди рд╕реЗ рд╕рдХреНрд░рд┐рдпрдг рд░рд┐рдХреЙрд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдЧрд╛**ред
* рд▓реЙрдиреНрдЪрдбреЗрдореЙрди (рд╣рдореЗрд╢рд╛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ)

рдпрд╣ **`MCTeslaConfigurationFetcher`** рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреБрдЫ рдХрджрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ **Absinthe** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ

1. **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
1. GET [https://iprofiles.apple.com/resource/certificate.cer](https://iprofiles.apple.com/resource/certificate.cer)
2. рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╕реНрдерд┐рддрд┐ **рдЖрд░рдВрдн рдХрд░реЗрдВ** (**`NACInit`**)
1. рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдХрд░рдг-рд╡рд┐рд╢реЗрд╖ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ (рдЙрджрд╛. **`IOKit`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░)
3. **рд╕рддреНрд░ рдХреБрдВрдЬреА** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
1. POST [https://iprofiles.apple.com/session](https://iprofiles.apple.com/session)
4. рд╕рддреНрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ (**`NACKeyEstablishment`**)
5. рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ
1. рдбреЗрдЯрд╛ `{ "action": "RequestProfileConfiguration", "sn": "" }` рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП [https://iprofiles.apple.com/macProfile](https://iprofiles.apple.com/macProfile) рдкреЛрд╕реНрдЯ рдХрд░реЗрдВ
2. JSON рдкреЗрд▓реЛрдб рдХреЛ Absinthe (**`NACSign`**) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
3. рд╕рднреА рдЕрдиреБрд░реЛрдз HTTPs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЗрдирдмрд┐рд▓реНрдЯ-рд░реВрдЯ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

![](<../../../.gitbook/assets/image (566) (1).png>)

рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдПрдХ JSON рд╢рдмреНрджрдХреЛрд╢ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдбреЗрдЯрд╛ рд╣реИрдВ:

* **url**: рд╕рдХреНрд░рд┐рдпрдг рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП MDM рд╡реЗрдВрдбрд░ рд╣реЛрд╕реНрдЯ рдХрд╛ URL
* **anchor-certs**: рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдПрдВрдХрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ DER рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдПрдХ рд╕рд░рдгреА

### **рдЪрд░рдг 5: рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрддрд┐**

![](<../../../.gitbook/assets/image (444).png>)

* DEP рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП **url** рдкрд░ рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдпрджрд┐ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **рдПрдВрдХрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдпрд╛рдж рджрд┐рд▓рд╛рдирд╛: DEP рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреА **рдПрдВрдХрд░\_рд╕рд░реНрдЯреНрд╕** рдЧреБрдгрдзрд░реНрдо
* рдЕрдиреБрд░реЛрдз рдПрдХ рд╕рд╛рдзрд╛рд░рдг .plist рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдХрд░рдг рдкрд╣рдЪрд╛рди рд╣реИ
* рдЙрджрд╛рд╣рд░рдг: **UDID, OS рд╕рдВрд╕реНрдХрд░рдг**ред
* CMS-рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛, DER-рдПрдиреНрдХреЛрдбреЗрдб
* **рдбрд┐рд╡рд╛рдЗрд╕ рдкрд╣рдЪрд╛рди рдкреНрд░рдорд╛рдгрдкрддреНрд░ (APNS рд╕реЗ) рд╕реЗ рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**
* **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╢реНрд░реГрдВрдЦрд▓рд╛** рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ **рдПрдкреНрдкрд▓ рдЖрдИрдлреЛрди рдбрд┐рд╡рд╛рдЗрд╕ рд╕реАрдП рдПрдХреНрд╕рдкрд╛рдпрд░реНрдб** рд╢рд╛рдорд┐рд▓ рд╣реИ

![](<../../../.gitbook/assets/image (567) (1) (2) (2) (2) (2) (2) (2) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1
