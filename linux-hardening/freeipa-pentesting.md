# FreeIPA Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

FreeIPAã¯ã€ä¸»ã«**Unix**ç’°å¢ƒå‘ã‘ã®Microsoft Windows **Active Directory**ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®**ä»£æ›¿**ã§ã™ã€‚ã“ã‚Œã¯ã€Active Directoryã«é¡ä¼¼ã—ãŸç®¡ç†ã®ãŸã‚ã«ã€å®Œå…¨ãª**LDAPãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**ã¨MIT **Kerberos**ã‚­ãƒ¼é…å¸ƒã‚»ãƒ³ã‚¿ãƒ¼ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ã€‚CAãŠã‚ˆã³RAè¨¼æ˜æ›¸ç®¡ç†ã®ãŸã‚ã«Dogtag **Certificate System**ã‚’åˆ©ç”¨ã—ã€ã‚¹ãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã‚’å«ã‚€**å¤šè¦ç´ **èªè¨¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚Unixèªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãŸã‚ã«SSSDãŒçµ±åˆã•ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒ„

### ãƒ•ã‚¡ã‚¤ãƒ«ã¨ç’°å¢ƒå¤‰æ•°

* `/etc/krb5.conf`ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®ç™»éŒ²ã«å¿…è¦ãªKerberosã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã¯KDCã¨ç®¡ç†ã‚µãƒ¼ãƒãƒ¼ã®å ´æ‰€ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã€ãŠã‚ˆã³ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå«ã¾ã‚Œã¾ã™ã€‚
* IPAã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€`/etc/ipa/default.conf`ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
* ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ãƒ›ã‚¹ãƒˆã¯ã€èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãŸã‚ã«`/etc/krb5.keytab`ã«`krb5.keytab`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* æ§˜ã€…ãªç’°å¢ƒå¤‰æ•°ï¼ˆ`KRB5CCNAME`ã€`KRB5_KTNAME`ã€`KRB5_CONFIG`ã€`KRB5_KDC_PROFILE`ã€`KRB5RCACHETYPE`ã€`KRB5RCACHEDIR`ã€`KRB5_TRACE`ã€`KRB5_CLIENT_KTNAME`ã€`KPROP_PORT`ï¼‰ã¯ã€Kerberosèªè¨¼ã«é–¢é€£ã™ã‚‹ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨è¨­å®šã‚’æŒ‡ã—ç¤ºã™ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### ãƒã‚¤ãƒŠãƒª

`ipa`ã€`kdestroy`ã€`kinit`ã€`klist`ã€`kpasswd`ã€`ksu`ã€`kswitch`ã€`kvno`ãªã©ã®ãƒ„ãƒ¼ãƒ«ã¯ã€FreeIPAãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç®¡ç†ã€Kerberosãƒã‚±ãƒƒãƒˆã®å‡¦ç†ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒã‚±ãƒƒãƒˆã®å–å¾—ãªã©ã®æ©Ÿèƒ½ã«ãŠã„ã¦ä¸­å¿ƒçš„ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

å…¸å‹çš„ãªFreeIPAã‚µãƒ¼ãƒãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ç¤ºã™å›³ãŒã‚ã‚Šã¾ã™ã€‚

## èªè¨¼

FreeIPAã«ãŠã‘ã‚‹èªè¨¼ã¯ã€**Kerberos**ã‚’åˆ©ç”¨ã—ã¦**Active Directory**ã®ãã‚Œã‚’åæ˜ ã—ã¦ã„ã¾ã™ã€‚ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ã€æœ‰åŠ¹ãªKerberosãƒã‚±ãƒƒãƒˆãŒå¿…è¦ã§ã‚ã‚Šã€ã“ã‚Œã¯FreeIPAãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®šã«å¿œã˜ã¦æ§˜ã€…ãªå ´æ‰€ã«ä¿å­˜ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

### **CCACHEãƒã‚±ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«**

CCACHEãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€é€šå¸¸**`/tmp`**ã«**600**ã®æ¨©é™ã§ä¿å­˜ã•ã‚Œã€Kerberosè³‡æ ¼æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒã‚¤ãƒŠãƒªå½¢å¼ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã—ã§èªè¨¼ã‚’è¡Œã†ãŸã‚ã«é‡è¦ã§ã™ã€‚CCACHEãƒã‚±ãƒƒãƒˆã®è§£æã¯`klist`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦è¡Œã†ã“ã¨ãŒã§ãã€æœ‰åŠ¹ãªCCACHEãƒã‚±ãƒƒãƒˆã‚’å†åˆ©ç”¨ã™ã‚‹ã«ã¯ã€`KRB5CCNAME`ã‚’ãƒã‚±ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

### **Unixã‚­ãƒ¼ãƒ¬ãƒ³ã‚°**

ä»£ã‚ã‚Šã«ã€CCACHEãƒã‚±ãƒƒãƒˆã¯Linuxã‚­ãƒ¼ãƒ¬ãƒ³ã‚°ã«ä¿å­˜ã§ãã€ãƒã‚±ãƒƒãƒˆç®¡ç†ã«å¯¾ã™ã‚‹ã‚ˆã‚Šå¤šãã®åˆ¶å¾¡ã‚’æä¾›ã—ã¾ã™ã€‚ãƒã‚±ãƒƒãƒˆã®ä¿å­˜ç¯„å›²ã¯ï¼ˆ`KEYRING:name`ã€`KEYRING:process:name`ã€`KEYRING:thread:name`ã€`KEYRING:session:name`ã€`KEYRING:persistent:uidnumber`ï¼‰ç•°ãªã‚Šã€`klist`ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã«ã“ã®æƒ…å ±ã‚’è§£æã§ãã¾ã™ã€‚ã—ã‹ã—ã€Unixã‚­ãƒ¼ãƒ¬ãƒ³ã‚°ã‹ã‚‰CCACHEãƒã‚±ãƒƒãƒˆã‚’å†åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯èª²é¡Œã‚’ä¼´ã†å ´åˆãŒã‚ã‚Šã€Kerberosãƒã‚±ãƒƒãƒˆã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã®**Tickey**ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚

### ã‚­ãƒ¼ã‚¿ãƒ–

Kerberosãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨æš—å·åŒ–ã•ã‚ŒãŸã‚­ãƒ¼ã‚’å«ã‚€ã‚­ãƒ¼ã‚¿ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿…è¦ã¨ã›ãšã«æœ‰åŠ¹ãªãƒã‚±ãƒƒãƒˆä»˜ä¸ãƒã‚±ãƒƒãƒˆï¼ˆTGTï¼‰ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã€‚ã‚­ãƒ¼ã‚¿ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®è³‡æ ¼æƒ…å ±ã®è§£æã¨å†åˆ©ç”¨ã¯ã€`klist`ã®ã‚ˆã†ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚„**KeytabParser**ã®ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ç°¡å˜ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ

Linuxã§ã®ãƒã‚±ãƒƒãƒˆã®ä½¿ç”¨æ–¹æ³•ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã§ç¢ºèªã§ãã¾ã™ï¼š

{% content-ref url="privilege-escalation/linux-active-directory.md" %}
[linux-active-directory.md](privilege-escalation/linux-active-directory.md)
{% endcontent-ref %}

## åˆ—æŒ™

{% hint style="warning" %}
**ldap**ã‚„ä»–ã®**ãƒã‚¤ãƒŠãƒª**ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦**åˆ—æŒ™**ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‹ã€**FreeIPAã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ãƒˆ443ã«æ¥ç¶šã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

### ãƒ›ã‚¹ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãŠã‚ˆã³ã‚°ãƒ«ãƒ¼ãƒ— <a href="#id-4b3b" id="id-4b3b"></a>

**ãƒ›ã‚¹ãƒˆ**ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã€ãŠã‚ˆã³**ã‚°ãƒ«ãƒ¼ãƒ—**ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãƒ›ã‚¹ãƒˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã‚Œãã‚Œã€Œ**ãƒ›ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—**ã€ãŠã‚ˆã³ã€Œ**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—**ã€ã¨å‘¼ã°ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠã«æ•´ç†ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯**çµ„ç¹”å˜ä½**ï¼ˆOUï¼‰ã«ä¼¼ã¦ã„ã¾ã™ã€‚

FreeIPAã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€LDAPã‚µãƒ¼ãƒãƒ¼ã¯**åŒ¿åãƒã‚¤ãƒ³ãƒ‰**ã‚’è¨±å¯ã—ã¦ãŠã‚Šã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ãŒ**èªè¨¼ãªã—**ã§åˆ—æŒ™å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€èªè¨¼ãªã—ã§åˆ©ç”¨å¯èƒ½ãªã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ—æŒ™ã§ãã¾ã™ï¼š
```
ldapsearch -x
```
**è©³ç´°æƒ…å ±**ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€**èªè¨¼ã•ã‚ŒãŸ**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆèªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ã€èªè¨¼ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æº–å‚™ã™ã‚‹æ–¹æ³•ã‚’å­¦ã‚“ã§ãã ã•ã„ï¼‰ã€‚
```bash
# Get all users of domain
ldapsearch -Y gssapi -b "cn=users,cn=compat,dc=domain_name,dc=local"

# Get users groups
ldapsearch -Y gssapi -b "cn=groups,cn=accounts,dc=domain_name,dc=local"

# Get all the hosts
ldapsearch -Y gssapi -b "cn=computers,cn=accounts,dc=domain_name,dc=local"

# Get hosts groups
ldapsearch -Y gssapi -b "cn=hostgroups,cn=accounts,dc=domain_name,dc=local"
```
ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å‚åŠ ã—ã¦ã„ã‚‹ãƒã‚·ãƒ³ã‹ã‚‰ã€**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒª**ã‚’ä½¿ç”¨ã—ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
ipa user-find
ipa usergroup-find
ipa host-find
ipa host-group-find

-------------------

ipa user-show <username> --all
ipa usergroup-show <user group> --all
ipa host-find <host> --all
ipa hostgroup-show <host group> --all
```
{% hint style="info" %}
**FreeIPA**ã®**admin**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€**AD**ã®**domain admins**ã«ç›¸å½“ã—ã¾ã™ã€‚
{% endhint %}

### ãƒãƒƒã‚·ãƒ¥ <a href="#id-482b" id="id-482b"></a>

**IPAã‚µãƒ¼ãƒ**ãƒ¼ã®**root**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®**ãƒãƒƒã‚·ãƒ¥**ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã¯ã€**userPassword** **å±æ€§**ã«**base64**ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒãƒƒã‚·ãƒ¥ã¯**SSHA512**ï¼ˆå¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®FreeIPAï¼‰ã¾ãŸã¯**PBKDF2\_SHA256**ã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* ã‚·ã‚¹ãƒ†ãƒ ãŒ**AD**ã¨**çµ±åˆ**ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®**Nthash**ã¯â€œ**ipaNTHash**â€ã«**base64**ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ãƒãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒ©ãƒƒã‚¯ã™ã‚‹ã«ã¯ï¼š

â€¢ FreeIPAãŒADã¨çµ±åˆã•ã‚Œã¦ã„ã‚‹å ´åˆã€**ipaNTHash**ã¯ç°¡å˜ã«ã‚¯ãƒ©ãƒƒã‚¯ã§ãã¾ã™ï¼š**base64**ã‚’**ãƒ‡ã‚³ãƒ¼ãƒ‰**ã—ã¦ã‹ã‚‰**ASCII**ã®16é€²æ•°ã«å†ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã€John The Ripperã¾ãŸã¯**hashcat**ã‚’ä½¿ç”¨ã—ã¦è¿…é€Ÿã«ã‚¯ãƒ©ãƒƒã‚¯ã§ãã¾ã™ã€‚

â€¢ å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®FreeIPAãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**SSHA512**ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼š**base64**ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰SSHA512ã®**ãƒãƒƒã‚·ãƒ¥**ã‚’è¦‹ã¤ã‘ã€John The Ripperã¾ãŸã¯**hashcat**ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ãƒƒã‚¯ã§ãã¾ã™ã€‚

â€¢ æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®FreeIPAãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€**PBKDF2\_SHA256**ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼š**base64**ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰PBKDF2\_SHA256ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚ãã®**é•·ã•**ã¯256ãƒã‚¤ãƒˆã§ã™ã€‚Johnã¯256ãƒ“ãƒƒãƒˆï¼ˆ32ãƒã‚¤ãƒˆï¼‰ã§å‹•ä½œã§ãã¾ã™ -> SHA-265ãŒæ“¬ä¼¼ä¹±æ•°é–¢æ•°ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã€ãƒ–ãƒ­ãƒƒã‚¯ã‚µã‚¤ã‚ºã¯32ãƒã‚¤ãƒˆã§ã™ -> PBKDF2\_SHA256ãƒãƒƒã‚·ãƒ¥ã®æœ€åˆã®256ãƒ“ãƒƒãƒˆã®ã¿ã‚’ä½¿ç”¨ã§ãã¾ã™ -> John The Ripperã¾ãŸã¯hashcatã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ãƒƒã‚¯ã§ãã¾ã™ã€‚

<figure><img src="../.gitbook/assets/image (655).png" alt=""><figcaption></figcaption></figure>

ãƒãƒƒã‚·ãƒ¥ã‚’æŠ½å‡ºã™ã‚‹ã«ã¯ã€**FreeIPAã‚µãƒ¼ãƒ**ãƒ¼ã§**root**ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§ã€ãƒ„ãƒ¼ãƒ«**`dbscan`**ã‚’ä½¿ç”¨ã—ã¦ãã‚Œã‚‰ã‚’æŠ½å‡ºã§ãã¾ã™ï¼š

<figure><img src="../.gitbook/assets/image (293).png" alt=""><figcaption></figcaption></figure>

### HBACãƒ«ãƒ¼ãƒ« <a href="#id-482b" id="id-482b"></a>

ã“ã‚Œã¯ã€ãƒªã‚½ãƒ¼ã‚¹ï¼ˆãƒ›ã‚¹ãƒˆã€ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ãªã©ï¼‰ã«å¯¾ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ›ã‚¹ãƒˆã«ç‰¹å®šã®æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=hbac,dc=domain_name,dc=local"
# Using ipa
ipa hbacrule-find
# Show info of rule
ipa hbacrule-show <hbacrule> --all
```
#### Sudo-Rules

FreeIPAã¯ã€sudo-rulesã‚’ä»‹ã—ã¦**sudoæ¨©é™**ã®é›†ä¸­ç®¡ç†ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ãƒ›ã‚¹ãƒˆã§sudoã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’è¨±å¯ã¾ãŸã¯åˆ¶é™ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’èª¿æŸ»ã™ã‚‹ã“ã¨ã§ã€é©ç”¨å¯èƒ½ãªãƒ›ã‚¹ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãŠã‚ˆã³è¨±å¯ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’ç‰¹å®šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```bash
# Enumerate using ldap
ldapsearch -Y gssapi -b "cn=sudorules,cn=sudo,dc=domain_name,dc=local"
# Using ipa
ipa sudorule-find
# Show info of rule
ipa sudorule-show <sudorule> --all
```
### Role-Based Access Control

**ãƒ­ãƒ¼ãƒ«**ã¯ã€ã•ã¾ã–ã¾ãª**ç‰¹æ¨©**ã§æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€ãã‚Œãã‚ŒãŒ**æ¨©é™**ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ­ãƒ¼ãƒ«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‚°ãƒ«ãƒ¼ãƒ—**ã€**ãƒ›ã‚¹ãƒˆ**ã€ãƒ›ã‚¹ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã€ãŠã‚ˆã³ã‚µãƒ¼ãƒ“ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€FreeIPAã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è€…ã€ãƒ­ãƒ¼ãƒ«ã‚’è€ƒãˆã¦ã€ã“ã®æ§‹é€ ã‚’ä¾‹ç¤ºã—ã¾ã™ã€‚

ãƒ­ãƒ¼ãƒ«`User Administrator`ã«ã¯ã€æ¬¡ã®ç‰¹æ¨©ãŒã‚ã‚Šã¾ã™ï¼š

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è€…**
* **ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†è€…**
* **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è€…**

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ­ãƒ¼ãƒ«ã€ç‰¹æ¨©ã€ãŠã‚ˆã³æ¨©é™ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
# Using ldap
ldapsearch -Y gssapi -b "cn=roles,cn=accounts,dc=westeros,dc=local"
# Using ipa binary
ipa role-find
ipa role-show <role> --all
ipa privilege-find
ipa privilege-show <privilege> --all
ipa permission-find
ipa permission-show <permission> --all
```
### æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã®ä¾‹

[https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e](https://posts.specterops.io/attacking-freeipa-part-iii-finding-a-path-677405b5b95e) ã§ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä¾µå®³ã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®æ¨©é™ã‚’æ‚ªç”¨ã™ã‚‹ç°¡å˜ãªä¾‹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### Linikatz/LinikatzV2

* [https://github.com/Orange-Cyberdefense/LinikatzV2](https://github.com/Orange-Cyberdefense/LinikatzV2)
* [https://github.com/CiscoCXSecurity/linikatz](https://github.com/CiscoCXSecurity/linikatz)

## ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ˜‡æ ¼

### ~~rootãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ~~

{% hint style="warning" %}
ã‚‚ã—**`root`ã¨ã„ã†åå‰ã®æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã§ãã‚‹ãªã‚‰**ã€å½¼ã«ãªã‚Šã™ã¾ã™ã“ã¨ãŒã§ãã€**rootã¨ã—ã¦ä»»æ„ã®ãƒã‚·ãƒ³ã«SSHæ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**

**ã“ã‚Œã¯ãƒ‘ãƒƒãƒãŒå½“ã¦ã‚‰ã‚Œã¾ã—ãŸã€‚**
{% endhint %}

è©³ç´°ãªèª¬æ˜ã¯[https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b)ã§ç¢ºèªã§ãã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b](https://posts.specterops.io/attacking-freeipa-part-iv-cve-2020-10747-7c373a1bf66b)
* [https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a](https://posts.specterops.io/attacking-freeipa-part-i-authentication-77e73d837d6a)
* [https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1](https://posts.specterops.io/attacking-freeipa-part-ii-enumeration-ad27224371e1)
* [https://www.youtube.com/watch?v=9dOu-7BTwPQ](https://www.youtube.com/watch?v=9dOu-7BTwPQ)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
