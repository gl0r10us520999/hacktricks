# Cookie Tossing

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Description

рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдПрдХ рдЙрдкрдбреЛрдореЗрди рдпрд╛ рдХрд┐рд╕реА рдХрдВрдкрдиреА рдХреЗ рдбреЛрдореЗрди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдПрдХ рдЙрдкрдбреЛрдореЗрди рдореЗрдВ XSS рдЦреЛрдЬрддрд╛ рд╣реИ** рддреЛ рд╡рд╣ рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред

рдЬреИрд╕рд╛ рдХрд┐ рдХреБрдХреАрдЬрд╝ рд╣реИрдХрд┐рдВрдЧ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрдм рдПрдХ **рдХреБрдХреА рдХреЛ рдПрдХ рдбреЛрдореЗрди рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЗрд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реБрдП) рддреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЛрдореЗрди рдФрд░ рдЙрдкрдбреЛрдореЗрди рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред**

{% hint style="danger" %}
рдЗрд╕рд▓рд┐рдП, **рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХреБрдХреА рдХреЛ рдбреЛрдореЗрди рдФрд░ рдЙрдкрдбреЛрдореЗрди рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ рдРрд╕рд╛ рдХреБрдЫ рдХрд░рддреЗ рд╣реБрдП** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

* **рд╢рд┐рдХрд╛рд░ рдХреА рдХреБрдХреА рдХреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдЦрд╛рддреЗ рдореЗрдВ рд╕реНрдерд┐рд░ рдХрд░рдирд╛** рддрд╛рдХрд┐ рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдзреНрдпрд╛рди рди рджреЗ, **рд╡рд╣ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдЦрд╛рддреЗ рдореЗрдВ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░реЗрдЧрд╛** рдФрд░ рд╣рдорд▓рд╛рд╡рд░ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЦреЛрдЬ рдЗрддрд┐рд╣рд╛рд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛, рд╢рд┐рдХрд╛рд░ рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдореЗрдВ рдЕрдкрдирд╛ рдХреНрд░реЗрдбрд┐рдЯ рдХрд╛рд░реНрдб рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ...)
* рдпрджрд┐ **рдХреБрдХреА рд▓реЙрдЧрд┐рди рдХреЗ рдмрд╛рдж рдирд╣реАрдВ рдмрджрд▓рддреА рд╣реИ**, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдмрд╕ **рдПрдХ рдХреБрдХреА рдХреЛ рд╕реНрдерд┐рд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рд╕рддреНрд░-рд╕реНрдерд┐рд░рддрд╛)**, рд╢рд┐рдХрд╛рд░ рдХреЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ **рдЙрд╕ рдХреБрдХреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢рд┐рдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред
* рдХрднреА-рдХрднреА, рднрд▓реЗ рд╣реА рд╕рддреНрд░ рдХреБрдХреАрдЬрд╝ рдмрджрд▓рддреА рд╣реИрдВ, рд╣рдорд▓рд╛рд╡рд░ рдкрд┐рдЫрд▓реЗ рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдирдпрд╛ рднреА рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ред
* рдпрджрд┐ **рдХреБрдХреА рдХреБрдЫ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдорд╛рди рд╕реЗрдЯ рдХрд░ рд░рд╣реА рд╣реИ** (рдЬреИрд╕реЗ рдХрд┐ рдлреНрд▓рд╛рд╕реНрдХ рдореЗрдВ рдЬрд╣рд╛рдВ **рдХреБрдХреА** **рд╕рддреНрд░ рдХрд╛ CSRF рдЯреЛрдХрди** рд╕реЗрдЯ рдХрд░ рд╕рдХрддреА рд╣реИ рдФрд░ рдпрд╣ рдорд╛рди рд╢рд┐рдХрд╛рд░ рдХреЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдмрдирд╛рдП рд░рдЦрд╛ рдЬрд╛рдПрдЧрд╛), рддреЛ **рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рдЬреНрдЮрд╛рдд рдорд╛рди рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** (рдЙрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ рдлрд┐рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ CSRF рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣ CSRF рдЯреЛрдХрди рдЬрд╛рдирддрд╛ рд╣реИ)ред
* рдорд╛рди рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд╕рдорд╛рди, рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЕрдирдзрд┐рдХреГрдд рдХреБрдХреА рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ, рдЙрд╕рд╕реЗ CSRF рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### Cookie Order

рдЬрдм рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХ рд╣реА рдирд╛рдо рдХреА рджреЛ рдХреБрдХреАрдЬрд╝ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рд╕рдорд╛рди рджрд╛рдпрд░реЗ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИрдВ** (рдбреЛрдореЗрди, рдЙрдкрдбреЛрдореЗрди рдФрд░ рдкрде), рддреЛ **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреЛрдиреЛрдВ рдХреБрдХреА рдХреЗ рдорд╛рди рднреЗрдЬреЗрдЧрд╛** рдЬрдм рджреЛрдиреЛрдВ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рд╣реЛрдВред

рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ **рд╕рдмрд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрде** рд╣реИ рдпрд╛ рдХреМрди рд╕рд╛ **рдкреБрд░рд╛рдирд╛ рд╣реИ**, рдмреНрд░рд╛рдЙрдЬрд╝рд░ **рдкрд╣рд▓реЗ рдХреБрдХреА рдХрд╛ рдорд╛рди рд╕реЗрдЯ рдХрд░реЗрдЧрд╛** рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ рдХрд╛ рдорд╛рди рдЬреИрд╕реЗ: `Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

рдЕрдзрд┐рдХрддрд░ **рд╡реЗрдмрд╕рд╛рдЗрдЯреЗрдВ рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреА**ред рдлрд┐рд░, рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреБрдХреА рд╕реЗрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреЗ рд╕реЗрдЯ рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗрдЯ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИ рдпрд╛ рдЗрд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрде рдХреЗ рд╕рд╛рде рд╕реЗрдЯ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИред

{% hint style="warning" %}
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдПрдХ рдЕрдзрд┐рдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрде рдореЗрдВ рдХреБрдХреА рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛** рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **рд╢рд┐рдХрд╛рд░ рдХреЛ рдЙрд╕рдХреА рдХреБрдХреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╕рд┐рд╡рд╛рдп рдЙрд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрде рдХреЗ рдЬрд╣рд╛рдВ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреБрдХреА рд╕реЗрдЯ рдХреА рдЧрдИ рд╣реЛрдЧреАред**
{% endhint %}

### Protection Bypass

рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕рдВрднрд╛рд╡рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдпрд╣ рд╣реЛ рд╕рдХрддреА рд╣реИ рдХрд┐ **рд╡реЗрдм рд╕рд░реНрд╡рд░ рдПрдХ рд╣реА рдирд╛рдо рдХреА рджреЛ рдХреБрдХреАрдЬрд╝ рдХреЛ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрд╡реАрдХрд╛рд░ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**ред

рдЙрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╣рд╛рдВ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдХреБрдХреА рд╕реЗрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрдм рд╢рд┐рдХрд╛рд░ рдХреЛ рдкрд╣рд▓реЗ рд╣реА рдХреБрдХреА рджреА рдЬрд╛ рдЪреБрдХреА рд╣реИ, рд╣рдорд▓рд╛рд╡рд░ рдПрдХ **рдХреБрдХреА рдУрд╡рд░рдлреНрд▓реЛ** рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░, рдПрдХ рдмрд╛рд░ рдЬрдм **рд╡реИрдз рдХреБрдХреА рд╣рдЯрд╛ рджреА рдЬрд╛рддреА рд╣реИ, рддреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреБрдХреА рд╕реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

рдПрдХ рдФрд░ рдЙрдкрдпреЛрдЧреА **рдмрд╛рдпрдкрд╛рд╕** рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ **рдХреБрдХреА рдХреЗ рдирд╛рдо рдХреЛ URL рдПрдиреНрдХреЛрдб рдХрд░реЗрдВ** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХ рд╣реА рдирд╛рдо рдХреА 2 рдХреБрдХреАрдЬрд╝ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕рд░реНрд╡рд░ рдХреБрдХреАрдЬрд╝ рдХреЗ рдирд╛рдореЛрдВ рдХреЛ рдбрд┐рдХреЛрдб рдХрд░реЗрдЧрд╛ред

### Cookie Bomb

рдПрдХ Cookie Tossing рд╣рдорд▓рд╛ рдПрдХ **Cookie Bomb** рд╣рдорд▓реЗ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

### Defense**s**

#### **рдХреБрдХреА рдирд╛рдо рдореЗрдВ `__Host` рдЙрдкрд╕рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**

* рдпрджрд┐ рдПрдХ рдХреБрдХреА рдирд╛рдо рдореЗрдВ рдпрд╣ рдЙрдкрд╕рд░реНрдЧ рд╣реИ, рддреЛ рдпрд╣ **рдХреЗрд╡рд▓ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛** рдпрджрд┐ рдЗрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕реЗ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдореВрд▓ рд╕реЗ рднреЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ рдПрдХ рдбреЛрдореЗрди рд╡рд┐рд╢реЗрд╖рддрд╛ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЗрд╕рдХрд╛ рдкрде рд╡рд┐рд╢реЗрд╖рддрд╛ / рдкрд░ рд╕реЗрдЯ рд╣реИред
* **рдпрд╣ рдЙрдкрдбреЛрдореЗрдиреЛрдВ рдХреЛ рд╢реАрд░реНрд╖ рдбреЛрдореЗрди рдкрд░ рдХреБрдХреА рдХреЛ рдордЬрдмреВрд░ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрди рдХреБрдХреАрдЬрд╝ рдХреЛ "рдбреЛрдореЗрди-рд▓реЙрдХреНрдб" рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

### References

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)
* [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
