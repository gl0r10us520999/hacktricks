{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}



**Verifique os detalhes completos desta t√©cnica em [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **Uploads de Arquivos PHP**

Quando um motor **PHP** recebe uma **requisi√ß√£o POST** contendo arquivos formatados de acordo com o RFC 1867, ele gera arquivos tempor√°rios para armazenar os dados enviados. Esses arquivos s√£o cruciais para o manuseio de uploads de arquivos em scripts PHP. A fun√ß√£o `move_uploaded_file` deve ser usada para realocar esses arquivos tempor√°rios para um local desejado se o armazenamento persistente al√©m da execu√ß√£o do script for necess√°rio. Ap√≥s a execu√ß√£o, o PHP exclui automaticamente quaisquer arquivos tempor√°rios restantes.

{% hint style="info" %}
**Alerta de Seguran√ßa: Atacantes, cientes da localiza√ß√£o dos arquivos tempor√°rios, podem explorar uma vulnerabilidade de Inclus√£o de Arquivo Local para executar c√≥digo acessando o arquivo durante o upload.**
{% endhint %}

O desafio para o acesso n√£o autorizado reside em prever o nome do arquivo tempor√°rio, que √© intencionalmente randomizado.

#### Explora√ß√£o em Sistemas Windows

No Windows, o PHP gera nomes de arquivos tempor√°rios usando a fun√ß√£o `GetTempFileName`, resultando em um padr√£o como `<path>\<pre><uuuu>.TMP`. Notavelmente:

- O caminho padr√£o √© tipicamente `C:\Windows\Temp`.
- O prefixo √© geralmente "php".
- O `<uuuu>` representa um valor hexadecimal √∫nico. Crucialmente, devido √† limita√ß√£o da fun√ß√£o, apenas os 16 bits inferiores s√£o usados, permitindo um m√°ximo de 65.535 nomes √∫nicos com caminho e prefixo constantes, tornando o ataque de for√ßa bruta vi√°vel.

Al√©m disso, o processo de explora√ß√£o √© simplificado em sistemas Windows. Uma peculiaridade na fun√ß√£o `FindFirstFile` permite o uso de curingas em caminhos de Inclus√£o de Arquivo Local (LFI). Isso possibilita a cria√ß√£o de um caminho de inclus√£o como o seguinte para localizar o arquivo tempor√°rio:
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
Em certas situa√ß√µes, uma m√°scara mais espec√≠fica (como `php1<<` ou `phpA<<`) pode ser necess√°ria. Pode-se tentar sistematicamente essas m√°scaras para descobrir o arquivo tempor√°rio carregado.

#### Explora√ß√£o em Sistemas GNU/Linux

Para sistemas GNU/Linux, a aleatoriedade na nomea√ß√£o de arquivos tempor√°rios √© robusta, tornando os nomes nem previs√≠veis nem suscet√≠veis a ataques de for√ßa bruta. Mais detalhes podem ser encontrados na documenta√ß√£o referenciada.


{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
