{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}



**V√©rifiez les d√©tails complets de cette technique sur [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **T√©l√©chargements de fichiers PHP**

Lorsqu'un moteur **PHP** re√ßoit une **requ√™te POST** contenant des fichiers format√©s selon la RFC 1867, il g√©n√®re des fichiers temporaires pour stocker les donn√©es t√©l√©charg√©es. Ces fichiers sont cruciaux pour la gestion des t√©l√©chargements de fichiers dans les scripts PHP. La fonction `move_uploaded_file` doit √™tre utilis√©e pour d√©placer ces fichiers temporaires vers un emplacement souhait√© si un stockage persistant au-del√† de l'ex√©cution du script est n√©cessaire. Apr√®s l'ex√©cution, PHP supprime automatiquement tous les fichiers temporaires restants.

{% hint style="info" %}
**Alerte de s√©curit√© : Les attaquants, conscients de l'emplacement des fichiers temporaires, pourraient exploiter une vuln√©rabilit√© d'inclusion de fichiers locaux pour ex√©cuter du code en acc√©dant au fichier pendant le t√©l√©chargement.**
{% endhint %}

Le d√©fi pour un acc√®s non autoris√© r√©side dans la pr√©diction du nom du fichier temporaire, qui est intentionnellement al√©atoire.

#### Exploitation sur les syst√®mes Windows

Sur Windows, PHP g√©n√®re des noms de fichiers temporaires en utilisant la fonction `GetTempFileName`, ce qui donne un motif comme `<path>\<pre><uuuu>.TMP`. Notamment :

- Le chemin par d√©faut est g√©n√©ralement `C:\Windows\Temp`.
- Le pr√©fixe est g√©n√©ralement "php".
- Le `<uuuu>` repr√©sente une valeur hexad√©cimale unique. Crucialement, en raison de la limitation de la fonction, seuls les 16 bits inf√©rieurs sont utilis√©s, permettant un maximum de 65,535 noms uniques avec un chemin et un pr√©fixe constants, rendant la force brute r√©alisable.

De plus, le processus d'exploitation est simplifi√© sur les syst√®mes Windows. Une particularit√© de la fonction `FindFirstFile` permet l'utilisation de caract√®res g√©n√©riques dans les chemins d'inclusion de fichiers locaux (LFI). Cela permet de cr√©er un chemin d'inclusion comme suit pour localiser le fichier temporaire :
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
Dans certaines situations, un masque plus sp√©cifique (comme `php1<<` ou `phpA<<`) peut √™tre requis. On peut syst√©matiquement essayer ces masques pour d√©couvrir le fichier temporaire t√©l√©charg√©.

#### Exploitation sur les syst√®mes GNU/Linux

Pour les syst√®mes GNU/Linux, le caract√®re al√©atoire dans la nomination des fichiers temporaires est robuste, rendant les noms ni pr√©visibles ni susceptibles aux attaques par force brute. D'autres d√©tails peuvent √™tre trouv√©s dans la documentation r√©f√©renc√©e.
