# LFI2RCE via PHP\_SESSION\_UPLOAD\_PROGRESS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

**ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã„**å ´åˆã§ã‚‚ã€`session.auto_start`ãŒ`Off`ã§ã‚ã£ã¦ã‚‚ã€**`session.upload_progress.enabled`**ãŒ**`On`**ã§ã‚ã‚Šã€**multipart POST**ãƒ‡ãƒ¼ã‚¿ã«**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’æä¾›ã™ã‚‹ã¨ã€PHPã¯**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ã¾ã™**ã€‚
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
æ³¨æ„ã—ã¦ãã ã•ã„ã€**`PHP_SESSION_UPLOAD_PROGRESS`**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡**ã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã‚‹ã¨ã€åˆ¶å¾¡ã§ãã‚‹éƒ¨åˆ†ï¼ˆä¾‹ãˆã°ã€phpã‚·ã‚§ãƒ«ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="info" %}
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã»ã¨ã‚“ã©ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã€ãƒ‡ãƒãƒƒã‚°ç›®çš„ã§`session.upload_progress.cleanup`ã‚’`Off`ã«è¨­å®šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€PHPã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`session.upload_progress.cleanup`ã¯ä¾ç„¶ã¨ã—ã¦`On`ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²è¡ŒçŠ¶æ³ãŒã§ãã‚‹ã ã‘æ—©ãã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã¯**ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³**ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

### CTF

ã“ã®æŠ€è¡“ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸ[**å…ƒã®CTF**](https://blog.orange.tw/2018/10/)ã§ã¯ã€ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ä¸ååˆ†ã§ã€èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚‚`@<?php`ã¨ã„ã†æ–‡å­—åˆ—ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

`session.upload_progress.prefix`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«ã‚ˆã‚Šã€ç§ãŸã¡ã®**SESSIONãƒ•ã‚¡ã‚¤ãƒ«ã¯ç…©ã‚ã—ã„ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹**`upload_progress_`ã§å§‹ã¾ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼š`upload_progress_controlledcontentbyattacker`

**åˆæœŸãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤ã™ã‚‹**ãƒˆãƒªãƒƒã‚¯ã¯ã€**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’3å›base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰**ã—ã€ãã®å¾Œ`convert.base64-decode`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä»‹ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã—ãŸã€‚ã“ã‚Œã¯ã€**base64ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã«PHPãŒå¥‡å¦™ãªæ–‡å­—ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚**ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€3å›å¾Œã«ã¯**æ”»æ’ƒè€…ã«ã‚ˆã£ã¦é€ä¿¡ã•ã‚ŒãŸ** **ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰** **ã®ã¿**ãŒ**æ®‹ã‚Šã¾ã™**ï¼ˆãã®å¾Œã€æ”»æ’ƒè€…ã¯åˆæœŸéƒ¨åˆ†ã‚’åˆ¶å¾¡ã§ãã¾ã™ï¼‰ã€‚

å…ƒã®è©³ç´°ã¯[https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/)ã«ã‚ã‚Šã€æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã¯[https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)ã«ã‚ã‚Šã¾ã™ã€‚\
åˆ¥ã®è©³ç´°ã¯[https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)ã«ã‚ã‚Šã¾ã™ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
