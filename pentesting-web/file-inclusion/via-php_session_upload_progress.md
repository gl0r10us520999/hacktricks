# LFI2RCE via PHP\_SESSION\_UPLOAD\_PROGRESS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Info

**ë¡œì»¬ íŒŒì¼ í¬í•¨** ì·¨ì•½ì ì„ ë°œê²¬í•œ ê²½ìš°, **ì„¸ì…˜ì´ ì—†ë”ë¼ë„** `session.auto_start`ê°€ `Off`ì¸ ê²½ìš°ì—ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. **`session.upload_progress.enabled`**ê°€ **`On`**ì´ê³  **multipart POST** ë°ì´í„°ì— **`PHP_SESSION_UPLOAD_PROGRESS`**ë¥¼ ì œê³µí•˜ë©´, PHPëŠ” **ì„¸ì…˜ì„ í™œì„±í™”í•©ë‹ˆë‹¤**.
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
Note that with **`PHP_SESSION_UPLOAD_PROGRESS`** you can **control data inside the session**, so if you includes your session file you can include a part you control (a php shellcode for example).

{% hint style="info" %}
ì¸í„°ë„·ì˜ ëŒ€ë¶€ë¶„ì˜ íŠœí† ë¦¬ì–¼ì€ ë””ë²„ê¹… ëª©ì ìœ¼ë¡œ `session.upload_progress.cleanup`ì„ `Off`ë¡œ ì„¤ì •í•  ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. PHPì˜ ê¸°ë³¸ `session.upload_progress.cleanup`ì€ ì—¬ì „íˆ `On`ì…ë‹ˆë‹¤. ì´ëŠ” ì„¸ì…˜ì˜ ì—…ë¡œë“œ ì§„í–‰ ìƒí™©ì´ ê°€ëŠ¥í•œ í•œ ë¹¨ë¦¬ ì •ë¦¬ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ê²ƒì€ **ê²½ìŸ ì¡°ê±´**ì´ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### The CTF

[**ì›ë˜ CTF**](https://blog.orange.tw/2018/10/)ì—ì„œ ì´ ê¸°ìˆ ì´ ì–¸ê¸‰ë˜ì—ˆì„ ë•Œ, ê²½ìŸ ì¡°ê±´ì„ ì•…ìš©í•˜ê¸°ì—ëŠ” ì¶©ë¶„í•˜ì§€ ì•Šì•˜ê³  ë¡œë“œëœ ì½˜í…ì¸ ëŠ” ë˜í•œ ë¬¸ìì—´ `@<?php`ë¡œ ì‹œì‘í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ ì„¤ì •ì¸ `session.upload_progress.prefix` ë•Œë¬¸ì—, ìš°ë¦¬ì˜ **SESSION íŒŒì¼ì€ ì„±ê°€ì‹  ì ‘ë‘ì‚¬** `upload_progress_`ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ì˜ˆ: `upload_progress_controlledcontentbyattacker`

**ì´ˆê¸° ì ‘ë‘ì‚¬**ë¥¼ **ì œê±°í•˜ëŠ” ìš”ë ¹**ì€ **í˜ì´ë¡œë“œë¥¼ 3ë²ˆ base64 ì¸ì½”ë”©**í•œ ë‹¤ìŒ `convert.base64-decode` í•„í„°ë¥¼ í†µí•´ ë””ì½”ë”©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” **base64 ë””ì½”ë”© ì‹œ PHPê°€ ì´ìƒí•œ ë¬¸ìë¥¼ ì œê±°í•˜ê¸° ë•Œë¬¸**ì…ë‹ˆë‹¤. ë”°ë¼ì„œ 3ë²ˆ í›„ì— **ì˜¤ì§** ê³µê²©ìê°€ **ì „ì†¡í•œ í˜ì´ë¡œë“œ**ë§Œ **ë‚¨ê²Œ ë©ë‹ˆë‹¤** (ê·¸ í›„ ê³µê²©ìëŠ” ì´ˆê¸° ë¶€ë¶„ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).

ìì„¸í•œ ì •ë³´ëŠ” ì›ë˜ ì‘ì„±ë¬¼ [https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/)ê³¼ ìµœì¢… ìµìŠ¤í”Œë¡œì‡ [https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)\
ë˜ ë‹¤ë¥¸ ì‘ì„±ë¬¼ì€ [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
