# DOM Invader

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## DOM Invader

DOM Invaderは、Burpの内蔵ブラウザにインストールされたブラウザツールです。これは、ウェブメッセージやプロトタイプ汚染を含むさまざまなソースとシンクを使用して、**DOM XSS脆弱性を検出する**のを支援します。このツールは拡張機能として事前にインストールされています。

DOM Invaderは、ブラウザのDevToolsパネル内にタブを統合し、以下を可能にします：

1. **DOM XSSテストのためのウェブページ上の制御可能なシンクの特定**、コンテキストとサニタイズの詳細を提供します。
2. **`postMessage()`メソッドを介して送信されたウェブメッセージのログ、編集、および再送信**。DOM Invaderは、特別に作成されたウェブメッセージを使用して脆弱性を自動検出することもできます。
3. **クライアントサイドのプロトタイプ汚染**ソースの検出と、リスクのあるシンクに送信される制御可能なガジェットのスキャン。
4. **DOMクラッキング脆弱性の特定**。

### 有効にする

Burpの内蔵ブラウザで**Burp拡張機能**に移動し、有効にします：

<figure><img src="../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

ページをリフレッシュすると、**Dev Tools**に**DOM Invaderタブ**が表示されます：

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

### カナリアを注入する

前の画像には、**ランダムな文字のグループ、つまりカナリア**が表示されています。これをウェブのさまざまな部分（パラメータ、フォーム、URLなど）に**注入**し、毎回検索をクリックしてください。DOM Invaderは、**カナリアが利用可能な興味深いシンクに到達したかどうか**を確認します。

さらに、**URLパラメータを注入**するオプションとフォームを注入するオプションは、自動的に**新しいタブ**を開き、見つけたすべての**URL**パラメータと**フォーム**に**カナリアを注入**します。

### 空のカナリアを注入する

ページに潜在的なシンクがあるかどうかを見つけたいだけの場合、たとえそれが悪用できなくても、**空のカナリアを検索**できます。

### メッセージを投稿する

DOM Invaderは、以下の機能を持つウェブメッセージを使用してDOM XSSをテストすることを可能にします：

1. **`postMessage()`を介して送信されたウェブメッセージのログ**、Burp ProxyのHTTPリクエスト/レスポンス履歴ログに似ています。
2. **ウェブメッセージの** **変更**と**再発行**、手動でDOM XSSをテストするため、Burp Repeaterの機能に似ています。
3. **自動的な変更**とウェブメッセージの送信によるDOM XSSの調査。

#### メッセージの詳細

各メッセージをクリックすると、メッセージの詳細情報が表示され、クライアントサイドのJavaScriptがメッセージの`origin`、`data`、または`source`プロパティにアクセスするかどうかが含まれます。

* **`origin`** : メッセージの**オリジン情報がチェックされていない場合**、任意の外部ドメインからイベントハンドラーにクロスオリジンメッセージを送信できる可能性があります。しかし、チェックされている場合でも、安全でない可能性があります。
* **`data`**: ここにペイロードが送信されます。このデータが使用されない場合、シンクは無意味です。
* **`source`**: 通常はiframeを参照するソースプロパティがオリジンの代わりに検証されているかどうかを評価します。これがチェックされていても、検証がバイパスされないことは保証されません。

#### メッセージに返信する

1. **Messages**ビューから、任意のメッセージをクリックしてメッセージ詳細ダイアログを開きます。
2. 必要に応じて**Data**フィールドを編集します。
3. **Send**をクリックします。

### プロトタイプ汚染

DOM Invaderは、**プロトタイプ汚染脆弱性**を検索することもできます。まず、有効にする必要があります：

<figure><img src="../../.gitbook/assets/image (1026).png" alt=""><figcaption></figcaption></figure>

次に、**`Object.prototype`**に任意のプロパティを追加できる**ソース**を検索します。

何かが見つかると、**見つかったソースをテストする**ための**Test**ボタンが表示されます。それをクリックすると、新しいタブが表示され、コンソールでオブジェクトを作成し、`testproperty`が存在するかどうかを確認します：
```javascript
let b = {}
b.testproperty
```
一度ソースを見つけると、**ガジェットをスキャン**できます：

1. **DOM**ビューの任意の特定されたプロトタイプ汚染ソースの隣にある**ガジェットをスキャン**ボタンをクリックすると、DOM Invaderによって新しいタブが開かれます。適切なガジェットのスキャンが始まります。
2. 同時に、同じタブでDevToolsパネルに**DOM Invader**タブが開かれている必要があります。スキャンが完了すると、特定されたガジェットを介してアクセス可能なシンクが**DOM**ビューに表示されます。例えば、`innerHTML`シンクに渡される`html`という名前のガジェットプロパティが以下の例に示されています。

## DOMクラッキング

前の画像では、DOMクラッキングスキャンをオンにできることがわかります。完了すると、**DOM InvaderはDOMクラッキングの脆弱性を探し始めます**。

## 参考文献

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{% hint style="success" %}
AWSハッキングを学び、練習する：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングを学び、練習する：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してハッキングトリックを共有してください。**

</details>
{% endhint %}
