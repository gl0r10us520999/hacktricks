# DOM Invader

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## DOM Invader

DOM Invader æ˜¯ä¸€ä¸ªå®‰è£…åœ¨ Burp å†…ç½®æµè§ˆå™¨ä¸­çš„å·¥å…·ã€‚å®ƒé€šè¿‡å„ç§æ¥æºå’Œæ¥æ”¶ç‚¹ï¼ŒåŒ…æ‹¬ç½‘ç»œæ¶ˆæ¯å’ŒåŸå‹æ±¡æŸ“ï¼Œå¸®åŠ© **æ£€æµ‹ DOM XSS æ¼æ´**ã€‚è¯¥å·¥å…·ä½œä¸ºæ‰©å±•é¢„å®‰è£…ã€‚

DOM Invader åœ¨æµè§ˆå™¨çš„ DevTools é¢æ¿ä¸­é›†æˆäº†ä¸€ä¸ªé€‰é¡¹å¡ï¼Œæ”¯æŒä»¥ä¸‹åŠŸèƒ½ï¼š

1. **è¯†åˆ«ç½‘é¡µä¸Šçš„å¯æ§æ¥æ”¶ç‚¹** ä»¥è¿›è¡Œ DOM XSS æµ‹è¯•ï¼Œæä¾›ä¸Šä¸‹æ–‡å’Œæ¸…ç†ç»†èŠ‚ã€‚
2. **è®°å½•ã€ç¼–è¾‘å’Œé‡æ–°å‘é€é€šè¿‡ `postMessage()` æ–¹æ³•å‘é€çš„ç½‘ç»œæ¶ˆæ¯** ä»¥è¿›è¡Œ DOM XSS æµ‹è¯•ã€‚DOM Invader è¿˜å¯ä»¥ä½¿ç”¨ç‰¹åˆ«æ„é€ çš„ç½‘ç»œæ¶ˆæ¯è‡ªåŠ¨æ£€æµ‹æ¼æ´ã€‚
3. æ£€æµ‹ **å®¢æˆ·ç«¯åŸå‹æ±¡æŸ“** æ¥æºå¹¶æ‰«æå‘é€åˆ°é£é™©æ¥æ”¶ç‚¹çš„å¯æ§å°å·¥å…·ã€‚
4. è¯†åˆ« **DOM è¦†ç›–æ¼æ´**ã€‚

### å¯ç”¨å®ƒ

åœ¨ Burp çš„å†…ç½®æµè§ˆå™¨ä¸­ï¼Œè½¬åˆ° **Burp æ‰©å±•** å¹¶å¯ç”¨å®ƒï¼š

<figure><img src="../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

ç°åœ¨åˆ·æ–°é¡µé¢ï¼Œåœ¨ **Dev Tools** ä¸­ä½ ä¼šæ‰¾åˆ° **DOM Invader é€‰é¡¹å¡ï¼š**

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

### æ³¨å…¥ä¸€ä¸ª Canary

åœ¨å‰é¢çš„å›¾åƒä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ª **éšæœºå­—ç¬¦ç»„ï¼Œå³ Canary**ã€‚ä½ ç°åœ¨åº”è¯¥å¼€å§‹ **åœ¨ç½‘é¡µçš„ä¸åŒéƒ¨åˆ†ï¼ˆå‚æ•°ã€è¡¨å•ã€URL...ï¼‰æ³¨å…¥** å®ƒï¼Œå¹¶æ¯æ¬¡ç‚¹å‡»æœç´¢ã€‚DOM Invader å°†æ£€æŸ¥ **canary æ˜¯å¦ç»“æŸäºä»»ä½•æœ‰è¶£çš„æ¥æ”¶ç‚¹**ï¼Œå¯èƒ½è¢«åˆ©ç”¨ã€‚

æ­¤å¤–ï¼Œé€‰é¡¹ **Inject URL params** å’Œ **Inject forms** å°†è‡ªåŠ¨æ‰“å¼€ä¸€ä¸ª **æ–°é€‰é¡¹å¡**ï¼Œ**æ³¨å…¥** æ¯ä¸ªæ‰¾åˆ°çš„ **URL** å‚æ•°å’Œ **è¡¨å•** ä¸­çš„ **canary**ã€‚

### æ³¨å…¥ä¸€ä¸ªç©º Canary

å¦‚æœä½ åªæƒ³æ‰¾åˆ°é¡µé¢å¯èƒ½å­˜åœ¨çš„æ½œåœ¨æ¥æ”¶ç‚¹ï¼Œå³ä½¿å®ƒä»¬ä¸å¯åˆ©ç”¨ï¼Œä½ å¯ä»¥ **æœç´¢ä¸€ä¸ªç©ºçš„ canary**ã€‚

### å‘é€æ¶ˆæ¯

DOM Invader å…è®¸ä½¿ç”¨ç½‘ç»œæ¶ˆæ¯æµ‹è¯• DOM XSSï¼Œå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **è®°å½•é€šè¿‡ `postMessage()` å‘é€çš„ç½‘ç»œæ¶ˆæ¯**ï¼Œç±»ä¼¼äº Burp Proxy çš„ HTTP è¯·æ±‚/å“åº”å†å²è®°å½•æ—¥å¿—ã€‚
2. **ä¿®æ”¹** å’Œ **é‡æ–°å‘é€** ç½‘ç»œæ¶ˆæ¯ä»¥æ‰‹åŠ¨æµ‹è¯• DOM XSSï¼Œç±»ä¼¼äº Burp Repeater çš„åŠŸèƒ½ã€‚
3. **è‡ªåŠ¨æ›´æ”¹** å’Œå‘é€ç½‘ç»œæ¶ˆæ¯ä»¥æ¢æµ‹ DOM XSSã€‚

#### æ¶ˆæ¯è¯¦æƒ…

é€šè¿‡ç‚¹å‡»æ¯æ¡æ¶ˆæ¯ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯ JavaScript æ˜¯å¦è®¿é—®æ¶ˆæ¯çš„ `origin`ã€`data` æˆ– `source` å±æ€§ã€‚

* **`origin`** : å¦‚æœ **æ¶ˆæ¯çš„æ¥æºä¿¡æ¯æœªæ£€æŸ¥**ï¼Œä½ å¯èƒ½èƒ½å¤Ÿä» **ä»»æ„å¤–éƒ¨åŸŸ** å‘äº‹ä»¶å¤„ç†ç¨‹åºå‘é€è·¨åŸŸæ¶ˆæ¯ã€‚ä½†å¦‚æœè¿›è¡Œäº†æ£€æŸ¥ï¼Œä»ç„¶å¯èƒ½ä¸å®‰å…¨ã€‚
* **`data`**: è¿™æ˜¯å‘é€æœ‰æ•ˆè´Ÿè½½çš„åœ°æ–¹ã€‚å¦‚æœæ­¤æ•°æ®æœªä½¿ç”¨ï¼Œåˆ™æ¥æ”¶ç‚¹æ— ç”¨ã€‚
* **`source`**: è¯„ä¼°æºå±æ€§ï¼Œé€šå¸¸å¼•ç”¨ä¸€ä¸ª iframeï¼Œæ˜¯å¦ç»è¿‡éªŒè¯è€Œä¸æ˜¯æ¥æºã€‚å³ä½¿è¿›è¡Œäº†æ£€æŸ¥ï¼Œä¹Ÿä¸èƒ½ä¿è¯éªŒè¯æ— æ³•è¢«ç»•è¿‡ã€‚

#### å›å¤æ¶ˆæ¯

1. ä» **æ¶ˆæ¯** è§†å›¾ä¸­ï¼Œç‚¹å‡»ä»»ä½•æ¶ˆæ¯ä»¥æ‰“å¼€æ¶ˆæ¯è¯¦æƒ…å¯¹è¯æ¡†ã€‚
2. æ ¹æ®éœ€è¦ç¼–è¾‘ **æ•°æ®** å­—æ®µã€‚
3. ç‚¹å‡» **å‘é€**ã€‚

### åŸå‹æ±¡æŸ“

DOM Invader è¿˜å¯ä»¥æœç´¢ **åŸå‹æ±¡æŸ“æ¼æ´**ã€‚é¦–å…ˆï¼Œä½ éœ€è¦å¯ç”¨å®ƒï¼š

<figure><img src="../../.gitbook/assets/image (1026).png" alt=""><figcaption></figcaption></figure>

ç„¶åï¼Œå®ƒå°† **æœç´¢æ¥æº**ï¼Œä½¿ä½ èƒ½å¤Ÿå‘ **`Object.prototype`** æ·»åŠ ä»»æ„å±æ€§ã€‚

å¦‚æœæ‰¾åˆ°ä»»ä½•å†…å®¹ï¼Œå°†å‡ºç°ä¸€ä¸ª **æµ‹è¯•** æŒ‰é’®ä»¥ **æµ‹è¯•æ‰¾åˆ°çš„æ¥æº**ã€‚ç‚¹å‡»å®ƒï¼Œå°†å‡ºç°ä¸€ä¸ªæ–°é€‰é¡¹å¡ï¼Œåœ¨æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶æ£€æŸ¥ `testproperty` æ˜¯å¦å­˜åœ¨ï¼š
```javascript
let b = {}
b.testproperty
```
ä¸€æ—¦ä½ æ‰¾åˆ°ä¸€ä¸ªæºï¼Œä½ å¯ä»¥**æ‰«æå°å·¥å…·**ï¼š

1. å½“ç‚¹å‡»**DOM**è§†å›¾ä¸­ä»»ä½•å·²è¯†åˆ«çš„åŸå‹æ±¡æŸ“æºæ—è¾¹çš„**æ‰«æå°å·¥å…·**æŒ‰é’®æ—¶ï¼ŒDOM Invaderä¼šæ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µã€‚ç„¶åå¼€å§‹æ‰«æåˆé€‚çš„å°å·¥å…·ã€‚
2. ä¸æ­¤åŒæ—¶ï¼Œåœ¨åŒä¸€æ ‡ç­¾é¡µä¸­ï¼ŒDevToolsé¢æ¿åº”è¯¥æ‰“å¼€**DOM Invader**æ ‡ç­¾ã€‚åœ¨æ‰«æå®Œæˆåï¼Œé€šè¿‡å·²è¯†åˆ«çš„å°å·¥å…·è®¿é—®çš„ä»»ä½•æ¥æ”¶ç‚¹å°†åœ¨**DOM**è§†å›¾ä¸­æ˜¾ç¤ºã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä¸­æ˜¾ç¤ºäº†ä¸€ä¸ªåä¸º`html`çš„å°å·¥å…·å±æ€§è¢«ä¼ é€’åˆ°`innerHTML`æ¥æ”¶ç‚¹ã€‚

## DOMæ±¡æŸ“

åœ¨å‰é¢çš„å›¾åƒä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¯ä»¥å¼€å¯DOMæ±¡æŸ“æ‰«æã€‚ä¸€æ—¦å®Œæˆï¼Œ**DOM Invaderå°†å¼€å§‹æœç´¢DOMæ±¡æŸ“æ¼æ´**ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
