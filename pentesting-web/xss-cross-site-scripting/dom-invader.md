# DOM Invader

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## DOM Invader

DOM Invader est un outil de navigateur install√© dans le navigateur int√©gr√© de Burp. Il aide √† **d√©tecter les vuln√©rabilit√©s XSS DOM** en utilisant diverses sources et √©viers, y compris les messages web et la pollution de prototype. L'outil est pr√©install√© en tant qu'extension.

DOM Invader int√®gre un onglet dans le panneau DevTools du navigateur permettant les actions suivantes :

1. **Identification des √©viers contr√¥lables** sur une page web pour les tests XSS DOM, fournissant des d√©tails de contexte et de d√©sinfection.
2. **Journalisation, √©dition et renvoi des messages web** envoy√©s via la m√©thode `postMessage()` pour les tests XSS DOM. DOM Invader peut √©galement d√©tecter automatiquement les vuln√©rabilit√©s en utilisant des messages web sp√©cialement con√ßus.
3. D√©tection des **sources de pollution de prototype c√¥t√© client** et analyse des gadgets contr√¥lables envoy√©s √† des √©viers risqu√©s.
4. Identification des **vuln√©rabilit√©s de clobbering DOM**.

### Enable It

Dans le navigateur int√©gr√© de Burp, allez √† l'**extension Burp** et activez-la :

<figure><img src="../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

Maintenant, rafra√Æchissez la page et dans les **Dev Tools**, vous trouverez l'**onglet DOM Invader :**

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

### Inject a Canary

Dans l'image pr√©c√©dente, vous pouvez voir un **groupe al√©atoire de caract√®res, c'est le Canary**. Vous devriez maintenant commencer √† **l'injecter** dans diff√©rentes parties du web (params, formulaires, url...) et chaque fois cliquer pour le rechercher. DOM Invader v√©rifiera si le **canary s'est termin√© dans un √©vier int√©ressant** qui pourrait √™tre exploit√©.

De plus, les options **Inject URL params** et Inject forms ouvriront automatiquement un **nouvel onglet** **injectant** le **canary** dans chaque **param√®tre URL** et **formulaire** qu'il trouve.

### Inject an empty Canary

Si vous voulez juste trouver des √©viers potentiels que la page pourrait avoir, m√™me s'ils ne sont pas exploitables, vous pouvez **chercher un canary vide**.

### Post Messages

DOM Invader permet de tester les XSS DOM en utilisant des messages web avec des fonctionnalit√©s telles que :

1. **Journalisation des messages web** envoy√©s via `postMessage()`, semblable √† l'historique de journalisation des requ√™tes/r√©ponses HTTP de Burp Proxy.
2. **Modification** et **r√©√©mission** des messages web pour tester manuellement les XSS DOM, similaire √† la fonction de Burp Repeater.
3. **Alt√©ration automatique** et envoi de messages web pour sonder les XSS DOM.

#### Message details

Des informations d√©taill√©es peuvent √™tre consult√©es sur chaque message en cliquant dessus, y compris si le JavaScript c√¥t√© client acc√®de aux propri√©t√©s `origin`, `data` ou `source` du message.

* **`origin`** : Si les **informations d'origine du message ne sont pas v√©rifi√©es**, vous pourriez √™tre en mesure d'envoyer des messages inter-domaines au gestionnaire d'√©v√©nements **depuis un domaine externe arbitraire**. Mais si c'est v√©rifi√©, cela pourrait encore √™tre non s√©curis√©.
* **`data`** : C'est ici que la charge utile est envoy√©e. Si ces donn√©es ne sont pas utilis√©es, l'√©vier est inutile.
* **`source`** : √âvalue si la propri√©t√© source, g√©n√©ralement r√©f√©renc√©e par un iframe, est valid√©e au lieu de l'origine. M√™me si cela est v√©rifi√©, cela ne garantit pas que la validation ne peut pas √™tre contourn√©e.

#### Reply a message

1. Dans la vue **Messages**, cliquez sur n'importe quel message pour ouvrir la bo√Æte de dialogue des d√©tails du message.
2. Modifiez le champ **Data** selon vos besoins.
3. Cliquez sur **Send**.

### Prototype Pollution

DOM Invader peut √©galement rechercher des **vuln√©rabilit√©s de pollution de prototype**. Tout d'abord, vous devez l'activer :

<figure><img src="../../.gitbook/assets/image (1026).png" alt=""><figcaption></figcaption></figure>

Ensuite, il **recherchera des sources** qui vous permettent d'ajouter des propri√©t√©s arbitraires √† **`Object.prototype`**.

Si quelque chose est trouv√©, un bouton **Test** appara√Ætra pour **tester la source trouv√©e**. Cliquez dessus, un nouvel onglet appara√Ætra, cr√©ez un objet dans la console et v√©rifiez si la `testproperty` existe :
```javascript
let b = {}
b.testproperty
```
Une fois que vous avez trouv√© une source, vous pouvez **scanner pour un gadget** :

1. Un nouvel onglet est ouvert par DOM Invader lorsque le bouton **Scan for gadgets**, qui se trouve √† c√¥t√© de toute source de pollution de prototype identifi√©e dans la vue **DOM**, est cliqu√©. Le scan pour des gadgets appropri√©s commence alors.
2. Pendant ce temps, dans le m√™me onglet, l'onglet **DOM Invader** devrait √™tre ouvert dans le panneau DevTools. Une fois le scan termin√©, tous les sinks accessibles via les gadgets identifi√©s sont affich√©s dans la vue **DOM**. Par exemple, une propri√©t√© de gadget nomm√©e `html` √©tant pass√©e au sink `innerHTML` est montr√©e dans l'exemple ci-dessous.

## DOM clobbering

Dans l'image pr√©c√©dente, il est possible de voir que le scan de DOM clobbering peut √™tre activ√©. Une fois cela fait, **DOM Invader commencera √† rechercher des vuln√©rabilit√©s de DOM clobbering**.

## R√©f√©rences

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
