# DOM Invader

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## DOM Invader

DOM Invader ist ein Browser-Tool, das im integrierten Browser von Burp installiert ist. Es hilft bei der **Erkennung von DOM XSS-Schwachstellen** mithilfe verschiedener Quellen und Senken, einschlie√ülich Webnachrichten und Prototyp-Verschmutzung. Das Tool ist als Erweiterung vorinstalliert.

DOM Invader integriert einen Tab im DevTools-Panel des Browsers, der Folgendes erm√∂glicht:

1. **Identifizierung von kontrollierbaren Senken** auf einer Webseite f√ºr DOM XSS-Tests, die Kontext- und Sanitierungsdetails bereitstellt.
2. **Protokollierung, Bearbeitung und erneutes Senden von Webnachrichten**, die √ºber die `postMessage()`-Methode f√ºr DOM XSS-Tests gesendet werden. DOM Invader kann auch automatisch Schwachstellen mithilfe speziell gestalteter Webnachrichten erkennen.
3. Erkennung von **client-seitigen Prototyp-Verschmutzungsquellen** und Scannen von kontrollierbaren Gadgets, die an riskante Senken gesendet werden.
4. Identifizierung von **DOM-Clobbering-Schwachstellen**.

### Aktiviere es

Gehe im integrierten Browser von Burp zur **Burp-Erweiterung** und aktiviere sie:

<figure><img src="../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

Jetzt aktualisiere die Seite und im **Dev Tools** findest du den **DOM Invader-Tab:**

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

### Injiziere einen Canary

Im vorherigen Bild siehst du eine **zuf√§llige Gruppe von Zeichen, das ist der Canary**. Du solltest jetzt beginnen, ihn in verschiedenen Teilen des Webs (Parameter, Formulare, URL...) zu **injizieren** und jedes Mal auf Suchen klicken. DOM Invader wird √ºberpr√ºfen, ob der **Canary in einer interessanten Senke** gelandet ist, die ausgenutzt werden k√∂nnte.

Dar√ºber hinaus √∂ffnen die Optionen **Inject URL params** und **Inject forms** automatisch einen **neuen Tab**, der den **Canary** in jeden **URL**-Parameter und **Formular** injiziert, den er findet.

### Injiziere einen leeren Canary

Wenn du nur potenzielle Senken finden m√∂chtest, die die Seite haben k√∂nnte, auch wenn sie nicht ausnutzbar sind, kannst du **nach einem leeren Canary suchen**.

### Post-Nachrichten

DOM Invader erm√∂glicht das Testen von DOM XSS mithilfe von Webnachrichten mit Funktionen wie:

1. **Protokollierung von Webnachrichten**, die √ºber `postMessage()` gesendet werden, √§hnlich der Protokollierung des HTTP-Anforderungs-/Antwortverlaufs von Burp Proxy.
2. **√Ñnderung** und **erneutes Senden** von Webnachrichten, um manuell auf DOM XSS zu testen, √§hnlich der Funktion von Burp Repeater.
3. **Automatische √Ñnderung** und das Senden von Webnachrichten zur √úberpr√ºfung von DOM XSS.

#### Nachrichtendetails

Detaillierte Informationen zu jeder Nachricht k√∂nnen durch Klicken darauf angezeigt werden, einschlie√ülich, ob das client-seitige JavaScript auf die Eigenschaften `origin`, `data` oder `source` der Nachricht zugreift.

* **`origin`** : Wenn die **Ursprungsinformationen der Nachricht nicht √ºberpr√ºft werden**, kannst du m√∂glicherweise Cross-Origin-Nachrichten an den Ereignishandler **von einer beliebigen externen Domain** senden. Aber wenn es √ºberpr√ºft wird, k√∂nnte es trotzdem unsicher sein.
* **`data`**: Hier wird die Payload gesendet. Wenn diese Daten nicht verwendet werden, ist die Senke nutzlos.
* **`source`**: Bewertet, ob die Quell-Eigenschaft, die normalerweise auf ein iframe verweist, anstelle des Ursprungs validiert wird. Selbst wenn dies √ºberpr√ºft wird, garantiert es nicht, dass die Validierung nicht umgangen werden kann.

#### Antwort auf eine Nachricht

1. Klicke im **Nachrichten**-Bereich auf eine beliebige Nachricht, um das Dialogfeld mit den Nachrichtendetails zu √∂ffnen.
2. Bearbeite das **Daten**-Feld nach Bedarf.
3. Klicke auf **Senden**.

### Prototyp-Verschmutzung

DOM Invader kann auch nach **Prototype Pollution-Schwachstellen** suchen. Zuerst musst du es aktivieren:

<figure><img src="../../.gitbook/assets/image (1026).png" alt=""><figcaption></figcaption></figure>

Dann wird es **nach Quellen suchen**, die es dir erm√∂glichen, beliebige Eigenschaften zum **`Object.prototype`** hinzuzuf√ºgen.

Wenn etwas gefunden wird, erscheint ein **Test**-Button, um die gefundene Quelle zu **testen**. Klicke darauf, ein neuer Tab wird erscheinen, erstelle ein Objekt in der Konsole und √ºberpr√ºfe, ob die `testproperty` existiert:
```javascript
let b = {}
b.testproperty
```
Sobald Sie eine Quelle gefunden haben, k√∂nnen Sie **nach einem Gadget scannen**:

1. Ein neuer Tab wird von DOM Invader ge√∂ffnet, wenn der **Scan for gadgets**-Button, der neben jeder identifizierten Prototype Pollution-Quelle in der **DOM**-Ansicht zu finden ist, angeklickt wird. Der Scan nach geeigneten Gadgets beginnt dann.
2. In der gleichen Registerkarte sollte inzwischen der **DOM Invader**-Tab im DevTools-Panel ge√∂ffnet sein. Nach Abschluss des Scans werden alle √ºber die identifizierten Gadgets zug√§nglichen Sinks in der **DOM**-Ansicht angezeigt. Zum Beispiel wird eine Gadget-Eigenschaft namens `html`, die an den `innerHTML`-Sink √ºbergeben wird, im folgenden Beispiel angezeigt.

## DOM Clobbering

Im vorherigen Bild ist zu sehen, dass der DOM Clobbering-Scan aktiviert werden kann. Sobald dies geschehen ist, **beginnt DOM Invader nach DOM Clobbering-Schwachstellen zu suchen**.

## Referenzen

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
