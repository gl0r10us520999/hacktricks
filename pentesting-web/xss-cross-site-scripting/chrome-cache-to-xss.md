# Chrome Cache to XSS

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

Mais detalhes [**neste artigo**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote).

A t√©cnica discutida aqui envolve entender o comportamento e a intera√ß√£o de dois tipos principais de cache: o **back/forward cache (bfcache)** e o **disk cache**. O bfcache, que armazena uma captura completa de uma p√°gina, incluindo o heap do JavaScript, √© priorizado em rela√ß√£o ao disk cache para navega√ß√µes para frente/para tr√°s devido √† sua capacidade de armazenar uma captura mais abrangente. O disk cache, em contraste, armazena recursos buscados na web sem incluir o heap do JavaScript e √© utilizado para navega√ß√µes para frente/para tr√°s para reduzir custos de comunica√ß√£o. Um aspecto interessante do disk cache √© sua inclus√£o de recursos buscados usando `fetch`, o que significa que os recursos de URL acessados ser√£o renderizados pelo navegador a partir do cache.

### Pontos Chave:

- O **bfcache** tem preced√™ncia sobre o disk cache em navega√ß√µes para frente/para tr√°s.
- Para utilizar uma p√°gina armazenada no disk cache em vez do bfcache, este √∫ltimo deve ser desativado.

### Desativando o bfcache:

Por padr√£o, o Puppeteer desativa o bfcache, alinhando-se √†s condi√ß√µes listadas na documenta√ß√£o do Chromium. Um m√©todo eficaz para desativar o bfcache √© atrav√©s do uso de `RelatedActiveContentsExist`, conseguido ao abrir uma p√°gina com `window.open()` que mant√©m uma refer√™ncia a `window.opener`.

### Reproduzindo o comportamento:

1. Visite uma p√°gina da web, por exemplo, `https://example.com`.
2. Execute `open("http://spanote.seccon.games:3000/api/token")`, o que resulta em uma resposta do servidor com um c√≥digo de status 500.
3. Na nova aba aberta, navegue para `http://spanote.seccon.games:3000/`. Esta a√ß√£o armazena a resposta de `http://spanote.seccon.games:3000/api/token` como um disk cache.
4. Use `history.back()` para navegar de volta. A a√ß√£o resulta na renderiza√ß√£o da resposta JSON armazenada em cache na p√°gina.

A verifica√ß√£o de que o disk cache foi utilizado pode ser confirmada atrav√©s do uso das DevTools no Google Chrome.

Para mais detalhes sobre bfcache e disk cache, refer√™ncias podem ser encontradas em [web.dev sobre bfcache](https://web.dev/i18n/en/bfcache/) e [documentos de design do Chromium sobre disk cache](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/), respectivamente.


{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
