# Chrome Cache to XSS

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Περισσότερες λεπτομέρειες [**σε αυτή την αναφορά**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote).

Η τεχνική που συζητείται εδώ περιλαμβάνει την κατανόηση της συμπεριφοράς και της αλληλεπίδρασης δύο κύριων τύπων cache: η **back/forward cache (bfcache)** και η **disk cache**. Η bfcache, η οποία αποθηκεύει μια πλήρη εικόνα μιας σελίδας συμπεριλαμβανομένου του JavaScript heap, έχει προτεραιότητα σε σχέση με τη disk cache για πλοηγήσεις πίσω/μπροστά λόγω της ικανότητάς της να αποθηκεύει μια πιο ολοκληρωμένη εικόνα. Η disk cache, αντίθετα, αποθηκεύει πόρους που έχουν ληφθεί από το διαδίκτυο χωρίς να περιλαμβάνει το JavaScript heap, και χρησιμοποιείται για πλοηγήσεις πίσω/μπροστά για να μειώσει το κόστος επικοινωνίας. Ένας ενδιαφέρον τομέας της disk cache είναι η συμπερίληψη πόρων που έχουν ληφθεί χρησιμοποιώντας `fetch`, που σημαίνει ότι οι πόροι URL που έχουν αποκτηθεί θα αποδοθούν από τον περιηγητή από την cache.

### Κύρια Σημεία:

- Η **bfcache** έχει προτεραιότητα σε σχέση με τη disk cache σε πλοηγήσεις πίσω/μπροστά.
- Για να χρησιμοποιηθεί μια σελίδα που είναι αποθηκευμένη στη disk cache αντί της bfcache, η τελευταία πρέπει να απενεργοποιηθεί.

### Απενεργοποίηση bfcache:

Από προεπιλογή, το Puppeteer απενεργοποιεί την bfcache, ευθυγραμμισμένο με τις συνθήκες που αναφέρονται στην τεκμηρίωση του Chromium. Ένας αποτελεσματικός τρόπος για να απενεργοποιηθεί η bfcache είναι μέσω της χρήσης του `RelatedActiveContentsExist`, που επιτυγχάνεται ανοίγοντας μια σελίδα με `window.open()` που διατηρεί μια αναφορά στο `window.opener`.

### Αναπαραγωγή της συμπεριφοράς:

1. Επισκεφθείτε μια ιστοσελίδα, π.χ., `https://example.com`.
2. Εκτελέστε `open("http://spanote.seccon.games:3000/api/token")`, που έχει ως αποτέλεσμα μια απάντηση διακομιστή με κωδικό κατάστασης 500.
3. Στην καινούργια καρτέλα που άνοιξε, πλοηγηθείτε στο `http://spanote.seccon.games:3000/`. Αυτή η ενέργεια αποθηκεύει την απάντηση του `http://spanote.seccon.games:3000/api/token` ως disk cache.
4. Χρησιμοποιήστε `history.back()` για να επιστρέψετε πίσω. Η ενέργεια αυτή έχει ως αποτέλεσμα την απόδοση της αποθηκευμένης JSON απάντησης στη σελίδα.

Η επιβεβαίωση ότι χρησιμοποιήθηκε η disk cache μπορεί να επιβεβαιωθεί μέσω της χρήσης των DevTools στο Google Chrome.

Για περισσότερες λεπτομέρειες σχετικά με την bfcache και τη disk cache, αναφορές μπορούν να βρεθούν στο [web.dev για την bfcache](https://web.dev/i18n/en/bfcache/) και στα [έγγραφα σχεδίασης του Chromium για τη disk cache](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/), αντίστοιχα.


{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
