# DOM XSS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## DOM Vulnerabilities

Les vuln√©rabilit√©s DOM se produisent lorsque des donn√©es provenant de **sources** contr√¥l√©es par un attaquant (comme `location.search`, `document.referrer` ou `document.cookie`) sont transf√©r√©es de mani√®re non s√©curis√©e vers des **sinks**. Les sinks sont des fonctions ou des objets (par exemple, `eval()`, `document.body.innerHTML`) qui peuvent ex√©cuter ou rendre un contenu nuisible si des donn√©es malveillantes leur sont fournies.

* **Sources** sont des entr√©es qui peuvent √™tre manipul√©es par des attaquants, y compris les URL, les cookies et les messages web.
* **Sinks** sont des points de terminaison potentiellement dangereux o√π des donn√©es malveillantes peuvent entra√Æner des effets ind√©sirables, tels que l'ex√©cution de scripts.

Le risque survient lorsque des donn√©es circulent d'une source √† un sink sans validation ou assainissement appropri√©s, permettant des attaques comme le XSS.

{% hint style="info" %}
**Vous pouvez trouver une liste plus √† jour de sources et de sinks dans** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki)
{% endhint %}

**Sources courantes :**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**Sinks courants :**

| [**Redirection ouverte**](dom-xss.md#open-redirect)                             | [**Injection Javascript**](dom-xss.md#javascript-injection)                     | [**Manipulation de donn√©es DOM**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                         | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() constructor`                                                         | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                   | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                  | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                 | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                  | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                   | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                               | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                               | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                   | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**Manipulation de chemin de fichier local**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                 | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                              | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                   | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                      | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Manipulation de requ√™te Ajax**](dom-xss.md#ajax-request-manipulation) | `FileReader.readAsFile()`                                                       | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                    | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                    | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**Manipulation de lien**](dom-xss.md#link-manipulation)                        | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                          | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                           | `someDOMElement.insertAdjacentHTML`                           | [**Injection JSON c√¥t√© client**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**Manipulation de stockage HTML5**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                         | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**Injection XPath**](dom-xss.md#xpath-injection)                               | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                            | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`D√©ni de service`**](dom-xss.md#denial-of-service)**``**               | `someDOMElement.evaluate()`                                                      | `document.title`                                              | **\`\`**[**Manipulation de cookie**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**Manipulation de domaine de document**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                | `history.pushState()`                                         | [**Empoisonnement d'URL WebSocket**](dom-xss.md#websocket-url-poisoning) |
| [**Injection SQL c√¥t√© client**](dom-xss.md#client-side-sql-injection)           | [**Manipulation de message Web**](dom-xss.md#web-message-manipulation)          | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                  | \`\`                                                          | \`\`                                                                   |

Le sink **`innerHTML`** n'accepte pas les √©l√©ments `script` dans les navigateurs modernes, et les √©v√©nements `svg onload` ne se d√©clencheront pas. Cela signifie que vous devrez utiliser des √©l√©ments alternatifs comme `img` ou `iframe`.

Ce type de XSS est probablement le **plus difficile √† trouver**, car vous devez examiner le code JS, voir s'il **utilise** un objet dont **la valeur est sous votre contr√¥le**, et dans ce cas, voir s'il existe **un moyen d'en abuser** pour ex√©cuter du JS arbitraire.

## Outils pour les trouver

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)
* Extension de navigateur pour v√©rifier chaque donn√©e qui atteint un sink potentiel : [https://github.com/kevin-mizu/domloggerpp](https://github.com/kevin-mizu/domloggerpp)

## Exemples

### Redirection ouverte

De : [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

Les **vuln√©rabilit√©s de redirection ouverte dans le DOM** se produisent lorsqu'un script √©crit des donn√©es, que l'attaquant peut contr√¥ler, dans un sink capable d'initier une navigation entre domaines.

Il est crucial de comprendre qu'il est possible d'ex√©cuter du code arbitraire, tel que **`javascript:alert(1)`**, si vous avez le contr√¥le sur le d√©but de l'URL o√π la redirection se produit.

Sinks :
```javascript
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Manipulation des cookies

From: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

Les vuln√©rabilit√©s de manipulation des cookies bas√©es sur le DOM se produisent lorsqu'un script incorpore des donn√©es, qui peuvent √™tre contr√¥l√©es par un attaquant, dans la valeur d'un cookie. Cette vuln√©rabilit√© peut entra√Æner un comportement inattendu de la page web si le cookie est utilis√© au sein du site. De plus, elle peut √™tre exploit√©e pour r√©aliser une attaque de fixation de session si le cookie est impliqu√© dans le suivi des sessions utilisateur. Le principal point de sortie associ√© √† cette vuln√©rabilit√© est :

Sinks:
```javascript
document.cookie
```
### Injection JavaScript

From: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

Les vuln√©rabilit√©s d'injection JavaScript bas√©es sur le DOM se produisent lorsqu'un script ex√©cute des donn√©es, qui peuvent √™tre contr√¥l√©es par un attaquant, en tant que code JavaScript.

Sinks:
```javascript
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### Manipulation du domaine du document

From: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

**Les vuln√©rabilit√©s de manipulation du domaine du document** se produisent lorsqu'un script d√©finit la propri√©t√© `document.domain` en utilisant des donn√©es que l'attaquant peut contr√¥ler.

La propri√©t√© `document.domain` joue un **r√¥le cl√©** dans l'**application** de la **politique de m√™me origine** par les navigateurs. Lorsque deux pages provenant d'origines diff√©rentes d√©finissent leur `document.domain` √† la **m√™me valeur**, elles peuvent interagir sans restrictions. Bien que les navigateurs imposent certaines **limites** sur les valeurs assignables √† `document.domain`, emp√™chant l'assignation de valeurs compl√®tement non li√©es √† l'origine r√©elle de la page, des exceptions existent. En g√©n√©ral, les navigateurs permettent l'utilisation de **domaines enfants** ou **domaines parents**.

Sinks:
```javascript
document.domain
```
### WebSocket-URL poisoning

From: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

**WebSocket-URL poisoning** se produit lorsqu'un script utilise **des donn√©es contr√¥lables comme l'URL cible** pour une connexion WebSocket.

Sinks:

Le constructeur `WebSocket` peut conduire √† des vuln√©rabilit√©s de WebSocket-URL poisoning.

### Link manipulation

From: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

**Les vuln√©rabilit√©s de manipulation de lien bas√©es sur le DOM** surviennent lorsqu'un script √©crit **des donn√©es contr√¥lables par l'attaquant √† une cible de navigation** dans la page actuelle, comme un lien cliquable ou l'URL de soumission d'un formulaire.

Sinks:
```javascript
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Manipulation des requ√™tes Ajax

From: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

**Les vuln√©rabilit√©s de manipulation des requ√™tes Ajax** surviennent lorsqu'un script √©crit **des donn√©es contr√¥lables par l'attaquant dans une requ√™te Ajax** qui est √©mise √† l'aide d'un objet `XmlHttpRequest`.

Sinks:
```javascript
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### Manipulation de chemin de fichier local

From: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

**Les vuln√©rabilit√©s de manipulation de chemin de fichier local** surviennent lorsqu'un script passe **des donn√©es contr√¥lables par l'attaquant √† une API de gestion de fichiers** en tant que param√®tre `filename`. Cette vuln√©rabilit√© peut √™tre exploit√©e par un attaquant pour construire une URL qui, si elle est visit√©e par un autre utilisateur, pourrait conduire √† **l'ouverture ou l'√©criture d'un fichier local arbitraire par le navigateur de l'utilisateur**.

Sinks:
```javascript
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### Injection SQL c√¥t√© client

From: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

**Les vuln√©rabilit√©s d'injection SQL c√¥t√© client** se produisent lorsqu'un script incorpore **des donn√©es contr√¥lables par l'attaquant dans une requ√™te SQL c√¥t√© client de mani√®re non s√©curis√©e**.

Sinks:
```javascript
executeSql()
```
### Manipulation du stockage HTML5

From: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

**Les vuln√©rabilit√©s de manipulation du stockage HTML5** surviennent lorsqu'un script **stocke des donn√©es contr√¥lables par l'attaquant dans le stockage HTML5 du navigateur web** (`localStorage` ou `sessionStorage`). Bien que cette action ne soit pas intrins√®quement une vuln√©rabilit√© de s√©curit√©, elle devient probl√©matique si l'application **lit les donn√©es stock√©es et les traite de mani√®re non s√©curis√©e**. Cela pourrait permettre √† un attaquant d'exploiter le m√©canisme de stockage pour mener d'autres attaques bas√©es sur le DOM, telles que le cross-site scripting et l'injection JavaScript.

Sinks:
```javascript
sessionStorage.setItem()
localStorage.setItem()
```
### Injection XPath

From: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

**Les vuln√©rabilit√©s d'injection XPath bas√©es sur le DOM** se produisent lorsqu'un script incorpore **des donn√©es contr√¥lables par l'attaquant dans une requ√™te XPath**.

Sinks:
```javascript
document.evaluate()
someDOMElement.evaluate()
```
### Injection JSON c√¥t√© client

From: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

**Les vuln√©rabilit√©s d'injection JSON bas√©es sur le DOM** se produisent lorsqu'un script incorpore **des donn√©es contr√¥lables par l'attaquant dans une cha√Æne qui est analys√©e comme une structure de donn√©es JSON et ensuite trait√©e par l'application**.

Sinks:
```javascript
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Manipulation de messages Web

From: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

**Les vuln√©rabilit√©s de message Web** surviennent lorsqu'un script envoie **des donn√©es contr√¥lables par l'attaquant en tant que message Web √† un autre document** dans le navigateur. Un **exemple** de manipulation de message Web vuln√©rable peut √™tre trouv√© sur [l'Acad√©mie de s√©curit√© Web de PortSwigger](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source).

Sinks:

La m√©thode `postMessage()` pour envoyer des messages Web peut conduire √† des vuln√©rabilit√©s si l'√©couteur d'√©v√©nements pour recevoir des messages g√®re les donn√©es entrantes de mani√®re non s√©curis√©e.

### Manipulation de donn√©es DOM

From: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

**Les vuln√©rabilit√©s de manipulation de donn√©es DOM** surviennent lorsqu'un script √©crit **des donn√©es contr√¥lables par l'attaquant dans un champ au sein du DOM** qui est utilis√© dans l'UI visible ou la logique c√¥t√© client. Cette vuln√©rabilit√© peut √™tre exploit√©e par un attaquant pour construire une URL qui, si elle est visit√©e par un autre utilisateur, peut alt√©rer l'apparence ou le comportement de l'UI c√¥t√© client.

Sinks:
```javascript
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### D√©ni de Service

From: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

**Les vuln√©rabilit√©s de d√©ni de service bas√© sur le DOM** se produisent lorsqu'un script passe **des donn√©es contr√¥lables par l'attaquant de mani√®re non s√©curis√©e √† une API de plateforme probl√©matique**. Cela inclut les API qui, lorsqu'elles sont invoqu√©es, peuvent amener l'ordinateur de l'utilisateur √† consommer **des quantit√©s excessives de CPU ou d'espace disque**. De telles vuln√©rabilit√©s peuvent avoir des effets secondaires significatifs, tels que le navigateur restreignant la fonctionnalit√© du site Web en rejetant les tentatives de stockage de donn√©es dans `localStorage` ou en terminant des scripts occup√©s.

Sinks:
```javascript
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
