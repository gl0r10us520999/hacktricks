# SOME - Ex√©cution de M√©thode de M√™me Origine

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## Ex√©cution de M√©thode de M√™me Origine

Il y aura des occasions o√π vous pouvez ex√©cuter un javascript limit√© sur une page. Par exemple, dans le cas o√π vous pouvez [**contr√¥ler une valeur de rappel qui sera ex√©cut√©e**](./#javascript-function).

Dans ces cas, l'une des meilleures choses que vous pourriez faire est de **acc√©der au DOM pour appeler n'importe quelle** action sensible que vous pouvez trouver l√†-dedans (comme cliquer sur un bouton). Cependant, vous trouverez g√©n√©ralement cette vuln√©rabilit√© dans **de petits points de terminaison sans rien d'int√©ressant dans le DOM**.

Dans ces sc√©narios, cette attaque sera tr√®s utile, car son objectif est de pouvoir **abuser de l'ex√©cution JS limit√©e √† l'int√©rieur d'un DOM d'une page diff√©rente du m√™me domaine** avec des actions beaucoup plus int√©ressantes.

Fondamentalement, le flux d'attaque est le suivant :

* Trouvez un **rappel que vous pouvez abuser** (potentiellement limit√© √† \[\w\\.\_]).
* S'il n'est pas limit√© et que vous pouvez ex√©cuter n'importe quel JS, vous pourriez simplement en abuser comme un XSS r√©gulier.
* Faites en sorte que la **victime ouvre une page** contr√¥l√©e par l'**attaquant**.
* La **page s'ouvrira elle-m√™me** dans une **fen√™tre diff√©rente** (la nouvelle fen√™tre aura l'objet **`opener`** r√©f√©rant √† la premi√®re).
* La **page initiale** chargera la **page** o√π se trouve le **DOM int√©ressant**.
* La **deuxi√®me page** chargera la **page vuln√©rable en abusant du rappel** et en utilisant l'objet **`opener`** pour **acc√©der et ex√©cuter une action dans la page initiale** (qui contient maintenant le DOM int√©ressant).

{% hint style="danger" %}
Notez que m√™me si la page initiale acc√®de √† une nouvelle URL apr√®s avoir cr√©√© la deuxi√®me page, l'**objet `opener` de la deuxi√®me page est toujours une r√©f√©rence valide √† la premi√®re page dans le nouveau DOM**.

De plus, pour que la deuxi√®me page puisse utiliser l'objet opener, **les deux pages doivent √™tre de la m√™me origine**. C'est la raison pour laquelle, afin d'abuser de cette vuln√©rabilit√©, vous devez trouver une sorte de **XSS dans la m√™me origine**.
{% endhint %}

### Exploitation

* Vous pouvez utiliser ce formulaire pour **g√©n√©rer un PoC** pour exploiter ce type de vuln√©rabilit√© : [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Afin de trouver un chemin DOM vers un √©l√©ment HTML avec un clic, vous pouvez utiliser cette extension de navigateur : [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Exemple

* Vous pouvez trouver un exemple vuln√©rable sur [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Notez que dans cet exemple, le serveur **g√©n√®re du code javascript** et **l'ajoute** √† l'HTML en fonction du **contenu du param√®tre de rappel :** `<script>opener.{callbacl_content}</script>`. C'est pourquoi dans cet exemple, vous n'avez pas besoin d'indiquer l'utilisation de `opener` explicitement.
* Consultez √©galement ce compte rendu CTF : [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## R√©f√©rences

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
