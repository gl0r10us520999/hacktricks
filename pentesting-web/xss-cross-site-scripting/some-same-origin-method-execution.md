# SOME - Wykonanie Metody z Tego Samego 殴r贸da

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Szkolenie Ekspert贸w Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Szkolenie Ekspert贸w Red Team GCP (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Wykonanie Metody z Tego Samego 殴r贸da

Bd sytuacje, w kt贸rych mo偶esz wykona ograniczony javascript na stronie. Na przykad, w przypadku, gdy mo偶esz[ **kontrolowa warto callback, kt贸ra zostanie wykonana**](./#javascript-function).

W takich przypadkach jedn z najlepszych rzeczy, kt贸re mo偶esz zrobi, jest **dostp do DOM, aby wywoa dowoln** wra偶liw akcj, kt贸r mo偶esz tam znale藕 (jak kliknicie przycisku). Jednak zazwyczaj znajdziesz t luk w **maych punktach kocowych bez 偶adnych interesujcych rzeczy w DOM**.

W tych scenariuszach, ta atak bdzie bardzo przydatny, poniewa偶 jego celem jest mo偶liwo **wykorzystania ograniczonego wykonania JS wewntrz DOM z innej strony z tej samej domeny** z du偶o bardziej interesujcymi akcjami.

Zasadniczo, przepyw ataku jest nastpujcy:

* Znajd藕 **callback, kt贸ry mo偶esz wykorzysta** (potencjalnie ograniczony do \[\w\\.\_]).
* Jeli nie jest ograniczony i mo偶esz wykona dowolny JS, mo偶esz po prostu wykorzysta to jak zwyke XSS
* Spraw, aby **ofiara otworzya stron** kontrolowan przez **atakujcego**
* **Strona otworzy si** w **innym oknie** (nowe okno bdzie miao obiekt **`opener`** odnoszcy si do pocztkowego)
* **Pocztkowa strona** zaaduje **stron**, na kt贸rej znajduje si **interesujcy DOM**.
* **Druga strona** zaaduje **wra偶liw stron, wykorzystujc callback** i u偶ywajc obiektu **`opener`**, aby **uzyska dostp i wykona jak akcj na pocztkowej stronie** (kt贸ra teraz zawiera interesujcy DOM).

{% hint style="danger" %}
Zauwa偶, 偶e nawet jeli pocztkowa strona uzyskuje dostp do nowego URL po utworzeniu drugiej strony, **obiekt `opener` drugiej strony jest nadal wa偶nym odniesieniem do pierwszej strony w nowym DOM**.

Co wicej, aby druga strona moga u偶ywa obiektu opener, **obie strony musz by w tym samym 藕r贸dle**. To jest pow贸d, dla kt贸rego, aby wykorzysta t luk, musisz znale藕 jaki rodzaj **XSS w tym samym 藕r贸dle**.
{% endhint %}

### Wykorzystanie

* Mo偶esz u偶y tej formy, aby **wygenerowa PoC** do wykorzystania tego typu luki: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Aby znale藕 cie偶k DOM do elementu HTML z klikniciem, mo偶esz u偶y tej rozszerzenia przegldarki: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Przykad

* Mo偶esz znale藕 wra偶liwy przykad w [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Zauwa偶, 偶e w tym przykadzie serwer **generuje kod javascript** i **dodaje** go do HTML na podstawie **zawartoci parametru callback:** `<script>opener.{callbacl_content}</script>`. Dlatego w tym przykadzie nie musisz wskazywa u偶ycia `opener` w spos贸b expliczny.
* Sprawd藕 r贸wnie偶 ten opis CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Odniesienia

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Szkolenie Ekspert贸w Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Szkolenie Ekspert贸w Red Team GCP (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
