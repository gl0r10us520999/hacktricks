# hop-by-hop headers

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) to najwa偶niejsze wydarzenie zwizane z cyberbezpieczestwem w **Hiszpanii** i jedno z najwa偶niejszych w **Europie**. Z **misj promowania wiedzy technicznej**, ten kongres jest gorcym punktem spotka dla profesjonalist贸w z dziedziny technologii i cyberbezpieczestwa w ka偶dej dyscyplinie.

{% embed url="https://www.rootedcon.com/" %}

***

**To jest podsumowanie posta** [**https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers**](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)

Nag贸wki hop-by-hop s specyficzne dla pojedynczego poczenia na poziomie transportu, u偶ywane g贸wnie w HTTP/1.1 do zarzdzania danymi midzy dwoma wzami (takimi jak klient-proxy lub proxy-proxy) i nie s przeznaczone do przesyania dalej. Standardowe nag贸wki hop-by-hop obejmuj `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` i `Proxy-Authenticate`, jak zdefiniowano w [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Dodatkowe nag贸wki mog by oznaczone jako hop-by-hop za pomoc nag贸wka `Connection`.

### Wykorzystywanie nag贸wk贸w hop-by-hop

Niewaciwe zarzdzanie nag贸wkami hop-by-hop przez proxy mo偶e prowadzi do problem贸w z bezpieczestwem. Chocia偶 od proxy oczekuje si usunicia tych nag贸wk贸w, nie wszystkie to robi, co stwarza potencjalne luki.

### Testowanie obsugi nag贸wk贸w hop-by-hop

Obsug nag贸wk贸w hop-by-hop mo偶na testowa, obserwujc zmiany w odpowiedziach serwera, gdy konkretne nag贸wki s oznaczone jako hop-by-hop. Narzdzia i skrypty mog zautomatyzowa ten proces, identyfikujc, jak proxy zarzdzaj tymi nag贸wkami i potencjalnie odkrywajc bdne konfiguracje lub zachowania proxy.

Wykorzystywanie nag贸wk贸w hop-by-hop mo偶e prowadzi do r贸偶nych implikacji bezpieczestwa. Poni偶ej znajduj si kilka przykad贸w ilustrujcych, jak te nag贸wki mog by manipulowane w celu potencjalnych atak贸w:

### Ominicie kontroli bezpieczestwa za pomoc `X-Forwarded-For`

Atakujcy mo偶e manipulowa nag贸wkiem `X-Forwarded-For`, aby obej kontrole dostpu oparte na IP. Ten nag贸wek jest czsto u偶ywany przez proxy do ledzenia oryginalnego adresu IP klienta. Jednak jeli proxy traktuje ten nag贸wek jako hop-by-hop i przesya go bez odpowiedniej walidacji, atakujcy mo偶e sfaszowa sw贸j adres IP.

**Scenariusz ataku:**

1. Atakujcy wysya 偶danie HTTP do aplikacji internetowej za proxy, w tym faszywy adres IP w nag贸wku `X-Forwarded-For`.
2. Atakujcy r贸wnie偶 docza nag贸wek `Connection: close, X-Forwarded-For`, co skania proxy do traktowania `X-Forwarded-For` jako hop-by-hop.
3. 殴le skonfigurowane proxy przesya 偶danie do aplikacji internetowej bez sfaszowanego nag贸wka `X-Forwarded-For`.
4. Aplikacja internetowa, nie widzc oryginalnego nag贸wka `X-Forwarded-For`, mo偶e uzna 偶danie za pochodzce bezporednio z zaufanego proxy, co potencjalnie umo偶liwia nieautoryzowany dostp.

### Zatrucie pamici podrcznej poprzez wstrzykiwanie nag贸wk贸w hop-by-hop

Jeli serwer pamici podrcznej bdnie buforuje zawarto na podstawie nag贸wk贸w hop-by-hop, atakujcy mo偶e wstrzykn zoliwe nag贸wki, aby zatru pami podrczn. To spowoduje, 偶e u偶ytkownicy 偶dajcy tego samego zasobu otrzymaj nieprawidow lub zoliw zawarto.

**Scenariusz ataku:**

1. Atakujcy wysya 偶danie do aplikacji internetowej z nag贸wkiem hop-by-hop, kt贸ry nie powinien by buforowany (np. `Connection: close, Cookie`).
2. 殴le skonfigurowany serwer pamici podrcznej nie usuwa nag贸wka hop-by-hop i buforuje odpowied藕 specyficzn dla sesji atakujcego.
3. Przyszli u偶ytkownicy 偶dajcy tego samego zasobu otrzymuj buforowan odpowied藕, kt贸ra bya dostosowana do atakujcego, co potencjalnie prowadzi do przejcia sesji lub ujawnienia wra偶liwych informacji.

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) to najwa偶niejsze wydarzenie zwizane z cyberbezpieczestwem w **Hiszpanii** i jedno z najwa偶niejszych w **Europie**. Z **misj promowania wiedzy technicznej**, ten kongres jest gorcym punktem spotka dla profesjonalist贸w z dziedziny technologii i cyberbezpieczestwa w ka偶dej dyscyplinie.

{% embed url="https://www.rootedcon.com/" %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
