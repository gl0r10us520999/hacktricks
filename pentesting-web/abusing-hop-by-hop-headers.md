# hop-by-hop headers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) es el evento de ciberseguridad m√°s relevante en **Espa√±a** y uno de los m√°s importantes en **Europa**. Con **la misi√≥n de promover el conocimiento t√©cnico**, este congreso es un punto de encuentro vibrante para profesionales de la tecnolog√≠a y la ciberseguridad en todas las disciplinas.

{% embed url="https://www.rootedcon.com/" %}

***

**Este es un resumen de la publicaci√≥n** [**https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers**](https://nathandavison.com/blog/abusing-http-hop-by-hop-request-headers)

Los encabezados hop-by-hop son espec√≠ficos de una √∫nica conexi√≥n a nivel de transporte, utilizados principalmente en HTTP/1.1 para gestionar datos entre dos nodos (como cliente-proxy o proxy-proxy), y no est√°n destinados a ser reenviados. Los encabezados hop-by-hop est√°ndar incluyen `Keep-Alive`, `Transfer-Encoding`, `TE`, `Connection`, `Trailer`, `Upgrade`, `Proxy-Authorization` y `Proxy-Authenticate`, como se define en [RFC 2616](https://tools.ietf.org/html/rfc2616#section-13.5.1). Encabezados adicionales pueden ser designados como hop-by-hop a trav√©s del encabezado `Connection`.

### Abusing Hop-by-Hop Headers

La gesti√≥n inadecuada de los encabezados hop-by-hop por parte de los proxies puede llevar a problemas de seguridad. Si bien se espera que los proxies eliminen estos encabezados, no todos lo hacen, creando vulnerabilidades potenciales.

### Testing for Hop-by-Hop Header Handling

El manejo de los encabezados hop-by-hop se puede probar observando cambios en las respuestas del servidor cuando se marcan encabezados espec√≠ficos como hop-by-hop. Herramientas y scripts pueden automatizar este proceso, identificando c√≥mo los proxies gestionan estos encabezados y potencialmente descubriendo configuraciones incorrectas o comportamientos de proxy.

Abusar de los encabezados hop-by-hop puede llevar a diversas implicaciones de seguridad. A continuaci√≥n se presentan un par de ejemplos que demuestran c√≥mo estos encabezados pueden ser manipulados para ataques potenciales:

### Bypassing Security Controls with `X-Forwarded-For`

Un atacante puede manipular el encabezado `X-Forwarded-For` para eludir controles de acceso basados en IP. Este encabezado es a menudo utilizado por proxies para rastrear la direcci√≥n IP de origen de un cliente. Sin embargo, si un proxy trata este encabezado como hop-by-hop y lo reenv√≠a sin la validaci√≥n adecuada, un atacante puede suplantar su direcci√≥n IP.

**Escenario de Ataque:**

1. El atacante env√≠a una solicitud HTTP a una aplicaci√≥n web detr√°s de un proxy, incluyendo una direcci√≥n IP falsa en el encabezado `X-Forwarded-For`.
2. El atacante tambi√©n incluye el encabezado `Connection: close, X-Forwarded-For`, lo que lleva al proxy a tratar `X-Forwarded-For` como hop-by-hop.
3. El proxy mal configurado reenv√≠a la solicitud a la aplicaci√≥n web sin el encabezado `X-Forwarded-For` suplantado.
4. La aplicaci√≥n web, al no ver el encabezado original `X-Forwarded-For`, podr√≠a considerar la solicitud como proveniente directamente de un proxy de confianza, permitiendo potencialmente el acceso no autorizado.

### Cache Poisoning via Hop-by-Hop Header Injection

Si un servidor de cach√© almacena incorrectamente contenido basado en encabezados hop-by-hop, un atacante podr√≠a inyectar encabezados maliciosos para envenenar la cach√©. Esto servir√≠a contenido incorrecto o malicioso a los usuarios que solicitan el mismo recurso.

**Escenario de Ataque:**

1. Un atacante env√≠a una solicitud a una aplicaci√≥n web con un encabezado hop-by-hop que no deber√≠a ser almacenado en cach√© (por ejemplo, `Connection: close, Cookie`).
2. El servidor de cach√© mal configurado no elimina el encabezado hop-by-hop y almacena la respuesta espec√≠fica para la sesi√≥n del atacante.
3. Los futuros usuarios que soliciten el mismo recurso reciben la respuesta en cach√©, que fue adaptada para el atacante, lo que podr√≠a llevar al secuestro de sesi√≥n o a la exposici√≥n de informaci√≥n sensible.

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) es el evento de ciberseguridad m√°s relevante en **Espa√±a** y uno de los m√°s importantes en **Europa**. Con **la misi√≥n de promover el conocimiento t√©cnico**, este congreso es un punto de encuentro vibrante para profesionales de la tecnolog√≠a y la ciberseguridad en todas las disciplinas.

{% embed url="https://www.rootedcon.com/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
