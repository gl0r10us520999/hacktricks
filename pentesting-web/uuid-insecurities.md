# UUID Insecurities

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Los Identificadores 칔nicos Universales (UUIDs) son **n칰meros de 128 bits utilizados para identificar informaci칩n de manera 칰nica** en sistemas inform치ticos. Los UUIDs son esenciales en aplicaciones donde se necesitan identificadores 칰nicos sin coordinaci칩n central. Se utilizan com칰nmente como claves de base de datos y pueden referirse a varios elementos como documentos y sesiones.

Los UUIDs est치n dise침ados para ser 칰nicos y **dif칤ciles de adivinar**. Est치n estructurados en un formato espec칤fico, divididos en cinco grupos representados como 32 d칤gitos hexadecimales. Hay diferentes versiones de UUIDs, cada una con diferentes prop칩sitos:

* **UUID v1** es basado en el tiempo, incorporando la marca de tiempo, la secuencia de reloj y el ID del nodo (direcci칩n MAC), pero puede potencialmente exponer informaci칩n del sistema.
* **UUID v2** es similar a v1 pero incluye modificaciones para dominios locales (no se utiliza ampliamente).
* **UUID v3 y v5** generan UUIDs utilizando valores hash de espacio de nombres y nombre, siendo v3 el que utiliza MD5 y v5 el que utiliza SHA-1.
* **UUID v4** se genera casi completamente de manera aleatoria, proporcionando un alto nivel de anonimato pero con un ligero riesgo de duplicados.

{% hint style="success" %}
Note que la versi칩n y subversi칩n del UUID generalmente aparece en la misma posici칩n dentro del UUID. Por ejemplo en:\
12345678 - abcd - 1a56 - a539 - 103755193864\
xxxxxxxx  - xxxx - Mxxx - Nxxx - xxxxxxxxxxxx

* La **posici칩n de la M** indica la **versi칩n** del UUID. En el ejemplo anterior, es UUID v**1**.
* La **posici칩n de la N** indica la variante del UUID.
{% endhint %}

## Sandwich attack

El "Sandwich Attack" es un tipo espec칤fico de ataque que **exploita la predictibilidad de la generaci칩n de UUID v1 en aplicaciones web**, particularmente en caracter칤sticas como restablecimientos de contrase침a. UUID v1 se genera en funci칩n del tiempo, la secuencia de reloj y la direcci칩n MAC del nodo, lo que puede hacerlo algo predecible si un atacante puede obtener algunos de estos UUIDs generados cerca en el tiempo.

### Example

Imagina una aplicaci칩n web que utiliza UUID v1 para generar enlaces de restablecimiento de contrase침a. As칤 es como un atacante podr칤a explotar esto para obtener acceso no autorizado:

1. **Configuraci칩n Inicial**:

* El atacante tiene control sobre dos cuentas de correo electr칩nico: \`attacker1@acme.com\` y \`attacker2@acme.com\`.
* La cuenta de correo electr칩nico del objetivo es \`victim@acme.com\`.

2. **Ejecuci칩n**:

* El atacante activa un restablecimiento de contrase침a para su primera cuenta (\`attacker1@acme.com\`) y recibe un enlace de restablecimiento de contrase침a con un UUID, digamos \`99874128-7592-11e9-8201-bb2f15014a14\`.
* Inmediatamente despu칠s, el atacante activa un restablecimiento de contrase침a para la cuenta de la v칤ctima (\`victim@acme.com\`) y luego r치pidamente para la segunda cuenta controlada por el atacante (\`attacker2@acme.com\`).
* El atacante recibe un enlace de restablecimiento para la segunda cuenta con un UUID, digamos \`998796b4-7592-11e9-8201-bb2f15014a14\`.

3. **An치lisis**:

* El atacante ahora tiene dos UUIDs generados cerca en el tiempo (\`99874128\` y \`998796b4\`). Dada la naturaleza secuencial de los UUIDs basados en el tiempo, el UUID para la cuenta de la v칤ctima probablemente caer치 entre estos dos valores.

4. **Ataque de Fuerza Bruta:**

* El atacante utiliza una herramienta para generar UUIDs entre estos dos valores y prueba cada UUID generado intentando acceder al enlace de restablecimiento de contrase침a (por ejemplo, \`https://www.acme.com/reset/\<generated-UUID>\`).
* Si la aplicaci칩n web no limita adecuadamente la tasa o bloquea tales intentos, el atacante puede probar r치pidamente todos los UUIDs posibles en el rango.

5. **Acceso Obtenido:**

* Una vez que se descubre el UUID correcto para el enlace de restablecimiento de contrase침a de la v칤ctima, el atacante puede restablecer la contrase침a de la v칤ctima y obtener acceso no autorizado a su cuenta.

### Tools

* Puedes realizar el ataque sandwich autom치ticamente con la herramienta: [**https://github.com/Lupin-Holmes/sandwich**](https://github.com/Lupin-Holmes/sandwich)
* Puedes detectar este tipo de UUIDs en Burp Suite con la extensi칩n [**UUID Detector**](https://portswigger.net/bappstore/65f32f209a72480ea5f1a0dac4f38248).

## References

* [https://versprite.com/blog/universally-unique-identifiers/](https://versprite.com/blog/universally-unique-identifiers/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
