# Ana sayfayÄ± engelleyerek postmessage Ã§almak

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Iframe'lerle RC'leri Kazanmak

Bu [**Terjanq yazÄ±sÄ±**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710)'na gÃ¶re, null kÃ¶kenlerden oluÅŸturulan blob belgeleri gÃ¼venlik faydalarÄ± iÃ§in izole edilmiÅŸtir, bu da demektir ki eÄŸer ana sayfayÄ± meÅŸgul tutarsanÄ±z, iframe sayfasÄ± Ã§alÄ±ÅŸtÄ±rÄ±lacaktÄ±r.

Temelde bu zorlukta bir **izole iframe Ã§alÄ±ÅŸtÄ±rÄ±lmaktadÄ±r** ve hemen **yÃ¼klenir yÃ¼klenmez** **ebeveyn** sayfa **flag** ile bir **post** mesajÄ± **gÃ¶nderecektir**.\
Ancak, bu postmessage iletiÅŸimi **XSS'e karÅŸÄ± savunmasÄ±zdÄ±r** (iframe JS kodu Ã§alÄ±ÅŸtÄ±rabilir).

Bu nedenle, saldÄ±rganÄ±n amacÄ± **ebeveynin iframe'i oluÅŸturmasÄ±na izin vermek**, ancak **Ã¶nce** **ebeveyn** sayfanÄ±n **hassas verileri** (**flag**) **gÃ¶ndermeden Ã¶nce** onu **meÅŸgul tutmak** ve **payload'Ä± iframe'e gÃ¶ndermektir**. **Ebeveyn meÅŸgulken**, **iframe payload'Ä± Ã§alÄ±ÅŸtÄ±rÄ±r** ve bu, **ebeveyn postmessage mesajÄ±nÄ± dinleyen ve flag'i sÄ±zdÄ±ran** bir JS olacaktÄ±r.\
Sonunda, iframe payload'Ä± Ã§alÄ±ÅŸtÄ±rÄ±r ve ebeveyn sayfa meÅŸgul olmayÄ± bÄ±rakÄ±r, bÃ¶ylece flag'i gÃ¶nderir ve payload onu sÄ±zdÄ±rÄ±r.

Ama ebeveyni **iframe'i oluÅŸturduktan hemen sonra ve sadece iframe'in hassas verileri gÃ¶ndermeye hazÄ±r olmasÄ±nÄ± beklerken nasÄ±l meÅŸgul tutabilirsiniz?** Temelde, ebeveynin **Ã§alÄ±ÅŸtÄ±rabileceÄŸi** bir **async** **hareket** bulmanÄ±z gerekiyor. Ã–rneÄŸin, bu zorlukta ebeveyn **postmessages** dinliyordu:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
bu nedenle, o karÅŸÄ±laÅŸtÄ±rmada **string'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lecek bir postmessage'da bÃ¼yÃ¼k bir tam sayÄ± gÃ¶ndermek** mÃ¼mkÃ¼n oldu, bu da biraz zaman alacaktÄ±r:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
Ve tam olarak doÄŸru olmak iÃ§in, o **postmessage**'i **iframe** oluÅŸturulduktan hemen **sonra** ama verileri ebeveynden almak iÃ§in **hazÄ±r** olmadan **gÃ¶ndermeniz** gerekecek, bu yÃ¼zden bir `setTimeout`'Ä±n milisaniyeleri ile **oynamanÄ±z** gerekecek. 

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
