# Blocking main page to steal postmessage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Winning RCs with Iframes

–ó–≥—ñ–¥–Ω–æ –∑ —Ü–∏–º [**Terjanq writeup**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) –±–ª–æ–±-–¥–æ–∫—É–º–µ–Ω—Ç–∏, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∑ –Ω—É–ª—å–æ–≤–∏—Ö –¥–∂–µ—Ä–µ–ª, —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ –¥–ª—è –±–µ–∑–ø–µ–∫–∏, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ —è–∫—â–æ –≤–∏ –∑–∞–π–Ω—è—Ç—ñ –æ—Å–Ω–æ–≤–Ω–æ—é —Å—Ç–æ—Ä—ñ–Ω–∫–æ—é, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ iframe –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞.

–í –æ—Å–Ω–æ–≤–Ω–æ–º—É, —É —Ü—å–æ–º—É –≤–∏–∫–ª–∏–∫—É **—ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π iframe –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è** —ñ –≤—ñ–¥—Ä–∞–∑—É **–ø—ñ—Å–ª—è** –π–æ–≥–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** **–±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞** —Å—Ç–æ—Ä—ñ–Ω–∫–∞ **–Ω–∞–¥—ñ—à–ª–µ** –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è **post** –∑ **—Ñ–ª–∞–≥–æ–º**.\
–û–¥–Ω–∞–∫ —Ü—è –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è postmessage —î **–≤—Ä–∞–∑–ª–∏–≤–æ—é –¥–æ XSS** (**iframe** –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ JS-–∫–æ–¥).

–û—Ç–∂–µ, –º–µ—Ç–∞ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± **–¥–æ–∑–≤–æ–ª–∏—Ç–∏ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ iframe**, –∞–ª–µ **–ø–µ—Ä–µ–¥ —Ç–∏–º**, —è–∫ **–±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞** —Å—Ç–æ—Ä—ñ–Ω–∫–∞ **–Ω–∞–¥—ñ—à–ª–µ** —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ (**—Ñ–ª–∞–≥**), **—Ç—Ä–∏–º–∞—Ç–∏ —ó—ó –∑–∞–π–Ω—è—Ç–æ—é** —ñ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ **payload –¥–æ iframe**. –ü–æ–∫–∏ **–±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–π–Ω—è—Ç–∞**, **iframe –≤–∏–∫–æ–Ω—É—î payload**, —è–∫–∏–π –±—É–¥–µ –¥–µ—è–∫–∏–º JS, —â–æ —Å–ª—É—Ö–∞—Ç–∏–º–µ **–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è postmessage –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —ñ –≤–∏—Ç—ñ–∫–∞—Ç–∏–º–µ —Ñ–ª–∞–≥**.\
–ù–∞—Ä–µ—à—Ç—ñ, iframe –≤–∏–∫–æ–Ω–∞–≤ payload, —ñ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–µ—Ä–µ—Å—Ç–∞—î –±—É—Ç–∏ –∑–∞–π–Ω—è—Ç–æ—é, —Ç–æ–º—É –≤–æ–Ω–∞ –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–ª–∞–≥, –∞ payload –π–æ–≥–æ –≤–∏—Ç—ñ–∫–∞—î.

–ê–ª–µ —è–∫ –≤–∏ –º–æ–≥–ª–∏ –± –∑–º—É—Å–∏—Ç–∏ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –±—É—Ç–∏ **–∑–∞–π–Ω—è—Ç–æ—é –≤—ñ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–æ–Ω–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–ª–∞ iframe —ñ –ª–∏—à–µ –ø–æ–∫–∏ —á–µ–∫–∞—î, —â–æ–± iframe –±—É–≤ –≥–æ—Ç–æ–≤–∏–π –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ?** –í –æ—Å–Ω–æ–≤–Ω–æ–º—É, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É** **–¥—ñ—é**, —è–∫—É –≤–∏ –º–æ–≥–ª–∏ –± –∑–º—É—Å–∏—Ç–∏ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É —Å—Ç–æ—Ä—ñ–Ω–∫—É **–≤–∏–∫–æ–Ω–∞—Ç–∏**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Ü—å–æ–º—É –≤–∏–∫–ª–∏–∫—É –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ **—Å–ª—É—Ö–∞–ª–∞** **postmessages** –æ—Å—å —Ç–∞–∫:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
—Ç–æ–º—É –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ **–≤–µ–ª–∏–∫–µ —Ü—ñ–ª–µ —á–∏—Å–ª–æ –≤ postmessage**, —è–∫–µ –±—É–¥–µ **–ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–æ –Ω–∞ —Ä—è–¥–æ–∫** –≤ —Ü—å–æ–º—É –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ, —â–æ –∑–∞–π–º–µ –¥–µ—è–∫–∏–π —á–∞—Å:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
–Ü —â–æ–± –±—É—Ç–∏ —Ç–æ—á–Ω–∏–º —ñ **–Ω–∞–¥—ñ—Å–ª–∞—Ç–∏** —Ü–µ **postmessage** —Å–∞–º–µ **–ø—ñ—Å–ª—è** —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **iframe**, –∞–ª–µ **–¥–æ** —Ç–æ–≥–æ, —è–∫ –≤—ñ–Ω –±—É–¥–µ **–≥–æ—Ç–æ–≤–∏–π** –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –≤—ñ–¥ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ **–ø–æ–≥—Ä–∞—Ç–∏—Å—è –∑ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞–º–∏ —É `setTimeout`**.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
