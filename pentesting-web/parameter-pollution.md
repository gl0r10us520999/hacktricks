# Parameter Pollution | JSON Injection

## Parameter Pollution

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## HTTP å‚æ•°æ±¡æŸ“ (HPP) æ¦‚è¿°

HTTP å‚æ•°æ±¡æŸ“ (HPP) æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæ”»å‡»è€…é€šè¿‡æ“çºµ HTTP å‚æ•°ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼æ”¹å˜ Web åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚è¿™ç§æ“çºµæ˜¯é€šè¿‡æ·»åŠ ã€ä¿®æ”¹æˆ–é‡å¤ HTTP å‚æ•°æ¥å®Œæˆçš„ã€‚è¿™äº›æ“çºµçš„æ•ˆæœå¯¹ç”¨æˆ·å¹¶ä¸ç›´æ¥å¯è§ï¼Œä½†å¯ä»¥æ˜¾è‘—æ”¹å˜æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯äº§ç”Ÿå¯è§‚å¯Ÿçš„å½±å“ã€‚

### HTTP å‚æ•°æ±¡æŸ“ (HPP) ç¤ºä¾‹

ä¸€ä¸ªé“¶è¡Œåº”ç”¨ç¨‹åºçš„äº¤æ˜“ URLï¼š

* **åŸå§‹ URL:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

é€šè¿‡æ’å…¥ä¸€ä¸ªé¢å¤–çš„ `from` å‚æ•°ï¼š

* **æ“çºµåçš„ URL:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

äº¤æ˜“å¯èƒ½é”™è¯¯åœ°ä» `accountA` æ”¶è´¹åˆ° `accountC`ï¼Œå±•ç¤ºäº† HPP æ“çºµäº¤æ˜“æˆ–å…¶ä»–åŠŸèƒ½ï¼ˆå¦‚å¯†ç é‡ç½®ã€2FA è®¾ç½®æˆ– API å¯†é’¥è¯·æ±‚ï¼‰çš„æ½œåŠ›ã€‚

#### **ç‰¹å®šæŠ€æœ¯çš„å‚æ•°è§£æ**

* å‚æ•°çš„è§£æå’Œä¼˜å…ˆçº§å–å†³äºåº•å±‚ Web æŠ€æœ¯ï¼Œå½±å“ HPP çš„åˆ©ç”¨æ–¹å¼ã€‚
* åƒ [Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/) è¿™æ ·çš„å·¥å…·æœ‰åŠ©äºè¯†åˆ«è¿™äº›æŠ€æœ¯åŠå…¶è§£æè¡Œä¸ºã€‚

### PHP å’Œ HPP åˆ©ç”¨

**OTP æ“çºµæ¡ˆä¾‹ï¼š**

* **èƒŒæ™¯:** ä¸€ä¸ªéœ€è¦ä¸€æ¬¡æ€§å¯†ç  (OTP) çš„ç™»å½•æœºåˆ¶è¢«åˆ©ç”¨ã€‚
* **æ–¹æ³•:** é€šè¿‡ä½¿ç”¨ Burp Suite ç­‰å·¥å…·æ‹¦æˆª OTP è¯·æ±‚ï¼Œæ”»å‡»è€…åœ¨ HTTP è¯·æ±‚ä¸­é‡å¤äº† `email` å‚æ•°ã€‚
* **ç»“æœ:** æœ¬åº”å‘é€åˆ°åˆå§‹ç”µå­é‚®ä»¶çš„ OTP è¢«å‘é€åˆ°æ“çºµè¯·æ±‚ä¸­æŒ‡å®šçš„ç¬¬äºŒä¸ªç”µå­é‚®ä»¶åœ°å€ã€‚è¿™ä¸ªç¼ºé™·å…è®¸é€šè¿‡ç»•è¿‡é¢„æœŸçš„å®‰å…¨æªæ–½è·å¾—æœªæˆæƒè®¿é—®ã€‚

è¿™ä¸ªåœºæ™¯çªæ˜¾äº†åº”ç”¨ç¨‹åºåç«¯çš„ä¸€ä¸ªå…³é”®ç–å¿½ï¼Œå®ƒå¤„ç†ç¬¬ä¸€ä¸ª `email` å‚æ•°ä»¥ç”Ÿæˆ OTPï¼Œä½†ä½¿ç”¨æœ€åä¸€ä¸ªè¿›è¡Œå‘é€ã€‚

**API å¯†é’¥æ“çºµæ¡ˆä¾‹ï¼š**

* **åœºæ™¯:** ä¸€ä¸ªåº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·é€šè¿‡ä¸ªäººèµ„æ–™è®¾ç½®é¡µé¢æ›´æ–°ä»–ä»¬çš„ API å¯†é’¥ã€‚
* **æ”»å‡»å‘é‡:** æ”»å‡»è€…å‘ç°é€šè¿‡å‘ POST è¯·æ±‚é™„åŠ ä¸€ä¸ªé¢å¤–çš„ `api_key` å‚æ•°ï¼Œå¯ä»¥æ“çºµ API å¯†é’¥æ›´æ–°åŠŸèƒ½çš„ç»“æœã€‚
* **æŠ€æœ¯:** åˆ©ç”¨åƒ Burp Suite è¿™æ ·çš„å·¥å…·ï¼Œæ”»å‡»è€…æ„é€ ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ª `api_key` å‚æ•°ï¼šä¸€ä¸ªåˆæ³•çš„å’Œä¸€ä¸ªæ¶æ„çš„ã€‚æœåŠ¡å™¨åªå¤„ç†æœ€åä¸€ä¸ªå‡ºç°çš„å‚æ•°ï¼Œå°† API å¯†é’¥æ›´æ–°ä¸ºæ”»å‡»è€…æä¾›çš„å€¼ã€‚
* **ç»“æœ:** æ”»å‡»è€…æ§åˆ¶äº†å—å®³è€…çš„ API åŠŸèƒ½ï¼Œå¯èƒ½æœªç»æˆæƒè®¿é—®æˆ–ä¿®æ”¹ç§æœ‰æ•°æ®ã€‚

è¿™ä¸ªä¾‹å­è¿›ä¸€æ­¥å¼ºè°ƒäº†å®‰å…¨å‚æ•°å¤„ç†çš„å¿…è¦æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åƒ API å¯†é’¥ç®¡ç†è¿™æ ·å…³é”®çš„åŠŸèƒ½ä¸­ã€‚

### å‚æ•°è§£æï¼šFlask ä¸ PHP

Web æŠ€æœ¯å¤„ç†é‡å¤ HTTP å‚æ•°çš„æ–¹å¼å„ä¸ç›¸åŒï¼Œå½±å“å…¶å¯¹ HPP æ”»å‡»çš„æ˜“å—æ”»å‡»æ€§ï¼š

* **Flask:** é‡‡ç”¨é‡åˆ°çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼ï¼Œä¾‹å¦‚åœ¨æŸ¥è¯¢å­—ç¬¦ä¸² `a=1&a=2` ä¸­ä¼˜å…ˆè€ƒè™‘åˆå§‹å®ä¾‹è€Œéåç»­é‡å¤ã€‚
* **PHPï¼ˆåœ¨ Apache HTTP æœåŠ¡å™¨ä¸Šï¼‰:** ç›¸åï¼Œä¼˜å…ˆè€ƒè™‘æœ€åä¸€ä¸ªå‚æ•°å€¼ï¼Œåœ¨ç»™å®šç¤ºä¾‹ä¸­é€‰æ‹© `a=2`ã€‚è¿™ç§è¡Œä¸ºå¯èƒ½æ— æ„ä¸­é€šè¿‡ä¼˜å…ˆè€ƒè™‘æ”»å‡»è€…æ“çºµçš„å‚æ•°è€Œä¿ƒè¿› HPP åˆ©ç”¨ã€‚

## æŒ‰æŠ€æœ¯çš„å‚æ•°æ±¡æŸ“

ç»“æœæ¥è‡ª [https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89](https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89)

### PHP 8.3.11 å’Œ Apache 2.4.62 <a href="#id-9523" id="id-9523"></a>

<figure><img src="../.gitbook/assets/image (1255).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l_Pf2JNCYhmfAvfk7UTEbQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l_Pf2JNCYhmfAvfk7UTEbQ.jpeg</a></p></figcaption></figure>

1. å¿½ç•¥å‚æ•°åç§°ä¸­çš„ %00 ä¹‹åçš„ä»»ä½•å†…å®¹ã€‚
2. å°† name\[] è§†ä¸ºæ•°ç»„ã€‚
3. \_GET ä¸æ„å‘³ç€ GET æ–¹æ³•ã€‚
4. ä¼˜å…ˆè€ƒè™‘æœ€åä¸€ä¸ªå‚æ•°ã€‚

### Ruby 3.3.5 å’Œ WEBrick 1.8.2

<figure><img src="../.gitbook/assets/image (1257).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kKxtZ8qEmgTIMS81py5hhg.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kKxtZ8qEmgTIMS81py5hhg.jpeg</a></p></figcaption></figure>

1. ä½¿ç”¨ & å’Œ ; åˆ†éš”ç¬¦æ¥åˆ†å‰²å‚æ•°ã€‚
2. ä¸è¯†åˆ« name\[]ã€‚
3. ä¼˜å…ˆè€ƒè™‘ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

### Spring MVC 6.0.23 å’Œ Apache Tomcat 10.1.30 <a href="#dd68" id="dd68"></a>

<figure><img src="../.gitbook/assets/image (1258).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*llG22MF1gPTYZYFVCmCiVw.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*llG22MF1gPTYZYFVCmCiVw.jpeg</a></p></figcaption></figure>

1. POST RequestMapping == PostMapping & GET RequestMapping == GetMappingã€‚
2. POST RequestMapping & PostMapping è¯†åˆ« name\[]ã€‚
3. å¦‚æœ name å’Œ name\[] åŒæ—¶å­˜åœ¨ï¼Œä¼˜å…ˆè€ƒè™‘ nameã€‚
4. è¿æ¥å‚æ•°ï¼Œä¾‹å¦‚ first,lastã€‚
5. POST RequestMapping & PostMapping è¯†åˆ«å¸¦æœ‰ Content-Type çš„æŸ¥è¯¢å‚æ•°ã€‚

### **NodeJS** 20.17.0 **å’Œ** Express 4.21.0 <a href="#id-6d72" id="id-6d72"></a>

<figure><img src="../.gitbook/assets/image (1259).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JzNkLOSW7orcHXswtMHGMA.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JzNkLOSW7orcHXswtMHGMA.jpeg</a></p></figcaption></figure>

1. è¯†åˆ« name\[]ã€‚
2. è¿æ¥å‚æ•°ï¼Œä¾‹å¦‚ first,lastã€‚

### GO 1.22.7 <a href="#id-63dc" id="id-63dc"></a>

<figure><img src="../.gitbook/assets/image (1260).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NVvN1N8sL4g_Gi796FzlZA.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NVvN1N8sL4g_Gi796FzlZA.jpeg</a></p></figcaption></figure>

1. ä¸è¯†åˆ« name\[]ã€‚
2. ä¼˜å…ˆè€ƒè™‘ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

### Python 3.12.6 å’Œ Werkzeug 3.0.4 å’Œ Flask 3.0.3 <a href="#b853" id="b853"></a>

<figure><img src="../.gitbook/assets/image (1261).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Se5467PFFjIlmT3O7KNlWQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Se5467PFFjIlmT3O7KNlWQ.jpeg</a></p></figcaption></figure>

1. ä¸è¯†åˆ« name\[]ã€‚
2. ä¼˜å…ˆè€ƒè™‘ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

### Python 3.12.6 å’Œ Django 4.2.15 <a href="#id-8079" id="id-8079"></a>

<figure><img src="../.gitbook/assets/image (1262).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rf38VXut5YhAx0ZhUzgT8Q.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rf38VXut5YhAx0ZhUzgT8Q.jpeg</a></p></figcaption></figure>

1. ä¸è¯†åˆ« name\[]ã€‚
2. ä¼˜å…ˆè€ƒè™‘æœ€åä¸€ä¸ªå‚æ•°ã€‚

### Python 3.12.6 å’Œ Tornado 6.4.1 <a href="#id-2ad8" id="id-2ad8"></a>

<figure><img src="../.gitbook/assets/image (1263).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*obCn7xahDc296JZccXM2qQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*obCn7xahDc296JZccXM2qQ.jpeg</a></p></figcaption></figure>

1. ä¸è¯†åˆ« name\[]ã€‚
2. ä¼˜å…ˆè€ƒè™‘æœ€åä¸€ä¸ªå‚æ•°ã€‚

## JSON æ³¨å…¥

### é‡å¤é”®
```ini
obj = {"test": "user", "test": "admin"}
```
å‰ç«¯å¯èƒ½ä¼šç›¸ä¿¡ç¬¬ä¸€ä¸ªå‡ºç°ï¼Œè€Œåç«¯ä½¿ç”¨çš„æ˜¯é”®çš„ç¬¬äºŒä¸ªå‡ºç°ã€‚

### é”®å†²çªï¼šå­—ç¬¦æˆªæ–­å’Œæ³¨é‡Š

æŸäº›å­—ç¬¦åœ¨å‰ç«¯å¯èƒ½æ— æ³•è¢«æ­£ç¡®è§£æï¼Œä½†åç«¯ä¼šè§£æå®ƒä»¬å¹¶ä½¿ç”¨è¿™äº›é”®ï¼Œè¿™å¯èƒ½æœ‰åŠ©äº**ç»•è¿‡æŸäº›é™åˆ¶**ï¼š
```json
{"test": 1, "test\[raw \x0d byte]": 2}
{"test": 1, "test\ud800": 2}
{"test": 1, "test"": 2}
{"test": 1, "te\st": 2}
```
æ³¨æ„åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå‰ç«¯å¯èƒ½è®¤ä¸º `test == 1`ï¼Œè€Œåç«¯åˆ™è®¤ä¸º `test == 2`ã€‚

è¿™ä¹Ÿå¯ä»¥ç”¨æ¥ç»•è¿‡å€¼é™åˆ¶ï¼Œä¾‹å¦‚ï¼š
```json
{"role": "administrator\[raw \x0d byte]"}
{"role":"administrator\ud800"}
{"role": "administrator""}
{"role": "admini\strator"}
```
### **ä½¿ç”¨æ³¨é‡Šæˆªæ–­**

{% code overflow="wrap" %}
```ini
obj = {"description": "Duplicate with comments", "test": 2, "extra": /*, "test": 1, "extra2": */}
```
{% endcode %}

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¯ä¸ªè§£æå™¨çš„åºåˆ—åŒ–å™¨æ¥æŸ¥çœ‹å…¶å„è‡ªçš„è¾“å‡ºã€‚

åºåˆ—åŒ–å™¨ 1ï¼ˆä¾‹å¦‚ï¼ŒGoLang çš„ GoJay åº“ï¼‰å°†äº§ç”Ÿï¼š

* `description = "Duplicate with comments"`
* `test = 2`
* `extra = ""`

åºåˆ—åŒ–å™¨ 2ï¼ˆä¾‹å¦‚ï¼ŒJava çš„ JSON-iterator åº“ï¼‰å°†äº§ç”Ÿï¼š

* `description = "Duplicate with comments"`
* `extra = "/*"`
* `extra2 = "*/"`
* `test = 1`

æˆ–è€…ï¼Œç›´æ¥ä½¿ç”¨æ³¨é‡Šä¹Ÿå¯ä»¥æœ‰æ•ˆï¼š
```ini
obj = {"description": "Comment support", "test": 1, "extra": "a"/*, "test": 2, "extra2": "b"*/}
```
Javaçš„GSONåº“ï¼š
```json
{"description":"Comment support","test":1,"extra":"a"}
```
Rubyçš„simdjsonåº“ï¼š
```json
{"description":"Comment support","test":2,"extra":"a","extra2":"b"}
```
### **ä¸ä¸€è‡´çš„ä¼˜å…ˆçº§ï¼šååºåˆ—åŒ–ä¸åºåˆ—åŒ–**
```ini
obj = {"test": 1, "test": 2}

obj["test"] // 1
obj.toString() // {"test": 2}
```
### Float and Integer

æ•°å­—
```undefined
999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
```
å¯ä»¥è§£ç ä¸ºå¤šç§è¡¨ç¤ºå½¢å¼ï¼ŒåŒ…æ‹¬ï¼š
```undefined
999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
9.999999999999999e95
1E+96
0
9223372036854775807
```
å¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´

## å‚è€ƒæ–‡çŒ®

* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)
* [https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89](https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89)
* [https://bishopfox.com/blog/json-interoperability-vulnerabilities](https://bishopfox.com/blog/json-interoperability-vulnerabilities)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
