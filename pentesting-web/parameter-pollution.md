# Pollution de Param√®tre | Injection JSON

## Pollution de Param√®tre

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Formation AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Formation GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR au** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos GitHub.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Vue d'ensemble de la Pollution de Param√®tre HTTP (HPP)

La Pollution de Param√®tre HTTP (HPP) est une technique o√π les attaquants manipulent les param√®tres HTTP pour changer le comportement d'une application web de mani√®re inattendue. Cette manipulation se fait en ajoutant, modifiant ou dupliquant des param√®tres HTTP. L'effet de ces manipulations n'est pas directement visible pour l'utilisateur mais peut alt√©rer consid√©rablement la fonctionnalit√© de l'application c√¥t√© serveur, avec des impacts observables c√¥t√© client.

### Exemple de Pollution de Param√®tre HTTP (HPP)

Une URL de transaction d'application bancaire :

* **URL d'origine :** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

En ins√©rant un param√®tre `from` suppl√©mentaire :

* **URL manipul√©e :** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

La transaction peut √™tre incorrectement factur√©e √† `accountC` au lieu de `accountA`, montrant le potentiel de HPP pour manipuler des transactions ou d'autres fonctionnalit√©s telles que les r√©initialisations de mot de passe, les param√®tres 2FA ou les demandes de cl√© API.

#### **Analyse des Param√®tres Sp√©cifique √† la Technologie**

* La mani√®re dont les param√®tres sont analys√©s et prioris√©s d√©pend de la technologie web sous-jacente, affectant la fa√ßon dont HPP peut √™tre exploit√©.
* Des outils comme [Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/) aident √† identifier ces technologies et leurs comportements d'analyse.

### Exploitation de PHP et HPP

**Cas de Manipulation d'OTP :**

* **Contexte :** Un m√©canisme de connexion n√©cessitant un mot de passe √† usage unique (OTP) a √©t√© exploit√©.
* **M√©thode :** En interceptant la demande d'OTP √† l'aide d'outils comme Burp Suite, les attaquants ont dupliqu√© le param√®tre `email` dans la requ√™te HTTP.
* **R√©sultat :** L'OTP, destin√© √† l'email initial, a √©t√© envoy√© √† la deuxi√®me adresse email sp√©cifi√©e dans la requ√™te manipul√©e. Ce d√©faut a permis un acc√®s non autoris√© en contournant la mesure de s√©curit√© pr√©vue.

Ce sc√©nario met en √©vidence une n√©gligence critique dans le backend de l'application, qui a trait√© le premier param√®tre `email` pour la g√©n√©ration d'OTP mais a utilis√© le dernier pour la livraison.

**Cas de Manipulation de Cl√© API :**

* **Sc√©nario :** Une application permet aux utilisateurs de mettre √† jour leur cl√© API via une page de param√®tres de profil.
* **Vecteur d'attaque :** Un attaquant d√©couvre qu'en ajoutant un param√®tre `api_key` suppl√©mentaire √† la requ√™te POST, il peut manipuler le r√©sultat de la fonction de mise √† jour de la cl√© API.
* **Technique :** En utilisant un outil comme Burp Suite, l'attaquant cr√©e une requ√™te qui inclut deux param√®tres `api_key` : un l√©gitime et un malveillant. Le serveur, ne traitant que la derni√®re occurrence, met √† jour la cl√© API avec la valeur fournie par l'attaquant.
* **R√©sultat :** L'attaquant prend le contr√¥le de la fonctionnalit√© API de la victime, acc√©dant ou modifiant potentiellement des donn√©es priv√©es sans autorisation.

Cet exemple souligne encore la n√©cessit√© d'une gestion s√©curis√©e des param√®tres, en particulier dans des fonctionnalit√©s aussi critiques que la gestion des cl√©s API.

### Analyse des Param√®tres : Flask vs. PHP

La mani√®re dont les technologies web g√®rent les param√®tres HTTP dupliqu√©s varie, affectant leur susceptibilit√© aux attaques HPP :

* **Flask :** Adopte la premi√®re valeur de param√®tre rencontr√©e, comme `a=1` dans une cha√Æne de requ√™te `a=1&a=2`, priorisant l'instance initiale sur les duplicatas suivants.
* **PHP (sur Apache HTTP Server) :** Au contraire, priorise la derni√®re valeur de param√®tre, optant pour `a=2` dans l'exemple donn√©. Ce comportement peut faciliter involontairement les exploits HPP en honorant le param√®tre manipul√© par l'attaquant plut√¥t que l'original.

## Pollution de param√®tre par technologie

Les r√©sultats ont √©t√© tir√©s de [https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89](https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89)

### PHP 8.3.11 ET Apache 2.4.62 <a href="#id-9523" id="id-9523"></a>

<figure><img src="../.gitbook/assets/image (1255).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l_Pf2JNCYhmfAvfk7UTEbQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l_Pf2JNCYhmfAvfk7UTEbQ.jpeg</a></p></figcaption></figure>

1. Ignore tout apr√®s %00 dans le nom du param√®tre.
2. Traiter name\[] comme un tableau.
3. \_GET ne signifie pas m√©thode GET.
4. Pr√©f√©rer le dernier param√®tre.

### Ruby 3.3.5 et WEBrick 1.8.2

<figure><img src="../.gitbook/assets/image (1257).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kKxtZ8qEmgTIMS81py5hhg.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kKxtZ8qEmgTIMS81py5hhg.jpeg</a></p></figcaption></figure>

1. Utilise les d√©limiteurs & et ; pour s√©parer les param√®tres.
2. Nom\[] non reconnu.
3. Pr√©f√©rer le premier param√®tre.

### Spring MVC 6.0.23 ET Apache Tomcat 10.1.30 <a href="#dd68" id="dd68"></a>

<figure><img src="../.gitbook/assets/image (1258).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*llG22MF1gPTYZYFVCmCiVw.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*llG22MF1gPTYZYFVCmCiVw.jpeg</a></p></figcaption></figure>

1. POST RequestMapping == PostMapping & GET RequestMapping == GetMapping.
2. POST RequestMapping & PostMapping reconnaissent name\[].
3. Pr√©f√©rer name si name ET name\[] existent.
4. Concat√©ner les param√®tres par exemple, first,last.
5. POST RequestMapping & PostMapping reconnaissent le param√®tre de requ√™te avec Content-Type.

### **NodeJS** 20.17.0 **ET** Express 4.21.0 <a href="#id-6d72" id="id-6d72"></a>

<figure><img src="../.gitbook/assets/image (1259).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JzNkLOSW7orcHXswtMHGMA.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JzNkLOSW7orcHXswtMHGMA.jpeg</a></p></figcaption></figure>

1. Reconna√Æt name\[].
2. Concat√©ner les param√®tres par exemple, first,last.

### GO 1.22.7 <a href="#id-63dc" id="id-63dc"></a>

<figure><img src="../.gitbook/assets/image (1260).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NVvN1N8sL4g_Gi796FzlZA.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NVvN1N8sL4g_Gi796FzlZA.jpeg</a></p></figcaption></figure>

1. NOM pas reconnu name\[].
2. Pr√©f√©rer le premier param√®tre.

### Python 3.12.6 ET Werkzeug 3.0.4 ET Flask 3.0.3 <a href="#b853" id="b853"></a>

<figure><img src="../.gitbook/assets/image (1261).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Se5467PFFjIlmT3O7KNlWQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Se5467PFFjIlmT3O7KNlWQ.jpeg</a></p></figcaption></figure>

1. NOM pas reconnu name\[].
2. Pr√©f√©rer le premier param√®tre.

### Python 3.12.6 ET Django 4.2.15 <a href="#id-8079" id="id-8079"></a>

<figure><img src="../.gitbook/assets/image (1262).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rf38VXut5YhAx0ZhUzgT8Q.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rf38VXut5YhAx0ZhUzgT8Q.jpeg</a></p></figcaption></figure>

1. NOM pas reconnu name\[].
2. Pr√©f√©rer le dernier param√®tre.

### Python 3.12.6 ET Tornado 6.4.1 <a href="#id-2ad8" id="id-2ad8"></a>

<figure><img src="../.gitbook/assets/image (1263).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*obCn7xahDc296JZccXM2qQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*obCn7xahDc296JZccXM2qQ.jpeg</a></p></figcaption></figure>

1. NOM pas reconnu name\[].
2. Pr√©f√©rer le dernier param√®tre.

## Injection JSON

### Cl√©s dupliqu√©es
```ini
obj = {"test": "user", "test": "admin"}
```
L'interface utilisateur pourrait croire la premi√®re occurrence tandis que le backend utilise la deuxi√®me occurrence de la cl√©.

### Collision de Cl√© : Troncature de Caract√®res et Commentaires

Certains caract√®res ne seront pas correctement interpr√©t√©s par l'interface utilisateur, mais le backend les interpr√©tera et utilisera ces cl√©s, cela pourrait √™tre utile pour **contourner certaines restrictions** :
```json
{"test": 1, "test\[raw \x0d byte]": 2}
{"test": 1, "test\ud800": 2}
{"test": 1, "test"": 2}
{"test": 1, "te\st": 2}
```
Notez comment dans ces cas, le front-end pourrait penser que `test == 1` et le back-end pensera que `test == 2`.

Cela peut √©galement √™tre utilis√© pour contourner les restrictions de valeur telles que :
```json
{"role": "administrator\[raw \x0d byte]"}
{"role":"administrator\ud800"}
{"role": "administrator""}
{"role": "admini\strator"}
```
### **Utilisation de la Troncature de Commentaire**

{% code overflow="wrap" %}
```ini
obj = {"description": "Duplicate with comments", "test": 2, "extra": /*, "test": 1, "extra2": */}
```
{% endcode %}

Ici, nous utiliserons le s√©rialiseur de chaque analyseur pour voir sa sortie respective.

S√©rialiseur 1 (par exemple, la biblioth√®que GoJay de GoLang) produira :

* `description = "Duplicate with comments"`
* `test = 2`
* `extra = ""`

S√©rialiseur 2 (par exemple, la biblioth√®que JSON-iterator de Java) produira :

* `description = "Duplicate with comments"`
* `extra = "/*"`
* `extra2 = "*/"`
* `test = 1`

Alternativement, l'utilisation directe de commentaires peut √©galement √™tre efficace :
```ini
obj = {"description": "Comment support", "test": 1, "extra": "a"/*, "test": 2, "extra2": "b"*/}
```
La biblioth√®que GSON de Java :
```json
{"description":"Comment support","test":1,"extra":"a"}
```
La biblioth√®que simdjson de Ruby :
```json
{"description":"Comment support","test":2,"extra":"a","extra2":"b"}
```
### **Pr√©c√©dence Incoh√©rente : D√©s√©rialisation vs. S√©rialisation**
```ini
obj = {"test": 1, "test": 2}

obj["test"] // 1
obj.toString() // {"test": 2}
```
### Float et Entier

Le nombre
```undefined
999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
```
peut √™tre d√©cod√© en plusieurs repr√©sentations, y compris :
```undefined
999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
9.999999999999999e95
1E+96
0
9223372036854775807
```
Which might create inconsistences

## R√©f√©rences

* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)
* [https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89](https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89)
* [https://bishopfox.com/blog/json-interoperability-vulnerabilities](https://bishopfox.com/blog/json-interoperability-vulnerabilities)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
