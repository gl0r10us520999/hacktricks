# Tomada de Conta

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## **Problema de Autoriza√ß√£o**

O email de uma conta deve ser tentado para ser alterado, e o processo de confirma√ß√£o **deve ser examinado**. Se encontrado **fraco**, o email deve ser alterado para o do alvo pretendido e ent√£o confirmado.

## **Problema de Normaliza√ß√£o Unicode**

1. A conta da v√≠tima pretendida `victim@gmail.com`
2. Uma conta deve ser criada usando Unicode\
por exemplo: `viƒátim@gmail.com`

Como explicado em [**esta palestra**](https://www.youtube.com/watch?v=CiIyaZ3x49c), o ataque anterior tamb√©m poderia ser realizado abusando de provedores de identidade de terceiros:

* Crie uma conta no provedor de identidade de terceiros com um email semelhante ao da v√≠tima usando algum caractere unicode (`viƒátim@company.com`).
* O provedor de terceiros n√£o deve verificar o email
* Se o provedor de identidade verificar o email, talvez voc√™ possa atacar a parte do dom√≠nio como: `victim@ƒáompany.com` e registrar esse dom√≠nio e esperar que o provedor de identidade gere a vers√£o ascii do dom√≠nio enquanto a plataforma da v√≠tima normaliza o nome do dom√≠nio.
* Fa√ßa login via este provedor de identidade na plataforma da v√≠tima que deve normalizar o caractere unicode e permitir que voc√™ acesse a conta da v√≠tima.

Para mais detalhes, consulte o documento sobre Normaliza√ß√£o Unicode:

{% content-ref url="unicode-injection/unicode-normalization.md" %}
[unicode-normalization.md](unicode-injection/unicode-normalization.md)
{% endcontent-ref %}

## **Reutilizando Token de Redefini√ß√£o**

Se o sistema alvo permitir que o **link de redefini√ß√£o seja reutilizado**, esfor√ßos devem ser feitos para **encontrar mais links de redefini√ß√£o** usando ferramentas como `gau`, `wayback` ou `scan.io`.

## **Pr√© Tomada de Conta**

1. O email da v√≠tima deve ser usado para se inscrever na plataforma, e uma senha deve ser definida (uma tentativa de confirm√°-la deve ser feita, embora a falta de acesso aos emails da v√≠tima possa tornar isso imposs√≠vel).
2. Deve-se esperar at√© que a v√≠tima se inscreva usando OAuth e confirme a conta.
3. Espera-se que a inscri√ß√£o regular seja confirmada, permitindo o acesso √† conta da v√≠tima.

## **Configura√ß√£o CORS Incorreta para Tomada de Conta**

Se a p√°gina contiver **configura√ß√µes CORS incorretas**, voc√™ pode ser capaz de **roubar informa√ß√µes sens√≠veis** do usu√°rio para **tomar conta de sua conta** ou fazer com que ele altere informa√ß√µes de autentica√ß√£o para o mesmo prop√≥sito:

{% content-ref url="cors-bypass.md" %}
[cors-bypass.md](cors-bypass.md)
{% endcontent-ref %}

## **CSRF para Tomada de Conta**

Se a p√°gina for vulner√°vel a CSRF, voc√™ pode ser capaz de fazer com que o **usu√°rio modifique sua senha**, email ou autentica√ß√£o para que voc√™ possa acess√°-la:

{% content-ref url="csrf-cross-site-request-forgery.md" %}
[csrf-cross-site-request-forgery.md](csrf-cross-site-request-forgery.md)
{% endcontent-ref %}

## **XSS para Tomada de Conta**

Se voc√™ encontrar um XSS na aplica√ß√£o, pode ser capaz de roubar cookies, armazenamento local ou informa√ß√µes da p√°gina da web que poderiam permitir que voc√™ tomasse conta da conta:

{% content-ref url="xss-cross-site-scripting/" %}
[xss-cross-site-scripting](xss-cross-site-scripting/)
{% endcontent-ref %}

## **Mesma Origem + Cookies**

Se voc√™ encontrar um XSS limitado ou uma tomada de subdom√≠nio, voc√™ poderia brincar com os cookies (fixando-os, por exemplo) para tentar comprometer a conta da v√≠tima:

{% content-ref url="hacking-with-cookies/" %}
[hacking-with-cookies](hacking-with-cookies/)
{% endcontent-ref %}

## **Atacando o Mecanismo de Redefini√ß√£o de Senha**

{% content-ref url="reset-password.md" %}
[reset-password.md](reset-password.md)
{% endcontent-ref %}

## **Manipula√ß√£o de Resposta**

Se a resposta de autentica√ß√£o puder ser **reduzida a um simples booleano, apenas tente mudar falso para verdadeiro** e veja se voc√™ obt√©m algum acesso.

## OAuth para Tomada de Conta

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

## Inje√ß√£o de Cabe√ßalho Host

1. O cabe√ßalho Host √© modificado ap√≥s a inicia√ß√£o de um pedido de redefini√ß√£o de senha.
2. O cabe√ßalho proxy `X-Forwarded-For` √© alterado para `attacker.com`.
3. Os cabe√ßalhos Host, Referrer e Origin s√£o simultaneamente alterados para `attacker.com`.
4. Ap√≥s iniciar uma redefini√ß√£o de senha e optar por reenviar o email, todos os tr√™s m√©todos mencionados s√£o empregados.

## Manipula√ß√£o de Resposta

1. **Manipula√ß√£o de C√≥digo**: O c√≥digo de status √© alterado para `200 OK`.
2. **Manipula√ß√£o de C√≥digo e Corpo**:
* O c√≥digo de status √© alterado para `200 OK`.
* O corpo da resposta √© modificado para `{"success":true}` ou um objeto vazio `{}`.

Essas t√©cnicas de manipula√ß√£o s√£o eficazes em cen√°rios onde JSON √© utilizado para transmiss√£o e recebimento de dados.

## Alterar email da sess√£o atual

A partir [deste relat√≥rio](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea):

* O atacante solicita a altera√ß√£o de seu email para um novo
* O atacante recebe um link para confirmar a altera√ß√£o do email
* O atacante envia o link para a v√≠tima para que ela clique
* O email da v√≠tima √© alterado para o indicado pelo atacante
* O atacante pode recuperar a senha e tomar conta da conta

Isso tamb√©m aconteceu em [**este relat√≥rio**](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea).

### Cookies Antigos

Como explicado [**neste post**](https://medium.com/@niraj1mahajan/uncovering-the-hidden-vulnerability-how-i-found-an-authentication-bypass-on-shopifys-exchange-cc2729ea31a9), foi poss√≠vel fazer login em uma conta, salvar os cookies como um usu√°rio autenticado, sair e ent√£o fazer login novamente.\
Com o novo login, embora cookies diferentes possam ser gerados, os antigos come√ßaram a funcionar novamente.

## Refer√™ncias

* [https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050](https://infosecwriteups.com/firing-8-account-takeover-methods-77e892099050)
* [https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea](https://dynnyd20.medium.com/one-click-account-take-over-e500929656ea)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
