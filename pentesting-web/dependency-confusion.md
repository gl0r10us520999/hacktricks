# Confusion de D√©pendance

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Informations de Base

En r√©sum√©, une vuln√©rabilit√© de confusion de d√©pendance se produit lorsqu'un projet utilise une biblioth√®que avec un nom **mal orthographi√©**, **inexistant** ou avec une **version non sp√©cifi√©e** et le d√©p√¥t de d√©pendances utilis√© permet de **rassembler des versions mises √† jour √† partir de d√©p√¥ts publics**.

* **Mal orthographi√©** : Importer **`reqests`** au lieu de `requests`
* **Inexistant** : Importer `company-logging`, une biblioth√®que interne qui **n'existe plus**
* **Version non sp√©cifi√©e** : Importer une biblioth√®que `company-requests` **interne** **existante**, mais le d√©p√¥t v√©rifie les **d√©p√¥ts publics** pour voir s'il existe des **versions sup√©rieures**.

## Exploitation

{% hint style="warning" %}
Dans tous les cas, l'attaquant doit simplement publier un **package malveillant avec le nom** des biblioth√®ques utilis√©es par l'entreprise victime.
{% endhint %}

### Mal Orthographi√© & Inexistant

Si votre entreprise essaie d'**importer une biblioth√®que qui n'est pas interne**, il est tr√®s probable que le d√©p√¥t de biblioth√®ques va la rechercher dans des **d√©p√¥ts publics**. Si un attaquant l'a cr√©√©e, votre code et les machines en cours d'ex√©cution seront tr√®s probablement compromis.

### Version Non Sp√©cifi√©e

Il est tr√®s courant que les d√©veloppeurs **ne sp√©cifient aucune version** de la biblioth√®que utilis√©e, ou sp√©cifient juste une **version majeure**. Ensuite, l'interpr√©teur essaiera de t√©l√©charger la **derni√®re version** correspondant √† ces exigences.\
Si la biblioth√®que est une **biblioth√®que externe connue** (comme python `requests`), un **attaquant ne peut pas faire grand-chose**, car il ne pourra pas cr√©er une biblioth√®que appel√©e `requests` (√† moins qu'il ne soit l'auteur original).\
Cependant, si la biblioth√®que est **interne**, comme `requests-company` dans cet exemple, si le **d√©p√¥t de la biblioth√®que** permet de **v√©rifier les nouvelles versions √©galement de mani√®re externe**, il recherchera une version plus r√©cente disponible publiquement.\
Donc, si un **attaquant sait** que l'entreprise utilise la biblioth√®que `requests-company` **version 1.0.1** (permettant des mises √† jour mineures). Il peut **publier** la biblioth√®que `requests-company` **version 1.0.2** et l'entreprise **utilisera cette biblioth√®que √† la place** de l'interne.

## Correction AWS

Cette vuln√©rabilit√© a √©t√© trouv√©e dans AWS **CodeArtifact** (lisez les [**d√©tails dans cet article de blog**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)).\
AWS a corrig√© cela en permettant de sp√©cifier si une biblioth√®que est interne ou externe, pour √©viter de t√©l√©charger des d√©pendances internes √† partir de d√©p√¥ts externes.

## Trouver des Biblioth√®ques Vuln√©rables

Dans le [**post original sur la confusion de d√©pendance**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610), l'auteur a recherch√© des milliers de fichiers package.json expos√©s contenant les d√©pendances de projets javascript.

## R√©f√©rences

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
