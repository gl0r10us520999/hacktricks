# Confus√£o de Depend√™ncia

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## Informa√ß√µes B√°sicas

Em resumo, uma vulnerabilidade de confus√£o de depend√™ncia ocorre quando um projeto est√° usando uma biblioteca com um nome **mal escrito**, **inexistente** ou com uma **vers√£o n√£o especificada** e o reposit√≥rio de depend√™ncias utilizado permite **coletar vers√µes atualizadas de reposit√≥rios p√∫blicos**.

* **Mal escrito**: Importar **`reqests`** em vez de `requests`
* **Inexistente**: Importar `company-logging`, uma biblioteca interna que **n√£o existe mais**
* **Vers√£o n√£o especificada**: Importar uma biblioteca `company-requests` **interna** **existente**, mas o reposit√≥rio verifica **reposit√≥rios p√∫blicos** para ver se h√° **vers√µes maiores**.

## Explora√ß√£o

{% hint style="warning" %}
Em todos os casos, o atacante s√≥ precisa publicar um **pacote malicioso com o nome** das bibliotecas usadas pela empresa v√≠tima.
{% endhint %}

### Mal Escrito & Inexistente

Se sua empresa est√° tentando **importar uma biblioteca que n√£o √© interna**, √© altamente prov√°vel que o reposit√≥rio de bibliotecas esteja procurando por ela em **reposit√≥rios p√∫blicos**. Se um atacante a criou, seu c√≥digo e m√°quinas em execu√ß√£o provavelmente estar√£o comprometidos.

### Vers√£o N√£o Especificada

√â muito comum que os desenvolvedores **n√£o especifiquem nenhuma vers√£o** da biblioteca utilizada, ou especifiquem apenas uma **vers√£o maior**. Ent√£o, o interpretador tentar√° baixar a **√∫ltima vers√£o** que atenda a esses requisitos.\
Se a biblioteca for uma **biblioteca externa conhecida** (como o `requests` do python), um **atacante n√£o pode fazer muito**, pois ele n√£o conseguir√° criar uma biblioteca chamada `requests` (a menos que seja o autor original).\
No entanto, se a biblioteca for **interna**, como `requests-company` neste exemplo, se o **reposit√≥rio da biblioteca** permitir **verificar novas vers√µes tamb√©m externamente**, ele buscar√° por uma vers√£o mais nova dispon√≠vel publicamente.\
Portanto, se um **atacante souber** que a empresa est√° usando a biblioteca `requests-company` **vers√£o 1.0.1** (permitindo atualiza√ß√µes menores). Ele pode **publicar** a biblioteca `requests-company` **vers√£o 1.0.2** e a empresa **usar√° essa biblioteca em vez** da interna.

## Corre√ß√£o AWS

Essa vulnerabilidade foi encontrada no AWS **CodeArtifact** (leia os [**detalhes neste post do blog**](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)).\
A AWS corrigiu isso permitindo especificar se uma biblioteca √© interna ou externa, para evitar o download de depend√™ncias internas de reposit√≥rios externos.

## Encontrando Bibliotecas Vulner√°veis

No [**post original sobre confus√£o de depend√™ncia**](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610), o autor pesquisou milhares de arquivos package.json expostos contendo as depend√™ncias de projetos javascript.

## Refer√™ncias

* [https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610)
* [https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d](https://zego.engineering/dependency-confusion-in-aws-codeartifact-86b9ff68963d)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
