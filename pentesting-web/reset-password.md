# Restablecimiento/Olvido de Contrase침a Bypass

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

춰칔nete al [**Discord de HackenProof**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas!

**Perspectivas de Hacking**\
Participa en contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hackeo en Tiempo Real**\
Mantente al d칤a con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por errores que se lanzan y actualizaciones cruciales de la plataforma

**춰칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

## **Filtraci칩n de Token de Restablecimiento de Contrase침a a Trav칠s del Referer**

* El encabezado HTTP referer puede filtrar el token de restablecimiento de contrase침a si se incluye en la URL. Esto puede ocurrir cuando un usuario hace clic en un enlace de un sitio web de terceros despu칠s de solicitar un restablecimiento de contrase침a.
* **Impacto**: Toma de control potencial de la cuenta a trav칠s de ataques de Cross-Site Request Forgery (CSRF).
* **Explotaci칩n**: Para verificar si un token de restablecimiento de contrase침a se est치 filtrando en el encabezado referer, **solicita un restablecimiento de contrase침a** a tu direcci칩n de correo electr칩nico y **haz clic en el enlace de restablecimiento** proporcionado. **No cambies tu contrase침a** de inmediato. En su lugar, **navega a un sitio web de terceros** (como Facebook o Twitter) mientras **interceptas las solicitudes usando Burp Suite**. Inspecciona las solicitudes para ver si el **encabezado referer contiene el token de restablecimiento de contrase침a**, ya que esto podr칤a exponer informaci칩n sensible a terceros.
* **Referencias**:
* [Informe de HackerOne 342693](https://hackerone.com/reports/342693)
* [Informe de HackerOne 272379](https://hackerone.com/reports/272379)
* [Art칤culo sobre Filtraci칩n de Token de Restablecimiento de Contrase침a](https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a)

## **Envenenamiento de Restablecimiento de Contrase침a**

* Los atacantes pueden manipular el encabezado Host durante las solicitudes de restablecimiento de contrase침a para apuntar el enlace de restablecimiento a un sitio malicioso.
* **Impacto**: Conduce a una posible toma de control de la cuenta al filtrar tokens de restablecimiento a los atacantes.
* **Pasos de Mitigaci칩n**:
* Valida el encabezado Host contra una lista blanca de dominios permitidos.
* Utiliza m칠todos seguros del lado del servidor para generar URLs absolutas.
* **Parche**: Usa `$_SERVER['SERVER_NAME']` para construir URLs de restablecimiento de contrase침a en lugar de `$_SERVER['HTTP_HOST']`.
* **Referencias**:
* [Art칤culo de Acunetix sobre Envenenamiento de Restablecimiento de Contrase침a](https://www.acunetix.com/blog/articles/password-reset-poisoning/)

## **Restablecimiento de Contrase침a Manipulando el Par치metro de Correo Electr칩nico**

Los atacantes pueden manipular la solicitud de restablecimiento de contrase침a agregando par치metros de correo electr칩nico adicionales para desviar el enlace de restablecimiento.

* Agrega el correo electr칩nico del atacante como segundo par치metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Agregar el correo electr칩nico del atacante como segundo par치metro en el array json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
* **Pasos de Mitigaci칩n**:
* Analizar y validar adecuadamente los par치metros de correo electr칩nico del lado del servidor.
* Utilizar declaraciones preparadas o consultas parametrizadas para prevenir ataques de inyecci칩n.
* **Referencias**:
* [https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be](https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be)
* [https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/](https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/)
* [https://twitter.com/HusseiN98D/status/1254888748216655872](https://twitter.com/HusseiN98D/status/1254888748216655872)

## **Cambio de Correo Electr칩nico y Contrase침a de Cualquier Usuario a Trav칠s de Par치metros de API**

* Los atacantes pueden modificar los par치metros de correo electr칩nico y contrase침a en las solicitudes de API para cambiar las credenciales de la cuenta.
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
* **Pasos de Mitigaci칩n**:
* Asegurar una validaci칩n estricta de par치metros y controles de autenticaci칩n.
* Implementar un registro y monitoreo robustos para detectar y responder a actividades sospechosas.
* **Referencia**:
* [Toma de Control Completa de Cuenta a trav칠s de Manipulaci칩n de Par치metros de API](https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240)

## **Sin Limitaci칩n de Tasa: Bombardeo de Correos Electr칩nicos**

* La falta de limitaci칩n de tasa en las solicitudes de restablecimiento de contrase침a puede llevar a un bombardeo de correos electr칩nicos, abrumando al usuario con correos de restablecimiento.
* **Pasos de Mitigaci칩n**:
* Implementar limitaci칩n de tasa basada en la direcci칩n IP o la cuenta de usuario.
* Usar desaf칤os CAPTCHA para prevenir abusos automatizados.
* **Referencias**:
* [Informe de HackerOne 280534](https://hackerone.com/reports/280534)

## **Descubrir C칩mo se Genera el Token de Restablecimiento de Contrase침a**

* Entender el patr칩n o m칠todo detr치s de la generaci칩n de tokens puede llevar a predecir o forzar tokens. Algunas opciones:
* Basado en Timestamp
* Basado en el UserID
* Basado en el correo electr칩nico del Usuario
* Basado en Nombre y Apellido
* Basado en Fecha de Nacimiento
* Basado en Criptograf칤a
* **Pasos de Mitigaci칩n**:
* Usar m칠todos criptogr치ficos fuertes para la generaci칩n de tokens.
* Asegurar suficiente aleatoriedad y longitud para prevenir la predictibilidad.
* **Herramientas**: Usar Burp Sequencer para analizar la aleatoriedad de los tokens.

## **UUID Adivinable**

* Si los UUIDs (versi칩n 1) son adivinables o predecibles, los atacantes pueden forzarlos para generar tokens de restablecimiento v치lidos. Verifique:

{% content-ref url="uuid-insecurities.md" %}
[uuid-insecurities.md](uuid-insecurities.md)
{% endcontent-ref %}

* **Pasos de Mitigaci칩n**:
* Usar GUID versi칩n 4 para aleatoriedad o implementar medidas de seguridad adicionales para otras versiones.
* **Herramientas**: Usar [guidtool](https://github.com/intruder-io/guidtool) para analizar y generar GUIDs.

## **Manipulaci칩n de Respuesta: Reemplazar Respuesta Mala con Buena**

* Manipular respuestas HTTP para eludir mensajes de error o restricciones.
* **Pasos de Mitigaci칩n**:
* Implementar verificaciones del lado del servidor para asegurar la integridad de la respuesta.
* Usar canales de comunicaci칩n seguros como HTTPS para prevenir ataques de hombre en el medio.
* **Referencia**:
* [Error Cr칤tico en Evento de Recompensa de Errores en Vivo](https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3)

## **Uso de Token Expirado**

* Probar si los tokens expirados a칰n pueden ser utilizados para el restablecimiento de contrase침a.
* **Pasos de Mitigaci칩n**:
* Implementar pol칤ticas estrictas de expiraci칩n de tokens y validar la expiraci칩n del token del lado del servidor.

## **Fuerza Bruta del Token de Restablecimiento de Contrase침a**

* Intentar forzar el token de restablecimiento usando herramientas como Burpsuite y IP-Rotator para eludir l칤mites de tasa basados en IP.
* **Pasos de Mitigaci칩n**:
* Implementar mecanismos robustos de limitaci칩n de tasa y bloqueo de cuentas.
* Monitorear actividades sospechosas indicativas de ataques de fuerza bruta.

## **Intenta Usar Tu Token**

* Probar si el token de restablecimiento de un atacante puede ser utilizado junto con el correo electr칩nico de la v칤ctima.
* **Pasos de Mitigaci칩n**:
* Asegurar que los tokens est칠n vinculados a la sesi칩n del usuario u otros atributos espec칤ficos del usuario.

## **Invalidaci칩n de Sesi칩n en Cierre de Sesi칩n/Restablecimiento de Contrase침a**

* Asegurar que las sesiones se invaliden cuando un usuario cierra sesi칩n o restablece su contrase침a.
* **Pasos de Mitigaci칩n**:
* Implementar una gesti칩n adecuada de sesiones, asegurando que todas las sesiones se invaliden al cerrar sesi칩n o restablecer la contrase침a.

## **Invalidaci칩n de Sesi칩n en Cierre de Sesi칩n/Restablecimiento de Contrase침a**

* Los tokens de restablecimiento deben tener un tiempo de expiraci칩n despu칠s del cual se vuelven inv치lidos.
* **Pasos de Mitigaci칩n**:
* Establecer un tiempo de expiraci칩n razonable para los tokens de restablecimiento y hacer cumplir estrictamente esto del lado del servidor.

## Referencias

* [https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token](https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token)

<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

춰칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas de errores!

**Perspectivas de Hacking**\
Participa con contenido que profundiza en la emoci칩n y los desaf칤os del hacking

**Noticias de Hackeo en Tiempo Real**\
Mantente al d칤a con el mundo del hacking de ritmo r치pido a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas de errores que se lanzan y actualizaciones cruciales de la plataforma

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
