# Malware Analizi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Adli BiliÅŸim Hile SayfalarÄ±

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/)

## Ã‡evrimiÃ§i Hizmetler

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)
* [Any.Run](https://any.run/)

## Ã‡evrimdÄ±ÅŸÄ± AntivirÃ¼s ve Tespit AraÃ§larÄ±

### Yara

#### Kurulum
```bash
sudo apt-get install -y yara
```
#### KurallarÄ± HazÄ±rlayÄ±n

Bu script'i kullanarak github'dan tÃ¼m yara kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m kurallarÄ±nÄ± indirin ve birleÅŸtirin: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\
_**rules**_ dizinini oluÅŸturun ve Ã§alÄ±ÅŸtÄ±rÄ±n. Bu, kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m iÃ§in tÃ¼m yara kurallarÄ±nÄ± iÃ§eren _**malware\_rules.yar**_ adlÄ± bir dosya oluÅŸturacaktÄ±r.
```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```
#### Tarama
```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```
#### YaraGen: KÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mÄ± kontrol et ve kurallar oluÅŸtur

Binary'den yara kurallarÄ± oluÅŸturmak iÃ§in [**YaraGen**](https://github.com/Neo23x0/yarGen) aracÄ±nÄ± kullanabilirsiniz. Bu eÄŸitimlere gÃ¶z atÄ±n: [**BÃ¶lÃ¼m 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**BÃ¶lÃ¼m 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**BÃ¶lÃ¼m 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)
```bash
python3 yarGen.py --update
python3.exe yarGen.py --excludegood -m  ../../mals/
```
### ClamAV

#### Kurulum
```
sudo apt-get install -y clamav
```
#### Tarama
```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```
### [Capa](https://github.com/mandiant/capa)

**Capa**, yÃ¼rÃ¼tÃ¼lebilir dosyalarda potansiyel olarak kÃ¶tÃ¼ niyetli **yetenekleri** tespit eder: PE, ELF, .NET. Bu nedenle, Att\&ck taktikleri veya aÅŸaÄŸÄ±daki gibi ÅŸÃ¼pheli yetenekler gibi ÅŸeyleri bulacaktÄ±r:

* OutputDebugString hatasÄ±nÄ± kontrol et
* bir hizmet olarak Ã§alÄ±ÅŸ
* iÅŸlem oluÅŸtur

Bunu [**Github repo**](https://github.com/mandiant/capa) Ã¼zerinden edinebilirsiniz.

### IOCs

IOC, Kompromi GÃ¶stergesi anlamÄ±na gelir. Bir IOC, bazÄ± potansiyel olarak istenmeyen yazÄ±lÄ±mlarÄ± veya onaylanmÄ±ÅŸ **kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ±** tanÄ±mlayan **koÅŸullarÄ±n** bir setidir. Mavi TakÄ±mlar, bu tÃ¼r tanÄ±mlarÄ± **sistemlerinde** ve **aÄŸlarÄ±nda** bu tÃ¼r kÃ¶tÃ¼ niyetli dosyalarÄ± **arama** amacÄ±yla kullanÄ±r.\
Bu tanÄ±mlarÄ± paylaÅŸmak Ã§ok faydalÄ±dÄ±r Ã§Ã¼nkÃ¼ bir bilgisayarda kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m tespit edildiÄŸinde ve o kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m iÃ§in bir IOC oluÅŸturulduÄŸunda, diÄŸer Mavi TakÄ±mlar bunu kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mÄ± daha hÄ±zlÄ± tanÄ±mlamak iÃ§in kullanabilir.

IOC'leri oluÅŸturmak veya deÄŸiÅŸtirmek iÃ§in bir araÃ§ [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\
TanÄ±mlÄ± IOCs'leri bir cihazda **arama** yapmak iÃ§in [**Redline**](https://www.fireeye.com/services/freeware/redline.html) gibi araÃ§larÄ± kullanabilirsiniz.

### Loki

[**Loki**](https://github.com/Neo23x0/Loki), Basit Kompromi GÃ¶stergeleri iÃ§in bir tarayÄ±cÄ±dÄ±r.\
Tespit, dÃ¶rt tespit yÃ¶ntemine dayanmaktadÄ±r:
```
1. File Name IOC
Regex match on full file path/name

2. Yara Rule Check
Yara signature matches on file data and process memory

3. Hash Check
Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files

4. C2 Back Connect Check
Compares process connection endpoints with C2 IOCs (new since version v.10)
```
### Linux Malware Detect

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) , paylaÅŸÄ±mlÄ± barÄ±ndÄ±rma ortamlarÄ±nda karÅŸÄ±laÅŸÄ±lan tehditler etrafÄ±nda tasarlanmÄ±ÅŸ, GNU GPLv2 lisansÄ± altÄ±nda yayÄ±mlanan bir Linux kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m tarayÄ±cÄ±sÄ±dÄ±r. SaldÄ±rÄ±larda aktif olarak kullanÄ±lan kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± Ã§Ä±karmak ve tespit iÃ§in imzalar oluÅŸturmak amacÄ±yla aÄŸ kenarÄ± saldÄ±rÄ± tespit sistemlerinden tehdit verilerini kullanÄ±r. AyrÄ±ca, tehdit verileri LMD Ã¶deme Ã¶zelliÄŸi ile kullanÄ±cÄ± gÃ¶nderimlerinden ve kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±m topluluÄŸu kaynaklarÄ±ndan da elde edilmektedir.

### rkhunter

[**rkhunter**](http://rkhunter.sourceforge.net) gibi araÃ§lar, dosya sisteminde olasÄ± **rootkit** ve kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± kontrol etmek iÃ§in kullanÄ±labilir.
```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```
### FLOSS

[**FLOSS**](https://github.com/mandiant/flare-floss) farklÄ± teknikler kullanarak yÃ¼rÃ¼tÃ¼lebilir dosyalar iÃ§inde obfuscate edilmiÅŸ dizeleri bulmaya Ã§alÄ±ÅŸan bir araÃ§tÄ±r.

### PEpper

[PEpper](https://github.com/Th3Hurrican3/PEpper) yÃ¼rÃ¼tÃ¼lebilir dosya iÃ§inde bazÄ± temel bilgileri (ikili veriler, entropi, URL'ler ve IP'ler, bazÄ± yara kurallarÄ±) kontrol eder.

### PEstudio

[PEstudio](https://www.winitor.com/download) Windows yÃ¼rÃ¼tÃ¼lebilir dosyalarÄ± hakkÄ±nda ithalat, ihracat, baÅŸlÄ±klar gibi bilgiler almayÄ± saÄŸlayan bir araÃ§tÄ±r, ayrÄ±ca virÃ¼s toplamÄ±nÄ± kontrol eder ve potansiyel Att\&ck tekniklerini bulur.

### Detect It Easy(DiE)

[**DiE**](https://github.com/horsicq/Detect-It-Easy/) bir dosyanÄ±n **ÅŸifreli** olup olmadÄ±ÄŸÄ±nÄ± tespit etmek ve ayrÄ±ca **paketleyicileri** bulmak iÃ§in bir araÃ§tÄ±r.

### NeoPI

[**NeoPI**](https://github.com/CiscoCXSecurity/NeoPI) metin/script dosyalarÄ± iÃ§inde **obfuscate** edilmiÅŸ ve **ÅŸifreli** iÃ§eriÄŸi tespit etmek iÃ§in Ã§eÅŸitli **istatistiksel yÃ¶ntemler** kullanan bir Python betiÄŸidir. NeoPI'nin amacÄ± **gizli web shell kodunun tespitine** yardÄ±mcÄ± olmaktÄ±r.

### **php-malware-finder**

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) **obfuscate** edilmiÅŸ/**ÅŸÃ¼pheli kodu** ve ayrÄ±ca **malware**/webshell'lerde sÄ±kÃ§a kullanÄ±lan **PHP** fonksiyonlarÄ±nÄ± iÃ§eren dosyalarÄ± tespit etmek iÃ§in elinden geleni yapar.

### Apple Binary Signatures

BazÄ± **malware Ã¶rneklerini** kontrol ederken, imzalayan **geliÅŸtiricinin** **malware** ile zaten **iliÅŸkili** olabileceÄŸinden dolayÄ± her zaman ikilinin **imzasÄ±nÄ± kontrol etmelisiniz.**
```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```
## Detection Techniques

### File Stacking

EÄŸer bir web sunucusunun **dosyalarÄ±nÄ±** iÃ§eren bir klasÃ¶rÃ¼n **son gÃ¼ncellenme tarihini biliyorsanÄ±z**. **Tarih** tÃ¼m **dosyalarÄ±n** **web sunucusunda oluÅŸturulma ve deÄŸiÅŸtirilme tarihlerini** kontrol edin ve eÄŸer herhangi bir tarih **ÅŸÃ¼pheli** ise, o dosyayÄ± kontrol edin.

### Baselines

EÄŸer bir klasÃ¶rÃ¼n dosyalarÄ± **deÄŸiÅŸtirilmemiÅŸ olmasÄ± gerekiyorsa**, klasÃ¶rÃ¼n **orijinal dosyalarÄ±nÄ±n** **hash** deÄŸerini hesaplayabilir ve bunlarÄ± **mevcut** olanlarla **karÅŸÄ±laÅŸtÄ±rabilirsiniz**. DeÄŸiÅŸtirilen her ÅŸey **ÅŸÃ¼pheli** olacaktÄ±r.

### Statistical Analysis

Bilgiler loglarda saklandÄ±ÄŸÄ±nda, her bir web sunucusu dosyasÄ±nÄ±n ne kadar sÄ±klÄ±kla eriÅŸildiÄŸini **kontrol edebilirsiniz**; Ã§Ã¼nkÃ¼ bir web shell en Ã§ok eriÅŸilenlerden biri olabilir.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
