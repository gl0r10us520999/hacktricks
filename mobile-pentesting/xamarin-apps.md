# Applications Xamarin

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## **Informations de base**

Xamarin est une **plateforme open-source** con√ßue pour que les d√©veloppeurs **cr√©ent des applications pour iOS, Android et Windows** en utilisant les frameworks .NET et C#. Cette plateforme offre un acc√®s √† de nombreux outils et extensions pour cr√©er des applications modernes de mani√®re efficace.

### Architecture de Xamarin

* Pour **Android**, Xamarin s'int√®gre avec les espaces de noms Android et Java via des liaisons .NET, fonctionnant dans l'environnement d'ex√©cution Mono aux c√¥t√©s de l'Android Runtime (ART). Les Managed Callable Wrappers (MCW) et les Android Callable Wrappers (ACW) facilitent la communication entre Mono et ART, tous deux bas√©s sur le noyau Linux.
* Pour **iOS**, les applications s'ex√©cutent sous l'environnement d'ex√©cution Mono, utilisant une compilation compl√®te Ahead of Time (AOT) pour convertir le code C# .NET en langage d'assemblage ARM. Ce processus fonctionne aux c√¥t√©s de l'Objective-C Runtime sur un noyau de type UNIX.

### Environnement d'ex√©cution .NET et Framework Mono

Le **framework .NET** comprend des assemblies, des classes et des espaces de noms pour le d√©veloppement d'applications, avec l'environnement d'ex√©cution .NET g√©rant l'ex√©cution du code. Il offre une ind√©pendance de la plateforme et une compatibilit√© descendante. Le **Framework Mono** est une version open-source du framework .NET, initi√©e en 2005 pour √©tendre .NET √† Linux, maintenant soutenue par Microsoft et dirig√©e par Xamarin.

### Ing√©nierie inverse des applications Xamarin

#### D√©compilation des assemblies Xamarin

La d√©compilation transforme le code compil√© en code source. Sous Windows, la fen√™tre Modules dans Visual Studio peut identifier les modules pour la d√©compilation, permettant un acc√®s direct au code tiers et l'extraction du code source pour analyse.

#### Compilation JIT vs AOT

* **Android** prend en charge la compilation Just-In-Time (JIT) et Ahead-Of-Time (AOT), avec un mode hybride AOT pour une vitesse d'ex√©cution optimale. La compilation compl√®te AOT est exclusive aux licences Enterprise.
* **iOS** utilise uniquement la compilation AOT en raison des restrictions d'Apple sur l'ex√©cution de code dynamique.

### Extraction des fichiers dll √† partir d'APK/IPA

Pour acc√©der aux assemblies dans un APK/IPA, d√©compressez le fichier et explorez le r√©pertoire des assemblies. Pour Android, des outils comme [XamAsmUnZ](https://github.com/cihansol/XamAsmUnZ) et [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress) peuvent d√©compresser les fichiers dll.
```bash
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
Dans les cas o√π, apr√®s avoir d√©compil√© l'APK, il est possible de voir le dossier unknown/assemblies/ avec les fichiers `.dll` √† l'int√©rieur, il est donc possible d'utiliser [**dnSpy**](https://github.com/dnSpy/dnSpy) directement sur les `.dll` pour les analyser.\
Cependant, parfois, on trouve les fichiers `assemblies.blob` et `assemblies.manifest` √† l'int√©rieur du dossier unknown/assemblies/. L'outil [pyxamstore](https://github.com/jakev/pyxamstore) peut √™tre utilis√© pour d√©compresser le fichier `assemblies.blob` dans les applications Xamarin, permettant l'acc√®s aux assemblies .NET pour une analyse plus approfondie :
```bash
pyxamstore unpack -d /path/to/decompressed/apk/assemblies/
```
Les fichiers .dll iOS sont facilement accessibles pour la d√©compilation, r√©v√©lant des portions significatives du code de l'application, qui partage souvent une base commune √† travers diff√©rentes plateformes.

### Analyse Statique

Une fois les `.dll` obtenues, il est possible d'analyser le code .Net statiquement en utilisant des outils tels que [**dnSpy**](https://github.com/dnSpy/dnSpy) **ou** [**ILSpy**](https://github.com/icsharpcode/ILSpy) **qui** permettront de modifier le code de l'application. Cela peut √™tre tr√®s utile pour alt√©rer l'application afin de contourner les protections par exemple.\
Notez qu'apr√®s avoir modifi√© l'application, vous devrez la reconditionner et la signer √† nouveau.

### Analyse Dynamique

L'analyse dynamique implique de v√©rifier le SSL pinning et d'utiliser des outils comme [Fridax](https://github.com/NorthwaveSecurity/fridax) pour des modifications en temps r√©el du binaire .NET dans les applications Xamarin. Des scripts Frida sont disponibles pour contourner la d√©tection de root ou le SSL pinning, am√©liorant ainsi les capacit√©s d'analyse.

D'autres scripts Frida int√©ressants :

* [**xamarin-antiroot**](https://codeshare.frida.re/@Gand3lf/xamarin-antiroot/)
* [**xamarin-root-detect-bypass**](https://codeshare.frida.re/@nuschpl/xamarin-root-detect-bypass/)
* [**Frida-xamarin-unpin**](https://github.com/GoSecure/frida-xamarin-unpin)

### Resignature

L'outil [Uber APK Signer](https://github.com/patrickfav/uber-apk-signer) simplifie la signature de plusieurs APK avec la m√™me cl√© et peut √™tre utilis√© pour resignature une application apr√®s y avoir apport√© des modifications.

## Informations Compl√©mentaires

* [https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers](https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers)
* [https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/](https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/)
* [https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf](https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
