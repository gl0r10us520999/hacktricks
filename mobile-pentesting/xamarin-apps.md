# Xamarin Apps

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## **Informa√ß√µes B√°sicas**

Xamarin √© uma **plataforma de c√≥digo aberto** projetada para desenvolvedores **constru√≠rem aplicativos para iOS, Android e Windows** usando os frameworks .NET e C#. Esta plataforma oferece acesso a in√∫meras ferramentas e extens√µes para criar aplica√ß√µes modernas de forma eficiente.

### Arquitetura do Xamarin

* Para **Android**, o Xamarin se integra com namespaces Android e Java atrav√©s de bindings .NET, operando dentro do ambiente de execu√ß√£o Mono ao lado do Android Runtime (ART). Managed Callable Wrappers (MCW) e Android Callable Wrappers (ACW) facilitam a comunica√ß√£o entre Mono e ART, ambos constru√≠dos sobre o kernel Linux.
* Para **iOS**, as aplica√ß√µes rodam sob o runtime Mono, utilizando compila√ß√£o completa Ahead of Time (AOT) para converter c√≥digo C# .NET em linguagem de montagem ARM. Este processo ocorre ao lado do Runtime Objective-C em um kernel semelhante ao UNIX.

### Runtime .NET e Framework Mono

O **framework .NET** inclui assemblies, classes e namespaces para desenvolvimento de aplica√ß√µes, com o Runtime .NET gerenciando a execu√ß√£o do c√≥digo. Ele oferece independ√™ncia de plataforma e compatibilidade retroativa. O **Framework Mono** √© uma vers√£o de c√≥digo aberto do framework .NET, iniciado em 2005 para estender o .NET ao Linux, agora suportado pela Microsoft e liderado pelo Xamarin.

### Engenharia Reversa de Aplicativos Xamarin

#### Decompila√ß√£o de Assemblies Xamarin

A decompila√ß√£o transforma c√≥digo compilado de volta em c√≥digo-fonte. No Windows, a janela de M√≥dulos no Visual Studio pode identificar m√≥dulos para decompila√ß√£o, permitindo acesso direto ao c√≥digo de terceiros e extra√ß√£o de c√≥digo-fonte para an√°lise.

#### Compila√ß√£o JIT vs AOT

* **Android** suporta compila√ß√£o Just-In-Time (JIT) e Ahead-Of-Time (AOT), com um modo h√≠brido AOT para velocidade de execu√ß√£o ideal. A compila√ß√£o completa AOT √© exclusiva para licen√ßas Enterprise.
* **iOS** utiliza exclusivamente a compila√ß√£o AOT devido √†s restri√ß√µes da Apple sobre a execu√ß√£o de c√≥digo din√¢mico.

### Extraindo arquivos dll de APK/IPA

Para acessar os assemblies em um APK/IPA, descompacte o arquivo e explore o diret√≥rio de assemblies. Para Android, ferramentas como [XamAsmUnZ](https://github.com/cihansol/XamAsmUnZ) e [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress) podem descomprimir arquivos dll.
```bash
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
Nos casos em que, ap√≥s descompilar o APK, √© poss√≠vel ver a pasta unknown/assemblies/ com os arquivos `.dll` dentro dela, √© poss√≠vel usar [**dnSpy**](https://github.com/dnSpy/dnSpy) diretamente sobre os `.dlls` para analis√°-los.\
No entanto, √†s vezes, s√£o encontrados os arquivos `assemblies.blob` e `assemblies.manifest` dentro da pasta unknown/assemblies/. A ferramenta [pyxamstore](https://github.com/jakev/pyxamstore) pode ser usada para descompactar o arquivo `assemblies.blob` em aplicativos Xamarin, permitindo o acesso aos assemblies .NET para an√°lise adicional:
```bash
pyxamstore unpack -d /path/to/decompressed/apk/assemblies/
```
Arquivos .dll do iOS s√£o facilmente acess√≠veis para descompila√ß√£o, revelando por√ß√µes significativas do c√≥digo do aplicativo, que muitas vezes compartilha uma base comum entre diferentes plataformas.

### An√°lise Est√°tica

Uma vez que os `.dll`s s√£o obtidos, √© poss√≠vel analisar o c√≥digo .Net estaticamente usando ferramentas como [**dnSpy**](https://github.com/dnSpy/dnSpy) **ou** [**ILSpy**](https://github.com/icsharpcode/ILSpy) **que** permitir√£o modificar o c√≥digo do aplicativo. Isso pode ser super √∫til para adulterar o aplicativo e contornar prote√ß√µes, por exemplo.\
Note que, ap√≥s modificar o aplicativo, voc√™ precisar√° empacot√°-lo novamente e assin√°-lo novamente.

### An√°lise Din√¢mica

A an√°lise din√¢mica envolve verificar o SSL pinning e usar ferramentas como [Fridax](https://github.com/NorthwaveSecurity/fridax) para modifica√ß√µes em tempo de execu√ß√£o do bin√°rio .NET em aplicativos Xamarin. Scripts Frida est√£o dispon√≠veis para contornar a detec√ß√£o de root ou SSL pinning, aprimorando as capacidades de an√°lise.

Outros scripts Frida interessantes:

* [**xamarin-antiroot**](https://codeshare.frida.re/@Gand3lf/xamarin-antiroot/)
* [**xamarin-root-detect-bypass**](https://codeshare.frida.re/@nuschpl/xamarin-root-detect-bypass/)
* [**Frida-xamarin-unpin**](https://github.com/GoSecure/frida-xamarin-unpin)

### Reassinar

A ferramenta [Uber APK Signer](https://github.com/patrickfav/uber-apk-signer) simplifica a assinatura de m√∫ltiplos APKs com a mesma chave e pode ser usada para reassinar um aplicativo ap√≥s altera√ß√µes terem sido realizadas nele.

## Mais informa√ß√µes

* [https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers](https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers)
* [https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/](https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/)
* [https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf](https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
