# Xamarin Apps

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Podstawowe informacje**

Xamarin to **platforma open-source** zaprojektowana dla programist贸w do **tworzenia aplikacji na iOS, Android i Windows** przy u偶yciu framework贸w .NET i C#. Ta platforma oferuje dostp do licznych narzdzi i rozszerze, aby efektywnie tworzy nowoczesne aplikacje.

### Architektura Xamarin

* Dla **Androida**, Xamarin integruje si z przestrzeniami nazw Android i Java poprzez powizania .NET, dziaajc w rodowisku wykonawczym Mono obok Android Runtime (ART). Managed Callable Wrappers (MCW) i Android Callable Wrappers (ACW) uatwiaj komunikacj midzy Mono a ART, kt贸re s zbudowane na jdrze Linux.
* Dla **iOS**, aplikacje dziaaj pod runtime Mono, wykorzystujc pen kompilacj Ahead of Time (AOT) do konwersji kodu C# .NET na jzyk asemblera ARM. Proces ten dziaa obok Objective-C Runtime na jdrze podobnym do UNIX.

### Runtime .NET i framework Mono

**Framework .NET** obejmuje zestawy, klasy i przestrzenie nazw do rozwoju aplikacji, a Runtime .NET zarzdza wykonaniem kodu. Oferuje niezale偶no platformy i zgodno wsteczn. **Framework Mono** to wersja open-source frameworka .NET, rozpoczta w 2005 roku, aby rozszerzy .NET na Linux, obecnie wspierana przez Microsoft i kierowana przez Xamarin.

### In偶ynieria odwrotna aplikacji Xamarin

#### Dekompilacja zestaw贸w Xamarin

Dekompilacja przeksztaca skompilowany kod z powrotem w kod 藕r贸dowy. W systemie Windows okno Moduy w Visual Studio mo偶e identyfikowa moduy do dekompilacji, umo偶liwiajc bezporedni dostp do kodu stron trzecich i ekstrakcj kodu 藕r贸dowego do analizy.

#### Kompilacja JIT vs AOT

* **Android** wspiera kompilacj Just-In-Time (JIT) i Ahead-Of-Time (AOT), z hybrydowym trybem AOT dla optymalnej prdkoci wykonania. Pena AOT jest zarezerwowana dla licencji Enterprise.
* **iOS** stosuje wycznie kompilacj AOT z powodu ogranicze Apple dotyczcych dynamicznego wykonywania kodu.

### Ekstrakcja plik贸w dll z APK/IPA

Aby uzyska dostp do zestaw贸w w pliku APK/IPA, rozpakuj plik i przeszukaj katalog zestaw贸w. Dla Androida narzdzia takie jak [XamAsmUnZ](https://github.com/cihansol/XamAsmUnZ) i [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress) mog dekompresowa pliki dll.
```bash
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
W przypadkach, gdy po dekompilacji APK mo偶liwe jest zobaczenie folderu unknown/assemblies/ z plikami `.dll` w rodku, mo偶na bezporednio u偶y [**dnSpy**](https://github.com/dnSpy/dnSpy) do ich analizy.\
Jednak czasami w folderze unknown/assemblies/ znajduj si pliki `assemblies.blob` i `assemblies.manifest`. Narzdzie [pyxamstore](https://github.com/jakev/pyxamstore) mo偶e by u偶yte do rozpakowania pliku `assemblies.blob` w aplikacjach Xamarin, co umo偶liwia dostp do zestaw贸w .NET w celu dalszej analizy:
```bash
pyxamstore unpack -d /path/to/decompressed/apk/assemblies/
```
Pliki .dll w systemie iOS s atwo dostpne do dekompilacji, ujawniajc znaczn cz kodu aplikacji, kt贸ry czsto dzieli wsp贸ln baz na r贸偶nych platformach.

### Analiza statyczna

Po uzyskaniu plik贸w `.dll` mo偶liwe jest statyczne analizowanie kodu .Net za pomoc narzdzi takich jak [**dnSpy**](https://github.com/dnSpy/dnSpy) **lub** [**ILSpy**](https://github.com/icsharpcode/ILSpy), **kt贸re** pozwol na modyfikacj kodu aplikacji. Mo偶e to by bardzo przydatne do manipulacji aplikacj w celu ominicia zabezpiecze, na przykad.\
Nale偶y pamita, 偶e po modyfikacji aplikacji bdziesz musia ponownie j spakowa i podpisa.

### Analiza dynamiczna

Analiza dynamiczna polega na sprawdzaniu SSL pinning i u偶ywaniu narzdzi takich jak [Fridax](https://github.com/NorthwaveSecurity/fridax) do modyfikacji binarnej .NET w aplikacjach Xamarin w czasie rzeczywistym. Skrypty Frida s dostpne do omijania wykrywania roota lub SSL pinning, co zwiksza mo偶liwoci analizy.

Inne interesujce skrypty Frida:

* [**xamarin-antiroot**](https://codeshare.frida.re/@Gand3lf/xamarin-antiroot/)
* [**xamarin-root-detect-bypass**](https://codeshare.frida.re/@nuschpl/xamarin-root-detect-bypass/)
* [**Frida-xamarin-unpin**](https://github.com/GoSecure/frida-xamarin-unpin)

### Ponowne podpisywanie

Narzdzie [Uber APK Signer](https://github.com/patrickfav/uber-apk-signer) upraszcza podpisywanie wielu APK z tym samym kluczem i mo偶e by u偶ywane do ponownego podpisywania aplikacji po wprowadzeniu w niej zmian.

## Dalsze informacje

* [https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers](https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers)
* [https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/](https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/)
* [https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf](https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
