# Xamarin Apps

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## **Grundinformationen**

Xamarin ist eine **Open-Source-Plattform**, die Entwicklern erm√∂glicht, **Apps f√ºr iOS, Android und Windows** mit den .NET- und C#-Frameworks zu erstellen. Diese Plattform bietet Zugang zu zahlreichen Tools und Erweiterungen, um moderne Anwendungen effizient zu erstellen.

### Xamarin-Architektur

* F√ºr **Android** integriert sich Xamarin √ºber .NET-Bindungen mit Android- und Java-Namensr√§umen und arbeitet innerhalb der Mono-Ausf√ºhrungsumgebung zusammen mit der Android Runtime (ART). Managed Callable Wrappers (MCW) und Android Callable Wrappers (ACW) erleichtern die Kommunikation zwischen Mono und ART, die beide auf dem Linux-Kernel basieren.
* F√ºr **iOS** laufen Anwendungen unter der Mono-Laufzeit und nutzen die vollst√§ndige Ahead of Time (AOT)-Kompilierung, um C# .NET-Code in ARM-Assemblersprache zu konvertieren. Dieser Prozess l√§uft parallel zur Objective-C-Laufzeit auf einem UNIX-√§hnlichen Kernel.

### .NET-Laufzeit und Mono-Framework

Das **.NET-Framework** umfasst Assemblies, Klassen und Namensr√§ume f√ºr die Anwendungsentwicklung, wobei die .NET-Laufzeit die Codeausf√ºhrung verwaltet. Es bietet Plattformunabh√§ngigkeit und Abw√§rtskompatibilit√§t. Das **Mono-Framework** ist eine Open-Source-Version des .NET-Frameworks, das 2005 initiiert wurde, um .NET auf Linux zu erweitern, jetzt von Microsoft unterst√ºtzt und von Xamarin geleitet.

### Reverse Engineering von Xamarin-Apps

#### Dekompilierung von Xamarin-Assemblies

Die Dekompilierung verwandelt kompilierten Code zur√ºck in Quellcode. In Windows kann das Module-Fenster in Visual Studio Module zur Dekompilierung identifizieren, was direkten Zugriff auf Drittanbieter-Code und die Extraktion von Quellcode zur Analyse erm√∂glicht.

#### JIT vs AOT-Kompilierung

* **Android** unterst√ºtzt Just-In-Time (JIT) und Ahead-Of-Time (AOT)-Kompilierung, mit einem Hybrid-AOT-Modus f√ºr optimale Ausf√ºhrungsgeschwindigkeit. Vollst√§ndige AOT ist ausschlie√ülich f√ºr Enterprise-Lizenzen verf√ºgbar.
* **iOS** verwendet ausschlie√ülich AOT-Kompilierung aufgrund von Apples Einschr√§nkungen bei der dynamischen Codeausf√ºhrung.

### Extrahieren von dll-Dateien aus APK/IPA

Um auf die Assemblies in einer APK/IPA zuzugreifen, entpacken Sie die Datei und erkunden Sie das Assemblies-Verzeichnis. F√ºr Android k√∂nnen Tools wie [XamAsmUnZ](https://github.com/cihansol/XamAsmUnZ) und [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress) dll-Dateien dekomprimieren.
```bash
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
In F√§llen, in denen nach dem Decompilieren der APK der unbekannte/assemblies/-Ordner mit den `.dll`-Dateien darin sichtbar ist, ist es m√∂glich, [**dnSpy**](https://github.com/dnSpy/dnSpy) direkt √ºber die `.dlls` zu verwenden, um sie zu analysieren.\
Manchmal findet man jedoch die `assemblies.blob`- und `assemblies.manifest`-Dateien im unbekannten/assemblies/-Ordner. Das Tool [pyxamstore](https://github.com/jakev/pyxamstore) kann verwendet werden, um die `assemblies.blob`-Datei in Xamarin-Apps zu entpacken, was den Zugriff auf die .NET-Assemblies f√ºr eine weitere Analyse erm√∂glicht:
```bash
pyxamstore unpack -d /path/to/decompressed/apk/assemblies/
```
iOS-DLL-Dateien sind leicht zug√§nglich f√ºr die Dekompilierung, was erhebliche Teile des Anwendungscodes offenbart, der oft eine gemeinsame Basis √ºber verschiedene Plattformen hinweg teilt.

### Statische Analyse

Sobald die `.dll`s erhalten sind, ist es m√∂glich, den .Net-Code statisch mit Tools wie [**dnSpy**](https://github.com/dnSpy/dnSpy) **oder** [**ILSpy**](https://github.com/icsharpcode/ILSpy) **zu analysieren**, die es erm√∂glichen, den Code der App zu modifizieren. Dies kann sehr n√ºtzlich sein, um die Anwendung zu manipulieren, um beispielsweise Schutzma√ünahmen zu umgehen.\
Beachten Sie, dass Sie die App nach der Modifikation erneut packen und erneut signieren m√ºssen.

### Dynamische Analyse

Die dynamische Analyse umfasst die √úberpr√ºfung auf SSL-Pinning und die Verwendung von Tools wie [Fridax](https://github.com/NorthwaveSecurity/fridax) f√ºr Laufzeitmodifikationen der .NET-Bin√§rdatei in Xamarin-Apps. Frida-Skripte sind verf√ºgbar, um die Root-Erkennung oder das SSL-Pinning zu umgehen und die Analysef√§higkeiten zu verbessern.

Weitere interessante Frida-Skripte:

* [**xamarin-antiroot**](https://codeshare.frida.re/@Gand3lf/xamarin-antiroot/)
* [**xamarin-root-detect-bypass**](https://codeshare.frida.re/@nuschpl/xamarin-root-detect-bypass/)
* [**Frida-xamarin-unpin**](https://github.com/GoSecure/frida-xamarin-unpin)

### Neu-Signierung

Das Tool [Uber APK Signer](https://github.com/patrickfav/uber-apk-signer) vereinfacht das Signieren mehrerer APKs mit demselben Schl√ºssel und kann verwendet werden, um eine App nach √Ñnderungen erneut zu signieren.

## Weitere Informationen

* [https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers](https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers)
* [https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/](https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/)
* [https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf](https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
