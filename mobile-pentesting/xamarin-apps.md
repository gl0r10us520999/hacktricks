# Xamarin Apps

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## **åŸºæœ¬ä¿¡æ¯**

Xamarin æ˜¯ä¸€ä¸ª **å¼€æºå¹³å°**ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ä½¿ç”¨ .NET å’Œ C# æ¡†æ¶ **æ„å»º iOSã€Android å’Œ Windows åº”ç”¨**ã€‚è¯¥å¹³å°æä¾›äº†ä¼—å¤šå·¥å…·å’Œæ‰©å±•ï¼Œä»¥é«˜æ•ˆåˆ›å»ºç°ä»£åº”ç”¨ã€‚

### Xamarin çš„æ¶æ„

* å¯¹äº **Android**ï¼ŒXamarin é€šè¿‡ .NET ç»‘å®šä¸ Android å’Œ Java å‘½åç©ºé—´é›†æˆï¼Œåœ¨ Mono æ‰§è¡Œç¯å¢ƒä¸­ä¸ Android Runtime (ART) ä¸€èµ·è¿è¡Œã€‚æ‰˜ç®¡å¯è°ƒç”¨åŒ…è£…å™¨ (MCW) å’Œ Android å¯è°ƒç”¨åŒ…è£…å™¨ (ACW) ä¿ƒè¿› Mono å’Œ ART ä¹‹é—´çš„é€šä¿¡ï¼ŒäºŒè€…å‡åŸºäº Linux å†…æ ¸æ„å»ºã€‚
* å¯¹äº **iOS**ï¼Œåº”ç”¨åœ¨ Mono è¿è¡Œæ—¶ä¸‹è¿è¡Œï¼Œåˆ©ç”¨å®Œæ•´çš„æå‰ç¼–è¯‘ (AOT) å°† C# .NET ä»£ç è½¬æ¢ä¸º ARM æ±‡ç¼–è¯­è¨€ã€‚æ­¤è¿‡ç¨‹ä¸ UNIX ç±»å†…æ ¸ä¸Šçš„ Objective-C è¿è¡Œæ—¶ä¸€èµ·è¿è¡Œã€‚

### .NET è¿è¡Œæ—¶å’Œ Mono æ¡†æ¶

**.NET æ¡†æ¶** åŒ…å«ç”¨äºåº”ç”¨å¼€å‘çš„ç¨‹åºé›†ã€ç±»å’Œå‘½åç©ºé—´ï¼Œ.NET è¿è¡Œæ—¶ç®¡ç†ä»£ç æ‰§è¡Œã€‚å®ƒæä¾›å¹³å°ç‹¬ç«‹æ€§å’Œå‘åå…¼å®¹æ€§ã€‚**Mono æ¡†æ¶** æ˜¯ .NET æ¡†æ¶çš„å¼€æºç‰ˆæœ¬ï¼Œå§‹äº 2005 å¹´ï¼Œæ—¨åœ¨å°† .NET æ‰©å±•åˆ° Linuxï¼Œç°åœ¨ç”± Microsoft æ”¯æŒå¹¶ç”± Xamarin ä¸»å¯¼ã€‚

### åå‘å·¥ç¨‹ Xamarin åº”ç”¨

#### Xamarin ç¨‹åºé›†çš„åç¼–è¯‘

åç¼–è¯‘å°†ç¼–è¯‘çš„ä»£ç è½¬æ¢å›æºä»£ç ã€‚åœ¨ Windows ä¸­ï¼ŒVisual Studio çš„æ¨¡å—çª—å£å¯ä»¥è¯†åˆ«å¯åç¼–è¯‘çš„æ¨¡å—ï¼Œå…è®¸ç›´æ¥è®¿é—®ç¬¬ä¸‰æ–¹ä»£ç å¹¶æå–æºä»£ç è¿›è¡Œåˆ†æã€‚

#### JIT ä¸ AOT ç¼–è¯‘

* **Android** æ”¯æŒå³æ—¶ç¼–è¯‘ (JIT) å’Œæå‰ç¼–è¯‘ (AOT)ï¼Œå¹¶å…·æœ‰æ··åˆ AOT æ¨¡å¼ä»¥å®ç°æœ€ä½³æ‰§è¡Œé€Ÿåº¦ã€‚å®Œæ•´ AOT ä»…é™äºä¼ä¸šè®¸å¯è¯ã€‚
* **iOS** ä»…é‡‡ç”¨ AOT ç¼–è¯‘ï¼Œå› ä¸º Apple å¯¹åŠ¨æ€ä»£ç æ‰§è¡Œæœ‰ä¸¥æ ¼é™åˆ¶ã€‚

### ä» APK/IPA ä¸­æå– dll æ–‡ä»¶

è¦è®¿é—® APK/IPA ä¸­çš„ç¨‹åºé›†ï¼Œè¯·è§£å‹æ–‡ä»¶å¹¶æµè§ˆç¨‹åºé›†ç›®å½•ã€‚å¯¹äº Androidï¼Œå¯ä»¥ä½¿ç”¨ [XamAsmUnZ](https://github.com/cihansol/XamAsmUnZ) å’Œ [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress) ç­‰å·¥å…·è§£å‹ dll æ–‡ä»¶ã€‚
```bash
python3 xamarin-decompress.py -o /path/to/decompressed/apk
```
åœ¨åç¼–è¯‘APKåï¼Œå¦‚æœå¯ä»¥çœ‹åˆ°unknown/assemblies/æ–‡ä»¶å¤¹åŠå…¶ä¸­çš„`.dll`æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨[**dnSpy**](https://github.com/dnSpy/dnSpy)å¯¹`.dll`è¿›è¡Œåˆ†æã€‚\
ç„¶è€Œï¼Œæœ‰æ—¶ä¼šåœ¨unknown/assemblies/æ–‡ä»¶å¤¹ä¸­å‘ç°`assemblies.blob`å’Œ`assemblies.manifest`æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨å·¥å…·[pyxamstore](https://github.com/jakev/pyxamstore)æ¥è§£åŒ…Xamarinåº”ç”¨ä¸­çš„`assemblies.blob`æ–‡ä»¶ï¼Œä»è€Œè®¿é—®.NETç¨‹åºé›†ä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æï¼š
```bash
pyxamstore unpack -d /path/to/decompressed/apk/assemblies/
```
iOS dll æ–‡ä»¶å¯ä»¥è½»æ¾è·å–ä»¥è¿›è¡Œåç¼–è¯‘ï¼Œæ­ç¤ºåº”ç”¨ç¨‹åºä»£ç çš„æ˜¾è‘—éƒ¨åˆ†ï¼Œè¿™äº›ä»£ç é€šå¸¸åœ¨ä¸åŒå¹³å°ä¹‹é—´å…±äº«ä¸€ä¸ªå…±åŒçš„åŸºç¡€ã€‚

### é™æ€åˆ†æ

ä¸€æ—¦è·å¾— `.dll` æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ [**dnSpy**](https://github.com/dnSpy/dnSpy) **æˆ–** [**ILSpy**](https://github.com/icsharpcode/ILSpy) å·¥å…·å¯¹ .Net ä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œè¿™å°†å…è®¸ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™å¯¹äºç¯¡æ”¹åº”ç”¨ç¨‹åºä»¥ç»•è¿‡ä¿æŠ¤æªæ–½éå¸¸æœ‰ç”¨ã€‚\
è¯·æ³¨æ„ï¼Œåœ¨ä¿®æ”¹åº”ç”¨ç¨‹åºåï¼Œæ‚¨éœ€è¦é‡æ–°æ‰“åŒ…å¹¶é‡æ–°ç­¾åã€‚

### åŠ¨æ€åˆ†æ

åŠ¨æ€åˆ†ææ¶‰åŠæ£€æŸ¥ SSL é’‰æ‰ï¼Œå¹¶ä½¿ç”¨ [Fridax](https://github.com/NorthwaveSecurity/fridax) ç­‰å·¥å…·å¯¹ Xamarin åº”ç”¨ä¸­çš„ .NET äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œè¿è¡Œæ—¶ä¿®æ”¹ã€‚Frida è„šæœ¬å¯ç”¨äºç»•è¿‡æ ¹æ£€æµ‹æˆ– SSL é’‰æ‰ï¼Œå¢å¼ºåˆ†æèƒ½åŠ›ã€‚

å…¶ä»–æœ‰è¶£çš„ Frida è„šæœ¬ï¼š

* [**xamarin-antiroot**](https://codeshare.frida.re/@Gand3lf/xamarin-antiroot/)
* [**xamarin-root-detect-bypass**](https://codeshare.frida.re/@nuschpl/xamarin-root-detect-bypass/)
* [**Frida-xamarin-unpin**](https://github.com/GoSecure/frida-xamarin-unpin)

### é‡æ–°ç­¾å

å·¥å…· [Uber APK Signer](https://github.com/patrickfav/uber-apk-signer) ç®€åŒ–äº†ä½¿ç”¨ç›¸åŒå¯†é’¥ç­¾åå¤šä¸ª APK çš„è¿‡ç¨‹ï¼Œå¹¶å¯ç”¨äºåœ¨å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ›´æ”¹åé‡æ–°ç­¾åã€‚

## è¿›ä¸€æ­¥ä¿¡æ¯

* [https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers](https://www.appknox.com/security/xamarin-reverse-engineering-a-guide-for-penetration-testers)
* [https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/](https://thecobraden.com/posts/unpacking\_xamarin\_assembly\_stores/)
* [https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf](https://medium.com/@justmobilesec/introduction-to-the-exploitation-of-xamarin-apps-fde4619a51bf)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
