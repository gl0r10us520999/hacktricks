# iOS UIActivity Sharing

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

# UIActivity Sharing Simplified

iOS 6以降、サードパーティアプリケーションは、Appleの[アプリ間通信ガイド](https://developer.apple.com/library/archive/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW3)に記載されているように、AirDropなどのメカニズムを使用して、テキスト、URL、画像などの**データを共有**できるようになりました。この機能は、「共有」ボタンと対話することで表示されるシステム全体の_共有アクティビティシート_を通じて現れます。

すべての組み込み共有オプションの包括的な列挙は、[UIActivity.ActivityType](https://developer.apple.com/documentation/uikit/uiactivity/activitytype)で利用可能です。開発者は、アプリケーションに不適切と判断した場合、特定の共有オプションを除外することができます。

## **データを共有する方法**

注意すべき点は以下の通りです：

- 共有されるデータの性質。
- カスタムアクティビティの含有。
- 特定のアクティビティタイプの除外。

共有は、共有するアイテムを渡す`UIActivityViewController`のインスタンス化を通じて促進されます。これは、次のように呼び出すことで実現されます：
```bash
$ rabin2 -zq Telegram\ X.app/Telegram\ X | grep -i activityItems
0x1000df034 45 44 initWithActivityItems:applicationActivities:
```
Developers should scrutinize the `UIActivityViewController` for the activities and custom activities it's initialized with, as well as any specified `excludedActivityTypes`.

## **データの受信方法**

データを受信する際に重要な側面は以下の通りです：

- **カスタムドキュメントタイプ**の宣言。
- **アプリが開けるドキュメントタイプ**の指定。
- **受信データの整合性の確認**。

ソースコードにアクセスできなくても、`Info.plist`を調査して`UTExportedTypeDeclarations`、`UTImportedTypeDeclarations`、`CFBundleDocumentTypes`のようなキーを確認することで、アプリが扱えるドキュメントタイプを理解できます。

これらのキーに関する簡潔なガイドは[Stackoverflow](https://stackoverflow.com/questions/21937978/what-are-utimportedtypedeclarations-and-utexportedtypedeclarations-used-for-on-i)で入手可能で、システム全体での認識のためにUTIを定義およびインポートし、アプリとの統合のためにドキュメントタイプを関連付ける重要性を強調しています。

## 動的テストアプローチ

**アクティビティの送信**をテストするには、次のことができます：

- `init(activityItems:applicationActivities:)`メソッドにフックして、共有されるアイテムとアクティビティをキャプチャします。
- `excludedActivityTypes`プロパティをインターセプトして除外されたアクティビティを特定します。

**アイテムの受信**には、次のことが含まれます：

- 他のソース（例：AirDrop、メール）からアプリにファイルを共有し、「Open with...」ダイアログを表示させます。
- 静的分析中に特定された他のメソッドの中で`application:openURL:options:`にフックして、アプリの応答を観察します。
- 不正なファイルやファジング技術を使用してアプリの堅牢性を評価します。

## 参考文献
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
