# iOS Universal Links


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Introdu√ß√£o

Os links universais oferecem uma **experi√™ncia de redirecionamento** sem interrup√ß√µes para os usu√°rios, abrindo diretamente o conte√∫do no aplicativo, evitando a necessidade de redirecionamento pelo Safari. Esses links s√£o **√∫nicos** e seguros, pois n√£o podem ser reivindicados por outros aplicativos. Isso √© garantido ao hospedar um arquivo JSON `apple-app-site-association` no diret√≥rio raiz do site, estabelecendo um link verific√°vel entre o site e o aplicativo. Nos casos em que o aplicativo n√£o est√° instalado, o Safari assume e direciona o usu√°rio para a p√°gina da web, mantendo a presen√ßa do aplicativo.

Para testadores de penetra√ß√£o, o arquivo `apple-app-site-association` √© de particular interesse, pois pode revelar **caminhos sens√≠veis**, potencialmente incluindo aqueles relacionados a recursos n√£o lan√ßados.

### **Analisando a Concess√£o de Dom√≠nios Associados**

Os desenvolvedores ativam os Links Universais configurando os **Dom√≠nios Associados** na aba Capacidades do Xcode ou inspecionando o arquivo `.entitlements`. Cada dom√≠nio √© prefixado com `applinks:`. Por exemplo, a configura√ß√£o do Telegram pode aparecer da seguinte forma:
```xml
<key>com.apple.developer.associated-domains</key>
<array>
<string>applinks:telegram.me</string>
<string>applinks:t.me</string>
</array>
```
Para obter informa√ß√µes mais abrangentes, consulte a [Documenta√ß√£o do Desenvolvedor Apple arquivada](https://developer.apple.com/library/archive/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12-SW2).

Se estiver trabalhando com um aplicativo compilado, as permiss√µes podem ser extra√≠das conforme descrito [neste guia](extracting-entitlements-from-compiled-application.md).

### **Recuperando o Arquivo de Associa√ß√£o do Site do Aplicativo Apple**

O arquivo `apple-app-site-association` deve ser recuperado do servidor usando os dom√≠nios especificados nas permiss√µes. Certifique-se de que o arquivo esteja acess√≠vel via HTTPS diretamente em `https://<domain>/apple-app-site-association`. Ferramentas como o [Validador de Associa√ß√£o de Site de Aplicativo Apple (AASA)](https://branch.io/resources/aasa-validator/) podem ajudar nesse processo.

### **Manipulando Links Universais no Aplicativo**

O aplicativo deve implementar m√©todos espec√≠ficos para manipular links universais corretamente. O m√©todo principal a ser procurado √© [`application:continueUserActivity:restorationHandler:`](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application). √â crucial que o esquema das URLs manipuladas seja HTTP ou HTTPS, pois outros n√£o ser√£o suportados.

#### **Validando o M√©todo de Manipula√ß√£o de Dados**

Quando um link universal abre um aplicativo, um objeto `NSUserActivity` √© passado para o aplicativo com a URL. Antes de processar essa URL, √© essencial valid√°-la e sanitiz√°-la para evitar riscos de seguran√ßa. Aqui est√° um exemplo em Swift que demonstra o processo:
```swift
func application(_ application: UIApplication, continue userActivity: NSUserActivity,
restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
// Check for web browsing activity and valid URL
if userActivity.activityType == NSUserActivityTypeBrowsingWeb, let url = userActivity.webpageURL {
application.open(url, options: [:], completionHandler: nil)
}

return true
}
```
URLs devem ser cuidadosamente analisados e validados, especialmente se inclu√≠rem par√¢metros, para se proteger contra poss√≠veis falsifica√ß√µes ou dados malformados. A API `NSURLComponents` √© √∫til para esse prop√≥sito, como demonstrado abaixo:
```swift
func application(_ application: UIApplication,
continue userActivity: NSUserActivity,
restorationHandler: @escaping ([Any]?) -> Void) -> Bool {
guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
let incomingURL = userActivity.webpageURL,
let components = NSURLComponents(url: incomingURL, resolvingAgainstBaseURL: true),
let path = components.path,
let params = components.queryItems else {
return false
}

if let albumName = params.first(where: { $0.name == "albumname" })?.value,
let photoIndex = params.first(where: { $0.name == "index" })?.value {
// Process the URL with album name and photo index

return true

} else {
// Handle invalid or missing parameters

return false
}
}
```
Atrav√©s de **configura√ß√£o e valida√ß√£o diligentes**, os desenvolvedores podem garantir que os links universais melhorem a experi√™ncia do usu√°rio enquanto mant√™m padr√µes de seguran√ßa e privacidade.

## Ferramentas
* [GetUniversal.link](https://getuniversal.link/): Ajuda a simplificar o teste e a gest√£o dos Links Universais do seu aplicativo e do arquivo AASA. Basta inserir seu dom√≠nio para verificar a integridade do arquivo AASA ou usar o painel personalizado para testar facilmente o comportamento dos links. Esta ferramenta tamb√©m ajuda a determinar quando a Apple indexar√° seu arquivo AASA na pr√≥xima vez.

## Refer√™ncias
* [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0070/#static-analysis)
* [https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8](https://mobile-security.gitbook.io/mobile-security-testing-guide/ios-testing-guide/0x06h-testing-platform-interaction#testing-object-persistence-mstg-platform-8)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
