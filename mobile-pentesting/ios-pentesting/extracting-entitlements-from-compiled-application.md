# Extracting Entitlements from Compiled Application

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


ページの要約 [https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/#review-entitlements-embedded-in-the-compiled-app-binary](https://mas.owasp.org/MASTG/tests/ios/MASVS-PLATFORM/MASTG-TEST-0069/#review-entitlements-embedded-in-the-compiled-app-binary)

### **Extracting Entitlements and Mobile Provision Files**

アプリのIPAや脱獄デバイスにインストールされたアプリを扱う際、`.entitlements`ファイルや`embedded.mobileprovision`ファイルを直接見つけることはできない場合があります。しかし、アプリバイナリから権限プロパティリストを抽出することは可能であり、「iOS Basic Security Testing」章、特に「Acquiring the App Binary」セクションに記載された手順に従うことができます。

暗号化されたバイナリでも、これらのファイルを抽出するために特定の手順を使用することができます。これらの手順が失敗した場合、Clutch（iOSバージョンと互換性がある場合）、frida-ios-dump、または同様のユーティリティを使用してアプリを復号化し、抽出する必要があるかもしれません。

#### **Extracting the Entitlements Plist from the App Binary**

コンピュータ上でアプリバイナリにアクセスできる場合、**binwalk**を使用してすべてのXMLファイルを抽出できます。以下のコマンドは、その方法を示しています:
```bash
$ binwalk -e -y=xml ./Telegram\ X

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
1430180       0x15D2A4        XML document, version: "1.0"
1458814       0x16427E        XML document, version: "1.0"
```
代わりに、**radare2**を使用してコマンドを静かに実行し、終了することができ、アプリバイナリ内の「PropertyList」を含むすべての文字列を検索します：
```bash
$ r2 -qc 'izz~PropertyList' ./Telegram\ X

0x0015d2a4 ascii <?xml version="1.0" encoding="UTF-8" standalone="yes"?>...
0x0016427d ascii H<?xml version="1.0" encoding="UTF-8"?>...
```
両方の方法、binwalkとradare2は、`plist`ファイルの抽出を可能にし、最初のもの（0x0015d2a4）の検査により、[Telegramからの元のentitlementsファイルの成功した回復](https://github.com/peter-iakovlev/Telegram-iOS/blob/77ee5c4dabdd6eb5f1e2ff76219edf7e18b45c00/Telegram-iOS/Telegram-iOS-AppStoreLLC.entitlements)が明らかになりました。

脱獄デバイス上でアクセスされたアプリバイナリ（例：SSH経由）に対して、**grep**コマンドの`-a, --text`フラグを使用して、すべてのファイルをASCIIテキストとして扱うことができます：
```bash
$ grep -a -A 5 'PropertyList' /var/containers/Bundle/Application/...
```
`-A num, --after-context=num` フラグを調整することで、表示する行数を増やしたり減らしたりできます。この方法は、暗号化されたアプリバイナリにも有効であり、複数のApp Storeアプリに対して検証されています。前述のツールは、同様の目的で脱獄したiOSデバイスでも使用できます。

**注意**: このタスクに対して `strings` コマンドの直接使用は推奨されません。関連情報を見つける際の制限があるためです。代わりに、バイナリに対して `-a` フラグを使用したgrepを使用するか、radare2（`izz`）/rabin2（`-zz`）を利用することが、より効果的な結果を得るために推奨されます。

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
