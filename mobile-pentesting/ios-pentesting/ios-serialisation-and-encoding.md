{% hint style="success" %}
Aprenda e pratique AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

C√≥digo e mais informa√ß√µes em [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence).

## Serializa√ß√£o de Objetos no Desenvolvimento iOS

Em iOS, **serializa√ß√£o de objetos** envolve converter objetos em um formato que pode ser facilmente armazenado ou transmitido, e ent√£o reconstru√≠-los a partir desse formato quando necess√°rio. Dois protocolos principais, **`NSCoding`** e **`NSSecureCoding`**, facilitam esse processo para subclasses de Objective-C ou `NSObject`, permitindo que objetos sejam serializados em **`NSData`**, um formato que envolve buffers de bytes.

### Implementa√ß√£o de **`NSCoding`**
Para implementar `NSCoding`, uma classe deve herdar de `NSObject` ou ser marcada como `@objc`. Este protocolo exige a implementa√ß√£o de dois m√©todos para codificar e decodificar vari√°veis de inst√¢ncia:
```swift
class CustomPoint: NSObject, NSCoding {
var x: Double = 0.0
var name: String = ""

func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String else { return nil }
self.init(x: aDecoder.decodeDouble(forKey: "x"), name: name)
}
}
```
### **Aprimorando a Seguran√ßa com `NSSecureCoding`**
Para mitigar vulnerabilidades onde atacantes injetam dados em objetos j√° constru√≠dos, **`NSSecureCoding`** oferece um protocolo aprimorado. Classes que conformam com `NSSecureCoding` devem verificar o tipo de objetos durante a decodifica√ß√£o, garantindo que apenas os tipos de objetos esperados sejam instanciados. No entanto, √© crucial notar que, embora `NSSecureCoding` aprimore a seguran√ßa de tipo, n√£o criptografa dados nem garante sua integridade, necessitando de medidas adicionais para proteger informa√ß√µes sens√≠veis:
```swift
static var supportsSecureCoding: Bool {
return true
}

let obj = decoder.decodeObject(of: MyClass.self, forKey: "myKey")
```
## Armazenamento de Dados com `NSKeyedArchiver`
`NSKeyedArchiver` e seu contraparte, `NSKeyedUnarchiver`, permitem codificar objetos em um arquivo e posteriormente recuper√°-los. Esse mecanismo √© √∫til para persistir objetos:
```swift
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as? CustomPoint
```
### Usando `Codable` para Serializa√ß√£o Simplificada
O protocolo `Codable` do Swift combina `Decodable` e `Encodable`, facilitando a codifica√ß√£o e decodifica√ß√£o de objetos como `String`, `Int`, `Double`, etc., sem esfor√ßo extra:
```swift
struct CustomPointStruct: Codable {
var x: Double
var name: String
}
```
Esta abordagem suporta a serializa√ß√£o direta de e para listas de propriedades e JSON, melhorando o manuseio de dados em aplica√ß√µes Swift.

## Alternativas de Codifica√ß√£o JSON e XML
Al√©m do suporte nativo, v√°rias bibliotecas de terceiros oferecem capacidades de codifica√ß√£o/decodifica√ß√£o JSON e XML, cada uma com suas pr√≥prias caracter√≠sticas de desempenho e considera√ß√µes de seguran√ßa. √â imperativo selecionar cuidadosamente essas bibliotecas, especialmente para mitigar vulnerabilidades como ataques XXE (XML External Entities) configurando os analisadores para evitar o processamento de entidades externas.

### Considera√ß√µes de Seguran√ßa
Ao serializar dados, especialmente para o sistema de arquivos, √© essencial estar atento √† poss√≠vel inclus√£o de informa√ß√µes sens√≠veis. Dados serializados, se interceptados ou manuseados de forma inadequada, podem expor aplica√ß√µes a riscos como a√ß√µes n√£o autorizadas ou vazamento de dados. Recomenda-se criptografar e assinar dados serializados para aumentar a seguran√ßa.

## Refer√™ncias
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
