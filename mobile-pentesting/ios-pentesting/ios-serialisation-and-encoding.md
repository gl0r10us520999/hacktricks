{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

Code und weitere Informationen unter [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence).

## Objektserialisierung in der iOS-Entwicklung

In iOS umfasst **Objektserialisierung** die Umwandlung von Objekten in ein Format, das leicht gespeichert oder √ºbertragen werden kann, und deren Rekonstruktion aus diesem Format, wenn n√∂tig. Zwei Hauptprotokolle, **`NSCoding`** und **`NSSecureCoding`**, erleichtern diesen Prozess f√ºr Objective-C oder `NSObject`-Unterklassen, sodass Objekte in **`NSData`** serialisiert werden k√∂nnen, ein Format, das Byte-Puffer umschlie√üt.

### **`NSCoding`** Implementierung
Um `NSCoding` zu implementieren, muss eine Klasse von `NSObject` erben oder als `@objc` markiert sein. Dieses Protokoll verlangt die Implementierung von zwei Methoden zum Kodieren und Dekodieren von Instanzvariablen:
```swift
class CustomPoint: NSObject, NSCoding {
var x: Double = 0.0
var name: String = ""

func encode(with aCoder: NSCoder) {
aCoder.encode(x, forKey: "x")
aCoder.encode(name, forKey: "name")
}

required convenience init?(coder aDecoder: NSCoder) {
guard let name = aDecoder.decodeObject(forKey: "name") as? String else { return nil }
self.init(x: aDecoder.decodeDouble(forKey: "x"), name: name)
}
}
```
### **Sicherheit mit `NSSecureCoding` verbessern**
Um Schwachstellen zu mindern, bei denen Angreifer Daten in bereits konstruierte Objekte injizieren, bietet **`NSSecureCoding`** ein verbessertes Protokoll. Klassen, die `NSSecureCoding` entsprechen, m√ºssen den Typ der Objekte w√§hrend der Dekodierung √ºberpr√ºfen, um sicherzustellen, dass nur die erwarteten Objekttypen instanziiert werden. Es ist jedoch wichtig zu beachten, dass `NSSecureCoding` zwar die Typsicherheit verbessert, jedoch keine Daten verschl√ºsselt oder deren Integrit√§t gew√§hrleistet, was zus√§tzliche Ma√ünahmen zum Schutz sensibler Informationen erforderlich macht:
```swift
static var supportsSecureCoding: Bool {
return true
}

let obj = decoder.decodeObject(of: MyClass.self, forKey: "myKey")
```
## Datenarchivierung mit `NSKeyedArchiver`
`NSKeyedArchiver` und sein Pendant, `NSKeyedUnarchiver`, erm√∂glichen das Kodieren von Objekten in eine Datei und deren sp√§teren Abruf. Dieser Mechanismus ist n√ºtzlich, um Objekte zu persistieren:
```swift
NSKeyedArchiver.archiveRootObject(customPoint, toFile: "/path/to/archive")
let customPoint = NSKeyedUnarchiver.unarchiveObjectWithFile("/path/to/archive") as? CustomPoint
```
### Verwendung von `Codable` f√ºr vereinfachte Serialisierung
Swifts `Codable`-Protokoll kombiniert `Decodable` und `Encodable` und erleichtert das Kodieren und Dekodieren von Objekten wie `String`, `Int`, `Double` usw. ohne zus√§tzlichen Aufwand:
```swift
struct CustomPointStruct: Codable {
var x: Double
var name: String
}
```
Dieser Ansatz unterst√ºtzt eine unkomplizierte Serialisierung zu und von Property-Listen und JSON, was die Datenverarbeitung in Swift-Anwendungen verbessert.

## JSON- und XML-Codierungsalternativen
Neben der nativen Unterst√ºtzung bieten mehrere Drittanbieterbibliotheken JSON- und XML-Codierungs-/Dekodierungsfunktionen, jede mit ihren eigenen Leistungsmerkmalen und Sicherheits√ºberlegungen. Es ist wichtig, diese Bibliotheken sorgf√§ltig auszuw√§hlen, insbesondere um Schwachstellen wie XXE (XML External Entities)-Angriffe zu mindern, indem Parser so konfiguriert werden, dass die Verarbeitung externer Entit√§ten verhindert wird.

### Sicherheits√ºberlegungen
Bei der Serialisierung von Daten, insbesondere im Dateisystem, ist es wichtig, wachsam gegen√ºber der m√∂glichen Einbeziehung sensibler Informationen zu sein. Serialisierte Daten k√∂nnen, wenn sie abgefangen oder unsachgem√§√ü behandelt werden, Anwendungen Risiken wie unbefugte Aktionen oder Datenlecks aussetzen. Es wird empfohlen, serialisierte Daten zu verschl√ºsseln und zu signieren, um die Sicherheit zu erh√∂hen.

## Referenzen
* [https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence](https://mas.owasp.org/MASTG/iOS/0x06h-Testing-Platform-Interaction/#object-persistence)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
