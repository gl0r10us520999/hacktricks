# iOS Testing Environment

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Apple Developer Program

**To偶samo provisioningowa** to zbi贸r kluczy publicznych i prywatnych, kt贸re s powizane z kontem dewelopera Apple. Aby **podpisywa aplikacje**, musisz zapaci **99$/rok**, aby zarejestrowa si w **Apple Developer Program** i uzyska swoj to偶samo provisioningow. Bez tego nie bdziesz m贸g uruchomi aplikacji z kodu 藕r贸dowego na fizycznym urzdzeniu. Inn opcj jest u偶ycie **urzdzenia z jailbreakiem**.

Od Xcode 7.2 Apple wprowadzio opcj stworzenia **darmowego profilu provisioningowego do rozwoju iOS**, kt贸ry pozwala na pisanie i testowanie aplikacji na prawdziwym iPhonie. Przejd藕 do _Xcode_ --> _Preferences_ --> _Accounts_ --> _+_ (Dodaj nowe Apple ID z twoimi danymi) --> _Kliknij na utworzone Apple ID_ --> _Zarzdzaj certyfikatami_ --> _+_ (Apple Development) --> _Gotowe_\
\_\_Nastpnie, aby uruchomi aplikacj na swoim iPhonie, musisz najpierw **wskaza iPhone'owi, aby zaufa komputerowi.** Potem mo偶esz spr贸bowa **uruchomi aplikacj na urzdzeniu mobilnym z Xcode,** ale pojawi si bd. Przejd藕 do _Ustawienia_ --> _Og贸lne_ --> _Profile i zarzdzanie urzdzeniami_ --> Wybierz nieufny profil i kliknij "**Zaufaj**".

Zauwa偶, 偶e **aplikacje podpisane tym samym certyfikatem podpisu mog dzieli zasoby w bezpieczny spos贸b, takie jak elementy keychain**.

Profile provisioningowe s przechowywane w telefonie w **`/Library/MobileDevice/ProvisioningProfiles`**

## **Symulator**

{% hint style="info" %}
Zauwa偶, 偶e **symulator nie jest tym samym co emulator**. Symulator jedynie symuluje zachowanie urzdzenia i funkcje, ale ich faktycznie nie u偶ywa.
{% endhint %}

### **Symulator**

Pierwsz rzecz, kt贸r musisz wiedzie, jest to, 偶e **przeprowadzanie pentestu w symulatorze bdzie znacznie bardziej ograniczone ni偶 robienie tego na urzdzeniu z jailbreakiem**.

Wszystkie narzdzia potrzebne do budowy i wsparcia aplikacji iOS s **oficjalnie wspierane tylko na Mac OS**.\
De facto narzdziem Apple do tworzenia/debugowania/instrumentacji aplikacji iOS jest **Xcode**. Mo偶e by u偶ywane do pobierania innych komponent贸w, takich jak **symulatory** i r贸偶ne **wersje SDK** wymagane do budowy i **testowania** twojej aplikacji.\
Zaleca si **pobranie** Xcode z **oficjalnego sklepu z aplikacjami**. Inne wersje mog zawiera zoliwe oprogramowanie.

Pliki symulatora mo偶na znale藕 w `/Users/<username>/Library/Developer/CoreSimulator/Devices`

Aby otworzy symulator, uruchom Xcode, a nastpnie kliknij w _zakadk Xcode_ --> _Otw贸rz narzdzia dewelopera_ --> _Symulator_\
\_\_Na poni偶szym obrazku klikajc w "iPod touch \[...\]" mo偶esz wybra inne urzdzenie do testowania:

![](<../../.gitbook/assets/image (270).png>)

![](<../../.gitbook/assets/image (520).png>)

### Aplikacje w Symulatorze

W folderze `/Users/<username>/Library/Developer/CoreSimulator/Devices` mo偶esz znale藕 wszystkie **zainstalowane symulatory**. Jeli chcesz uzyska dostp do plik贸w aplikacji utworzonej w jednym z emulator贸w, mo偶e by trudno wiedzie, **w kt贸rym zainstalowano aplikacj**. Szybkim sposobem na **znalezienie poprawnego UID** jest uruchomienie aplikacji w symulatorze i wykonanie:
```bash
xcrun simctl list | grep Booted
iPhone 8 (BF5DA4F8-6BBE-4EA0-BA16-7E3AFD16C06C) (Booted)
```
Once you know the UID the apps installed within it can be found in `/Users/<username>/Library/Developer/CoreSimulator/Devices/{UID}/data/Containers/Data/Application`

Jednak, zaskakujco, nie znajdziesz aplikacji tutaj. Musisz uzyska dostp do `/Users/<username>/Library/Developer/Xcode/DerivedData/{Application}/Build/Products/Debug-iphonesimulator/`

A w tym folderze mo偶esz **znale藕 pakiet aplikacji.**

## Emulator

Corellium to jedyny publicznie dostpny emulator iOS. Jest to rozwizanie SaaS dla przedsibiorstw z modelem licencji na u偶ytkownika i nie oferuje 偶adnej licencji pr贸bnej.

## Nie potrzebujesz jailbreaka

Sprawd藕 ten wpis na blogu o tym, jak przeprowadzi pentesting aplikacji iOS na **urzdzeniu bez jailbreaka**: [https://dvuln.com/blog/modern-ios-pentesting-no-jailbreak-needed](https://dvuln.com/blog/modern-ios-pentesting-no-jailbreak-needed)

## Jailbreaking

Apple cile wymaga, aby kod dziaajcy na iPhonie by **podpisany certyfikatem wydanym przez Apple**. **Jailbreaking** to proces aktywnego **obejcia takich ogranicze** i innych zabezpiecze wprowadzonych przez system operacyjny. Dlatego, gdy urzdzenie jest jailbreakowane, **sprawdzenie integralnoci**, kt贸re odpowiada za sprawdzanie instalowanych aplikacji, jest atane, wic jest **omijane**.

{% hint style="info" %}
W przeciwiestwie do Androida, **nie mo偶esz przeczy si na "Tryb dewelopera"** w iOS, aby uruchomi niesigned/niewiarygodny kod na urzdzeniu.
{% endhint %}

### Android Rooting vs. iOS Jailbreaking

Chocia偶 czsto por贸wnywane, **rooting** na Androidzie i **jailbreaking** na iOS to zasadniczo r贸偶ne procesy. Rootowanie urzdze z Androidem mo偶e obejmowa **instalacj binarnego pliku `su`** lub **wymian systemu na dostosowane ROM-y z rootem**, co niekoniecznie wymaga exploit贸w, jeli bootloader jest odblokowany. **Flashing custom ROMs** wymienia system operacyjny urzdzenia po odblokowaniu bootloadera, czasami wymagajc exploita.

W przeciwiestwie do tego, urzdzenia iOS nie mog flashowa dostosowanych ROM-贸w z powodu ograniczenia bootloadera do uruchamiania tylko obraz贸w podpisanych przez Apple. **Jailbreaking iOS** ma na celu obejcie zabezpiecze podpisywania kodu Apple, aby uruchomi niesigned kod, co jest skomplikowane przez cige ulepszenia zabezpiecze Apple.

### Wyzwania zwizane z Jailbreakingiem

Jailbreaking iOS staje si coraz trudniejszy, poniewa偶 Apple szybko ata luki. **Downgrade iOS** jest mo偶liwy tylko przez ograniczony czas po wydaniu, co sprawia, 偶e jailbreak jest kwesti czasow. Urzdzenia u偶ywane do test贸w bezpieczestwa nie powinny by aktualizowane, chyba 偶e ponowny jailbreak jest gwarantowany.

Aktualizacje iOS s kontrolowane przez **mechanizm wyzwa i odpowiedzi** (SHSH blobs), pozwalajc na instalacj tylko dla odpowiedzi podpisanych przez Apple. Ten mechanizm, znany jako "okno podpisywania", ogranicza mo偶liwo przechowywania i p贸藕niejszego u偶ywania pakiet贸w firmware OTA. Strona [IPSW Downloads](https://ipsw.me) jest zasobem do sprawdzania aktualnych okien podpisywania.

### Rodzaje Jailbreak贸w

* **Jailbreak tethered** wymaga poczenia z komputerem przy ka偶dym ponownym uruchomieniu.
* **Jailbreak semi-tethered** pozwala na uruchomienie w trybie bez jailbreaka bez komputera.
* **Jailbreak semi-untethered** wymaga rcznego ponownego jailbreaka bez potrzeby korzystania z komputera.
* **Jailbreak untethered** oferuje trwae rozwizanie jailbreakowe bez potrzeby ponownej aplikacji.

### Narzdzia i zasoby do Jailbreakingu

Narzdzia do jailbreakingu r贸偶ni si w zale偶noci od wersji iOS i urzdzenia. Zasoby takie jak [Can I Jailbreak?](https://canijailbreak.com), [The iPhone Wiki](https://www.theiphonewiki.com) i [Reddit Jailbreak](https://www.reddit.com/r/jailbreak/) dostarczaj aktualnych informacji. Przykady obejmuj:

* [Checkra1n](https://checkra.in/) dla urzdze z chipami A7-A11.
* [Palera1n](https://palera.in/) dla urzdze Checkm8 (A8-A11) na iOS 15.0-16.5.
* [Unc0ver](https://unc0ver.dev/) dla wersji iOS do 14.8.

Modyfikacja urzdzenia wi偶e si z ryzykiem, a jailbreak powinien by podejmowany ostro偶nie.

### Korzyci i ryzyka zwizane z Jailbreakingiem

Jailbreaking **usuwa piaskownic narzucon przez system operacyjny**, umo偶liwiajc aplikacjom dostp do caego systemu plik贸w. Ta swoboda umo偶liwia instalacj niezatwierdzonych aplikacji i dostp do wikszej liczby interfejs贸w API. Jednak dla zwykych u偶ytkownik贸w, jailbreak **nie jest zalecany** z powodu potencjalnych zagro偶e bezpieczestwa i niestabilnoci urzdzenia.

### **Po Jailbreaku**

{% content-ref url="basic-ios-testing-operations.md" %}
[basic-ios-testing-operations.md](basic-ios-testing-operations.md)
{% endcontent-ref %}

### **Wykrywanie Jailbreaka**

**Kilka aplikacji spr贸buje wykry, czy urzdzenie mobilne jest jailbreakowane, a w takim przypadku aplikacja nie uruchomi si**

* Po jailbreaku w iOS **pliki i foldery s zazwyczaj instalowane**, mo偶na je przeszuka, aby ustali, czy urzdzenie jest jailbreakowane.
* W urzdzeniu z jailbreakiem aplikacje uzyskuj **dostp do odczytu/zapisu do nowych plik贸w** poza piaskownic.
* Niekt贸re **wywoania API** **bd **zachowywa si inaczej**.
* Obecno usugi **OpenSSH**.
* Wywoanie `/bin/sh` **zwr贸ci 1** zamiast 0.

**Wicej informacji na temat wykrywania jailbreaka** [**tutaj**](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/jailbreak-detection-methods/)**.**

Mo偶esz spr贸bowa unikn tych wykry, u偶ywajc **objection's** `ios jailbreak disable`.

## **Obejcie wykrywania Jailbreaka**

* Mo偶esz spr贸bowa unikn tych wykry, u偶ywajc **objection's** `ios jailbreak disable`.
* Mo偶esz r贸wnie偶 zainstalowa narzdzie **Liberty Lite** (https://ryleyangus.com/repo/). Po dodaniu repo, aplikacja powinna pojawi si w zakadce 'Szukaj'.

## Referencje

* [https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/](https://mas.owasp.org/MASTG/iOS/0x06b-iOS-Security-Testing/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
