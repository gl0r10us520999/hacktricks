# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Informaci칩n B치sica**

**Tapjacking** es un ataque donde una **aplicaci칩n maliciosa** se lanza y **se posiciona encima de una aplicaci칩n v칤ctima**. Una vez que oscurece visiblemente la aplicaci칩n v칤ctima, su interfaz de usuario est치 dise침ada de tal manera que enga침a al usuario para que interact칰e con ella, mientras pasa la interacci칩n a la aplicaci칩n v칤ctima.\
En efecto, est치 **cegando al usuario para que no sepa que realmente est치 realizando acciones en la aplicaci칩n v칤ctima**.

### Detecci칩n

Para detectar aplicaciones vulnerables a este ataque, debes buscar **actividades exportadas** en el manifiesto de Android (ten en cuenta que una actividad con un intent-filter se exporta autom치ticamente por defecto). Una vez que hayas encontrado las actividades exportadas, **verifica si requieren alg칰n permiso**. Esto se debe a que la **aplicaci칩n maliciosa tambi칠n necesitar치 ese permiso**.

### Protecci칩n

#### Android 12 (API 31,32) y superior

[**Seg칰n esta fuente**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** los ataques de tapjacking son autom치ticamente prevenidos por Android desde Android 12 (API 31 y 30) y superior. As칤 que, incluso si la aplicaci칩n es vulnerable, **no podr치s explotarla**.

#### `filterTouchesWhenObscured`

Si **`android:filterTouchesWhenObscured`** est치 configurado en **`true`**, la `View` no recibir치 toques siempre que la ventana de la vista est칠 oscurecida por otra ventana visible.

#### **`setFilterTouchesWhenObscured`**

El atributo **`setFilterTouchesWhenObscured`** configurado en true tambi칠n puede prevenir la explotaci칩n de esta vulnerabilidad si la versi칩n de Android es inferior.\
Si se establece en **`true`**, por ejemplo, un bot칩n puede ser autom치ticamente **deshabilitado si est치 oscurecido**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Explotaci칩n

### Tapjacking-ExportedActivity

La **aplicaci칩n de Android m치s reciente** que realiza un ataque de Tapjacking (+ invocando antes de una actividad exportada de la aplicaci칩n atacada) se puede encontrar en: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

Sigue las **instrucciones del README para usarla**.

### FloatingWindowApp

Un proyecto de ejemplo que implementa **FloatingWindowApp**, que se puede usar para superponerse a otras actividades para realizar un ataque de clickjacking, se puede encontrar en [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (un poco antiguo, buena suerte construyendo el apk).

### Qark

{% hint style="danger" %}
Parece que este proyecto ahora no est치 mantenido y esta funcionalidad ya no funciona correctamente.
{% endhint %}

Puedes usar [**qark**](https://github.com/linkedin/qark) con los par치metros `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` para crear una aplicaci칩n maliciosa para probar posibles vulnerabilidades de **Tapjacking**.\

La mitigaci칩n es relativamente simple, ya que el desarrollador puede optar por no recibir eventos t치ctiles cuando una vista est치 cubierta por otra. Usando la [Referencia del Desarrollador de Android](https://developer.android.com/reference/android/view/View#security):

> A veces es esencial que una aplicaci칩n pueda verificar que una acci칩n se est치 realizando con el pleno conocimiento y consentimiento del usuario, como conceder una solicitud de permiso, realizar una compra o hacer clic en un anuncio. Desafortunadamente, una aplicaci칩n maliciosa podr칤a intentar enga침ar al usuario para que realice estas acciones, sin que se d칠 cuenta, al ocultar el prop칩sito previsto de la vista. Como remedio, el marco ofrece un mecanismo de filtrado de toques que se puede utilizar para mejorar la seguridad de las vistas que proporcionan acceso a funcionalidades sensibles.
>
> Para habilitar el filtrado de toques, llama a [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) o establece el atributo de dise침o android:filterTouchesWhenObscured en verdadero. Cuando est치 habilitado, el marco descartar치 los toques que se reciban siempre que la ventana de la vista est칠 oscurecida por otra ventana visible. Como resultado, la vista no recibir치 toques siempre que un toast, di치logo u otra ventana aparezca sobre la ventana de la vista.

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 춰Consulta los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
