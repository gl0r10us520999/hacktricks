# Tapjacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


## **Basic Information**

**Tapjacking** рдПрдХ рд╣рдорд▓рд╛ рд╣реИ рдЬрд╣рд╛рдБ рдПрдХ **рджреБрд╖реНрдЯ** **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ **рдкреАрдбрд╝рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдКрдкрд░ рдЦреБрдж рдХреЛ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ**ред рдЬрдм рдпрд╣ рдкреАрдбрд╝рд┐рдд рдРрдк рдХреЛ рджреГрд╢реНрдпрдорд╛рди рд░реВрдк рд╕реЗ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдзреЛрдЦрд╛ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЬрдмрдХрд┐ рдпрд╣ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЛ рдкреАрдбрд╝рд┐рдд рдРрдк рдХреЛ рдкрд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИред\
рдЗрд╕рдХрд╛ рдкреНрд░рднрд╛рд╡ рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдпрд╣ рдЬрд╛рдирдиреЗ рд╕реЗ рдЕрдВрдзрд╛ рдХрд░ рджреЗрддрд╛ рд╣реИ рдХрд┐ рд╡реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкреАрдбрд╝рд┐рдд рдРрдк рдкрд░ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░ рд░рд╣реЗ рд╣реИрдВ**ред

### Detection

рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдРрдкреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдВрдбреНрд░реЙрдЗрдб рдореИрдирд┐рдлреЗрд╕реНрдЯ рдореЗрдВ **рдирд┐рд░реНрдпрд╛рддрд┐рдд рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ** рдХреА рдЦреЛрдЬ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХ рдЧрддрд┐рд╡рд┐рдзрд┐ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЗрд░рд╛рджрд╛-рдлрд┐рд▓реНрдЯрд░ рд╣реИ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рд░реНрдпрд╛рддрд┐рдд рд╣реЛрддреА рд╣реИ)ред рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдирд┐рд░реНрдпрд╛рддрд┐рдд рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдвреВрдВрдв рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ **рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЙрдиреНрд╣реЗрдВ рдХреЛрдИ рдЕрдиреБрдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ **рджреБрд╖реНрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рднреА рдЙрд╕ рдЕрдиреБрдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА**ред

### Protection

#### Android 12 (API 31,32) рдФрд░ рдЙрдЪреНрдЪрддрд░

[**рдЗрд╕ рд╕реНрд░реЛрдд рдХреЗ рдЕрдиреБрд╕рд╛рд░**](https://www.geeksforgeeks.org/tapjacking-in-android/)**,** Android 12 (API 31 & 30) рдФрд░ рдЙрдЪреНрдЪрддрд░ рд╕реЗ Android рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ tapjacking рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рднрд▓реЗ рд╣реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ, рдЖрдк **рдЗрд╕реЗ рд╢реЛрд╖рдг рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ**ред

#### `filterTouchesWhenObscured`

рдпрджрд┐ **`android:filterTouchesWhenObscured`** рдХреЛ **`true`** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ `View` рдХреЛ рддрдм рднреА рд╕реНрдкрд░реНрд╢ рдирд╣реАрдВ рдорд┐рд▓реЗрдЧрд╛ рдЬрдм рджреГрд╢реНрдп рдХреА рд╡рд┐рдВрдбреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рджреГрд╢реНрдпрдорд╛рди рд╡рд┐рдВрдбреЛ рджреНрд╡рд╛рд░рд╛ рдЕрд╕реНрдкрд╖реНрдЯ рд╣реЛред

#### **`setFilterTouchesWhenObscured`**

рд╡рд┐рд╢реЗрд╖рддрд╛ **`setFilterTouchesWhenObscured`** рдХреЛ рд╕рддреНрдп рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдЗрд╕ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХреЗ рд╢реЛрд╖рдг рдХреЛ рднреА рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдПрдВрдбреНрд░реЙрдЗрдб рд╕рдВрд╕реНрдХрд░рдг рдХрдо рд╣реИред\
рдпрджрд┐ рдЗрд╕реЗ **`true`** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдмрдЯрди рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдпрд╣ рдЕрд╕реНрдкрд╖реНрдЯ рд╣реИ**:
```xml
<Button android:text="Button"
android:id="@+id/button1"
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:filterTouchesWhenObscured="true">
</Button>
```
## Exploitation

### Tapjacking-ExportedActivity

рд╕рдмрд╕реЗ **рд╣рд╛рд▓ рдХрд╛ Android рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдЬреЛ Tapjacking рд╣рдорд▓рд╛ рдХрд░рддрд╛ рд╣реИ (+ рд╣рдорд▓реЗ рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдирд┐рд░реНрдпрд╛рддрд┐рдд рдЧрддрд┐рд╡рд┐рдзрд┐ рд╕реЗ рдкрд╣рд▓реЗ рд╕рдХреНрд░рд┐рдп рдХрд░рдирд╛) рдпрд╣рд╛рдБ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: [**https://github.com/carlospolop/Tapjacking-ExportedActivity**](https://github.com/carlospolop/Tapjacking-ExportedActivity).

рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **README рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.

### FloatingWindowApp

рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЬреЛ **FloatingWindowApp** рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдЕрдиреНрдп рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдКрдкрд░ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХреНрд▓рд┐рдХрдЬреИрдХрд┐рдВрдЧ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдпрд╣рд╛рдБ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ [**FloatingWindowApp**](https://github.com/aminography/FloatingWindowApp) (рдереЛрдбрд╝рд╛ рдкреБрд░рд╛рдирд╛, apk рдмрдирд╛рдиреЗ рдореЗрдВ рд╢реБрднрдХрд╛рдордирд╛рдПрдБ).

### Qark

{% hint style="danger" %}
рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЕрдм рдмрдирд╛рдП рдирд╣реАрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЕрдм рдареАрдХ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реА рд╣реИ
{% endhint %}

рдЖрдк [**qark**](https://github.com/linkedin/qark) рдХрд╛ рдЙрдкрдпреЛрдЧ `--exploit-apk` --sdk-path `/Users/username/Library/Android/sdk` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рдВрднрд╛рд╡рд┐рдд **Tapjacking** рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\

рдирд┐рд╡рд╛рд░рдг рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╕рд░рд▓ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдбреЗрд╡рд▓рдкрд░ рдпрд╣ рдЪреБрди рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЬрдм рдПрдХ рджреГрд╢реНрдп рджреВрд╕рд░реЗ рджреНрд╡рд╛рд░рд╛ рдврдХрд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рд╕реНрдкрд░реНрд╢ рдШрдЯрдирд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рди рдХрд░реЗрдВред [Android DeveloperтАЩs Reference](https://developer.android.com/reference/android/view/View#security) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП:

> рдХрднреА-рдХрднреА рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХреЗ рдХрд┐ рдХреЛрдИ рдХреНрд░рд┐рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА рдФрд░ рд╕рд╣рдорддрд┐ рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдЕрдиреБрдорддрд┐ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛, рдЦрд░реАрджрд╛рд░реА рдХрд░рдирд╛ рдпрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдирд╛ред рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрди рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдзреЛрдЦрд╛ рджреЗрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдмрд┐рдирд╛ рдЬрд╛рдиреЗрдВ, рджреГрд╢реНрдп рдХреЗ рдЗрд░рд╛рджреЗ рдХреЛ рдЫрд┐рдкрд╛рдХрд░ред рдПрдХ рдЙрдкрд╛рдп рдХреЗ рд░реВрдк рдореЗрдВ, рдврд╛рдВрдЪрд╛ рдПрдХ рд╕реНрдкрд░реНрд╢ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рддрдВрддреНрд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рджреГрд╢реНрдпреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
>
> рд╕реНрдкрд░реНрд╢ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, [`setFilterTouchesWhenObscured(boolean)`](https://developer.android.com/reference/android/view/View#setFilterTouchesWhenObscured%28boolean%29) рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ рдпрд╛ android:filterTouchesWhenObscured рд▓реЗрдЖрдЙрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ true рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред рдЬрдм рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдврд╛рдВрдЪрд╛ рдЙрди рд╕реНрдкрд░реНрд╢реЛрдВ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рджреЗрдЧрд╛ рдЬреЛ рддрдм рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рджреГрд╢реНрдп рдХреА рд╡рд┐рдВрдбреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рджреГрд╢реНрдп рд╡рд┐рдВрдбреЛ рджреНрд╡рд╛рд░рд╛ рдврдХреА рд╣реЛрддреА рд╣реИред рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рджреГрд╢реНрдп рдХреЛ рддрдм рд╕реНрдкрд░реНрд╢ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ рдЬрдм рднреА рдПрдХ рдЯреЛрд╕реНрдЯ, рд╕рдВрд╡рд╛рдж рдпрд╛ рдЕрдиреНрдп рд╡рд┐рдВрдбреЛ рджреГрд╢реНрдп рдХреА рд╡рд┐рдВрдбреЛ рдХреЗ рдКрдкрд░ рдкреНрд░рдХрдЯ рд╣реЛрддреА рд╣реИред

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред**

</details>
{% endhint %}
