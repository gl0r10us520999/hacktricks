# Objection Tutorial

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty tip**: **inscrivez-vous** pour **Intigriti**, une **plateforme de bug bounty premium cr√©√©e par des hackers, pour des hackers** ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui, et commencez √† gagner des r√©compenses allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduction**

**objection - Exploration Mobile en Temps R√©el**

[**Objection**](https://github.com/sensepost/objection) est un outil d'exploration mobile en temps r√©el, aliment√© par [Frida](https://www.frida.re). Il a √©t√© con√ßu pour aider √† √©valuer les applications mobiles et leur posture de s√©curit√© sans avoir besoin d'un appareil mobile jailbreak√© ou root√©.

**Note :** Ce n'est pas une forme de contournement de jailbreak / root. En utilisant `objection`, vous √™tes toujours limit√© par toutes les restrictions impos√©es par le sandbox applicable auquel vous faites face.

### R√©sum√©

Le **but** de **objection** est de permettre √† l'utilisateur d'appeler les **principales actions offertes par Frida**. **Sinon**, l'utilisateur devra cr√©er un **script unique pour chaque application** qu'il souhaite tester.

## Tutoriel

Pour ce tutoriel, je vais utiliser l'APK que vous pouvez t√©l√©charger ici :

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ou depuis son [d√©p√¥t original](https://github.com/asvid/FridaApp) (t√©l√©charger app-release.apk)

### Installation
```bash
pip3 install objection
```
### Connection

Faites une **connexion ADB r√©guli√®re** et **d√©marrez** le serveur **frida** sur l'appareil (et v√©rifiez que frida fonctionne √† la fois sur le client et le serveur).

Si vous utilisez un **appareil root√©**, il est n√©cessaire de s√©lectionner l'application que vous souhaitez tester dans l'option _**--gadget**_. dans ce cas :
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### Actions de base

Tous les commandes possibles d'objection ne seront pas list√©es dans ce tutoriel, seulement celles que j'ai trouv√©es les plus utiles.

#### Environnement

Certaines informations int√©ressantes (comme des mots de passe ou des chemins) peuvent √™tre trouv√©es √† l'int√©rieur de l'environnement.
```bash
env
```
![](<../../../.gitbook/assets/image (220).png>)

#### Informations sur Frida
```bash
frida
```
![](<../../../.gitbook/assets/image (1093).png>)

#### T√©l√©chargement/T√©l√©versement
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### Importer le script frida
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### D√©tection de root
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Commande Exec
```bash
android shell_exec whoami
```
#### Captures d'√©cran
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### Analyse statique rendue dynamique

Dans une application r√©elle, nous devrions conna√Ætre toutes les informations d√©couvertes dans cette partie avant d'utiliser objection gr√¢ce √† **l'analyse statique**. Quoi qu'il en soit, de cette mani√®re, vous pourrez peut-√™tre voir **quelque chose de nouveau**, car ici vous n'aurez qu'une liste compl√®te de classes, de m√©thodes et d'objets export√©s.

Ceci est √©galement utile si, d'une mani√®re ou d'une autre, vous √™tes **incapable d'obtenir un code source lisible** de l'application.

#### Lister les activit√©s, les r√©cepteurs et les services
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Frida lancera une erreur si aucun n'est trouv√©

#### Obtenir l'activit√© actuelle
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (813).png>)

#### Rechercher des classes

Commen√ßons √† chercher des classes dans notre application.
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (507).png>)

#### M√©thodes de recherche d'une classe

Maintenant, extrayons les m√©thodes √† l'int√©rieur de la classe _MainActivity:_
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (929).png>)

#### Lister les m√©thodes d√©clar√©es d'une classe avec leurs param√®tres

Voyons quels param√®tres les m√©thodes de la classe n√©cessitent :
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (299).png>)

#### Lister les classes

Vous pouvez √©galement lister toutes les classes qui ont √©t√© charg√©es dans l'application actuelle :
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
C'est tr√®s utile si vous voulez **intercepter la m√©thode d'une classe et que vous ne connaissez que le nom de la classe**. Vous pourriez utiliser cette fonction pour **chercher quel module poss√®de la classe** et ensuite intercepter sa m√©thode.

### L'interception est facile

#### Intercepter (surveiller) une m√©thode

D'apr√®s le [code source](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) de l'application, nous savons que la **fonction** _**sum()**_ **de** _**MainActivity**_ est ex√©cut√©e **toutes les secondes**. Essayons de **dumper toutes les informations possibles** chaque fois que la fonction est appel√©e (arguments, valeur de retour et backtrace) :
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (1086).png>)

#### Hooking (surveillance) d'une classe enti√®re

En fait, je trouve toutes les m√©thodes de la classe MainActivity vraiment int√©ressantes, alors **hookons-les toutes**. Faites attention, cela pourrait **faire planter** une application.
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
If you play with the application while the class is hooked you will see when **chaque fonction est appel√©e**, ses **arguments** et la **valeur de retour**.

![](<../../../.gitbook/assets/image (861).png>)

#### Changer la valeur de retour bool√©enne d'une fonction

From the source code you can see that the function _checkPin_ gets a _String_ as argument and returns a _boolean_. Faisons en sorte que la fonction **retourne toujours true** :

![](<../../../.gitbook/assets/image (883).png>)

Now, If you write anything in the text box for the PIN code you will see tat anything is valid:

![](<../../../.gitbook/assets/image (228).png>)

### Instances de classe

Search for and print **instances en direct d'une classe Java sp√©cifique**, sp√©cifi√©e par un nom de classe enti√®rement qualifi√©. Out is the result of an attempt at getting a string value for a discovered objection which would typically **contenir des valeurs de propri√©t√© pour l'objet**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (1095).png>)

### Keystore/Intents

Vous pouvez jouer avec le keystore et les intents en utilisant :
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### M√©moire

#### Vidage
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### Liste
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (286).png>)

En bas de la liste, vous pouvez voir frida :

![](<../../../.gitbook/assets/image (1097).png>)

V√©rifions ce que frida exporte :

![](<../../../.gitbook/assets/image (298).png>)

#### Recherche/√âcriture

Vous pouvez √©galement rechercher et √©crire dans la m√©moire avec objection :
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

Vous pouvez utiliser la commande `sqlite` pour interagir avec les bases de donn√©es sqlite.

### Exit
```bash
exit
```
## Ce qui me manque dans Objection

* Les m√©thodes de hooking font parfois planter l'application (c'est aussi √† cause de Frida).
* Vous ne pouvez pas utiliser les instances des classes pour appeler les fonctions de l'instance. Et vous ne pouvez pas cr√©er de nouvelles instances de classes et les utiliser pour appeler des fonctions.
* Il n'y a pas de raccourci (comme celui pour sslpinnin) pour hooker toutes les m√©thodes cryptographiques courantes utilis√©es par l'application afin de voir le texte chiffr√©, le texte en clair, les cl√©s, les IV et les algorithmes utilis√©s.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Astuce bug bounty** : **inscrivez-vous** sur **Intigriti**, une **plateforme de bug bounty premium cr√©√©e par des hackers, pour des hackers** ! Rejoignez-nous sur [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) aujourd'hui, et commencez √† gagner des r√©compenses allant jusqu'√† **100 000 $** !

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
