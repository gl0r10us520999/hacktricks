# Objection Tutorial

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty tip**: **sign up** for **Intigriti**, a premium **bug bounty platform created by hackers, for hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Introduction**

**objection - Runtime Mobile Exploration**

[**Objection**](https://github.com/sensepost/objection)は、[Frida](https://www.frida.re)によって動作するランタイムモバイル探索ツールキットです。これは、脱獄またはルート化されたモバイルデバイスを必要とせずに、モバイルアプリケーションとそのセキュリティ姿勢を評価するのを助けることを目的に構築されました。

**注意:** これは脱獄/ルートバイパスの一形態ではありません。`objection`を使用することで、直面している適用可能なサンドボックスによって課せられたすべての制限に依然として制約されます。

### Resume

**objection**の**目標**は、ユーザーが**Fridaが提供する主要なアクションを呼び出す**ことを可能にすることです。**そうでなければ、**ユーザーはテストしたい**各アプリケーションのために単一のスクリプトを作成する必要があります。 

## Tutorial

このチュートリアルでは、ここからダウンロードできるAPKを使用します：

{% file src="../../../.gitbook/assets/app-release.zip" %}

またはその[オリジナルリポジトリ](https://github.com/asvid/FridaApp)から（app-release.apkをダウンロード）

### Installation
```bash
pip3 install objection
```
### Connection

**通常のADB接続**を行い、デバイスで**frida**サーバーを**起動**します（クライアントとサーバーの両方でfridaが動作していることを確認します）。

**ルート化されたデバイス**を使用している場合は、_**--gadget**_オプション内でテストしたいアプリケーションを選択する必要があります。この場合：
```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```
### 基本アクション

このチュートリアルでは、objectionのすべてのコマンドはリストされず、私がより便利だと感じたものだけが含まれます。

#### 環境

パスワードやパスなどの興味深い情報は、環境内に見つけることができます。
```bash
env
```
![](<../../../.gitbook/assets/image (220).png>)

#### Fridaに関する情報
```bash
frida
```
![](<../../../.gitbook/assets/image (1093).png>)

#### アップロード/ダウンロード
```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```
#### frida スクリプトのインポート
```bash
import <local path frida-script>
```
#### SSLPinning
```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```
#### ルート検出
```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```
#### Exec Command
```bash
android shell_exec whoami
```
#### スクリーンショット
```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```
### 静的分析を動的に

実際のアプリケーションでは、**静的分析**のおかげで、この部分で発見されたすべての情報を知っておくべきです。それでも、この方法では、クラス、メソッド、およびエクスポートされたオブジェクトの完全なリストのみが表示されるため、**新しい何か**を見ることができるかもしれません。

これは、アプリの**読みやすいソースコードを取得できない**場合にも役立ちます。

#### アクティビティ、レシーバー、およびサービスのリスト
```bash
android hooking list activities
```
![](<../../../.gitbook/assets/image (1016).png>)
```bash
android hooking list services
android hooking list receivers
```
Fridaが見つからない場合、エラーを発生させます

#### 現在のアクティビティを取得する
```bash
android hooking get current_activity
```
![](<../../../.gitbook/assets/image (813).png>)

#### クラスの検索

アプリケーション内のクラスを探し始めましょう。
```bash
android hooking search classes asvid.github.io.fridaapp
```
![](<../../../.gitbook/assets/image (507).png>)

#### クラスのメソッドを検索する

では、クラス _MainActivity:_ 内のメソッドを抽出しましょう。
```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```
![](<../../../.gitbook/assets/image (929).png>)

#### クラスの宣言されたメソッドとそのパラメータのリスト

クラスのメソッドが必要とするパラメータを確認しましょう:
```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```
![](<../../../.gitbook/assets/image (299).png>)

#### クラスのリスト

現在のアプリケーション内で読み込まれたすべてのクラスをリストすることもできます:
```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```
これは、**クラスのメソッドをフックしたいが、クラスの名前しか知らない場合**に非常に便利です。この関数を使用して、**クラスを所有するモジュールを検索**し、そのメソッドをフックできます。

### フックが簡単

#### メソッドのフック（監視）

アプリケーションの[ソースコード](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt)から、**MainActivity**の**関数**_**sum()**_が**毎秒**実行されていることがわかります。関数が呼び出されるたびに、**すべての可能な情報**（引数、戻り値、バックトレース）を**ダンプ**してみましょう：
```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```
![](<../../../.gitbook/assets/image (1086).png>)

#### クラス全体をフックする（監視する）

実際、クラス MainActivity のすべてのメソッドが非常に興味深いと思いますので、**すべてフックしましょう**。注意してください、これによりアプリケーションが**クラッシュ**する可能性があります。
```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```
If you play with the application while the class is hooked you will see when **各関数が呼び出されるか**, its **引数** and the **戻り値**.

![](<../../../.gitbook/assets/image (861).png>)

#### 関数のブール戻り値を変更する

From the source code you can see that the function _checkPin_ gets a _String_ as argument and returns a _boolean_. Lets make the function **常にtrueを返す**:

![](<../../../.gitbook/assets/image (883).png>)

Now, If you write anything in the text box for the PIN code you will see tat anything is valid:

![](<../../../.gitbook/assets/image (228).png>)

### クラスインスタンス

Search for and print **特定のJavaクラスのライブインスタンス**, specified by a fully qualified class name. Out is the result of an attempt at getting a string value for a discovered objection which would typically **オブジェクトのプロパティ値を含む**.
```
android heap print_instances <class>
```
![](<../../../.gitbook/assets/image (1095).png>)

### Keystore/Intents

キーストアとインテントを使用して遊ぶことができます:
```bash
android keystore list
android intents launch_activity
android intent launch_service
```
### メモリ

#### ダンプ
```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```
#### リスト
```bash
memory list modules
```
![](<../../../.gitbook/assets/image (286).png>)

リストの下部にはfridaが表示されています:

![](<../../../.gitbook/assets/image (1097).png>)

fridaが何をエクスポートしているか確認しましょう:

![](<../../../.gitbook/assets/image (298).png>)

#### 検索/書き込み

objectionを使用してメモリ内を検索および書き込むこともできます:
```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```
### SQLite

SQLiteデータベースと対話するには、コマンド`sqlite`を使用できます。

### Exit
```bash
exit
```
## Objectionでの不足点

* フッキングメソッドは時々アプリケーションをクラッシュさせます（これはFridaの影響でもあります）。
* クラスのインスタンスを使用してインスタンスの関数を呼び出すことができません。また、新しいクラスのインスタンスを作成して関数を呼び出すこともできません。
* アプリケーションで使用されている一般的な暗号メソッドをフックして、暗号化されたテキスト、平文、キー、IV、および使用されているアルゴリズムを見るためのショートカット（sslpinningのようなもの）がありません。

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**バグバウンティのヒント**: **ハッカーによって、ハッカーのために作られたプレミアム** **バグバウンティプラットフォーム** **Intigritiにサインアップ**しましょう！今日、[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)に参加して、最大**$100,000**のバウンティを獲得し始めましょう！

{% embed url="https://go.intigriti.com/hacktricks" %}

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **ハッキングのトリックを共有するために、[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>
{% endhint %}
