# Android Task Hijacking

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Task, Back Stack and Foreground Activities

In Android, un **task** √® essenzialmente un insieme di attivit√† con cui gli utenti interagiscono per completare un lavoro specifico, organizzato all'interno di uno **back stack**. Questo stack ordina le attivit√† in base a quando sono state aperte, con l'attivit√† pi√π recente visualizzata in cima come **foreground activity**. In qualsiasi momento, solo questa attivit√† √® visibile sullo schermo, rendendola parte del **foreground task**.

Ecco una rapida panoramica delle transizioni delle attivit√†:

* **Activity 1** inizia come l'unica attivit√† in primo piano.
* L'apertura di **Activity 2** spinge **Activity 1** nello stack di retro, portando **Activity 2** in primo piano.
* L'avvio di **Activity 3** sposta **Activity 1** e **Activity 2** ulteriormente indietro nello stack, con **Activity 3** ora davanti.
* La chiusura di **Activity 3** riporta **Activity 2** in primo piano, mostrando il meccanismo di navigazione delle attivit√† semplificato di Android.

![https://developer.android.com/images/fundamentals/diagram\_backstack.png](<../../.gitbook/assets/image (698).png>)

## Attacco di affinit√† del task

### Panoramica dell'affinit√† del task e delle modalit√† di avvio

Nelle applicazioni Android, l'**affinit√† del task** specifica il task preferito di un'attivit√†, allineandosi tipicamente con il nome del pacchetto dell'app. Questa configurazione √® fondamentale per creare un'app di prova (PoC) per dimostrare l'attacco.

### Modalit√† di avvio

L'attributo `launchMode` dirige la gestione delle istanze delle attivit√† all'interno dei task. La modalit√† **singleTask** √® fondamentale per questo attacco, dettando tre scenari basati sulle istanze di attivit√† esistenti e sulle corrispondenze di affinit√† del task. Lo sfruttamento si basa sulla capacit√† dell'app dell'attaccante di imitare l'affinit√† del task dell'app target, ingannando il sistema Android nel lanciare l'app dell'attaccante invece dell'obiettivo previsto.

### Passaggi dettagliati dell'attacco

1. **Installazione dell'app malevola**: La vittima installa l'app dell'attaccante sul proprio dispositivo.
2. **Attivazione iniziale**: La vittima apre per prima l'app malevola, preparando il dispositivo per l'attacco.
3. **Tentativo di avvio dell'app target**: La vittima tenta di aprire l'app target.
4. **Esecuzione dell'hijack**: A causa dell'affinit√† del task corrispondente, l'app malevola viene lanciata al posto dell'app target.
5. **Inganno**: L'app malevola presenta una schermata di accesso falsa simile all'app target, ingannando l'utente a inserire informazioni sensibili.

Per un'implementazione pratica di questo attacco, fare riferimento al repository Task Hijacking Strandhogg su GitHub: [Task Hijacking Strandhogg](https://github.com/az0mb13/Task\_Hijacking\_Strandhogg).

### Misure di prevenzione

Per prevenire tali attacchi, gli sviluppatori possono impostare `taskAffinity` su una stringa vuota e optare per la modalit√† di avvio `singleInstance`, garantendo l'isolamento della loro app da altre. Personalizzare la funzione `onBackPressed()` offre ulteriore protezione contro l'hijacking del task.

## **Riferimenti**

* [**https://blog.dixitaditya.com/android-task-hijacking/**](https://blog.dixitaditya.com/android-task-hijacking/)
* [**https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html**](https://blog.takemyhand.xyz/2021/02/android-task-hijacking-with.html)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
