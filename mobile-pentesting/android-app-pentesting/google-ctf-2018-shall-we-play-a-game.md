# Google CTF 2018 - Shall We Play a Game?

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

Download the APK here:

I am going to upload the APK to [https://appetize.io/](https://appetize.io) (free account) to see how the apk is behaving:

![](<../../.gitbook/assets/image (46).png>)

Looks like you need to win 1000000 times to get the flag.

Following the steps from [pentesting Android](./) you can decompile the application to get the smali code and read the Java code using jadx.

Reading the java code:

![](<../../.gitbook/assets/image (47).png>)

It looks like the function that is going print the flag is **m().**

## **Smali changes**

### **Call m() the first time**

Lets make the application call m() if the variable _this.o != 1000000_ to do so, just cange the condition:

### **Call m() the first time**

Lets make the application call m() if the variable _this.o != 1000000_ to do so, just cange the condition:
```
if-ne v0, v9, :cond_2
```
/ghome/hacktricks/mobile-pentesting/android-app-pentesting/google-ctf-2018-shall-we-play-a-game.md

# Shall we play a game?

## Challenge description

The challenge consists of an Android application that simulates a game. The goal is to find a vulnerability in the app and exploit it to gain access to the flag.

## Initial analysis

To start, we need to decompile the APK file using a tool like JADX or apktool. Once decompiled, we can analyze the source code to identify potential vulnerabilities.

## Reverse engineering

Upon analyzing the source code, we find that the app communicates with a remote server using HTTP requests. The server responds with a JSON object containing the game state.

## Exploiting the vulnerability

After further analysis, we discover that the app does not properly validate the server's response. This allows us to manipulate the JSON object and modify the game state.

By modifying the game state, we can bypass certain checks and gain access to the flag. For example, we can set the "is_admin" field to true, granting us administrative privileges.

## Conclusion

In this challenge, we exploited a vulnerability in an Android app to gain access to the flag. This highlights the importance of properly validating server responses to prevent unauthorized access.

## References

- [JADX](https://github.com/skylot/jadx)
- [APKTool](https://ibotpeaches.github.io/Apktool/)
```
if-eq v0, v9, :cond_2
```
![Before](<../../.gitbook/assets/image (48).png>)

![After](<../../.gitbook/assets/image (49).png>)

Follow the steps of [pentest Android](./) to recompile and sign the APK. Then, upload it to [https://appetize.io/](https://appetize.io) and lets see what happens:

![](<../../.gitbook/assets/image (50).png>)

Looks like the flag is written without being completely decrypted. Probably the m() function should be called 1000000 times.

**Other way** to do this is to not change the instrucction but change the compared instructions:

![](<../../.gitbook/assets/image (55).png>)

**Another way** is instead of comparing with 1000000, set the value to 1 so this.o is compared with 1:

![](<../../.gitbook/assets/image (57).png>)

A forth way is to add an instruction to move to value of v9(1000000) to v0 _(this.o)_:

![](<../../.gitbook/assets/image (58).png>)

![](<../../.gitbook/assets/image (52).png>)

## Solution

Make the application run the loop 100000 times when you win the first time. To do so, you only need to create the **:goto\_6** loop and make the application **jump there if `this.o`** does not value 100000\:

![](<../../.gitbook/assets/image (59).png>)

You need to do this inside a physical device as (I don't know why) this doesn't work in an emulated device.

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
