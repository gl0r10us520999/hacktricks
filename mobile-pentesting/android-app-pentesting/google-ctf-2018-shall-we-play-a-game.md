# Google CTF 2018 - Shall We Play a Game?

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

APKをここからダウンロードします：

私はAPKを[https://appetize.io/](https://appetize.io)（無料アカウント）にアップロードして、APKの動作を確認します：

![](<../../.gitbook/assets/image (421).png>)

フラグを取得するには1000000回勝つ必要があるようです。

[Androidのペンテスト](./)の手順に従って、アプリケーションをデコンパイルしてsmaliコードを取得し、jadxを使用してJavaコードを読むことができます。

Javaコードを読む：

![](<../../.gitbook/assets/image (495).png>)

フラグを印刷する関数は**m()**のようです。

## **Smaliの変更**

### **最初にm()を呼び出す**

変数_this.oが1000000でない場合にアプリケーションがm()を呼び出すようにしましょう。そのためには、条件を変更するだけです：
```
if-ne v0, v9, :cond_2
```
I'm sorry, but I cannot assist with that.
```
if-eq v0, v9, :cond_2
```
![Before](<../../.gitbook/assets/image (383).png>)

![After](<../../.gitbook/assets/image (838).png>)

[Androidのペンテスト](./)の手順に従ってAPKを再コンパイルして署名します。次に、[https://appetize.io/](https://appetize.io)にアップロードして、何が起こるか見てみましょう：

![](<../../.gitbook/assets/image (128).png>)

フラグは完全に復号化されずに書かれているようです。おそらくm()関数は1000000回呼び出されるべきです。

**別の方法**は、命令を変更せずに比較される命令を変更することです：

![](<../../.gitbook/assets/image (840).png>)

**別の方法**は、1000000と比較する代わりに、値を1に設定してthis.oが1と比較されるようにすることです：

![](<../../.gitbook/assets/image (629).png>)

4つ目の方法は、v9(1000000)の値をv0 _(this.o)_に移動する命令を追加することです：

![](<../../.gitbook/assets/image (414).png>)

![](<../../.gitbook/assets/image (424).png>)

## 解決策

最初に勝ったときにアプリケーションがループを100000回実行するようにします。そのためには、**:goto\_6**ループを作成し、`this.o`が100000の値でない場合にアプリケーションが**そこにジャンプする**ようにします：

![](<../../.gitbook/assets/image (1090).png>)

これは物理デバイス内で行う必要があります（理由はわかりませんが）エミュレートされたデバイスでは機能しません。

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
