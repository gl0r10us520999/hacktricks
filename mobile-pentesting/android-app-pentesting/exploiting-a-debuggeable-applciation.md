# Eksploatacija aplikacije koja se moÅ¾e debagovati

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

# **ObilaÅ¾enje root i debagabilnih provera**

Ovaj deo posta je saÅ¾etak iz posta [**https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0**](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)

## Koraci za pravljenje Android aplikacije debagabilnom i obilaÅ¾enje provera

### **Pravljenje aplikacije debagabilnom**

SadrÅ¾aj zasnovan na https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0

1. **Decompile APK:**
- Iskoristite APK-GUI alat za dekompilaciju APK-a.
- U _android-manifest_ datoteci, umetnite `android:debuggable=true` da omoguÄ‡ite reÅ¾im debagovanja.
- Ponovo kompajlirajte, potpiÅ¡ite i zipalign modifikovanu aplikaciju.

2. **Instalirajte modifikovanu aplikaciju:**
- Koristite komandu: `adb install <application_name>`.

3. **Preuzmite ime paketa:**
- IzvrÅ¡ite `adb shell pm list packages â€“3` da biste naveli aplikacije treÄ‡ih strana i pronaÅ¡li ime paketa.

4. **Postavite aplikaciju da Äeka na vezu debagera:**
- Komanda: `adb shell am setup-debug-app â€“w <package_name>`.
- **Napomena:** Ova komanda mora biti pokrenuta svaki put pre nego Å¡to se aplikacija pokrene kako bi se osiguralo da Äeka na debagera.
- Za trajnost, koristite `adb shell am setup-debug-app â€“w -â€“persistent <package_name>`.
- Da biste uklonili sve oznake, koristite `adb shell am clear-debug-app <package_name>`.

5. **Pripremite se za debagovanje u Android Studiju:**
- Navigirajte u Android Studiju do _File -> Open Profile or APK_.
- Otvorite recompiled APK.

6. **Postavite prekidne taÄke u kljuÄnim Java datotekama:**
- Postavite prekidne taÄke u `MainActivity.java` (specifiÄno u `onCreate` metodi), `b.java`, i `ContextWrapper.java`.

### **ObilaÅ¾enje provera**

Aplikacija Ä‡e u odreÄ‘enim trenucima proveriti da li je debagabilna i takoÄ‘e Ä‡e proveriti binarne datoteke koje ukazuju na ureÄ‘aj sa root pristupom. Debager se moÅ¾e koristiti za modifikaciju informacija o aplikaciji, uklanjanje debagabilne oznake i promenu imena pretraÅ¾ivanih binarnih datoteka kako bi se obile ove provere.

Za debagabilnu proveru:

1. **Modifikujte postavke oznaka:**
- U sekciji varijabli konzole debagera, navigirajte do: `this mLoadedAPK -> mApplicationInfo -> flags = 814267974`.
- **Napomena:** Binarna reprezentacija `flags = 814267974` je `11000011100111011110`, Å¡to ukazuje da je "Flag_debuggable" aktivan.

![https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png](https://miro.medium.com/v2/resize:fit:1400/1*-ckiSbWGSoc1beuxxpKbow.png)

Ovi koraci zajedno osiguravaju da aplikacija moÅ¾e biti debagovana i da se odreÄ‘ene sigurnosne provere mogu obilaÅ¾enjem debagera, olakÅ¡avajuÄ‡i dublju analizu ili modifikaciju ponaÅ¡anja aplikacije.

Korak 2 ukljuÄuje promenu vrednosti oznake na 814267972, koja je predstavljena u binarnom obliku kao 110000101101000000100010100.

# **Eksploatacija ranjivosti**

Demonstracija je pruÅ¾ena koriÅ¡Ä‡enjem ranjive aplikacije koja sadrÅ¾i dugme i textview. U poÄetku, aplikacija prikazuje "Crack Me". Cilj je promeniti poruku sa "Try Again" na "Hacked" u runtime-u, bez modifikacije izvornog koda.

## **Proveravanje ranjivosti**
- Aplikacija je dekompilirana koriÅ¡Ä‡enjem `apktool` da bi se pristupilo `AndroidManifest.xml` datoteci.
- Prisutnost `android_debuggable="true"` u AndroidManifest.xml ukazuje da je aplikacija debagabilna i podloÅ¾na eksploataciji.
- Vredno je napomenuti da se `apktool` koristi iskljuÄivo za proveru statusa debagabilnosti bez izmene bilo kog koda.

## **Priprema postavke**
- Proces je ukljuÄivao pokretanje emulatora, instaliranje ranjive aplikacije i koriÅ¡Ä‡enje `adb jdwp` za identifikaciju Dalvik VM portova koji sluÅ¡aju.
- JDWP (Java Debug Wire Protocol) omoguÄ‡ava debagovanje aplikacije koja se pokreÄ‡e u VM-u izlaganjem jedinstvenog porta.
- Port forwarding je bio neophodan za daljinsko debagovanje, nakon Äega je JDB povezan na ciljanju aplikaciju.

## **Injektovanje koda u runtime-u**
- Eksploatacija je izvrÅ¡ena postavljanjem prekidnih taÄaka i kontrolisanjem toka aplikacije.
- Komande poput `classes` i `methods <class_name>` koriÅ¡Ä‡ene su za otkrivanje strukture aplikacije.
- Prekidna taÄka je postavljena u `onClick` metodi, a njeno izvrÅ¡enje je kontrolisano.
- Komande `locals`, `next`, i `set` koriÅ¡Ä‡ene su za inspekciju i modifikaciju lokalnih varijabli, posebno menjajuÄ‡i poruku "Try Again" na "Hacked".
- Modifikovani kod je izvrÅ¡en koriÅ¡Ä‡enjem `run` komande, uspeÅ¡no menjajuÄ‡i izlaz aplikacije u realnom vremenu.

Ovaj primer je demonstrirao kako se ponaÅ¡anje debagabilne aplikacije moÅ¾e manipulisati, istiÄuÄ‡i potencijal za sloÅ¾enije eksploate poput dobijanja shell pristupa na ureÄ‘aju u kontekstu aplikacije.

## Reference
* [https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0](https://medium.com/@shubhamsonani/hacking-with-precision-bypass-techniques-via-debugger-in-android-apps-27fd562b2cc0)
* [https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications](https://resources.infosecinstitute.com/android-hacking-security-part-6-exploiting-debuggable-android-applications)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
