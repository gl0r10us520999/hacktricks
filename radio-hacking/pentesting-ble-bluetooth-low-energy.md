{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# Introdu√ß√£o

Dispon√≠vel desde a especifica√ß√£o Bluetooth 4.0, o BLE usa apenas 40 canais, cobrindo a faixa de 2400 a 2483,5 MHz. Em contraste, o Bluetooth tradicional usa 79 canais nessa mesma faixa.

Os dispositivos BLE se comunicam enviando **pacotes de publicidade** (**beacons**), esses pacotes transmitem a exist√™ncia do dispositivo BLE para outros dispositivos pr√≥ximos. Esses beacons √†s vezes **enviam dados** tamb√©m.

O dispositivo que escuta, tamb√©m chamado de dispositivo central, pode responder a um pacote de publicidade com um **pedido SCAN** enviado especificamente para o dispositivo de publicidade. A **resposta** a esse scan usa a mesma estrutura que o pacote de **publicidade** com informa√ß√µes adicionais que n√£o puderam ser inclu√≠das no pedido de publicidade inicial, como o nome completo do dispositivo.

![](<../.gitbook/assets/image (201) (2) (1) (1).png>)

O byte de pre√¢mbulo sincroniza a frequ√™ncia, enquanto o endere√ßo de acesso de quatro bytes √© um **identificador de conex√£o**, que √© usado em cen√°rios onde m√∫ltiplos dispositivos est√£o tentando estabelecer conex√µes nos mesmos canais. Em seguida, a Unidade de Dados de Protocolo (**PDU**) cont√©m os **dados de publicidade**. Existem v√°rios tipos de PDU; os mais comumente usados s√£o ADV\_NONCONN\_IND e ADV\_IND. Dispositivos usam o tipo de PDU **ADV\_NONCONN\_IND** se **n√£o aceitam conex√µes**, transmitindo dados apenas no pacote de publicidade. Dispositivos usam **ADV\_IND** se **permitirem conex√µes** e **pararem de enviar publicidade** uma vez que uma **conex√£o** tenha sido **estabelecida**.

## GATT

O **Perfil de Atributo Gen√©rico** (GATT) define como o **dispositivo deve formatar e transferir dados**. Ao analisar a superf√≠cie de ataque de um dispositivo BLE, voc√™ frequentemente concentrar√° sua aten√ß√£o no GATT (ou GATTs), porque √© assim que a **funcionalidade do dispositivo √© acionada** e como os dados s√£o armazenados, agrupados e modificados. O GATT lista as caracter√≠sticas, descritores e servi√ßos de um dispositivo em uma tabela como valores de 16 ou 32 bits. Uma **caracter√≠stica** √© um valor **de dados** **enviado** entre o dispositivo central e o perif√©rico. Essas caracter√≠sticas podem ter **descritores** que **fornecem informa√ß√µes adicionais sobre elas**. **Caracter√≠sticas** s√£o frequentemente **agrupadas** em **servi√ßos** se estiverem relacionadas √† realiza√ß√£o de uma a√ß√£o espec√≠fica.

# Enumera√ß√£o
```bash
hciconfig #Check config, check if UP or DOWN
# If DOWN try:
sudo modprobe -c bluetooth
sudo hciconfig hci0 down && sudo hciconfig hci0 up

# Spoof MAC
spooftooph -i hci0 -a 11:22:33:44:55:66
```
## GATTool

**GATTool** permite **estabelecer** uma **conex√£o** com outro dispositivo, listando as **caracter√≠sticas** desse dispositivo e lendo e escrevendo seus atributos.\
GATTTool pode iniciar um shell interativo com a op√ß√£o `-I`:
```bash
gatttool -i hci0 -I
[ ][LE]> connect 24:62:AB:B1:A8:3E Attempting to connect to A4:CF:12:6C:B3:76 Connection successful
[A4:CF:12:6C:B3:76][LE]> characteristics
handle: 0x0002, char properties: 0x20, char value handle:
0x0003, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x02, char value handle:
0x0016, uuid: 00002a00-0000-1000-8000-00805f9b34fb
[...]

# Write data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-write-req <characteristic handle> -n <value>
gatttool -b a4:cf:12:6c:b3:76 --char-write-req -a 0x002e -n $(echo -n "04dc54d9053b4307680a"|xxd -ps)

# Read data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-read -a 0x16

# Read connecting with an authenticated encrypted connection
gatttool --sec-level=high -b a4:cf:12:6c:b3:76 --char-read -a 0x002c
```
## Bettercap
```bash
# Start listening for beacons
sudo bettercap --eval "ble.recon on"
# Wait some time
>> ble.show # Show discovered devices
>> ble.enum <mac addr> # This will show the service, characteristics and properties supported

# Write data in a characteristic
>> ble.write <MAC ADDR> <UUID> <HEX DATA>
>> ble.write <mac address of device> ff06 68656c6c6f # Write "hello" in ff06
```
{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
