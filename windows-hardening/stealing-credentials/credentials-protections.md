# Windows Credentials Protections

## Credentials Protections

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## WDigest

[WDigest](https://technet.microsoft.com/pt-pt/library/cc778868\(v=ws.10\).aspx?f=255\&MSPPError=-2147217396) рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рдЬреЛ Windows XP рдХреЗ рд╕рд╛рде рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, HTTP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ **Windows XP рд╕реЗ Windows 8.0 рдФрд░ Windows Server 2003 рд╕реЗ Windows Server 2012 рддрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реИ**ред рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ **LSASS (рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЙрдкрдкреНрд░рдгрд╛рд▓реА рд╕реЗрд╡рд╛) рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдкрд╛рд╕рд╡рд░реНрдб рднрдВрдбрд╛рд░рдг** рдХрд╛ рдкрд░рд┐рдгрд╛рдо рджреЗрддреА рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ**:
```bash
sekurlsa::wdigest
```
рдЗрд╕ рдлрд╝реАрдЪрд░ рдХреЛ **рдмрдВрдж рдпрд╛ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**, _**UseLogonCredential**_ рдФрд░ _**Negotiate**_ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА _**HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\SecurityProviders\WDigest**_ рдХреЗ рднреАрддрд░ "1" рдкрд░ рд╕реЗрдЯ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред рдпрджрд┐ рдпреЗ рдХреБрдВрдЬреА **рдЧрд╛рдпрдм рд╣реИрдВ рдпрд╛ "0" рдкрд░ рд╕реЗрдЯ рд╣реИрдВ**, рддреЛ WDigest **рдЕрдХреНрд╖рдо** рд╣реИ:
```bash
reg query HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential
```
## LSA рд╕реБрд░рдХреНрд╖рд╛

**Windows 8.1** рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, Microsoft рдиреЗ LSA рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ **рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЕрдирдзрд┐рдХреГрдд рдореЗрдореЛрд░реА рдкрдврд╝рдиреЗ рдпрд╛ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЛ рд░реЛрдХрдиреЗ** рдХреЗ рд▓рд┐рдП рдмрдврд╝рд╛рдпрд╛ред рдпрд╣ рд╕реБрдзрд╛рд░ `mimikatz.exe sekurlsa:logonpasswords` рдЬреИрд╕реЗ рдЖрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдХрд╛рд░реНрдп рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕ **рд╕реБрдзрд╛рд░рд┐рдд рд╕реБрд░рдХреНрд╖рд╛** рдХреЛ **рд╕рдХреНрд╖рдо** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, _**RunAsPPL**_ рдорд╛рди рдХреЛ _**HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\LSA**_ рдореЗрдВ 1 рдкрд░ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:
```
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA /v RunAsPPL
```
### Bypass

рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ Mimikatz рдбреНрд░рд╛рдЗрд╡рд░ mimidrv.sys рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:

![](../../.gitbook/assets/mimidrv.png)

## Credential Guard

**Credential Guard**, **Windows 10 (Enterprise рдФрд░ Education editions)** рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдПрдХ рдлреАрдЪрд░, рдорд╢реАрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ **Virtual Secure Mode (VSM)** рдФрд░ **Virtualization Based Security (VBS)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдврд╝рд╛рддрд╛ рд╣реИред рдпрд╣ CPU рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдХрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдореЗрдореЛрд░реА рд╕реНрдкреЗрд╕ рдореЗрдВ рдЕрд▓рдЧ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдореБрдЦреНрдп рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреА рдкрд╣реБрдВрдЪ рд╕реЗ рджреВрд░ рд╣реИред рдпрд╣ рдЕрд▓рдЧрд╛рд╡ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХрд░реНрдиреЗрд▓ рднреА VSM рдореЗрдВ рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╕рдХрддрд╛, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **pass-the-hash** рдЬреИрд╕реЗ рд╣рдорд▓реЛрдВ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрддрд╛ рд╣реИред **Local Security Authority (LSA)** рдЗрд╕ рд╕реБрд░рдХреНрд╖рд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХ рдЯреНрд░рд╕реНрдЯрд▓реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдореБрдЦреНрдп OS рдореЗрдВ **LSASS** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ VSM рдХреЗ LSA рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **Credential Guard** рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╕рдВрдЧрдарди рдХреЗ рднреАрддрд░ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдпрд╣ **Mimikatz** рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЕрдкрдиреА рдХреНрд╖рдорддрд╛ рдореЗрдВ рдмрд╛рдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдХрд╕реНрдЯрдо **Security Support Providers (SSP)** рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд▓реЙрдЧрд┐рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЗ рджреМрд░рд╛рди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

**Credential Guard** рдХреА рд╕рдХреНрд░рд┐рдпрдг рд╕реНрдерд┐рддрд┐ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, _**HKLM\System\CurrentControlSet\Control\LSA**_ рдХреЗ рддрд╣рдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА _**LsaCfgFlags**_ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред "**1**" рдХрд╛ рдорд╛рди **UEFI рд▓реЙрдХ** рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдпрдг рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ, "**2**" рдмрд┐рдирд╛ рд▓реЙрдХ рдХреЗ, рдФрд░ "**0**" рдпрд╣ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИред рдпрд╣ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдЬрд╛рдВрдЪ, рдЬрдмрдХрд┐ рдПрдХ рдордЬрдмреВрдд рд╕рдВрдХреЗрддрдХ рд╣реИ, Credential Guard рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХрдорд╛рддреНрд░ рдХрджрдо рдирд╣реАрдВ рд╣реИред рдЗрд╕ рдлреАрдЪрд░ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддреГрдд рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдФрд░ рдПрдХ PowerShell рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдСрдирд▓рд╛рдЗрди рдЙрдкрд▓рдмреНрдз рд╣реИред
```powershell
reg query HKLM\System\CurrentControlSet\Control\LSA /v LsaCfgFlags
```
For a comprehensive understanding and instructions on enabling **Credential Guard** in Windows 10 and its automatic activation in compatible systems of **Windows 11 Enterprise and Education (version 22H2)**, visit [Microsoft's documentation](https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard-manage).

Further details on implementing custom SSPs for credential capture are provided in [this guide](../active-directory-methodology/custom-ssp.md).

## RDP RestrictedAdmin Mode

**Windows 8.1 рдФрд░ Windows Server 2012 R2** рдиреЗ рдХрдИ рдирдП рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреЗрд╢ рдХреА, рдЬрд┐рд╕рдореЗрдВ _**RDP рдХреЗ рд▓рд┐рдП Restricted Admin рдореЛрдб**_ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕ рдореЛрдб рдХреЛ [**pass the hash**](https://blog.ahasayen.com/pass-the-hash/) рд╣рдорд▓реЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рдкрд░рдВрдкрд░рд╛рдЧрдд рд░реВрдк рд╕реЗ, рдЬрдм рдЖрдк RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд▓рдХреНрд╖реНрдп рдорд╢реАрди рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдо рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрди рдЦрд╛рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, _**Restricted Admin рдореЛрдб**_ рдХреЗ рдкрд░рд┐рдЪрдп рдХреЗ рд╕рд╛рде, рдпрд╣ рдЬреЛрдЦрд┐рдо рдХрд╛рдлреА рд╣рдж рддрдХ рдХрдо рд╣реЛ рдЧрдпрд╛ рд╣реИред

рдЬрдм рдЖрдк **mstsc.exe /RestrictedAdmin** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ RDP рдХрдиреЗрдХреНрд╢рди рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рдЖрдкрдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐, рдпрджрд┐ рдХрд┐рд╕реА рдореИрд▓рд╡реЗрдпрд░ рд╕рдВрдХреНрд░рдордг рдпрд╛ рдпрджрд┐ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╕реЗ рд╕рдордЭреМрддрд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред

рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **Restricted Admin рдореЛрдб** рдореЗрдВ, RDP рд╕рддреНрд░ рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рдкреНрд░рдпрд╛рд╕ рдЖрдкрдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ; рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, **рдорд╢реАрди рдХреА рдкрд╣рдЪрд╛рди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рджреВрд░рд╕реНрде рдбреЗрд╕реНрдХрдЯреЙрдк рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЙрд▓реНрд▓рдВрдШрди рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЙрдЬрд╛рдЧрд░ рд╣реЛрдиреЗ рд╕реЗ рдмрдЪрд╛рдиреЗ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрджрдо рд╣реИред

![](../../.gitbook/assets/RAM.png)

For more detailed information on visit [this resource](https://blog.ahasayen.com/restricted-admin-mode-for-rdp/).

## Cached Credentials

Windows **рдбреЛрдореЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рд╕реНрдерд╛рдиреАрдп рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг (LSA)** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ **Kerberos** рдФрд░ **NTLM** рдЬреИрд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред Windows рдХреА рдПрдХ рдкреНрд░рдореБрдЦ рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ **рдЕрдВрддрд┐рдо рджрд╕ рдбреЛрдореЗрди рд▓реЙрдЧрд┐рдиреНрд╕** рдХреЛ рдХреИрд╢ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВ, рднрд▓реЗ рд╣реА **рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдСрдлрд╝рд▓рд╛рдЗрди** рд╣реЛтАФрдпрд╣ рдЙрди рд▓реИрдкрдЯреЙрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд░рджрд╛рди рд╣реИ рдЬреЛ рдЕрдХреНрд╕рд░ рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рджреВрд░ рд╣реЛрддреЗ рд╣реИрдВред

рдХреИрд╢ рдХрд┐рдП рдЧрдП рд▓реЙрдЧрд┐рди рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ **рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдпрд╛ рд╕рдореВрд╣ рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рджреЗрдЦрдиреЗ рдпрд╛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\WINLOGON" /v CACHEDLOGONSCOUNT
```
Access to these cached credentials is tightly controlled, with only the **SYSTEM** account having the necessary permissions to view them. Administrators needing to access this information must do so with SYSTEM user privileges. The credentials are stored at: `HKEY_LOCAL_MACHINE\SECURITY\Cache`

**Mimikatz** can be employed to extract these cached credentials using the command `lsadump::cache`.

For further details, the original [source](http://juggernaut.wikidot.com/cached-credentials) provides comprehensive information.

## Protected Users

**Protected Users group** рдореЗрдВ рд╕рджрд╕реНрдпрддрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрдИ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдзрд╛рд░ рд▓рд╛рддреА рд╣реИ, рдЬреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреЛрд░реА рдФрд░ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ:

* **Credential Delegation (CredSSP)**: рднрд▓реЗ рд╣реА **Allow delegating default credentials** рдХреЗ рд▓рд┐рдП Group Policy рд╕реЗрдЯрд┐рдВрдЧ рд╕рдХреНрд╖рдо рд╣реЛ, Protected Users рдХреЗ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдХреИрд╢ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* **Windows Digest**: **Windows 8.1 рдФрд░ Windows Server 2012 R2** рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░, рд╕рд┐рд╕реНрдЯрдо Protected Users рдХреЗ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдХреИрд╢ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдЪрд╛рд╣реЗ Windows Digest рд╕реНрдерд┐рддрд┐ рдХреБрдЫ рднреА рд╣реЛред
* **NTLM**: рд╕рд┐рд╕реНрдЯрдо Protected Users рдХреЗ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ NT рдПрдХ-рддрд░рдлрд╛ рдХрд╛рд░реНрдпреЛрдВ (NTOWF) рдХреЛ рдХреИрд╢ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред
* **Kerberos**: Protected Users рдХреЗ рд▓рд┐рдП, Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг **DES** рдпрд╛ **RC4 keys** рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рди рд╣реА рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ Ticket-Granting Ticket (TGT) рдЕрдзрд┐рдЧреНрд░рд╣рдг рдХреЗ рдмрд╛рдж рджреАрд░реНрдШрдХрд╛рд▓рд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдХреИрд╢ рдХрд░реЗрдЧрд╛ред
* **Offline Sign-In**: Protected Users рдХреЗ рд▓рд┐рдП рд╕рд╛рдЗрди-рдЗрди рдпрд╛ рдЕрдирд▓реЙрдХ рдкрд░ рдХреЛрдИ рдХреИрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╡реЗрд░рд┐рдлрд╛рдпрд░ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЗрди рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП рдСрдлрд╝рд▓рд╛рдЗрди рд╕рд╛рдЗрди-рдЗрди рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИред

рдпреЗ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рддрдм рд╕рдХреНрд░рд┐рдп рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм **Protected Users group** рдХрд╛ рд╕рджрд╕реНрдп рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рднрд┐рдиреНрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕рдордЭреМрддрд╛ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдЖрдзрд┐рдХрд╛рд░рд┐рдХ [documentation](https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group) рджреЗрдЦреЗрдВред

**Table from** [**the docs**](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-c--protected-accounts-and-groups-in-active-directory)**.**

| Windows Server 2003 RTM | Windows Server 2003 SP1+ | <p>Windows Server 2012,<br>Windows Server 2008 R2,<br>Windows Server 2008</p> | Windows Server 2016          |
| ----------------------- | ------------------------ | ----------------------------------------------------------------------------- | ---------------------------- |
| Account Operators       | Account Operators        | Account Operators                                                             | Account Operators            |
| Administrator           | Administrator            | Administrator                                                                 | Administrator                |
| Administrators          | Administrators           | Administrators                                                                | Administrators               |
| Backup Operators        | Backup Operators         | Backup Operators                                                              | Backup Operators             |
| Cert Publishers         |                          |                                                                               |                              |
| Domain Admins           | Domain Admins            | Domain Admins                                                                 | Domain Admins                |
| Domain Controllers      | Domain Controllers       | Domain Controllers                                                            | Domain Controllers           |
| Enterprise Admins       | Enterprise Admins        | Enterprise Admins                                                             | Enterprise Admins            |
|                         |                          |                                                                               | Enterprise Key Admins        |
|                         |                          |                                                                               | Key Admins                   |
| Krbtgt                  | Krbtgt                   | Krbtgt                                                                        | Krbtgt                       |
| Print Operators         | Print Operators          | Print Operators                                                               | Print Operators              |
|                         |                          | Read-only Domain Controllers                                                  | Read-only Domain Controllers |
| Replicator              | Replicator               | Replicator                                                                    | Replicator                   |
| Schema Admins           | Schema Admins            | Schema Admins                                                                 | Schema Admins                |
| Server Operators        | Server Operators         | Server Operators                                                              | Server Operators             |

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
