# qarDaS Qapla'!

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>DaH jImej</strong></a><strong>! AWS hacking jImej</strong></summary>

* <strong>DaH jImej</strong> <a href="https://github.com/sponsors/carlospolop">HackTricks</a> <strong>ghItlhutlh</strong> <strong>cybersecurity company</strong> <strong>tlhIngan</strong> <strong>advertised</strong> <strong>company</strong> <strong>latest version</strong> <strong>PEASS</strong> <strong>HackTricks</strong> <strong>PDF</strong> <strong>download</strong> <strong>cha'logh</strong> <strong>?</strong> [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) <strong>qaStaHvIS</strong> <strong>!</strong>
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) <strong>ghItlhutlh</strong> <strong>NFTs</strong> <strong>collection</strong> <strong>exclusive</strong> <strong>qaStaHvIS</strong> <strong>!</strong>
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) <strong>ghItlhutlh</strong>
* [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) <strong>join</strong> <strong>**telegram group**</strong> <strong>follow</strong> <strong>Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* <strong>hacking tricks</strong> <strong>hacktricks repo</strong> <strong>hacktricks-cloud repo</strong> <strong>PRs</strong> <strong>submitting</strong> <strong>Share</strong> <strong>!</strong>

</details>

## Intro <a href="#3f17" id="3f17"></a>

**[all the information about this technique](https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab)** <strong>original post</strong> <strong>Check</strong> <strong>summary</strong> <strong>As</strong> <strong>object</strong> <strong>NT hash</strong> <strong>retrieve</strong> <strong>can</strong> <strong>you</strong> <strong>property</strong> <strong>msDS-KeyCredentialLink</strong> <strong>write</strong> <strong>if</strong> <strong>post</strong> <strong>outlined</strong> <strong>method</strong> <strong>Service Ticket</strong> <strong>unique</strong> <strong>acquire</strong> <strong>authentication credentials</strong> <strong>public-private key</strong> <strong>setting</strong> <strong>for</strong> <strong>up</strong> <strong>process</strong> <strong>This</strong> <strong>decrypted</strong> <strong>be</strong> <strong>can</strong> <strong>which</strong> <strong>PAC</strong> <strong>Certificate</strong> <strong>Attribute</strong> <strong>Privilege</strong> <strong>within</strong> <strong>NTLM_SUPPLEMENTAL_CREDENTIAL</strong> <strong>encrypted</strong> <strong>involves</strong>.

### Requirements

This technique <strong>apply</strong> <strong>to</strong> <strong>met</strong> <strong>must</strong> <strong>conditions</strong> <strong>certain</strong>:
- <strong>Controller</strong> <strong>Domain</strong> <strong>Server</strong> <strong>Windows</strong> <strong>one</strong> <strong>of</strong> <strong>minimum</strong> <strong>A</strong> <strong>is</strong> <strong>needed</strong>.
- <strong>installed</strong> <strong>certificate</strong> <strong>digital</strong> <strong>authentication</strong> <strong>server</strong> <strong>have</strong> <strong>must</strong> <strong>Controller</strong> <strong>Domain</strong> <strong>The</strong>.
- <strong>Level</strong> <strong>Functional</strong> <strong>2016</strong> <strong>Server</strong> <strong>Windows</strong> <strong>the</strong> <strong>be</strong> <strong>must</strong> <strong>Directory</strong> <strong>Active</strong> <strong>The</strong>.
- <strong>object</strong> <strong>target</strong> <strong>the</strong> <strong>attribute</strong> <strong>msDS-KeyCredentialLink</strong> <strong>modify</strong> <strong>to</strong> <strong>rights</strong> <strong>delegated</strong> <strong>with</strong> <strong>account</strong> <strong>An</strong> <strong>is</strong> <strong>required</strong>.

## Abuse

objects computer for Trust Key of abuse The options include:
1. **privileged users** on the intended host **as** to **ticket silver RC4** an **Creating**.
2. **users privileged** of **impersonation** for **S4U2Self** with **TGT** the **Using**, name service the to class service a add to Ticket Service the alterations necessitating.

abuse Trust Key of advantage significant A remove to challenging be could account computer a of creation the not and accounts vulnerable potentially to delegation avoiding key private attacker-generated the to limitation its is abuse Trust Key of advantage significant A.

## Tools

###¬†[**Whisker**](https://github.com/eladshamir/Whisker)

attack this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C# a providing DSInternals on based It's attack. this for interface C#
```shell
Whisker.exe add /target:computername$ /domain:constoso.local /dc:dc1.contoso.local /path:C:\path\to\file.pfx /password:P@ssword1
```
### [pyWhisker](https://github.com/ShutdownRepo/pywhisker)

**UNIX-based systems** jup, QapImpacket je PyDSInternals vItlhutlhlaH, **Whisker** chenmoHmeH, **KeyCredentials** chenmoHmeH, **JSON** format vItlhutlhlaH, **listing**, **adding**, **removing**, **importing** je **exporting** chenmoHmeH.
```shell
python3 pywhisker.py -d "domain.local" -u "user1" -p "complexpassword" --target "user2" --action "list"
```
### [ShadowSpray](https://github.com/Dec0ne/ShadowSpray/)

ShadowSpray **exploit GenericWrite/GenericAll permissions that wide user groups may have over domain objects** to apply ShadowCredentials broadly. It entails logging into the domain, verifying the domain's functional level, enumerating domain objects, and attempting to add KeyCredentials for TGT acquisition and NT hash revelation. Cleanup options and recursive exploitation tactics enhance its utility.


## References

* [https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab](https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab)
* [https://github.com/eladshamir/Whisker](https://github.com/eladshamir/Whisker)
* [https://github.com/Dec0ne/ShadowSpray/](https://github.com/Dec0ne/ShadowSpray/)
* [https://github.com/ShutdownRepo/pywhisker](https://github.com/ShutdownRepo/pywhisker)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the [hacktricks repo](https://github.com/carlospolop/hacktricks) and [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
