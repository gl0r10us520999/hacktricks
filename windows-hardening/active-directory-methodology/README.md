# Active Directory Methodology

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic overview

**Active Directory** —Å–ª—É–∂–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ—é —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—î—é, —â–æ –¥–æ–∑–≤–æ–ª—è—î **–º–µ—Ä–µ–∂–µ–≤–∏–º –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º** –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ –∫–µ—Ä—É–≤–∞—Ç–∏ **–¥–æ–º–µ–Ω–∞–º–∏**, **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏** —Ç–∞ **–æ–±'—î–∫—Ç–∞–º–∏** –≤ –º–µ–∂–∞—Ö –º–µ—Ä–µ–∂—ñ. –í–æ–Ω–∞ —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è, –ø–æ–ª–µ–≥—à—É—é—á–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—é –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –∫–µ—Ä–æ–≤–∞–Ω—ñ **–≥—Ä—É–ø–∏** —Ç–∞ **–ø—ñ–¥–≥—Ä—É–ø–∏**, –∫–æ–Ω—Ç—Ä–æ–ª—é—é—á–∏ **–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É** –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö —Ä—ñ–≤–Ω—è—Ö.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ **Active Directory** —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ç—Ä—å–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ä—ñ–≤–Ω—ñ–≤: **–¥–æ–º–µ–Ω–∏**, **–¥–µ—Ä–µ–≤–∞** —Ç–∞ **–ª—ñ—Å–∏**. **–î–æ–º–µ–Ω** –æ—Ö–æ–ø–ª—é—î –∫–æ–ª–µ–∫—Ü—ñ—é –æ–±'—î–∫—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** –∞–±–æ **–ø—Ä–∏—Å—Ç—Ä–æ—ó**, —è–∫—ñ –¥—ñ–ª—è—Ç—å —Å–ø—ñ–ª—å–Ω—É –±–∞–∑—É –¥–∞–Ω–∏—Ö. **–î–µ—Ä–µ–≤–∞** ‚Äî —Ü–µ –≥—Ä—É–ø–∏ —Ü–∏—Ö –¥–æ–º–µ–Ω—ñ–≤, –ø–æ–≤'—è–∑–∞–Ω—ñ —Å–ø—ñ–ª—å–Ω–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é, –∞ **–ª—ñ—Å** –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∫–æ–ª–µ–∫—Ü—ñ—é –∫—ñ–ª—å–∫–æ—Ö –¥–µ—Ä–µ–≤, –∑'—î–¥–Ω–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ **–¥–æ–≤—ñ—Ä—á—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏**, —Ñ–æ—Ä–º—É—é—á–∏ –Ω–∞–π–≤–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏. –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ **–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É** —Ç–∞ **–ø—Ä–∞–≤–∞ –Ω–∞ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è** –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∑ —Ü–∏—Ö —Ä—ñ–≤–Ω—ñ–≤.

–ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó –≤ **Active Directory** –≤–∫–ª—é—á–∞—é—Ç—å:

1. **–ö–∞—Ç–∞–ª–æ–≥** ‚Äì –ú—ñ—Å—Ç–∏—Ç—å –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —â–æ —Å—Ç–æ—Å—É—î—Ç—å—Å—è –æ–±'—î–∫—Ç—ñ–≤ Active Directory.
2. **–û–±'—î–∫—Ç** ‚Äì –ü–æ–∑–Ω–∞—á–∞—î —Å—É—Ç–Ω–æ—Å—Ç—ñ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ, –≤–∫–ª—é—á–∞—é—á–∏ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**, **–≥—Ä—É–ø–∏** –∞–±–æ **—Å–ø—ñ–ª—å–Ω—ñ –ø–∞–ø–∫–∏**.
3. **–î–æ–º–µ–Ω** ‚Äì –°–ª—É–∂–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –¥–ª—è –æ–±'—î–∫—Ç—ñ–≤ –∫–∞—Ç–∞–ª–æ–≥—É, –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –¥–ª—è –∫—ñ–ª—å–∫–æ—Ö –¥–æ–º–µ–Ω—ñ–≤ —Å–ø—ñ–≤—ñ—Å–Ω—É–≤–∞—Ç–∏ –≤ –º–µ–∂–∞—Ö **–ª—ñ—Å—É**, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–≤–æ—é –≤–ª–∞—Å–Ω—É –∫–æ–ª–µ–∫—Ü—ñ—é –æ–±'—î–∫—Ç—ñ–≤.
4. **–î–µ—Ä–µ–≤–æ** ‚Äì –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–æ–º–µ–Ω—ñ–≤, —è–∫—ñ –¥—ñ–ª—è—Ç—å —Å–ø—ñ–ª—å–Ω–∏–π –∫–æ—Ä–µ–Ω–µ–≤–∏–π –¥–æ–º–µ–Ω.
5. **–õ—ñ—Å** ‚Äì –í–µ—Ä—à–∏–Ω–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤ Active Directory, —â–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –∫—ñ–ª—å–∫–æ—Ö –¥–µ—Ä–µ–≤ –∑ **–¥–æ–≤—ñ—Ä—á–∏–º–∏ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∞–º–∏** –º—ñ–∂ –Ω–∏–º–∏.

**Active Directory Domain Services (AD DS)** –æ—Ö–æ–ø–ª—é—î —Ä—è–¥ –ø–æ—Å–ª—É–≥, –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏—Ö –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–∞ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –º–µ—Ä–µ–∂—ñ. –¶—ñ –ø–æ—Å–ª—É–≥–∏ –≤–∫–ª—é—á–∞—é—Ç—å:

1. **–ü–æ—Å–ª—É–≥–∏ –¥–æ–º–µ–Ω—É** ‚Äì –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑—É—î –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —ñ –∫–µ—Ä—É—î –≤–∑–∞—î–º–æ–¥—ñ—î—é –º—ñ–∂ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏** —Ç–∞ **–¥–æ–º–µ–Ω–∞–º–∏**, –≤–∫–ª—é—á–∞—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—ó **–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** —Ç–∞ **–ø–æ—à—É–∫—É**.
2. **–ü–æ—Å–ª—É–≥–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤** ‚Äì –ö–æ–Ω—Ç—Ä–æ–ª—é—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, —Ä–æ–∑–ø–æ–¥—ñ–ª —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–∏–º–∏ **—Ü–∏—Ñ—Ä–æ–≤–∏–º–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞–º–∏**.
3. **–õ–µ–≥–∫—ñ —Å–ª—É–∂–±–∏ –∫–∞—Ç–∞–ª–æ–≥—É** ‚Äì –ü—ñ–¥—Ç—Ä–∏–º—É—î –ø—Ä–æ–≥—Ä–∞–º–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∫–∞—Ç–∞–ª–æ–≥, —á–µ—Ä–µ–∑ **–ø—Ä–æ—Ç–æ–∫–æ–ª LDAP**.
4. **–°–ª—É–∂–±–∏ —Ñ–µ–¥–µ—Ä–∞—Ü—ñ—ó –∫–∞—Ç–∞–ª–æ–≥—É** ‚Äì –ù–∞–¥–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ **—î–¥–∏–Ω–æ–≥–æ –≤—Ö–æ–¥—É** –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —á–µ—Ä–µ–∑ –∫—ñ–ª—å–∫–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤ –≤ –æ–¥–Ω—ñ–π —Å–µ—Å—ñ—ó.
5. **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–∞–≤–∞–º–∏** ‚Äì –î–æ–ø–æ–º–∞–≥–∞—î –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –∞–≤—Ç–æ—Ä—Å—å–∫—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏, —Ä–µ–≥—É–ª—é—é—á–∏ —ó—Ö –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–µ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.
6. **–°–ª—É–∂–±–∞ DNS** ‚Äì –ö—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∞ –¥–ª—è —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è **–¥–æ–º–µ–Ω–Ω–∏—Ö —ñ–º–µ–Ω**.

–î–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ: [**TechTerms - –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è Active Directory**](https://techterms.com/definition/active\_directory)

### **Kerberos Authentication**

–©–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ **–∞—Ç–∞–∫—É–≤–∞—Ç–∏ AD**, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–¥—É–∂–µ –¥–æ–±—Ä–µ —Ä–æ–∑—É–º—ñ—Ç–∏** **–ø—Ä–æ—Ü–µ—Å –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó Kerberos**.\
[**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É, —è–∫—â–æ –≤–∏ —â–µ –Ω–µ –∑–Ω–∞—î—Ç–µ, —è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î.**](kerberos-authentication.md)

## Cheat Sheet

–í–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–≤—ñ–¥–∞—Ç–∏ [https://wadcoms.github.io/](https://wadcoms.github.io), —â–æ–± —à–≤–∏–¥–∫–æ –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ –∫–æ–º–∞–Ω–¥–∞–º–∏, —è–∫—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É/–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó AD.

## Recon Active Directory (No creds/sessions)

–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ AD, –∞–ª–µ –Ω–µ–º–∞—î –∂–æ–¥–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö/—Å–µ—Å—ñ–π, –≤–∏ –º–æ–∂–µ—Ç–µ:

* **Pentest the network:**
* –°–∫–∞–Ω—É–≤–∞—Ç–∏ –º–µ—Ä–µ–∂—É, –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –º–∞—à–∏–Ω–∏ —Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –ø–æ—Ä—Ç–∏ —Ç–∞ –Ω–∞–º–∞–≥–∞—Ç–∏—Å—è **–µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ** –∞–±–æ **–≤–∏—Ç—è–≥—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** –∑ –Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, [–ø—Ä–∏–Ω—Ç–µ—Ä–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥—É–∂–µ —Ü—ñ–∫–∞–≤–∏–º–∏ —Ü—ñ–ª—è–º–∏](ad-information-in-printers.md)).
* –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ DNS –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–ª—é—á–æ–≤—ñ —Å–µ—Ä–≤–µ—Ä–∏ –≤ –¥–æ–º–µ–Ω—ñ, —Ç–∞–∫—ñ —è–∫ –≤–µ–±, –ø—Ä–∏–Ω—Ç–µ—Ä–∏, —Å–ø—ñ–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏, vpn, –º–µ–¥—ñ–∞ —Ç–æ—â–æ.
* `gobuster dns -d domain.local -t 25 -w /opt/Seclist/Discovery/DNS/subdomain-top2000.txt`
* –û–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ –ó–∞–≥–∞–ª—å–Ω–æ—é [**–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—î—é Pentesting**](../../generic-methodologies-and-resources/pentesting-methodology.md), —â–æ–± –∑–Ω–∞–π—Ç–∏ –±—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏.
* **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø—É null —Ç–∞ Guest –Ω–∞ smb-—Å–µ—Ä–≤—ñ—Å–∞—Ö** (—Ü–µ –Ω–µ —Å–ø—Ä–∞—Ü—é—î –Ω–∞ —Å—É—á–∞—Å–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Windows):
* `enum4linux -a -u "" -p "" <DC IP> && enum4linux -a -u "guest" -p "" <DC IP>`
* `smbmap -u "" -p "" -P 445 -H <DC IP> && smbmap -u "guest" -p "" -P 445 -H <DC IP>`
* `smbclient -U '%' -L //<DC IP> && smbclient -U 'guest%' -L //`
* –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –ø—Ä–æ —Ç–µ, —è–∫ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ SMB-—Å–µ—Ä–≤–µ—Ä, –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ç—É—Ç:

{% content-ref url="../../network-services-pentesting/pentesting-smb/" %}
[pentesting-smb](../../network-services-pentesting/pentesting-smb/)
{% endcontent-ref %}

* **–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ Ldap**
* `nmap -n -sV --script "ldap* and not brute" -p 389 <DC IP>`
* –ë—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –ø—Ä–æ —Ç–µ, —è–∫ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ LDAP, –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ç—É—Ç (–∑–≤–µ—Ä–Ω—ñ—Ç—å **–æ—Å–æ–±–ª–∏–≤—É —É–≤–∞–≥—É –Ω–∞ –∞–Ω–æ–Ω—ñ–º–Ω–∏–π –¥–æ—Å—Ç—É–ø**):

{% content-ref url="../../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

* **–û—Ç—Ä—É—ó—Ç–∏ –º–µ—Ä–µ–∂—É**
* –ó–±–∏—Ä–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ [**—ñ–º—ñ—Ç—É—é—á–∏ —Å–µ—Ä–≤—ñ—Å–∏ –∑ Responder**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
* –î–æ—Å—Ç—É–ø –¥–æ —Ö–æ—Å—Ç–∞ [**–∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –∞—Ç–∞–∫–æ—é —Ä–µ–ª–µ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack)
* –ó–±–∏—Ä–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ **–≤–∏–∫—Ä–∏–≤–∞—é—á–∏** [**—Ñ–∞–ª—å—à–∏–≤—ñ UPnP —Å–µ—Ä–≤—ñ—Å–∏ –∑ evil-S**](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md)[**SDP**](https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856)
* [**OSINT**](https://book.hacktricks.xyz/external-recon-methodology):
* –í–∏—Ç—è–≥—É–≤–∞—Ç–∏ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤/—ñ–º–µ–Ω–∞ –∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂, —Å–µ—Ä–≤—ñ—Å—ñ–≤ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤–µ–±) –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö –¥–æ–º–µ–Ω—É, –∞ —Ç–∞–∫–æ–∂ –∑ –ø—É–±–ª—ñ—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª.
* –Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –ø–æ–≤–Ω—ñ —ñ–º–µ–Ω–∞ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ –∫–æ–º–ø–∞–Ω—ñ—ó, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –∫–æ–Ω–≤–µ–Ω—Ü—ñ—ó **—ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ AD** (**[—á–∏—Ç–∞–π—Ç–µ —Ü–µ](https://activedirectorypro.com/active-directory-user-naming-convention/)**). –ù–∞–π–±—ñ–ª—å—à –ø–æ—à–∏—Ä–µ–Ω—ñ –∫–æ–Ω–≤–µ–Ω—Ü—ñ—ó: _NameSurname_, _Name.Surname_, _NamSur_ (3 –ª—ñ—Ç–µ—Ä–∏ –∑ –∫–æ–∂–Ω–æ–≥–æ), _Nam.Sur_, _NSurname_, _N.Surname_, _SurnameName_, _Surname.Name_, _SurnameN_, _Surname.N_, 3 _–≤–∏–ø–∞–¥–∫–æ–≤—ñ –ª—ñ—Ç–µ—Ä–∏ —Ç–∞ 3 –≤–∏–ø–∞–¥–∫–æ–≤—ñ —Ü–∏—Ñ—Ä–∏_ (abc123).
* –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏:
* [w0Tx/generate-ad-username](https://github.com/w0Tx/generate-ad-username)
* [urbanadventurer/username-anarchy](https://github.com/urbanadventurer/username-anarchy)

### User enumeration

* **–ê–Ω–æ–Ω—ñ–º–Ω–∏–π SMB/LDAP enum:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ [**pentesting SMB**](../../network-services-pentesting/pentesting-smb/) —Ç–∞ [**pentesting LDAP**](../../network-services-pentesting/pentesting-ldap.md).
* **Kerbrute enum**: –ö–æ–ª–∏ –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è **–Ω–µ–¥—ñ–π—Å–Ω–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, —Å–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç—å, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **–∫–æ–¥ –ø–æ–º–∏–ª–∫–∏ Kerberos** _KRB5KDC\_ERR\_C\_PRINCIPAL\_UNKNOWN_, —â–æ –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —â–æ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±—É–ª–æ –Ω–µ–¥—ñ–π—Å–Ω–∏–º. **–î—ñ–π—Å–Ω—ñ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –≤–∏–∫–ª–∏—á—É—Ç—å –∞–±–æ **TGT –≤ AS-REP** –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –∞–±–æ –ø–æ–º–∏–ª–∫—É _KRB5KDC\_ERR\_PREAUTH\_REQUIRED_, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é.
```bash
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 usernames.txt #From https://github.com/ropnop/kerbrute/releases

nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN'" <IP>
Nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='<domain>',userdb=/root/Desktop/usernames.txt <IP>

msf> use auxiliary/gather/kerberos_enumusers

crackmapexec smb dominio.es  -u '' -p '' --users | awk '{print $4}' | uniq
```
* **OWA (Outlook Web Access) –°–µ—Ä–≤–µ—Ä**

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π—à–ª–∏ –æ–¥–∏–Ω –∑ —Ü–∏—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤ —É –º–µ—Ä–µ–∂—ñ, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ **–ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—Ä–æ—Ç–∏ –Ω—å–æ–≥–æ**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**MailSniper**](https://github.com/dafthack/MailSniper):
```bash
ipmo C:\Tools\MailSniper\MailSniper.ps1
# Get info about the domain
Invoke-DomainHarvestOWA -ExchHostname [ip]
# Enumerate valid users from a list of potential usernames
Invoke-UsernameHarvestOWA -ExchHostname [ip] -Domain [domain] -UserList .\possible-usernames.txt -OutFile valid.txt
# Password spraying
Invoke-PasswordSprayOWA -ExchHostname [ip] -UserList .\valid.txt -Password Summer2021
# Get addresses list from the compromised mail
Get-GlobalAddressList -ExchHostname [ip] -UserName [domain]\[username] -Password Summer2021 -OutFile gal.txt
```
{% hint style="warning" %}
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Å–ø–∏—Å–∫–∏ —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É [**—Ü—å–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó github**](https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names) \*\*\*\* —Ç–∞ —É —Ü—å–æ–º—É ([**—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ-—ñ–º–æ–≤—ñ—Ä–Ω—ñ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**](https://github.com/insidetrust/statistically-likely-usernames)).

–û–¥–Ω–∞–∫, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ **—ñ–º–µ–Ω–∞ –ª—é–¥–µ–π, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å —É –∫–æ–º–ø–∞–Ω—ñ—ó** –∑ –µ—Ç–∞–ø—É —Ä–æ–∑–≤—ñ–¥–∫–∏, —è–∫–∏–π –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É–ª–∏ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ä–∞–Ω—ñ—à–µ. –ó —ñ–º–µ–Ω–µ–º —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ–º –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç [**namemash.py**](https://gist.github.com/superkojiman/11076951) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –¥—ñ–π—Å–Ω–∏—Ö —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
{% endhint %}

### –ó–Ω–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –∞–±–æ –∫—ñ–ª—å–∫–æ—Ö —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

–û—Ç–∂–µ, –≤–∏ –∑–Ω–∞—î—Ç–µ, —â–æ —É –≤–∞—Å –≤–∂–µ —î –¥—ñ–π—Å–Ω–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∞–ª–µ –Ω–µ–º–∞—î –ø–∞—Ä–æ–ª—ñ–≤... –¢–æ–¥—ñ —Å–ø—Ä–æ–±—É–π—Ç–µ:

* [**ASREPRoast**](asreproast.md): –Ø–∫—â–æ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ **–Ω–µ–º–∞—î** –∞—Ç—Ä–∏–±—É—Ç–∞ _DONT\_REQ\_PREAUTH_, –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–ø—Ä–æ—Å–∏—Ç–∏ AS\_REP –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –¥–ª—è —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–µ –º—ñ—Å—Ç–∏—Ç–∏–º–µ –¥–µ—è–∫—ñ –¥–∞–Ω—ñ, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –ø–æ—Ö—ñ–¥–Ω–æ—é –ø–∞—Ä–æ–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* [**Password Spraying**](password-spraying.md): –°–ø—Ä–æ–±—É—î–º–æ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à—ñ **–ø–∞—Ä–æ–ª—ñ** –∑ –∫–æ–∂–Ω–∏–º –∑ –≤–∏—è–≤–ª–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –º–æ–∂–ª–∏–≤–æ, –¥–µ—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ–≥–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å (–ø–∞–º'—è—Ç–∞–π—Ç–µ –ø—Ä–æ –ø–æ–ª—ñ—Ç–∏–∫—É –ø–∞—Ä–æ–ª—ñ–≤!).
* –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **—Å–ø—Ä–µ–π—Ç–∏ OWA —Å–µ—Ä–≤–µ—Ä–∏**, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ—à—Ç–æ–≤–∏—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

{% content-ref url="password-spraying.md" %}
[password-spraying.md](password-spraying.md)
{% endcontent-ref %}

### LLMNR/NBT-NS –æ—Ç—Ä—É—î–Ω–Ω—è

–í–∏ –º–æ–∂–µ—Ç–µ –±—É—Ç–∏ –≤ –∑–º–æ–∑—ñ **–æ—Ç—Ä–∏–º–∞—Ç–∏** –¥–µ—è–∫—ñ —á–µ–ª–µ–Ω–¥–∂ **—Ö–µ—à—ñ** –¥–ª—è –∑–ª–æ–º—É **–æ—Ç—Ä—É—î–Ω–Ω—è** –¥–µ—è–∫–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ **–º–µ—Ä–µ–∂—ñ**:

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

### NTML Relay

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥, –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ **–±—ñ–ª—å—à–µ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –∞–¥—Ä–µ—Å —ñ –∫—Ä–∞—â–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –º–µ—Ä–µ–∂—ñ**. –í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—Ä–∏–º—É—Å–∏—Ç–∏ NTML [**relay attacks**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) \*\*\*\* –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ AD.

### –í–∫—Ä–∞—Å—Ç–∏ NTLM –∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª–∏

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—à–∏—Ö –ü–ö –∞–±–æ –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤** –∑ **–Ω—É–ª—å–æ–≤–∏–º –∞–±–æ –≥–æ—Å—Ç—å–æ–≤–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º**, –≤–∏ –º–æ–∂–µ—Ç–µ **—Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —Ñ–∞–π–ª–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, SCF —Ñ–∞–π–ª), —è–∫—ñ, —è–∫—â–æ —ó—Ö —è–∫–æ—Å—å –æ—Ç—Ä–∏–º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø, **–∑–∞–ø—É—Å—Ç—è—Ç—å NTML –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –ø—Ä–æ—Ç–∏ –≤–∞—Å**, —â–æ–± –≤–∏ –º–æ–≥–ª–∏ **–≤–∫—Ä–∞—Å—Ç–∏** **NTLM —á–µ–ª–µ–Ω–¥–∂** –¥–ª—è –∑–ª–æ–º—É:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

## –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ Active Directory –ó–ê –¥–æ–ø–æ–º–æ–≥–æ—é –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö/—Å–µ—Å—ñ—ó

–î–ª—è —Ü—å–æ–≥–æ –µ—Ç–∞–ø—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ **–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ —Å–µ—Å—ñ—é –¥—ñ–π—Å–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –¥–æ–º–µ–Ω—É.** –Ø–∫—â–æ —É –≤–∞—Å —î –¥—ñ–π—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ –æ–±–æ–ª–æ–Ω–∫–∞ —è–∫ –¥–æ–º–µ–Ω–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, **–≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–∞–º'—è—Ç–∞—Ç–∏, —â–æ –≤–∞—Ä—ñ–∞–Ω—Ç–∏, –Ω–∞–≤–µ–¥–µ–Ω—ñ —Ä–∞–Ω—ñ—à–µ, –≤—Å–µ —â–µ —î –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**.

–ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–Ω–∞—Ç–∏, —â–æ —Ç–∞–∫–µ **–ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ —Å—Ç—Ä–∏–±–∫–∞ Kerberos.**

{% content-ref url="kerberos-double-hop-problem.md" %}
[kerberos-double-hop-problem.md](kerberos-double-hop-problem.md)
{% endcontent-ref %}

### –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫

–ú–∞—é—á–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å, —Ü–µ **–≤–µ–ª–∏–∫–∏–π –∫—Ä–æ–∫ –¥–æ –ø–æ—á–∞—Ç–∫—É –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –≤—Å—å–æ–≥–æ –¥–æ–º–µ–Ω—É**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ—á–∞—Ç–∏ **–ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ Active Directory:**

–©–æ–¥–æ [**ASREPRoast**](asreproast.md), –≤–∏ —Ç–µ–ø–µ—Ä –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–æ–∂–Ω–æ–≥–æ –º–æ–∂–ª–∏–≤–æ–≥–æ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∞ —â–æ–¥–æ [**Password Spraying**](password-spraying.md) –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ **—Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** —ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, –ø–æ—Ä–æ–∂–Ω—ñ –ø–∞—Ä–æ–ª—ñ —Ç–∞ –Ω–æ–≤—ñ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ñ –ø–∞—Ä–æ–ª—ñ.

* –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**CMD –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó —Ä–æ–∑–≤—ñ–¥–∫–∏**](../basic-cmd-for-pentesters.md#domain-info)
* –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**powershell –¥–ª—è —Ä–æ–∑–≤—ñ–¥–∫–∏**](../basic-powershell-for-pentesters/), —â–æ –±—É–¥–µ –º–µ–Ω—à –ø–æ–º—ñ—Ç–Ω–æ
* –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ [**–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ powerview**](../basic-powershell-for-pentesters/powerview.md) –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
* –Ü–Ω—à–∏–π —á—É–¥–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–∑–≤—ñ–¥–∫–∏ –≤ Active Directory - —Ü–µ [**BloodHound**](bloodhound.md). –¶–µ **–Ω–µ –¥—É–∂–µ –Ω–µ–ø–æ–º—ñ—Ç–Ω–æ** (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –º–µ—Ç–æ–¥—ñ–≤ –∑–±–æ—Ä—É, —è–∫—ñ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ), –∞–ª–µ **—è–∫—â–æ –≤–∞–º —Ü–µ –Ω–µ –≤–∞–∂–ª–∏–≤–æ**, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏. –ó–Ω–∞–π–¥—ñ—Ç—å, –¥–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å RDP, –∑–Ω–∞–π–¥—ñ—Ç—å —à–ª—è—Ö –¥–æ —ñ–Ω—à–∏—Ö –≥—Ä—É–ø —Ç–æ—â–æ.
* **–Ü–Ω—à—ñ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É AD:** [**AD Explorer**](bloodhound.md#ad-explorer)**,** [**ADRecon**](bloodhound.md#adrecon)**,** [**Group3r**](bloodhound.md#group3r)**,** [**PingCastle**](bloodhound.md#pingcastle)**.**
* [**DNS –∑–∞–ø–∏—Å–∏ AD**](ad-dns-records.md), –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ —Ü—ñ–∫–∞–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.
* **–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑ GUI**, —è–∫–∏–π –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –∫–∞—Ç–∞–ª–æ–≥—É, - —Ü–µ **AdExplorer.exe** –∑ **SysInternal** Suite.
* –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ —à—É–∫–∞—Ç–∏ –≤ LDAP –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **ldapsearch**, —â–æ–± —à—É–∫–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –≤ –ø–æ–ª—è—Ö _userPassword_ & _unixUserPassword_, –∞–±–æ –Ω–∞–≤—ñ—Ç—å –¥–ª—è _Description_. cf. [–ü–∞—Ä–æ–ª—å –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ AD –Ω–∞ PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#password-in-ad-user-comment) –¥–ª—è —ñ–Ω—à–∏—Ö –º–µ—Ç–æ–¥—ñ–≤.
* –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ **Linux**, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –¥–æ–º–µ–Ω, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [**pywerview**](https://github.com/the-useless-one/pywerview).
* –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫:
* [**tomcarver16/ADSearch**](https://github.com/tomcarver16/ADSearch)
* [**61106960/adPEAS**](https://github.com/61106960/adPEAS)
*   **–í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ–º–µ–Ω—É**

–î—É–∂–µ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ–º–µ–Ω—É –∑ Windows (`net user /domain`, `Get-DomainUser` –∞–±–æ `wmic useraccount get name,sid`). –£ Linux –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏: `GetADUsers.py -all -dc-ip 10.10.10.110 domain.com/username` –∞–±–æ `enum4linux -a -u "user" -p "password" <DC IP>`

> –ù–∞–≤—ñ—Ç—å —è–∫—â–æ —Ü–µ–π —Ä–æ–∑–¥—ñ–ª –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –≤–∏–≥–ª—è–¥–∞—î –º–∞–ª–µ–Ω—å–∫–∏–º, —Ü–µ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∞ —á–∞—Å—Ç–∏–Ω–∞ –≤—Å—å–æ–≥–æ. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –Ω–∞ cmd, powershell, powerview —ñ BloodHound), –Ω–∞–≤—á—ñ—Ç—å—Å—è –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –¥–æ–º–µ–Ω —ñ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—è, –ø–æ–∫–∏ –Ω–µ –≤—ñ–¥—á—É—î—Ç–µ —Å–µ–±–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ. –ü—ñ–¥ —á–∞—Å –æ—Ü—ñ–Ω–∫–∏ —Ü–µ –±—É–¥–µ –∫–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç, —â–æ–± –∑–Ω–∞–π—Ç–∏ —Å–≤—ñ–π —à–ª—è—Ö –¥–æ DA –∞–±–æ –≤–∏—Ä—ñ—à–∏—Ç–∏, —â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏.

### Kerberoast

Kerberoasting –ø–µ—Ä–µ–¥–±–∞—á–∞—î –æ—Ç—Ä–∏–º–∞–Ω–Ω—è **TGS –∫–≤–∏—Ç–∫—ñ–≤**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å–ª—É–∂–±–∞–º–∏, –ø–æ–≤'—è–∑–∞–Ω–∏–º–∏ –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —ñ –∑–ª–æ–º—É —ó—Ö —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è, —è–∫–µ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –ø–∞—Ä–æ–ª—è—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, **–æ—Ñ–ª–∞–π–Ω**.

–ë—ñ–ª—å—à–µ –ø—Ä–æ —Ü–µ –≤:

{% content-ref url="kerberoast.md" %}
[kerberoast.md](kerberoast.md)
{% endcontent-ref %}

### –í—ñ–¥–¥–∞–ª–µ–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è (RDP, SSH, FTP, Win-RM —Ç–æ—â–æ)

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–µ—è–∫—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –±—É–¥—å-—è–∫–æ—ó **–º–∞—à–∏–Ω–∏**. –î–ª—è —Ü—å–æ–≥–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **CrackMapExec**, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –∫—ñ–ª—å–∫–æ—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—à–∏—Ö —Å–∫–∞–Ω—É–≤–∞–Ω—å –ø–æ—Ä—Ç—ñ–≤.

### –õ–æ–∫–∞–ª—å–Ω–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

–Ø–∫—â–æ –≤–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–ª–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ —Å–µ—Å—ñ—é —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π –¥–æ–º–µ–Ω–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —ñ –º–∞—î—Ç–µ **–¥–æ—Å—Ç—É–ø** –∑ —Ü–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –¥–æ **–±—É–¥—å-—è–∫–æ—ó –º–∞—à–∏–Ω–∏ –≤ –¥–æ–º–µ–Ω—ñ**, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–∞–π—Ç–∏ —Å–ø–æ—Å—ñ–± **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –ª–æ–∫–∞–ª—å–Ω–æ —Ç–∞ —à—É–∫–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**. –¶–µ —Ç–æ–º—É, —â–æ —Ç—ñ–ª—å–∫–∏ –∑ –ø—Ä–∞–≤–∞–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ö–µ—à—ñ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –≤ –ø–∞–º'—è—Ç—ñ (LSASS) —Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ (SAM).

–£ —Ü—ñ–π –∫–Ω–∏–∑—ñ —î –ø–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–æ [**–ª–æ–∫–∞–ª—å–Ω–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —É Windows**](../windows-local-privilege-escalation/) —Ç–∞ [**–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫**](../checklist-windows-privilege-escalation.md). –¢–∞–∫–æ–∂ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite).

### –ü–æ—Ç–æ—á–Ω—ñ —Å–µ—Å—ñ–π–Ω—ñ –∫–≤–∏—Ç–∫–∏

–î—É–∂–µ **–º–∞–ª–æ–π–º–æ–≤—ñ—Ä–Ω–æ**, —â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ **–∫–≤–∏—Ç–∫–∏** —É –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, **—è–∫—ñ –Ω–∞–¥–∞—é—Ç—å –≤–∞–º –¥–æ–∑–≤—ñ–ª –Ω–∞ –¥–æ—Å—Ç—É–ø** –¥–æ –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤, –∞–ª–µ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:
```bash
## List all tickets (if not admin, only current user tickets)
.\Rubeus.exe triage
## Dump the interesting one by luid
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))
```
### NTML Relay

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥, –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ **–±—ñ–ª—å—à–µ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –ª–∏—Å—Ç—ñ–≤ —ñ –∫—Ä–∞—â–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –º–µ—Ä–µ–∂—ñ**. –í–∏ –º–æ–∂–µ—Ç–µ –∑–º—É—Å–∏—Ç–∏ NTML [**–∞—Ç–∞–∫–∏ —Ä–µ–ª–µ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack)**.**

### **–®—É–∫–∞–π—Ç–µ –∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª–∏ –≤ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö —Å–ø—ñ–ª—å–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö**

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ —É –≤–∞—Å —î –¥–µ—è–∫—ñ –±–∞–∑–æ–≤—ñ –∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª–∏, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ **–∑–Ω–∞–π—Ç–∏** –±—É–¥—å-—è–∫—ñ **—Ü—ñ–∫–∞–≤—ñ —Ñ–∞–π–ª–∏, —è–∫—ñ –¥—ñ–ª—è—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ AD**. –í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –≤—Ä—É—á–Ω—É, –∞–ª–µ —Ü–µ –¥—É–∂–µ –Ω—É–¥–Ω–µ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è (—ñ —â–µ –±—ñ–ª—å—à–µ, —è–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Å–æ—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏).

[**–°–ª—ñ–¥—É–π—Ç–µ –∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø—Ä–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —è–∫—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏.**](../../network-services-pentesting/pentesting-smb/#domain-shared-folders-search)

### –í–∫—Ä–∞—Å—Ç–∏ NTLM –∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª–∏

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–¥–æ—Å—Ç—É–ø–∏—Ç–∏—Å—è –¥–æ —ñ–Ω—à–∏—Ö –ü–ö –∞–±–æ —Å–ø—ñ–ª—å–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤**, –≤–∏ –º–æ–∂–µ—Ç–µ **—Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —Ñ–∞–π–ª–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ñ–∞–π–ª SCF), —è–∫—ñ, —è–∫—â–æ —ó—Ö —è–∫–æ—Å—å –≤—ñ–¥–∫—Ä–∏—é—Ç—å, **–≤–∏–∫–ª–∏—á—É—Ç—å NTML –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –ø—Ä–æ—Ç–∏ –≤–∞—Å**, —â–æ–± –≤–∏ –º–æ–≥–ª–∏ **–≤–∫—Ä–∞—Å—Ç–∏** **NTLM –≤–∏–∫–ª–∏–∫** –¥–ª—è –π–æ–≥–æ –∑–ª–∞–º—É:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

### CVE-2021-1675/CVE-2021-34527 PrintNightmare

–¶—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥–æ–∑–≤–æ–ª–∏–ª–∞ –±—É–¥—å-—è–∫–æ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –¥–æ–º–µ–Ω—É**.

{% content-ref url="printnightmare.md" %}
[printnightmare.md](printnightmare.md)
{% endcontent-ref %}

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ Active Directory –ó –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–º–∏ –∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª–∞–º–∏/—Å–µ—Å—ñ—î—é

**–î–ª—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Ç–µ—Ö–Ω—ñ–∫ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–µ—è–∫—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó/–∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü–∏—Ö –∞—Ç–∞–∫.**

### –í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ö–µ—à—ñ–≤

–°–ø–æ–¥—ñ–≤–∞—é—Å—è, –≤–∞–º –≤–¥–∞–ª–æ—Å—è **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –¥–µ—è–∫–∏–π –ª–æ–∫–∞–ª—å–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä** –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [AsRepRoast](asreproast.md), [Password Spraying](password-spraying.md), [Kerberoast](kerberoast.md), [Responder](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) –≤–∫–ª—é—á–∞—é—á–∏ —Ä–µ–ª–µ, [EvilSSDP](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md), [–ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –ª–æ–∫–∞–ª—å–Ω–æ](../windows-local-privilege-escalation/).\
–¢–µ–ø–µ—Ä —á–∞—Å –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ —Ö–µ—à—ñ –≤ –ø–∞–º'—è—Ç—ñ —Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ.\
[**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–æ —Ä—ñ–∑–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ö–µ—à—ñ–≤.**](https://github.com/carlospolop/hacktricks/blob/master/windows-hardening/active-directory-methodology/broken-reference/README.md)

### Pass the Hash

**–Ø–∫—â–æ —É –≤–∞—Å —î —Ö–µ—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è **—ñ–º—ñ—Ç—É—é–≤–∞–Ω–Ω—è** –π–æ–≥–æ.\
–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫–∏–π—Å—å **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**, —è–∫–∏–π **–≤–∏–∫–æ–Ω–∞—î** **NTLM –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏** —Ü–µ–π **—Ö–µ—à**, **–∞–±–æ** –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π **sessionlogon** —ñ **–≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏** —Ü–µ–π **—Ö–µ—à** –≤—Å–µ—Ä–µ–¥–∏–Ω—É **LSASS**, —Ç–∞–∫ —â–æ –∫–æ–ª–∏ –±—É–¥—å-—è–∫–∞ **NTLM –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è**, —Ü–µ–π **—Ö–µ—à –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π.** –û—Å—Ç–∞–Ω–Ω—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç - —Ü–µ —Ç–µ, —â–æ —Ä–æ–±–∏—Ç—å mimikatz.\
[**–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.**](../ntlm/#pass-the-hash)

### Over Pass the Hash/Pass the Key

–¶—è –∞—Ç–∞–∫–∞ –º–∞—î –Ω–∞ –º–µ—Ç—ñ **–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ NTLM —Ö–µ—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –∑–∞–ø–∏—Ç—É –∫–≤–∏—Ç–∫—ñ–≤ Kerberos**, —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∑–≤–∏—á–∞–π–Ω–æ–º—É Pass The Hash —á–µ—Ä–µ–∑ NTLM –ø—Ä–æ—Ç–æ–∫–æ–ª. –¢–æ–º—É —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –æ—Å–æ–±–ª–∏–≤–æ **–∫–æ—Ä–∏—Å–Ω–æ –≤ –º–µ—Ä–µ–∂–∞—Ö, –¥–µ NTLM –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–∏–º–∫–Ω–µ–Ω–æ** —ñ –ª–∏—à–µ **Kerberos –¥–æ–∑–≤–æ–ª–µ–Ω–æ** —è–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.

{% content-ref url="over-pass-the-hash-pass-the-key.md" %}
[over-pass-the-hash-pass-the-key.md](over-pass-the-hash-pass-the-key.md)
{% endcontent-ref %}

### Pass the Ticket

–£ –º–µ—Ç–æ–¥—ñ –∞—Ç–∞–∫–∏ **Pass The Ticket (PTT)** –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ **–≤–∫—Ä–∞–¥–∞—é—Ç—å –∫–≤–∏—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∑–∞–º—ñ—Å—Ç—å —ó—Ö –ø–∞—Ä–æ–ª—è –∞–±–æ –∑–Ω–∞—á–µ–Ω—å —Ö–µ—à—É. –¶–µ–π –≤–∫—Ä–∞–¥–µ–Ω–∏–π –∫–≤–∏—Ç–æ–∫ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è **—ñ–º—ñ—Ç—É—é–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, –æ—Ç—Ä–∏–º—É—é—á–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ —ñ –ø–æ—Å–ª—É–≥ —É –º–µ—Ä–µ–∂—ñ.

{% content-ref url="pass-the-ticket.md" %}
[pass-the-ticket.md](pass-the-ticket.md)
{% endcontent-ref %}

### –ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫—Ä–µ–¥–µ–Ω—Ü—ñ–∞–ª—ñ–≤

–Ø–∫—â–æ —É –≤–∞—Å —î **—Ö–µ—à** –∞–±–æ **–ø–∞—Ä–æ–ª—å** **–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **—É–≤—ñ–π—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ** –¥–æ —ñ–Ω—à–∏—Ö **–ü–ö** –∑ –Ω–∏–º.
```bash
# Local Auth Spray (once you found some local admin pass or hash)
## --local-auth flag indicate to only try 1 time per machine
crackmapexec smb --local-auth 10.10.10.10/23 -u administrator -H 10298e182387f9cab376ecd08491764a0 | grep +
```
{% hint style="warning" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ –¥–æ—Å–∏—Ç—å **–≥—É—á–Ω–æ** —ñ **LAPS** —Ü–µ **–∑–º–µ–Ω—à–∏—Ç—å**.
{% endhint %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è MSSQL —Ç–∞ –î–æ–≤—ñ—Ä–µ–Ω—ñ –ü–æ—Å–∏–ª–∞–Ω–Ω—è

–Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∏–≤—ñ–ª–µ—ó –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ MSSQL**, –≤—ñ–Ω –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ –¥–ª—è **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥** –Ω–∞ —Ö–æ—Å—Ç—ñ MSSQL (—è–∫—â–æ –ø—Ä–∞—Ü—é—î —è–∫ SA), **–≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è** NetNTLM **—Ö–µ—à—É** –∞–±–æ –Ω–∞–≤—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **–∞—Ç–∞–∫–∏** **—Ä–µ–ª–µ**.\
–¢–∞–∫–æ–∂, —è–∫—â–æ –µ–∫–∑–µ–º–ø–ª—è—Ä MSSQL —î –¥–æ–≤—ñ—Ä–µ–Ω–∏–º (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–∞–∑—É –¥–∞–Ω–∏—Ö) —ñ–Ω—à–∏–º –µ–∫–∑–µ–º–ø–ª—è—Ä–æ–º MSSQL. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞–¥ –¥–æ–≤—ñ—Ä–µ–Ω–æ—é –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö, –≤—ñ–Ω –∑–º–æ–∂–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–æ–≤—ñ—Ä—á—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞–∫–æ–∂ –≤ —ñ–Ω—à–æ–º—É –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ**. –¶—ñ –¥–æ–≤—ñ—Ä–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑'—î–¥–Ω–∞–Ω—ñ, —ñ –≤ —è–∫–∏–π—Å—å –º–æ–º–µ–Ω—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –∑–Ω–∞–π—Ç–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—É –±–∞–∑—É –¥–∞–Ω–∏—Ö, –¥–µ –≤—ñ–Ω –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏.\
**–ü–æ—Å–∏–ª–∞–Ω–Ω—è –º—ñ–∂ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞–≤—ñ—Ç—å —á–µ—Ä–µ–∑ –¥–æ–≤—ñ—Ä–∏ –ª—ñ—Å—É.**

{% content-ref url="abusing-ad-mssql.md" %}
[abusing-ad-mssql.md](abusing-ad-mssql.md)
{% endcontent-ref %}

### –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∞ –î–µ–ª–µ–≥–∞—Ü—ñ—è

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –±—É–¥—å-—è–∫–∏–π –æ–±'—î–∫—Ç –∫–æ–º–ø'—é—Ç–µ—Ä–∞ –∑ –∞—Ç—Ä–∏–±—É—Ç–æ–º [ADS\_UF\_TRUSTED\_FOR\_DELEGATION](https://msdn.microsoft.com/en-us/library/aa772300\(v=vs.85\).aspx) —ñ —É –≤–∞—Å —î –¥–æ–º–µ–Ω–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ TGT –∑ –ø–∞–º'—è—Ç—ñ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –≤—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä.\
–û—Ç–∂–µ, —è–∫—â–æ **Domain Admin –≤—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä**, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –π–æ–≥–æ TGT —ñ –≤–∏–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∑–∞ –Ω—å–æ–≥–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ [Pass the Ticket](pass-the-ticket.md).\
–ó–∞–≤–¥—è–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω—ñ–π –¥–µ–ª–µ–≥–∞—Ü—ñ—ó –≤–∏ –Ω–∞–≤—ñ—Ç—å –º–æ–≥–ª–∏ –± **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä –¥—Ä—É–∫—É** (–Ω–∞–¥—ñ—î–º–æ—Å—å, —Ü–µ –±—É–¥–µ DC).

{% content-ref url="unconstrained-delegation.md" %}
[unconstrained-delegation.md](unconstrained-delegation.md)
{% endcontent-ref %}

### –ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∞ –î–µ–ª–µ–≥–∞—Ü—ñ—è

–Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ –∫–æ–º–ø'—é—Ç–µ—Ä –¥–æ–∑–≤–æ–ª–µ–Ω–æ –¥–ª—è "–ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ—ó –î–µ–ª–µ–≥–∞—Ü—ñ—ó", –≤—ñ–Ω –∑–º–æ–∂–µ **–≤–∏–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∑–∞ –±—É–¥—å-—è–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–µ—è–∫–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ**.\
–¢–æ–¥—ñ, —è–∫—â–æ –≤–∏ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É—î—Ç–µ —Ö–µ—à** —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞/–∫–æ–º–ø'—é—Ç–µ—Ä–∞, –≤–∏ –∑–º–æ–∂–µ—Ç–µ **–≤–∏–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∑–∞ –±—É–¥—å-—è–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** (–Ω–∞–≤—ñ—Ç—å –¥–æ–º–µ–Ω–Ω–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤) –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–µ—è–∫–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤.

{% content-ref url="constrained-delegation.md" %}
[constrained-delegation.md](constrained-delegation.md)
{% endcontent-ref %}

### –î–µ–ª–µ–≥–∞—Ü—ñ—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ—Å—É—Ä—Å—ñ–≤

–ú–∞—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ–π **WRITE** –Ω–∞ –æ–±'—î–∫—Ç Active Directory –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∞, –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É –∑ **–ø—ñ–¥–≤–∏—â–µ–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏**:

{% content-ref url="resource-based-constrained-delegation.md" %}
[resource-based-constrained-delegation.md](resource-based-constrained-delegation.md)
{% endcontent-ref %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è ACL

–°–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ –¥–µ—è–∫—ñ **—Ü—ñ–∫–∞–≤—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞–¥ –¥–µ—è–∫–∏–º–∏ –æ–±'—î–∫—Ç–∞–º–∏ –¥–æ–º–µ–Ω—É**, —è–∫—ñ –º–æ–∂—É—Ç—å –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∞–º **–ø–µ—Ä–µ–º—ñ—â–∞—Ç–∏—Å—è** –ª–∞—Ç–µ—Ä–∞–ª—å–Ω–æ/**–ø—ñ–¥–≤–∏—â—É–≤–∞—Ç–∏** –ø—Ä–∏–≤—ñ–ª–µ—ó.

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Å–ª—É–∂–±–æ—é Spooler –ø—Ä–∏–Ω—Ç–µ—Ä–∞

–í–∏—è–≤–ª–µ–Ω–Ω—è **—Å–ª—É–∂–±–∏ Spool** –≤ –¥–æ–º–µ–Ω—ñ –º–æ–∂–µ –±—É—Ç–∏ **–∑–ª–æ–≤–∂–∏—Ç–æ** –¥–ª—è **–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö** —Ç–∞ **–ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**.

{% content-ref url="printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](printers-spooler-service-abuse.md)
{% endcontent-ref %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏ —Ç—Ä–µ—Ç—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω

–Ø–∫—â–æ **—ñ–Ω—à—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** **–¥–æ—Å—Ç—É–ø–∞—é—Ç—å** –¥–æ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ—ó** –º–∞—à–∏–Ω–∏, –º–æ–∂–ª–∏–≤–æ **–∑–±–∏—Ä–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∑ –ø–∞–º'—è—Ç—ñ** —ñ –Ω–∞–≤—ñ—Ç—å **–≤–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏ –º–∞—è–∫–∏ –≤ —ó—Ö–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏** –¥–ª—è –≤–∏–¥–∞—á—ñ —Å–µ–±–µ –∑–∞ –Ω–∏—Ö.\
–ó–∞–∑–≤–∏—á–∞–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —Å–∏—Å—Ç–µ–º–∏ —á–µ—Ä–µ–∑ RDP, —Ç–æ–º—É –æ—Å—å —è–∫ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∞—Ç–∞–∫ –Ω–∞ —Å–µ—Å—ñ—ó RDP —Ç—Ä–µ—Ç—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω:

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### LAPS

**LAPS** –∑–∞–±–µ–∑–ø–µ—á—É—î —Å–∏—Å—Ç–µ–º—É –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è **–ø–∞—Ä–æ–ª–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞** –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä–∞—Ö, —â–æ –ø—Ä–∏—î–¥–Ω–∞–Ω—ñ –¥–æ –¥–æ–º–µ–Ω—É, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –π–æ–≥–æ **–≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å**, —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ —á–∞—Å—Ç—É **–∑–º—ñ–Ω—É**. –¶—ñ –ø–∞—Ä–æ–ª—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ Active Directory, –∞ –¥–æ—Å—Ç—É–ø –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ ACL –ª–∏—à–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ó –¥–æ—Å—Ç–∞—Ç–Ω—ñ–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ü–∏—Ö –ø–∞—Ä–æ–ª—ñ–≤ —Å—Ç–∞—î –º–æ–∂–ª–∏–≤–∏–º –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –¥–æ —ñ–Ω—à–∏—Ö –∫–æ–º–ø'—é—Ç–µ—Ä—ñ–≤.

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

### –ö—Ä–∞–¥—ñ–∂–∫–∞ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤

**–ó–±—ñ—Ä —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤** –∑ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ—ó –º–∞—à–∏–Ω–∏ –º–æ–∂–µ –±—É—Ç–∏ —Å–ø–æ—Å–æ–±–æ–º –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ:

{% content-ref url="ad-certificates/certificate-theft.md" %}
[certificate-theft.md](ad-certificates/certificate-theft.md)
{% endcontent-ref %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –®–∞–±–ª–æ–Ω–∞–º–∏ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤

–Ø–∫—â–æ **–≤—Ä–∞–∑–ª–∏–≤—ñ —à–∞–±–ª–æ–Ω–∏** –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ, —ó—Ö –º–æ–∂–Ω–∞ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:

{% content-ref url="ad-certificates/domain-escalation.md" %}
[domain-escalation.md](ad-certificates/domain-escalation.md)
{% endcontent-ref %}

## –ü–æ—Å—Ç-–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º –∑ –≤–∏—Å–æ–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏

### –í–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –î–æ–º–µ–Ω–Ω–∏—Ö –û–±–ª—ñ–∫–æ–≤–∏—Ö –î–∞–Ω–∏—Ö

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó **Domain Admin** –∞–±–æ –Ω–∞–≤—ñ—Ç—å –∫—Ä–∞—â–µ **Enterprise Admin**, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** **–¥–æ–º–µ–Ω–Ω—É –±–∞–∑—É –¥–∞–Ω–∏—Ö**: _ntds.dit_.

[**–ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∞—Ç–∞–∫—É DCSync –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ç—É—Ç**](dcsync.md).

[**–ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ –≤–∫—Ä–∞—Å—Ç–∏ NTDS.dit –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ç—É—Ç**](https://github.com/carlospolop/hacktricks/blob/master/windows-hardening/active-directory-methodology/broken-reference/README.md)

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —è–∫ –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å

–î–µ—è–∫—ñ –∑ —Ç–µ—Ö–Ω—ñ–∫, –æ–±–≥–æ–≤–æ—Ä–µ–Ω–∏—Ö —Ä–∞–Ω—ñ—à–µ, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–≥–ª–∏ –±:

*   –ó—Ä–æ–±–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤—Ä–∞–∑–ª–∏–≤–∏–º–∏ –¥–æ [**Kerberoast**](kerberoast.md)

```powershell
Set-DomainObject -Identity <username> -Set @{serviceprincipalname="fake/NOTHING"}r
```
*   –ó—Ä–æ–±–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤—Ä–∞–∑–ª–∏–≤–∏–º–∏ –¥–æ [**ASREPRoast**](asreproast.md)

```powershell
Set-DomainObject -Identity <username> -XOR @{UserAccountControl=4194304}
```
*   –ù–∞–¥–∞—Ç–∏ [**DCSync**](./#dcsync) –ø—Ä–∏–≤—ñ–ª–µ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

```powershell
Add-DomainObjectAcl -TargetIdentity "DC=SUB,DC=DOMAIN,DC=LOCAL" -PrincipalIdentity bfarmer -Rights DCSync
```

### –°—Ä—ñ–±–Ω–∏–π –ö–≤–∏—Ç–æ–∫

**–ê—Ç–∞–∫–∞ –°—Ä—ñ–±–Ω–æ–≥–æ –ö–≤–∏—Ç–∫–∞** —Å—Ç–≤–æ—Ä—é—î **–ª–µ–≥—ñ—Ç–∏–º–Ω–∏–π –∫–≤–∏—Ç–æ–∫ –Ω–∞ –Ω–∞–¥–∞–Ω–Ω—è –ø–æ—Å–ª—É–≥ (TGS)** –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Å–ª—É–∂–±–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **NTLM —Ö–µ—à** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **—Ö–µ—à –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –ü–ö**). –¶–µ–π –º–µ—Ç–æ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Å–ª—É–∂–±–∏**.

{% content-ref url="silver-ticket.md" %}
[silver-ticket.md](silver-ticket.md)
{% endcontent-ref %}

### –ó–æ–ª–æ—Ç–∏–π –ö–≤–∏—Ç–æ–∫

**–ê—Ç–∞–∫–∞ –ó–æ–ª–æ—Ç–æ–≥–æ –ö–≤–∏—Ç–∫–∞** –ø–µ—Ä–µ–¥–±–∞—á–∞—î, —â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ **NTLM —Ö–µ—à—É –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É krbtgt** –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ Active Directory (AD). –¶–µ–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —î –æ—Å–æ–±–ª–∏–≤–∏–º, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è –≤—Å—ñ—Ö **–∫–≤–∏—Ç–∫—ñ–≤ –Ω–∞ –Ω–∞–¥–∞–Ω–Ω—è –ø–æ—Å–ª—É–≥ (TGT)**, —è–∫—ñ —î –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤ –º–µ—Ä–µ–∂—ñ AD.

–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –æ—Ç—Ä–∏–º—É—î —Ü–µ–π —Ö–µ—à, –≤—ñ–Ω –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **TGT** –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, —è–∫–∏–π –≤–∏–±–µ—Ä–µ (–∞—Ç–∞–∫–∞ –°—Ä—ñ–±–Ω–æ–≥–æ –ö–≤–∏—Ç–∫–∞).

{% content-ref url="golden-ticket.md" %}
[golden-ticket.md](golden-ticket.md)
{% endcontent-ref %}

### –î—ñ–∞–º–∞–Ω—Ç–æ–≤–∏–π –ö–≤–∏—Ç–æ–∫

–¶—ñ –∫–≤–∏—Ç–∫–∏ —Å—Ö–æ–∂—ñ –Ω–∞ –∑–æ–ª–æ—Ç—ñ, –∞–ª–µ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω—ñ —Ç–∞–∫, —â–æ–± **–æ–±—ñ–π—Ç–∏ –∑–≤–∏—á–∞–π–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è –∑–æ–ª–æ—Ç–∏—Ö –∫–≤–∏—Ç–∫—ñ–≤.**

{% content-ref url="diamond-ticket.md" %}
[diamond-ticket.md](diamond-ticket.md)
{% endcontent-ref %}

### **–ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å –û–±–ª—ñ–∫–æ–≤–∏—Ö –ó–∞–ø–∏—Å—ñ–≤ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤**

**–ú–∞—é—á–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∞–±–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —ó—Ö –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏** —î –¥—É–∂–µ —Ö–æ—Ä–æ—à–∏–º —Å–ø–æ—Å–æ–±–æ–º –∑–±–µ—Ä–µ–≥—Ç–∏ –ø–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤—ñ–Ω –∑–º—ñ–Ω—é—î –ø–∞—Ä–æ–ª—å):

{% content-ref url="ad-certificates/account-persistence.md" %}
[account-persistence.md](ad-certificates/account-persistence.md)
{% endcontent-ref %}

### **–ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ –≤ –î–æ–º–µ–Ω—ñ**

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ —Ç–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–µ –¥–ª—è –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ –∑ –≤–∏—Å–æ–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –≤ –¥–æ–º–µ–Ω—ñ:**

{% content-ref url="ad-certificates/domain-persistence.md" %}
[domain-persistence.md](ad-certificates/domain-persistence.md)
{% endcontent-ref %}

### –ì—Ä—É–ø–∞ AdminSDHolder

–û–±'—î–∫—Ç **AdminSDHolder** –≤ Active Directory –∑–∞–±–µ–∑–ø–µ—á—É—î –±–µ–∑–ø–µ–∫—É **–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø** (—Ç–∞–∫–∏—Ö —è–∫ Domain Admins —Ç–∞ Enterprise Admins), –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π **–°–ø–∏—Å–æ–∫ –ö–æ–Ω—Ç—Ä–æ–ª—é –î–æ—Å—Ç—É–ø—É (ACL)** –¥–æ —Ü–∏—Ö –≥—Ä—É–ø, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–º –∑–º—ñ–Ω–∞–º. –û–¥–Ω–∞–∫ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏; —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑–º—ñ–Ω—é—î ACL AdminSDHolder, —â–æ–± –Ω–∞–¥–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –∑–≤–∏—á–∞–π–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, —Ü–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î –∑–Ω–∞—á–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —É—Å—ñ–º–∞ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–º–∏ –≥—Ä—É–ø–∞–º–∏. –¶—è –º—ñ—Ä–∞ –±–µ–∑–ø–µ–∫–∏, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É, –º–æ–∂–µ —Ç–∞–∫–∏–º —á–∏–Ω–æ–º –æ–±–µ—Ä–Ω—É—Ç–∏—Å—è –ø—Ä–æ—Ç–∏, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –Ω–µ–Ω–∞–ª–µ–∂–Ω–∏–π –¥–æ—Å—Ç—É–ø, —è–∫—â–æ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —ó—ó.

[**–ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≥—Ä—É–ø—É AdminDSHolder —Ç—É—Ç.**](privileged-groups-and-token-privileges.md#adminsdholder-group)

### –û–±–ª—ñ–∫–æ–≤—ñ –î–∞–Ω—ñ DSRM

–£ –∫–æ–∂–Ω–æ–º—É **–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ –î–æ–º–µ–Ω—É (DC)** —ñ—Å–Ω—É—î –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å **–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**. –û—Ç—Ä–∏–º–∞–≤—à–∏ –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ —Ç–∞–∫—ñ–π –º–∞—à–∏–Ω—ñ, —Ö–µ—à –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –º–æ–∂–Ω–∞ –≤–∏—Ç—è–≥—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **mimikatz**. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–Ω–µ—Å—Ç–∏ –∑–º—ñ–Ω–∏ –¥–æ —Ä–µ—î—Å—Ç—Ä—É, —â–æ–± **–¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—å–æ–≥–æ –ø–∞—Ä–æ–ª—è**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

{% content-ref url="dsrm-credentials.md" %}
[dsrm-credentials.md](dsrm-credentials.md)
{% endcontent-ref %}

### –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å ACL

–í–∏ –º–æ–≥–ª–∏ –± **–Ω–∞–¥–∞—Ç–∏** –¥–µ—è–∫—ñ **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó** **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É** –Ω–∞–¥ –¥–µ—è–∫–∏–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º–∏ –æ–±'—î–∫—Ç–∞–º–∏ –¥–æ–º–µ–Ω—É, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É**.

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### –û–ø–∏—Å–Ω–∏–∫–∏ –ë–µ–∑–ø–µ–∫–∏

**–û–ø–∏—Å–Ω–∏–∫–∏ –±–µ–∑–ø–µ–∫–∏** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è **–∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è** **–ø—Ä–∏–≤—ñ–ª–µ—ó–≤**, —è–∫—ñ –º–∞—î **–æ–±'—î–∫—Ç** **–Ω–∞–¥** **–æ–±'—î–∫—Ç–æ–º**. –Ø–∫—â–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ **–∑—Ä–æ–±–∏—Ç–∏** **–Ω–µ–≤–µ–ª–∏–∫—É –∑–º—ñ–Ω—É** –≤ **–æ–ø–∏—Å–Ω–∏–∫—É –±–µ–∑–ø–µ–∫–∏** –æ–±'—î–∫—Ç–∞, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥—É–∂–µ —Ü—ñ–∫–∞–≤—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞–¥ —Ü–∏–º –æ–±'—î–∫—Ç–æ–º –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –±—É—Ç–∏ —á–ª–µ–Ω–æ–º –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ—ó –≥—Ä—É–ø–∏.

{% content-ref url="security-descriptors.md" %}
[security-descriptors.md](security-descriptors.md)
{% endcontent-ref %}

### –°–∫–µ–ª–µ—Ç–Ω–∏–π –ö–ª—é—á

–ó–º—ñ–Ω—ñ—Ç—å **LSASS** –≤ –ø–∞–º'—è—Ç—ñ, —â–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ **—É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –ø–∞—Ä–æ–ª—å**, —â–æ –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö –¥–æ–º–µ–Ω–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.

{% content-ref url="skeleton-key.md" %}
[skeleton-key.md](skeleton-key.md)
{% endcontent-ref %}

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π SSP

[–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ç–∞–∫–µ SSP (–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –ü—ñ–¥—Ç—Ä–∏–º–∫–∏ –ë–µ–∑–ø–µ–∫–∏) —Ç—É—Ç.](../authentication-credentials-uac-and-efs/#security-support-provider-interface-sspi)\
–í–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–≤—ñ–π **–≤–ª–∞—Å–Ω–∏–π SSP**, —â–æ–± **–∑–∞—Ö–æ–ø–ª—é–≤–∞—Ç–∏** –≤ **—á–∏—Å—Ç–æ–º—É —Ç–µ–∫—Å—Ç—ñ** **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –º–∞—à–∏–Ω–∏.\\

{% content-ref url="custom-ssp.md" %}
[custom-ssp.md](custom-ssp.md)
{% endcontent-ref %}

### DCShadow

–¶–µ —Ä–µ—î—Å—Ç—Ä—É—î **–Ω–æ–≤–∏–π –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –î–æ–º–µ–Ω—É** –≤ AD —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –π–æ–≥–æ –¥–ª—è **–ø–æ—à—Ç–æ–≤—Ö—É–≤–∞–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤** (SIDHistory, SPNs...) –Ω–∞ –≤–∫–∞–∑–∞–Ω—ñ –æ–±'—î–∫—Ç–∏ **–±–µ–∑** –∑–∞–ª–∏—à–µ–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö **–∂—É—Ä–Ω–∞–ª—ñ–≤** —â–æ–¥–æ **–∑–º—ñ–Ω**. –í–∞–º **–ø–æ—Ç—Ä—ñ–±–Ω—ñ DA** –ø—Ä–∏–≤—ñ–ª–µ—ó —ñ –±—É—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **–∫–æ—Ä–µ–Ω–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω—É**.\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ, –∑'—è–≤–ª—è—Ç—å—Å—è –¥–æ—Å–∏—Ç—å –Ω–µ–ø—Ä–∏—î–º–Ω—ñ –∂—É—Ä–Ω–∞–ª–∏.

{% content-ref url="dcshadow.md" %}
[dcshadow.md](dcshadow.md)
{% endcontent-ref %}

### –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å LAPS

–†–∞–Ω—ñ—à–µ –º–∏ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–∏, —è–∫ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, —è–∫—â–æ —É –≤–∞—Å —î **–¥–æ—Å—Ç–∞—Ç–Ω—ñ –ø—Ä–∞–≤–∞ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ LAPS**. –û–¥–Ω–∞–∫ —Ü—ñ –ø–∞—Ä–æ–ª—ñ —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è **–ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ**.\
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ü—Ä–∏–≤—ñ–ª–µ—ó–≤ –õ—ñ—Å—É - –î–æ–º–µ–Ω–Ω—ñ –î–æ–≤—ñ—Ä–∏

Microsoft —Ä–æ–∑–≥–ª—è–¥–∞—î **–õ—ñ—Å** —è–∫ –º–µ–∂—É –±–µ–∑–ø–µ–∫–∏. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É –º–æ–∂–µ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –≤—Å—å–æ–≥–æ –õ—ñ—Å—É**.

### –û—Å–Ω–æ–≤–Ω–∞ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

[**–î–æ–º–µ–Ω–Ω–∞ –¥–æ–≤—ñ—Ä–∞**](http://technet.microsoft.com/en-us/library/cc759554\(v=ws.10\).aspx) —î –º–µ—Ö–∞–Ω—ñ–∑–º–æ–º –±–µ–∑–ø–µ–∫–∏, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –∑ –æ–¥–Ω–æ–≥–æ **–¥–æ–º–µ–Ω—É** –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –≤ —ñ–Ω—à–æ–º—É **–¥–æ–º–µ–Ω—ñ**. –¶–µ —Ñ–∞–∫—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –∑–≤'—è–∑–æ–∫ –º—ñ–∂ —Å–∏—Å—Ç–µ–º–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–≤–æ—Ö –¥–æ–º–µ–Ω—ñ–≤, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –±–µ–∑–ø–µ—Ä–µ—à–∫–æ–¥–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. –ö–æ–ª–∏ –¥–æ–º–µ–Ω–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å –¥–æ–≤—ñ—Ä—É, –≤–æ–Ω–∏ –æ–±–º—ñ–Ω—é—é—Ç—å—Å—è —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ **–∫–ª—é—á—ñ** –≤ —Å–≤–æ—ó—Ö **–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞—Ö –î–æ–º–µ–Ω—É (DC)**, —è–∫—ñ —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º–∏ –¥–ª—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–æ–≤—ñ—Ä–∏.

–£ —Ç–∏–ø–æ–≤—ñ–π —Å–∏—Ç—É–∞—Ü—ñ—ó, —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –Ω–∞–º—ñ—Ä –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å–ª—É–∂–±–∏ –≤ **–¥–æ–≤—ñ—Ä–µ–Ω–æ–º—É –¥–æ–º–µ–Ω—ñ**, —Å–ø–æ—á–∞—Ç–∫—É –≤—ñ–Ω –ø–æ–≤–∏–Ω–µ–Ω –∑–∞–ø–∏—Ç–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–≤–∏—Ç–æ–∫, –≤—ñ–¥–æ–º–∏–π —è–∫ **–º—ñ–∂–¥–æ–º–µ–Ω–Ω–∏–π TGT**, —É DC —Å–≤–æ–≥–æ –≤–ª–∞—Å–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É. –¶–µ–π TGT –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Å–ø—ñ–ª—å–Ω–∏–º **–∫–ª—é—á–µ–º**, –Ω–∞ —è–∫–æ–º—É –æ–±–∏–¥–≤–∞ –¥–æ–º–µ–Ω–∏ –ø–æ–≥–æ–¥–∏–ª–∏—Å—è. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—Ç—ñ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ü–µ–π TGT **DC –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É**, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–≤–∏—Ç–æ–∫ –Ω–∞ —Å–ª—É–∂–±—É (**TGS**). –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º—ñ–∂–¥–æ–º–µ–Ω–Ω–æ–≥–æ TGT DC –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É –≤–∏–¥–∞—î TGS, –Ω–∞–¥–∞—é—á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –¥–æ—Å—Ç—É–ø –¥–æ —Å–ª—É–∂–±–∏.

**–ö—Ä–æ–∫–∏**:

1. **–ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –∫–æ–º–ø'—é—Ç–µ—Ä** –≤ **–î–æ–º–µ–Ω—ñ 1** –ø–æ—á–∏–Ω–∞—î –ø—Ä–æ—Ü–µ—Å, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–≤—ñ–π **NTLM —Ö–µ—à** –¥–ª—è –∑–∞–ø–∏—Ç—É **–ö–≤–∏—Ç–∫–∞ –Ω–∞ –ù–∞–¥–∞–Ω–Ω—è –ö–≤–∏—Ç–∫—ñ–≤ (TGT)** —É —Å–≤–æ–≥–æ **–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –î–æ–º–µ–Ω—É (DC1)**.
2. DC1 –≤–∏–¥–∞—î –Ω–æ–≤–∏–π TGT, —è–∫—â–æ –∫–ª—ñ—î–Ω—Ç —É—Å–ø—ñ—à–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π.
3. –ö–ª—ñ—î–Ω—Ç –ø–æ—Ç—ñ–º –∑–∞–ø–∏—Ç—É—î **–º—ñ–∂–¥–æ–º–µ–Ω–Ω–∏–π TGT** —É DC1, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ —É **–î–æ–º–µ–Ω—ñ 2**.
4. –ú—ñ–∂–¥–æ–º–µ–Ω–Ω–∏–π TGT –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Å–ø—ñ–ª—å–Ω–∏–º **–∫–ª—é—á–µ–º –¥–æ–≤—ñ—Ä–∏**, —â–æ –¥—ñ–ª–∏—Ç—å—Å—è –º—ñ–∂ DC1 —Ç–∞ DC2 –≤ —Ä–∞–º–∫–∞—Ö –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—ó –¥–æ–≤—ñ—Ä–∏ –¥–æ–º–µ–Ω—É.
5. –ö–ª—ñ—î–Ω—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –º—ñ–∂–¥–æ–º–µ–Ω–Ω–∏–π TGT –¥–æ **–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –î–æ–º–µ–Ω—É 2 (DC2)**.
6. DC2 –ø–µ—Ä–µ–≤—ñ—Ä—è—î –º—ñ–∂–¥–æ–º–µ–Ω–Ω–∏–π TGT, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–≤—ñ–π —Å–ø—ñ–ª—å–Ω–∏–π –∫–ª—é—á –¥–æ–≤—ñ—Ä–∏, —ñ, —è–∫—â–æ –≤—ñ–Ω –¥—ñ–π—Å–Ω–∏–π, –≤–∏–¥–∞—î **–ö–≤–∏—Ç–æ–∫ –Ω–∞ –ù–∞–¥–∞–Ω–Ω—è –ü–æ—Å–ª—É–≥ (TGS)** –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ –≤ –î–æ–º–µ–Ω—ñ 2, –¥–æ —è–∫–æ–≥–æ –∫–ª—ñ—î–Ω—Ç —Ö–æ—á–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø.
7. –ù–∞—Ä–µ—à—Ç—ñ, –∫–ª—ñ—î–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ü–µ–π TGS —Å–µ—Ä–≤–µ—Ä—É, —è–∫–∏–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ö–µ—à–µ–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–µ—Ä–≤–µ—Ä–∞, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å–ª—É–∂–±–∏ –≤ –î–æ–º–µ–Ω—ñ 2.

### –†—ñ–∑–Ω—ñ –¥–æ–≤—ñ—Ä–∏

–í–∞–∂–ª–∏–≤–æ –ø–æ–º—ñ—Ç–∏—Ç–∏, —â–æ **–¥–æ–≤—ñ—Ä–∞ –º–æ–∂–µ –±—É—Ç–∏ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—é –∞–±–æ –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—é**. –£ –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–º—É –≤–∞—Ä—ñ–∞–Ω—Ç—ñ –æ–±–∏–¥–≤–∞ –¥–æ–º–µ–Ω–∏ –¥–æ–≤—ñ—Ä—è—é—Ç—å –æ–¥–∏–Ω –æ–¥–Ω–æ–º—É, –∞–ª–µ –≤ **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π** –¥–æ–≤—ñ—Ä—ñ –æ–¥–∏–Ω –∑ –¥–æ–º–µ–Ω—ñ–≤ –±—É–¥–µ **–¥–æ–≤—ñ—Ä–µ–Ω–∏–º**, –∞ —ñ–Ω—à–∏–π - **–¥–æ–≤–µ—Ä—è—é—á–∏–º**. –£ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –≤–∏–ø–∞–¥–∫—É **–≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –ª–∏—à–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–æ–≤—ñ—Ä—á–æ–≥–æ –¥–æ–º–µ–Ω—É –∑ –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ**.

–Ø–∫—â–æ –î–æ–º–µ–Ω A –¥–æ–≤—ñ—Ä—è—î –î–æ–º–µ–Ω—É B, A —î –¥–æ–≤—ñ—Ä—á–∏–º –¥–æ–º–µ–Ω–æ–º, –∞ B - –¥–æ–≤—ñ—Ä–µ–Ω–∏–º. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –≤ **–î–æ–º—ñ–Ω—ñ A** —Ü–µ –±—É–¥–µ **–≤–∏—Ö—ñ–¥–Ω–∞ –¥–æ–≤—ñ—Ä–∞**; –∞ –≤ **–î–æ–º—ñ–Ω—ñ B** —Ü–µ –±—É–¥–µ **–≤—Ö—ñ–¥–Ω–∞ –¥–æ–≤—ñ—Ä–∞**.

**–†—ñ–∑–Ω—ñ –¥–æ–≤—ñ—Ä—á—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏**

* **–î–æ–≤—ñ—Ä–∏ –ë–∞—Ç—å–∫—ñ–≤-–î—ñ—Ç–µ–π**: –¶–µ –∑–≤–∏—á–∞–π–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –æ–¥–Ω–æ–≥–æ –ª—ñ—Å—É, –¥–µ –¥–∏—Ç—è—á–∏–π –¥–æ–º–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–∞—î –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—é —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—É –¥–æ–≤—ñ—Ä—É –∑ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–º –¥–æ–º–µ–Ω–æ–º. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–∞–ø–∏—Ç–∏ –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –º–æ–∂—É—Ç—å –±–µ–∑–ø–µ—Ä–µ—à–∫–æ–¥–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –º—ñ–∂ –±–∞—Ç—å–∫–æ–º —ñ –¥–∏—Ç–∏–Ω–æ—é.
* **–ü–µ—Ä–µ—Ö—Ä–µ—Å–Ω—ñ –î–æ–≤—ñ—Ä–∏**: –í—ñ–¥–æ–º—ñ —è–∫ "—Å–∫–æ—Ä–æ—á–µ–Ω—ñ –¥–æ–≤—ñ—Ä–∏", –≤–æ–Ω–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –º—ñ–∂ –¥–∏—Ç—è—á–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ –¥–ª—è –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—ñ–≤ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. –£ —Å–∫–ª–∞–¥–Ω–∏—Ö –ª—ñ—Å–∞—Ö –∑–∞–ø–∏—Ç–∏ –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∑–∞–∑–≤–∏—á–∞–π –ø–æ–≤–∏–Ω–Ω—ñ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –¥–æ –∫–æ—Ä–µ–Ω—è –ª—ñ—Å—É, –∞ –ø–æ—Ç—ñ–º –≤–Ω–∏–∑ –¥–æ —Ü—ñ–ª—å–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω—É. –°—Ç–≤–æ—Ä—é—é—á–∏ –ø–µ—Ä–µ—Ö—Ä–µ—Å–Ω—ñ –∑–≤'—è–∑–∫–∏, –ø–æ–¥–æ—Ä–æ–∂ —Å–∫–æ—Ä–æ—á—É—î—Ç—å—Å—è, —â–æ –æ—Å–æ–±–ª–∏–≤–æ –∫–æ—Ä–∏—Å–Ω–æ –≤ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö.
* **–ó–æ–≤–Ω—ñ—à–Ω—ñ –î–æ–≤—ñ—Ä–∏**: –í–æ–Ω–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏, –Ω–µ –ø–æ–≤'—è–∑–∞–Ω–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ —ñ –∑–∞ —Å–≤–æ—î—é –ø—Ä–∏—Ä–æ–¥–æ—é —î –Ω–µ—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∏–º–∏. –ó–≥—ñ–¥–Ω–æ –∑ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é Microsoft](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx), –∑–æ–≤–Ω—ñ—à–Ω—ñ –¥–æ–≤—ñ—Ä–∏ –∫–æ—Ä–∏—Å–Ω—ñ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ —É –¥–æ–º–µ–Ω—ñ –ø–æ–∑–∞ –ø–æ—Ç–æ—á–Ω–∏–º –ª—ñ—Å–æ–º, —è–∫–∏–π –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ –¥–æ–≤—ñ—Ä—É –ª—ñ—Å—É. –ë–µ–∑–ø–µ–∫–∞ –ø–æ—Å–∏–ª—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é SID –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ –¥–æ–≤—ñ—Ä–∞–º–∏.
* **–î–æ–≤—ñ—Ä–∏ –ö–æ—Ä–µ–Ω—è –î–µ—Ä–µ–≤–∞**: –¶—ñ –¥–æ–≤—ñ—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –º—ñ–∂ –∫–æ—Ä–µ–Ω–µ–≤–∏–º –¥–æ–º–µ–Ω–æ–º –ª—ñ—Å—É —Ç–∞ –Ω–æ–≤–æ–¥–æ–¥–∞–Ω–∏–º –∫–æ—Ä–µ–Ω–µ–º –¥–µ—Ä–µ–≤–∞. –•–æ—á–∞ —ó—Ö –Ω–µ —á–∞—Å—Ç–æ –∑—É—Å—Ç—Ä—ñ—á–∞—é—Ç—å, –¥–æ–≤—ñ—Ä–∏ –∫–æ—Ä–µ–Ω—è –¥–µ—Ä–µ–≤–∞ –≤–∞–∂–ª–∏–≤—ñ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–æ–º–µ–Ω–Ω–∏—Ö –¥–µ—Ä–µ–≤ –¥–æ –ª—ñ—Å—É, –¥–æ–∑–≤–æ–ª—è—é—á–∏ —ó–º –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –¥–æ–º–µ–Ω—É —Ç–∞ –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—é —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ñ—Å—Ç—å. –ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ [–ø–æ—Å—ñ–±–Ω–∏–∫—É Microsoft](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx).
* **–î–æ–≤—ñ—Ä–∏ –õ—ñ—Å—É**: –¶–µ–π —Ç–∏–ø –¥–æ–≤—ñ—Ä–∏ —î –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—é —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–æ—é –¥–æ–≤—ñ—Ä–æ—é –º—ñ–∂ –¥–≤–æ–º–∞ –∫–æ—Ä–µ–Ω–µ–≤–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ –ª—ñ—Å—É, —Ç–∞–∫–æ–∂ –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é SID –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –∑–∞—Ö–æ–¥—ñ–≤ –±–µ–∑–ø–µ–∫–∏.
* **–î–æ–≤—ñ—Ä–∏ MIT**: –¶—ñ –¥–æ–≤—ñ—Ä–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∑ –Ω–µ-Windows, [RFC4120-—Å—É–º—ñ—Å–Ω–∏–º–∏](https://tools.ietf.org/html/rfc4120) –¥–æ–º–µ–Ω–∞–º–∏ Kerberos. –î–æ–≤—ñ—Ä–∏ MIT —î –¥–µ—â–æ –±—ñ–ª—å—à —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º–∏ —ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è —Å–µ—Ä–µ–¥–æ–≤–∏—â, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ —Å–∏—Å—Ç–µ–º–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ Kerberos –ø–æ–∑–∞ –µ–∫–æ—Å–∏—Å—Ç–µ–º–æ—é Windows.

#### –Ü–Ω—à—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤ **–¥–æ–≤—ñ—Ä—á–∏—Ö –≤—ñ–¥–Ω–æ—Å–∏–Ω–∞—Ö**

* –î–æ–≤—ñ—Ä—á—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ç–∞–∫–æ–∂ **—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∏–º–∏** (A –¥–æ–≤—ñ—Ä—è—î B, B –¥–æ–≤—ñ—Ä—è—î C, —Ç–æ–¥—ñ A –¥–æ–≤—ñ—Ä—è—î C) –∞–±–æ **–Ω–µ—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∏–º–∏**.
* –î–æ–≤—ñ—Ä—á—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —è–∫ **–¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è –¥–æ–≤—ñ—Ä–∞** (–æ–±–∏–¥–≤–∞ –¥–æ–≤—ñ—Ä—è—é—Ç—å –æ–¥–∏–Ω –æ–¥–Ω–æ–º—É) –∞–±–æ —è–∫ **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è –¥–æ–≤—ñ—Ä–∞** (–ª–∏—à–µ –æ–¥–∏–Ω –∑ –Ω–∏—Ö –¥–æ–≤—ñ—Ä—è—î —ñ–Ω—à–æ–º—É).

### –®–ª—è—Ö –ê—Ç–∞–∫–∏

1. **–ü–µ—Ä–µ–ª—ñ—á–∏—Ç–∏** –¥–æ–≤—ñ—Ä—á—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –º–∞—î –±—É–¥—å-—è–∫–∏–π **—Å—É–±'—î–∫—Ç –±–µ–∑–ø–µ–∫–∏** (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á/–≥—Ä—É–ø–∞/–∫–æ–º–ø'—é—Ç–µ—Ä) **–¥–æ—Å—Ç—É–ø** –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ **—ñ–Ω—à–æ–≥–æ –¥–æ–º–µ–Ω—É**, –º–æ–∂–ª–∏–≤–æ, —á–µ—Ä–µ–∑ –∑–∞–ø–∏—Å–∏ ACE –∞–±–æ —á–µ—Ä–µ–∑ —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –≥—Ä—É–ø–∞—Ö —ñ–Ω—à–æ–≥–æ –¥–æ–º–µ–Ω—É. –®—É–∫–∞–π—Ç–µ **–≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ –º—ñ–∂ –¥–æ–º–µ–Ω–∞–º–∏** (–¥–æ–≤—ñ—Ä–∞ –±—É–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –¥–ª—è —Ü—å–æ–≥–æ, –Ω–∞–ø–µ–≤–Ω–æ).
1. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É kerberoast –º–æ–∂–µ –±—É—Ç–∏ —â–µ –æ–¥–Ω–∏–º –≤–∞—Ä—ñ–∞–Ω—Ç–æ–º.
3. **–°–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏** **–æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏**, —è–∫—ñ –º–æ–∂—É—Ç—å **–ø–µ—Ä–µ–º—ñ—â–∞—Ç–∏—Å—è** –º—ñ–∂ –¥–æ–º–µ–Ω–∞–º–∏.

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –≤ —ñ–Ω—à–æ–º—É –¥–æ–º–µ–Ω—ñ —á–µ—Ä–µ–∑ —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏:

* **–ß–ª–µ–Ω—Å—Ç–≤–æ –≤ –õ–æ–∫–∞–ª—å–Ω–∏—Ö –ì—Ä—É–ø–∞—Ö**: –°—É–±'—î–∫—Ç–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ–¥–∞–Ω—ñ –¥–æ –ª–æ–∫–∞–ª—å–Ω–∏—Ö –≥—Ä—É–ø –Ω–∞ –º–∞—à–∏–Ω–∞—Ö, —Ç–∞–∫–∏—Ö —è–∫ –≥—Ä—É–ø–∞ "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏" –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ, —â–æ –Ω–∞–¥–∞—î —ó–º –∑–Ω–∞—á–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ü—ñ—î—é –º–∞—à–∏–Ω–æ—é.
* **–ß–ª–µ–Ω—Å—Ç–≤–æ –≤ –ì—Ä—É–ø–∞—Ö –ó–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –î–æ–º–µ–Ω—É**: –°—É–±'—î–∫—Ç–∏ —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —á–ª–µ–Ω–∞–º–∏ –≥—Ä—É–ø —É –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É –¥–æ–º–µ–Ω—ñ. –û–¥–Ω–∞–∫ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ü—å–æ–≥–æ –º–µ—Ç–æ–¥—É –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø—Ä–∏—Ä–æ–¥–∏ –¥–æ–≤—ñ—Ä–∏ —Ç–∞ –æ–±—Å—è–≥—É –≥—Ä—É–ø–∏.
* **–°–ø–∏—Å–∫–∏ –ö–æ–Ω—Ç—Ä–æ–ª—é –î–æ—Å—Ç—É–ø—É (ACL)**: –°—É–±'—î–∫—Ç–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∫–∞–∑–∞–Ω—ñ –≤ **ACL**, –æ—Å–æ–±–ª–∏–≤–æ —è–∫ —Å—É—Ç–Ω–æ—Å—Ç—ñ –≤ **ACE** –≤ —Ä–∞–º–∫–∞—Ö **DACL**, –Ω–∞–¥–∞—é—á–∏ —ó–º –¥–æ—Å—Ç—É–ø –¥–æ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤. –î–ª—è —Ç–∏—Ö, —Ö—Ç–æ —Ö–æ—á–µ –≥–ª–∏–±—à–µ –∑–∞–Ω—É—Ä–∏—Ç–∏—Å—è –≤ –º–µ—Ö–∞–Ω—ñ–∫—É ACL, DACL —Ç–∞ ACE, –¥–æ–∫—É–º–µ–Ω—Ç –ø—ñ–¥ –Ω–∞–∑–≤–æ—é ‚Äú[An ACE Up The Sleeve](https://specterops.io/assets/resources/an\_ace\_up\_the\_sleeve.pdf)‚Äù —î –±–µ–∑—Ü—ñ–Ω–Ω–∏–º —Ä–µ—Å—É—Ä—Å–æ–º.

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ü—Ä–∏–≤—ñ–ª–µ—ó–≤ –∑ –î–∏—Ç–∏–Ω–∏ –¥–æ –ë–∞—Ç—å–∫–∞ –≤ –õ—ñ—Å—ñ
```
Get-DomainTrust

SourceName      : sub.domain.local    --> current domain
TargetName      : domain.local        --> foreign domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest
TrustDirection  : Bidirectional       --> Trust direction (2ways in this case)
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM
```
{% hint style="warning" %}
–Ñ **2 –¥–æ–≤—ñ—Ä–µ–Ω–∏—Ö –∫–ª—é—á—ñ**, –æ–¥–∏–Ω –¥–ª—è _–î–∏—Ç–∏–Ω–∞ --> –ë–∞—Ç—å–∫–æ_ —ñ —â–µ –æ–¥–∏–Ω –¥–ª—è _–ë–∞—Ç—å–∫–æ_ --> _–î–∏—Ç–∏–Ω–∞_.\
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–æ–π, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–æ—Ç–æ—á–Ω–∏–º –¥–æ–º–µ–Ω–æ–º, –∑:
```bash
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.my.domain.local
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\mcorp$"'
```
{% endhint %}

#### SID-History Injection

–ï—Å–∫–∞–ª–∞—Ü—ñ—è —è–∫ Enterprise admin –¥–æ –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ/–±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –¥–æ–º–µ–Ω—É, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –¥–æ–≤—ñ—Ä–æ—é –∑ —ñ–Ω'—î–∫—Ü—ñ—î—é SID-History:

{% content-ref url="sid-history-injection.md" %}
[sid-history-injection.md](sid-history-injection.md)
{% endcontent-ref %}

#### Exploit writeable Configuration NC

–†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ Configuration Naming Context (NC), —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º. Configuration NC —Å–ª—É–≥—É—î —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—î–º –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö —É –ª—ñ—Å—ñ –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö Active Directory (AD). –¶—ñ –¥–∞–Ω—ñ —Ä–µ–ø–ª—ñ–∫—É—é—Ç—å—Å—è –Ω–∞ –∫–æ–∂–µ–Ω Domain Controller (DC) —É –ª—ñ—Å—ñ, –ø—Ä–∏ —Ü—å–æ–º—É –∑–∞–ø–∏—Å—É–≤–∞–Ω—ñ DC –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å –∑–∞–ø–∏—Å—É–≤–∞–Ω—É –∫–æ–ø—ñ—é Configuration NC. –©–æ–± —Ü–µ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏, –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ **SYSTEM –ø—Ä–∏–≤—ñ–ª–µ—ó –Ω–∞ DC**, –±–∞–∂–∞–Ω–æ –Ω–∞ –¥–æ—á—ñ—Ä–Ω—å–æ–º—É DC.

**Link GPO to root DC site**

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Sites Configuration NC –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤—Å—ñ –∫–æ–º–ø'—é—Ç–µ—Ä–∏, –ø—Ä–∏—î–¥–Ω–∞–Ω—ñ –¥–æ –¥–æ–º–µ–Ω—É, —É –ª—ñ—Å—ñ AD. –ü—Ä–∞—Ü—é—é—á–∏ –∑ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ SYSTEM –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É DC, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –ø—Ä–∏–≤'—è–∑—É–≤–∞—Ç–∏ GPO –¥–æ –∫–æ—Ä–µ–Ω–µ–≤–∏—Ö —Å–∞–π—Ç—ñ–≤ DC. –¶—è –¥—ñ—è –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –∫–æ–º–ø—Ä–æ–º–µ—Ç—É—î –∫–æ—Ä–µ–Ω–µ–≤–∏–π –¥–æ–º–µ–Ω, –º–∞–Ω—ñ–ø—É–ª—é—é—á–∏ –ø–æ–ª—ñ—Ç–∏–∫–∞–º–∏, —è–∫—ñ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –¥–æ —Ü–∏—Ö —Å–∞–π—Ç—ñ–≤.

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –º–æ–∂–Ω–∞ –¥–æ—Å–ª—ñ–¥–∏—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –ø—Ä–æ [Bypassing SID Filtering](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research).

**Compromise any gMSA in the forest**

–í–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –Ω–∞—Ü—ñ–ª—é–≤–∞–Ω–Ω—è –Ω–∞ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ gMSA –≤ –¥–æ–º–µ–Ω—ñ. –ö–ª—é—á KDS Root, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ gMSA, –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ Configuration NC. –ú–∞—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó SYSTEM –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É DC, –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á–∞ KDS Root —ñ –æ–±—á–∏—Å–ª–∏—Ç–∏ –ø–∞—Ä–æ–ª—ñ –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ gMSA —É –ª—ñ—Å—ñ.

–î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—ñ [Golden gMSA Trust Attacks](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-5-golden-gmsa-trust-attack-from-child-to-parent).

**Schema change attack**

–¶–µ–π –º–µ—Ç–æ–¥ –≤–∏–º–∞–≥–∞—î —Ç–µ—Ä–ø—ñ–Ω–Ω—è, –æ—á—ñ–∫—É—é—á–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ AD. –ú–∞—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó SYSTEM, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ö–µ–º—É AD, —â–æ–± –Ω–∞–¥–∞—Ç–∏ –±—É–¥—å-—è–∫–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —É—Å—ñ–º–∞ –∫–ª–∞—Å–∞–º–∏. –¶–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–∏–º–∏ –æ–±'—î–∫—Ç–∞–º–∏ AD.

–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ [Schema Change Trust Attacks](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-6-schema-change-trust-attack-from-child-to-parent).

**From DA to EA with ADCS ESC5**

–£—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å ADCS ESC5 –Ω–∞—Ü—ñ–ª—é—î—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –æ–±'—î–∫—Ç–∞–º–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –∫–ª—é—á—ñ–≤ (PKI), —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —à–∞–±–ª–æ–Ω —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é —è–∫ –±—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É –ª—ñ—Å—ñ. –û—Å–∫—ñ–ª—å–∫–∏ –æ–±'—î–∫—Ç–∏ PKI –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ Configuration NC, –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—è –∑–∞–ø–∏—Å—É–≤–∞–Ω–æ–≥–æ –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ DC –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∞—Ç–∞–∫–∏ ESC5.

–ë—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ —Ü–µ –º–æ–∂–Ω–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤ [From DA to EA with ESC5](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c). –£ —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö, –¥–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π ADCS, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —è–∫ –æ–±–≥–æ–≤–æ—Ä—é—î—Ç—å—Å—è –≤ [Escalating from Child Domain Admins to Enterprise Admins](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/).

### External Forest Domain - One-Way (Inbound) or bidirectional
```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```
–£ —Ü—å–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó **–≤–∞—à –¥–æ–º–µ–Ω –¥–æ–≤—ñ—Ä–µ–Ω–∏–π** –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É, —â–æ –Ω–∞–¥–∞—î –≤–∞–º **–Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–æ–∑–≤–æ–ª–∏** –Ω–∞–¥ –Ω–∏–º. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑'—è—Å—É–≤–∞—Ç–∏, **—è–∫—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –≤–∞—à–æ–≥–æ –¥–æ–º–µ–Ω—É –º–∞—é—Ç—å —è–∫–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –¥–æ–º–µ–Ω—É** —ñ –ø–æ—Ç—ñ–º —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Ü–µ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏:

{% content-ref url="external-forest-domain-oneway-inbound.md" %}
[external-forest-domain-oneway-inbound.md](external-forest-domain-oneway-inbound.md)
{% endcontent-ref %}

### –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ª—ñ—Å–æ–≤–∏–π –¥–æ–º–µ–Ω - –æ–¥–Ω–æ—Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π (–≤–∏—Ö—ñ–¥–Ω–∏–π)
```powershell
Get-DomainTrust -Domain current.local

SourceName      : current.local   --> Current domain
TargetName      : external.local  --> Destination domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Outbound        --> Outbound trust
WhenCreated     : 2/19/2021 10:15:24 PM
WhenChanged     : 2/19/2021 10:15:24 PM
```
–£ —Ü—å–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó **–≤–∞—à –¥–æ–º–µ–Ω** **–¥–æ–≤—ñ—Ä—è—î** –¥–µ—è–∫–∏–º **–ø—Ä–∏–≤—ñ–ª–µ—è–º** –ø—Ä–∏–Ω—Ü–∏–ø—É –∑ **—ñ–Ω—à–∏—Ö –¥–æ–º–µ–Ω—ñ–≤**.

–û–¥–Ω–∞–∫, –∫–æ–ª–∏ **–¥–æ–º–µ–Ω –¥–æ–≤—ñ—Ä—è—î—Ç—å—Å—è** –¥–æ–≤—ñ—Ä–µ–Ω–∏–º –¥–æ–º–µ–Ω–æ–º, –¥–æ–≤—ñ—Ä–µ–Ω–∏–π –¥–æ–º–µ–Ω **—Å—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –∑ **–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º —ñ–º'—è–º**, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–¥–æ–≤—ñ—Ä–µ–Ω–∏–π –ø–∞—Ä–æ–ª—å**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –º–æ–∂–ª–∏–≤–æ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É, —â–æ–± –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—É –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ** –¥–ª—è –π–æ–≥–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —Ç–∞ —Å–ø—Ä–æ–±–∏ –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –±—ñ–ª—å—à–µ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:

{% content-ref url="external-forest-domain-one-way-outbound.md" %}
[external-forest-domain-one-way-outbound.md](external-forest-domain-one-way-outbound.md)
{% endcontent-ref %}

–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –¥–æ–≤—ñ—Ä–µ–Ω–∏–π –¥–æ–º–µ–Ω - —Ü–µ –∑–Ω–∞–π—Ç–∏ [**SQL –¥–æ–≤—ñ—Ä–µ–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è**](abusing-ad-mssql.md#mssql-trusted-links), —Å—Ç–≤–æ—Ä–µ–Ω–µ –≤ **–ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É** –¥–æ–≤—ñ—Ä–µ–Ω–æ—Å—Ç—ñ –¥–æ–º–µ–Ω—É (—â–æ –Ω–µ —î –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–∏–º).

–©–µ –æ–¥–∏–Ω —Å–ø–æ—Å—ñ–± —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –¥–æ–≤—ñ—Ä–µ–Ω–∏–π –¥–æ–º–µ–Ω - —Ü–µ —á–µ–∫–∞—Ç–∏ –Ω–∞ –º–∞—à–∏–Ω—ñ, –¥–æ —è–∫–æ—ó **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø** –¥–ª—è –≤—Ö–æ–¥—É —á–µ—Ä–µ–∑ **RDP**. –¢–æ–¥—ñ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –∫–æ–¥ —É –ø—Ä–æ—Ü–µ—Å —Å–µ—Å—ñ—ó RDP —ñ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω—É –∂–µ—Ä—Ç–≤–∏** –∑–≤—ñ–¥—Ç–∏.\
–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ **–∂–µ—Ä—Ç–≤–∞ –∑–º–æ–Ω—Ç—É–≤–∞–ª–∞ —Å–≤—ñ–π –∂–æ—Ä—Å—Ç–∫–∏–π –¥–∏—Å–∫**, –∑ –ø—Ä–æ—Ü–µ—Å—É **—Å–µ—Å—ñ—ó RDP** –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ **–±–µ–∫–¥–æ—Ä–∏** –≤ **–ø–∞–ø—Ü—ñ –∞–≤—Ç–æ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∂–æ—Ä—Å—Ç–∫–æ–≥–æ –¥–∏—Å–∫–∞**. –¶—é —Ç–µ—Ö–Ω—ñ–∫—É –Ω–∞–∑–∏–≤–∞—é—Ç—å **RDPInception.**

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### –ó–º–µ–Ω—à–µ–Ω–Ω—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω—å –¥–æ–≤—ñ—Ä–æ—é –¥–æ–º–µ–Ω—É

### **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è SID:**

* –†–∏–∑–∏–∫ –∞—Ç–∞–∫, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∞—Ç—Ä–∏–±—É—Ç —ñ—Å—Ç–æ—Ä—ñ—ó SID —á–µ—Ä–µ–∑ –¥–æ–≤—ñ—Ä–∏ –ª—ñ—Å—É, –∑–º–µ–Ω—à—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó SID, —è–∫–∞ –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–∞ –≤—Å—ñ—Ö –º—ñ–∂–ª—ñ—Å–æ–≤–∏—Ö –¥–æ–≤—ñ—Ä–∞—Ö. –¶–µ –ø—ñ–¥–∫—Ä—ñ–ø–ª—é—î—Ç—å—Å—è –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è–º, —â–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –¥–æ–≤—ñ—Ä–∏ –ª—ñ—Å—É —î –±–µ–∑–ø–µ—á–Ω–∏–º–∏, –≤–≤–∞–∂–∞—é—á–∏ –ª—ñ—Å, –∞ –Ω–µ –¥–æ–º–µ–Ω, —è–∫ –º–µ–∂—É –±–µ–∑–ø–µ–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –ø–æ–∑–∏—Ü—ñ—ó Microsoft.
* –û–¥–Ω–∞–∫ —î –ø—ñ–¥–≤–æ–¥–Ω–∏–π –∫–∞–º—ñ–Ω—å: —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è SID –º–æ–∂–µ –ø–æ—Ä—É—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –¥–æ–¥–∞—Ç–∫—ñ–≤ —ñ –¥–æ—Å—Ç—É–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —ó—ó –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ–≥–æ –¥–µ–∞–∫—Ç–∏–≤—É–≤–∞–Ω–Ω—è.

### **–í–∏–±—ñ—Ä–∫–æ–≤–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:**

* –î–ª—è –º—ñ–∂–ª—ñ—Å–æ–≤–∏—Ö –¥–æ–≤—ñ—Ä—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–∏–±—ñ—Ä–∫–æ–≤–æ—ó –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –¥–≤–æ—Ö –ª—ñ—Å—ñ–≤ –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ù–∞—Ç–æ–º—ñ—Å—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–æ–º–µ–Ω—ñ–≤ —ñ —Å–µ—Ä–≤–µ—Ä—ñ–≤ —É –¥–æ–≤—ñ—Ä–µ–Ω–æ–º—É –¥–æ–º–µ–Ω—ñ –∞–±–æ –ª—ñ—Å—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —è–≤–Ω—ñ –¥–æ–∑–≤–æ–ª–∏.
* –í–∞–∂–ª–∏–≤–æ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ —Ü—ñ –∑–∞—Ö–æ–¥–∏ –Ω–µ –∑–∞—Ö–∏—â–∞—é—Ç—å –≤—ñ–¥ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –∑–∞–ø–∏—Å—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —â–æ –ø—ñ–¥–ª—è–≥–∞—î –∑–∞–ø–∏—Å—É (NC), –∞–±–æ –∞—Ç–∞–∫ –Ω–∞ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –¥–æ–≤—ñ—Ä–∏.

[**–ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –¥–æ–≤—ñ—Ä–∏ –¥–æ–º–µ–Ω—ñ–≤ –Ω–∞ ired.team.**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

## AD -> Azure & Azure -> AD

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movements/azure-ad-connect-hybrid-identity" %}

## –î–µ—è–∫—ñ –∑–∞–≥–∞–ª—å–Ω—ñ –∑–∞—Ö–æ–¥–∏ –∑–∞—Ö–∏—Å—Ç—É

[**–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ —Ç–µ, —è–∫ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ç—É—Ç.**](../stealing-credentials/credentials-protections.md)\\

### **–ó–∞—Ö–æ–¥–∏ –∑–∞—Ö–∏—Å—Ç—É –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö**

* **–û–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –¥–æ–º–µ–Ω—É**: –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è, —â–æ–± –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –¥–æ–º–µ–Ω—É –¥–æ–∑–≤–æ–ª—è–ª–æ—Å—è –≤—Ö–æ–¥–∏—Ç–∏ –ª–∏—à–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –¥–æ–º–µ–Ω—É, —É–Ω–∏–∫–∞—é—á–∏ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à–∏—Ö —Ö–æ—Å—Ç–∞—Ö.
* **–ü—Ä–∏–≤—ñ–ª–µ—ó –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–±**: –°–ª—É–∂–±–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω—É (DA) –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –±–µ–∑–ø–µ–∫–∏.
* **–û–±–º–µ–∂–µ–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**: –î–ª—è –∑–∞–≤–¥–∞–Ω—å, —â–æ –≤–∏–º–∞–≥–∞—é—Ç—å –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ DA, —ó—Ö —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –æ–±–º–µ–∂–µ–Ω–∞. –¶–µ –º–æ–∂–Ω–∞ –¥–æ—Å—è–≥—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `Add-ADGroupMember -Identity ‚ÄòDomain Admins‚Äô -Members newDA -MemberTimeToLive (New-TimeSpan -Minutes 20)`

### **–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —Ç–µ—Ö–Ω—ñ–∫ –æ–±–º–∞–Ω—É**

* –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –æ–±–º–∞–Ω—É –ø–µ—Ä–µ–¥–±–∞—á–∞—î –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Å—Ç–æ–∫, —Ç–∞–∫–∏—Ö —è–∫ –ø—Ä–∏–º–∞–Ω–∫–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∞–±–æ –∫–æ–º–ø'—é—Ç–µ—Ä–∏, –∑ —Ç–∞–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏, —è–∫ –ø–∞—Ä–æ–ª—ñ, —è–∫—ñ –Ω–µ –∑–∞–∫—ñ–Ω—á—É—é—Ç—å—Å—è –∞–±–æ –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ –¥–æ–≤—ñ—Ä–µ–Ω—ñ –¥–ª—è –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è. –î–µ—Ç–∞–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –≤–∫–ª—é—á–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –ø–µ–≤–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –∞–±–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —ó—Ö –¥–æ –≥—Ä—É–ø –∑ –≤–∏—Å–æ–∫–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏.
* –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≤–∫–ª—é—á–∞—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫: `Create-DecoyUser -UserFirstName user -UserLastName manager-uncommon -Password Pass@123 | DeployUserDeception -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose`
* –ë—ñ–ª—å—à–µ –ø—Ä–æ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —Ç–µ—Ö–Ω—ñ–∫ –æ–±–º–∞–Ω—É –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ [Deploy-Deception –Ω–∞ GitHub](https://github.com/samratashok/Deploy-Deception).

### **–í–∏—è–≤–ª–µ–Ω–Ω—è –æ–±–º–∞–Ω—É**

* **–î–ª—è –æ–±'—î–∫—Ç—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**: –ü—ñ–¥–æ–∑—Ä—ñ–ª—ñ –æ–∑–Ω–∞–∫–∏ –≤–∫–ª—é—á–∞—é—Ç—å –Ω–µ—Ç–∏–ø–æ–≤–∏–π ObjectSID, —Ä—ñ–¥–∫—ñ—Å–Ω—ñ –≤—Ö–æ–¥–∏, –¥–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –Ω–∏–∑—å–∫—ñ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –ø–∞—Ä–æ–ª—ñ–≤.
* **–ó–∞–≥–∞–ª—å–Ω—ñ –æ–∑–Ω–∞–∫–∏**: –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –ø—Ä–∏–º–∞–Ω–∫–æ–≤–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –∑ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ—Ö –º–æ–∂–µ –≤–∏—è–≤–∏—Ç–∏ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ [HoneypotBuster](https://github.com/JavelinNetworks/HoneypotBuster), –º–æ–∂—É—Ç—å –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞–∫–∏—Ö –æ–±–º–∞–Ω—ñ–≤.

### **–û–±—Ö—ñ–¥ —Å–∏—Å—Ç–µ–º –≤–∏—è–≤–ª–µ–Ω–Ω—è**

* **–û–±—Ö—ñ–¥ –≤–∏—è–≤–ª–µ–Ω–Ω—è Microsoft ATA**:
* **–ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**: –£–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —Å–µ—Å—ñ–π –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞—Ö –¥–æ–º–µ–Ω—É, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—é ATA.
* **–Ü–º—ñ—Ç–∞—Ü—ñ—è –∫–≤–∏—Ç–∫—ñ–≤**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **aes** –∫–ª—é—á—ñ–≤ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–≤–∏—Ç–∫—ñ–≤ –¥–æ–ø–æ–º–∞–≥–∞—î —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è, –Ω–µ –∑–Ω–∏–∂—É—é—á–∏ –¥–æ NTLM.
* **–ê—Ç–∞–∫–∏ DCSync**: –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑ –Ω–µ-–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –¥–æ–º–µ–Ω—É, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è ATA, –æ—Å–∫—ñ–ª—å–∫–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –¥–æ–º–µ–Ω—É –≤–∏–∫–ª–∏—á–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/](http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/)
* [https://www.labofapenetrationtester.com/2018/10/deploy-deception.html](https://www.labofapenetrationtester.com/2018/10/deploy-deception.html)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
