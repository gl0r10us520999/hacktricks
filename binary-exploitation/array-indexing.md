# Indexa√ß√£o de Arrays

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

Esta categoria inclui todas as vulnerabilidades que ocorrem porque √© poss√≠vel sobrescrever certos dados atrav√©s de erros no tratamento de √≠ndices em arrays. √â uma categoria muito ampla sem uma metodologia espec√≠fica, pois o mecanismo de explora√ß√£o depende completamente das condi√ß√µes da vulnerabilidade.

No entanto, aqui voc√™ pode encontrar alguns bons **exemplos**:

* [https://guyinatuxedo.github.io/11-index/swampctf19\_dreamheaps/index.html](https://guyinatuxedo.github.io/11-index/swampctf19\_dreamheaps/index.html)
* Existem **2 arrays colidindo**, um para **endere√ßos** onde os dados s√£o armazenados e outro com os **tamanhos** desses dados. √â poss√≠vel sobrescrever um a partir do outro, permitindo escrever um endere√ßo arbitr√°rio indicando-o como um tamanho. Isso permite escrever o endere√ßo da fun√ß√£o `free` na tabela GOT e ent√£o sobrescrev√™-lo com o endere√ßo para `system`, e chamar free a partir de uma mem√≥ria com `/bin/sh`.
* [https://guyinatuxedo.github.io/11-index/csaw18\_doubletrouble/index.html](https://guyinatuxedo.github.io/11-index/csaw18\_doubletrouble/index.html)
* 64 bits, sem nx. Sobrescreva um tamanho para obter uma esp√©cie de estouro de buffer onde tudo ser√° usado como um n√∫mero duplo e ordenado do menor para o maior, ent√£o √© necess√°rio criar um shellcode que atenda a esse requisito, levando em considera√ß√£o que o can√°rio n√£o deve ser movido de sua posi√ß√£o e finalmente sobrescrevendo o RIP com um endere√ßo para ret, que atenda aos requisitos anteriores e colocando o maior endere√ßo um novo endere√ßo apontando para o in√≠cio da pilha (vazado pelo programa) para que seja poss√≠vel usar o ret para pular para l√°.
* [https://faraz.faith/2019-10-20-secconctf-2019-sum/](https://faraz.faith/2019-10-20-secconctf-2019-sum/)
* 64 bits, sem relro, canary, nx, sem pie. H√° um off-by-one em um array na pilha que permite controlar um ponteiro concedendo WWW (ele escreve a soma de todos os n√∫meros do array no endere√ßo sobrescrito pelo off-by-one no array). A pilha √© controlada para que o endere√ßo `exit` da GOT seja sobrescrito com `pop rdi; ret`, e na pilha √© adicionado o endere√ßo para `main` (voltando para `main`). Uma cadeia ROP para vazar o endere√ßo colocado na GOT usando puts √© usada (`exit` ser√° chamado ent√£o chamar√° `pop rdi; ret` executando assim essa cadeia na pilha). Finalmente, uma nova cadeia ROP executando ret2lib √© usada.
* [https://guyinatuxedo.github.io/14-ret\_2\_system/tu\_guestbook/index.html](https://guyinatuxedo.github.io/14-ret\_2\_system/tu\_guestbook/index.html)
* 32 bits, sem relro, sem canary, nx, pie. Abusa de uma indexa√ß√£o ruim para vazar endere√ßos de libc e heap da pilha. Abusa do estouro de buffer para fazer um ret2lib chamando `system('/bin/sh')` (o endere√ßo do heap √© necess√°rio para contornar uma verifica√ß√£o).
