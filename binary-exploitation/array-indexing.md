# Indexaci칩n de Arrays

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informaci칩n B치sica

Esta categor칤a incluye todas las vulnerabilidades que ocurren porque es posible sobrescribir ciertos datos a trav칠s de errores en el manejo de 칤ndices en arrays. Es una categor칤a muy amplia sin una metodolog칤a espec칤fica, ya que el mecanismo de explotaci칩n depende completamente de las condiciones de la vulnerabilidad.

Sin embargo, aqu칤 puedes encontrar algunos **ejemplos** interesantes:

* [https://guyinatuxedo.github.io/11-index/swampctf19\_dreamheaps/index.html](https://guyinatuxedo.github.io/11-index/swampctf19\_dreamheaps/index.html)
* Hay **2 arrays colisionando**, uno para las **direcciones** donde se almacenan los datos y otro con los **tama침os** de esos datos. Es posible sobrescribir uno desde el otro, permitiendo escribir una direcci칩n arbitraria indic치ndola como un tama침o. Esto permite escribir la direcci칩n de la funci칩n `free` en la tabla GOT y luego sobrescribirla con la direcci칩n de `system`, y llamar a free desde una memoria con `/bin/sh`.
* [https://guyinatuxedo.github.io/11-index/csaw18\_doubletrouble/index.html](https://guyinatuxedo.github.io/11-index/csaw18\_doubletrouble/index.html)
* 64 bits, sin nx. Sobrescribe un tama침o para obtener una especie de desbordamiento de b칰fer donde todo va a ser utilizado como un n칰mero doble y ordenado de menor a mayor, por lo que es necesario crear un shellcode que cumpla con ese requisito, teniendo en cuenta que el canary no debe ser movido de su posici칩n y finalmente sobrescribir el RIP con una direcci칩n a ret, que cumpla con los requisitos anteriores y colocando la mayor direcci칩n una nueva direcci칩n apuntando al inicio del stack (filtrada por el programa) para que sea posible usar el ret para saltar all칤.
* [https://faraz.faith/2019-10-20-secconctf-2019-sum/](https://faraz.faith/2019-10-20-secconctf-2019-sum/)
* 64 bits, sin relro, canary, nx, sin pie. Hay un off-by-one en un array en la pila que permite controlar un puntero otorgando WWW (escribe la suma de todos los n칰meros del array en la direcci칩n sobrescrita por el off-by-one en el array). La pila est치 controlada, por lo que la direcci칩n `exit` de la GOT es sobrescrita con `pop rdi; ret`, y en la pila se agrega la direcci칩n a `main` (volviendo a `main`). Se utiliza una cadena ROP para filtrar la direcci칩n de put en la GOT usando puts (`exit` ser치 llamado, por lo que llamar치 a `pop rdi; ret` ejecutando as칤 esta cadena en la pila). Finalmente se utiliza una nueva cadena ROP ejecutando ret2lib.
* [https://guyinatuxedo.github.io/14-ret\_2\_system/tu\_guestbook/index.html](https://guyinatuxedo.github.io/14-ret\_2\_system/tu\_guestbook/index.html)
* 32 bits, sin relro, sin canary, nx, pie. Abusa de un mal indexado para filtrar direcciones de libc y heap desde la pila. Abusa del desbordamiento de b칰fer para hacer un ret2lib llamando a `system('/bin/sh')` (se necesita la direcci칩n del heap para evitar una comprobaci칩n).
