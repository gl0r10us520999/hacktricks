# Grundlegende Methodik der Bin√§rausnutzung

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## ELF Grundinformationen

Bevor Sie mit der Ausnutzung von irgendetwas beginnen, ist es interessant, einen Teil der Struktur einer **ELF-Bin√§rdatei** zu verstehen:

{% content-ref url="elf-tricks.md" %}
[elf-tricks.md](elf-tricks.md)
{% endcontent-ref %}

## Ausnutzungswerkzeuge

{% content-ref url="tools/" %}
[tools](tools/)
{% endcontent-ref %}

## Stack Overflow Methodik

Bei so vielen Techniken ist es gut, ein Schema zu haben, wann jede Technik n√ºtzlich sein wird. Beachten Sie, dass die gleichen Schutzma√ünahmen verschiedene Techniken beeinflussen werden. Sie k√∂nnen M√∂glichkeiten finden, die Schutzma√ünahmen in jedem Schutzabschnitt zu umgehen, jedoch nicht in dieser Methodik.

## Steuerung des Flusses

Es gibt verschiedene M√∂glichkeiten, wie Sie den Fluss eines Programms steuern k√∂nnten:

* [**Stack Overflows**](../stack-overflow/) √ºberschreiben den R√ºckgabepointer vom Stack oder den EBP -> ESP -> EIP.
* M√∂glicherweise m√ºssen Sie einen [**Integer Overflow**](../integer-overflow.md) ausnutzen, um den Overflow zu verursachen.
* Oder √ºber **Arbitrary Writes + Write What Where to Execution**.
* [**Format-Strings**](../format-strings/)**:** Missbrauch von `printf`, um beliebige Inhalte an beliebige Adressen zu schreiben.
* [**Array-Indizierung**](../array-indexing.md): Missbrauch einer schlecht gestalteten Indizierung, um einige Arrays zu steuern und einen beliebigen Schreibzugriff zu erhalten.
* M√∂glicherweise m√ºssen Sie einen [**Integer Overflow**](../integer-overflow.md) ausnutzen, um den Overflow zu verursachen.
* **bof zu WWW √ºber ROP**: Missbrauch eines Buffer Overflows, um einen ROP zu konstruieren und in der Lage zu sein, ein WWW zu erhalten.

Sie finden die **Write What Where to Execution** Techniken in:

{% content-ref url="../arbitrary-write-2-exec/" %}
[arbitrary-write-2-exec](../arbitrary-write-2-exec/)
{% endcontent-ref %}

## Ewige Schleifen

Etwas, das zu ber√ºcksichtigen ist, ist, dass normalerweise **nur eine Ausnutzung einer Schwachstelle m√∂glicherweise nicht ausreicht**, um einen erfolgreichen Exploit auszuf√ºhren, insbesondere m√ºssen einige Schutzma√ünahmen umgangen werden. Daher ist es interessant, einige Optionen zu diskutieren, um **eine einzelne Schwachstelle mehrmals in derselben Ausf√ºhrung der Bin√§rdatei ausnutzbar zu machen**:

* Schreiben Sie in eine **ROP**-Kette die Adresse der **`main`-Funktion** oder die Adresse, an der die **Schwachstelle** auftritt.
* Durch die Kontrolle einer ordnungsgem√§√üen ROP-Kette k√∂nnten Sie in der Lage sein, alle Aktionen in dieser Kette auszuf√ºhren.
* Schreiben Sie in die **`exit`-Adresse in GOT** (oder eine andere Funktion, die von der Bin√§rdatei vor dem Ende verwendet wird) die Adresse, um **zur Schwachstelle zur√ºckzukehren**.
* Wie in [**.fini\_array**](../arbitrary-write-2-exec/www2exec-.dtors-and-.fini\_array.md#eternal-loop)**,** speichern Sie hier 2 Funktionen, eine um die Schwachstelle erneut aufzurufen und eine andere um **`__libc_csu_fini`** aufzurufen, die die Funktion aus `.fini_array` erneut aufruft.

## Ausnutzungsziele

### Ziel: Eine vorhandene Funktion aufrufen

* [**ret2win**](./#ret2win): Es gibt eine Funktion im Code, die Sie aufrufen m√ºssen (vielleicht mit einigen spezifischen Parametern), um das Flag zu erhalten.
* In einem **regul√§ren bof ohne** [**PIE**](../common-binary-protections-and-bypasses/pie/) **und** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) m√ºssen Sie nur die Adresse in die R√ºckgabeadresse, die im Stack gespeichert ist, schreiben.
* In einem bof mit [**PIE**](../common-binary-protections-and-bypasses/pie/) m√ºssen Sie es umgehen.
* In einem bof mit [**canary**](../common-binary-protections-and-bypasses/stack-canaries/) m√ºssen Sie es umgehen.
* Wenn Sie mehrere Parameter setzen m√ºssen, um die **ret2win**-Funktion korrekt aufzurufen, k√∂nnen Sie verwenden:
* Eine [**ROP**](./#rop-and-ret2...-techniques) **Kette, wenn gen√ºgend Gadgets vorhanden sind**, um alle Parameter vorzubereiten.
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/) (falls Sie diesen Syscall aufrufen k√∂nnen), um viele Register zu steuern.
* Gadgets von [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) und [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md), um mehrere Register zu steuern.
* √úber einen [**Write What Where**](../arbitrary-write-2-exec/) k√∂nnten Sie andere Schwachstellen (nicht bof) ausnutzen, um die **`win`**-Funktion aufzurufen.
* [**Pointer-Redirecting**](../stack-overflow/pointer-redirecting.md): Falls der Stack Zeiger auf eine Funktion enth√§lt, die aufgerufen werden soll, oder auf einen String, der von einer interessanten Funktion (system oder printf) verwendet werden soll, ist es m√∂glich, diese Adresse zu √ºberschreiben.
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) oder [**PIE**](../common-binary-protections-and-bypasses/pie/) k√∂nnten die Adressen beeinflussen.
* [**Uninitialisierte Variablen**](../stack-overflow/uninitialized-variables.md): Man wei√ü nie.

### Ziel: RCE

#### √úber Shellcode, wenn nx deaktiviert oder Shellcode mit ROP gemischt:

* [**(Stack) Shellcode**](./#stack-shellcode): Dies ist n√ºtzlich, um einen Shellcode im Stack zu speichern, bevor oder nachdem der R√ºckgabepointer √ºberschrieben wurde, und dann **dorthin zu springen**, um ihn auszuf√ºhren:
* **In jedem Fall, wenn es einen** [**canary**](../common-binary-protections-and-bypasses/stack-canaries/)**,** m√ºssen Sie in einem regul√§ren bof (leak) ihn umgehen.
* **Ohne** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **und** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) ist es m√∂glich, zur Adresse des Stacks zu springen, da sie sich niemals √§ndern wird.
* **Mit** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) m√ºssen Sie Techniken wie [**ret2esp/ret2reg**](../rop-return-oriented-programing/ret2esp-ret2reg.md) verwenden, um dorthin zu springen.
* **Mit** [**nx**](../common-binary-protections-and-bypasses/no-exec-nx.md) m√ºssen Sie einige [**ROP**](../rop-return-oriented-programing/) verwenden, **um `memprotect` aufzurufen** und eine Seite `rwx` zu machen, um dann **den Shellcode dort zu speichern** (zum Beispiel durch Aufruf von read) und dann dorthin zu springen.
* Dies wird Shellcode mit einer ROP-Kette mischen.

#### √úber Syscalls

* [**Ret2syscall**](../rop-return-oriented-programing/rop-syscall-execv/): N√ºtzlich, um `execve` aufzurufen, um beliebige Befehle auszuf√ºhren. Sie m√ºssen in der Lage sein, die **Gadgets zu finden, um den spezifischen Syscall mit den Parametern** aufzurufen.
* Wenn [**ASLR**](../common-binary-protections-and-bypasses/aslr/) oder [**PIE**](../common-binary-protections-and-bypasses/pie/) aktiviert sind, m√ºssen Sie sie **umgehen, um ROP-Gadgets** aus der Bin√§rdatei oder Bibliotheken zu verwenden.
* [**SROP**](../rop-return-oriented-programing/srop-sigreturn-oriented-programming/) kann n√ºtzlich sein, um die **ret2execve** vorzubereiten.
* Gadgets von [**ret2csu**](../rop-return-oriented-programing/ret2csu.md) und [**ret2vdso**](../rop-return-oriented-programing/ret2vdso.md), um mehrere Register zu steuern.

#### √úber libc

* [**Ret2lib**](../rop-return-oriented-programing/ret2lib/): N√ºtzlich, um eine Funktion aus einer Bibliothek (normalerweise aus **`libc`**) wie **`system`** mit einigen vorbereiteten Argumenten (z.B. `'/bin/sh'`) aufzurufen. Sie m√ºssen die Bin√§rdatei **laden, um die Bibliothek** mit der Funktion, die Sie aufrufen m√∂chten (normalerweise libc), zu verwenden.
* Wenn **statisch kompiliert und kein** [**PIE**](../common-binary-protections-and-bypasses/pie/), √§ndern sich die **Adressen** von `system` und `/bin/sh` nicht, sodass sie statisch verwendet werden k√∂nnen.
* **Ohne** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **und Kenntnis der geladenen libc-Version** √§ndern sich die **Adressen** von `system` und `/bin/sh` nicht, sodass sie statisch verwendet werden k√∂nnen.
* Mit [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **aber ohne** [**PIE**](../common-binary-protections-and-bypasses/pie/)**, wenn die libc bekannt ist und die Bin√§rdatei die `system`**-Funktion verwendet, ist es m√∂glich, **`ret` zur Adresse von system in der GOT** mit der Adresse von `'/bin/sh'` im Parameter zu verwenden (das m√ºssen Sie herausfinden).
* Mit [ASLR](../common-binary-protections-and-bypasses/aslr/) aber ohne [PIE](../common-binary-protections-and-bypasses/pie/), wenn die libc bekannt ist und **ohne dass die Bin√§rdatei die `system`** verwendet:
* Verwenden Sie [**`ret2dlresolve`**](../rop-return-oriented-programing/ret2dlresolve.md), um die Adresse von `system` aufzul√∂sen und sie aufzurufen.
* **Umgehen** Sie [**ASLR**](../common-binary-protections-and-bypasses/aslr/) und berechnen Sie die Adresse von `system` und `'/bin/sh'` im Speicher.
* **Mit** [**ASLR**](../common-binary-protections-and-bypasses/aslr/) **und** [**PIE**](../common-binary-protections-and-bypasses/pie/) **und ohne Kenntnis der libc**: Sie m√ºssen:
* [**PIE**](../common-binary-protections-and-bypasses/pie/) umgehen.
* Die **`libc`-Version** herausfinden (ein paar Funktionsadressen leaken).
* Die **vorherigen Szenarien mit ASLR** √ºberpr√ºfen, um fortzufahren.

#### √úber EBP/RBP

* [**Stack Pivoting / EBP2Ret / EBP Chaining**](../stack-overflow/stack-pivoting-ebp2ret-ebp-chaining.md): Steuern Sie den ESP, um RET √ºber den gespeicherten EBP im Stack zu steuern.
* N√ºtzlich f√ºr **off-by-one** Stack Overflows.
* N√ºtzlich als alternative M√∂glichkeit, EIP zu steuern, w√§hrend EIP missbraucht wird, um die Nutzlast im Speicher zu konstruieren und dann √ºber EBP dorthin zu springen.

#### Sonstiges

* [**Pointer-Redirecting**](../stack-overflow/pointer-redirecting.md): Falls der Stack Zeiger auf eine Funktion enth√§lt, die aufgerufen werden soll, oder auf einen String, der von einer interessanten Funktion (system oder printf) verwendet werden soll, ist es m√∂glich, diese Adresse zu √ºberschreiben.
* [**ASLR**](../common-binary-protections-and-bypasses/aslr/) oder [**PIE**](../common-binary-protections-and-bypasses/pie/) k√∂nnten die Adressen beeinflussen.
* [**Uninitialisierte Variablen**](../stack-overflow/uninitialized-variables.md): Man wei√ü nie.

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
