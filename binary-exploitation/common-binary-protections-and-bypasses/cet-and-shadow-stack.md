# CET & Shadow Stack

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Control Flow Enforcement Technology (CET)

**CET** - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è –±–µ–∑–ø–µ–∫–∏, —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞ –∞–ø–∞—Ä–∞—Ç–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø–æ—à–∏—Ä–µ–Ω–∏–º –∞—Ç–∞–∫–∞–º –Ω–∞ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è, —Ç–∞–∫–∏–º —è–∫ **Return-Oriented Programming (ROP)** —Ç–∞ **Jump-Oriented Programming (JOP)**. –¶—ñ —Ç–∏–ø–∏ –∞—Ç–∞–∫ –º–∞–Ω—ñ–ø—É–ª—é—é—Ç—å –ø–æ—Ç–æ–∫–æ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π –∫–æ–¥ –∞–±–æ –∑'—î–¥–Ω–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω–∏ –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∫–æ–¥—É —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —à–∫—ñ–¥–ª–∏–≤—É –¥—ñ—é.

CET –≤–≤–æ–¥–∏—Ç—å –¥–≤—ñ –æ—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: **Indirect Branch Tracking (IBT)** —Ç–∞ **Shadow Stack**.

* **IBT** –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ–± –Ω–µ–ø—Ä—è–º—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏ —Ç–∞ –≤–∏–∫–ª–∏–∫–∏ –∑–¥—ñ–π—Å–Ω—é–≤–∞–ª–∏—Å—è –¥–æ –¥—ñ–π—Å–Ω–∏—Ö —Ü—ñ–ª–µ–π, —è–∫—ñ —è–≤–Ω–æ –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ –∑–∞–∫–æ–Ω–Ω—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –Ω–µ–ø—Ä—è–º–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π, —è–∫–∏–π –ø–æ–∑–Ω–∞—á–∞—î –¥—ñ–π—Å–Ω—ñ —Ü—ñ–ª—ñ, –∑–∞–ø–æ–±—ñ–≥–∞—é—á–∏ —Ç–∏–º —Å–∞–º–∏–º –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –≤—ñ–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –º—ñ—Å—Ü—å.
* **Shadow Stack** - —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º, —è–∫–∏–π –∑–∞–±–µ–∑–ø–µ—á—É—î —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –∞–¥—Ä–µ—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è. –í—ñ–Ω –∑–±–µ—Ä—ñ–≥–∞—î –∑–∞—Ö–∏—â–µ–Ω—É, –ø—Ä–∏—Ö–æ–≤–∞–Ω—É –∫–æ–ø—ñ—é –∞–¥—Ä–µ—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Å—Ç–µ–∫—É –≤–∏–∫–ª–∏–∫—ñ–≤. –ö–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è, –∞–¥—Ä–µ—Å–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∑ shadow stack, –∑–∞–ø–æ–±—ñ–≥–∞—é—á–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –≤—ñ–¥ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É –∞–¥—Ä–µ—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ —Å—Ç–µ–∫—É –¥–ª—è –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è.

## Shadow Stack

**Shadow stack** - —Ü–µ **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å—Ç–µ–∫, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∞–¥—Ä–µ—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è**. –í—ñ–Ω –ø—Ä–∞—Ü—é—î —Ä–∞–∑–æ–º –∑—ñ –∑–≤–∏—á–∞–π–Ω–∏–º —Å—Ç–µ–∫–æ–º, –∞–ª–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π —ñ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –≤—ñ–¥ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏, —â–æ —É—Å–∫–ª–∞–¥–Ω—é—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –∑ –Ω–∏–º. –û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞ shadow stack - –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –∑–º—ñ–Ω –∞–¥—Ä–µ—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ –∑–≤–∏—á–∞–π–Ω–æ–º—É —Å—Ç–µ–∫—É –¥–æ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–º–µ–Ω—à—É—é—á–∏ —Ä–∏–∑–∏–∫ –∞—Ç–∞–∫ ROP.

## How CET and Shadow Stack Prevent Attacks

**ROP —Ç–∞ JOP –∞—Ç–∞–∫–∏** –ø–æ–∫–ª–∞–¥–∞—é—Ç—å—Å—è –Ω–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å —ó–º –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –∞–±–æ –∞–¥—Ä–µ—Å–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ —Å—Ç–µ–∫—É. –ù–∞–ø—Ä–∞–≤–ª—è—é—á–∏ –ø–æ—Ç—ñ–∫ –¥–æ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç–µ–π —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ–¥–æ–≤–∏—Ö –≥–∞–¥–∂–µ—Ç—ñ–≤ –∞–±–æ –≥–∞–¥–∂–µ—Ç—ñ–≤, –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏—Ö –Ω–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥.

* **–§—É–Ω–∫—Ü—ñ—è IBT** CET –∑–Ω–∞—á–Ω–æ —É—Å–∫–ª–∞–¥–Ω—é—î —Ü—ñ –∞—Ç–∞–∫–∏, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏, —â–æ–± –Ω–µ–ø—Ä—è–º—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏ –º–æ–≥–ª–∏ —Å—Ç—Ä–∏–±–∞—Ç–∏ –ª–∏—à–µ –¥–æ –∞–¥—Ä–µ—Å, —è–∫—ñ –±—É–ª–∏ —è–≤–Ω–æ –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ –¥—ñ–π—Å–Ω—ñ —Ü—ñ–ª—ñ. –¶–µ —Ä–æ–±–∏—Ç—å –Ω–µ–º–æ–∂–ª–∏–≤–∏–º –¥–ª—è –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—ñ–≤ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω—ñ –≥–∞–¥–∂–µ—Ç–∏, —Ä–æ–∑–∫–∏–¥–∞–Ω—ñ –ø–æ –±—ñ–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É.
* **Shadow stack**, –∑ —ñ–Ω—à–æ–≥–æ –±–æ–∫—É, –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –∞–¥—Ä–µ—Å—É –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ –∑–≤–∏—á–∞–π–Ω–æ–º—É —Å—Ç–µ–∫—É, **–Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –±—É–¥–µ –≤–∏—è–≤–ª–µ–Ω–∞** –ø—Ä–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –ø–æ—à–∫–æ–¥–∂–µ–Ω–æ—ó –∞–¥—Ä–µ—Å–∏ –∑ –±–µ–∑–ø–µ—á–Ω–æ—é –∫–æ–ø—ñ—î—é, –∑–±–µ—Ä–µ–∂–µ–Ω–æ—é –≤ shadow stack, –ø—ñ–¥ —á–∞—Å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ —Ñ—É–Ω–∫—Ü—ñ—ó. –Ø–∫—â–æ –∞–¥—Ä–µ—Å–∏ –Ω–µ –∑–±—ñ–≥–∞—é—Ç—å—Å—è, –ø—Ä–æ–≥—Ä–∞–º–∞ –º–æ–∂–µ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É –∞–±–æ –≤–∂–∏—Ç–∏ —ñ–Ω—à–∏—Ö –∑–∞—Ö–æ–¥—ñ–≤ –±–µ–∑–ø–µ–∫–∏, –∑–∞–ø–æ–±—ñ–≥–∞—é—á–∏ —É—Å–ø—ñ—Ö—É –∞—Ç–∞–∫–∏.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
