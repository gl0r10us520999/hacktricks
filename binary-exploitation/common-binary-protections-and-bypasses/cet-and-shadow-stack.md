# CET & Shadow Stack

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Control Flow Enforcement Technology (CET)

**CET** je bezbednosna funkcija implementirana na hardverskom nivou, dizajnirana da spre캜i uobi캜ajene napade na preuzimanje kontrolnog toka kao 코to su **Return-Oriented Programming (ROP)** i **Jump-Oriented Programming (JOP)**. Ove vrste napada manipuli코u tokom izvr코avanja programa kako bi izvr코ile maliciozni kod ili povezale delove benignog koda na na캜in koji izvr코ava malicioznu radnju.

CET uvodi dve glavne funkcije: **Indirect Branch Tracking (IBT)** i **Shadow Stack**.

* **IBT** osigurava da se indirektni skokovi i pozivi vr코e na validne ciljeve, koji su eksplicitno ozna캜eni kao legalne destinacije za indirektne grane. To se posti쬰 kori코캖enjem novog skupa instrukcija koji ozna캜ava validne ciljeve, 캜ime se spre캜ava napada캜e da preusmere kontrolni tok na proizvoljne lokacije.
* **Shadow Stack** je mehanizam koji obezbe캠uje integritet povratnih adresa. 캛uva sigurnu, skrivenu kopiju povratnih adresa odvojeno od redovnog steka poziva. Kada funkcija vrati, povratna adresa se validira u odnosu na shadow stack, spre캜avaju캖i napada캜e da prepisuju povratne adrese na steku kako bi preuzeli kontrolni tok.

## Shadow Stack

**Shadow stack** je **posve캖en stek koji se koristi isklju캜ivo za 캜uvanje povratnih adresa**. Radi zajedno sa regularnim stekom, ali je za코ti캖en i skriven od normalnog izvr코avanja programa, 코to ote쬬va napada캜ima da ga manipuli코u. Primarni cilj shadow stack-a je da osigura da se sve izmene povratnih adresa na konvencionalnom steku otkriju pre nego 코to se mogu koristiti, efikasno ubla쬬vaju캖i ROP napade.

## Kako CET i Shadow Stack spre캜avaju napade

**ROP i JOP napadi** oslanjaju se na sposobnost preuzimanja kontrolnog toka aplikacije koriste캖i ranjivosti koje im omogu캖avaju da prepi코u pokaziva캜e ili povratne adrese na steku. Usmeravanjem toka ka sekvencama postoje캖ih kodnih gadgeta ili gadgeta orijentisanih na povratak, napada캜i mogu izvr코iti proizvoljni kod.

* **CET-ova IBT** funkcija 캜ini ove napade zna캜ajno te쬴m osiguravaju캖i da indirektne grane mogu skakati samo na adrese koje su eksplicitno ozna캜ene kao validni ciljevi. To onemogu캖ava napada캜ima da izvr코e proizvoljne gadgete raspore캠ene po binarnom kodu.
* **Shadow stack**, s druge strane, osigurava da 캜ak i ako napada캜 mo쬰 da prepi코e povratnu adresu na normalnom steku, **razlika 캖e biti otkrivena** prilikom pore캠enja o코te캖ene adrese sa sigurnom kopijom pohranjenom u shadow stack-u prilikom vra캖anja iz funkcije. Ako se adrese ne poklapaju, program mo쬰 prekinuti ili preduzeti druge bezbednosne mere, spre캜avaju캖i uspeh napada.

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
