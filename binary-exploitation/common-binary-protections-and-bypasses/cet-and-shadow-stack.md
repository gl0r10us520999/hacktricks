# CET & Shadow Stack

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Technologia Egzekwowania Przepywu Kontroli (CET)

**CET** to funkcja zabezpiecze wdro偶ona na poziomie sprztowym, zaprojektowana w celu powstrzymania powszechnych atak贸w na przejcie przepywu kontroli, takich jak **Return-Oriented Programming (ROP)** i **Jump-Oriented Programming (JOP)**. Te typy atak贸w manipuluj przepywem wykonania programu, aby uruchomi zoliwy kod lub poczy fragmenty nieszkodliwego kodu w spos贸b, kt贸ry wykonuje zoliw akcj.

CET wprowadza dwie g贸wne funkcje: **ledzenie Indirect Branch (IBT)** i **Shadow Stack**.

* **IBT** zapewnia, 偶e porednie skoki i wywoania s kierowane do wa偶nych cel贸w, kt贸re s wyra藕nie oznaczone jako legalne miejsca docelowe dla porednich gazi. Osiga si to poprzez u偶ycie nowego zestawu instrukcji, kt贸ry oznacza wa偶ne cele, zapobiegajc tym samym atakujcym od przekierowywania przepywu kontroli do dowolnych lokalizacji.
* **Shadow Stack** to mechanizm, kt贸ry zapewnia integralno adres贸w powrotu. Przechowuje zabezpieczon, ukryt kopi adres贸w powrotu oddzielnie od zwykego stosu wywoa. Gdy funkcja zwraca, adres powrotu jest weryfikowany w por贸wnaniu do shadow stack, co zapobiega atakujcym przed nadpisywaniem adres贸w powrotu na stosie w celu przejcia przepywu kontroli.

## Shadow Stack

**Shadow stack** to **dedykowany stos u偶ywany wycznie do przechowywania adres贸w powrotu**. Dziaa obok zwykego stosu, ale jest chroniony i ukryty przed normalnym wykonaniem programu, co utrudnia atakujcym manipulacj. G贸wnym celem shadow stack jest zapewnienie, 偶e wszelkie modyfikacje adres贸w powrotu na konwencjonalnym stosie s wykrywane przed ich u偶yciem, skutecznie agodzc ataki ROP.

## Jak CET i Shadow Stack Zapobiegaj Atakom

**Ataki ROP i JOP** polegaj na mo偶liwoci przejcia przepywu kontroli aplikacji poprzez wykorzystanie luk, kt贸re pozwalaj im nadpisywa wska藕niki lub adresy powrotu na stosie. Kierujc przepyw do sekwencji istniejcych gad偶et贸w kodu lub gad偶et贸w programowania opartego na powrocie, atakujcy mog wykonywa dowolny kod.

* Funkcja **IBT** CET znacznie utrudnia te ataki, zapewniajc, 偶e porednie gazie mog skaka tylko do adres贸w, kt贸re zostay wyra藕nie oznaczone jako wa偶ne cele. To uniemo偶liwia atakujcym wykonywanie dowolnych gad偶et贸w rozproszonych po binarnym.
* **Shadow stack**, z drugiej strony, zapewnia, 偶e nawet jeli atakujcy mo偶e nadpisa adres powrotu na normalnym stosie, **rozbie偶no zostanie wykryta** podczas por贸wnywania uszkodzonego adresu z zabezpieczon kopi przechowywan w shadow stack po powrocie z funkcji. Jeli adresy si nie zgadzaj, program mo偶e zakoczy dziaanie lub podj inne rodki bezpieczestwa, zapobiegajc powodzeniu ataku.

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
