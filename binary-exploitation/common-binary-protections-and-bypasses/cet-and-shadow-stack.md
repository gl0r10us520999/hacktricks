# CET & Shadow Stack

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Control Flow Enforcement Technology (CET)

**CET** ist eine Sicherheitsfunktion, die auf Hardwareebene implementiert ist und darauf abzielt, g√§ngige Angriffe auf den Kontrollfluss wie **Return-Oriented Programming (ROP)** und **Jump-Oriented Programming (JOP)** zu vereiteln. Diese Arten von Angriffen manipulieren den Ausf√ºhrungsfluss eines Programms, um sch√§dlichen Code auszuf√ºhren oder harmlose Codefragmente so zu verketten, dass eine sch√§dliche Aktion ausgef√ºhrt wird.

CET f√ºhrt zwei Hauptmerkmale ein: **Indirect Branch Tracking (IBT)** und **Shadow Stack**.

* **IBT** stellt sicher, dass indirekte Spr√ºnge und Aufrufe zu g√ºltigen Zielen erfolgen, die ausdr√ºcklich als legale Ziele f√ºr indirekte Zweige markiert sind. Dies wird durch die Verwendung eines neuen Befehlssatzes erreicht, der g√ºltige Ziele markiert und somit verhindert, dass Angreifer den Kontrollfluss an beliebige Orte umleiten.
* **Shadow Stack** ist ein Mechanismus, der die Integrit√§t von R√ºckgabeadressen gew√§hrleistet. Er h√§lt eine gesicherte, versteckte Kopie von R√ºckgabeadressen getrennt vom regul√§ren Aufrufstapel. Wenn eine Funktion zur√ºckkehrt, wird die R√ºckgabeadresse mit dem Shadow Stack validiert, um zu verhindern, dass Angreifer R√ºckgabeadressen im Stapel √ºberschreiben und den Kontrollfluss √ºbernehmen.

## Shadow Stack

Der **Shadow Stack** ist ein **dedizierter Stapel, der ausschlie√ülich zur Speicherung von R√ºckgabeadressen verwendet wird**. Er arbeitet neben dem regul√§ren Stapel, ist jedoch gesch√ºtzt und vor der normalen Programmausf√ºhrung verborgen, was es Angreifern erschwert, ihn zu manipulieren. Das Hauptziel des Shadow Stacks ist es, sicherzustellen, dass alle √Ñnderungen an R√ºckgabeadressen im herk√∂mmlichen Stapel erkannt werden, bevor sie verwendet werden k√∂nnen, wodurch ROP-Angriffe effektiv gemildert werden.

## Wie CET und Shadow Stack Angriffe verhindern

**ROP- und JOP-Angriffe** basieren auf der F√§higkeit, den Kontrollfluss einer Anwendung zu √ºbernehmen, indem sie Schwachstellen ausnutzen, die es ihnen erm√∂glichen, Zeiger oder R√ºckgabeadressen im Stapel zu √ºberschreiben. Indem sie den Fluss zu Sequenzen vorhandener Code-Gadgets oder R√ºckgabegest√ºtzter Programmiergadgets lenken, k√∂nnen Angreifer beliebigen Code ausf√ºhren.

* **CETs IBT**-Funktion macht diese Angriffe erheblich schwieriger, indem sichergestellt wird, dass indirekte Zweige nur zu Adressen springen k√∂nnen, die ausdr√ºcklich als g√ºltige Ziele markiert sind. Dies macht es unm√∂glich f√ºr Angreifer, beliebige Gadgets, die √ºber die Bin√§rdatei verteilt sind, auszuf√ºhren.
* Der **Shadow Stack** hingegen stellt sicher, dass selbst wenn ein Angreifer eine R√ºckgabeadresse im normalen Stapel √ºberschreiben kann, die **Abweichung erkannt wird**, wenn die besch√§digte Adresse mit der sicheren Kopie im Shadow Stack beim Zur√ºckkehren aus einer Funktion verglichen wird. Wenn die Adressen nicht √ºbereinstimmen, kann das Programm beendet werden oder andere Sicherheitsma√ünahmen ergreifen, um zu verhindern, dass der Angriff erfolgreich ist.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
