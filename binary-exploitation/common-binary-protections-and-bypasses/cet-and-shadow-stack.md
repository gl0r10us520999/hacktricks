# CET & Shadow Stack

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Control Flow Enforcement Technology (CET)

**CET** est une fonctionnalit√© de s√©curit√© mise en ≈ìuvre au niveau mat√©riel, con√ßue pour contrecarrer les attaques courantes de d√©tournement de flux de contr√¥le telles que **Return-Oriented Programming (ROP)** et **Jump-Oriented Programming (JOP)**. Ces types d'attaques manipulent le flux d'ex√©cution d'un programme pour ex√©cuter du code malveillant ou pour encha√Æner des morceaux de code b√©nin de mani√®re √† effectuer une action malveillante.

CET introduit deux fonctionnalit√©s principales : **Indirect Branch Tracking (IBT)** et **Shadow Stack**.

* **IBT** garantit que les sauts et appels indirects sont effectu√©s vers des cibles valides, qui sont explicitement marqu√©es comme destinations l√©gales pour les branches indirectes. Cela est r√©alis√© gr√¢ce √† l'utilisation d'un nouvel ensemble d'instructions qui marque les cibles valides, emp√™chant ainsi les attaquants de d√©tourner le flux de contr√¥le vers des emplacements arbitraires.
* **Shadow Stack** est un m√©canisme qui fournit une int√©grit√© pour les adresses de retour. Il conserve une copie s√©curis√©e et cach√©e des adresses de retour s√©par√©e de la pile d'appels normale. Lorsqu'une fonction retourne, l'adresse de retour est valid√©e par rapport √† la pile d'ombre, emp√™chant les attaquants d'√©craser les adresses de retour sur la pile pour d√©tourner le flux de contr√¥le.

## Shadow Stack

La **shadow stack** est une **pile d√©di√©e uniquement au stockage des adresses de retour**. Elle fonctionne en parall√®le avec la pile normale mais est prot√©g√©e et cach√©e de l'ex√©cution normale du programme, rendant difficile pour les attaquants de la manipuler. L'objectif principal de la shadow stack est de garantir que toute modification des adresses de retour sur la pile conventionnelle soit d√©tect√©e avant qu'elles ne puissent √™tre utilis√©es, att√©nuant ainsi efficacement les attaques ROP.

## How CET and Shadow Stack Prevent Attacks

Les **attaques ROP et JOP** s'appuient sur la capacit√© √† d√©tourner le flux de contr√¥le d'une application en exploitant des vuln√©rabilit√©s qui leur permettent d'√©craser des pointeurs ou des adresses de retour sur la pile. En dirigeant le flux vers des s√©quences de gadgets de code existants ou de gadgets orient√©s retour, les attaquants peuvent ex√©cuter du code arbitraire.

* La fonctionnalit√© **IBT** de CET rend ces attaques consid√©rablement plus difficiles en garantissant que les branches indirectes ne peuvent sauter qu'√† des adresses qui ont √©t√© explicitement marqu√©es comme cibles valides. Cela rend impossible pour les attaquants d'ex√©cuter des gadgets arbitraires dispers√©s dans le binaire.
* La **shadow stack**, en revanche, garantit que m√™me si un attaquant peut √©craser une adresse de retour sur la pile normale, la **discrepance sera d√©tect√©e** lors de la comparaison de l'adresse corrompue avec la copie s√©curis√©e stock√©e dans la shadow stack lors du retour d'une fonction. Si les adresses ne correspondent pas, le programme peut se terminer ou prendre d'autres mesures de s√©curit√©, emp√™chant ainsi l'attaque de r√©ussir.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
