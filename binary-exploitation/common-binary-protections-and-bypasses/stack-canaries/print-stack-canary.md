# スタックキャナリの印刷

{% hint style="success" %}
AWSハッキングの学習と練習：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングの学習と練習：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポート</summary>

- [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
- **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して**ハッキングテクニックを共有**してください。

</details>
{% endhint %}

## 印刷されたスタックを拡大

スタックオーバーフローに**脆弱なプログラム**が、**スタックオーバーフローの一部を指す** **puts**関数を実行できる状況を想像してみてください。攻撃者は、**キャナリの最初のバイトがヌルバイト**(`\x00`)であり、残りのキャナリが**ランダム**バイトであることを知っています。その後、攻撃者は、オーバーフローを作成して**キャナリの最初のバイトだけまでスタックを上書き**することができます。

その後、攻撃者は、ペイロードの中間で**puts機能を呼び出し**、キャナリのすべてを（最初のヌルバイトを除く）**印刷**します。

この情報を使用して、攻撃者は（同じプログラムセッション内で）キャナリを知っている新しい攻撃を**作成**して**送信**できます。

明らかに、この戦術は非常に**制限されて**おり、攻撃者は**ペイロードの内容を印刷**して**キャナリを外部に送信**し、その後、新しいペイロードを作成して（**同じプログラムセッション**内で）**実際のバッファオーバーフローを送信**できる必要があります。

**CTFの例:**&#x20;

- [**https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html**](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
- 64ビット、ASLR有効、PIEなし、キャナリのバイト0x00までオーバーフローを埋めてからputsを呼び出してリークさせます。キャナリを使用して、GOTからputsのアドレスをリークさせるためのROPガジェットが作成され、`system('/bin/sh')`を呼び出すためのROPガジェットが作成されます。
- [**https://guyinatuxedo.github.io/14-ret\_2\_system/hxp18\_poorCanary/index.html**](https://guyinatuxedo.github.io/14-ret\_2\_system/hxp18\_poorCanary/index.html)
- 32ビット、ARM、relroなし、キャナリ、nx、PIEなし。putsを呼び出してキャナリをリークさせ、ROPチェーンを使用して`system`を呼び出すret2lib呼び出し

## 任意の読み取り

フォーマット**文字列**によって提供されるような**任意の読み取り**がある場合、キャナリをリークさせることが可能かもしれません。この例をチェックしてください：[**https://ir0nstone.gitbook.io/notes/types/stack/canaries**](https://ir0nstone.gitbook.io/notes/types/stack/canaries) そして、以下のリンクから任意のメモリアドレスを読み取るためにフォーマット文字列を悪用する方法について読むことができます：

{% content-ref url="../../format-strings/" %}
[format-strings](../../format-strings/)
{% endcontent-ref %}

- [https://guyinatuxedo.github.io/14-ret\_2\_system/asis17\_marymorton/index.html](https://guyinatuxedo.github.io/14-ret\_2\_system/asis17\_marymorton/index.html)
- このチャレンジは、フォーマット文字列を非常に簡単な方法で悪用して、スタックからキャナリを読み取ります

{% hint style="success" %}
AWSハッキングの学習と練習：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングの学習と練習：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポート</summary>

- [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
- **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して**ハッキングテクニックを共有**してください。

</details>
{% endhint %}
