# PIE

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、ハッキングテクニックを共有してください。

</details>
{% endhint %}

## 基本情報

PIE、または**Position Independent Executable**としてコンパイルされたバイナリは、**プログラムが実行されるたびに異なるメモリ位置にロード**できるため、ハードコードされたアドレスを防ぎます。

これらのバイナリを悪用するトリックは、**相対アドレス**を悪用することにあります。プログラムの部分間のオフセットは、絶対位置が変わっても同じままです。**PIEをバイパスするには、通常はスタックからのリークなどの脆弱性を利用して、1つのアドレスをリークするだけ**です。アドレスを取得したら、**固定オフセット**によって他のアドレスを計算できます。

PIEバイナリを悪用する際の役立つヒントは、**基本アドレスが通常000で終わる**ことです。これは、メモリページがランダム化の単位であり、0x1000バイトのサイズであるためです。このアライメントは、正しい基本アドレスが特定されたかどうかを示すため、エクスプロイトが期待どおりに機能していない場合に重要な**チェック**になります。\
または、エクスプロイトにこれを使用できます。アドレスが**`0x649e1024`**にあることが漏洩した場合、**基本アドレスが`0x649e1000`**であることがわかり、そこから関数や場所の**オフセットを計算**できます。

## バイパス

PIEをバイパスするには、**ロードされたバイナリのアドレスをいくつかリークする必要**があります。これにはいくつかのオプションがあります:

* **ASLRが無効**: ASLRが無効になっている場合、PIEでコンパイルされたバイナリは常に**同じアドレスにロード**されるため、オブジェクトのアドレスは常に同じ場所になり、**PIEは無効**になります。
* リークを**受け取る**（簡単なCTFチャレンジで一般的、[**この例**](https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-exploit)をチェック）
* スタック内の正しい値をリークするまで、スタック内の**EBPとEIPの値をブルートフォース**する:

{% content-ref url="bypassing-canary-and-pie.md" %}
[bypassing-canary-and-pie.md](bypassing-canary-and-pie.md)
{% endcontent-ref %}

* [**フォーマット文字列**](../../format-strings/)などの**任意の読み取り**脆弱性を使用して、バイナリのアドレスをリークさせる（たとえば、前述のテクニックと同様にスタックから）してバイナリのベースを取得し、そこからオフセットを使用します。[**こちらで例を見つける**](https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-bypass)。

## 参考文献

* [https://ir0nstone.gitbook.io/notes/types/stack/pie](https://ir0nstone.gitbook.io/notes/types/stack/pie)

{% hint style="success" %}
AWSハッキングの学習と練習:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPハッキングの学習と練習: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksのサポート</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェック！
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、ハッキングテクニックを共有してください。

</details>
{% endhint %}
