# PIE

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Treinamento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Treinamento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoie o HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

Um bin√°rio compilado como PIE, ou **Executable de Posi√ß√£o Independente**, significa que o **programa pode carregar em diferentes locais de mem√≥ria** cada vez que √© executado, impedindo endere√ßos codificados.

O truque para explorar esses bin√°rios est√° em explorar os **endere√ßos relativos** ‚Äî os deslocamentos entre partes do programa permanecem os mesmos mesmo se as localiza√ß√µes absolutas mudarem. Para **burlar o PIE, voc√™ s√≥ precisa vazar um endere√ßo**, normalmente da **pilha** usando vulnerabilidades como ataques de string de formato. Uma vez que voc√™ tem um endere√ßo, voc√™ pode calcular outros pelos seus **deslocamentos fixos**.

Uma dica √∫til na explora√ß√£o de bin√°rios PIE √© que o **endere√ßo base geralmente termina em 000** devido √†s p√°ginas de mem√≥ria serem as unidades de randomiza√ß√£o, com tamanho de 0x1000 bytes. Este alinhamento pode ser um **verificador cr√≠tico se um exploit n√£o estiver funcionando** como esperado, indicando se o endere√ßo base correto foi identificado.\
Ou voc√™ pode usar isso para o seu exploit, se voc√™ vazar que um endere√ßo est√° localizado em **`0x649e1024`** voc√™ sabe que o **endere√ßo base √© `0x649e1000`** e a partir da√≠ voc√™ pode apenas **calcular deslocamentos** de fun√ß√µes e localiza√ß√µes.

## Bypasses

Para burlar o PIE √© necess√°rio **vazar algum endere√ßo do bin√°rio carregado**, existem algumas op√ß√µes para isso:

* **ASLR desativado**: Se o ASLR estiver desativado, um bin√°rio compilado com PIE sempre **ser√° carregado no mesmo endere√ßo**, portanto o **PIE ser√° in√∫til** j√° que os endere√ßos dos objetos sempre estar√£o no mesmo lugar.
* Ser **dado** o vazamento (comum em desafios CTF f√°ceis, [**verifique este exemplo**](https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-exploit))
* **For√ßar os valores de EBP e EIP** na pilha at√© vazar os corretos:

{% content-ref url="bypassing-canary-and-pie.md" %}
[bypassing-canary-and-pie.md](bypassing-canary-and-pie.md)
{% endcontent-ref %}

* Use uma vulnerabilidade de **leitura arbitr√°ria** como [**string de formato**](../../format-strings/) para vazar um endere√ßo do bin√°rio (por exemplo, da pilha, como na t√©cnica anterior) para obter a base do bin√°rio e usar deslocamentos a partir da√≠. [**Encontre um exemplo aqui**](https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-bypass).

## Refer√™ncias

* [https://ir0nstone.gitbook.io/notes/types/stack/pie](https://ir0nstone.gitbook.io/notes/types/stack/pie)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**Treinamento HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**Treinamento HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoie o HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
