# Off by one overflow

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)로부터 AWS 해킹을 제로부터 전문가까지 배우세요!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나 HackTricks를 PDF로 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [텔레그램 그룹](https://t.me/peass)에 **가입**하거나 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)를 **팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>

## 기본 정보

1바이트 오버플로우에만 액세스할 수 있다면, 공격자는 이전 크기 메타데이터 정보를 수정하여 실제로 해제된 청크를 조작할 수 있게 되어 다른 합법적인 청크를 포함하는 청크를 생성할 수 있습니다.

### 코드 예시:

* [https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c](https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c)
* 이 공격은 Tcaches의 사용으로 인해 더 이상 작동하지 않습니다.
* 더 큰 청크를 사용하여 악용하려고 하면 (따라서 tcaches가 관련되지 않음), 오류가 발생합니다: `malloc(): invalid next size (unsorted)`

### 목표

* 하나의 청크가 다른 청크 내에 포함되도록 만들어, 두 번째 청크에 대한 쓰기 액세스를 허용하여 포함된 청크를 덮어쓸 수 있도록 함

### 요구 사항

* 이전 크기 메타데이터 정보를 수정하기 위한 1바이트 오버플로우

### 공격

* 메모리의 3개 청크 (a, b, c)가 연이어 예약됩니다. 그런 다음 중간 청크가 해제됩니다. 첫 번째 청크에는 1바이트 오버플로우 취약점이 있으며 공격자는 0x00을 사용하여 이를 악용합니다 (이전 바이트가 0x10이면 중간 청크가 실제보다 0x10 작다고 나타냅니다).
* 그런 다음, 중간 해제된 청크 (b)에 2개의 더 작은 청크가 할당됩니다. 그러나 `b + b->size`는 c 청크를 업데이트하지 않습니다. 왜냐하면 가리키는 주소가 예상보다 작기 때문입니다.
* 그런 다음, b1과 c가 해제됩니다. `c - c->prev_size`가 여전히 b를 가리키고 있기 때문에 두 청크가 하나로 통합됩니다. 그러나 b2는 여전히 b1과 c 사이에 있습니다.
* 마지막으로, 이 메모리 영역을 다시 요청하는 새로운 malloc이 수행되어 b2를 포함하게 됩니다. 이를 통해 새 malloc의 소유자가 b2의 내용을 제어할 수 있습니다.

이 이미지는 공격을 완벽하게 설명합니다:

<figure><img src="../../.gitbook/assets/image (1247).png" alt=""><figcaption><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks">https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks</a></p></figcaption></figure>

## 참고 자료

* [https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks](https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)로부터 AWS 해킹을 제로부터 전문가까지 배우세요!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나 HackTricks를 PDF로 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [텔레그램 그룹](https://t.me/peass)에 **가입**하거나 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)를 **팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 트릭을 공유하세요.

</details>
