# рдмрд┐рдиреНрд╕ рдФрд░ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдЪрдВрдХреНрд╕ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреА рдХреБрд╢рд▓рддрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рд░ рдЪрдВрдХреНрд╕ рдХреЛ рдХреЗрд╡рд▓ рдПрдХ рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣реЛрддреЗ рд╣реИрдВред рдпреЗ рдмрд┐рдиреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ 5 рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрд┐рдиреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ: [62](https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l1407) small bins, 63 large bins, 1 unsorted bin, 10 fast bins рдФрд░ 64 tcache bins рдкреНрд░рддрд┐ рдереНрд░реЗрдбред

рдкреНрд░рддреНрдпреЗрдХ рдЕрдирд╕реЙрд░реНрдЯреЗрдб, рд╕реНрдореЙрд▓ рдФрд░ рд▓рд╛рд░реНрдЬ рдмрд┐рдиреНрд╕ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрддрд╛ рдПрдХ рд╣реА рдПрд░реЗ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред рдЗрдВрдбреЗрдХреНрд╕ 0 рдЕрдкреНрд░рдпреБрдХреНрдд рд╣реИ, 1 рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╣реИ, рдмрд┐рдиреНрд╕ 2-64 рд╕реНрдореЙрд▓ рдмрд┐рдиреНрд╕ рд╣реИрдВ рдФрд░ рдмрд┐рдиреНрд╕ 65-127 рд▓рд╛рд░реНрдЬ рдмрд┐рдиреНрд╕ рд╣реИрдВред

### Tcache (рдкреНрд░рддрд┐-рдереНрд░реЗрдб рдХреИрд╢) рдмрд┐рдиреНрд╕

рд╣рд╛рд▓рд╛рдВрдХрд┐ рдереНрд░реЗрдбреНрд╕ рдЕрдкрдиреА рдЦреБрдж рдХреА рд╣реАрдк рд░рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ (рджреЗрдЦреЗрдВ [Arenas](bins-and-memory-allocations.md#arenas) рдФрд░ [Subheaps](bins-and-memory-allocations.md#subheaps)), рдРрд╕реЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд╕рд╛рде (рдЬреИрд╕реЗ рдПрдХ рд╡реЗрдм рд╕рд░реНрд╡рд░) **рд╣реАрдк рдХреЛ рджреВрд╕рд░реЗ рдереНрд░реЗрдбреНрд╕ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛** рд╣реЛрддреА рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдореБрдЦреНрдп рд╕рдорд╛рдзрд╛рди рд╣реИ **рд▓реЙрдХрд░реНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ, рдЬреЛ **рдереНрд░реЗрдбреНрд╕ рдХреЛ рдХрд╛рдлреА рдзреАрдорд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

рдЗрд╕рд▓рд┐рдП, рдПрдХ tcache рдПрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдХреЗ рд╕рдорд╛рди рд╣реИ рдЙрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдпрд╣ рдПрдХ **рд╕рд┐рдВрдЧрд▓ рд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА** рд╣реИ рдЬреЛ рдЪрдВрдХреНрд╕ рдХреЛ рдорд░реНрдЬ рдирд╣реАрдВ рдХрд░рддреАред рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реЗрдб рдХреЗ рдкрд╛рд╕ **64 рд╕рд┐рдВрдЧрд▓-рд▓рд┐рдВрдХреНрдб tcache рдмрд┐рдиреНрд╕** рд╣реЛрддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рдмрд┐рди рдореЗрдВ [24 рд╕реЗ 1032B рддрдХ рдХреЗ рдЪрдВрдХреНрд╕](https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=2527e2504761744df2bdb1abdc02d936ff907ad2;hb=d5c3fafc4307c9b7a4c7d5cb381fcdbfad340bcc#l323) рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ 64-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдореНрд╕ рдкрд░ рдФрд░ 12 рд╕реЗ 516B рддрдХ рдХреЗ рдЪрдВрдХреНрд╕ 32-рдмрд┐рдЯ рд╕рд┐рд╕реНрдЯрдореНрд╕ рдкрд░ред

рдЬрдм рдПрдХ рдереНрд░реЗрдб рдПрдХ рдЪрдВрдХреНрд╕ рдХреЛ рдореБрдХреНрдд рдХрд░рддрд╛ рд╣реИ, **рдЕрдЧрд░ рдпрд╣ рдЗрддрдирд╛ рдмрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИ** рдХрд┐ рдЯреАрдХреИрд╢ рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд tcache рдмрд┐рди **рднрд░рд╛ рдирд╣реАрдВ рд╣реИ** (рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 7 рдЪрдВрдХреНрд╕), **рддреЛ рд╡рд╣рд╛рдВ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред рдЕрдЧрд░ рдпрд╣ рдЯреАрдХреИрд╢ рдореЗрдВ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╣реАрдк рд▓реЙрдХ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рд╡рд╣ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдореБрдХреНрддрд┐ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░ рд╕рдХреЗред

рдЬрдм рдПрдХ **рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдЕрдЧрд░ **рдЯреАрдХреИрд╢ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдЖрдХрд╛рд░ рдХрд╛ рдПрдХ рдореБрдХреНрдд рдЪрдВрдХреНрд╕ рд╣реИ** рддреЛ рдЙрд╕реЗ рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рдЕрдЧрд░ рдирд╣реАрдВ, рддреЛ рд╡рд╣ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдмрд┐рдиреНрд╕ рдореЗрдВ рд╕реЗ рдПрдХ рдвреВрдВрдврдиреЗ рдХреЗ рд▓рд┐рдП рд╣реАрдк рд▓реЙрдХ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдпрд╛ рдПрдХ рдирдпрд╛ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред\
рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ рдФрд░ рдЕрдиреБрдХреВрд▓рди рднреА рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣реАрдк рд▓реЙрдХ рдХреЗ рд╕рд╛рде рд╣реЛрддреЗ рд╣реБрдП, рдереНрд░реЗрдб **рдЕрдкрдирд╛ рдЯреАрдХреИрд╢ рд╣реАрдк рдЪрдВрдХреНрд╕ рдХреЗ рд╕рд╛рде рднрд░реЗрдЧрд╛ (7) рдЕрдиреБрд░реЛрдзрд┐рдд рдЖрдХрд╛рд░ рдХреЗ**, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЗрд╕реЗ рдЕрдзрд┐рдХ рдЪрд╛рд╣рд┐рдП, рддреЛ рд╡рд╣ рдЙрдиреНрд╣реЗрдВ рдЯреАрдХреИрд╢ рдореЗрдВ рдкрд╛рдПрдЧрд╛ред

<details>

<summary>рдПрдХ рдЯреАрдХреИрд╢ рдЪрдВрдХреНрд╕ рдЙрджрд╛рд╣рд░рдг рдЬреЛрдбрд╝реЗрдВ</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunk;
chunk = malloc(24);
printf("Address of the chunk: %p\n", (void *)chunk);
gets(chunk);
free(chunk);
return 0;
}
```
рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдбреАрдмрдЧ рдХрд░реЗрдВ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╕реЗ рд░рд┐рдЯ рдУрдкрдХреЛрдб рдореЗрдВ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рдеред рдлрд┐рд░ gef рдХреЗ рд╕рд╛рде рдЖрдк рдЙрдкрдпреЛрдЧ рдореЗрдВ рдЯреАрдХреИрд╢ рдмрд┐рди рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
gefтЮд  heap bins
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Tcachebins for thread 1 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Tcachebins[idx=0, size=0x20, count=1] тЖР  Chunk(addr=0xaaaaaaac12a0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
```
</details>

#### Tcache рд╕рдВрд░рдЪрдирд╛рдПрдБ рдФрд░ рдХрд╛рд░реНрдп

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдореЗрдВ **рдЕрдзрд┐рдХрддрдо рдмрд┐рди** рдФрд░ **рдкреНрд░рддрд┐ рд╕реВрдЪреА рдЯреБрдХрдбрд╝реЗ**, **`tcache_entry`** рд╕рдВрд░рдЪрд┐рдд рдХреЛ рджреЛрд╣рд░реА рдореБрдХреНрдд рдХрд░рдиреЗ рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ **`tcache_perthread_struct`**, рдПрдХ рд╕рдВрд░рдЪрдирд╛ рдЬрд┐рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдзрд╛рдЧреЗ рдХрд╛ рдкрддрд╛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
```c
// From https://github.com/bminor/glibc/blob/f942a732d37a96217ef828116ebe64a644db18d7/malloc/malloc.c

/* We want 64 entries.  This is an arbitrary limit, which tunables can reduce.  */
# define TCACHE_MAX_BINS		64
# define MAX_TCACHE_SIZE	tidx2usize (TCACHE_MAX_BINS-1)

/* Only used to pre-fill the tunables.  */
# define tidx2usize(idx)	(((size_t) idx) * MALLOC_ALIGNMENT + MINSIZE - SIZE_SZ)

/* When "x" is from chunksize().  */
# define csize2tidx(x) (((x) - MINSIZE + MALLOC_ALIGNMENT - 1) / MALLOC_ALIGNMENT)
/* When "x" is a user-provided size.  */
# define usize2tidx(x) csize2tidx (request2size (x))

/* With rounding and alignment, the bins are...
idx 0   bytes 0..24 (64-bit) or 0..12 (32-bit)
idx 1   bytes 25..40 or 13..20
idx 2   bytes 41..56 or 21..28
etc.  */

/* This is another arbitrary limit, which tunables can change.  Each
tcache bin will hold at most this number of chunks.  */
# define TCACHE_FILL_COUNT 7

/* Maximum chunks in tcache bins for tunables.  This value must fit the range
of tcache->counts[] entries, else they may overflow.  */
# define MAX_TCACHE_COUNT UINT16_MAX

[...]

typedef struct tcache_entry
{
struct tcache_entry *next;
/* This field exists to detect double frees.  */
uintptr_t key;
} tcache_entry;

/* There is one of these for each thread, which contains the
per-thread cache (hence "tcache_perthread_struct").  Keeping
overall size low is mildly important.  Note that COUNTS and ENTRIES
are redundant (we could have just counted the linked list each
time), this is for performance reasons.  */
typedef struct tcache_perthread_struct
{
uint16_t counts[TCACHE_MAX_BINS];
tcache_entry *entries[TCACHE_MAX_BINS];
} tcache_perthread_struct;
```
</details>

рдлрд╝рдВрдХреНрд╢рди `__tcache_init` рд╡рд╣ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ `tcache_perthread_struct` рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рди рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддрд╛ рд╣реИред

<details>

<summary>tcache_init рдХреЛрдб</summary>
```c
// From https://github.com/bminor/glibc/blob/f942a732d37a96217ef828116ebe64a644db18d7/malloc/malloc.c#L3241C1-L3274C2

static void
tcache_init(void)
{
mstate ar_ptr;
void *victim = 0;
const size_t bytes = sizeof (tcache_perthread_struct);

if (tcache_shutting_down)
return;

arena_get (ar_ptr, bytes);
victim = _int_malloc (ar_ptr, bytes);
if (!victim && ar_ptr != NULL)
{
ar_ptr = arena_get_retry (ar_ptr, bytes);
victim = _int_malloc (ar_ptr, bytes);
}


if (ar_ptr != NULL)
__libc_lock_unlock (ar_ptr->mutex);

/* In a low memory situation, we may not be able to allocate memory
- in which case, we just keep trying later.  However, we
typically do this very early, so either there is sufficient
memory, or there isn't enough memory to do non-trivial
allocations anyway.  */
if (victim)
{
tcache = (tcache_perthread_struct *) victim;
memset (tcache, 0, sizeof (tcache_perthread_struct));
}

}
```
</details>

#### Tcache Indexes

рдЯреАрдХреИрд╢ рдореЗрдВ рдХрдИ рдмрд┐рди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдХрд╛рд░ рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВ **рдкреНрд░рддреНрдпреЗрдХ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдкрд╣рд▓реЗ рдЪрдВрдХ рдФрд░ рдкреНрд░рддрд┐ рдЗрдВрдбреЗрдХреНрд╕ рдЪрдВрдХ рдХреА рдорд╛рддреНрд░рд╛ рдПрдХ рдЪрдВрдХ рдХреЗ рдЕрдВрджрд░ рд╕реНрдерд┐рдд рд╣реЛрддреА рд╣реИрдВ**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде рдЪрдВрдХ рдХреЛ рдвреВрдВрдврдирд╛ (рд╕рд╛рдорд╛рдиреНрдпрдд: рдкрд╣рд▓рд╛), рдЯреАрдХреИрд╢ рдХреЗ рд╕рднреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреЙрдЗрдВрдЯреНрд╕ рдФрд░ рдЯреАрдХреИрд╢ рдЪрдВрдХ рдХреА рдорд╛рддреНрд░рд╛ рдвреВрдВрдврдирд╛ рд╕рдВрднрд╡ рд╣реИред

### Fast bins

рдлрд╛рд╕реНрдЯ рдмрд┐рдиреНрд╕ рдХреЛ **рдЫреЛрдЯреЗ рдЪрдВрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди рдХреА рдЧрддрд┐ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рддреНрд╡рд░рд┐рдд рдкрд╣реБрдВрдЪ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдлреНрд░реА рдХрд┐рдП рдЧрдП рдЪрдВрдХ рд░рдЦрдХрд░ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдпреЗ рдмрд┐рдиреНрд╕ рдПрдХ рд▓рд╛рд╕реНрдЯ-рдЗрди, рдлрд░реНрд╕реНрдЯ-рдЖрдЙрдЯ (LIFO) рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рд╕рдмрд╕реЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдлреНрд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЪрдВрдХ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ** рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рдПрдХ рдирдИ рдЖрд╡рдВрдЯрди рдЕрдиреБрд░реЛрдз рд╣реЛред рдпрд╣ рд╡реНрдпрд╡рд╣рд╛рд░ рдЧрддрд┐ рдХреЗ рд▓рд┐рдП рдлрд╛рдпрджреЗрдордВрдж рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рд╕реНрдЯреИрдХ (LIFO) рд╕реЗ рдКрдкрд░ рд╕реЗ рдбрд╛рд▓рдирд╛ рдФрд░ рд╣рдЯрд╛рдирд╛ рддреЗрдЬ рд╣реЛрддрд╛ рд╣реИ рддреБрд▓рдирд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдПрдХ рдХрддрд╛рд░ (FIFO) рдХреЗ рд╕рд╛рдеред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, **рдлрд╛рд╕реНрдЯ рдмрд┐рдиреНрд╕ рдПрдХрд▓ рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ**, рдбрдмрд▓ рд▓рд┐рдВрдХреНрдб рдирд╣реАрдВ, рдЬреЛ рдЧрддрд┐ рдХреЛ рдФрд░ рдмрдврд╝рд╛рддрд╛ рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдлрд╛рд╕реНрдЯ рдмрд┐рдиреНрд╕ рдореЗрдВ рдЪрдВрдХреНрд╕ рдХреЛ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛рддрд╛, рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрдЯрд┐рд▓ рд╕рдВрд░рдЪрдирд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдЬреЛ рдордзреНрдп рд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдПрдХрд▓ рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ рдЗрди рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рд╕рд░рд▓ рдФрд░ рддреЗрдЬ рдмрдирд╛рддрд╛ рд╣реИред

рдореВрд▓ рд░реВрдк рд╕реЗ, рдпрд╣рд╛рдБ рдпрд╣ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рд╣реЗрдбрд░ (рдкрд╣рд▓реЗ рдЪрдВрдХ рдХреЗ рдкреЙрдЗрдВрдЯрд░) рд╣рдореЗрд╢рд╛ рдЙрд╕ рдЖрдХрд╛рд░ рдХреЗ рд╕рдмрд╕реЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдлреНрд░реА рдХрд┐рдП рдЧрдП рдЪрдВрдХ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИред рддреЛ:

* рдЬрдм рдЙрд╕ рдЖрдХрд╛рд░ рдХрд╛ рдирдпрд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣реЗрдбрд░ рдПрдХ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдлреНрд░реА рдЪрдВрдХ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдлреНрд░реА рдЪрдВрдХ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЕрдЧрд▓реЗ рдЪрдВрдХ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕ рдкрддреЗ рдХреЛ рд╣реЗрдбрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЕрдЧрд▓реА рдЖрд╡рдВрдЯрди рдЬрд╛рдиреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣реЛ рдХрд┐ рдХрд╣рд╛рдБ рд╕реЗ рдПрдХ рдЙрдкрд▓рдмреНрдз рдЪрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ
* рдЬрдм рдПрдХ рдЪрдВрдХ рдлреНрд░реА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдлреНрд░реА рдЪрдВрдХ рд╡рд░реНрддрдорд╛рди рдЙрдкрд▓рдмреНрдз рдЪрдВрдХ рдХрд╛ рдкрддрд╛ рд╕рд╣реЗрдЬреЗрдЧрд╛ рдФрд░ рдЗрд╕ рдирдП рдлреНрд░реА рдЪрдВрдХ рдХрд╛ рдкрддрд╛ рд╣реЗрдбрд░ рдореЗрдВ рдбрд╛рд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛

рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ рдХрд╛ рдЕрдзрд┐рдХрддрдо рдЖрдХрд╛рд░ `0x80` рд╣реИ рдФрд░ рд╡реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рд╕рдВрдЧрдард┐рдд рд╣реИрдВ рдХрд┐ рдЖрдХрд╛рд░ `0x20-0x2f` рдХрд╛ рдПрдХ рдЪрдВрдХ рдЗрдВрдбреЗрдХреНрд╕ `0` рдореЗрдВ рд╣реЛрдЧрд╛, рдЖрдХрд╛рд░ `0x30-0x3f` `idx` `1` рдореЗрдВ рд╣реЛрдЧрд╛...

{% hint style="danger" %}
рдлрд╛рд╕реНрдЯ рдмрд┐рдиреНрд╕ рдореЗрдВ рдЪрдВрдХ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдЗрд╕рд▓рд┐рдП рд╡реЗ рдХреБрдЫ рд╕рдордп рддрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЪрдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЙрдирдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреЗ рдЕрдиреНрдп рдлреНрд░реА рдЪрдВрдХреНрд╕ рдХреЗ рд╕рд╛рде рдорд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
{% endhint %}
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711

/*
Fastbins

An array of lists holding recently freed small chunks.  Fastbins
are not doubly linked.  It is faster to single-link them, and
since chunks are never removed from the middles of these lists,
double linking is not necessary. Also, unlike regular bins, they
are not even processed in FIFO order (they use faster LIFO) since
ordering doesn't much matter in the transient contexts in which
fastbins are normally used.

Chunks in fastbins keep their inuse bit set, so they cannot
be consolidated with other free chunks. malloc_consolidate
releases all chunks in fastbins and consolidates them with
other free chunks.
*/

typedef struct malloc_chunk *mfastbinptr;
#define fastbin(ar_ptr, idx) ((ar_ptr)->fastbinsY[idx])

/* offset 2 to use otherwise unindexable first 2 bins */
#define fastbin_index(sz) \
((((unsigned int) (sz)) >> (SIZE_SZ == 8 ? 4 : 3)) - 2)


/* The maximum fastbin request size we support */
#define MAX_FAST_SIZE     (80 * SIZE_SZ / 4)

#define NFASTBINS  (fastbin_index (request2size (MAX_FAST_SIZE)) + 1)
```
<details>

<summary>рдПрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдЪрдВрдХ рдЙрджрд╛рд╣рд░рдг рдЬреЛрдбрд╝реЗрдВ</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[8];
int i;

// Loop to allocate memory 8 times
for (i = 0; i < 8; i++) {
chunks[i] = malloc(24);
if (chunks[i] == NULL) { // Check if malloc failed
fprintf(stderr, "Memory allocation failed at iteration %d\n", i);
return 1;
}
printf("Address of chunk %d: %p\n", i, (void *)chunks[i]);
}

// Loop to free the allocated memory
for (i = 0; i < 8; i++) {
free(chunks[i]);
}

return 0;
}
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рд╣рдо рдПрдХ рд╣реА рдЖрдХрд╛рд░ рдХреЗ 8 рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдФрд░ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдЯреАрдХреИрд╢ рднрд░ рдЬрд╛рдПрдВ рдФрд░ рдЖрдард╡рд╛рдВ рдЪрдВрдХ рддреЗрдЬ рдЪрдВрдХ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛред

рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдФрд░ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╕реЗ рд░реЗрдЯ рдСрдкрдХреЛрдб рдореЗрдВ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдбреАрдмрдЧ рдХрд░реЗрдВред рдлрд┐рд░ gef рдХреЗ рд╕рд╛рде рдЖрдк рдЯреАрдХреИрд╢ рдмрд┐рди рднрд░рддреЗ рд╣реБрдП рдФрд░ рддреЗрдЬ рдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
gefтЮд  heap bins
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Tcachebins for thread 1 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Tcachebins[idx=0, size=0x20, count=7] тЖР  Chunk(addr=0xaaaaaaac1770, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1750, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1730, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1710, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac16f0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac16d0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac12a0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Fastbins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Fastbins[idx=0, size=0x20]  тЖР  Chunk(addr=0xaaaaaaac1790, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
Fastbins[idx=1, size=0x30] 0x00
```
</details>

### рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди

рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди рдПрдХ **рдХреИрд╢** рд╣реИ рдЬрд┐рд╕реЗ рд╣реАрдк рдкреНрд░рдмрдВрдзрдХ рджреНрд╡рд╛рд░рд╛ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди рдХреЛ рддреЗрдЬрд╝ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣рд╛рдБ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: рдЬрдм рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ рдПрдХ рдЯреАрдХреИрд╢ рдпрд╛ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдКрдкрд░реА рдЯреБрдХрдбрд╝реЗ рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛ рдирд╣реАрдВ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╣реАрдк рдкреНрд░рдмрдВрдзрдХ рдЗрд╕реЗ рддреБрд░рдВрдд рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЫреЛрдЯреЗ рдпрд╛ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдирд╣реАрдВ рдбрд╛рд▓рддрд╛ рд╣реИред рдмрдЬрд╛рдп рдЗрд╕рдХреЗ, рдпрд╣ рдкрд╣рд▓реЗ рдХрд┐рд╕реА рднреА рдкрдбрд╝реЛрд╕реА рдлреНрд░реА рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рде **рдорд░реНрдЬ** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдЕрдзрд┐рдХ рдмрдбрд╝рд╛ рдлреНрд░реА рдореЗрдореЛрд░реА рдмреНрд▓реЙрдХ рдмрдирд╛ рд╕рдХреЗред рдлрд┐рд░, рдпрд╣ рдирдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдмрд┐рди рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ "рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди" рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЬрдм рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо **рдореЗрдореЛрд░реА рдХреЗ рд▓рд┐рдП рдорд╛рдВрдЧ рдХрд░рддрд╛ рд╣реИ**, рддреЛ рд╣реАрдк рдкреНрд░рдмрдВрдзрдХ **рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди рдХреА рдЬрд╛рдБрдЪ** рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдкрд░реНрдпрд╛рдкреНрдд рдЖрдХрд╛рд░ рдХрд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реИред рдЕрдЧрд░ рд╡рд╣ рдПрдХ рдкрд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЗрд╕реЗ рддреБрд░рдВрдд рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЕрдЧрд░ рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди рдореЗрдВ рдПрдХ рдЙрдкрдпреБрдХреНрдд рдЯреБрдХрдбрд╝рд╛ рдирд╣реАрдВ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕рднреА рдЯреБрдХрдбрд╝реЗ рдЗрд╕ рд╕реВрдЪреА рдХреЛ рдЙрдирдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдмрд┐рди рдореЗрдВ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ рддреЛ рдЫреЛрдЯреЗ рдпрд╛ рдмрдбрд╝реЗ, рдЙрдирдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдЧрд░ рдПрдХ рдмрдбрд╝рд╛ рдЯреБрдХрдбрд╝рд╛ 2 рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдмрд╛рдХреА рднрд╛рдЧ MINSIZE рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рдпрд╣ рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди рдореЗрдВ рд╡рд╛рдкрд╕ рд░рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЗрд╕рд▓рд┐рдП, рдЕрд╡рд░реНрдЧреАрдХреГрдд рдмрд┐рди рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди рдХреЛ рддреЗрдЬрд╝ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдореБрдХреНрдд рдХреА рдЧрдИ рдореЗрдореЛрд░реА рдХреЛ рддреЗрдЬрд╝реА рд╕реЗ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╕рдордп рдЧреНрд░рд╛рд╣рдХ рдЦреЛрдЬ рдФрд░ рдорд░реНрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЪрдВрдХреНрд╕ рд╡рд┐рднрд┐рдиреНрди рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рд╣реЛрдВ, рдЕрдЧрд░ рдПрдХ рдЙрдкрд▓рдмреНрдз рдЪрдВрдХ рджреВрд╕рд░реЗ рдЙрдкрд▓рдмреНрдз рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛ рд░рд╣рд╛ рд╣реИ (рдпрджреА рд╡реЗ рдореВрд▓ рд░реВрдк рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдмрд┐рдиреЛрдВ рдореЗрдВ рд╣реИрдВ), рддреЛ рд╡реЗ рдорд░реНрдЬ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред
{% endhint %}

<details>

<summary>рдПрдХ рдЕрд╡рд░реНрдЧреАрдХреГрдд рдЯреБрдХрдбрд╝рд╛ рдЙрджрд╛рд╣рд░рдг рдЬреЛрдбрд╝реЗрдВ</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[9];
int i;

// Loop to allocate memory 8 times
for (i = 0; i < 9; i++) {
chunks[i] = malloc(0x100);
if (chunks[i] == NULL) { // Check if malloc failed
fprintf(stderr, "Memory allocation failed at iteration %d\n", i);
return 1;
}
printf("Address of chunk %d: %p\n", i, (void *)chunks[i]);
}

// Loop to free the allocated memory
for (i = 0; i < 8; i++) {
free(chunks[i]);
}

return 0;
}
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рд╣рдо рдПрдХ рд╣реА рдЖрдХрд╛рд░ рдХреЗ 9 рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдФрд░ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ **рдЯреАрдХреИрд╢** рднрд░ рдЬрд╛рдПрдВ рдФрд░ рдЖрдард╡рд╛рдВ рдЪрдВрдХ рдЕрдиреБрдХреНрд░рдордгрд┐рдХ рдмрд┐рди рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдлрд╛рд╕реНрдЯрдмрд┐рди рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдмрдбрд╝рд╛** рд╣реИ рдФрд░ рдиреМрд╡рд╛рдВ рдЪрдВрдХ рдореБрдХреНрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЗрд╕рд▓рд┐рдП рдиреМрд╡рд╛рдВ рдФрд░ рдЖрдард╡рд╛рдВ **рдЯреЙрдк рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдорд░реНрдЬ рдирд╣реАрдВ рд╣реЛрддреЗ**ред

рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдФрд░ рдореБрдЦреНрдп рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд░реЗрдЯ рдУрдкрдХреЛрдб рдореЗрдВ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдбреАрдмрдЧ рдХрд░реЗрдВред рдлрд┐рд░ gef рдХреЗ рд╕рд╛рде рдЖрдк рдЯреАрдХреИрд╢ рдмрд┐рди рднрд░рддреЗ рд╣реБрдП рдФрд░ рдЕрдиреБрдХреНрд░рдорд┐рдд рдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
gefтЮд  heap bins
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Tcachebins for thread 1 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Tcachebins[idx=15, size=0x110, count=7] тЖР  Chunk(addr=0xaaaaaaac1d10, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1c00, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1af0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac19e0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac18d0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac17c0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac12a0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Fastbins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Unsorted Bin for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
[+] unsorted_bins[0]: fw=0xaaaaaaac1e10, bk=0xaaaaaaac1e10
тЖТ   Chunk(addr=0xaaaaaaac1e20, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in unsorted bin.
```
</details>

### рдЫреЛрдЯреЗ рдмрд┐рди

рдЫреЛрдЯреЗ рдмрд┐рди рдмрдбрд╝реЗ рдмрд┐рдиреЛрдВ рд╕реЗ рддреЗрдЬ рд╣реЛрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдлрд╛рд╕реНрдЯ рдмрд┐рдиреНрд╕ рд╕реЗ рдзреАрдореЗ рд╣реЛрддреЗ рд╣реИрдВред

62 рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдмрд┐рди рдореЗрдВ **рдПрдХ рд╣реА рдЖрдХрд╛рд░ рдХреЗ рдЪрдВрдХреНрд╕** рд╣реЛрдВрдЧреЗ: 16, 24, ... (32 рдмрд┐рдЯреНрд╕ рдореЗрдВ 504 рдмрд╛рдЗрдЯ рддрдХ рдФрд░ 64 рдмрд┐рдЯреНрд╕ рдореЗрдВ 1024 рддрдХ рдХрд╛ рдЕрдзрд┐рдХрддрдо рдЖрдХрд╛рд░)ред рдпрд╣ рдПрдХ рдЬрдЧрд╣ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЗрди рд╕реВрдЪрд┐рдпреЛрдВ рдкрд░ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рдбрд╛рд▓рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдореЗрдВ рдЧрддрд┐ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред

рдпрд╣рд╛рдВ рдЫреЛрдЯреЗ рдмрд┐рди рдХрд╛ рдЖрдХрд╛рд░ рдмрд┐рди рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреИрд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

* рд╕рдмрд╕реЗ рдЫреЛрдЯрд╛ рдЖрдХрд╛рд░: 2\*4\*рд╕реВрдЪрдХрд╛рдВрдХ (рдЙрджрд╛рд╣рд░рдг: рд╕реВрдЪрдХрд╛рдВрдХ 5 -> 40)
* рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЖрдХрд╛рд░: 2\*8\*рд╕реВрдЪрдХрд╛рдВрдХ (рдЙрджрд╛рд╣рд░рдг: рд╕реВрдЪрдХрд╛рдВрдХ 5 -> 80)
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711
#define NSMALLBINS         64
#define SMALLBIN_WIDTH    MALLOC_ALIGNMENT
#define SMALLBIN_CORRECTION (MALLOC_ALIGNMENT > CHUNK_HDR_SZ)
#define MIN_LARGE_SIZE    ((NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH)

#define in_smallbin_range(sz)  \
((unsigned long) (sz) < (unsigned long) MIN_LARGE_SIZE)

#define smallbin_index(sz) \
((SMALLBIN_WIDTH == 16 ? (((unsigned) (sz)) >> 4) : (((unsigned) (sz)) >> 3))\
+ SMALLBIN_CORRECTION)
```
### рдЫреЛрдЯреЗ рдФрд░ рдмрдбрд╝реЗ рдмрд┐рдиреНрд╕ рдХреЗ рдмреАрдЪ рдЪрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди:
```c
#define bin_index(sz) \
((in_smallbin_range (sz)) ? smallbin_index (sz) : largebin_index (sz))
```
<details>

<summary>рдПрдХ рдЫреЛрдЯреЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдЬреЛрдбрд╝реЗрдВ</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[10];
int i;

// Loop to allocate memory 8 times
for (i = 0; i < 9; i++) {
chunks[i] = malloc(0x100);
if (chunks[i] == NULL) { // Check if malloc failed
fprintf(stderr, "Memory allocation failed at iteration %d\n", i);
return 1;
}
printf("Address of chunk %d: %p\n", i, (void *)chunks[i]);
}

// Loop to free the allocated memory
for (i = 0; i < 8; i++) {
free(chunks[i]);
}

chunks[9] = malloc(0x110);

return 0;
}
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рд╣рдо рдХреИрд╕реЗ 9 рдмрдбрд╝реЗ рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдФрд░ рдлреНрд░реА рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ **рдЯреАрдХреИрд╢** рдХреЛ рднрд░ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдЖрдард╡рд╛рдВ рдЪрдВрдХ рдЕрдиреБрдХреНрд░рдорд┐рдд рдмрд┐рди рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдлрд╛рд╕реНрдЯрдмрд┐рди рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реИ** рдФрд░ рдиреМрд╡рд╛рдВ рдЪрдВрдХ рдлреНрд░реА рдирд╣реАрдВ рд╣реИ рдЗрд╕рд▓рд┐рдП рдиреМрд╡рд╛рдВ рдФрд░ рдЖрдард╡рд╛рдВ **рдЯреЙрдк рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдорд░реНрдЬ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ**ред рдлрд┐рд░ рд╣рдо 0x110 рдХрд╛ рдПрдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ **рдЕрдиреБрдХреНрд░рдорд┐рдд рдмрд┐рди рдореЗрдВ рдЪрдВрдХ рдЫреЛрдЯреЗ рдмрд┐рди рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ**ред

рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдФрд░ рдореБрдЦреНрдп рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд░реЗрдЯ рдУрдкрдХреЛрдб рдореЗрдВ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдбреАрдмрдЧ рдХрд░реЗрдВред рдлрд┐рд░ gef рдХреЗ рд╕рд╛рде рдЖрдк рдЯреАрдХреИрд╢ рдмрд┐рди рднрд░рддреЗ рд╣реБрдП рдФрд░ рдЫреЛрдЯреЗ рдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
gefтЮд  heap bins
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Tcachebins for thread 1 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Tcachebins[idx=15, size=0x110, count=7] тЖР  Chunk(addr=0xaaaaaaac1d10, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1c00, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac1af0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac19e0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac18d0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac17c0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  Chunk(addr=0xaaaaaaac12a0, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Fastbins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Unsorted Bin for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
[+] Found 0 chunks in unsorted bin.
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Small Bins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
[+] small_bins[16]: fw=0xaaaaaaac1e10, bk=0xaaaaaaac1e10
тЖТ   Chunk(addr=0xaaaaaaac1e20, size=0x110, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in 1 small non-empty bins.
```
</details>

### рдмрдбрд╝реЗ рдмрд┐рди

рдЫреЛрдЯреЗ рдмрд┐рдиреЛрдВ рдХреА рддрд░рд╣, рдЬреЛ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдХрд╛рд░реЛрдВ рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддреЗ рд╣реИрдВ, рдкреНрд░рддреНрдпреЗрдХ **рдмрдбрд╝реЗ рдмрд┐рди рдПрдХ рдЪрдВрдХ рдЖрдХрд╛рд░реЛрдВ рдХреА рд╢реНрд░реЗрдгреА рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдЕрдзрд┐рдХ рд▓рдЪреАрд▓рд╛ рд╣реИ, рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд░реЛрдВ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдгрд╛рд▓реА рдХреЛ **рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЖрдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдмрд┐рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА**ред

рдПрдХ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрдХ, рдмрдбрд╝реЗ рдмрд┐рди рдЫреЛрдЯреЗ рдмрд┐рдиреЛрдВ рдХреЗ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдкрд░ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред рдмрдбрд╝реЗ рдмрд┐рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реАрдорд╛рдПрдБ рдкреНрд░рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдмрдврд╝рддреА рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдкрд╣рд▓рд╛ рдмрд┐рди 512 рд╕реЗ 576 рдмрд╛рдЗрдЯ рддрдХ рдХреЗ рдЪрдВрдХ рдХреЛ рдХрд╡рд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдЕрдЧрд▓рд╛ 576 рд╕реЗ 640 рдмрд╛рдЗрдЯ рдХреЛ рдХрд╡рд░ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдкреИрдЯрд░реНрди рдЬрд╛рд░реА рд░рд╣рддрд╛ рд╣реИ, рд╕рдмрд╕реЗ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рд╕рднреА 1MB рд╕реЗ рдКрдкрд░ рдХреЗ рдЪрдВрдХ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред

рдмрдбрд╝реЗ рдмрд┐рди рдЫреЛрдЯреЗ рдмрд┐рдиреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдзреАрдореЗ рд╣реЛрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ **рдПрдХ рднрд┐рдиреНрди рдЪрдВрдХ рдЖрдХрд╛рд░реЛрдВ рдХреА рд╕реВрдЪреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд░рдордмрджреНрдз рдФрд░ рдЦреЛрдЬрдирд╛** рдкрдбрд╝рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрд╡рдВрдЯрди рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡реЛрддреНрддрдо рдлрд┐рдЯ рдвреВрдВрдврд╛ рдЬрд╛ рд╕рдХреЗред рдЬрдм рдПрдХ рдЪрдВрдХ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдХреНрд░рдордмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЬрдм рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рд╕рд╣реА рдЪрдВрдХ рдвреВрдВрдврдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред рдпрд╣ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рдо рдЙрдиреНрд╣реЗрдВ **рдзреАрдорд╛** рдмрдирд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреНрдпреЛрдВрдХрд┐ рдмрдбрд╝реЗ рдЖрд╡рдВрдЯрди рдЫреЛрдЯреЗ рд╕реЗ рдХрдо рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╕реНрд╡реАрдХрд╛рд░реНрдп рд╡реНрдпрд╛рдкрд╛рд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

рд╣реИрдВ:

* 32 рдмрд┐рди 64B рд░реЗрдВрдЬ рдХреЗ (рдЫреЛрдЯреЗ рдмрд┐рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛рддреЗ рд╣реИрдВ)
* 16 рдмрд┐рди 512B рд░реЗрдВрдЬ рдХреЗ (рдЫреЛрдЯреЗ рдмрд┐рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛рддреЗ рд╣реИрдВ)
* 8 рдмрд┐рди 4096B рд░реЗрдВрдЬ рдХреЗ (рдХреБрдЫ рд╣рд┐рд╕реНрд╕рд╛ рдЫреЛрдЯреЗ рдмрд┐рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛рддрд╛ рд╣реИ)
* 4 рдмрд┐рди 32768B рд░реЗрдВрдЬ рдХреЗ
* 2 рдмрд┐рди 262144B рд░реЗрдВрдЬ рдХреЗ
* рдмрдЪреА рд╣реБрдИ рдЖрдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП 1 рдмрд┐рди

<details>

<summary>рдмрдбрд╝реЗ рдмрд┐рди рдЖрдХрд╛рд░ рдХреЛрдб</summary>
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711

#define largebin_index_32(sz)                                                \
(((((unsigned long) (sz)) >> 6) <= 38) ?  56 + (((unsigned long) (sz)) >> 6) :\
((((unsigned long) (sz)) >> 9) <= 20) ?  91 + (((unsigned long) (sz)) >> 9) :\
((((unsigned long) (sz)) >> 12) <= 10) ? 110 + (((unsigned long) (sz)) >> 12) :\
((((unsigned long) (sz)) >> 15) <= 4) ? 119 + (((unsigned long) (sz)) >> 15) :\
((((unsigned long) (sz)) >> 18) <= 2) ? 124 + (((unsigned long) (sz)) >> 18) :\
126)

#define largebin_index_32_big(sz)                                            \
(((((unsigned long) (sz)) >> 6) <= 45) ?  49 + (((unsigned long) (sz)) >> 6) :\
((((unsigned long) (sz)) >> 9) <= 20) ?  91 + (((unsigned long) (sz)) >> 9) :\
((((unsigned long) (sz)) >> 12) <= 10) ? 110 + (((unsigned long) (sz)) >> 12) :\
((((unsigned long) (sz)) >> 15) <= 4) ? 119 + (((unsigned long) (sz)) >> 15) :\
((((unsigned long) (sz)) >> 18) <= 2) ? 124 + (((unsigned long) (sz)) >> 18) :\
126)

// XXX It remains to be seen whether it is good to keep the widths of
// XXX the buckets the same or whether it should be scaled by a factor
// XXX of two as well.
#define largebin_index_64(sz)                                                \
(((((unsigned long) (sz)) >> 6) <= 48) ?  48 + (((unsigned long) (sz)) >> 6) :\
((((unsigned long) (sz)) >> 9) <= 20) ?  91 + (((unsigned long) (sz)) >> 9) :\
((((unsigned long) (sz)) >> 12) <= 10) ? 110 + (((unsigned long) (sz)) >> 12) :\
((((unsigned long) (sz)) >> 15) <= 4) ? 119 + (((unsigned long) (sz)) >> 15) :\
((((unsigned long) (sz)) >> 18) <= 2) ? 124 + (((unsigned long) (sz)) >> 18) :\
126)

#define largebin_index(sz) \
(SIZE_SZ == 8 ? largebin_index_64 (sz)                                     \
: MALLOC_ALIGNMENT == 16 ? largebin_index_32_big (sz)                     \
: largebin_index_32 (sz))
```
</details>

<details>

<summary>рдПрдХ рдмрдбрд╝реЗ рдЪрдВрдХ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдЬреЛрдбрд╝реЗрдВ</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunks[2];

chunks[0] = malloc(0x1500);
chunks[1] = malloc(0x1500);
free(chunks[0]);
chunks[0] = malloc(0x2000);

return 0;
}
```
2 рдмрдбрд╝реА рдЖрд╡рдВрдЯрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдлрд┐рд░ рдПрдХ рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ) рдФрд░ рдПрдХ рдмрдбрд╝реА рдЖрд╡рдВрдЯрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬрд┐рд╕рд╕реЗ рдореБрдХреНрдд рд╡рд╛рд▓рд╛ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╕реЗ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ)ред

рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдХрд░реЗрдВ рдФрд░ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╕реЗ рд░реЗрдЯ рдУрдкрдХреЛрдб рдореЗрдВ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рде рдбреАрдмрдЧ рдХрд░реЗрдВред рдлрд┐рд░ gef рдХреЗ рд╕рд╛рде рдЖрдк рдЯреАрдХреИрд╢ рдмрд┐рди рднрд░рдиреЗ рдФрд░ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
gefтЮд  heap bin
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Tcachebins for thread 1 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
All tcachebins are empty
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Fastbins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
Fastbins[idx=0, size=0x20] 0x00
Fastbins[idx=1, size=0x30] 0x00
Fastbins[idx=2, size=0x40] 0x00
Fastbins[idx=3, size=0x50] 0x00
Fastbins[idx=4, size=0x60] 0x00
Fastbins[idx=5, size=0x70] 0x00
Fastbins[idx=6, size=0x80] 0x00
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Unsorted Bin for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
[+] Found 0 chunks in unsorted bin.
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Small Bins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
[+] Found 0 chunks in 0 small non-empty bins.
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА Large Bins for arena at 0xfffff7f90b00 тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
[+] large_bins[100]: fw=0xaaaaaaac1290, bk=0xaaaaaaac1290
тЖТ   Chunk(addr=0xaaaaaaac12a0, size=0x1510, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[+] Found 1 chunks in 1 large non-empty bins.
```
</details>

### рд╢реАрд░реНрд╖ рдЯреБрдХрдбрд╝реА
```c
// From https://github.com/bminor/glibc/blob/a07e000e82cb71238259e674529c37c12dc7d423/malloc/malloc.c#L1711

/*
Top

The top-most available chunk (i.e., the one bordering the end of
available memory) is treated specially. It is never included in
any bin, is used only if no other chunk is available, and is
released back to the system if it is very large (see
M_TRIM_THRESHOLD).  Because top initially
points to its own bin with initial zero size, thus forcing
extension on the first malloc request, we avoid having any special
code in malloc to check whether it even exists yet. But we still
need to do so when getting memory from system, so we make
initial_top treat the bin as a legal but unusable chunk during the
interval between initialization and the first call to
sysmalloc. (This is somewhat delicate, since it relies on
the 2 preceding words to be zero during this interval as well.)
*/

/* Conveniently, the unsorted bin can be used as dummy top on first call */
#define initial_top(M)              (unsorted_chunks (M))
```
рдЖрдо рддреМрд░ рдкрд░, рдпрд╣ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рд╡рд░реНрддрдорд╛рди рдореЗрдореЛрд░реА рд╣реИред рдЬрдм рдПрдХ malloc рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрдЧрд░ рдХреЛрдИ рдЙрдкрд▓рдмреНрдз рдлреНрд░реА рдЪрдВрдХ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ рдЯреЙрдк рдЪрдВрдХ рдЕрдкрдиреЗ рдЖрдХрд╛рд░ рдХреЛ рдХрдо рдХрд░рдХреЗ рдЖрд╡рд╢реНрдпрдХ рд╕реНрдерд╛рди рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред\
рдЯреЙрдк рдЪрдВрдХ рдХрд╛ рдкреЙрдЗрдВрдЯрд░ `malloc_state` рд╕реНрдЯреНрд░рдХреНрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╢реБрд░реБрдЖрдд рдореЗрдВ, рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдЪрдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреЙрдк рдЪрдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

<details>

<summary>рдЯреЙрдк рдЪрдВрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ</summary>
```c
#include <stdlib.h>
#include <stdio.h>

int main(void)
{
char *chunk;
chunk = malloc(24);
printf("Address of the chunk: %p\n", (void *)chunk);
gets(chunk);
return 0;
}
```
рдЬрдм рдореИрдВрдиреЗ рдЗрд╕реЗ рдХрдВрдкрд╛рдЗрд▓ рдФрд░ рдбреАрдмрдЧ рдХрд┐рдпрд╛ рдФрд░ рдореБрдЦреНрдп рдХреЛрдб рдХреЗ рд░реЗрдЯ рдУрдкрдХреЛрдб рдореЗрдВ рдПрдХ рдмреНрд░реЗрдХ рдкреЙрдЗрдВрдЯ рдХреЗ рд╕рд╛рде рджреЗрдЦрд╛, рддреЛ рдореБрдЭреЗ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдореИрд▓реЛрдХ рдиреЗ рдкрддрд╛ рджрд┐рдпрд╛: `0xaaaaaaac12a0` рдФрд░ рдпреЗ рдЪрдВрдХ рд╣реИрдВ:
```bash
gefтЮд  heap chunks
Chunk(addr=0xaaaaaaac1010, size=0x290, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac1010     00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................]
Chunk(addr=0xaaaaaaac12a0, size=0x20, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac12a0     41 41 41 41 41 41 41 00 00 00 00 00 00 00 00 00    AAAAAAA.........]
Chunk(addr=0xaaaaaaac12c0, size=0x410, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac12c0     41 64 64 72 65 73 73 20 6f 66 20 74 68 65 20 63    Address of the c]
Chunk(addr=0xaaaaaaac16d0, size=0x410, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)
[0x0000aaaaaaac16d0     41 41 41 41 41 41 41 0a 00 00 00 00 00 00 00 00    AAAAAAA.........]
Chunk(addr=0xaaaaaaac1ae0, size=0x20530, flags=PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)  тЖР  top chunk
```
рдЬрд╣рд╛рдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХрд╛ рдкрддрд╛ `0xaaaaaaac1ae0` рдкрд░ рд╣реИред рдпрд╣ рдХреЛрдИ рдЖрд╢реНрдЪрд░реНрдп рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдирд╡реАрдирддрдо рдЖрд╡рдВрдЯрд┐рдд рдЪрдВрдХ `0xaaaaaaac12a0` рдореЗрдВ рдерд╛ рдЬрд┐рд╕рдХрд╛ рдЖрдХрд╛рд░ `0x410` рдерд╛ рдФрд░ `0xaaaaaaac12a0 + 0x410 = 0xaaaaaaac1ae0`ред\
рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреА рд▓рдВрдмрд╛рдИ рдХреЛ рдЙрд╕рдХреЗ рдЪрдВрдХ рд╣реЗрдбрд░ рдкрд░ рднреА рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```bash
gefтЮд  x/8wx 0xaaaaaaac1ae0 - 16
0xaaaaaaac1ad0:	0x00000000	0x00000000	0x00020531	0x00000000
0xaaaaaaac1ae0:	0x00000000	0x00000000	0x00000000	0x00000000
```
</details>

### рдЕрдВрддрд┐рдо рдЕрдиреБрд╕реНрдорд╛рд░рдХ

рдЬрдм malloc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЪрдВрдХ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЕрдирд▓рд┐рдВрдХреНрдб рд╕реВрдЪреА рд╕реЗ рдпрд╛ рдКрдкрд░реА рдЪрдВрдХ рд╕реЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП), рд╡рд┐рднрд╛рдЬрд┐рдд рдЪрдВрдХ рд╕реЗ рдмрдЪреА рд╣реБрдИ рдЪрдВрдХ рд╕реЗ рдмрдирд╛рдИ рдЧрдИ рдЪрдВрдХ рдХреЛ рдЕрдВрддрд┐рдо рдЕрдиреБрд╕реНрдорд╛рд░рдХ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдкреЙрдЗрдВрдЯрд░ `malloc_state` рд╕рдВрд░рдЪрд┐ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## рдЖрд╡рдВрдЯрди рдкреНрд░рд╡рд╛рд╣

рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="heap-memory-functions/malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](heap-memory-functions/malloc-and-sysmalloc.md)
{% endcontent-ref %}

## рдореБрдХреНрддрд┐ рдкреНрд░рд╡рд╛рд╣

рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="heap-memory-functions/free.md" %}
[free.md](heap-memory-functions/free.md)
{% endcontent-ref %}

## рд╣реАрдк рдлрд╝рдВрдХреНрд╢рди рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪ

рд╣реАрдк рдореЗрдВ рдкреНрд░рдореБрдЦ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕реБрд░рдХреНрд╖рд╛ рдЬрд╛рдВрдЪ рдХреАрдЬрд┐рдП:

{% content-ref url="heap-memory-functions/heap-functions-security-checks.md" %}
[heap-functions-security-checks.md](heap-memory-functions/heap-functions-security-checks.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/](https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/)
* [https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/](https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/)
* [https://heap-exploitation.dhavalkapil.com/diving\_into\_glibc\_heap/core\_functions](https://heap-exploitation.dhavalkapil.com/diving\_into\_glibc\_heap/core\_functions)
* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/implementation/tcache/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/implementation/tcache/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ **HackTricks** рдореЗрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдЖрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **HackTricks** рдФрд░ **HackTricks Cloud** github рд░реЗрдкреЛ рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
