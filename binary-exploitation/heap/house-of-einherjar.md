# Huis van Einherjar

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Basiese Inligting

### Kode

* Kyk na die voorbeeld van [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Of di√© van [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (jy mag die tcache moet vul)

### Doel

* Die doel is om geheue by amper enige spesifieke adres toe te ken.

### Vereistes

* Skep 'n vals stuk wanneer ons 'n stuk wil toeken:
* Stel aanwysers in om na homself te wys om sinnigheidskontroles te omseil
* Af een oor van een stuk na 'n ander om die vorige in gebruik te wysig
* Dui in die `prev_size` van die af-een-oor misbruikte stuk die verskil tussen homself en die vals stuk aan
* Die grootte van die vals stuk moet ook dieselfde grootte wees om sinnigheidskontroles te omseil
* Vir die konstruksie van hierdie stukke, sal jy 'n hoop lek nodig h√™.

### Aanval

* 'n Valse stuk word binne 'n stuk wat deur die aanvaller beheer word, geskep wat met `fd` en `bk` na die oorspronklike stuk wys om beskerming te omseil
* 2 ander stukke (`B` en `C`) word toegewys
* Deur die af-een-oor in die `B` te misbruik, word die `prev in gebruik`-bit skoongemaak en die `prev_size`-data word oorskryf met die verskil tussen die plek waar die `C`-stuk toegewys is, na die vals `A`-stuk wat vooraf gegenereer is
* Hierdie `prev_size` en die grootte in die vals stuk `A` moet dieselfde wees om kontroles te omseil.
* Dan word die tcache gevul
* Dan word `C` vrygelaat sodat dit konsolideer met die vals stuk `A`
* Dan word 'n nuwe stuk `D` geskep wat in die vals `A`-stuk sal begin en die `B`-stuk sal dek
* Die huis van Einherjar eindig hier
* Dit kan voortgesit word met 'n vinnige bin-aanval:
* Vry `B` om dit by die vinnige bin te voeg
* `B` se `fd` word oorskryf sodat dit na die teikenadres wys deur die `D`-stuk te misbruik (omdat dit `B` binne bevat)&#x20;
* Dan word 2 mallocs gedoen en die tweede een gaan die **teikenadres toeken**

## Verwysings en ander voorbeelde

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Nadat aanwysers vrygelaat is, word hulle nie genullifiseer nie, dus is dit steeds moontlik om by hul data te kom. Daarom word 'n stuk in die ongesorteerde bin geplaas en die aanwysers wat dit bevat, gelek (libc-lek) en dan word 'n nuwe hoop in die ongesorteerde bin geplaas en word 'n hoopadres gelek van die aanwyser wat dit kry.
*

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
