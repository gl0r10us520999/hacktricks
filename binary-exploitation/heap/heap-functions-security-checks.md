# Verificaci√≥n de Seguridad de Funciones de Heap

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## unlink

Esta funci√≥n elimina un fragmento de una lista doblemente enlazada. Las verificaciones comunes aseguran que la estructura de la lista enlazada permanezca consistente al desvincular fragmentos.

* **Verificaciones de Consistencia**:
* Verificar si `P->fd->bk == P` y `P->bk->fd == P`.
* Mensaje de error: `corrupted double-linked list`

## \_int\_malloc

Esta funci√≥n es responsable de asignar memoria desde el heap. Las verificaciones aqu√≠ aseguran que la memoria no se corrompa durante la asignaci√≥n.

* **Verificaci√≥n de Tama√±o de Fastbin**:
* Al eliminar un fragmento de un fastbin, aseg√∫rate de que el tama√±o del fragmento est√© dentro del rango de fastbin.
* Mensaje de error: `malloc(): memory corruption (fast)`
* **Verificaci√≥n de Consistencia de Smallbin**:
* Al eliminar un fragmento de un smallbin, aseg√∫rate de que los enlaces previo y siguiente en la lista doblemente enlazada sean consistentes.
* Mensaje de error: `malloc(): smallbin double linked list corrupted`
* **Verificaci√≥n de Rango de Memoria de Unsorted Bin**:
* Aseg√∫rate de que el tama√±o de los fragmentos en el unsorted bin est√© dentro de los l√≠mites m√≠nimo y m√°ximo.
* Mensaje de error: `malloc(): memory corruption | malloc(): invalid next size (unsorted)`
* **Verificaci√≥n de Consistencia de Unsorted Bin (Primer Escenario)**:
* Al insertar un fragmento restante en el unsorted bin, verifica si `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Mensaje de error: `malloc(): corrupted unsorted chunks`
* **Verificaci√≥n de Consistencia de Unsorted Bin (Segundo Escenario)**:
* Igual que la verificaci√≥n anterior, pero se activa al insertar despu√©s de dividir un fragmento r√°pido o peque√±o.
* Mensaje de error: `malloc(): corrupted unsorted chunks 2`

## \_int\_free

Esta funci√≥n libera la memoria previamente asignada. Las verificaciones aqu√≠ ayudan a garantizar una correcta liberaci√≥n de memoria y prevenir la corrupci√≥n de memoria.

* **Verificaci√≥n de L√≠mites del Puntero**:
* Aseg√∫rate de que el puntero que se est√° liberando no est√© envolviendo la memoria.
* Mensaje de error: `free(): invalid pointer`
* **Verificaci√≥n de Tama√±o**:
* Aseg√∫rate de que el tama√±o del fragmento que se est√° liberando sea al menos `MINSIZE` o un m√∫ltiplo de `MALLOC_ALIGNMENT`.
* Mensaje de error: `free(): invalid size`
* **Verificaci√≥n de Tama√±o de Fastbin**:
* Para fragmentos de fastbin, aseg√∫rate de que el tama√±o del siguiente fragmento est√© dentro de los l√≠mites m√≠nimo y m√°ximo.
* Mensaje de error: `free(): invalid next size (fast)`
* **Verificaci√≥n de Doble Liberaci√≥n en Fastbin**:
* Al insertar un fragmento en un fastbin, aseg√∫rate de que el fragmento en la cabeza no sea el mismo que el que se est√° insertando.
* Mensaje de error: `double free or corruption (fasttop)`
* **Verificaci√≥n de Consistencia de Fastbin**:
* Al insertar en un fastbin, aseg√∫rate de que los tama√±os del fragmento en la cabeza y el fragmento que se est√° insertando sean iguales.
* Mensaje de error: `invalid fastbin entry (free)`
* **Verificaci√≥n de Consistencia de Top Chunk**:
* Para fragmentos que no son de fastbin, aseg√∫rate de que el fragmento no sea el mismo que el top chunk.
* Mensaje de error: `double free or corruption (top)`
* **Verificaci√≥n de L√≠mites de Memoria**:
* Aseg√∫rate de que el siguiente fragmento por memoria est√© dentro de los l√≠mites del √°rea.
* Mensaje de error: `double free or corruption (out)`
* **Verificaci√≥n de Bit Prev\_inuse**:
* Aseg√∫rate de que el bit previo en uso en el siguiente fragmento est√© marcado.
* Mensaje de error: `double free or corruption (!prev)`
* **Verificaci√≥n de Tama√±o Normal**:
* Aseg√∫rate de que el tama√±o del siguiente fragmento est√© dentro de rangos v√°lidos.
* Mensaje de error: `free(): invalid next size (normal)`
* **Verificaci√≥n de Consistencia de Unsorted Bin**:
* Al insertar un fragmento fusionado en el unsorted bin, verifica si `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`.
* Mensaje de error: `free(): corrupted unsorted chunks`

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
