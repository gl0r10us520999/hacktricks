# House of Force

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

### рдХреЛрдб

* рдпрд╣ рддрдХрдиреАрдХ рдкреИрдЪ рдХреА рдЧрдИ рдереА ([**рдпрд╣рд╛рдБ**](https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=30a17d8c95fbfb15c52d1115803b63aaa73a285c)) рдФрд░ рдпрд╣ рддреНрд░реБрдЯрд┐ рдЙрддреНрдкрдиреНрди рдХрд░рддреА рд╣реИ: `malloc(): corrupted top size`
* рдЖрдк рдЗрд╕реЗ рдЯреЗрд╕реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**рдпрд╣рд╛рдБ рд╕реЗ рдХреЛрдб рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ**](https://guyinatuxedo.github.io/41-house\_of\_force/house\_force\_exp/index.html)ред

### рд▓рдХреНрд╖реНрдп

* рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрддреЗ рдкрд░ рдПрдХ рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред

### рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

* рдПрдХ рдУрд╡рд░рдлреНрд▓реЛ рдЬреЛ рд╢реАрд░реНрд╖ рдЪрдВрдХ рд╣реЗрдбрд░ рдХрд╛ рдЖрдХрд╛рд░ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдЙрджрд╛. -1)ред
* рд╣реАрдк рдЖрд╡рдВрдЯрди рдХрд╛ рдЖрдХрд╛рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдирд╛

### рд╣рдорд▓рд╛

рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХрд┐рд╕реА рдкрддреЗ P рдкрд░ рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣рд╛рдБ рдХрд╛ рдХреЛрдИ рдорд╛рди рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рд╣реЛред рд╡рд╣ `-1` рдХреЗ рд╕рд╛рде рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХрд╛ рдЖрдХрд╛рд░ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ (рд╢рд╛рдпрдж рдПрдХ рдУрд╡рд░рдлреНрд▓реЛ рдХреЗ рд╕рд╛рде)ред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ malloc рдХрд┐рд╕реА рднреА рдЖрд╡рдВрдЯрди рдХреЗ рд▓рд┐рдП mmap рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдореЗрдВ рд╣рдореЗрд╢рд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╕реНрдерд╛рди рд╣реЛрдЧрд╛ред

рдлрд┐рд░, рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рдкрддреЗ рдФрд░ рд▓рдХреНрд╖реНрдп рд╕реНрдерд╛рди рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрд╡рдВрдЯрди рдХреЗ рд▓рд┐рдП рдЙрд╕ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде malloc рдХрд┐рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕рд╕реЗ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдкрд░ рд▓реЗ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПред рдпрд╣ рдЕрдВрддрд░/рдЖрдХрд╛рд░ рдЖрд╕рд╛рдиреА рд╕реЗ рдЧрдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```c
// From https://github.com/shellphish/how2heap/blob/master/glibc_2.27/house_of_force.c#L59C2-L67C5
/*
* The evil_size is calulcated as (nb is the number of bytes requested + space for metadata):
* new_top = old_top + nb
* nb = new_top - old_top
* req + 2sizeof(long) = new_top - old_top
* req = new_top - old_top - 2sizeof(long)
* req = target - 2sizeof(long) - old_top - 2sizeof(long)
* req = target - old_top - 4*sizeof(long)
*/
```
рдЗрд╕рд▓рд┐рдП, `target - old_top - 4*sizeof(long)` рдХрд╛ рдЖрдХрд╛рд░ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ (4 longs рдХреНрдпреЛрдВрдХрд┐ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдФрд░ рдирдП рдЪрдВрдХ рдХреЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рдХрд╛рд░рдг) рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЛ рд╣рдореЗрдВ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд╛рд╣рд┐рдП рд╡рд╛рд▓реЗ рдкрддреЗ рдкрд░ рд▓реЗ рдЬрд╛рдПрдЧрд╛ред\
рдлрд┐рд░, рдПрдХ рдФрд░ malloc рдХрд░реЗрдВ рддрд╛рдХрд┐ рдбреЗрдЯрд╛ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдПрдХ рдЪрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдХреНрд╖рд┐рдд рдкрддреЗ рдХреЛред
