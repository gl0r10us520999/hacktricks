# рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}

## рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА

рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдХреНрдпрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рджреЗрдЦреЗрдВ:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

рдЕрдирд╕реЙрд░реНрдЯреЗрдб рд╕реВрдЪрд┐рдпрд╛рдБ `bk` рдкрддреЗ рдореЗрдВ `unsorted_chunks (av)` рдХрд╛ рдкрддрд╛ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЪрдВрдХ рдореЗрдВ `bk` рдкреЙрдЗрдВрдЯрд░ рдХреЗ рдкрддреЗ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**, рддреЛ рд╡рд╣ **рдЙрд╕ рдкрддреЗ рдХреЛ рдПрдХ рдордирдорд╛рдиреЗ рдкрддреЗ рдкрд░ рд▓рд┐рдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИ** рдЬреЛ Glibc рдкрддреЗ рд▓реАрдХ рдХрд░рдиреЗ рдпрд╛ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рддреЛ, рдореВрд▓ рд░реВрдк рд╕реЗ, рдпрд╣ рд╣рдорд▓рд╛ **рдПрдХ рдордирдорд╛рдиреЗ рдкрддреЗ рдкрд░ рдПрдХ рдмрдбрд╝рд╛ рдирдВрдмрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред рдпрд╣ рдмрдбрд╝рд╛ рдирдВрдмрд░ рдПрдХ рдкрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╣реАрдк рдкрддрд╛ рдпрд╛ рдПрдХ Glibc рдкрддрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд▓рдХреНрд╖реНрдп **`global_max_fast`** рд╣реИ рддрд╛рдХрд┐ рдмрдбрд╝реЗ рдЖрдХрд╛рд░ рдХреЗ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдмрд┐рди рдмрдирд╛рдП рдЬрд╛ рд╕рдХреЗрдВ (рдФрд░ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ рд╕реЗ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЕрдЯреИрдХ рдореЗрдВ рдЬрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ)ред

{% hint style="success" %}
[https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#principle](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#principle) рдореЗрдВ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реБрдП рдФрд░ 0x4000 рдФрд░ 0x5000 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП 0x400 рдФрд░ 0x500 рдХреЗ рдмрдЬрд╛рдп рдЪрдВрдХ рдЖрдХрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ (Tcache рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП) рдпрд╣ рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдЖрдЬрдХрд▓** рддреНрд░реБрдЯрд┐ **`malloc(): unsorted double linked list corrupted`** рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ рдЕрдм (рдЕрдиреНрдп рдЬрд╛рдВрдЪреЛрдВ рдХреЗ рдмреАрдЪ) рдбрдмрд▓ рд▓рд┐рдВрдХреНрдб рд▓рд┐рд╕реНрдЯ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ `victim->bk->fd == victim` рдпрд╛ рдирд╣реАрдВ `victim->fd == av (arena)` рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЬрд┐рд╕ рдкрддреЗ рдкрд░ рд╣рдо рд▓рд┐рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрд╕рдореЗрдВ рдлреЗрдХ рдЪрдВрдХ рдХрд╛ рдкрддрд╛ рдЙрд╕рдХреЗ `fd` рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдлреЗрдХ рдЪрдВрдХ `fd` рдПрд░реЗрдирд╛ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИред
{% endhint %}

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд╣рдорд▓рд╛ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдХреЛ рднреНрд░рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ (рдЗрд╕рд▓рд┐рдП рдЫреЛрдЯреЗ рдФрд░ рдмрдбрд╝реЗ рднреА)ред рдЗрд╕рд▓рд┐рдП рд╣рдо рдХреЗрд╡рд▓ **рдЕрдм рдлрд╛рд╕реНрдЯ рдмрд┐рди рд╕реЗ рдЖрд╡рдВрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдПрдХ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЕрдиреНрдп рдЖрд╡рдВрдЯрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреНрд░реИрд╢ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ), рдФрд░ рдЗрд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ **рд╕рдорд╛рди рдЖрдХрд╛рд░ рдХрд╛ рдЖрд╡рдВрдЯрди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреНрд░реИрд╢ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред**

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`global_max_fast`** рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╣ рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдлрд╛рд╕реНрдЯ рдмрд┐рди рд╕рднреА рдЕрдиреНрдп рдЖрд╡рдВрдЯрдиреЛрдВ рдХрд╛ рдзреНрдпрд╛рди рд░рдЦ рд╕рдХреЗрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛ред
{% endhint %}

[**guyinatuxedo**](https://guyinatuxedo.github.io/31-unsortedbin\_attack/unsorted\_explanation/index.html) рдХрд╛ рдХреЛрдб рдЗрд╕реЗ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕рдордЭрд╛рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрджрд┐ рдЖрдк mallocs рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП рддрд╛рдХрд┐ Tcache рдореЗрдВ рд╕рдорд╛рдкреНрдд рди рд╣реЛ, рддреЛ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рддреНрд░реБрдЯрд┐ рдкреНрд░рдХрдЯ рд╣реЛрддреА рд╣реИ рдЬреЛ рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рд░реЛрдХрддреА рд╣реИ: **`malloc(): unsorted double linked list corrupted`**

## рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЗрдиреНрдлреЛрд▓реАрдХ рдЕрдЯреИрдХ

рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рдмрд╣реБрдд рдмреБрдирд┐рдпрд╛рджреА рдЕрд╡рдзрд╛рд░рдгрд╛ рд╣реИред рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЪрдВрдХ рдореЗрдВ рдкреЙрдЗрдВрдЯрд░реНрд╕ рд╣реЛрдВрдЧреЗред рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдкрд╣рд▓рд╛ рдЪрдВрдХ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **`fd`** рдФрд░ **`bk`** рд▓рд┐рдВрдХ рдХреЛ **рдореБрдЦреНрдп рдПрд░реЗрдирд╛ (Glibc)** рдХреЗ рдПрдХ рднрд╛рдЧ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ред\
рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк **рдПрдХ рдЪрдВрдХ рдХреЛ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ** (рдлреНрд░реА рдХреЗ рдмрд╛рдж рдЙрдкрдпреЛрдЧ) рдпрд╛ **рдХрдо рд╕реЗ рдХрдо 1 рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдП рдмрд┐рдирд╛ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдлрд┐рд░ **рдЗрд╕реЗ рдкрдврд╝ рд╕рдХреЗрдВ**, рддреЛ рдЖрдк рдПрдХ **Glibc рдЗрдиреНрдлреЛрд▓реАрдХ** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХ рд╕рдорд╛рди [**рд╣рдорд▓рд╛ рдЬреЛ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛**](https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw18\_alienVSsamurai/index.html), 4 рдЪрдВрдХ рд╕рдВрд░рдЪрдирд╛ (A, B, C рдФрд░ D - D рдХреЗрд╡рд▓ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ) рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдерд╛, рдЗрд╕рд▓рд┐рдП B рдореЗрдВ рдПрдХ рдирд▓ рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рддрд╛рдХрд┐ C рдпрд╣ рд╕рдВрдХреЗрдд рджреЗ рд╕рдХреЗ рдХрд┐ B рдЕрдкреНрд░рдпреБрдХреНрдд рдерд╛ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, B рдореЗрдВ `prev_size` рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рддрд╛рдХрд┐ рдЖрдХрд╛рд░ B рдХрд╛ рдЖрдХрд╛рд░ рд╣реЛрдиреЗ рдХреЗ рдмрдЬрд╛рдп A+B рд╣реЛред\
рдлрд┐рд░ C рдХреЛ рдбрд┐рдПрдХреНрд▓реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛, рдФрд░ A+B рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ (рд▓реЗрдХрд┐рди B рдЕрднреА рднреА рдЙрдкрдпреЛрдЧ рдореЗрдВ рдерд╛)ред рдЖрдХрд╛рд░ A рдХрд╛ рдПрдХ рдирдпрд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдФрд░ рдлрд┐рд░ libc рд▓реАрдХ рдХрд┐рдП рдЧрдП рдкрддреЗ B рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдЬрд╣рд╛рдВ рд╕реЗ рд╡реЗ рд▓реАрдХ рд╣реБрдПред

## рд╕рдВрджрд░реНрдн рдФрд░ рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг

* [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#hitcon-training-lab14-magic-heap**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#hitcon-training-lab14-magic-heap)
* рд▓рдХреНрд╖реНрдп рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ рдХреЛ 4869 рд╕реЗ рдЕрдзрд┐рдХ рдорд╛рди рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ рдХрд┐ рдзреНрд╡рдЬ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ PIE рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИред
* рдпрд╣ рдордирдорд╛рдиреЗ рдЖрдХрд╛рд░ рдХреЗ рдЪрдВрдХ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдЗрдЪреНрдЫрд┐рдд рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╣реАрдк рдУрд╡рд░рдлреНрд▓реЛ рд╣реИред
* рд╣рдорд▓рд╛ 3 рдЪрдВрдХ рдмрдирд╛рдиреЗ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ: рдЪрдВрдХ0 рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЪрдВрдХ1 рдУрд╡рд░рдлреНрд▓реЛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдЪрдВрдХ2 рддрд╛рдХрд┐ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдкрд┐рдЫрд▓реЗ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрд┐рдд рди рд╣реЛред
* рдлрд┐рд░, рдЪрдВрдХ1 рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЪрдВрдХ0 рдХреЛ рдУрд╡рд░рдлреНрд▓реЛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЪрдВрдХ1 рдХрд╛ `bk` рдкреЙрдЗрдВрдЯрд░ рдЗрд╕ рдкрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗ: `bk = magic - 0x10`
* рдлрд┐рд░, рдЪрдВрдХ3 рдХреЛ рдЪрдВрдХ1 рдХреЗ рд╕рдорд╛рди рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ рдФрд░ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ рдХреЗ рдорд╛рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рдзреНрд╡рдЬ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред
* [**https://guyinatuxedo.github.io/31-unsortedbin\_attack/0ctf16\_zerostorage/index.html**](https://guyinatuxedo.github.io/31-unsortedbin\_attack/0ctf16\_zerostorage/index.html)
* рдорд░реНрдЬ рдлрд╝рдВрдХреНрд╢рди рдХрдордЬреЛрд░ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рджреЛрдиреЛрдВ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдЕрдиреБрдХреНрд░рдорд╛рдВрдХ рд╕рдорд╛рди рд╣реИрдВ рддреЛ рдпрд╣ рдЙрд╕ рдкрд░ рдкреБрдирдГ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдореБрдХреНрдд рдХрд░реЗрдЧрд╛ рд▓реЗрдХрд┐рди рдЙрд╕ рдореБрдХреНрдд рдХреНрд╖реЗрддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд▓реМрдЯрд╛рдПрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдЗрд╕рд▓рд┐рдП, **2 рдЪрдВрдХ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ**: **рдЪрдВрдХ0** рдЬрд┐рд╕реЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕рд╛рде рдорд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЪрдВрдХ1 рддрд╛рдХрд┐ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрд┐рдд рди рд╣реЛред рдлрд┐рд░, **рдЪрдВрдХ0 рдХреЗ рд╕рд╛рде рдорд░реНрдЬ рдлрд╝рдВрдХреНрд╢рди** рдХреЛ рджреЛ рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдлреНрд░реА рдХреЗ рдмрд╛рдж рдЙрдкрдпреЛрдЧ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧрд╛ред
* рдлрд┐рд░, **`view`** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЕрдиреБрдХреНрд░рдорд╛рдВрдХ 2 (рдЬреЛ рдлреНрд░реА рдХреЗ рдмрд╛рдж рдЙрдкрдпреЛрдЧ рдЪрдВрдХ рдХрд╛ рдЕрдиреБрдХреНрд░рдорд╛рдВрдХ рд╣реИ) рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ **libc рдкрддрд╛ рд▓реАрдХ рдХрд░реЗрдЧрд╛**ред
* рдЪреВрдВрдХрд┐ рдмрд╛рдЗрдирд░реА рдореЗрдВ рдХреЗрд╡рд▓ **`global_max_fast`** рд╕реЗ рдмрдбрд╝реЗ рдЖрдХрд╛рд░ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреЛрдИ рдлрд╛рд╕реНрдЯрдмрд┐рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рддрд╛рдХрд┐ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ `global_max_fast` рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдлрд┐рд░, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЕрдиреБрдХреНрд░рдорд╛рдВрдХ 2 (рдлреНрд░реА рдХреЗ рдмрд╛рдж рдЙрдкрдпреЛрдЧ рдкреЙрдЗрдВрдЯрд░) рдХреЗ рд╕рд╛рде рд╕рдВрдкрд╛рджрд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ `bk` рдкреЙрдЗрдВрдЯрд░ рдХреЛ `p64(global_max_fast-0x10)` рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПред рдлрд┐рд░, рдПрдХ рдирдпрд╛ рдЪрдВрдХ рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдореБрдХреНрдд рдкрддреЗ (0x20) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ **рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ** рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ рдЬреЛ `global_max_fast` рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдЧрд╛ рдЬреЛ рдПрдХ рдмрд╣реБрдд рдмрдбрд╝рд╛ рдорд╛рди рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЕрдм рдлрд╛рд╕реНрдЯ рдмрд┐рди рдореЗрдВ рдЪрдВрдХ рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗред
* рдЕрдм рдПрдХ **рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЕрдЯреИрдХ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
* рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ **`__free_hook`** рд╕реНрдерд╛рди рдкрд░ рдлрд╛рд╕реНрдЯ **рдЪрдВрдХ рдХреЗ рдЖрдХрд╛рд░ 200** рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
* <pre class="language-c"><code class="lang-c">gefтЮд  p &#x26;__free_hook
$1 = (void (**)(void *, const void *)) 0x7ff1e9e607a8 &#x3C;__free_hook>
gefтЮд  x/60gx 0x7ff1e9e607a8 - 0x59
<strong>0x7ff1e9e6074f: 0x0000000000000000      0x0000000000000200
</strong>0x7ff1e9e6075f: 0x0000000000000000      0x0000000000000000
0x7ff1e9e6076f &#x3C;list_all_lock+15>:      0x0000000000000000      0x0000000000000000
0x7ff1e9e6077f &#x3C;_IO_stdfile_2_lock+15>: 0x0000000000000000      0x0000000000000000
</code></pre>
* рдпрджрд┐ рд╣рдо рдЗрд╕ рд╕реНрдерд╛рди рдкрд░ рдЖрдХрд╛рд░ 0x200 рдХрд╛ рдПрдХ рдлрд╛рд╕реНрдЯ рдЪрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдХрд╛рд░ `0xfc` рдХрд╛ рдПрдХ рдирдпрд╛ рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдорд░реНрдЬ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЙрд╕ рдкреЙрдЗрдВрдЯрд░ рдХреЗ рд╕рд╛рде рджреЛ рдмрд╛рд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рддрд░рд╣ рд╣рдо рдлрд╛рд╕реНрдЯ рдмрд┐рди рдореЗрдВ рдЖрдХрд╛рд░ `0xfc*2 = 0x1f8` рдХреЗ рдПрдХ рдореБрдХреНрдд рдЪрдВрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред
* рдлрд┐рд░, рдЗрд╕ рдЪрдВрдХ рдореЗрдВ рд╕рдВрдкрд╛рджрд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдХреЗ **`fd`** рдкрддреЗ рдХреЛ рдкрд┐рдЫрд▓реЗ **`__free_hook`** рдлрд╝рдВрдХреНрд╢рди рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдлрд┐рд░, рдЖрдХрд╛рд░ `0x1f8` рдХрд╛ рдПрдХ рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдлрд╛рд╕реНрдЯ рдмрд┐рди рд╕реЗ рдкрд┐рдЫрд▓реЗ рдмреЗрдХрд╛рд░ рдЪрдВрдХ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рддрд╛рдХрд┐ рдЖрдХрд╛рд░ `0x1f8` рдХрд╛ рдПрдХ рдФрд░ рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рддрд╛рдХрд┐ **`__free_hook`** рдореЗрдВ рдПрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЪрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрд┐рд╕реЗ **`system`** рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
* рдФрд░ рдЕрдВрдд рдореЗрдВ, рдПрдХ рдЪрдВрдХ рдЬрд┐рд╕рдореЗрдВ рд╕реНрдЯреНрд░рд┐рдВрдЧ `/bin/sh\x00` рд╣реИ, рдХреЛ рдбрд┐рд▓реАрдЯ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ **`__free_hook`** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЛ `/bin/sh\x00` рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред
* **CTF** [**https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw19\_traveller/index.html**](https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw19\_traveller/index.html)
* рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЪрдВрдХреНрд╕ рдХреЛ рд╕рдореЗрдХрд┐рдд рдХрд░рдиреЗ рдФрд░ libc рдЗрдиреНрдлреЛрд▓реАрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 1B рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг рдФрд░ рдлрд┐рд░ malloc рд╣реБрдХ рдХреЛ рдПрдХ рдЧреЗрдЬреЗрдЯ рдкрддреЗ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЕрдЯреИрдХ рдХрд░рдирд╛ред
* [**Robot Factory. BlackHat MEA CTF 2022**](https://7rocky.github.io/en/ctf/other/blackhat-ctf/robot-factory/)
* рд╣рдо рдХреЗрд╡рд▓ `0x100` рд╕реЗ рдмрдбрд╝реЗ рдЖрдХрд╛рд░ рдХреЗ рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдЕрдЯреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `global_max_fast` рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдВ (ASLR рдХреЗ рдХрд╛рд░рдг 1/16 рдмрд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ 12 рдмрд┐рдЯреНрд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ 16 рдмрд┐рдЯреНрд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП)ред
* рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрдВрдХреНрд╕ рдХреЗ рдПрд░реЗ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╛рд╕реНрдЯ рдмрд┐рди рдЕрдЯреИрдХред рдпрд╣ рдПрдХ рдордирдорд╛рдиреЗ рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ рдХреА рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рджреЗрддрд╛ рд╣реИ, рдЬреЛ GOT рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдФрд░ рдХреБрдЫ рдлрд╝рдВрдХреНрд╢рди рдХреЛ `system` рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}
