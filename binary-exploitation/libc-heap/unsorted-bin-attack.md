# –ê—Ç–∞–∫–∞ –Ω–∞ –Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–π –±—ñ–Ω

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è AWS Red Team Expert (ARTE) –≤—ñ–¥ HackTricks**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è GCP Red Team Expert (GRTE) –≤—ñ–¥ HackTricks**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —â–æ —Ç–∞–∫–µ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

–ù–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ —Å–ø–∏—Å–∫–∏ –º–æ–∂—É—Ç—å –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –∞–¥—Ä–µ—Å—É —É `unsorted_chunks (av)` –≤ –∞–¥—Ä–µ—Å—É `bk` —á–∞—Å—Ç–∏–Ω–∫–∏. –¢–æ–º—É, —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ **–∑–º—ñ–Ω–∏—Ç–∏ –∞–¥—Ä–µ—Å—É –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞ `bk`** –≤ —á–∞—Å—Ç–∏–Ω—Ü—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–≥–æ –±—ñ–Ω–∞, –≤—ñ–Ω –º–æ–∂–µ **–∑–∞–ø–∏—Å–∞—Ç–∏ —Ü—é –∞–¥—Ä–µ—Å—É –≤ –¥–æ–≤—ñ–ª—å–Ω—É –∞–¥—Ä–µ—Å—É**, —â–æ –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è –≤–∏—Ç–æ–∫—É –∞–¥—Ä–µ—Å Glibc –∞–±–æ –æ–±—Ö—ñ–¥—É –¥–µ—è–∫–∏—Ö –∑–∞—Ö–∏—Å—Ç—ñ–≤.

–û—Ç–∂–µ, –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É, —Ü—è –∞—Ç–∞–∫–∞ –¥–æ–∑–≤–æ–ª—è—î **–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–µ–ª–∏–∫–µ —á–∏—Å–ª–æ –∑–∞ –¥–æ–≤—ñ–ª—å–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é**. –¶–µ –≤–µ–ª–∏–∫–µ —á–∏—Å–ª–æ - —Ü–µ –∞–¥—Ä–µ—Å–∞, —è–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –∞–¥—Ä–µ—Å–æ—é –∫—É–ø–∏ –∞–±–æ –∞–¥—Ä–µ—Å–æ—é Glibc. –¢–∏–ø–æ–≤–æ—é —Ü—ñ–ª–ª—é —î **`global_max_fast`**, —â–æ–± –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —à–≤–∏–¥–∫—ñ –±—ñ–Ω-–±—ñ–Ω–∏ –∑ –±—ñ–ª—å—à–∏–º–∏ —Ä–æ–∑–º—ñ—Ä–∞–º–∏ (—ñ –ø–µ—Ä–µ–π—Ç–∏ –≤—ñ–¥ –∞—Ç–∞–∫–∏ –Ω–∞ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω –¥–æ –∞—Ç–∞–∫–∏ –Ω–∞ —à–≤–∏–¥–∫–∏–π –±—ñ–Ω).

{% hint style="success" %}
–ü–æ–¥–∏–≤–∏–≤—à–∏—Å—å –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥, –Ω–∞–≤–µ–¥–µ–Ω–∏–π –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#principle](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#principle) —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ 0x4000 —Ç–∞ 0x5000 –∑–∞–º—ñ—Å—Ç—å 0x400 —Ç–∞ 0x500 —è–∫ —Ä–æ–∑–º—ñ—Ä–∏ —á–∞—Å—Ç–∏–Ω–æ–∫ (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ Tcache), –º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ **–≤ –Ω–∞—à—ñ –¥–Ω—ñ** —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø–æ–º–∏–ª–∫–∞ **`malloc(): unsorted double linked list corrupted`**.

–û—Ç–∂–µ, —Ü—è –∞—Ç–∞–∫–∞ –Ω–∞ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω —Ç–µ–ø–µ—Ä (–ø–æ–º—ñ–∂ —ñ–Ω—à–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫) —Ç–∞–∫–æ–∂ –≤–∏–º–∞–≥–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–¥–≤—ñ–π–Ω–∏–π –∑–≤'—è–∑–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫, —â–æ–± —Ü–µ –±—É–ª–æ –æ–±—Ö—ñ–¥–Ω–æ `victim->bk->fd == victim` –∞–±–æ –Ω—ñ `victim->fd == av (arena)`, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –∞–¥—Ä–µ—Å–∞, –∫—É–¥–∏ –º–∏ —Ö–æ—á–µ–º–æ –∑–∞–ø–∏—Å–∞—Ç–∏, –ø–æ–≤–∏–Ω–Ω–∞ –º–∞—Ç–∏ –∞–¥—Ä–µ—Å—É —Ñ–∞–ª—å—à–∏–≤–æ—ó —á–∞—Å—Ç–∏–Ω–∫–∏ —É —Å–≤–æ—ó–π –ø–æ–∑–∏—Ü—ñ—ó `fd`, —ñ —â–æ —Ñ–∞–ª—å—à–∏–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ `fd` –≤–∫–∞–∑—É—î –Ω–∞ –∞—Ä–µ–Ω—É.
{% endhint %}

{% hint style="danger" %}
–ó–∞—É–≤–∞–∂—Ç–µ, —â–æ —Ü—è –∞—Ç–∞–∫–∞ –ø–æ—Ä—É—à—É—î –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω (—Ç–æ–º—É –º–∞–ª—ñ —Ç–∞ –≤–µ–ª–∏–∫—ñ —Ç–µ–∂). –¢–æ–º—É –º–∏ –º–æ–∂–µ–º–æ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ª–∏—à–µ –∑—ñ —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω–∞ —Ç–µ–ø–µ—Ä** (—Å–∫–ª–∞–¥–Ω—ñ—à–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –º–æ–∂–µ —Ä–æ–±–∏—Ç–∏ —ñ–Ω—à—ñ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–∞ –∞–≤–∞—Ä—ñ—é–≤–∞—Ç–∏), —ñ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± —Å–ø—Ä–æ–≤–æ–∫—É–≤–∞—Ç–∏ —Ü–µ, –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ **–≤–∏–¥—ñ–ª–∏—Ç–∏ —Ç–∞–∫–∏–π —Å–∞–º–∏–π —Ä–æ–∑–º—ñ—Ä, –∞–±–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –∞–≤–∞—Ä—ñ—é—î.**

–ó–∞—É–≤–∞–∂—Ç–µ, —â–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å **`global_max_fast`** –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É, –¥–æ–≤—ñ—Ä—è—é—á–∏, —â–æ —à–≤–∏–¥–∫–∏–π –±—ñ–Ω –∑–º–æ–∂–µ –¥–æ–≥–ª—è–¥–∞—Ç–∏ –∑–∞ –≤—Å—ñ–º–∞ —ñ–Ω—à–∏–º–∏ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è–º–∏ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –µ–∫—Å–ø–ª–æ–π—Ç—É.
{% endhint %}

–ö–æ–¥ –≤—ñ–¥ [**guyinatuxedo**](https://guyinatuxedo.github.io/31-unsortedbin\_attack/unsorted\_explanation/index.html) –¥–æ–±—Ä–µ –ø–æ—è—Å–Ω—é—î —Ü–µ, —Ö–æ—á–∞, —è–∫—â–æ –≤–∏ –∑–º—ñ–Ω–∏—Ç–µ –≤–∏–∫–ª–∏–∫–∏ malloc –¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ—Ç—Ä–∞–ø–ª—è–Ω–Ω—è –≤ Tcache, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ, —â–æ –∑–≥–∞–¥–∞–Ω–∞ –≤–∏—â–µ –ø–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–∂–∞—î —Ü—ñ–π —Ç–µ—Ö–Ω—ñ—Ü—ñ: **`malloc(): unsorted double linked list corrupted`**

## –ê—Ç–∞–∫–∞ –Ω–∞ –≤–∏—Ç—ñ–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–≥–æ –±—ñ–Ω–∞

–¶–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –¥—É–∂–µ –ø—Ä–æ—Å—Ç–µ –ø–æ–Ω—è—Ç—Ç—è. –ß–∞—Å—Ç–∏–Ω–∫–∏ –≤ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–º—É –±—ñ–Ω—ñ –º–∞—Ç–∏–º—É—Ç—å –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏. –ü–µ—Ä—à–∞ —á–∞—Å—Ç–∏–Ω–∞ –≤ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–º—É –±—ñ–Ω—ñ —Ñ–∞–∫—Ç–∏—á–Ω–æ –º–∞—Ç–∏–º–µ **`fd`** —Ç–∞ **`bk`** –ø–æ—Å–∏–ª–∞–Ω–Ω—è **–Ω–∞ —á–∞—Å—Ç–∏–Ω—É –æ—Å–Ω–æ–≤–Ω–æ—ó –∞—Ä–µ–Ω–∏ (Glibc)**.\
–û—Ç–∂–µ, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–æ–º—ñ—Å—Ç–∏—Ç–∏ —á–∞—Å—Ç–∏–Ω–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—É –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–≥–æ –±—ñ–Ω–∞ —Ç–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —ó—ó** (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è) –∞–±–æ **–≤–∏–¥—ñ–ª–∏—Ç–∏ —ó—ó –∑–Ω–æ–≤—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∏–Ω–∞–π–º–Ω—ñ 1 –∑ –ø–æ—Å–∏–ª–∞–Ω—å**, —â–æ–± –ø–æ—Ç—ñ–º **–ø—Ä–æ—á–∏—Ç–∞—Ç–∏** —ó—ó, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ **–≤–∏—Ç—ñ–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó Glibc**.

–°—Ö–æ–∂–∏–π [**–∞—Ç–∞–∫–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –≤ —Ü—å–æ–º—É –æ–ø–∏—Å—ñ**](https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw18\_alienVSsamurai/index.html), –ø–æ–ª—è–≥–∞–ª–∞ –≤ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∑ 4 —á–∞—Å—Ç–∏–Ω–æ–∫ (A, B, C —Ç–∞ D - D –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ –ª–∏—à–µ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—ó –∑ –≤–µ—Ä—Ö–Ω—å–æ—é —á–∞—Å—Ç–∏–Ω–æ—é) —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –Ω—É–ª—å–æ–≤–∏–º –±–∞–π—Ç–æ–º –≤ B –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–æ—Å—è –¥–ª—è —Ç–æ–≥–æ, —â–æ–± C –≤–∫–∞–∑—É–≤–∞–ª–∞, —â–æ B –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è. –¢–∞–∫–æ–∂, –≤ B –¥–∞–Ω—ñ `prev_size` –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ, —Ç–∞–∫ —â–æ —Ä–æ–∑–º—ñ—Ä –∑–∞–º—ñ—Å—Ç—å —Ä–æ–∑–º—ñ—Ä—É B –±—É–≤ A+B.\
–ü–æ—Ç—ñ–º C –±—É–ª–æ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–æ —Ç–∞ –∫–æ–Ω—Å–æ–ª—ñ–¥–æ–≤–∞–Ω–æ –∑ A+B (–∞–ª–µ B –≤—Å–µ —â–µ –±—É–≤ —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ). –ë—É–ª–æ –≤–∏–¥—ñ–ª–µ–Ω–æ –Ω–æ–≤—É —á–∞—Å—Ç–∏–Ω–∫—É —Ä–æ–∑–º—ñ—Ä–æ–º A, —ñ —Ç–æ–¥—ñ –∞–¥—Ä–µ—Å–∏, –≤–∏—Ç—ñ–∫–Ω—É—Ç—ñ –∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, –±—É–ª–∏ –∑–∞–ø–∏—Å–∞–Ω—ñ –≤ B, –∑–≤—ñ–¥–∫–∏ –≤–æ–Ω–∏ –≤–∏—Ç—ñ–∫–∞–ª–∏.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—à—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

* [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#hitcon-training-lab14-magic-heap**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/unsorted\_bin\_attack/#hitcon-training-lab14-magic-heap)
* –ú–µ—Ç–∞ –ø–æ–ª—è–≥–∞—î –≤ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ñ –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –∑–Ω–∞—á–µ–Ω–Ω—è–º –±—ñ–ª—å—à–µ 4869, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å, —ñ PIE –Ω–µ —É–≤—ñ–º–∫–Ω–µ–Ω–æ.
* –ú–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω–∫–∏ –¥–æ–≤—ñ–ª—å–Ω–∏—Ö —Ä–æ–∑–º—ñ—Ä—ñ–≤, —ñ—Å–Ω—É—î –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –∫—É–ø–∏ –∑ –±–∞–∂–∞–Ω–∏–º —Ä–æ–∑–º—ñ—Ä–æ–º.
* –ê—Ç–∞–∫–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º 3 —á–∞—Å—Ç–∏–Ω–æ–∫: —á–∞—Å—Ç–∏–Ω–∞ 0 –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º, —á–∞—Å—Ç–∏–Ω–∞ 1 –¥–ª—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–∞ —á–∞—Å—Ç–∏–Ω–∞ 2, —â–æ–± –≤–µ—Ä—Ö–Ω—è —á–∞—Å—Ç–∏–Ω–∞ –Ω–µ –∫–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞–ª–∞—Å—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏.
* –ü–æ—Ç—ñ–º —á–∞—Å—Ç–∏–Ω–∞ 1 –≤–∏–≤—ñ–ª—å–Ω—é—î—Ç—å—Å—è, —ñ —á–∞—Å—Ç–∏–Ω–∞ 0 –ø–µ—Ä–µ–ø–æ–≤–Ω—é—î—Ç—å—Å—è, —Ç–∞–∫ —â–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ `bk` —á–∞—Å—Ç–∏–Ω–∫–∏ 1 –≤–∫–∞–∑—É—î –Ω–∞: `bk = magic - 0x10`
* –ü–æ—Ç—ñ–º —á–∞—Å—Ç–∏–Ω–∞ 3 –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è –∑ —Ç–∞–∫–∏–º —Å–∞–º–∏–º —Ä–æ–∑–º—ñ—Ä–æ–º, —è–∫ —á–∞—Å—Ç–∏–Ω–∞ 1, —â–æ —Å–ø—Ä–æ–≤–æ–∫—É—î –∞—Ç–∞–∫—É –Ω–∞ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω —Ç–∞ –∑–º—ñ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó, —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å.
* [**https://guyinatuxedo.github.io/31-unsortedbin\_attack/0ctf16\_zerostorage/index.html**](https://guyinatuxedo.github.io/31-unsortedbin\_attack/0ctf16\_zerostorage/index.html)
* –§—É–Ω–∫—Ü—ñ—è –∑–ª–∏—Ç—Ç—è —î –≤—Ä–∞–∑–ª–∏–≤–æ—é, –æ—Å–∫—ñ–ª—å–∫–∏ —è–∫—â–æ –æ–±–∏–¥–≤–∞ –ø–µ—Ä–µ–¥–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ, –≤–æ–Ω–∞ –ø–µ—Ä–µ—Ä–æ–∑–ø–æ–¥—ñ–ª–∏—Ç—å —ó—Ö, –∞ –ø–æ—Ç—ñ–º –≤–∏–≤—ñ–ª—å–Ω–∏—Ç—å, –∞–ª–µ –ø–æ–≤–µ—Ä–Ω–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ —Ç—É –≤–∏–≤—ñ–ª—å–Ω–µ–Ω—É –æ–±–ª–∞—Å—Ç—å, —è–∫—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏.
* –¢–æ–º—É **—Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è 2 —á–∞—Å—Ç–∏–Ω–∫–∏**: **—á–∞—Å—Ç–∏–Ω–∞ 0**, —è–∫–∞ –±—É–¥–µ –∑–ª–∏—Ç–∞ –∑ —Å–æ–±–æ—é, —Ç–∞ —á–∞—Å—Ç–∏–Ω–∞ 1, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—ó –∑ –≤–µ—Ä—Ö–Ω—å–æ—é —á–∞—Å—Ç–∏–Ω–æ—é. –ü–æ—Ç—ñ–º **–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è –∑–ª–∏—Ç—Ç—è –∑ —á–∞—Å—Ç–∏–Ω–æ—é 0** –¥–≤—ñ—á—ñ, —â–æ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è.
* –ü–æ—Ç—ñ–º –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è **`view`** –∑ —ñ–Ω–¥–µ–∫—Å–æ–º 2 (—ñ–Ω–¥–µ–∫—Å —á–∞—Å—Ç–∏–Ω–∫–∏ –ø—ñ—Å–ª—è –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è), —è–∫–∞ **–≤–∏—Ç—ñ–∫–∞—î –∞–¥—Ä–µ—Å—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**.
* –û—Å–∫—ñ–ª—å–∫–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª –º–∞—î –∑–∞—Ö–∏—Å—Ç–∏, —â–æ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏–¥—ñ–ª—è—Ç–∏ –ª–∏—à–µ —Ä–æ–∑–º—ñ—Ä–∏ –±—ñ–ª—å—à–µ **`global_max_fast`**, —Ç–æ–º—É –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è fastbin, –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –∞—Ç–∞–∫—É –Ω–∞ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó `global_max_fast`.
* –ü–æ—Ç—ñ–º –º–æ–∂–ª–∏–≤–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑ —ñ–Ω–¥–µ–∫—Å–æ–º 2 (–≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –ø—ñ—Å–ª—è –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è) —Ç–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ `bk`, —â–æ–± –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ `p64(global_max_fast-0x10)`. –ü–æ—Ç—ñ–º, —Å—Ç–≤–æ—Ä—é—é—á–∏ –Ω–æ–≤—É —á–∞—Å—Ç–∏–Ω–∫—É, –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ —Ä–∞–Ω—ñ—à–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∞ –∞–¥—Ä–µ—Å–∞ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–Ω—è (0x20) —Ç–∞ **—Å–ø—Ä–æ–≤–æ–∫—É—î –∞—Ç–∞–∫—É –Ω–∞ –Ω–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π –±—ñ–Ω**, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—é—á–∏ `global_max_fast` –∑–Ω–∞—á–µ–Ω–Ω—è–º –¥—É–∂–µ –≤–µ–ª–∏–∫–æ–≥–æ —á–∏—Å–ª–∞, —â–æ –¥–æ–∑–≤–æ–ª—è—î —Ç–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω–∫–∏ –≤ —à–≤–∏–¥–∫–∏—Ö –±—ñ–Ω–∞—Ö.
* –¢–µ–ø–µ—Ä –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–∞—Ç–∞–∫–∞ –Ω–∞ —à–≤–∏–¥–∫–∏–π –±—ñ–Ω**:
* –ü–æ-–ø–µ—Ä—à–µ, –≤–∏—è–≤–ª–µ–Ω–æ, —â–æ –º–æ–∂–Ω–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑—ñ —à–≤–∏–¥–∫–∏–º–∏ **—á–∞—Å—Ç–∏–Ω–∫–∞–º–∏ —Ä–æ–∑–º—ñ—Ä–æ–º 200** –≤ –º—ñ—Å—Ü—ñ **`__free_hook`**:
* <pre class="language-c"><code class="lang-c">gef‚û§  p &#x26;__free_hook
$1 = (void (**)(void *, const void *)) 0x7ff1e9e607a8 &#x3C;__free_hook>
gef‚û§  x/60gx 0x7ff1e9e607a8 - 0x59
<strong>0x7ff1e9e6074f: 0x0000000000000000      0x0000000000000200
</strong>0x7ff1e9e6075f: 0x0000000000000000      0x0000000000000000
0x7ff1e9e6076f &#x3C;list_all_lock+15>:      0x0000000000000000      0x0000000000000000
0x7ff1e9e6077f &#x3C;_IO_stdfile_2_lock+15>: 0x0000000000000000      0x0000000000000000
</code></pre>
* –Ø–∫—â–æ –Ω–∞–º –≤–¥–∞—Å—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–≤–∏–¥–∫–∏–π —á–∞–Ω–∫ —Ä–æ–∑–º—ñ—Ä–æ–º 0x200 —É —Ü—å–æ–º—É –º—ñ—Å—Ü—ñ, –±—É–¥–µ –º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∏–π
* –î–ª—è —Ü—å–æ–≥–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π —á–∞–Ω–∫ —Ä–æ–∑–º—ñ—Ä–æ–º `0xfc` —ñ —Ñ—É–Ω–∫—Ü—ñ—è –∑–ª–∏–≤–∞—î—Ç—å—Å—è –∑ —Ü–∏–º –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º –¥–≤—ñ—á—ñ, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º –º–∏ –æ—Ç—Ä–∏–º—É—î–º–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –≤–∏–≤—ñ–ª—å–Ω–µ–Ω–∏–π —á–∞–Ω–∫ —Ä–æ–∑–º—ñ—Ä–æ–º `0xfc*2 = 0x1f8` —É —à–≤–∏–¥–∫–æ–º—É –±—ñ–Ω—ñ.
* –ü–æ—Ç—ñ–º –≤ —Ü—å–æ–º—É —á–∞–Ω–∫—É –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∞–¥—Ä–µ—Å–∏ **`fd`** —Ü—å–æ–≥–æ —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω–∞, —â–æ–± –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—é —Ñ—É–Ω–∫—Ü—ñ—é **`__free_hook`**.
* –ü–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —á–∞–Ω–∫ —Ä–æ–∑–º—ñ—Ä–æ–º `0x1f8`, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑—ñ —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–∏–π —á–∞–Ω–∫, —Ç–æ–º—É —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —â–µ –æ–¥–∏–Ω —á–∞–Ω–∫ —Ä–æ–∑–º—ñ—Ä–æ–º `0x1f8`, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–≤–∏–¥–∫–∏–π —á–∞–Ω–∫ —É **`__free_hook`**, —è–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è –∞–¥—Ä–µ—Å–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó **`system`**.
* –Ü, –Ω–∞—Ä–µ—à—Ç—ñ, –≤–∏–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è —á–∞–Ω–∫, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Ä—è–¥–æ–∫ `/bin/sh\x00`, –≤–∏–∫–ª–∏–∫–∞—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—é –≤–∏–¥–∞–ª–µ–Ω–Ω—è, —â–æ —Å–ø—Ä–∏—á–∏–Ω—è—î –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó **`__free_hook`**, —è–∫–∞ –≤–∫–∞–∑—É—î –Ω–∞ —Å–∏—Å—Ç–µ–º—É –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `/bin/sh\x00`.
* **CTF** [**https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw19\_traveller/index.html**](https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw19\_traveller/index.html)
* –©–µ –æ–¥–∏–Ω –ø—Ä–∏–∫–ª–∞–¥ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–ª–∏–≤–∞–Ω–Ω—è–º 1B –¥–ª—è –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—ó —á–∞–Ω–∫—ñ–≤ —É –Ω–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ–º—É –±—ñ–Ω—ñ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ libc, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω—É –∞—Ç–∞–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞–Ω–Ω—è –≥–∞—á–∫–∞ malloc –∞–¥—Ä–µ—Å–æ—é –æ–¥–Ω–æ–≥–æ –≥–∞–¥–∂–µ—Ç–∞
* [**Robot Factory. BlackHat MEA CTF 2022**](https://7rocky.github.io/en/ctf/other/blackhat-ctf/robot-factory/)
* –ú–∏ –º–æ–∂–µ–º–æ –≤–∏–¥—ñ–ª—è—Ç–∏ –ª–∏—à–µ —á–∞–Ω–∫–∏ —Ä–æ–∑–º—ñ—Ä–æ–º –±—ñ–ª—å—à–µ `0x100`.
* –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ `global_max_fast`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∞—Ç–∞–∫—É –Ω–∞ –Ω–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∏–π –±—ñ–Ω (–ø—Ä–∞—Ü—é—î 1/16 —Ä–∞–∑ —á–µ—Ä–µ–∑ ASLR, –æ—Å–∫—ñ–ª—å–∫–∏ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ 12 –±—ñ—Ç—ñ–≤, –∞–ª–µ –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–º—ñ–Ω–∏—Ç–∏ 16 –±—ñ—Ç—ñ–≤).
* –ê—Ç–∞–∫–∞ —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω–∞ –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –º–∞—Å–∏–≤—É —á–∞–Ω–∫—ñ–≤. –¶–µ –Ω–∞–¥–∞—î –ø—Ä–∏–º—ñ—Ç–∏–≤ —á–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å—É, —â–æ –¥–æ–∑–≤–æ–ª—è—î –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ GOT —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏ –Ω–∞ `system`.
