# Heap Functions Security Checks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## unlink

For more info check:

{% content-ref url="unlink.md" %}
[unlink.md](unlink.md)
{% endcontent-ref %}

This is a summary of the performed checks:

* Proverite da li je nazna캜ena veli캜ina dela ista kao `prev_size` nazna캜ena u slede캖em delu
* Poruka o gre코ci: `corrupted size vs. prev_size`
* Tako캠e proverite da li `P->fd->bk == P` i `P->bk->fw == P`
* Poruka o gre코ci: `corrupted double-linked list`
* Ako deo nije mali, proverite da li `P->fd_nextsize->bk_nextsize == P` i `P->bk_nextsize->fd_nextsize == P`
* Poruka o gre코ci: `corrupted double-linked list (not small)`

## \_int\_malloc

For more info check:

{% content-ref url="malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](malloc-and-sysmalloc.md)
{% endcontent-ref %}

* **Provere tokom brze pretrage binova:**
* Ako je deo nepravilno poravnat:
* Poruka o gre코ci: `malloc(): unaligned fastbin chunk detected 2`
* Ako je napredni deo nepravilno poravnat:
* Poruka o gre코ci: `malloc(): unaligned fastbin chunk detected`
* Ako vra캖eni deo ima veli캜inu koja nije ispravna zbog svog indeksa u brzom binu:
* Poruka o gre코ci: `malloc(): memory corruption (fast)`
* Ako je bilo koji deo kori코캖en za popunjavanje tcache nepravilno poravnat:
* Poruka o gre코ci: `malloc(): unaligned fastbin chunk detected 3`
* **Provere tokom pretrage malih binova:**
* Ako `victim->bk->fd != victim`:
* Poruka o gre코ci: `malloc(): smallbin double linked list corrupted`
* **Provere tokom konsolidacije** izvr코ene za svaki deo brzog bin chunk-a:&#x20;
* Ako je deo nepravilno poravnat, pokrenite:
* Poruka o gre코ci: `malloc_consolidate(): unaligned fastbin chunk detected`
* Ako deo ima druga캜iju veli캜inu od one koju bi trebao imati zbog indeksa u kojem se nalazi:
* Poruka o gre코ci: `malloc_consolidate(): invalid chunk size`
* Ako prethodni deo nije u upotrebi i prethodni deo ima veli캜inu koja se razlikuje od one nazna캜ene od strane prev\_chunk:
* Poruka o gre코ci: `corrupted size vs. prev_size in fastbins`
* **Provere tokom pretrage nesortiranih binova**:
* Ako je veli캜ina dela 캜udna (previ코e mala ili prevelika):&#x20;
* Poruka o gre코ci: `malloc(): invalid size (unsorted)`
* Ako je veli캜ina slede캖eg dela 캜udna (previ코e mala ili prevelika):
* Poruka o gre코ci: `malloc(): invalid next size (unsorted)`
* Ako se prethodna veli캜ina nazna캜ena slede캖im delom razlikuje od veli캜ine dela:
* Poruka o gre코ci: `malloc(): mismatching next->prev_size (unsorted)`
* Ako nije `victim->bck->fd == victim` ili nije `victim->fd == av (arena)`:
* Poruka o gre코ci: `malloc(): unsorted double linked list corrupted`
* Kako uvek proveravamo poslednji, njegov fd bi trebao uvek da pokazuje na strukturu arena.
* Ako slede캖i deo ne nazna캜ava da je prethodni u upotrebi:
* Poruka o gre코ci: `malloc(): invalid next->prev_inuse (unsorted)`
* Ako `fwd->bk_nextsize->fd_nextsize != fwd`:
* Poruka o gre코ci: `malloc(): largebin double linked list corrupted (nextsize)`
* Ako `fwd->bk->fd != fwd`:
* Poruka o gre코ci: `malloc(): largebin double linked list corrupted (bk)`
* **Provere tokom pretrage velikih binova (po indeksu):**
* `bck->fd-> bk != bck`:
* Poruka o gre코ci: `malloc(): corrupted unsorted chunks`
* **Provere tokom pretrage velikih binova (slede캖i ve캖i):**
* `bck->fd-> bk != bck`:
* Poruka o gre코ci: `malloc(): corrupted unsorted chunks2`
* **Provere tokom kori코캖enja Top chunk-a:**
* `chunksize(av->top) > av->system_mem`:
* Poruka o gre코ci: `malloc(): corrupted top size`

## `tcache_get_n`

* **Provere u `tcache_get_n`:**
* Ako je deo nepravilno poravnat:
* Poruka o gre코ci: `malloc(): unaligned tcache chunk detected`

## `tcache_thread_shutdown`

* **Provere u `tcache_thread_shutdown`:**
* Ako je deo nepravilno poravnat:
* Poruka o gre코ci: `tcache_thread_shutdown(): unaligned tcache chunk detected`

## `__libc_realloc`

* **Provere u `__libc_realloc`:**
* Ako je stari pokaziva캜 nepravilno poravnat ili je veli캜ina bila neispravna:
* Poruka o gre코ci: `realloc(): invalid pointer`

## `_int_free`

For more info check:

{% content-ref url="free.md" %}
[free.md](free.md)
{% endcontent-ref %}

* **Provere tokom po캜etka `_int_free`:**
* Pokaziva캜 je poravnat:
* Poruka o gre코ci: `free(): invalid pointer`
* Veli캜ina ve캖a od `MINSIZE` i veli캜ina tako캠e poravnata:
* Poruka o gre코ci: `free(): invalid size`
* **Provere u `_int_free` tcache:**
* Ako ima vi코e unosa nego `mp_.tcache_count`:
* Poruka o gre코ci: `free(): too many chunks detected in tcache`
* Ako unos nije poravnat:
* Poruka o gre코ci: `free(): unaligned chunk detected in tcache 2`
* Ako je oslobo캠eni deo ve캖 bio oslobo캠en i prisutan je kao deo u tcache:
* Poruka o gre코ci: `free(): double free detected in tcache 2`
* **Provere u `_int_free` brzom binu:**
* Ako je veli캜ina dela neispravna (prevelika ili premala) pokrenite:
* Poruka o gre코ci: `free(): invalid next size (fast)`
* Ako je dodat deo ve캖 bio vrh brzog bin-a:
* Poruka o gre코ci: `double free or corruption (fasttop)`
* Ako veli캜ina dela na vrhu ima druga캜iju veli캜inu od dela koji dodajemo:
* Poruka o gre코ci: `invalid fastbin entry (free)`

## **`_int_free_merge_chunk`**

* **Provere u `_int_free_merge_chunk`:**
* Ako je deo vrh deo:
* Poruka o gre코ci: `double free or corruption (top)`
* Ako je slede캖i deo van granica arene:
* Poruka o gre코ci: `double free or corruption (out)`
* Ako deo nije ozna캜en kao kori코캖en (u prev\_inuse slede캖eg dela):
* Poruka o gre코ci: `double free or corruption (!prev)`
* Ako slede캖i deo ima premalu ili preveliku veli캜inu:
* Poruka o gre코ci: `free(): invalid next size (normal)`
* Ako prethodni deo nije u upotrebi, poku코a캖e da konsoliduje. Ali, ako se `prev_size` razlikuje od veli캜ine nazna캜ene u prethodnom delu:
* Poruka o gre코ci: `corrupted size vs. prev_size while consolidating`

## **`_int_free_create_chunk`**

* **Provere u `_int_free_create_chunk`:**
* Dodavanje dela u nesortirani bin, proverite da li `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)`:
* Poruka o gre코ci: `free(): corrupted unsorted chunks`

## `do_check_malloc_state`

* **Provere u `do_check_malloc_state`:**
* Ako je deo nepravilno poravnat brzog bin-a:
* Poruka o gre코ci: `do_check_malloc_state(): unaligned fastbin chunk detected`

## `malloc_consolidate`

* **Provere u `malloc_consolidate`:**
* Ako je deo nepravilno poravnat brzog bin-a:
* Poruka o gre코ci: `malloc_consolidate(): unaligned fastbin chunk detected`
* Ako je veli캜ina dela brzog bin-a neispravna:
* Poruka o gre코ci: `malloc_consolidate(): invalid chunk size`

## `_int_realloc`

* **Provere u `_int_realloc`:**
* Veli캜ina je prevelika ili premala:
* Poruka o gre코ci: `realloc(): invalid old size`
* Veli캜ina slede캖eg dela je prevelika ili premala:
* Poruka o gre코ci: `realloc(): invalid next size`

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
