# Heap Functions Security Checks

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## unlink

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="unlink.md" %}
[unlink.md](unlink.md)
{% endcontent-ref %}

YapÄ±lan kontrollerin Ã¶zeti:

* Belirtilen parÃ§a boyutunun, bir sonraki parÃ§adaki `prev_size` ile aynÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol edin
* Hata mesajÄ±: `corrupted size vs. prev_size`
* AyrÄ±ca `P->fd->bk == P` ve `P->bk->fw == P` kontrol edin
* Hata mesajÄ±: `corrupted double-linked list`
* ParÃ§a kÃ¼Ã§Ã¼k deÄŸilse, `P->fd_nextsize->bk_nextsize == P` ve `P->bk_nextsize->fd_nextsize == P` kontrol edin
* Hata mesajÄ±: `corrupted double-linked list (not small)`

## \_int\_malloc

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="malloc-and-sysmalloc.md" %}
[malloc-and-sysmalloc.md](malloc-and-sysmalloc.md)
{% endcontent-ref %}

* **HÄ±zlÄ± bin aramasÄ± sÄ±rasÄ±nda kontroller:**
* ParÃ§a hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned fastbin chunk detected 2`
* Ä°leri parÃ§a hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned fastbin chunk detected`
* DÃ¶ndÃ¼rÃ¼len parÃ§anÄ±n, hÄ±zlÄ± bin iÃ§indeki indeksinden dolayÄ± doÄŸru olmayan bir boyutu varsa:
* Hata mesajÄ±: `malloc(): memory corruption (fast)`
* Tcache'i doldurmak iÃ§in kullanÄ±lan herhangi bir parÃ§a hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned fastbin chunk detected 3`
* **KÃ¼Ã§Ã¼k bin aramasÄ± sÄ±rasÄ±nda kontroller:**
* EÄŸer `victim->bk->fd != victim` ise:
* Hata mesajÄ±: `malloc(): smallbin double linked list corrupted`
* **Her hÄ±zlÄ± bin parÃ§asÄ± iÃ§in yapÄ±lan konsolidasyon sÄ±rasÄ±nda kontroller:**
* ParÃ§a hizalanmamÄ±ÅŸsa tetikleyin:
* Hata mesajÄ±: `malloc_consolidate(): unaligned fastbin chunk detected`
* ParÃ§a, bulunduÄŸu indeks nedeniyle olmasÄ± gereken boyuttan farklÄ±ysa:
* Hata mesajÄ±: `malloc_consolidate(): invalid chunk size`
* Ã–nceki parÃ§a kullanÄ±lmÄ±yorsa ve Ã¶nceki parÃ§anÄ±n boyutu `prev_chunk` tarafÄ±ndan belirtilen boyuttan farklÄ±ysa:
* Hata mesajÄ±: `corrupted size vs. prev_size in fastbins`
* **SÄ±ralanmamÄ±ÅŸ bin aramasÄ± sÄ±rasÄ±nda kontroller:**
* ParÃ§a boyutu garipse (Ã§ok kÃ¼Ã§Ã¼k veya Ã§ok bÃ¼yÃ¼k):
* Hata mesajÄ±: `malloc(): invalid size (unsorted)`
* Bir sonraki parÃ§a boyutu garipse (Ã§ok kÃ¼Ã§Ã¼k veya Ã§ok bÃ¼yÃ¼k):
* Hata mesajÄ±: `malloc(): invalid next size (unsorted)`
* Bir sonraki parÃ§anÄ±n belirttiÄŸi Ã¶nceki boyut, parÃ§anÄ±n boyutundan farklÄ±ysa:
* Hata mesajÄ±: `malloc(): mismatching next->prev_size (unsorted)`
* EÄŸer `victim->bck->fd == victim` deÄŸilse veya `victim->fd == av (arena)` deÄŸilse:
* Hata mesajÄ±: `malloc(): unsorted double linked list corrupted`
* Her zaman sonuncusunu kontrol ettiÄŸimiz iÃ§in, fd'si her zaman arena yapÄ±sÄ±na iÅŸaret etmelidir.
* EÄŸer bir sonraki parÃ§a, Ã¶ncekinin kullanÄ±ldÄ±ÄŸÄ±nÄ± belirtmiyorsa:
* Hata mesajÄ±: `malloc(): invalid next->prev_inuse (unsorted)`
* EÄŸer `fwd->bk_nextsize->fd_nextsize != fwd` ise:
* Hata mesajÄ±: `malloc(): largebin double linked list corrupted (nextsize)`
* EÄŸer `fwd->bk->fd != fwd` ise:
* Hata mesajÄ±: `malloc(): largebin double linked list corrupted (bk)`
* **BÃ¼yÃ¼k bin (indeksle) aramasÄ± sÄ±rasÄ±nda kontroller:**
* `bck->fd-> bk != bck`:
* Hata mesajÄ±: `malloc(): corrupted unsorted chunks`
* **BÃ¼yÃ¼k bin (bir sonraki daha bÃ¼yÃ¼k) aramasÄ± sÄ±rasÄ±nda kontroller:**
* `bck->fd-> bk != bck`:
* Hata mesajÄ±: `malloc(): corrupted unsorted chunks2`
* **Top parÃ§a kullanÄ±mÄ± sÄ±rasÄ±nda kontroller:**
* `chunksize(av->top) > av->system_mem`:
* Hata mesajÄ±: `malloc(): corrupted top size`

## `tcache_get_n`

* **`tcache_get_n` iÃ§indeki kontroller:**
* EÄŸer parÃ§a hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `malloc(): unaligned tcache chunk detected`

## `tcache_thread_shutdown`

* **`tcache_thread_shutdown` iÃ§indeki kontroller:**
* EÄŸer parÃ§a hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `tcache_thread_shutdown(): unaligned tcache chunk detected`

## `__libc_realloc`

* **`__libc_realloc` iÃ§indeki kontroller:**
* EÄŸer eski iÅŸaretÃ§i hizalanmamÄ±ÅŸsa veya boyut yanlÄ±ÅŸsa:
* Hata mesajÄ±: `realloc(): invalid pointer`

## `_int_free`

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="free.md" %}
[free.md](free.md)
{% endcontent-ref %}

* **`_int_free`'in baÅŸlangÄ±cÄ±nda kontroller:**
* Ä°ÅŸaretÃ§i hizalanmÄ±ÅŸsa:
* Hata mesajÄ±: `free(): invalid pointer`
* Boyut `MINSIZE`'dan bÃ¼yÃ¼k ve boyut da hizalanmÄ±ÅŸsa:
* Hata mesajÄ±: `free(): invalid size`
* **`_int_free` tcache iÃ§indeki kontroller:**
* EÄŸer `mp_.tcache_count`'dan fazla giriÅŸ varsa:
* Hata mesajÄ±: `free(): too many chunks detected in tcache`
* EÄŸer giriÅŸ hizalanmamÄ±ÅŸsa:
* Hata mesajÄ±: `free(): unaligned chunk detected in tcache 2`
* EÄŸer serbest bÄ±rakÄ±lan parÃ§a zaten serbest bÄ±rakÄ±lmÄ±ÅŸsa ve tcache'de parÃ§a olarak mevcutsa:
* Hata mesajÄ±: `free(): double free detected in tcache 2`
* **`_int_free` hÄ±zlÄ± bin iÃ§indeki kontroller:**
* EÄŸer parÃ§anÄ±n boyutu geÃ§ersizse (Ã§ok bÃ¼yÃ¼k veya kÃ¼Ã§Ã¼k) tetikleyin:
* Hata mesajÄ±: `free(): invalid next size (fast)`
* EÄŸer eklenen parÃ§a zaten hÄ±zlÄ± binin tepe noktasÄ±ysa:
* Hata mesajÄ±: `double free or corruption (fasttop)`
* EÄŸer tepedeki parÃ§anÄ±n boyutu, eklediÄŸimiz parÃ§anÄ±n boyutundan farklÄ±ysa:
* Hata mesajÄ±: `invalid fastbin entry (free)`

## **`_int_free_merge_chunk`**

* **`_int_free_merge_chunk` iÃ§indeki kontroller:**
* EÄŸer parÃ§a tepe parÃ§aysa:
* Hata mesajÄ±: `double free or corruption (top)`
* EÄŸer bir sonraki parÃ§a arena sÄ±nÄ±rlarÄ±nÄ±n dÄ±ÅŸÄ±ndaysa:
* Hata mesajÄ±: `double free or corruption (out)`
* EÄŸer parÃ§a kullanÄ±lmÄ±yorsa (bir sonraki parÃ§anÄ±n prev_inuse'inde):
* Hata mesajÄ±: `double free or corruption (!prev)`
* EÄŸer bir sonraki parÃ§anÄ±n boyutu Ã§ok kÃ¼Ã§Ã¼k veya Ã§ok bÃ¼yÃ¼kse:
* Hata mesajÄ±: `free(): invalid next size (normal)`
* EÄŸer Ã¶nceki parÃ§a kullanÄ±lmÄ±yorsa, konsolidasyon yapmaya Ã§alÄ±ÅŸacaktÄ±r. Ancak, `prev_size` Ã¶nceki parÃ§adaki belirtilen boyuttan farklÄ±ysa:
* Hata mesajÄ±: `corrupted size vs. prev_size while consolidating`

## **`_int_free_create_chunk`**

* **`_int_free_create_chunk` iÃ§indeki kontroller:**
* SÄ±ralanmamÄ±ÅŸ bin iÃ§ine bir parÃ§a eklerken, `unsorted_chunks(av)->fd->bk == unsorted_chunks(av)` kontrol edin:
* Hata mesajÄ±: `free(): corrupted unsorted chunks`

## `do_check_malloc_state`

* **`do_check_malloc_state` iÃ§indeki kontroller:**
* EÄŸer hizalanmamÄ±ÅŸ hÄ±zlÄ± bin parÃ§asÄ± varsa:
* Hata mesajÄ±: `do_check_malloc_state(): unaligned fastbin chunk detected`

## `malloc_consolidate`

* **`malloc_consolidate` iÃ§indeki kontroller:**
* EÄŸer hizalanmamÄ±ÅŸ hÄ±zlÄ± bin parÃ§asÄ± varsa:
* Hata mesajÄ±: `malloc_consolidate(): unaligned fastbin chunk detected`
* EÄŸer hÄ±zlÄ± bin parÃ§a boyutu yanlÄ±ÅŸsa:
* Hata mesajÄ±: `malloc_consolidate(): invalid chunk size`

## `_int_realloc`

* **`_int_realloc` iÃ§indeki kontroller:**
* Boyut Ã§ok bÃ¼yÃ¼k veya Ã§ok kÃ¼Ã§Ã¼kse:
* Hata mesajÄ±: `realloc(): invalid old size`
* Bir sonraki parÃ§anÄ±n boyutu Ã§ok bÃ¼yÃ¼k veya Ã§ok kÃ¼Ã§Ã¼kse:
* Hata mesajÄ±: `realloc(): invalid next size`

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
