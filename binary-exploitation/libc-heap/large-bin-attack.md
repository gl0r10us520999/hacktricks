# å¤§ããªãƒ“ãƒ³æ”»æ’ƒ

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

å¤§ããªãƒ“ãƒ³ã¨ã¯ä½•ã‹ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€ã“ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

[**how2heap - large bin attack**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c)ã«ç´ æ™´ã‚‰ã—ã„ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚

åŸºæœ¬çš„ã«ã€æœ€æ–°ã®ã€Œç¾åœ¨ã®ã€glibcãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ2.35ï¼‰ã§ã¯ã€**`P->bk_nextsize`**ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ãŠã‚‰ãšã€ç‰¹å®šã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã‚‹ã¨ã€å¤§ããªãƒ“ãƒ³ãƒãƒ£ãƒ³ã‚¯ã®å€¤ã§ä»»æ„ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›´ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ãã®ä¾‹ã§ã¯ã€æ¬¡ã®æ¡ä»¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ï¼š

* å¤§ããªãƒãƒ£ãƒ³ã‚¯ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
* æœ€åˆã®ã‚‚ã®ã‚ˆã‚Šå°ã•ã„ãŒåŒã˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å¤§ããªãƒãƒ£ãƒ³ã‚¯ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
* ãƒ“ãƒ³å†…ã§æœ€åˆã«æŒ¿å…¥ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€å°ã•ããªã‘ã‚Œã°ãªã‚‰ãªã„
* ï¼ˆãƒˆãƒƒãƒ—ãƒãƒ£ãƒ³ã‚¯ã¨ã®ãƒãƒ¼ã‚¸ã‚’é˜²ããŸã‚ã®ãƒãƒ£ãƒ³ã‚¯ãŒä½œæˆã•ã‚Œã‚‹ï¼‰
* ãã®å¾Œã€æœ€åˆã®å¤§ããªãƒãƒ£ãƒ³ã‚¯ãŒè§£æ”¾ã•ã‚Œã€ãã‚Œã‚ˆã‚Šå¤§ããªæ–°ã—ã„ãƒãƒ£ãƒ³ã‚¯ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ -> Chunk1ãŒå¤§ããªãƒ“ãƒ³ã«ç§»å‹•
* æ¬¡ã«ã€2ç•ªç›®ã®å¤§ããªãƒãƒ£ãƒ³ã‚¯ãŒè§£æ”¾ã•ã‚Œã‚‹
* ã“ã“ã§è„†å¼±æ€§ï¼šæ”»æ’ƒè€…ã¯`chunk1->bk_nextsize`ã‚’`[target-0x20]`ã«å¤‰æ›´ã§ãã‚‹
* ãã®å¾Œã€ãƒãƒ£ãƒ³ã‚¯2ã‚ˆã‚Šã‚‚å¤§ããªãƒãƒ£ãƒ³ã‚¯ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãŸã‚ã€ãƒãƒ£ãƒ³ã‚¯2ãŒå¤§ããªãƒ“ãƒ³ã«æŒ¿å…¥ã•ã‚Œã€ã‚¢ãƒ‰ãƒ¬ã‚¹`chunk1->bk_nextsize->fd_nextsize`ãŒãƒãƒ£ãƒ³ã‚¯2ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ä¸Šæ›¸ãã•ã‚Œã‚‹

{% hint style="success" %}
ä»–ã«ã‚‚æ½œåœ¨çš„ãªã‚·ãƒŠãƒªã‚ªãŒã‚ã‚Šã¾ã™ãŒã€é‡è¦ãªã®ã¯ã€ãƒ“ãƒ³å†…ã®ç¾åœ¨ã®Xãƒãƒ£ãƒ³ã‚¯ã‚ˆã‚Šã‚‚**å°ã•ã„**ãƒãƒ£ãƒ³ã‚¯ã‚’å¤§ããªãƒ“ãƒ³ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ãã‚Œã¯ãƒ“ãƒ³å†…ã®Xã®ç›´å‰ã«æŒ¿å…¥ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã€Xã®**`bk_nextsize`**ã‚’å¤‰æ›´ã§ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã«å°ã•ã„ãƒãƒ£ãƒ³ã‚¯ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

ã“ã‚Œã¯mallocã‹ã‚‰ã®é–¢é€£ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã©ã®ã‚ˆã†ã«ä¸Šæ›¸ãã•ã‚ŒãŸã‹ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ï¼š

{% code overflow="wrap" %}
```c
/* if smaller than smallest, bypass loop below */
assert (chunk_main_arena (bck->bk));
if ((unsigned long) (size) < (unsigned long) chunksize_nomask (bck->bk))
{
fwd = bck; // fwd = p1
bck = bck->bk; // bck = p1->bk

victim->fd_nextsize = fwd->fd; // p2->fd_nextsize = p1->fd (Note that p1->fd is p1 as it's the only chunk)
victim->bk_nextsize = fwd->fd->bk_nextsize; // p2->bk_nextsize = p1->fd->bk_nextsize
fwd->fd->bk_nextsize = victim->bk_nextsize->fd_nextsize = victim; // p1->fd->bk_nextsize->fd_nextsize = p2
}
```
{% endcode %}

ã“ã‚Œã¯ã€**libcã®`global_max_fast`ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ä¸Šæ›¸ãã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ã‚ˆã‚Šå¤§ããªãƒãƒ£ãƒ³ã‚¯ã§ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ“ãƒ³æ”»æ’ƒã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**

ã“ã®æ”»æ’ƒã®åˆ¥ã®å„ªã‚ŒãŸèª¬æ˜ã¯ã€[**guyinatuxedo**](https://guyinatuxedo.github.io/32-largebin\_attack/largebin\_explanation0/index.html)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãã®ä»–ã®ä¾‹

* [**La casa de papel. HackOn CTF 2024**](https://7rocky.github.io/en/ctf/other/hackon-ctf/la-casa-de-papel/)
* [**how2heap**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c)ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã¨åŒã˜çŠ¶æ³ã§ã®å¤§ããªãƒ“ãƒ³æ”»æ’ƒã€‚
* æ›¸ãè¾¼ã¿ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã¯ã‚ˆã‚Šè¤‡é›‘ã§ã€`global_max_fast`ã¯ã“ã“ã§ã¯ç„¡æ„å‘³ã§ã™ã€‚
* ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’å®Œäº†ã™ã‚‹ã«ã¯FSOPãŒå¿…è¦ã§ã™ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
