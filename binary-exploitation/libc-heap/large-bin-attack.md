# Large Bin Attack

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ë” ë§ì€ ì •ë³´ëŠ” ëŒ€í˜• ë¹ˆì— ëŒ€í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

[**how2heap - large bin attack**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c)ì—ì„œ í›Œë¥­í•œ ì˜ˆì œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ê¸°ì—ì„œ glibcì˜ ìµœì‹  "í˜„ì¬" ë²„ì „(2.35)ì—ì„œ **`P->bk_nextsize`**ê°€ í™•ì¸ë˜ì§€ ì•Šì•„ íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë˜ë©´ ëŒ€í˜• ë¹ˆ ì²­í¬ì˜ ê°’ìœ¼ë¡œ ì„ì˜ì˜ ì£¼ì†Œë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ ì˜ˆì œì—ì„œ ë‹¤ìŒ ì¡°ê±´ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* ëŒ€í˜• ì²­í¬ê°€ í• ë‹¹ë¨
* ì²« ë²ˆì§¸ ì²­í¬ë³´ë‹¤ ì‘ì§€ë§Œ ê°™ì€ ì¸ë±ìŠ¤ì— ìˆëŠ” ëŒ€í˜• ì²­í¬ê°€ í• ë‹¹ë¨
* ë¹ˆì—ì„œ ë¨¼ì € ê°€ì•¼ í•˜ë¯€ë¡œ ë” ì‘ì•„ì•¼ í•¨
* (ìƒë‹¨ ì²­í¬ì™€ ë³‘í•©ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ì²­í¬ê°€ ìƒì„±ë¨)
* ê·¸ëŸ° ë‹¤ìŒ ì²« ë²ˆì§¸ ëŒ€í˜• ì²­í¬ê°€ í•´ì œë˜ê³  ê·¸ë³´ë‹¤ í° ìƒˆ ì²­í¬ê°€ í• ë‹¹ë¨ -> Chunk1ì´ ëŒ€í˜• ë¹ˆìœ¼ë¡œ ì´ë™
* ê·¸ëŸ° ë‹¤ìŒ ë‘ ë²ˆì§¸ ëŒ€í˜• ì²­í¬ê°€ í•´ì œë¨
* ì´ì œ ì·¨ì•½ì : ê³µê²©ìëŠ” `chunk1->bk_nextsize`ë¥¼ `[target-0x20]`ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ
* ê·¸ëŸ° ë‹¤ìŒ ì²­í¬ 2ë³´ë‹¤ í° ì²­í¬ê°€ í• ë‹¹ë˜ë¯€ë¡œ chunk2ê°€ ëŒ€í˜• ë¹ˆì— ì‚½ì…ë˜ì–´ `chunk1->bk_nextsize->fd_nextsize` ì£¼ì†Œë¥¼ chunk2ì˜ ì£¼ì†Œë¡œ ë®ì–´ì”€

{% hint style="success" %}
ë‹¤ë¥¸ ì ì¬ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆìœ¼ë©°, ì¤‘ìš”í•œ ê²ƒì€ ëŒ€í˜• ë¹ˆì— í˜„ì¬ ë¹ˆì˜ X ì²­í¬ë³´ë‹¤ **ì‘ì€** ì²­í¬ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ ë¹ˆì—ì„œ Xì˜ **`bk_nextsize`**ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë©°, ì´ëŠ” ë” ì‘ì€ ì²­í¬ì˜ ì£¼ì†Œê°€ ê¸°ë¡ë  ìœ„ì¹˜ì…ë‹ˆë‹¤.
{% endhint %}

ì´ê²ƒì€ mallocì˜ ê´€ë ¨ ì½”ë“œì…ë‹ˆë‹¤. ì£¼ì†Œê°€ ì–´ë–»ê²Œ ë®ì–´ì”Œì›Œì¡ŒëŠ”ì§€ ë” ì˜ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì£¼ì„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```c
/* if smaller than smallest, bypass loop below */
assert (chunk_main_arena (bck->bk));
if ((unsigned long) (size) < (unsigned long) chunksize_nomask (bck->bk))
{
fwd = bck; // fwd = p1
bck = bck->bk; // bck = p1->bk

victim->fd_nextsize = fwd->fd; // p2->fd_nextsize = p1->fd (Note that p1->fd is p1 as it's the only chunk)
victim->bk_nextsize = fwd->fd->bk_nextsize; // p2->bk_nextsize = p1->fd->bk_nextsize
fwd->fd->bk_nextsize = victim->bk_nextsize->fd_nextsize = victim; // p1->fd->bk_nextsize->fd_nextsize = p2
}
```
{% endcode %}

ì´ê²ƒì€ **libcì˜ `global_max_fast` ì „ì—­ ë³€ìˆ˜ë¥¼ ë®ì–´ì“°ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°**, ì´í›„ ë” í° ì²­í¬ë¡œ ë¹ ë¥¸ ë¹ˆ ê³µê²©ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê³µê²©ì— ëŒ€í•œ ë˜ ë‹¤ë¥¸ í›Œë¥­í•œ ì„¤ëª…ì€ [**guyinatuxedo**](https://guyinatuxedo.github.io/32-largebin\_attack/largebin\_explanation0/index.html)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë‹¤ë¥¸ ì˜ˆì‹œ

* [**La casa de papel. HackOn CTF 2024**](https://7rocky.github.io/en/ctf/other/hackon-ctf/la-casa-de-papel/)
* [**how2heap**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c)ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒê³¼ ê°™ì€ ìƒí™©ì—ì„œì˜ ëŒ€í˜• ë¹ˆ ê³µê²©.
* ì“°ê¸° ì›ì‹œ í•¨ìˆ˜ëŠ” ë” ë³µì¡í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ `global_max_fast`ëŠ” ì—¬ê¸°ì„œ ì“¸ëª¨ê°€ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
* ìµìŠ¤í”Œë¡œì‡ì„ ì™„ë£Œí•˜ë ¤ë©´ FSOPê°€ í•„ìš”í•©ë‹ˆë‹¤.

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
