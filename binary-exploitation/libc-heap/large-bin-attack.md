# рдмрдбрд╝реЗ рдмрд┐рди рд╣рдорд▓рд╛

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** рдХреЛ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдФрд░ [**рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
{% endhint %}

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдмрдбрд╝реЗ рдмрд┐рди рдХреНрдпрд╛ рд╣реИ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреЗрдЬ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="bins-and-memory-allocations.md" %}
[bins-and-memory-allocations.md](bins-and-memory-allocations.md)
{% endcontent-ref %}

рдПрдХ рдорд╣рд╛рди рдЙрджрд╛рд╣рд░рдг рдвреВрдВрдврдирд╛ рд╕рдВрднрд╡ рд╣реИ [**how2heap - large bin attack**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c).

рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдпрд╣рд╛рдБ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐, рдирд╡реАрдирддрдо "рд╡рд░реНрддрдорд╛рди" рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ glibc (2.35), рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдВрдЪрд╛ рдЧрдпрд╛ рд╣реИ: **`P->bk_nextsize`** рдЬрд┐рд╕рд╕реЗ рдХрд┐ рдпрджрд┐ рдХреБрдЫ рд╢рд░реНрддреЗрдВ рдкреВрд░реА рд╣реЛрддреА рд╣реИрдВ рддреЛ рдПрдХ рдмрдбрд╝реЗ рдмрд┐рди рдЪрдВрдХ рдХреЗ рдорд╛рди рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рдкрддрд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред

рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд░реНрддреЗрдВ рдкрд╛рдПрдВрдЧреЗ:

* рдПрдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
* рдкрд╣рд▓реЗ рдЪрдВрдХ рд╕реЗ рдЫреЛрдЯрд╛ рдПрдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЙрд╕реА рд╕реВрдЪреА рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ
* рдЗрд╕реЗ рдЗрд╕рд▓рд┐рдП рдЫреЛрдЯрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕реВрдЪреА рдореЗрдВ рдкрд╣рд▓реЗ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП
* (рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рди рдирд╣реАрдВ рд╣реЛрдиреЗ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ)
* рдлрд┐рд░, рдкрд╣рд▓рд╛ рдмрдбрд╝рд╛ рдЪрдВрдХ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдирдпрд╛ рдЪрдВрдХ рдЙрд╕рд╕реЗ рдмрдбрд╝рд╛ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ -> рдЪрдВрдХ1 рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ
* рдлрд┐рд░, рджреВрд╕рд░рд╛ рдмрдбрд╝рд╛ рдЪрдВрдХ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* рдЕрдм, рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖: рд╣рдорд▓рд╛рд╡рд░ `chunk1->bk_nextsize` рдХреЛ `[рд▓рдХреНрд╖реНрдп-0x20]` рдкрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ
* рдлрд┐рд░, рдЪрдВрдХ 2 рд╕реЗ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪрдВрдХ2 рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкрддрд╛ `chunk1->bk_nextsize->fd_nextsize` рдХреЛ рдЪрдВрдХ2 рдХреЗ рдкрддреЗ рд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рджреЗрддрд╛ рд╣реИ

{% hint style="success" %}
рдЕрдиреНрдп рд╕рдВрднрд╛рд╡рд┐рдд рдкрд░рд┐рджреГрд╢реНрдп рд╣реИрдВ, рдпрд╣ рдмрдбрд╝реЗ рдмрд┐рди рдореЗрдВ рдПрдХ рдЪрдВрдХ рдЬреЛ рдХрд┐рд╕реА рд╡рд░реНрддрдорд╛рди X рдЪрдВрдХ рд╕реЗ **рдЫреЛрдЯрд╛** рд╣реИ рдЬреЛрдбрд╝рдирд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЙрд╕рд╕реЗ рдкрд╣рд▓реЗ рдЙрд╕рдореЗрдВ рдбрд╛рд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рд╣рдореЗрдВ X рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП **`bk_nextsize`** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдБ рдЫреЛрдЯреЗ рдЪрдВрдХ рдХрд╛ рдкрддрд╛ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

рдпрд╣ рдореИрд▓реЛрдХ рдХреЛрдб malloc рд╕реЗ рд╣реИред рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ рдЕрдзрд┐рдХ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝реА рдЧрдИ рд╣реИрдВ:

{% code overflow="wrap" %}
```c
/* if smaller than smallest, bypass loop below */
assert (chunk_main_arena (bck->bk));
if ((unsigned long) (size) < (unsigned long) chunksize_nomask (bck->bk))
{
fwd = bck; // fwd = p1
bck = bck->bk; // bck = p1->bk

victim->fd_nextsize = fwd->fd; // p2->fd_nextsize = p1->fd (Note that p1->fd is p1 as it's the only chunk)
victim->bk_nextsize = fwd->fd->bk_nextsize; // p2->bk_nextsize = p1->fd->bk_nextsize
fwd->fd->bk_nextsize = victim->bk_nextsize->fd_nextsize = victim; // p1->fd->bk_nextsize->fd_nextsize = p2
}
```
{% endcode %}

рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **libc рдХреЗ `global_max_fast` рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓** рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдлрд┐рд░ рдмрдбрд╝реЗ рдЪрдВрдХреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╛рд╕реНрдЯ рдмрд┐рди рд╣рдорд▓рд╛ рдХрд╛ рд╢рд┐рдХрд╛рд░ рдмрдирдиреЗ рдХреЗ рд▓рд┐рдПред

рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХреА рдПрдХ рдФрд░ рд╢рд╛рдирджрд╛рд░ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЛ [**guyinatuxedo**](https://guyinatuxedo.github.io/32-largebin\_attack/largebin\_explanation0/index.html) рдореЗрдВ рднреА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг

* [**La casa de papel. HackOn CTF 2024**](https://7rocky.github.io/en/ctf/other/hackon-ctf/la-casa-de-papel/)
* рдПрдХ рд╣реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдмрдбрд╝реЗ рдмрд┐рди рд╣рдорд▓рд╛ рдЬреИрд╕рд╛ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ [**how2heap**](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/large\_bin\_attack.c) рдореЗрдВред
* рд▓реЗрдЦрди рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдБ `global_max_fast` рдЕрдиреБрдкрдпреЛрдЧреА рд╣реИред
* рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП FSOP рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рд╣рдореЗрдВ** рдлреЙрд▓реЛ **рдХрд░реЗрдВ**ред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
