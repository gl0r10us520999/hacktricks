# House of Lore | Small bin Attack

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### Code

* Check the one from [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/)
* ‡§Ø‡§π ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à
* Or: [https://github.com/shellphish/how2heap/blob/master/glibc\_2.39/house\_of\_lore.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.39/house\_of\_lore.c)
* ‡§Ø‡§π ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à ‡§≠‡§≤‡•á ‡§π‡•Ä ‡§Ø‡§π ‡§ï‡•Å‡§õ ‡§ö‡•á‡§ï ‡§ï‡•ã ‡§¨‡§æ‡§Ø‡§™‡§æ‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à: `malloc(): unaligned tcache chunk detected`
* ‡§Ø‡§π ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Ö‡§≠‡•Ä ‡§≠‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à: [**https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html**](https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html)&#x20;

### Goal

* ‡§è‡§ï **‡§®‡§ï‡§≤‡•Ä ‡§õ‡•ã‡§ü‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•ã ‡§õ‡•ã‡§ü‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§á‡§∏‡•á ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•ã ‡§∏‡§ï‡•á**‡•§\
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§ú‡•ã ‡§õ‡•ã‡§ü‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§µ‡§π ‡§®‡§ï‡§≤‡•Ä ‡§π‡•à ‡§ú‡§ø‡§∏‡•á ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ø‡§π ‡§ï‡§ø‡§∏‡•Ä ‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§®‡§ï‡§≤‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§

### Requirements

* 2 ‡§®‡§ï‡§≤‡•Ä ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§¨‡§®‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§è‡§ï ‡§∏‡§æ‡§• ‡§î‡§∞ ‡§õ‡•ã‡§ü‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§µ‡•à‡§ß ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§∏‡§æ‡§• ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡§∞‡•á‡§Ç:
* `fake0.bk` -> `fake1`
* `fake1.fd` -> `fake0`
* `fake0.fd` -> `legit` (‡§Ü‡§™‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§õ‡•ã‡§ü‡•á ‡§¨‡§ø‡§® ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à)
* `legit.bk` -> `fake0`

‡§´‡§ø‡§∞ ‡§Ü‡§™ `fake0` ‡§ï‡•ã ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•ã‡§Ç‡§ó‡•á‡•§

### Attack

* ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ (`legit`) ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§´‡§ø‡§∞ ‡§è‡§ï ‡§î‡§∞ ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§∂‡•Ä‡§∞‡•ç‡§∑ ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Æ‡•á‡§ï‡§® ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§ ‡§´‡§ø‡§∞, `legit` ‡§ï‡•ã ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à (‡§á‡§∏‡•á ‡§Ö‡§∏‡§Ç‡§∞‡§ö‡§ø‡§§ ‡§¨‡§ø‡§® ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§≤‡•á ‡§ú‡§æ‡§®‡§æ) ‡§î‡§∞ ‡§è‡§ï ‡§¨‡§°‡§º‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, **`legit` ‡§ï‡•ã ‡§õ‡•ã‡§ü‡•á ‡§¨‡§ø‡§® ‡§Æ‡•á‡§Ç ‡§≤‡•á ‡§ú‡§æ‡§®‡§æ‡•§**
* ‡§è‡§ï ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞ ‡§ï‡•Å‡§õ ‡§®‡§ï‡§≤‡•Ä ‡§õ‡•ã‡§ü‡•á ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§î‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§≤‡§ø‡§Ç‡§ï‡§ø‡§Ç‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§∏‡•à‡§®‡•Ä‡§ü‡•Ä ‡§ö‡•á‡§ï ‡§ï‡•ã ‡§¨‡§æ‡§Ø‡§™‡§æ‡§∏ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á:
* `fake0.bk` -> `fake1`
* `fake1.fd` -> `fake0`
* `fake0.fd` -> `legit` (‡§Ü‡§™‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§õ‡•ã‡§ü‡•á ‡§¨‡§ø‡§® ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à)
* `legit.bk` -> `fake0`
* ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§µ‡•à‡§ß ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á, **`fake0`** ‡§ï‡•ã ‡§õ‡•ã‡§ü‡•á ‡§¨‡§ø‡§® ‡§ï‡•Ä ‡§∂‡•Ä‡§∞‡•ç‡§∑ ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§®‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è
* ‡§è‡§ï ‡§î‡§∞ ‡§õ‡•ã‡§ü‡§æ ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, `fake0` ‡§ï‡•ã ‡§è‡§ï ‡§ü‡•Å‡§ï‡§°‡§º‡•á ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è, ‡§á‡§∏‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏ ‡§ï‡•ã ‡§™‡§¢‡§º‡§®‡•á/‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§

## References

* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_lore/)
* [https://heap-exploitation.dhavalkapil.com/attacks/house\_of\_lore](https://heap-exploitation.dhavalkapil.com/attacks/house\_of\_lore)
* [https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html](https://guyinatuxedo.github.io/40-house\_of\_lore/house\_lore\_exp/index.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
