# House of Orange

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### Code

* Find an example in [https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_orange.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_orange.c)
* The exploitation technique was fixed in this [patch](https://sourceware.org/git/?p=glibc.git;a=blobdiff;f=stdlib/abort.c;h=117a507ff88d862445551f2c07abb6e45a716b75;hp=19882f3e3dc1ab830431506329c94dcf1d7cc252;hb=91e7cf982d0104f0e71770f5ae8e3faf352dea9f;hpb=0c25125780083cbba22ed627756548efe282d1a0) so this is no longer working (working in earlier than 2.26)
* Same example **with more comments** in [https://guyinatuxedo.github.io/43-house\_of\_orange/house\_orange\_exp/index.html](https://guyinatuxedo.github.io/43-house\_of\_orange/house\_orange\_exp/index.html)

### Goal

* Abuse `malloc_printerr` function

### Requirements

* Overwrite the top chunk size
* Libc and heap leaks

### Background

Some needed background from the comments from [**this example**](https://guyinatuxedo.github.io/43-house\_of\_orange/house\_orange\_exp/index.html)**:**

рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐, libc рдХреЗ рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, рдЬрдм `malloc_printerr` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рдерд╛, рддреЛ рдпрд╣ `_IO_list_all` рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд `_IO_FILE` рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдЖрд╡рд░реНрддрди** рдХрд░рддрд╛ рдерд╛, рдФрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрд╕ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рддрд╛ рдерд╛ред\
рдпрд╣ рд╣рдорд▓рд╛ рдПрдХ **рдирдХрд▓реА `_IO_FILE` рд╕рдВрд░рдЪрдирд╛** рдмрдирд╛рдПрдЧрд╛ рдЬрд┐рд╕реЗ рд╣рдо **`_IO_list_all`** рдореЗрдВ рд▓рд┐рдЦреЗрдВрдЧреЗ, рдФрд░ `malloc_printerr` рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧрд╛ред\
рдлрд┐рд░ рдпрд╣ **рдХреЛрдИ рднреА рдкрддрд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛** рдЬреЛ рд╣рдордиреЗ **`_IO_FILE`** рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреА рдЬрдВрдк рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рд╣реИ, рдФрд░ рд╣рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдорд┐рд▓реЗрдЧрд╛ред

### Attack

рд╣рдорд▓рд╛ **рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди** рдХреЗ рдЕрдВрджрд░ **рдЯреЙрдк рдЪрдВрдХ** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрдиреЗ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ `malloc` рдХреЛ рдПрдХ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рд╡рд░реНрддрдорд╛рди рдЯреЙрдк рдЪрдВрдХ рдЖрдХрд╛рд░ рд╕реЗ рдмрдбрд╝рд╛ рд╣реИ рд▓реЗрдХрд┐рди **`mmp_.mmap_threshold`** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ 128K) рд╕реЗ рдЫреЛрдЯрд╛ рд╣реИ, рдЬреЛ рдЕрдиреНрдпрдерд╛ `mmap` рдЖрд╡рдВрдЯрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ред рдЬрдм рднреА рдЯреЙрдк рдЪрдВрдХ рдЖрдХрд╛рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рдЯреЙрдк рдЪрдВрдХ + рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░** рдкреГрд╖реНрда-рд╕рдВрд░реЗрдЦрд┐рдд рд╣реЛ рдФрд░ рдХрд┐ рдЯреЙрдк рдЪрдВрдХ рдХрд╛ **prev\_inuse** рдмрд┐рдЯ рд╣рдореЗрд╢рд╛ рд╕реЗрдЯ рд╣реЛред

рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдХреЗ рдЕрдВрджрд░ рдЯреЙрдк рдЪрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЯреЙрдк рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЯреЙрдк рдЪрдВрдХ рдЖрдХрд╛рд░ рдХреЛ рдмрджрд▓реЗрдВ (рдЖрд╡рдВрдЯрд┐рдд рдЪрдВрдХ рдореЗрдВ рдУрд╡рд░рдлреНрд▓реЛ рдХреЗ рд╕рд╛рде) рддрд╛рдХрд┐ **рдЯреЙрдк рдЪрдВрдХ + рдЖрдХрд╛рд░** рдкреГрд╖реНрда-рд╕рдВрд░реЗрдЦрд┐рдд рд╣реЛ рдФрд░ **prev\_inuse** рдмрд┐рдЯ рд╕реЗрдЯ рд╣реЛред рдлрд┐рд░ рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ рдЬреЛ рдирдП рдЯреЙрдк рдЪрдВрдХ рдЖрдХрд╛рд░ рд╕реЗ рдмрдбрд╝рд╛ рд╣реЛред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ `free` рдХреЛ рдХрднреА рднреА рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдЯреЙрдк рдЪрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдкреБрд░рд╛рдирд╛ рдЯреЙрдк рдЪрдВрдХ рдЕрдм рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рд╣реИред рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдЗрд╕рдХреЗ рдЕрдВрджрд░ рдбреЗрдЯрд╛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ (рд╕рдВрднрд╡рддрдГ рдПрдХ рднреЗрджреНрдпрддрд╛ рдХреЗ рдХрд╛рд░рдг рдЬрд┐рд╕рдиреЗ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛), рддреЛ рдЗрд╕рд╕реЗ libc рдкрддреЗ рд▓реАрдХ рдХрд░рдирд╛ рдФрд░ **\_IO\_list\_all** рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рдПрдХ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╣рдорд▓рд╛ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ `topChunk->bk->fwd = _IO_list_all - 0x10` рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХреЗред рдЬрдм рдПрдХ рдирдпрд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкреБрд░рд╛рдирд╛ рдЯреЙрдк рдЪрдВрдХ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реЛрдЧрд╛, рдФрд░ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдПрдХ рдкреНрд╡рд╛рдЗрдВрдЯрд░ **`_IO_list_all`** рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЕрдЧрд▓рд╛ рдХрджрдо рдкреБрд░рд╛рдиреЗ рдЯреЙрдк рдЪрдВрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдПрдХ рдЫреЛрдЯреЗ рдмрд┐рди рдореЗрдВ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдо рдХрд░рдирд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЗрд╕рдХреЗ рдЖрдХрд╛рд░ рдХреЛ **0x61** рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ред рдЗрд╕рдХрд╛ рджреЛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИрдВ:

1. **рдЫреЛрдЯреЗ рдмрд┐рди 4 рдореЗрдВ рд╕рдореНрдорд┐рд▓рди**: рдЬрдм `malloc` рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдХреИрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдЪрдВрдХ рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕рдХреЗ рдЫреЛрдЯреЗ рдЖрдХрд╛рд░ рдХреЗ рдХрд╛рд░рдг рдЗрд╕реЗ рдЫреЛрдЯреЗ рдмрд┐рди 4 рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред рдЗрд╕рд╕реЗ рдЪрдВрдХ рдЫреЛрдЯреЗ рдмрд┐рди 4 рд╕реВрдЪреА рдХреЗ рд╕рд┐рд░ рдкрд░ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ **`_IO_list_all`** рдХреЗ рдЪрдВрдХ рдХреЗ FD рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХрд╛ рд╕реНрдерд╛рди рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╣рдорд▓реЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **`_IO_list_all`** рдореЗрдВ рдПрдХ рдирд┐рдХрдЯ рдкрддрд╛ рд▓рд┐рдЦрд╛ рдерд╛ред
2. **Malloc рдЬрд╛рдВрдЪ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдирд╛**: рдЗрд╕ рдЪрдВрдХ рдЖрдХрд╛рд░ рдореЗрдВ рд╣реЗрд░рдлреЗрд░ `malloc` рдХреЛ рдЖрдВрддрд░рд┐рдХ рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧрд╛ред рдЬрдм рдпрд╣ рдЭреВрдареЗ рдлреЙрд░рд╡рд░реНрдб рдЪрдВрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╢реВрдиреНрдп рд╣реЛрдЧрд╛, рддреЛ рдпрд╣ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ `malloc_printerr` рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред

рдЫреЛрдЯреЗ рдмрд┐рди рдХрд╛ рд╣реЗрд░рдлреЗрд░ рдЖрдкрдХреЛ рдЪрдВрдХ рдХреЗ рдлреЙрд░рд╡рд░реНрдб рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред **\_IO\_list\_all** рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдирдХрд▓реА **\_IO\_FILE** рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕рдореЗрдВ `_IO_write_base` рдФрд░ `_IO_write_ptr` рдЬреИрд╕реЗ рдкреНрд░рдореБрдЦ рдлрд╝реАрд▓реНрдб рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ, рдЬрд┐рдиреНрд╣реЗрдВ libc рдореЗрдВ рдЖрдВрддрд░рд┐рдХ рдЬрд╛рдВрдЪ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдирдХрд▓реА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рднреАрддрд░ рдПрдХ рдЬрдВрдк рдЯреЗрдмрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЬрд╣рд╛рдВ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХреЛ рдЙрд╕ рдкрддреЗ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдордирдорд╛рдирд╛ рдХреЛрдб (рдЬреИрд╕реЗ, `system` рдлрд╝рдВрдХреНрд╢рди) рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рддрдХрдиреАрдХ рдХреЗ рд╢реЗрд╖ рднрд╛рдЧ рдХрд╛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд╡рд░реНрдгрди рдХрд░реЗрдВ:

* **рдкреБрд░рд╛рдиреЗ рдЯреЙрдк рдЪрдВрдХ рдХреЛ рдЫреЛрдЯрд╛ рдХрд░реЗрдВ**: рдЫреЛрдЯреЗ рдмрд┐рди рдореЗрдВ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд░рд╛рдиреЗ рдЯреЙрдк рдЪрдВрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ **0x61** рдкрд░ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░реЗрдВред
* **рдирдХрд▓реА `_IO_FILE` рд╕рдВрд░рдЪрдирд╛ рд╕реЗрдЯ рдХрд░реЗрдВ**: рдкреБрд░рд╛рдиреЗ рдЯреЙрдк рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдХрд░реЗрдВ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╣рд╛рдИрдЬреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝реАрд▓реНрдб рдХреЛ рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд░реЗрдВред

рдЕрдЧрд▓рд╛ рдХрджрдо рдПрдХ рдирдХрд▓реА **\_IO\_FILE** рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдмрдирд╛рдирд╛ рд╣реИ рдЬреЛ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдкреБрд░рд╛рдиреЗ рдЯреЙрдк рдЪрдВрдХ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рдХрд░рддреА рд╣реИред рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдкрд╣рд▓реЗ рдмрд╛рдЗрдЯреНрд╕ рдХреЛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕рдореЗрдВ рдПрдХ рдХрдорд╛рдВрдб (рдЬреИрд╕реЗ, "/bin/sh") рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛ рдЬреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

рдирдХрд▓реА **\_IO\_FILE** рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдкреНрд░рдореБрдЦ рдлрд╝реАрд▓реНрдб, рдЬреИрд╕реЗ `_IO_write_base` рдФрд░ `_IO_write_ptr`, рдХреЛ libc рдореЗрдВ рдЖрдВрддрд░рд┐рдХ рдЬрд╛рдВрдЪ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдирдХрд▓реА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рднреАрддрд░ рдПрдХ рдЬрдВрдк рдЯреЗрдмрд▓ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЬрд╣рд╛рдВ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд╡рд╛рдЗрдВрдЯрд░ рдХреЛ рдЙрд╕ рдкрддреЗ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЖрдорддреМрд░ рдкрд░, рдпрд╣ `system` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд╣реЛрдЧрд╛ рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рди рдЬреЛ рд╢реЗрд▓ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╣рдорд▓рд╛ рддрдм рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬрдм `malloc` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рд╣реЗрд░рдлреЗрд░ рдХреА рдЧрдИ **\_IO\_FILE** рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЛрдб рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рд╢реЗрд▓ рдХреЗ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рдпрд╛ рдЕрдиреНрдп рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреЗрд▓реЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрддрд╛ рд╣реИред

**рд╣рдорд▓реЗ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢:**

1. **рдЯреЙрдк рдЪрдВрдХ рд╕реЗрдЯ рдХрд░реЗрдВ**: рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ рдФрд░ рдЯреЙрдк рдЪрдВрдХ рдЖрдХрд╛рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВред
2. **рдЯреЙрдк рдЪрдВрдХ рдХреЛ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рдордЬрдмреВрд░ рдХрд░реЗрдВ**: рдПрдХ рдмрдбрд╝рд╛ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВред
3. **libc рдкрддреЗ рд▓реАрдХ рдХрд░реЗрдВ**: рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╕реЗ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рднреЗрджреНрдпрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
4. **рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рд╣рдорд▓рд╛ рдХрд░реЗрдВ**: рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **\_IO\_list\_all** рдореЗрдВ рд▓рд┐рдЦреЗрдВред
5. **рдкреБрд░рд╛рдиреЗ рдЯреЙрдк рдЪрдВрдХ рдХреЛ рдЫреЛрдЯрд╛ рдХрд░реЗрдВ**: рдЗрд╕реЗ рдЫреЛрдЯреЗ рдмрд┐рди рдореЗрдВ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░реЗрдВред
6. **рдирдХрд▓реА \_IO\_FILE рд╕рдВрд░рдЪрдирд╛ рд╕реЗрдЯ рдХрд░реЗрдВ**: рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╣рд╛рдИрдЬреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдХрд▓реА рдлрд╝рд╛рдЗрд▓ рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдПрдВред
7. **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ**: рд╣рдорд▓реЗ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рдордирдорд╛рдирд╛ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВред

рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реАрдк рдкреНрд░рдмрдВрдзрди рддрдВрддреНрд░, libc рдЬрд╛рдирдХрд╛рд░реА рд▓реАрдХ, рдФрд░ рд╣реАрдк рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдмрд┐рдирд╛ рд╕реАрдзреЗ `free` рдХреЛ рдХреЙрд▓ рдХрд┐рдП рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдирдХрд▓реА **\_IO\_FILE** рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рддреИрдпрд╛рд░ рдХрд░рдХреЗ рдФрд░ рдЗрд╕реЗ рд╕рд╣реА рд╕реНрдерд╛рди рдкрд░ рд░рдЦрдХрд░, рд╣рдорд▓рд╛ рдорд╛рдирдХ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрди рд╕рдВрдЪрд╛рд▓рди рдХреЗ рджреМрд░рд╛рди рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╣рд╛рдИрдЬреИрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рд╢реЗрд▓ рдпрд╛ рдЕрдиреНрдп рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

## References

* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_orange/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_orange/)
* [https://guyinatuxedo.github.io/43-house\_of\_orange/house\_orange\_exp/index.html](https://guyinatuxedo.github.io/43-house\_of\_orange/house\_orange\_exp/index.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
