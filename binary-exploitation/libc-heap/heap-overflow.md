# í™ ì˜¤ë²„í”Œë¡œìš°

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

í™ ì˜¤ë²„í”Œë¡œìš°ëŠ” [**ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°**](../stack-overflow/)ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ í™ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì´ëŠ” í™ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì˜ˆì•½ëœ ê³µê°„ì´ ìˆê³  **ì €ì¥ëœ ë°ì´í„°ê°€ ì˜ˆì•½ëœ ê³µê°„ë³´ë‹¤ ë” í¬ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.**

ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ì—ì„œëŠ” ëª…ë ¹ í¬ì¸í„°ë‚˜ ìŠ¤íƒ í”„ë ˆì„ê³¼ ê°™ì€ ì¼ë¶€ ë ˆì§€ìŠ¤í„°ê°€ ìŠ¤íƒì—ì„œ ë³µì›ë  ê²ƒì´ë©° ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™ ì˜¤ë²„í”Œë¡œìš°ì˜ ê²½ìš°, **ê¸°ë³¸ì ìœ¼ë¡œ ì˜¤ë²„í”Œë¡œìš°ë  ìˆ˜ ìˆëŠ” í™ ì²­í¬ì— ë¯¼ê°í•œ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.** ê·¸ëŸ¬ë‚˜ ë¯¼ê°í•œ ì •ë³´ë‚˜ í¬ì¸í„°ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì´ ì·¨ì•½ì ì˜ **ì¤‘ìš”ì„±**ì€ **ì–´ë–¤ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§ˆ ìˆ˜ ìˆëŠ”ì§€**ì™€ ê³µê²©ìê°€ ì´ë¥¼ ì–´ë–»ê²Œ ì•…ìš©í•  ìˆ˜ ìˆëŠ”ì§€ì— ë”°ë¼ **ë‹¬ë¼ì§‘ë‹ˆë‹¤.**

{% hint style="success" %}
ì˜¤ë²„í”Œë¡œìš° ì˜¤í”„ì…‹ì„ ì°¾ê¸° ìœ„í•´ [**ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°**](../stack-overflow/#finding-stack-overflows-offsets)ì™€ ë™ì¼í•œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° vs í™ ì˜¤ë²„í”Œë¡œìš°

ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ì—ì„œëŠ” ì·¨ì•½ì ì´ ë°œìƒí•  ë•Œ ìŠ¤íƒì— ì¡´ì¬í•  ë°ì´í„°ì™€ ë°°ì—´ì´ ìƒë‹¹íˆ ì‹ ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìŠ¤íƒì´ ì„ í˜•ì ì´ë©°, í•­ìƒ ì¶©ëŒí•˜ëŠ” ë©”ëª¨ë¦¬ì—ì„œ ì¦ê°€í•˜ê³ , **í”„ë¡œê·¸ë¨ ì‹¤í–‰ì˜ íŠ¹ì • ìœ„ì¹˜ì—ì„œ ìŠ¤íƒ ë©”ëª¨ë¦¬ëŠ” ë³´í†µ ìœ ì‚¬í•œ ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë©°** ê° í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìŠ¤íƒ ë¶€ë¶„ì˜ ëì— íŠ¹ì • êµ¬ì¡°ì™€ í¬ì¸í„°ê°€ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ í™ ì˜¤ë²„í”Œë¡œìš°ì˜ ê²½ìš°, ì‚¬ìš©ëœ ë©”ëª¨ë¦¬ëŠ” ì„ í˜•ì ì´ì§€ ì•Šìœ¼ë©° **í• ë‹¹ëœ ì²­í¬ëŠ” ë³´í†µ ë©”ëª¨ë¦¬ì˜ ë¶„ë¦¬ëœ ìœ„ì¹˜ì— ìˆìŠµë‹ˆë‹¤** (ì„œë¡œ ì˜†ì— ìˆì§€ ì•ŠìŒ) **í¬ê¸°ì— ë”°ë¼ í• ë‹¹ì„ êµ¬ë¶„í•˜ëŠ” ë¹ˆê³¼ ì¡´** ë•Œë¬¸ì— ê·¸ë¦¬ê³  **ì´ì „ì˜ í•´ì œëœ ë©”ëª¨ë¦¬ê°€ ìƒˆë¡œìš´ ì²­í¬ë¥¼ í• ë‹¹í•˜ê¸° ì „ì— ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.** í™ ì˜¤ë²„í”Œë¡œìš°ì— ì·¨ì•½í•œ ê°ì²´ì™€ ì¶©ëŒí•  ê°ì²´ë¥¼ ì•„ëŠ” ê²ƒì€ **ë³µì¡í•©ë‹ˆë‹¤.** ë”°ë¼ì„œ í™ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œê²¬ë˜ë©´, **ì˜¤ë²„í”Œë¡œìš°ë  ìˆ˜ ìˆëŠ” ê°ì²´ì™€ ë©”ëª¨ë¦¬ì—ì„œ ë‹¤ìŒì— ì˜¬ ê°ì²´ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.**

ì´ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê¸°ìˆ  ì¤‘ í•˜ë‚˜ëŠ” **í™ ê·¸ë£¨ë°**ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ [**ì´ ê²Œì‹œë¬¼**](https://azeria-labs.com/grooming-the-ios-kernel-heap/)ì—ì„œ ì„¤ëª…ë©ë‹ˆë‹¤. ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” iOS ì»¤ë„ì—ì„œ ë©”ëª¨ë¦¬ ì²­í¬ë¥¼ ì €ì¥í•  ê³µê°„ì´ ë¶€ì¡±í•  ë•Œ, ì»¤ë„ í˜ì´ì§€ë¡œ í™•ì¥í•˜ê³  ì´ í˜ì´ì§€ë¥¼ ì˜ˆìƒ í¬ê¸°ì˜ ì²­í¬ë¡œ ë‚˜ëˆ„ì–´ ìˆœì„œëŒ€ë¡œ ì‚¬ìš©ëœë‹¤ëŠ” ê²ƒì„ ì„¤ëª…í•©ë‹ˆë‹¤ (iOS ë²„ì „ 9.2ê¹Œì§€, ì´í›„ì—ëŠ” ì´ëŸ¬í•œ ì²­í¬ê°€ ë¬´ì‘ìœ„ë¡œ ì‚¬ìš©ë˜ì–´ ê³µê²©ì˜ ì•…ìš©ì„ ì–´ë µê²Œ ë§Œë“­ë‹ˆë‹¤).

ë”°ë¼ì„œ í™ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•˜ëŠ” ì´ì „ ê²Œì‹œë¬¼ì—ì„œëŠ”, ì˜¤ë²„í”Œë¡œìš°ëœ ê°ì²´ê°€ í”¼í•´ì ê°ì²´ì™€ ì¶©ëŒí•˜ë„ë¡ ê°•ì œí•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ **`kalloc`ì´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œì— ì˜í•´ ê°•ì œë˜ì–´ ëª¨ë“  í•´ì œëœ ì²­í¬ê°€ ì±„ì›Œì§€ê³  ìƒˆë¡œìš´ í˜ì´ì§€ê°€ ìƒì„±ë˜ë„ë¡ ì‹œë„í•©ë‹ˆë‹¤.**

íŠ¹ì • í¬ê¸°ì˜ ê°ì²´ë¡œ ì´ ì±„ìš°ê¸°ë¥¼ ê°•ì œí•˜ê¸° ìœ„í•´, **iOS ë§¥ í¬íŠ¸ì™€ ê´€ë ¨ëœ ì•„ì›ƒ ì˜¤ë¸Œ ë¼ì¸ í• ë‹¹**ì´ ì´ìƒì ì¸ í›„ë³´ì…ë‹ˆë‹¤. ë©”ì‹œì§€ì˜ í¬ê¸°ë¥¼ ì¡°ì •í•¨ìœ¼ë¡œì¨ `kalloc` í• ë‹¹ì˜ í¬ê¸°ë¥¼ ì •í™•íˆ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ë§¥ í¬íŠ¸ê°€ íŒŒê´´ë˜ë©´ í•´ë‹¹ í• ë‹¹ì´ ì¦‰ì‹œ `kfree`ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì´ëŸ¬í•œ ìë¦¬ í‘œì‹œì ì¤‘ ì¼ë¶€ë¥¼ **í•´ì œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`kalloc.4096` ë¬´ë£Œ ëª©ë¡ì€ í›„ì…ì„ ì¶œ ë°©ì‹ìœ¼ë¡œ ìš”ì†Œë¥¼ í•´ì œí•©ë‹ˆë‹¤.** ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¼ë¶€ ìë¦¬ í‘œì‹œìê°€ í•´ì œë˜ê³  ìµìŠ¤í”Œë¡œì‡ì´ ì˜¤ë²„í”Œë¡œìš°ì— ì·¨ì•½í•œ ê°ì²´ë¥¼ í• ë‹¹í•˜ë ¤ê³  ì‹œë„í•  ë•Œ, ì´ ê°ì²´ê°€ í”¼í•´ì ê°ì²´ ë’¤ì— ì˜¬ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

### ì˜ˆì œ libc

[**ì´ í˜ì´ì§€**](https://guyinatuxedo.github.io/27-edit\_free\_chunk/heap\_consolidation\_explanation/index.html)ì—ì„œëŠ” ë‹¤ìŒ ì²­í¬ì˜ prev in use ë¹„íŠ¸ì™€ prev sizeì˜ ìœ„ì¹˜ë¥¼ ë®ì–´ì“°ëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ë³¸ í™ ì˜¤ë²„í”Œë¡œìš° ì—ë®¬ë ˆì´ì…˜ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **ì‚¬ìš© ì¤‘ì¸ ì²­í¬ë¥¼ í†µí•©**(ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê²Œ í•¨)í•˜ê³  **ë‹¤ì‹œ í• ë‹¹í•˜ì—¬ ë‹¤ë¥¸ í¬ì¸í„°ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ë°ì´í„°ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

[**protostar heap 0**](https://guyinatuxedo.github.io/24-heap\_overflow/protostar\_heap0/index.html)ì—ì„œì˜ ë˜ ë‹¤ë¥¸ ì˜ˆì œëŠ” **í™ ì˜¤ë²„í”Œë¡œìš°**ë¥¼ ì•…ìš©í•˜ì—¬ ìŠ¹ë¦¬ í•¨ìˆ˜ í˜¸ì¶œì„ í†µí•´ **í”Œë˜ê·¸ë¥¼ ì–»ëŠ”** ë§¤ìš° ê¸°ë³¸ì ì¸ CTF ì˜ˆì œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

[**protostar heap 1**](https://guyinatuxedo.github.io/24-heap\_overflow/protostar\_heap1/index.html) ì˜ˆì œì—ì„œëŠ” ë²„í¼ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì•…ìš©í•˜ì—¬ **ê·¼ì²˜ ì²­í¬ì— ì£¼ì†Œë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆëŠ” ë°©ë²•**ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ **ì‚¬ìš©ìë¡œë¶€í„° ì„ì˜ì˜ ë°ì´í„°**ê°€ ê¸°ë¡ë  ê²ƒì…ë‹ˆë‹¤.

### ì˜ˆì œ ARM64

í˜ì´ì§€ [https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/](https://8ksec.io/arm64-reversing-and-exploitation-part-1-arm-instruction-set-simple-heap-overflow/)ì—ì„œëŠ” ì˜¤ë²„í”Œë¡œìš°ëœ ì²­í¬ì˜ ë‹¤ìŒ ì²­í¬ì— ì‹¤í–‰ë  ëª…ë ¹ì´ ì €ì¥ë˜ëŠ” í™ ì˜¤ë²„í”Œë¡œìš° ì˜ˆì œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê°„ë‹¨í•œ ìµìŠ¤í”Œë¡œì‡ìœ¼ë¡œ ì´ë¥¼ ë®ì–´ì“°ë©´ ì‹¤í–‰ë  ëª…ë ¹ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
python3 -c 'print("/"*0x400+"/bin/ls\x00")' > hax.txt
```
### Other examples

* [**Auth-or-out. Hack The Box**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/auth-or-out/)
* ìš°ë¦¬ëŠ” ì •ìˆ˜ ì˜¤ë²„í”Œë¡œìš° ì·¨ì•½ì ì„ ì‚¬ìš©í•˜ì—¬ í™ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
* ìš°ë¦¬ëŠ” ì˜¤ë²„í”Œë¡œìš°ëœ ì²­í¬ì˜ `struct` ë‚´ë¶€ì— ìˆëŠ” í•¨ìˆ˜ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ì†ìƒì‹œì¼œ `system`ê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ ì„¤ì •í•˜ê³  ì½”ë“œ ì‹¤í–‰ì„ ì–»ìŠµë‹ˆë‹¤.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
