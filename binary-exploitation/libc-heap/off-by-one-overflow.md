# Off by one overflow

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

рдХреЗрд╡рд▓ 1B рдУрд╡рд░рдлреНрд▓реЛ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреЗ рд╕реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЕрдЧрд▓реЗ рдЪрдВрдХ рдХреЗ `size` рдлрд╝реАрд▓реНрдб рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдпрд╣ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреМрди рд╕реЗ рдЪрдВрдХреНрд╕ рдореБрдХреНрдд рд╣реИрдВ, рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рдЪрдВрдХ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рдЬреЛ рдПрдХ рдЕрдиреНрдп рд╡реИрдз рдЪрдВрдХ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рд╢реЛрд╖рдг [рдбрдмрд▓ рдлреНрд░реА](double-free.md) рдпрд╛ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХреНрд╕ рдХреЗ рд╕рдорд╛рди рд╣реИред

рдСрдл рдмрд╛рдп рд╡рди рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ 2 рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

* рдордирдорд╛рдирд╛ рдмрд╛рдЗрдЯ: рдпрд╣ рдкреНрд░рдХрд╛рд░ рдХрд┐рд╕реА рднреА рдорд╛рди рдХреЗ рд╕рд╛рде рдЙрд╕ рдмрд╛рдЗрдЯ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
* рдирд▓ рдмрд╛рдЗрдЯ (рдСрдл-рдмрд╛рдп-рдирд▓): рдпрд╣ рдкреНрд░рдХрд╛рд░ рдЙрд╕ рдмрд╛рдЗрдЯ рдХреЛ рдХреЗрд╡рд▓ 0x00 рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ
* рдЗрд╕ рдХрдордЬреЛрд░реА рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрджрд╛рд╣рд░рдг рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ `strlen` рдФрд░ `strcpy` рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдЕрд╕рдВрдЧрдд рд╣реИ, рдЬреЛ рдЕрдЧрд▓реЗ рдЪрдВрдХ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ 0x00 рдмрд╛рдЗрдЯ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* рдЗрд╕реЗ [рд╣рд╛рдЙрд╕ рдСрдл рдЖрдЗрдиреНрд╣реЗрд░рдЬрд╛рд░](house-of-einherjar.md) рдХреЗ рд╕рд╛рде рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдпрджрд┐ Tcache рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ [рдбрдмрд▓ рдлреНрд░реА](double-free.md) рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд▓рд╛рдн рдЙрдард╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

<details>

<summary>Off-by-null</summary>
```c
// From https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/off_by_one/
int main(void)
{
char buffer[40]="";
void *chunk1;
chunk1 = malloc(24);
puts("Get Input");
gets(buffer);
if(strlen(buffer)==24)
{
strcpy(chunk1,buffer);
}
return 0;
}
```
</details>

рдЕрдиреНрдп рдЬрд╛рдВрдЪреЛрдВ рдХреЗ рдмреАрдЪ, рдЕрдм рдЬрдм рднреА рдПрдХ рдЪрдВрдХ рдореБрдХреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдкрд┐рдЫрд▓реЗ рдЖрдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рдЪрдВрдХ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдЖрдХрд╛рд░ рд╕реЗ рдХреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рд╣рдорд▓рд╛ рд╕рдВрд╕реНрдХрд░рдг 2.28 рд╕реЗ рдХрд╛рдлреА рдЬрдЯрд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

### рдХреЛрдб рдЙрджрд╛рд╣рд░рдг:

* [https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c](https://github.com/DhavalKapil/heap-exploitation/blob/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/shrinking\_free\_chunks.c)
* рдпрд╣ рд╣рдорд▓рд╛ рдЕрдм Tcaches рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдХрд╛рд░рдг рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИред
* рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдмрдбрд╝реЗ рдЪрдВрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ (рддрд╛рдХрд┐ tcaches рд╢рд╛рдорд┐рд▓ рди рд╣реЛрдВ), рддреЛ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ рдорд┐рд▓реЗрдЧреА: `malloc(): invalid next size (unsorted)`

### рд▓рдХреНрд╖реНрдп

* рдПрдХ рдЪрдВрдХ рдХреЛ рджреВрд╕рд░реЗ рдЪрдВрдХ рдХреЗ рдЕрдВрджрд░ рд░рдЦрдирд╛ рддрд╛рдХрд┐ рдЙрд╕ рджреВрд╕рд░реЗ рдЪрдВрдХ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рдЙрд╕ рдЪрдВрдХ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗред

### рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

* рдЖрдХрд╛рд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдл рдмрд╛рдп рд╡рди рдУрд╡рд░рдлреНрд▓реЛред

### рд╕рд╛рдорд╛рдиреНрдп рдСрдл-рдмрд╛рдп-рд╡рди рд╣рдорд▓рд╛

* рддреАрди рдЪрдВрдХреНрд╕ `A`, `B` рдФрд░ `C` (рдорд╛рди рд▓реЗрдВ рдЖрдХрд╛рд░ 0x20) рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ, рдФрд░ рдПрдХ рдФрд░ рдПрдХ рдХреЛ рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрди рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдПред
* `C` рдХреЛ рдореБрдХреНрдд рдХрд░реЗрдВ (0x20 Tcache рдореБрдХреНрдд рд╕реВрдЪреА рдореЗрдВ рдбрд╛рд▓рд╛ рдЧрдпрд╛)ред
* рдЪрдВрдХ `A` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `B` рдкрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХрд░реЗрдВред `B` рдХреЗ `size` рдлрд╝реАрд▓реНрдб рдХреЛ 0x21 рд╕реЗ 0x41 рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдл-рдмрд╛рдп-рд╡рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдВред
* рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ `B` рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдореБрдХреНрдд рдЪрдВрдХ `C` рд╣реИред
* `B` рдХреЛ рдореБрдХреНрдд рдХрд░реЗрдВ рдФрд░ 0x40 рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ (рдпрд╣ рдлрд┐рд░ рд╕реЗ рдпрд╣рд╛рдБ рд░рдЦрд╛ рдЬрд╛рдПрдЧрд╛)ред
* рд╣рдо `C` рд╕реЗ `fd` рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдЕрднреА рднреА рдореБрдХреНрдд рд╣реИ (Tcache рд╡рд┐рд╖рд╛рдХреНрддрддрд╛)ред

### рдСрдл-рдмрд╛рдп-рдирд▓ рд╣рдорд▓рд╛

* 3 рдореЗрдореЛрд░реА рдЪрдВрдХреНрд╕ (a, b, c) рдПрдХ рдХреЗ рдмрд╛рдж рдПрдХ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдлрд┐рд░ рдордзреНрдп рд╡рд╛рд▓рд╛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдкрд╣рд▓рд╛ рдПрдХ рдСрдл рдмрд╛рдп рд╡рди рдУрд╡рд░рдлреНрд▓реЛ рднреЗрджреНрдпрддрд╛ рдХреЛ рд╕рдорд╛рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ 0x00 рдХреЗ рд╕рд╛рде рдХрд░рддрд╛ рд╣реИ (рдпрджрд┐ рдкрд┐рдЫрд▓реЗ рдмрд╛рдЗрдЯ 0x10 рдерд╛ рддреЛ рдпрд╣ рдордзреНрдп рдЪрдВрдХ рдХреЛ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдЧрд╛ рдХрд┐ рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ 0x10 рдЫреЛрдЯрд╛ рд╣реИ)ред
* рдлрд┐рд░, рдордзреНрдп рдореБрдХреНрдд рдЪрдВрдХ (b) рдореЗрдВ 2 рдФрд░ рдЫреЛрдЯреЗ рдЪрдВрдХреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЪреВрдВрдХрд┐ `b + b->size` рдХрднреА рднреА c рдЪрдВрдХ рдХреЛ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдкреЙрдЗрдВрдЯреЗрдб рдкрддрд╛ рдЬрд┐рддрдирд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЙрд╕рд╕реЗ рдЫреЛрдЯрд╛ рд╣реИред
* рдлрд┐рд░, b1 рдФрд░ c рдореБрдХреНрдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рдЪреВрдВрдХрд┐ `c - c->prev_size` рдЕрднреА рднреА b (рдЕрдм b1) рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ, рджреЛрдиреЛрдВ рдПрдХ рдЪрдВрдХ рдореЗрдВ рд╕рдореЗрдХрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, b2 рдЕрднреА рднреА b1 рдФрд░ c рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИред
* рдЕрдВрддрддрдГ, рдПрдХ рдирдпрд╛ malloc рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ b2 рдХреЛ рд╕рдорд╛рд╣рд┐рдд рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдирдП malloc рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЛ b2 рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред

рдпрд╣ рдЪрд┐рддреНрд░ рд╣рдорд▓реЗ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдордЭрд╛рддрд╛ рд╣реИ:

<figure><img src="../../.gitbook/assets/image (1247).png" alt=""><figcaption><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks">https://heap-exploitation.dhavalkapil.com/attacks/shrinking_free_chunks</a></p></figcaption></figure>

## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [**https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks**](https://heap-exploitation.dhavalkapil.com/attacks/shrinking\_free\_chunks)
* [**Bon-nie-appetit. HTB Cyber Apocalypse CTF 2022**](https://7rocky.github.io/en/ctf/htb-challenges/pwn/bon-nie-appetit/)
* `strlen` рдХреЗ рдХрд╛рд░рдг рдСрдл-рдмрд╛рдп-рд╡рдиред
* Tcache рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдСрдл-рдмрд╛рдп-рд╡рди рд╣рдорд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ Tcache рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдиреЗ рдХреА рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* [**Asis CTF 2016 b00ks**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/off\_by\_one/#1-asis-ctf-2016-b00ks)
* рдПрдХ рдСрдл рдмрд╛рдп рд╡рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реАрдк рд╕реЗ рдПрдХ рдкрддрд╛ рд▓реАрдХ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ 0x00 рдмрд╛рдЗрдЯ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЕрдВрдд рдореЗрдВ рдЕрдЧрд▓реЗ рдлрд╝реАрд▓реНрдб рджреНрд╡рд╛рд░рд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред
* рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдиреЗ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдл рдмрд╛рдп рд╡рди рд▓рд┐рдЦрдиреЗ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдПрдХ рдФрд░ рд╕реНрдерд╛рди рдкрд░ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрд╣рд╛рдБ рдПрдХ рдирдХрд▓реА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рд╛рде рдирдХрд▓реА рдкреЙрдЗрдВрдЯрд░ рдмрдирд╛рдП рдЬрд╛рдПрдВрдЧреЗред рдлрд┐рд░, рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдкреЙрдЗрдВрдЯрд░ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИред
* libc рдкрддрд╛ рд▓реАрдХ рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рд╣реАрдк рдХреЛ mmap рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдврд╝рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ mmap рджреНрд╡рд╛рд░рд╛ рдЖрд╡рдВрдЯрд┐рдд рдореЗрдореЛрд░реА libc рд╕реЗ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдСрдлрд╕реЗрдЯ рд╣реЛрддреА рд╣реИред
* рдЕрдВрддрддрдГ рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдиреЗ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ \_\_free\_hook рдХреЗ рдкрддреЗ рдкрд░ рдПрдХ рдЧреЗрдЬреЗрдЯ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХреЗред
* [**plaidctf 2015 plaiddb**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/off\_by\_one/#instance-2-plaidctf-2015-plaiddb)
* `getline` рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдПрдХ NULL рдСрдл рдмрд╛рдп рд╡рди рднреЗрджреНрдпрддрд╛ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдкрдврд╝рддрд╛ рд╣реИред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рд╛рдордЧреНрд░реА рдХреА "рдХреБрдВрдЬреА" рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рдордЧреНрд░реА рдирд╣реАрдВред
* рд▓реЗрдЦрди рдореЗрдВ 5 рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЪрдВрдХреНрд╕ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ:
* chunk1 (0x200)
* chunk2  (0x50)
* chunk5 (0x68)
* chunk3 (0x1f8)
* chunk4 (0xf0)
* рд╢реАрд░реНрд╖ рдЪрдВрдХ рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрди рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЪрдВрдХ рд░рдХреНрд╖рд╛ (0x400)
* рдлрд┐рд░ рдЪрдВрдХ 1, 5 рдФрд░ 3 рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП:
* ```python
[ 0x200 Chunk 1 (free) ] [ 0x50 Chunk 2 ] [ 0x68 Chunk 5 (free) ] [ 0x1f8 Chunk 3 (free) ] [ 0xf0 Chunk 4 ] [ 0x400 Chunk defense ]
```
* рдлрд┐рд░ рдЪрдВрдХ3 (0x1f8) рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдирд▓ рдСрдл-рдмрд╛рдп-рд╡рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, `prev_size` рдХреЛ `0x4e0` рдкрд░ рд▓рд┐рдЦрддреЗ рд╣реБрдПред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд рдЪрдВрдХреНрд╕ 1, 2, 5 рдФрд░ 3 рдХреЗ рдЖрдХрд╛рд░ рдФрд░ рдЙрди рдЪрдВрдХреНрд╕ рдХреЗ 4 рдХреЗ рд╣реЗрдбрд░ рдХрд╛ рдпреЛрдЧ `0x4e0` рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ:  `hex(0x1f8 + 0x10 + 0x68 + 0x10 + 0x50 + 0x10 + 0x200) = 0x4e0`
* рдлрд┐рд░, рдЪрдВрдХ 4 рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдЪрдВрдХ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рднреА рдЪрдВрдХреНрд╕ рдХреЛ рд╢реБрд░реВ рд╕реЗ рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ:
* ```python
[ 0x4e0 Chunk 1-2-5-3 (free) ] [ 0xf0 Chunk 4 (corrupted) ] [ 0x400 Chunk defense ]
```
* ```python
[ 0x200 Chunk 1 (free) ] [ 0x50 Chunk 2 ] [ 0x68 Chunk 5 (free) ] [ 0x1f8 Chunk 3 (free) ] [ 0xf0 Chunk 4 ] [ 0x400 Chunk defense ]
```
* рдлрд┐рд░, `0x200` рдмрд╛рдЗрдЯреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬреЛ рдореВрд▓ рдЪрдВрдХ 1 рдХреЛ рднрд░рддреЗ рд╣реИрдВред
* рдФрд░ рдлрд┐рд░ 0x200 рдмрд╛рдЗрдЯреНрд╕ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЪрдВрдХ2 рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд▓рд┐рдП рдХреЛрдИ рд▓реАрдХ рдирд╣реАрдВ рд╣реИ рдФрд░ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛? рд╢рд╛рдпрдж рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
* рдлрд┐рд░, рдпрд╣ 0x58 "a"s рдХреЗ рд╕рд╛рде рдПрдХ рдФрд░ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддрд╛ рд╣реИ (рдЪрдВрдХ2 рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рддреЗ рд╣реБрдП рдФрд░ рдЪрдВрдХ5 рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реБрдП) рдФрд░ рдЪрдВрдХ5 рдХреЗ рддреЗрдЬрд╝ рдмрд┐рди рдЪрдВрдХ рдХреЗ `fd` рдХреЛ `__malloc_hook` рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддреЗ рд╣реБрдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред
* рдлрд┐рд░, 0x68 рдХрд╛ рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ `__malloc_hook` рдореЗрдВ рдирдХрд▓реА рддреЗрдЬрд╝ рдмрд┐рди рдЪрдВрдХ рдЕрдЧрд▓рд╛ рддреЗрдЬрд╝ рдмрд┐рди рдЪрдВрдХ рд╣реЛред
* рдЕрдВрддрддрдГ, 0x68 рдХрд╛ рдПрдХ рдирдпрд╛ рддреЗрдЬрд╝ рдмрд┐рди рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `__malloc_hook` рдХреЛ рдПрдХ `one_gadget` рдкрддреЗ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
{% endhint %}
