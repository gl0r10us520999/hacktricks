# ‡§π‡§æ‡§â‡§∏ ‡§ë‡§´ ‡§∞‡•ã‡§Æ‡§®

{% hint style="success" %}
AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ AWS ‡§∞‡•á‡§° ‡§ü‡•Ä‡§Æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ GCP ‡§∞‡•á‡§° ‡§ü‡•Ä‡§Æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>‡§π‡•à‡§ï‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Ç**](https://github.com/sponsors/carlospolop) ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç!
* **‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç** üí¨ [**‡§°‡§ø‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Ø‡§æ ‡§π‡§Æ‡•á‡§Ç **‡§ü‡•ç‡§µ‡§ø‡§ü‡§∞** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ‡§™‡§∞ ‡§´‡•â‡§≤‡•ã** ‡§ï‡§∞‡•á‡§Ç‡•§
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç, PRs ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§ï‡•á** [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ‡§∞‡•á‡§™‡•ã ‡§Æ‡•á‡§Ç‡•§

</details>
{% endhint %}

## ‡§Æ‡•å‡§≤‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä

‡§Ø‡§π ‡§è‡§ï ‡§¨‡§π‡•Å‡§§ ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§§‡§ï‡§®‡•Ä‡§ï ‡§•‡•Ä ‡§ú‡•ã ‡§´‡•á‡§ï ‡§´‡§æ‡§∏‡•ç‡§ü‡§¨‡§ø‡§®‡•ç‡§∏, ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§¨‡§ø‡§® ‡§π‡§Æ‡§≤‡§æ ‡§î‡§∞ ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡•Ä‡§ï ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ RCE ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§•‡•Ä‡•§ ‡§π‡§æ‡§≤‡§æ‡§Ç‡§ï‡§ø ‡§á‡§∏‡•á [**‡§™‡•à‡§ö ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à**](https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=b90ddd08f6dd688e651df9ee89ca3a69ff88cd0c).

### ‡§ï‡•ã‡§°

* ‡§Ü‡§™ ‡§è‡§ï ‡§â‡§¶‡§æ‡§π‡§∞‡§£ [https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c) ‡§Æ‡•á‡§Ç ‡§™‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

### ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø

* ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á RCE

### ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Ç

* ‡§´‡§æ‡§∏‡•ç‡§ü‡§¨‡§ø‡§® ‡§î‡§∞ ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§¨‡§ø‡§® ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç
* 12 ‡§¨‡§ø‡§ü ‡§ï‡•Ä ‡§Ø‡§æ‡§¶‡•É‡§ö‡•ç‡§õ‡§ø‡§ï‡§§‡§æ ‡§ï‡•ã ‡§¨‡•ç‡§∞‡•Ç‡§ü ‡§´‡•ã‡§∞‡•ç‡§∏ ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ (0.02% ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ) ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä

## ‡§π‡§Æ‡§≤‡•á ‡§ï‡•á ‡§ï‡§¶‡§Æ

### ‡§≠‡§æ‡§ó 1: ‡§´‡§æ‡§∏‡•ç‡§ü‡§¨‡§ø‡§® ‡§ö‡§Ç‡§ï ‡§®‡•á \_\_‡§Æ‡•à‡§≤‡•ã‡§ï\_‡§π‡•Å‡§ï ‡§ï‡•ã ‡§™‡•â‡§á‡§Ç‡§ü ‡§ï‡§ø‡§Ø‡§æ

‡§ï‡§à ‡§ö‡§Ç‡§ï ‡§¨‡§®‡§æ‡§è‡§Ç:

* `fastbin_victim` (0x60, ‡§ë‡§´‡§∏‡•á‡§ü 0): ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§π‡•Ä ‡§π‡•Ä‡§™ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è UAF ‡§ö‡§Ç‡§ï‡•§
* `chunk2` (0x80, ‡§ë‡§´‡§∏‡•á‡§ü 0x70): ‡§Ö‡§ö‡•ç‡§õ‡•á ‡§è‡§≤‡§æ‡§á‡§®‡§Æ‡•á‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è
* `main_arena_use` (0x80, ‡§ë‡§´‡§∏‡•á‡§ü 0x100)
* `relative_offset_heap` (0x60, ‡§ë‡§´‡§∏‡•á‡§ü 0x190): 'main\_arena\_use' ‡§ö‡§Ç‡§ï ‡§™‡§∞ ‡§∏‡§æ‡§™‡•á‡§ï‡•ç‡§∑ ‡§ë‡§´‡§∏‡•á‡§ü

‡§´‡§ø‡§∞ `free(main_arena_use)` ‡§ï‡§∞‡•á‡§Ç ‡§ú‡•ã ‡§á‡§∏ ‡§ö‡§Ç‡§ï ‡§ï‡•ã ‡§Ö‡§®‡§∏‡•â‡§∞‡•ç‡§ü‡•á‡§° ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•á‡§ó‡§æ ‡§î‡§∞ `fd` ‡§î‡§∞ `bk` ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç `main_arena + 0x68` ‡§ï‡§æ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ‡•§

‡§Ö‡§¨ ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§ö‡§Ç‡§ï `fake_libc_chunk(0x60)` ‡§Ü‡§µ‡§Ç‡§ü‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ø‡§π `fd` ‡§î‡§∞ `bk` ‡§Æ‡•á‡§Ç `main_arena + 0x68` ‡§ï‡•á ‡§™‡•â‡§á‡§Ç‡§ü‡§∞‡•ç‡§∏ ‡§ï‡•ã ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

‡§´‡§ø‡§∞ `relative_offset_heap` ‡§î‡§∞ `fastbin_victim` ‡§ï‡•ã ‡§Æ‡•Å‡§ï‡•ç‡§§ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§
```c
/*
Current heap layout:
0x0:   fastbin_victim       - size 0x70
0x70:  alignment_filler     - size 0x90
0x100: fake_libc_chunk      - size 0x70 (contains a fd ptr to main_arena + 0x68)
0x170: leftover_main        - size 0x20
0x190: relative_offset_heap - size 0x70

bin layout:
fastbin:  fastbin_victim -> relative_offset_heap
unsorted: leftover_main
*/
```
* &#x20;`fastbin_victim` ‡§ï‡•á ‡§™‡§æ‡§∏ `fd` ‡§π‡•à ‡§ú‡•ã `relative_offset_heap` ‡§ï‡•Ä ‡§ì‡§∞ ‡§™‡•ã‡§á‡§Ç‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à
* &#x20;`relative_offset_heap` `fake_libc_chunk` ‡§∏‡•á ‡§¶‡•Ç‡§∞‡•Ä ‡§ï‡§æ ‡§ë‡§´‡§∏‡•á‡§ü ‡§π‡•à, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç `main_arena + 0x68` ‡§ï‡§æ ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§π‡•à
* `fastbin_victim.fd` ‡§ï‡•á ‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§¨‡§æ‡§á‡§ü ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§ï‡§∞ `fastbin_victim` ‡§ï‡•ã `main_arena + 0x68` ‡§™‡•â‡§á‡§Ç‡§ü ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à

‡§™‡§ø‡§õ‡§≤‡•Ä ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§π‡§Æ‡§≤‡§æ‡§µ‡§æ‡§∞ ‡§ï‡•ã `fastbin_victim` ‡§ï‡•á `fd` ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§

‡§´‡§ø‡§∞, `main_arena + 0x68` ‡§á‡§§‡§®‡§æ ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡§Æ ‡§á‡§∏‡•á ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§™‡•â‡§á‡§Ç‡§ü‡§∞ **`__malloc_hook`** ‡§ï‡•Ä ‡§ì‡§∞ ‡§™‡§π‡•Å‡§Ç‡§ö‡•á‡•§

‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø `__memalign_hook` ‡§Ü‡§Æ ‡§§‡•å‡§∞ ‡§™‡§∞ `0x7f` ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§â‡§∏‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ú‡•Ä‡§∞‡•ã ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§´‡§ø‡§∞ ‡§á‡§∏‡•á `0x70` ‡§´‡§æ‡§∏‡•ç‡§ü ‡§¨‡§ø‡§® ‡§ï‡•á ‡§Æ‡§æ‡§® ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡§§‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§§‡•á ‡§ï‡•á ‡§Ö‡§Ç‡§§‡§ø‡§Æ 4 ‡§¨‡§ø‡§ü **‡§∞‡•à‡§Ç‡§°‡§Æ** ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç, ‡§á‡§∏‡§≤‡§ø‡§è ‡§á‡§ö‡•ç‡§õ‡§ø‡§§ ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞ ‡§™‡§π‡•Å‡§Ç‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `2^4=16` ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ‡§è‡§Ç ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Ç ‡§è‡§ï ‡§¨‡•Ä‡§è‡§´ ‡§π‡§Æ‡§≤‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§ü‡•Å‡§ï‡§°‡§º‡§æ ‡§á‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã: **`0x70: fastbin_victim -> fake_libc_chunk -> (__malloc_hook - 0x23)`**‡•§

(‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§æ‡§ï‡•Ä ‡§¨‡§æ‡§á‡§ü‡•ç‡§∏ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç [how2heap](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c)[ ‡§â‡§¶‡§æ‡§π‡§∞‡§£](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house_of_roman.c))‡•§ ‡§Ø‡§¶‡§ø ‡§¨‡•Ä‡§è‡§´ ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§§‡•ã ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§¨‡§∏ ‡§ï‡•ç‡§∞‡•à‡§∂ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à (‡§§‡•ã ‡§Ø‡§π ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§§‡§ï ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç)‡•§

‡§´‡§ø‡§∞, 2 ‡§Æ‡•à‡§≤‡•ã‡§ï‡•ç‡§∏ ‡§ï‡§ø‡§è ‡§ú‡§æ‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§´‡§æ‡§∏‡•ç‡§ü ‡§¨‡§ø‡§® ‡§ü‡•Å‡§ï‡§°‡§º‡•ã‡§Ç ‡§ï‡•ã ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á ‡§î‡§∞ ‡§§‡•Ä‡§∏‡§∞‡§æ ‡§è‡§ï ‡§ö‡§Ç‡§ï ‡§≤‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à **`__malloc_hook:`** ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è‡•§
```c
malloc(0x60);
malloc(0x60);
uint8_t* malloc_hook_chunk = malloc(0x60);
```
### ‡§≠‡§æ‡§ó 2: ‡§Ö‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§\_‡§¨‡§ø‡§® ‡§π‡§Æ‡§≤‡§æ

‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Å ‡§ú‡§æ‡§Ç‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:

{% content-ref url="unsorted-bin-attack.md" %}
[unsorted-bin-attack.md](unsorted-bin-attack.md)
{% endcontent-ref %}

‡§≤‡•á‡§ï‡§ø‡§® ‡§Æ‡•Ç‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ø‡§π `chunk->bk` ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§ï‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞ `main_arena + 0x68` ‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§ ‡§î‡§∞ ‡§π‡§Æ ‡§π‡§Æ‡§≤‡•á ‡§ï‡•á ‡§≤‡§ø‡§è `__malloc_hook` ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§´‡§ø‡§∞, ‡§á‡§∏‡•á ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§π‡§Æ ‡§è‡§ï ‡§∞‡§ø‡§≤‡•á‡§ü‡§ø‡§µ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á) ‡§è‡§ï `one_gadget` ‡§ï‡•ã ‡§á‡§Ç‡§ó‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è‡•§

‡§á‡§∏‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ ‡§è‡§ï ‡§ö‡§Ç‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§á‡§∏‡•á **‡§Ö‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§¨‡§ø‡§®** ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤‡§§‡•á ‡§π‡•à‡§Ç:
```c
uint8_t* unsorted_bin_ptr = malloc(0x80);
malloc(0x30); // Don't want to consolidate

puts("Put chunk into unsorted_bin\n");
// Free the chunk to create the UAF
free(unsorted_bin_ptr);
```
Use an UAF in this chunk to point `unsorted_bin_ptr->bk` to the address of `__malloc_hook` (we brute forced this previously).

{% hint style="danger" %}
‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§π‡§Æ‡§≤‡§æ ‡§Ö‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§¨‡§ø‡§® ‡§ï‡•ã ‡§ï‡•ç‡§∑‡§§‡§ø ‡§™‡§π‡•Å‡§Ç‡§ö‡§æ‡§§‡§æ ‡§π‡•à (‡§á‡§∏‡§≤‡§ø‡§è ‡§õ‡•ã‡§ü‡§æ ‡§î‡§∞ ‡§¨‡§°‡§º‡§æ ‡§≠‡•Ä)‡•§ ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡§Æ ‡§Ö‡§¨ ‡§ï‡•á‡§µ‡§≤ **‡§´‡§æ‡§∏‡•ç‡§ü ‡§¨‡§ø‡§® ‡§∏‡•á ‡§Ü‡§µ‡§Ç‡§ü‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç** (‡§è‡§ï ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§ü‡§ø‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§Ö‡§®‡•ç‡§Ø ‡§Ü‡§µ‡§Ç‡§ü‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ï‡•ç‡§∞‡•à‡§∂ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à), ‡§î‡§∞ ‡§á‡§∏‡•á ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§Æ‡•á‡§Ç **‡§è‡§ï ‡§π‡•Ä ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§Ü‡§µ‡§Ç‡§ü‡§® ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ ‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§ï‡•ç‡§∞‡•à‡§∂ ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ‡•§**
{% endhint %}

‡§á‡§∏‡§≤‡§ø‡§è, `main_arena + 0x68` ‡§Æ‡•á‡§Ç `__malloc_hook` ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§π‡§Æ‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤ ‡§Ø‡§π ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à: **`malloc(0x80)`**

### ‡§ö‡§∞‡§£ 3: \_\_malloc\_hook ‡§ï‡•ã ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§™‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç

‡§ö‡§∞‡§£ ‡§è‡§ï ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡§®‡•á `__malloc_hook` ‡§ï‡•ã ‡§∏‡§Æ‡§æ‡§µ‡•á‡§∂ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§è‡§ï ‡§ö‡§Ç‡§ï ‡§ï‡•ã ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§ø‡§Ø‡§æ (‡§ö‡§∞‡§£ ‡§¶‡•ã ‡§Æ‡•á‡§Ç ‡§π‡§Æ‡§®‡•á ‡§Ø‡§π‡§æ‡§Ç `main_arena + 0x68` ‡§≤‡§ø‡§ñ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤ ‡§∞‡§π‡•á‡•§

‡§Ö‡§¨, ‡§π‡§Æ `malloc_hook_chunk` ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§π‡§Æ ‡§µ‡§π‡§æ‡§Ç ‡§≤‡§ø‡§ñ‡•á ‡§ó‡§è libc ‡§™‡§§‡•á ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç (`main_arena + 0x68`) **‡§è‡§ï `one_gadget` ‡§™‡§§‡•á ‡§ï‡•ã ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è‡•§**

‡§Ø‡§π‡§æ‡§Ç ‡§µ‡§π‡§æ‡§Ç **12 ‡§¨‡§ø‡§ü ‡§ï‡•á ‡§Ø‡§æ‡§¶‡•É‡§ö‡•ç‡§õ‡§ø‡§ï‡§§‡§æ ‡§ï‡§æ ‡§¨‡•ç‡§∞‡•Ç‡§ü‡§´‡•ã‡§∞‡•ç‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•à** (‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä [how2heap](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c) [‡§â‡§¶‡§æ‡§π‡§∞‡§£](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c) ‡§Æ‡•á‡§Ç‡•§)

‡§Ö‡§Ç‡§§‡§§‡§É, ‡§∏‡§π‡•Ä ‡§™‡§§‡§æ ‡§ì‡§µ‡§∞‡§∞‡§æ‡§á‡§ü ‡§π‡•ã‡§®‡•á ‡§™‡§∞, **`malloc` ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ `one_gadget` ‡§ï‡•ã ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§**

## ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠

* [https://github.com/shellphish/how2heap](https://github.com/shellphish/how2heap)
* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.23/house\_of\_roman.c)
* [https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_roman/](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_roman/)
