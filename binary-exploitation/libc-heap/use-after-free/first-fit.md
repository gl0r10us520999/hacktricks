# First Fit

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **First Fit**

рдЬрдм рдЖрдк glibc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдореЗрдореЛрд░реА рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдореЗрдореЛрд░реА рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди "рдмрд┐рди" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣рд╛рдБ рджреЛ рд╕рд╛рдорд╛рдиреНрдп рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХрд╛ рд╕рд░рд▓ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рд╣реИ: рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рдФрд░ рдлрд╛рд╕реНрдЯрдмрд┐рдиред

### Unsorted Bins

рдЬрдм рдЖрдк рдПрдХ рдореЗрдореЛрд░реА рдЯреБрдХрдбрд╝рд╛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рддреЗрдЬрд╝ рдЯреБрдХрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдмрд┐рди рдПрдХ рд╕реВрдЪреА рдХреА рддрд░рд╣ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рдирдП рдореБрдХреНрдд рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рд╕рд╛рдордиреЗ ( "рд╣реЗрдб") рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред рдЬрдм рдЖрдк рдореЗрдореЛрд░реА рдХрд╛ рдПрдХ рдирдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рдХреЛ рдкреАрдЫреЗ ( "рдЯреЗрд▓") рд╕реЗ рджреЗрдЦрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдРрд╕рд╛ рдЯреБрдХрдбрд╝рд╛ рдвреВрдВрдв рд╕рдХреЗ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рд╣реЛред рдпрджрд┐ рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рд╕реЗ рдХреЛрдИ рдЯреБрдХрдбрд╝рд╛ рдЖрдкрдХреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрдХрд╛рд░ рд╕реЗ рдмрдбрд╝рд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рд╛рдордиреЗ рдХрд╛ рднрд╛рдЧ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╢реЗрд╖ рднрд╛рдЧ рдмрд┐рди рдореЗрдВ рд░рд╣рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:

* рдЖрдк 300 рдмрд╛рдЗрдЯ (`a`) рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ 250 рдмрд╛рдЗрдЯ (`b`), `a` рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ 250 рдмрд╛рдЗрдЯ (`c`) рдорд╛рдВрдЧрддреЗ рд╣реИрдВред
* рдЬрдм рдЖрдк `a` рдХреЛ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдпрджрд┐ рдЖрдк рдлрд┐рд░ рд╕реЗ 250 рдмрд╛рдЗрдЯ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ `a` рдХреЛ рдЯреЗрд▓ рдкрд░ рдвреВрдВрдврддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рднрд╛рдЧ рд▓реМрдЯрд╛рддреЗ рд╣реБрдП рдФрд░ рд╢реЗрд╖ рдХреЛ рдмрд┐рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдПред
* `c` рдкрд┐рдЫрд▓реЗ `a` рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░реЗрдЧрд╛ рдФрд░ `a's` рд╕реЗ рднрд░рд╛ рд╣реЛрдЧрд╛ред
```c
char *a = malloc(300);
char *b = malloc(250);
free(a);
char *c = malloc(250);
```
### Fastbins

Fastbins рдЫреЛрдЯреЗ рдореЗрдореЛрд░реА рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЕрд╕рдВрд░рдЪрд┐рдд рдмрд┐рди рдХреЗ рд╡рд┐рдкрд░реАрдд, рдлрд╛рд╕реНрдЯрдмрд┐рди рдирдП рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рд╕рд┐рд░ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЕрдВрддрд┐рдо-рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐-рдкреНрд░рдердо-рдирд┐рд░реНрдЧрдорди (LIFO) рд╡реНрдпрд╡рд╣рд╛рд░ рдмрдирддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЫреЛрдЯреЗ рдореЗрдореЛрд░реА рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдХреЗ рд╕рд┐рд░ рд╕реЗ рдЦреАрдВрдЪреЗрдЧрд╛ред

Example:

* рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП рдЪрд╛рд░ 20 рдмрд╛рдЗрдЯ рдХреЗ рдЯреБрдХрдбрд╝реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ (`a`, `b`, `c`, `d`)ред
* рдЬрдм рдЖрдк рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рднреА рдХреНрд░рдо рдореЗрдВ рдореБрдХреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдореБрдХреНрдд рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рдлрд╛рд╕реНрдЯрдмрд┐рди рдХреЗ рд╕рд┐рд░ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред
* рдпрджрд┐ рдЖрдк рдлрд┐рд░ 20-рдмрд╛рдЗрдЯ рдХрд╛ рдЯреБрдХрдбрд╝рд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрд╡рдВрдЯрдХ рдлрд╛рд╕реНрдЯрдмрд┐рди рдХреЗ рд╕рд┐рд░ рд╕реЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЯреБрдХрдбрд╝рд╛ рд▓реМрдЯрд╛рдПрдЧрд╛ред
```c
char *a = malloc(20);
char *b = malloc(20);
char *c = malloc(20);
char *d = malloc(20);
free(a);
free(b);
free(c);
free(d);
a = malloc(20);   // d
b = malloc(20);   // c
c = malloc(20);   // b
d = malloc(20);   // a
```
## рдЕрдиреНрдп рд╕рдВрджрд░реНрдн рдФрд░ рдЙрджрд╛рд╣рд░рдг

* [**https://heap-exploitation.dhavalkapil.com/attacks/first\_fit**](https://heap-exploitation.dhavalkapil.com/attacks/first\_fit)
* [**https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/**](https://8ksec.io/arm64-reversing-and-exploitation-part-2-use-after-free/)
* ARM64. Use after free: рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд╕реНрддреБ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ, рдЗрд╕реЗ рдореБрдХреНрдд рдХрд░реЗрдВ, рдПрдХ рд╡рд╕реНрддреБ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ рдЬреЛ рдореБрдХреНрдд рдХрд┐рдП рдЧрдП рднрд╛рдЧ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, **рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рд╕реЗ user->password рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛**ред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ **рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдВрдЪ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ**
* [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use\_after\_free/#example**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/use\_after\_free/#example)
* рдХрд╛рд░реНрдпрдХреНрд░рдо рдиреЛрдЯреНрд╕ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдПрдХ рдиреЛрдЯ рдореЗрдВ рдиреЛрдЯ рдХреА рдЬрд╛рдирдХрд╛рд░реА malloc(8) рдореЗрдВ рд╣реЛрдЧреА (рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ) рдФрд░ рдПрдХ рдЕрдиреНрдп malloc(\<size>) рдХрд╛ рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдиреЛрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрдЧреАред
* рд╣рдорд▓рд╛ 2 рдиреЛрдЯреНрд╕ (note0 рдФрд░ note1) рдмрдирд╛рдиреЗ рдХрд╛ рд╣реЛрдЧрд╛ рдЬрд┐рдирдХреА malloc рд╕рд╛рдордЧреНрд░реА рдиреЛрдЯ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдмрдбрд╝реА рд╣реЛрдЧреА рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдореБрдХреНрдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╡реЗ рддреЗрдЬ рдмрд┐рди (рдпрд╛ tcache) рдореЗрдВ рдЬрд╛ рд╕рдХреЗрдВред
* рдлрд┐рд░, рдПрдХ рдФрд░ рдиреЛрдЯ (note2) рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЖрдХрд╛рд░ 8 рд╣реЛред рд╕рд╛рдордЧреНрд░реА note1 рдореЗрдВ рд╣реЛрдЧреА рдХреНрдпреЛрдВрдХрд┐ рднрд╛рдЧ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд╣рд╛рдВ рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдЬреАрддрдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреА рдУрд░ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ Use-After-Free note1 рдХреЛ рдирдП рдлрд╝рдВрдХреНрд╢рди рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* [**https://guyinatuxedo.github.io/26-heap\_grooming/pico\_areyouroot/index.html**](https://guyinatuxedo.github.io/26-heap\_grooming/pico\_areyouroot/index.html)
* рдХреБрдЫ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛, рдЗрдЪреНрдЫрд┐рдд рдорд╛рди рд▓рд┐рдЦрдирд╛, рдЗрд╕реЗ рдореБрдХреНрдд рдХрд░рдирд╛, рдлрд┐рд░ рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдЪреВрдВрдХрд┐ рдкрд┐рдЫрд▓реЗ рдбреЗрдЯрд╛ рдЕрднреА рднреА рд╡рд╣рд╛рдВ рд╣реИ, рдЗрд╕реЗ рднрд╛рдЧ рдореЗрдВ рдирдП рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд┐рд╕рд╕реЗ рдорд╛рди рд╕реЗрдЯ рдХрд░рдирд╛ рдпрд╛ рдзреНрд╡рдЬ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред
* [**https://guyinatuxedo.github.io/26-heap\_grooming/swamp19\_heapgolf/index.html**](https://guyinatuxedo.github.io/26-heap\_grooming/swamp19\_heapgolf/index.html)
* рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рднрд╛рдЧ рдХреЗ рдЕрдВрджрд░ 4 рд▓рд┐рдЦрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬреЛ рдкрд╣рд▓рд╛ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд╕рднреА рдХреЛ рдмрд▓рдкреВрд░реНрд╡рдХ рдореБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рднреА)ред рдкреНрд░рддреНрдпреЗрдХ рдирдП рдЖрд╡рдВрдЯрд┐рдд рднрд╛рдЧ рдореЗрдВ рдЗрд╕рдХрд╛ рд╕рдВрдЦреНрдпрд╛ рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИред рдлрд┐рд░, 4 рднрд╛рдЧреЛрдВ (+ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдЖрд╡рдВрдЯрд┐рдд) рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ, рдЕрдВрддрд┐рдо рдореЗрдВ 4 рд╣реЛрдЧрд╛, рдЙрдиреНрд╣реЗрдВ рдореБрдХреНрдд рдХрд░реЗрдВ рдФрд░ рдкрд╣рд▓реЗ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗрдВ, рдЬреЛ рдЕрдВрддрд┐рдо рдореБрдХреНрдд рдХрд┐рдП рдЧрдП рднрд╛рдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ 4 рд╣реЛрдЧрд╛ред
