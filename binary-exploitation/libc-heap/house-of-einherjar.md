# House of Einherjar

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

### ä»£ç 

* æŸ¥çœ‹ç¤ºä¾‹ [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* æˆ–è€…æŸ¥çœ‹ [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation)ï¼ˆä½ å¯èƒ½éœ€è¦å¡«å…… tcacheï¼‰

### ç›®æ ‡

* ç›®æ ‡æ˜¯åœ¨å‡ ä¹ä»»ä½•ç‰¹å®šåœ°å€åˆ†é…å†…å­˜ã€‚

### è¦æ±‚

* å½“æˆ‘ä»¬æƒ³è¦åˆ†é…ä¸€ä¸ªå—æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå‡å—ï¼š
* è®¾ç½®æŒ‡é’ˆæŒ‡å‘è‡ªèº«ä»¥ç»•è¿‡å®Œæ•´æ€§æ£€æŸ¥
* ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æº¢å‡ºä»ä¸€ä¸ªå—åˆ°ä¸‹ä¸€ä¸ªå—ï¼Œä¿®æ”¹ `PREV_INUSE` æ ‡å¿—ã€‚
* åœ¨è¢«æ»¥ç”¨çš„å—çš„ `prev_size` ä¸­æŒ‡ç¤ºå®ƒä¸å‡å—ä¹‹é—´çš„å·®å¼‚
* å‡å—çš„å¤§å°ä¹Ÿå¿…é¡»è®¾ç½®ä¸ºç›¸åŒçš„å¤§å°ä»¥ç»•è¿‡å®Œæ•´æ€§æ£€æŸ¥
* æ„é€ è¿™äº›å—æ—¶ï¼Œä½ éœ€è¦ä¸€ä¸ªå †æ³„æ¼ã€‚

### æ”»å‡»

* åœ¨æ”»å‡»è€…æ§åˆ¶çš„å—å†…åˆ›å»ºä¸€ä¸ªå‡å— `A`ï¼Œç”¨ `fd` å’Œ `bk` æŒ‡å‘åŸå§‹å—ä»¥ç»•è¿‡ä¿æŠ¤
* åˆ†é…å¦å¤–ä¸¤ä¸ªå—ï¼ˆ`B` å’Œ `C`ï¼‰
* åˆ©ç”¨ `B` ä¸­çš„è¶Šç•Œï¼Œæ¸…é™¤ `prev in use` ä½ï¼Œå¹¶ç”¨ `C` å—åˆ†é…ä½ç½®ä¸ä¹‹å‰ç”Ÿæˆçš„å‡å— `A` ä¹‹é—´çš„å·®å¼‚è¦†ç›– `prev_size` æ•°æ®
* è¿™ä¸ª `prev_size` å’Œå‡å— `A` ä¸­çš„å¤§å°å¿…é¡»ç›¸åŒä»¥ç»•è¿‡æ£€æŸ¥ã€‚
* ç„¶åï¼Œå¡«å…… tcache
* ç„¶åï¼Œé‡Šæ”¾ `C`ï¼Œä½¿å…¶ä¸å‡å— `A` åˆå¹¶
* ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å— `D`ï¼Œå®ƒå°†ä»å‡å— `A` å¼€å§‹å¹¶è¦†ç›– `B` å—
* Einherjar ä¹‹å±‹åœ¨è¿™é‡Œç»“æŸ
* è¿™å¯ä»¥é€šè¿‡å¿«é€Ÿ bin æ”»å‡»æˆ– Tcache ä¸­æ¯’ç»§ç»­ï¼š
* é‡Šæ”¾ `B` ä»¥å°†å…¶æ·»åŠ åˆ°å¿«é€Ÿ bin / Tcache
* `B` çš„ `fd` è¢«è¦†ç›–ï¼Œä½¿å…¶æŒ‡å‘ç›®æ ‡åœ°å€ï¼Œåˆ©ç”¨ `D` å—ï¼ˆå› ä¸ºå®ƒåŒ…å« `B`ï¼‰
* ç„¶åï¼Œè¿›è¡Œä¸¤æ¬¡ mallocï¼Œç¬¬äºŒæ¬¡å°† **åˆ†é…ç›®æ ‡åœ°å€**

## å‚è€ƒå’Œå…¶ä»–ç¤ºä¾‹

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* é‡Šæ”¾æŒ‡é’ˆåï¼Œå®ƒä»¬ä¸ä¼šè¢«ç½®ä¸º nullï¼Œå› æ­¤ä»ç„¶å¯ä»¥è®¿é—®å®ƒä»¬çš„æ•°æ®ã€‚å› æ­¤ï¼Œä¸€ä¸ªå—è¢«æ”¾ç½®åœ¨æœªæ’åºçš„ bin ä¸­å¹¶æ³„æ¼å®ƒåŒ…å«çš„æŒ‡é’ˆï¼ˆlibc leakï¼‰ï¼Œç„¶ååœ¨æœªæ’åºçš„ bin ä¸­æ”¾ç½®ä¸€ä¸ªæ–°çš„å †å¹¶æ³„æ¼ä»å®ƒè·å–çš„æŒ‡é’ˆçš„å †åœ°å€ã€‚
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok` ä¸­çš„ç©ºå­—èŠ‚æº¢å‡ºæ¼æ´ã€‚
* ä½¿ç”¨ Einherjar ä¹‹å±‹æ¥è·å¾—é‡å å—çš„æƒ…å†µï¼Œå¹¶é€šè¿‡ Tcache ä¸­æ¯’ç»“æŸä»¥è·å¾—ä»»æ„å†™å…¥åŸè¯­ã€‚

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
