# House of Einherjar

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### Code

* Check the example from [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Or the one from [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (you might need to fill the tcache)

### Goal

* –ú–µ—Ç–∞ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –≤–∏–¥—ñ–ª–∏—Ç–∏ –ø–∞–º'—è—Ç—å –∑–∞ –º–∞–π–∂–µ –±—É–¥—å-—è–∫–æ—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é.

### Requirements

* –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–µ–π–∫–æ–≤–∏–π —à–º–∞—Ç–æ–∫, –∫–æ–ª–∏ –º–∏ —Ö–æ—á–µ–º–æ –≤–∏–¥—ñ–ª–∏—Ç–∏ —à–º–∞—Ç–æ–∫:
* –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏, —â–æ–± –≤–æ–Ω–∏ –≤–∫–∞–∑—É–≤–∞–ª–∏ –Ω–∞ —Å–µ–±–µ, —â–æ–± –æ–±—ñ–π—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å
* –ü–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –Ω–∞ –æ–¥–∏–Ω –±–∞–π—Ç –∑ –Ω—É–ª—å–æ–≤–∏–º –±–∞–π—Ç–æ–º –∑ –æ–¥–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –ø—Ä–∞–ø–æ—Ä `PREV_INUSE`.
* –í–∫–∞–∑–∞—Ç–∏ –≤ `prev_size` –∑–ª–æ–≤–∂–∏–≤–∞–Ω–æ–≥–æ —à–º–∞—Ç–∫–∞, —â–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ —Å–∞–º–æ–≥–æ —Å–µ–±–µ —Ç–∞ —Ñ–µ–π–∫–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞
* –†–æ–∑–º—ñ—Ä —Ñ–µ–π–∫–æ–≤–æ–≥–æ —à–º–∞—Ç–∫–∞ —Ç–∞–∫–æ–∂ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–∞–∫–∏–º –∂–µ, —â–æ–± –æ–±—ñ–π—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å
* –î–ª—è –ø–æ–±—É–¥–æ–≤–∏ —Ü–∏—Ö —à–º–∞—Ç–∫—ñ–≤ –≤–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –≤–∏—Ç—ñ–∫ –∑ –∫—É–ø–∏.

### Attack

* `A` —Ñ–µ–π–∫–æ–≤–∏–π —à–º–∞—Ç–æ–∫ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —à–º–∞—Ç–∫–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–≥–æ –∞—Ç–∞–∫—É—é—á–∏–º, –≤–∫–∞–∑—É—é—á–∏ `fd` —Ç–∞ `bk` –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —à–º–∞—Ç–æ–∫, —â–æ–± –æ–±—ñ–π—Ç–∏ –∑–∞—Ö–∏—Å—Ç
* –í–∏–¥—ñ–ª—è—é—Ç—å—Å—è —â–µ 2 —à–º–∞—Ç–∫–∏ (`B` —Ç–∞ `C`)
* –ó–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è–º –Ω–∞ –æ–¥–∏–Ω –≤ `B`, –æ—á–∏—â–∞—î—Ç—å—Å—è –±—ñ—Ç `prev in use`, –∞ –¥–∞–Ω—ñ `prev_size` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—é—Ç—å—Å—è —Ä—ñ–∑–Ω–∏—Ü–µ—é –º—ñ–∂ –º—ñ—Å—Ü–µ–º, –¥–µ –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è —à–º–∞—Ç–æ–∫ `C`, —Ç–∞ —Ñ–µ–π–∫–æ–≤–∏–º —à–º–∞—Ç–∫–æ–º `A`, —Å—Ç–≤–æ—Ä–µ–Ω–∏–º —Ä–∞–Ω—ñ—à–µ
* –¶–µ–π `prev_size` —Ç–∞ —Ä–æ–∑–º—ñ—Ä —É —Ñ–µ–π–∫–æ–≤–æ–º—É —à–º–∞—Ç–∫—É `A` –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏, —â–æ–± –æ–±—ñ–π—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
* –ü–æ—Ç—ñ–º –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è tcache
* –ü–æ—Ç—ñ–º `C` –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è, —â–æ–± –æ–±'—î–¥–Ω–∞—Ç–∏—Å—è –∑ —Ñ–µ–π–∫–æ–≤–∏–º —à–º–∞—Ç–∫–æ–º `A`
* –ü–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π —à–º–∞—Ç–æ–∫ `D`, —è–∫–∏–π –ø–æ—á–Ω–µ—Ç—å—Å—è —É —Ñ–µ–π–∫–æ–≤–æ–º—É —à–º–∞—Ç–∫—É `A` —ñ –ø–æ–∫—Ä–∏—î —à–º–∞—Ç–æ–∫ `B`
* –ë—É–¥–∏–Ω–æ–∫ –ï–π–Ω—Ö–µ—Ä'—è—Ä–∞ –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è —Ç—É—Ç
* –¶–µ –º–æ–∂–Ω–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑ –∞—Ç–∞–∫–æ—é —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω –∞–±–æ –æ—Ç—Ä—É—î–Ω–Ω—è–º Tcache:
* –ó–≤—ñ–ª—å–Ω–∏—Ç–∏ `B`, —â–æ–± –¥–æ–¥–∞—Ç–∏ –π–æ–≥–æ –¥–æ —à–≤–∏–¥–∫–æ–≥–æ –±—ñ–Ω—É / Tcache
* `fd` `B` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è, –≤–∫–∞–∑—É—é—á–∏ –Ω–∞ —Ü—ñ–ª—å–æ–≤—É –∞–¥—Ä–µ—Å—É, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ —à–º–∞—Ç–∫–æ–º `D` (–æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –º—ñ—Å—Ç–∏—Ç—å `B`).
* –ü–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è 2 malloc, —ñ –¥—Ä—É–≥–∏–π –∑ –Ω–∏—Ö –±—É–¥–µ **–≤–∏–¥—ñ–ª—è—Ç–∏ —Ü—ñ–ª—å–æ–≤—É –∞–¥—Ä–µ—Å—É**

## References and other examples

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* –ü—ñ—Å–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –Ω–µ –æ–±–Ω—É–ª—è—é—Ç—å—Å—è, —Ç–æ–º—É –≤—Å–µ —â–µ –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —ó—Ö –¥–∞–Ω–∏—Ö. –¢–æ–º—É —à–º–∞—Ç–æ–∫ —Ä–æ–∑–º—ñ—â—É—î—Ç—å—Å—è –≤ –Ω–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ–º—É –±—ñ–Ω—ñ —Ç–∞ –≤–∏—Ç—ñ–∫–∞—î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏, —è–∫—ñ –≤—ñ–Ω –º—ñ—Å—Ç–∏—Ç—å (libc leak), –∞ –ø–æ—Ç—ñ–º –Ω–æ–≤–∞ –∫—É–ø–∞ —Ä–æ–∑–º—ñ—â—É—î—Ç—å—Å—è –≤ –Ω–µ—É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ–º—É –±—ñ–Ω—ñ —Ç–∞ –≤–∏—Ç—ñ–∫–∞—î –∞–¥—Ä–µ—Å—É –∫—É–ø–∏ –∑ –æ—Ç—Ä–∏–º–∞–Ω–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –Ω—É–ª—å–æ–≤–∏–º –±–∞–π—Ç–æ–º —É `strtok`.
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ House of Einherjar, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–∏—Ç—É–∞—Ü—ñ—é –∑ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—á–∏–º–∏ —à–º–∞—Ç–∫–∞–º–∏ —Ç–∞ –∑–∞–∫—ñ–Ω—á–∏—Ç–∏ –∑ –æ—Ç—Ä—É—î–Ω–Ω—è–º Tcache, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏–º—ñ—Ç–∏–≤ –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
