# Einherjar Evi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

### Kod

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c) adresinden Ã¶rneÄŸi kontrol edin
* Ya da [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) adresinden (tcache'i doldurmanÄ±z gerekebilir)

### Hedef

* Hedef, neredeyse herhangi bir belirli adreste bellek ayÄ±rmaktÄ±r.

### Gereksinimler

* Bir parÃ§a ayÄ±rmak istediÄŸimizde sahte bir parÃ§a oluÅŸturun:
* AkÄ±l saÄŸlÄ±ÄŸÄ± kontrollerini atlatmak iÃ§in iÅŸaretÃ§ileri kendisine iÅŸaret edecek ÅŸekilde ayarlayÄ±n
* `PREV_INUSE` bayraÄŸÄ±nÄ± deÄŸiÅŸtirmek iÃ§in bir parÃ§adan diÄŸerine bir null baytÄ± ile bir bayt taÅŸmasÄ±
* Null ile kÃ¶tÃ¼ye kullanÄ±lan parÃ§anÄ±n `prev_size`'sinde kendisi ile sahte parÃ§a arasÄ±ndaki farkÄ± belirtin
* Sahte parÃ§a boyutu da akÄ±l saÄŸlÄ±ÄŸÄ± kontrollerini atlatmak iÃ§in aynÄ± boyutta ayarlanmÄ±ÅŸ olmalÄ±dÄ±r
* Bu parÃ§alarÄ± oluÅŸturmak iÃ§in bir heap leak'e ihtiyacÄ±nÄ±z olacak.

### SaldÄ±rÄ±

* `A` sahte parÃ§asÄ±, saldÄ±rgan tarafÄ±ndan kontrol edilen bir parÃ§a iÃ§inde oluÅŸturulur ve `fd` ve `bk` ile orijinal parÃ§aya iÅŸaret eder, bÃ¶ylece korumalarÄ± atlatÄ±r
* 2 baÅŸka parÃ§a (`B` ve `C`) ayrÄ±lÄ±r
* `B` parÃ§asÄ±ndaki bir bayt taÅŸmasÄ±nÄ± kÃ¶tÃ¼ye kullanarak `prev in use` biti temizlenir ve `prev_size` verisi, `C` parÃ§asÄ±nÄ±n ayrÄ±ldÄ±ÄŸÄ± yer ile daha Ã¶nce oluÅŸturulan sahte `A` parÃ§asÄ± arasÄ±ndaki fark ile Ã¼zerine yazÄ±lÄ±r
* Bu `prev_size` ve sahte parÃ§a `A`'daki boyut aynÄ± olmalÄ±dÄ±r ki kontrolleri atlatabilsin.
* Sonra, tcache doldurulur
* Sonra, `C` serbest bÄ±rakÄ±lÄ±r, bÃ¶ylece sahte parÃ§a `A` ile birleÅŸtirilir
* Sonra, sahte `A` parÃ§asÄ±nda baÅŸlayacak ve `B` parÃ§asÄ±nÄ± kaplayacak yeni bir parÃ§a `D` oluÅŸturulur
* Einherjar Evi burada sona erer
* Bu, hÄ±zlÄ± bin saldÄ±rÄ±sÄ± veya Tcache zehirlemesi ile devam edilebilir:
* `B`'yi serbest bÄ±rakÄ±n ve hÄ±zlÄ± bin / Tcache'e ekleyin
* `B`'nin `fd`'si, hedef adrese iÅŸaret edecek ÅŸekilde Ã¼zerine yazÄ±lÄ±r ve `D` parÃ§asÄ±nÄ± kÃ¶tÃ¼ye kullanÄ±r (Ã§Ã¼nkÃ¼ iÃ§inde `B`'yi barÄ±ndÄ±rÄ±r)&#x20;
* Sonra, 2 malloc yapÄ±lÄ±r ve ikincisi **hedef adresi ayÄ±racaktÄ±r**

## Referanslar ve diÄŸer Ã¶rnekler

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* Ä°ÅŸaretÃ§ileri serbest bÄ±raktÄ±ktan sonra null hale gelmezler, bu nedenle verilerine eriÅŸmek hala mÃ¼mkÃ¼ndÃ¼r. Bu nedenle, bir parÃ§a dÃ¼zensiz binaya yerleÅŸtirilir ve iÃ§erdiÄŸi iÅŸaretÃ§ileri sÄ±zdÄ±rÄ±lÄ±r (libc leak) ve ardÄ±ndan yeni bir heap dÃ¼zensiz binaya yerleÅŸtirilir ve aldÄ±ÄŸÄ± iÅŸaretÃ§iden bir heap adresi sÄ±zdÄ±rÄ±lÄ±r.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok`'da null-bayt taÅŸma hatasÄ±.
* Overlapping chunks durumu elde etmek iÃ§in Einherjar Evi'ni kullanÄ±n ve Tcache zehirlemesi ile keyfi yazma ilkesine ulaÅŸÄ±n.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
