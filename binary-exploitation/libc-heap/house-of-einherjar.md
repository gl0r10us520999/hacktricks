# House of Einherjar

{% hint style="success" %}
**AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:** [**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)\
**GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:** [**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕**](https://github.com/carlospolop/hacktricks) **рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

### рдХреЛрдб

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c) рд╕реЗ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ
* рдпрд╛ [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) рд╕реЗ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ (рдЖрдкрдХреЛ tcache рднрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ)

### рд▓рдХреНрд╖реНрдп

* рд▓рдХреНрд╖реНрдп рд╣реИ рдХрд┐ рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрддреЗ рдкрд░ рдореЗрдореЛрд░реА рдХрд╛ рдЖрд╡рдВрдЯрди рдХрд░реЗрдВред

### рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ

* рдЬрдм рд╣рдо рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдПрдХ рдирдХрд▓реА рдЪрдВрдХ рдмрдирд╛рдПрдВ:
* рд╕реНрдпрд╛рдирд┐рдЯреА рдЪреЗрдХреНрд╕ рдХреЛ рдЫрд▓рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдЦреБрдж рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░реЗрдВ
* рдПрдХ рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдПрдХ рдирд▓ рдмрд╛рдЗрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдЪрдВрдХ рд╕реЗ рдЕрдЧрд▓реЗ рдЪрдВрдХ рддрдХ рдореЙрдбрд┐рдлрд╛рдИ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `PREV_INUSE` рдлреНрд▓реИрдЧред
* рдСрдл-рдмрд╛рдИ-рдирд▓ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЪрдВрдХ рдХреЗ `prev_size` рдореЗрдВ рдЗрд╕рдХреЗ рдФрд░ рдирдХрд▓реА рдЪрдВрдХ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рджрд░реНрд╢рд╛рдПрдВ
* рдирдХрд▓реА рдЪрдВрдХ рдХрд╛ рдЖрдХрд╛рд░ рднреА рд╕реНрдпрд╛рдирд┐рдЯреА рдЪреЗрдХреНрд╕ рдХреЛ рдЫрд▓рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП
* рдЗрди рдЪрдВрдХреНрд╕ рдХреЛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рд╣реАрдк рд▓реАрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

### рд╣рдорд▓рд╛

* рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдПрдХ рдЪрдВрдХ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдирдХрд▓реА рдЪрдВрдХ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `fd` рдФрд░ `bk` рджреНрд╡рд╛рд░рд╛ рдореВрд▓ рдЪрдВрдХ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдЫрд▓рдирд╛ рд╣реЛ
* 2 рдЕрдиреНрдп рдЪрдВрдХ (`B` рдФрд░ `C`) рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ
* `B` рдореЗрдВ рдСрдл-рдмрд╛рдИ-рд╡рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ `prev in use` рдмрд┐рдЯ рдХреЛ рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `prev_size` рдбреЗрдЯрд╛ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `C` рдЪрдВрдХ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддрдХрдиреАрдХреА рдЪрдВрдХ `A` рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░
* рдпрд╣ `prev_size` рдФрд░ рдирдХрд▓реА рдЪрдВрдХ `A` рдореЗрдВ рдЖрдХрд╛рд░ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
* рдлрд┐рд░, tcache рднрд░рд╛ рдЬрд╛рддрд╛ рд╣реИ
* рдлрд┐рд░, `C` рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдирдХрд▓реА рдЪрдВрдХ `A` рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрд┐рдд рд╣реЛ рдЬрд╛рдП
* рдлрд┐рд░, рдПрдХ рдирдпрд╛ рдЪрдВрдХ `D` рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдирдХрд▓реА `A` рдЪрдВрдХ рдореЗрдВ рд╢реБрд░реВ рд╣реЛрдЧрд╛ рдФрд░ `B` рдЪрдВрдХ рдХреЛ рдХрд╡рд░ рдХрд░реЗрдЧрд╛
* рдпрд╣рд╛рдБ рдЖрдЗрдирд╣реЗрд░реНрдЬрд░ рдХрд╛ рдШрд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ
* рдЗрд╕реЗ рдПрдХ рддреЗрдЬ рдмрд┐рди рд╣рдорд▓реЗ рдпрд╛ Tcache poisoning рдХреЗ рд╕рд╛рде рдЬрд╛рд░реА рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
* `B` рдХреЛ рдореБрдХреНрдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЗрд╕реЗ рддреЗрдЬ рдмрд┐рди / Tcache рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХреЗ
* `B` рдХрд╛ `fd` рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рджреЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд▓рдХреНрд╖реНрдп рдкрддреЗ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░реЗ рдЬреЛ `D` рдЪрдВрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ `B` рд╢рд╛рдорд┐рд▓ рд╣реИ)&#x20;
* рдлрд┐рд░, 2 mallocs рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рджреВрд╕рд░рд╛ malloc **рд▓рдХреНрд╖реНрдп рдкрддреЗ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**

## рд╕рдВрджрд░реНрдн рдФрд░ рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдореБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ рдирд▓ рдХрд┐рдпрд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдирдХреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЕрдм рднреА рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рд▓рд┐рдП рдПрдХ рдЪрдВрдХ рдЕрд╕рдВрдЪрд┐рдд рдмрд┐рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЙрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рд▓реАрдХ рдХрд░рддрд╛ рд╣реИ (libc рд▓реАрдХ) рдФрд░ рдлрд┐рд░ рдПрдХ рдирдпрд╛ рд╣реАрдк рдЕрд╕рдВрдЪрд┐рдд рдмрд┐рди рдкрд░ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЙрд╕ рдкреЙрдЗрдВрдЯрд░ рд╕реЗ рдПрдХ рд╣реАрдк рдкрддрд╛ рд▓реАрдХ рдХрд░рддрд╛ рд╣реИред
* [**рдмреЗрдмреА-рдЯреЙрдХред DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok` рдореЗрдВ рдирд▓-рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдмрдЧред
* House of Einherjar рдХрд╛ рдЙрдкрдпреЛрдЧ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХреНрд╕ рд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ Tcache poisoning рдХреЗ рд╕рд╛рде рдПрдХ рдЕрд░реНрдмрд┐рдЯреНрд░реЗ рд░рд╛рдЗрдЯ рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

{% hint style="success" %}
**AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:** [**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (ARTE)**](https://training.hacktricks.xyz/courses/arte)\
**GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдХрд░реЗрдВ:** [**HackTricks рдкреНрд░рд╢рд┐рдХреНрд╖рдг GCP рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ (GRTE)**](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕**](https://github.com/carlospolop/hacktricks) **рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
{% endhint %}
