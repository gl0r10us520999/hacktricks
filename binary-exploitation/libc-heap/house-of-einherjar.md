# House of Einherjar

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

### ì½”ë“œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)ì˜ ì˜ˆì œ í™•ì¸í•˜ê¸°
* ë˜ëŠ” [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation)ì—ì„œ í™•ì¸í•˜ê¸° (tcacheë¥¼ ì±„ì›Œì•¼ í•  ìˆ˜ë„ ìˆìŒ)

### ëª©í‘œ

* ê±°ì˜ ëª¨ë“  íŠ¹ì • ì£¼ì†Œì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

### ìš”êµ¬ ì‚¬í•­

* ì²­í¬ë¥¼ í• ë‹¹í•  ë•Œ ê°€ì§œ ì²­í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:
* í¬ì¸í„°ë¥¼ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚¤ë„ë¡ ì„¤ì •í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤.
* í•œ ì²­í¬ì—ì„œ ë‹¤ìŒ ì²­í¬ë¡œ null ë°”ì´íŠ¸ë¥¼ ì‚¬ìš©í•œ 1ë°”ì´íŠ¸ ì˜¤ë²„í”Œë¡œìš°ë¡œ `PREV_INUSE` í”Œë˜ê·¸ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
* off-by-null ì•…ìš©ëœ ì²­í¬ì˜ `prev_size`ì— ìê¸° ìì‹ ê³¼ ê°€ì§œ ì²­í¬ ê°„ì˜ ì°¨ì´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
* ê°€ì§œ ì²­í¬ì˜ í¬ê¸°ë„ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•œ í¬ê¸°ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
* ì´ëŸ¬í•œ ì²­í¬ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” í™ ëˆ„ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### ê³µê²©

* ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ì²­í¬ ë‚´ë¶€ì— `A` ê°€ì§œ ì²­í¬ê°€ ìƒì„±ë˜ê³ , `fd`ì™€ `bk`ê°€ ì›ë˜ ì²­í¬ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ì„¤ì •í•˜ì—¬ ë³´í˜¸ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤.
* 2ê°œì˜ ë‹¤ë¥¸ ì²­í¬(`B`ì™€ `C`)ê°€ í• ë‹¹ë©ë‹ˆë‹¤.
* `B`ì—ì„œ off by oneì„ ì•…ìš©í•˜ì—¬ `prev in use` ë¹„íŠ¸ë¥¼ ì§€ìš°ê³  `prev_size` ë°ì´í„°ë¥¼ `C` ì²­í¬ê°€ í• ë‹¹ëœ ìœ„ì¹˜ì™€ ì´ì „ì— ìƒì„±ëœ ê°€ì§œ `A` ì²­í¬ ê°„ì˜ ì°¨ì´ë¡œ ë®ì–´ì”ë‹ˆë‹¤.
* ì´ `prev_size`ì™€ ê°€ì§œ ì²­í¬ `A`ì˜ í¬ê¸°ëŠ” ê²€ì‚¬ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤.
* ê·¸ëŸ° ë‹¤ìŒ, tcacheê°€ ì±„ì›Œì§‘ë‹ˆë‹¤.
* ê·¸ í›„, `C`ê°€ í•´ì œë˜ì–´ ê°€ì§œ ì²­í¬ `A`ì™€ í†µí•©ë©ë‹ˆë‹¤.
* ê·¸ëŸ° ë‹¤ìŒ, ê°€ì§œ `A` ì²­í¬ì—ì„œ ì‹œì‘í•˜ì—¬ `B` ì²­í¬ë¥¼ ë®ëŠ” ìƒˆë¡œìš´ ì²­í¬ `D`ê°€ ìƒì„±ë©ë‹ˆë‹¤.
* ì—¬ê¸°ì„œ House of Einherjarê°€ ëë‚©ë‹ˆë‹¤.
* ì´ëŠ” ë¹ ë¥¸ ë¹ˆ ê³µê²© ë˜ëŠ” Tcache ì˜¤ì—¼ìœ¼ë¡œ ê³„ì†ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* `B`ë¥¼ í•´ì œí•˜ì—¬ ë¹ ë¥¸ ë¹ˆ / Tcacheì— ì¶”ê°€í•©ë‹ˆë‹¤.
* `B`ì˜ `fd`ê°€ ë®ì–´ì”Œì›Œì ¸ ëª©í‘œ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ í•˜ì—¬ `D` ì²­í¬ë¥¼ ì•…ìš©í•©ë‹ˆë‹¤ (ì´ ì²­í¬ëŠ” `B`ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤).
* ê·¸ëŸ° ë‹¤ìŒ, 2ê°œì˜ mallocì´ ìˆ˜í–‰ë˜ê³  ë‘ ë²ˆì§¸ mallocì´ **ëª©í‘œ ì£¼ì†Œë¥¼ í• ë‹¹í•˜ê²Œ ë©ë‹ˆë‹¤.**

## ì°¸ê³  ìë£Œ ë° ê¸°íƒ€ ì˜ˆì œ

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* í¬ì¸í„°ë¥¼ í•´ì œí•œ í›„ nullifiedë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—¬ì „íˆ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì²­í¬ê°€ ì •ë ¬ë˜ì§€ ì•Šì€ ë¹ˆì— ë°°ì¹˜ë˜ê³  í¬í•¨ëœ í¬ì¸í„°ê°€ ëˆ„ì¶œë©ë‹ˆë‹¤ (libc leak) ê·¸ë¦¬ê³  ìƒˆë¡œìš´ í™ì´ ì •ë ¬ë˜ì§€ ì•Šì€ ë¹ˆì— ë°°ì¹˜ë˜ì–´ ì–»ì€ í¬ì¸í„°ì—ì„œ í™ ì£¼ì†Œê°€ ëˆ„ì¶œë©ë‹ˆë‹¤.
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok`ì—ì„œ null-byte ì˜¤ë²„í”Œë¡œìš° ë²„ê·¸.
* House of Einherjarë¥¼ ì‚¬ìš©í•˜ì—¬ ê²¹ì¹˜ëŠ” ì²­í¬ ìƒí™©ì„ ë§Œë“¤ê³  Tcache ì˜¤ì—¼ìœ¼ë¡œ ì„ì˜ ì“°ê¸° ì›ì‹œë¥¼ ì–»ìŠµë‹ˆë‹¤.

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
