# House of Einherjar

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

### Code

* Check the example from [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* Or the one from [https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation](https://guyinatuxedo.github.io/42-house\_of\_einherjar/house\_einherjar\_exp/index.html#house-of-einherjar-explanation) (рдЖрдкрдХреЛ tcache рднрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ)

### Goal

* рд▓рдХреНрд╖реНрдп рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрддреЗ рдкрд░ рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рд╣реИред

### Requirements

* рдЬрдм рд╣рдо рдПрдХ рдЪрдВрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдПрдХ рдирдХрд▓реА рдЪрдВрдХ рдмрдирд╛рдПрдВ:
* рд╕реИрдиреАрдЯреА рдЪреЗрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдЕрдкрдиреЗ рдЖрдк рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ
* рдПрдХ рдЪрдВрдХ рд╕реЗ рдЕрдЧрд▓реЗ рдЪрдВрдХ рддрдХ `PREV_INUSE` рдлреНрд▓реИрдЧ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд▓ рдмрд╛рдЗрдЯ рдХреЗ рд╕рд╛рде рдПрдХ-рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛред
* рдирд▓ рджреНрд╡рд╛рд░рд╛ рдСрдлрд╝рд╕реЗрдЯ рдЪрдВрдХ рдХреЗ `prev_size` рдореЗрдВ рдЕрдкрдиреЗ рдФрд░ рдирдХрд▓реА рдЪрдВрдХ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВ
* рдирдХрд▓реА рдЪрдВрдХ рдХрд╛ рдЖрдХрд╛рд░ рднреА рд╕реИрдиреАрдЯреА рдЪреЗрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рдЖрдХрд╛рд░ рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП
* рдЗрди рдЪрдВрдХреНрд╕ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рд╣реАрдк рд▓реАрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

### Attack

* `A` рдирдХрд▓реА рдЪрдВрдХ рдПрдХ рдЪрдВрдХ рдХреЗ рдЕрдВрджрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдореВрд▓ рдЪрдВрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `fd` рдФрд░ `bk` рдХреЗ рд╕рд╛рде рдкреЙрдЗрдВрдЯ рдХрд░рддрд╛ рд╣реИ
* 2 рдЕрдиреНрдп рдЪрдВрдХреНрд╕ (`B` рдФрд░ `C`) рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ
* `B` рдореЗрдВ рдПрдХ рджреНрд╡рд╛рд░рд╛ рдПрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП `prev in use` рдмрд┐рдЯ рдХреЛ рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `prev_size` рдбреЗрдЯрд╛ рдХреЛ `C` рдЪрдВрдХ рдХреЗ рдЖрд╡рдВрдЯрди рдХреЗ рд╕реНрдерд╛рди рд╕реЗ рдкрд╣рд▓реЗ рдмрдирд╛рдП рдЧрдП рдирдХрд▓реА `A` рдЪрдВрдХ рдХреЗ рдмреАрдЪ рдХреЗ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* рдпрд╣ `prev_size` рдФрд░ рдирдХрд▓реА рдЪрдВрдХ `A` рдореЗрдВ рдЖрдХрд╛рд░ рд╕рдорд╛рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЪреЗрдХ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдлрд┐рд░, tcache рднрд░рд╛ рдЬрд╛рддрд╛ рд╣реИ
* рдлрд┐рд░, `C` рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдирдХрд▓реА рдЪрдВрдХ `A` рдХреЗ рд╕рд╛рде рд╕рдореЗрдХрд┐рдд рд╣реЛ рдЬрд╛рдП
* рдлрд┐рд░, рдПрдХ рдирдпрд╛ рдЪрдВрдХ `D` рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдирдХрд▓реА `A` рдЪрдВрдХ рдореЗрдВ рд╢реБрд░реВ рд╣реЛрдЧрд╛ рдФрд░ `B` рдЪрдВрдХ рдХреЛ рдХрд╡рд░ рдХрд░реЗрдЧрд╛
* рд╣рд╛рдЙрд╕ рдСрдлрд╝ рдЖрдЗрдиреНрд╣реЗрд░рдЬрд╛рд░ рдпрд╣рд╛рдБ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ
* рдЗрд╕реЗ рдПрдХ рддреЗрдЬрд╝ рдмрд┐рди рд╣рдорд▓реЗ рдпрд╛ Tcache рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рдХреЗ рд╕рд╛рде рдЬрд╛рд░реА рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
* рддреЗрдЬрд╝ рдмрд┐рди / Tcache рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП `B` рдХреЛ рдореБрдХреНрдд рдХрд░реЗрдВ
* `B` рдХрд╛ `fd` рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдпрд╣ рд▓рдХреНрд╖рд┐рдд рдкрддреЗ рдХреА рдУрд░ рдкреЙрдЗрдВрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ `D` рдЪрдВрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ `B` рд╢рд╛рдорд┐рд▓ рд╣реИ)&#x20;
* рдлрд┐рд░, 2 mallocs рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рджреВрд╕рд░рд╛ **рд▓рдХреНрд╖рд┐рдд рдкрддреЗ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**

## References and other examples

* [https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c](https://github.com/shellphish/how2heap/blob/master/glibc\_2.35/house\_of\_einherjar.c)
* **CTF** [**https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/house\_of\_einherjar/#2016-seccon-tinypad)
* рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рдореБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ рдирд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдирдХреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рд▓рд┐рдП рдПрдХ рдЪрдВрдХ рдХреЛ рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХреЛ рд▓реАрдХ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (libc leak) рдФрд░ рдлрд┐рд░ рдПрдХ рдирдпрд╛ рд╣реАрдк рдЕрдирд╕реЙрд░реНрдЯреЗрдб рдмрд┐рди рдкрд░ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЧрдП рдкреЙрдЗрдВрдЯрд░ рд╕реЗ рдПрдХ рд╣реАрдк рдкрддрд╛ рд▓реАрдХ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* [**baby-talk. DiceCTF 2024**](https://7rocky.github.io/en/ctf/other/dicectf/baby-talk/)
* `strtok` рдореЗрдВ рдирд▓-рдмрд╛рдЗрдЯ рдУрд╡рд░рдлреНрд▓реЛ рдмрдЧред
* рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдЪрдВрдХреНрд╕ рдХреА рд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рд╛рдЙрд╕ рдСрдлрд╝ рдЖрдЗрдиреНрд╣реЗрд░рдЬрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ Tcache рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдПрдХ рдордирдорд╛рдирд╛ рд▓рд┐рдЦрдиреЗ рдХреА рдкреНрд░рд╛рдЗрдорд┐рдЯрд┐рд╡ рдкреНрд░рд╛рдкреНрдд рд╣реЛ рд╕рдХреЗред

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
