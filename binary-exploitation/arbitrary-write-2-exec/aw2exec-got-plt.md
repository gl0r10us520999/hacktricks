# WWW2Exec - GOT/PLT

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## **Grundinformationen**

### **GOT: Global Offset Table**

Die **Global Offset Table (GOT)** ist ein Mechanismus, der in dynamisch verlinkten Bin√§rdateien verwendet wird, um die **Adressen externer Funktionen** zu verwalten. Da diese **Adressen bis zur Laufzeit nicht bekannt sind** (aufgrund der dynamischen Verlinkung), bietet die GOT eine M√∂glichkeit, die **Adressen dieser externen Symbole dynamisch zu aktualisieren**, sobald sie aufgel√∂st sind.

Jeder Eintrag in der GOT entspricht einem Symbol in den externen Bibliotheken, die die Bin√§rdatei aufrufen kann. Wenn eine **Funktion zum ersten Mal aufgerufen wird, wird ihre tats√§chliche Adresse vom dynamischen Linker aufgel√∂st und in der GOT gespeichert**. Nachfolgende Aufrufe der gleichen Funktion verwenden die in der GOT gespeicherte Adresse, wodurch der Overhead des erneuten Aufl√∂sens der Adresse vermieden wird.

### **PLT: Procedure Linkage Table**

Die **Procedure Linkage Table (PLT)** arbeitet eng mit der GOT zusammen und dient als Trampolin, um Aufrufe an externe Funktionen zu handhaben. Wenn eine Bin√§rdatei **eine externe Funktion zum ersten Mal aufruft, wird die Kontrolle an einen Eintrag in der PLT √ºbergeben, der mit dieser Funktion verkn√ºpft ist**. Dieser PLT-Eintrag ist daf√ºr verantwortlich, den dynamischen Linker aufzurufen, um die Adresse der Funktion aufzul√∂sen, falls sie noch nicht aufgel√∂st wurde. Nachdem die Adresse aufgel√∂st wurde, wird sie in der **GOT** gespeichert.

**Daher** werden GOT-Eintr√§ge direkt verwendet, sobald die Adresse einer externen Funktion oder Variablen aufgel√∂st ist. **PLT-Eintr√§ge werden verwendet, um die anf√§ngliche Aufl√∂sung** dieser Adressen √ºber den dynamischen Linker zu erleichtern.

## Ausf√ºhrung erhalten

### √úberpr√ºfe die GOT

Erhalte die Adresse zur GOT-Tabelle mit: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Beobachte, wie du nach dem **Laden** der **ausf√ºhrbaren Datei** in GEF die **Funktionen** sehen kannst, die in der **GOT** sind: `gef‚û§ x/20x 0xADDR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

Mit GEF kannst du eine **Debugging**-Sitzung **starten** und **`got`** ausf√ºhren, um die GOT-Tabelle zu sehen:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

In einer Bin√§rdatei hat die GOT die **Adressen zu den Funktionen oder** zum **PLT**-Abschnitt, der die Funktionsadresse l√§dt. Das Ziel dieses willk√ºrlichen Schreibens ist es, einen **GOT-Eintrag** einer Funktion, die sp√§ter ausgef√ºhrt wird, **mit** der **Adresse** des PLT der **`system`** **Funktion** beispielsweise zu √ºberschreiben.

Idealerweise wirst du die **GOT** einer **Funktion** √ºberschreiben, die **mit von dir kontrollierten Parametern aufgerufen wird** (so kannst du die an die Systemfunktion gesendeten Parameter kontrollieren).

Wenn **`system`** **nicht verwendet wird** von der Bin√§rdatei, wird die Systemfunktion **keinen** Eintrag in der PLT haben. In diesem Szenario musst du **zuerst die Adresse** der `system`-Funktion **leaken** und dann die GOT √ºberschreiben, um auf diese Adresse zu zeigen.

Du kannst die PLT-Adressen mit **`objdump -j .plt -d ./vuln_binary`** sehen.

## libc GOT-Eintr√§ge

Die **GOT von libc** wird normalerweise mit **teilweisem RELRO** kompiliert, was sie zu einem attraktiven Ziel f√ºr diese Technik macht, vorausgesetzt, es ist m√∂glich, ihre Adresse herauszufinden ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

H√§ufige Funktionen der libc werden **andere interne Funktionen** aufrufen, deren GOT √ºberschrieben werden k√∂nnte, um eine Codeausf√ºhrung zu erhalten.

Finde [**weitere Informationen zu dieser Technik hier**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

### **Free2system**

In Heap-Exploitation-CTFs ist es √ºblich, den Inhalt von Chunks zu kontrollieren und zu einem bestimmten Zeitpunkt sogar die GOT-Tabelle zu √ºberschreiben. Ein einfacher Trick, um RCE zu erhalten, wenn keine Gadgets verf√ºgbar sind, besteht darin, die `free` GOT-Adresse auf `system` zu √ºberschreiben und in einen Chunk `"/bin/sh"` zu schreiben. Auf diese Weise wird, wenn dieser Chunk freigegeben wird, `system("/bin/sh")` ausgef√ºhrt.

### **Strlen2system**

Eine weitere g√§ngige Technik besteht darin, die **`strlen`** GOT-Adresse auf **`system`** zu √ºberschreiben, sodass, wenn diese Funktion mit Benutzereingaben aufgerufen wird, es m√∂glich ist, den String `"/bin/sh"` zu √ºbergeben und eine Shell zu erhalten.

Dar√ºber hinaus, wenn `puts` mit Benutzereingaben verwendet wird, ist es m√∂glich, die `strlen` GOT-Adresse auf `system` zu √ºberschreiben und den String `"/bin/sh"` zu √ºbergeben, um eine Shell zu erhalten, da **`puts` `strlen` mit der Benutzereingabe aufruft**.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Missbrauch der GOT aus dem Heap**

Eine g√§ngige Methode, um RCE aus einer Heap-Sicherheitsanf√§lligkeit zu erhalten, besteht darin, einen Fastbin zu missbrauchen, sodass es m√∂glich ist, den Teil der GOT-Tabelle in den Fastbin hinzuzuf√ºgen, sodass, wann immer dieser Chunk zugewiesen wird, es m√∂glich ist, **den Zeiger einer Funktion, normalerweise `free`**, zu √ºberschreiben.\
Dann wird `free` auf `system` gezeigt und das Freigeben eines Chunks, in dem `/bin/sh\x00` geschrieben wurde, wird eine Shell ausf√ºhren.

Es ist m√∂glich, ein [**Beispiel hier zu finden**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**

## **Schutzma√ünahmen**

Der **Full RELRO**-Schutz soll gegen diese Art von Technik sch√ºtzen, indem er alle Adressen der Funktionen beim Start der Bin√§rdatei aufl√∂st und die **GOT-Tabelle danach schreibgesch√ºtzt** macht:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## Referenzen

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
