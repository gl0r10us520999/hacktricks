# WWW2Exec - GOT/PLT

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

## **Informaci√≥n B√°sica**

### **GOT: Tabla de Desplazamiento Global**

La **Tabla de Desplazamiento Global (GOT)** es un mecanismo utilizado en binarios vinculados din√°micamente para gestionar las **direcciones de funciones externas**. Dado que estas **direcciones no se conocen hasta el tiempo de ejecuci√≥n** (debido al enlace din√°mico), la GOT proporciona una forma de **actualizar din√°micamente las direcciones de estos s√≠mbolos externos** una vez que se resuelven.

Cada entrada en la GOT corresponde a un s√≠mbolo en las bibliotecas externas que el binario puede llamar. Cuando una **funci√≥n se llama por primera vez, su direcci√≥n real es resuelta por el enlazador din√°mico y almacenada en la GOT**. Las llamadas posteriores a la misma funci√≥n utilizan la direcci√≥n almacenada en la GOT, evitando as√≠ el costo de resolver la direcci√≥n nuevamente.

### **PLT: Tabla de Enlace de Procedimientos**

La **Tabla de Enlace de Procedimientos (PLT)** trabaja en estrecha colaboraci√≥n con la GOT y sirve como un trampol√≠n para manejar llamadas a funciones externas. Cuando un binario **llama a una funci√≥n externa por primera vez, el control se pasa a una entrada en la PLT asociada con esa funci√≥n**. Esta entrada de la PLT es responsable de invocar al enlazador din√°mico para resolver la direcci√≥n de la funci√≥n si a√∫n no se ha resuelto. Despu√©s de que se resuelve la direcci√≥n, se almacena en la **GOT**.

**Por lo tanto,** las entradas de la GOT se utilizan directamente una vez que se resuelve la direcci√≥n de una funci√≥n o variable externa. **Las entradas de la PLT se utilizan para facilitar la resoluci√≥n inicial** de estas direcciones a trav√©s del enlazador din√°mico.

## Obtener Ejecuci√≥n

### Verificar la GOT

Obt√©n la direcci√≥n de la tabla GOT con: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Observa c√≥mo despu√©s de **cargar** el **ejecutable** en GEF puedes **ver** las **funciones** que est√°n en la **GOT**: `gef‚û§ x/20x 0xADDR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

Usando GEF puedes **iniciar** una sesi√≥n de **depuraci√≥n** y ejecutar **`got`** para ver la tabla got:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

En un binario, la GOT tiene las **direcciones a las funciones o** a la **secci√≥n PLT** que cargar√° la direcci√≥n de la funci√≥n. El objetivo de esta escritura arbitraria es **sobrescribir una entrada de la GOT** de una funci√≥n que se va a ejecutar m√°s tarde **con** la **direcci√≥n** de la PLT de la **funci√≥n** **`system`** por ejemplo.

Idealmente, deber√≠as **sobrescribir** la **GOT** de una **funci√≥n** que va a ser **llamada con par√°metros controlados por ti** (as√≠ podr√°s controlar los par√°metros enviados a la funci√≥n system).

Si **`system`** **no es utilizado** por el binario, la funci√≥n system **no tendr√°** una entrada en la PLT. En este escenario, necesitar√°s **filtrar primero la direcci√≥n** de la funci√≥n `system` y luego sobrescribir la GOT para apuntar a esta direcci√≥n.

Puedes ver las direcciones de la PLT con **`objdump -j .plt -d ./vuln_binary`**

## Entradas de la GOT de libc

La **GOT de libc** generalmente se compila con **RELRO parcial**, lo que la convierte en un buen objetivo para esto suponiendo que sea posible averiguar su direcci√≥n ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

Las funciones comunes de la libc van a llamar a **otras funciones internas** cuyas GOT podr√≠an ser sobrescritas para obtener ejecuci√≥n de c√≥digo.

Encuentra [**m√°s informaci√≥n sobre esta t√©cnica aqu√≠**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

### **Free2system**

En las explotaciones de heap en CTFs es com√∫n poder controlar el contenido de los chunks y en alg√∫n momento incluso sobrescribir la tabla GOT. Un truco simple para obtener RCE si no hay gadgets disponibles es sobrescribir la direcci√≥n GOT de `free` para apuntar a `system` y escribir dentro de un chunk `"/bin/sh"`. De esta manera, cuando este chunk se libera, ejecutar√° `system("/bin/sh")`.

### **Strlen2system**

Otra t√©cnica com√∫n es sobrescribir la direcci√≥n GOT de **`strlen`** para apuntar a **`system`**, as√≠ si esta funci√≥n es llamada con entrada del usuario es posible pasar la cadena `"/bin/sh"` y obtener un shell.

Adem√°s, si `puts` se utiliza con entrada del usuario, es posible sobrescribir la direcci√≥n GOT de `strlen` para apuntar a `system` y pasar la cadena `"/bin/sh"` para obtener un shell porque **`puts` llamar√° a `strlen` con la entrada del usuario**.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Abusando de la GOT desde el Heap**

Una forma com√∫n de obtener RCE a partir de una vulnerabilidad en el heap es abusar de un fastbin para que sea posible agregar la parte de la tabla GOT en el fast bin, de modo que cada vez que ese chunk se asigne ser√° posible **sobrescribir el puntero de una funci√≥n, generalmente `free`**.\
Luego, apuntando `free` a `system` y liberando un chunk donde se escribi√≥ `/bin/sh\x00` se ejecutar√° un shell.

Es posible encontrar un [**ejemplo aqu√≠**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**

## **Protecciones**

La protecci√≥n **Full RELRO** est√° destinada a proteger contra este tipo de t√©cnica resolviendo todas las direcciones de las funciones cuando se inicia el binario y haciendo que la **tabla GOT sea de solo lectura** despu√©s de eso:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## Referencias

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
