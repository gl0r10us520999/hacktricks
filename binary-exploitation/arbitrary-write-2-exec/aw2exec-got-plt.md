# WWW2Exec - GOT/PLT

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* ¬°Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## **Informaci√≥n B√°sica**

### **GOT: Global Offset Table**

La **Tabla de Desplazamiento Global (GOT)** es un mecanismo utilizado en binarios enlazados din√°micamente para gestionar las **direcciones de funciones externas**. Dado que estas **direcciones no se conocen hasta tiempo de ejecuci√≥n** (debido al enlace din√°mico), la GOT proporciona una forma de **actualizar din√°micamente las direcciones de estos s√≠mbolos externos** una vez que se resuelven.

Cada entrada en la GOT corresponde a un s√≠mbolo en las bibliotecas externas que el binario puede llamar. Cuando se llama a una **funci√≥n por primera vez, su direcci√≥n real es resuelta por el enlazador din√°mico y almacenada en la GOT**. Llamadas posteriores a la misma funci√≥n utilizan la direcci√≥n almacenada en la GOT, evitando as√≠ el costo de resolver la direcci√≥n nuevamente.

### **PLT: Procedure Linkage Table**

La **Tabla de Enlace de Procedimientos (PLT)** trabaja estrechamente con la GOT y sirve como un trampol√≠n para manejar llamadas a funciones externas. Cuando un binario **llama a una funci√≥n externa por primera vez, el control se pasa a una entrada en la PLT asociada con esa funci√≥n**. Esta entrada de la PLT es responsable de invocar al enlazador din√°mico para resolver la direcci√≥n de la funci√≥n si a√∫n no ha sido resuelta. Despu√©s de que la direcci√≥n es resuelta, se almacena en la **GOT**.

**Por lo tanto,** las entradas de la GOT se utilizan directamente una vez que se resuelve la direcci√≥n de una funci√≥n o variable externa. Las **entradas de la PLT se utilizan para facilitar la resoluci√≥n inicial** de estas direcciones a trav√©s del enlazador din√°mico.

## Obtener Ejecuci√≥n

### Verificar la GOT

Obt√©n la direcci√≥n de la tabla GOT con: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Observa c√≥mo despu√©s de **cargar** el **ejecutable** en GEF puedes **ver** las **funciones** que est√°n en la **GOT**: `gef‚û§ x/20x 0xADDR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

Usando GEF puedes **iniciar** una **sesi√≥n de depuraci√≥n** y ejecutar **`got`** para ver la tabla got:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

En un binario, la GOT tiene las **direcciones de las funciones o** de la secci√≥n **PLT** que cargar√° la direcci√≥n de la funci√≥n. El objetivo de esta escritura arbitraria es **sobrescribir una entrada de la GOT** de una funci√≥n que se ejecutar√° m√°s tarde **con** la **direcci√≥n** de la PLT de la funci√≥n **`system`** por ejemplo.

Idealmente, **sobrescribir√°s** la **GOT** de una **funci√≥n** que **ser√° llamada con par√°metros controlados por ti** (as√≠ podr√°s controlar los par√°metros enviados a la funci√≥n del sistema).

Si **`system`** **no es utilizado** por el binario, la funci√≥n del sistema **no** tendr√° una entrada en la PLT. En este escenario, deber√°s **filtrar primero la direcci√≥n** de la funci√≥n `system` y luego sobrescribir la GOT para apuntar a esta direcci√≥n.

Puedes ver las direcciones de la PLT con **`objdump -j .plt -d ./vuln_binary`**

## Entradas GOT de libc

La **GOT de libc** generalmente se compila con **RELRO parcial**, convirti√©ndola en un buen objetivo suponiendo que sea posible averiguar su direcci√≥n ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

Las funciones comunes de libc van a llamar a **otras funciones internas** cuya GOT podr√≠a ser sobrescrita para obtener ejecuci√≥n de c√≥digo.

Encuentra [**m√°s informaci√≥n sobre esta t√©cnica aqu√≠**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

### **Free2system**

En CTFs de explotaci√≥n de mont√≥n, es com√∫n poder controlar el contenido de los fragmentos y en alg√∫n momento incluso sobrescribir la tabla GOT. Un truco simple para obtener RCE si no se dispone de gadgets es sobrescribir la direcci√≥n GOT de `free` para apuntar a `system` y escribir dentro de un fragmento `"/bin/sh"`. De esta manera, cuando se libere este fragmento, ejecutar√° `system("/bin/sh")`.

### **Strlen2system**

Otra t√©cnica com√∫n es sobrescribir la direcci√≥n **`strlen`** GOT para apuntar a **`system`**, por lo que si esta funci√≥n es llamada con entrada de usuario es posible pasar la cadena `"/bin/sh"` y obtener una shell.

Adem√°s, si `puts` se utiliza con entrada de usuario, es posible sobrescribir la direcci√≥n GOT de `strlen` para apuntar a `system` y pasar la cadena `"/bin/sh"` para obtener una shell porque **`puts` llamar√° a `strlen` con la entrada de usuario**.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Abusando de la GOT desde el Mont√≥n**

Una forma com√∫n de obtener RCE desde una vulnerabilidad de mont√≥n es abusar de un fastbin para poder agregar la parte de la tabla GOT en el fast bin, por lo que cada vez que se asigne ese fragmento ser√° posible **sobrescribir el puntero de una funci√≥n, generalmente `free`**.\
Luego, apuntando `free` a `system` y liberando un fragmento donde se haya escrito `/bin/sh\x00` ejecutar√° una shell.

Es posible encontrar un [**ejemplo aqu√≠**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**
## **Protections**

La protecci√≥n **Full RELRO** est√° dise√±ada para protegerse contra este tipo de t√©cnica al resolver todas las direcciones de las funciones cuando se inicia el binario y hacer que la **tabla GOT sea de solo lectura** despu√©s de eso:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## References

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* ¬°Consulta los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
