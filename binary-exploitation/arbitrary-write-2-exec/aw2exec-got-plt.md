# WWW2Exec - GOT/PLT

{% hint style="success" %}
Aprenda e pratique Hacking AWS: <img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## **Informa√ß√µes B√°sicas**

### **GOT: Tabela de Deslocamento Global**

A **Tabela de Deslocamento Global (GOT)** √© um mecanismo usado em bin√°rios com linkagem din√¢mica para gerenciar os **endere√ßos de fun√ß√µes externas**. Como esses **endere√ßos n√£o s√£o conhecidos at√© o tempo de execu√ß√£o** (devido √† linkagem din√¢mica), a GOT fornece uma maneira de **atualizar dinamicamente os endere√ßos desses s√≠mbolos externos** uma vez que s√£o resolvidos.

Cada entrada na GOT corresponde a um s√≠mbolo nas bibliotecas externas que o bin√°rio pode chamar. Quando uma **fun√ß√£o √© chamada pela primeira vez, seu endere√ßo real √© resolvido pelo linkador din√¢mico e armazenado na GOT**. Chamadas subsequentes para a mesma fun√ß√£o usam o endere√ßo armazenado na GOT, evitando assim o custo de resolver o endere√ßo novamente.

### **PLT: Tabela de Liga√ß√£o de Procedimentos**

A **Tabela de Liga√ß√£o de Procedimentos (PLT)** trabalha em conjunto com a GOT e serve como um trampolim para lidar com chamadas a fun√ß√µes externas. Quando um bin√°rio **chama uma fun√ß√£o externa pela primeira vez, o controle √© passado para uma entrada na PLT associada a essa fun√ß√£o**. Essa entrada da PLT √© respons√°vel por invocar o linkador din√¢mico para resolver o endere√ßo da fun√ß√£o, se ainda n√£o tiver sido resolvido. Ap√≥s a resolu√ß√£o do endere√ßo, ele √© armazenado na **GOT**.

**Portanto,** as entradas da GOT s√£o usadas diretamente uma vez que o endere√ßo de uma fun√ß√£o ou vari√°vel externa √© resolvido. **As entradas da PLT s√£o usadas para facilitar a resolu√ß√£o inicial** desses endere√ßos via linkagem din√¢mica.

## Obter Execu√ß√£o

### Verificar a GOT

Obtenha o endere√ßo da tabela GOT com: **`objdump -s -j .got ./exec`**

![](<../../.gitbook/assets/image (121).png>)

Observe como ap√≥s **carregar** o **execut√°vel** no GEF voc√™ pode **ver** as **fun√ß√µes** que est√£o na **GOT**: `gef‚û§ x/20x 0xADDR_GOT`

![](<../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (2) (2) (2).png>)

Usando o GEF voc√™ pode **iniciar** uma **sess√£o de depura√ß√£o** e executar **`got`** para ver a tabela got:

![](<../../.gitbook/assets/image (496).png>)

### GOT2Exec

Em um bin√°rio, a GOT tem os **endere√ßos das fun√ß√µes ou** da se√ß√£o **PLT** que carregar√° o endere√ßo da fun√ß√£o. O objetivo desta escrita arbitr√°ria √© **substituir uma entrada da GOT** de uma fun√ß√£o que ser√° executada posteriormente **com** o **endere√ßo** do PLT da fun√ß√£o **`system`** por exemplo.

Idealmente, voc√™ ir√° **substituir** a **GOT** de uma **fun√ß√£o** que est√° **sendo chamada com par√¢metros controlados por voc√™** (assim voc√™ poder√° controlar os par√¢metros enviados para a fun√ß√£o system).

Se o **`system`** **n√£o for usado** pelo bin√°rio, a fun√ß√£o system **n√£o** ter√° uma entrada na PLT. Nesse cen√°rio, voc√™ precisar√° **vazar primeiro o endere√ßo** da fun√ß√£o `system` e ent√£o sobrescrever a GOT para apontar para este endere√ßo.

Voc√™ pode ver os endere√ßos da PLT com **`objdump -j .plt -d ./vuln_binary`**

## Entradas da GOT da libc

A **GOT da libc** geralmente √© compilada com **RELRO parcial**, tornando-a um bom alvo para isso, supondo que seja poss√≠vel descobrir seu endere√ßo ([**ASLR**](../common-binary-protections-and-bypasses/aslr/)).

Fun√ß√µes comuns da libc v√£o chamar **outras fun√ß√µes internas** cuja GOT pode ser sobrescrita para obter execu√ß√£o de c√≥digo.

Encontre [**mais informa√ß√µes sobre essa t√©cnica aqui**](https://github.com/nobodyisnobody/docs/blob/main/code.execution.on.last.libc/README.md#1---targetting-libc-got-entries).

### **Free2system**

Em CTFs de explora√ß√£o de heap, √© comum poder controlar o conte√∫do de chunks e, em algum momento, at√© mesmo sobrescrever a tabela GOT. Um truque simples para obter RCE se um gadget n√£o estiver dispon√≠vel √© sobrescrever o endere√ßo GOT do `free` para apontar para `system` e escrever dentro de um chunk `"/bin/sh"`. Dessa forma, quando esse chunk for liberado, ele executar√° `system("/bin/sh")`.

### **Strlen2system**

Outra t√©cnica comum √© sobrescrever o endere√ßo **`strlen`** da GOT para apontar para **`system`**, ent√£o se esta fun√ß√£o for chamada com entrada do usu√°rio √© poss√≠vel passar a string `"/bin/sh"` e obter um shell.

Al√©m disso, se `puts` for usado com entrada do usu√°rio, √© poss√≠vel sobrescrever o endere√ßo da `strlen` GOT para apontar para `system` e passar a string `"/bin/sh"` para obter um shell, pois **`puts` chamar√° `strlen` com a entrada do usu√°rio**.

## **One Gadget**

{% content-ref url="../rop-return-oriented-programing/ret2lib/one-gadget.md" %}
[one-gadget.md](../rop-return-oriented-programing/ret2lib/one-gadget.md)
{% endcontent-ref %}

## **Abusando da GOT do Heap**

Uma maneira comum de obter RCE a partir de uma vulnerabilidade de heap √© abusar de um fastbin para ser poss√≠vel adicionar parte da tabela GOT ao fast bin, ent√£o sempre que esse chunk for alocado ser√° poss√≠vel **sobrescrever o ponteiro de uma fun√ß√£o, geralmente `free`**.\
Em seguida, apontar `free` para `system` e liberar um chunk onde foi escrito `/bin/sh\x00` executar√° um shell.

√â poss√≠vel encontrar um [**exemplo aqui**](https://ctf-wiki.mahaloz.re/pwn/linux/glibc-heap/chunk\_extend\_overlapping/#hitcon-trainging-lab13)**.**
## **Prote√ß√µes**

A prote√ß√£o **Full RELRO** √© destinada a proteger contra esse tipo de t√©cnica, resolvendo todos os endere√ßos das fun√ß√µes quando o bin√°rio √© iniciado e tornando a **tabela GOT somente leitura** depois disso:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{% hint style="success" %}
Aprenda e pratique Hacking na AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking no GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Verifique os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
