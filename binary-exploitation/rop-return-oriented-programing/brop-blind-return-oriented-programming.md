# BROP - Blind Return Oriented Programming

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рд╣реИ **рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ ROP рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛**ред\
рдпрд╣ рд╣рдорд▓рд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рджреГрд╢реНрдп рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ:

* рдПрдХ рд╕реНрдЯреИрдХ рднреЗрджреНрдпрддрд╛ рдФрд░ рдЗрд╕реЗ рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХрд╛ рдЬреНрдЮрд╛рдиред
* рдПрдХ рд╕рд░реНрд╡рд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛ рдХреНрд░реИрд╢ рдХреЗ рдмрд╛рдж рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн рд╣реЛрддрд╛ рд╣реИред

## Attack

### **1. рдХрдордЬреЛрд░ рдСрдлрд╕реЗрдЯ рдЦреЛрдЬреЗрдВ** рдПрдХ рдФрд░ рдЪрд░ рднреЗрдЬрдХрд░ рдЬрдм рддрдХ рд╕рд░реНрд╡рд░ рдореЗрдВ рдЦрд░рд╛рдмреА рдХрд╛ рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рддрд╛

### **2. рдХреИрдирд░реА рдХрд╛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕** рдХрд░рдирд╛

### **3. рд╕реНрдЯреИрдХ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд RBP рдФрд░ RIP** рдкрддреЗ рдХрд╛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдирд╛

рдЖрдк рдЗрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдБ (BF Forked & Threaded Stack Canaries)](../common-binary-protections-and-bypasses/stack-canaries/bf-forked-stack-canaries.md) рдФрд░ [рдпрд╣рд╛рдБ (BF Addresses in the Stack)](../common-binary-protections-and-bypasses/pie/bypassing-canary-and-pie.md) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### **4. рд╕реНрдЯреЙрдк рдЧреИрдЬреЗрдЯ рдЦреЛрдЬреЗрдВ**

рдпрд╣ рдЧреИрдЬреЗрдЯ рдореВрд▓ рд░реВрдк рд╕реЗ рдпрд╣ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ ROP рдЧреИрдЬреЗрдЯ рджреНрд╡рд╛рд░рд╛ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХреНрдпреЛрдВрдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реБрдЖред рдЖрдорддреМрд░ рдкрд░, рдпрд╣ рдЧреИрдЬреЗрдЯ рдХреБрдЫ рдРрд╕рд╛ рд╣реЛрдЧрд╛ рдЬреЛ **рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ** рдФрд░ рдпрд╣ ROP рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рдЕрдВрдд рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ ROP рдЧреИрдЬреЗрдЯ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЧреИрдЬреЗрдЯреНрд╕ рдХреА рдЦреЛрдЬ рдХреА рдЬрд╛рддреА рд╣реИред

### **5. BROP рдЧреИрдЬреЗрдЯ рдЦреЛрдЬреЗрдВ**

рдпрд╣ рддрдХрдиреАрдХ [**ret2csu**](ret2csu.md) рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИред рдФрд░ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдк рдХреБрдЫ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рдЗрд╕ рдЧреИрдЬреЗрдЯ рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ **`rsi`** рдФрд░ **`rdi`** рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреИрдЬреЗрдЯ рдорд┐рд▓рддреЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" width="278"><figcaption><p><a href="https://www.scs.stanford.edu/brop/bittau-brop.pdf">https://www.scs.stanford.edu/brop/bittau-brop.pdf</a></p></figcaption></figure>

рдпреЗ рдЧреИрдЬреЗрдЯ рд╣реЛрдВрдЧреЗ:

* `pop rsi; pop r15; ret`
* `pop rdi; ret`

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрди рдЧреИрдЬреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **2 рддрд░реНрдХреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ ret2csu рдЧреИрдЬреЗрдЯ рдХрд╛ **рдмрд╣реБрдд рдЕрджреНрд╡рд┐рддреАрдп рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕реНрдЯреИрдХ рд╕реЗ 6 рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЛ рдкреЙрдк рдХрд░реЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рднреЗрдЬрдирд╛ рдЬреИрд╕реЗ:

`'A' * offset + canary + rbp + ADDR + 0xdead * 6 + STOP`

рдпрджрд┐ **STOP рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ **рдПрдХ рдкрддрд╛ рдЬреЛ рд╕реНрдЯреИрдХ рд╕реЗ 6 рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЛ рдкреЙрдк рдХрд░ рд░рд╣рд╛ рд╣реИ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдпрд╛ рдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрддрд╛ рднреА рдПрдХ STOP рдкрддрд╛ рдерд╛ред

рдЗрд╕ рдЕрдВрддрд┐рдо рд╡рд┐рдХрд▓реНрдк рдХреЛ **рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП** рдПрдХ рдирдИ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЛ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП STOP рдЧреИрдЬреЗрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

`'A' * offset + canary + rbp + ADDR`

ret2csu рдЧреИрдЬреЗрдЯ рдХрд╛ рдкрддрд╛ рдЬрд╛рдирдиреЗ рдкрд░, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **`rsi` рдФрд░ `rdi` рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреИрдЬреЗрдЯреНрд╕ рдХреЗ рдкрддреЗ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдпрд╛ рдЬрд╛рдП**ред

### 6. PLT рдЦреЛрдЬреЗрдВ

PLT рддрд╛рд▓рд┐рдХрд╛ рдХреЛ 0x400000 рд╕реЗ рдпрд╛ рд╕реНрдЯреИрдХ рд╕реЗ **рд▓реАрдХ рдХрд┐рдП рдЧрдП RIP рдкрддреЗ** рд╕реЗ рдЦреЛрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрджрд┐ **PIE** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ)ред рддрд╛рд▓рд┐рдХрд╛ рдХреЗ **рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ** **16B** (0x10B) рджреНрд╡рд╛рд░рд╛ **рдЕрд▓рдЧ** рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╕рд░реНрд╡рд░ рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рднрд▓реЗ рд╣реА рддрд░реНрдХ рд╕рд╣реА рди рд╣реЛрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, PLT рдореЗрдВ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рдкрддреЗ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ **+ 6B рднреА рдХреНрд░реИрд╢ рдирд╣реАрдВ рд╣реЛрддрд╛** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд╣рд▓рд╛ рдХреЛрдб рд╣реИ рдЬреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░реЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдХреЗ PLT рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдЦреЛрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИ:

* `'A' * offset + canary + rbp + ADDR + STOP` -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ
* `'A' * offset + canary + rbp + (ADDR + 0x6) + STOP` -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ
* `'A' * offset + canary + rbp + (ADDR + 0x10) + STOP` -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ

### 7. strcmp рдЦреЛрдЬреЗрдВ

**`strcmp`** рдлрд╝рдВрдХреНрд╢рди рд░рдЬрд┐рд╕реНрдЯрд░ **`rdx`** рдХреЛ рддреБрд▓рдирд╛ рдХреА рдЬрд╛ рд░рд╣реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреА рд▓рдВрдмрд╛рдИ рдкрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`rdx`** **рддреАрд╕рд░рд╛ рддрд░реНрдХ** рд╣реИ рдФрд░ рд╣рдореЗрдВ рдЗрд╕реЗ **0 рд╕реЗ рдмрдбрд╝рд╛** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдмрд╛рдж рдореЗрдВ `write` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рд▓реАрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рд╣рдо **`strcmp`** рдХреЗ PLT рдореЗрдВ рд╕реНрдерд╛рди рдХрд╛ рдкрддрд╛ рдЙрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рддрдереНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рд╣рдо рдЕрдм рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЗ рдкрд╣рд▓реЗ 2 рддрд░реНрдХреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* strcmp(\<non read addr>, \<non read addr>) -> рдХреНрд░реИрд╢
* strcmp(\<non read addr>, \<read addr>) -> рдХреНрд░реИрд╢
* strcmp(\<read addr>, \<non read addr>) -> рдХреНрд░реИрд╢
* strcmp(\<read addr>, \<read addr>) -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ

рдЗрд╕рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП PLT рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдпрд╛ **PLT рдзреАрдореА рдкрде** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдореВрд▓ рд░реВрдк рд╕реЗ **PLT рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ + 0xb** (рдЬреЛ **`dlresolve`** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ) рдФрд░ рд╕реНрдЯреИрдХ рдореЗрдВ **рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╕рдВрдЦреНрдпрд╛ рдЬрд┐рд╕реЗ рдЖрдк рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** (рд╢реВрдиреНрдп рд╕реЗ рд╢реБрд░реВ) рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* strcmp(\<non read addr>, \<read addr>) -> рдХреНрд░реИрд╢
* `b'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + p64(0x300) + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP` -> рдХреНрд░реИрд╢ рд╣реЛрдЧрд╛
* strcmp(\<read addr>, \<non read addr>) -> рдХреНрд░реИрд╢
* `b'A' * offset + canary + rbp + (BROP + 0x9) + p64(0x300) + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP`
* strcmp(\<read addr>, \<read addr>) -> рдХреЛрдИ рдХреНрд░реИрд╢ рдирд╣реАрдВ
* `b'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb ) + p64(ENTRY) + STOP`

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐:

* BROP + 0x7 **`pop RSI; pop R15; ret;`** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ
* BROP + 0x9 **`pop RDI; ret;`** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ
* PLT + 0xb **dl\_resolve** рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред

`strcmp` рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рдмрд╛рдж, **`rdx`** рдХреЛ 0 рд╕реЗ рдмрдбрд╝рд╛ рдорд╛рди рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

{% hint style="success" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдорддреМрд░ рдкрд░ `rdx` рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 0 рд╕реЗ рдмрдбрд╝рд╛ рдорд╛рди рд░рдЦреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХрджрдо рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ред
{% endhint %}

### 8. Write рдпрд╛ рд╕рдордХрдХреНрд╖ рдЦреЛрдЬреЗрдВ

рдЕрдВрдд рдореЗрдВ, рдбреЗрдЯрд╛ рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧреИрдЬреЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдмрд╛рдЗрдирд░реА рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдФрд░ рдЗрд╕ рд╕рдордп рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **2 рддрд░реНрдХреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВ рдФрд░ `rdx` рдХреЛ 0 рд╕реЗ рдмрдбрд╝рд╛ рд╕реЗрдЯ рдХрд░реЗрдВред**

рдЗрд╕рдХреЗ рд▓рд┐рдП 3 рд╕рд╛рдорд╛рдиреНрдп рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ рдЬрд┐рдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* `puts(data)`
* `dprintf(fd, data)`
* `write(fd, data, len(data)`

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореВрд▓ рдкреЗрдкрд░ рдХреЗрд╡рд▓ **`write`** рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдЗрдП рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВ:

рд╡рд░реНрддрдорд╛рди рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдирд╣реАрдВ рдкрддрд╛ **write рдлрд╝рдВрдХреНрд╢рди PLT рдХреЗ рдЕрдВрджрд░ рдХрд╣рд╛рдБ рд╣реИ** рдФрд░ рд╣рдореЗрдВ рдирд╣реАрдВ рдкрддрд╛ **рдбреЗрдЯрд╛ рдХреЛ рд╣рдорд╛рд░реЗ рд╕реЙрдХреЗрдЯ рдкрд░ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП fd рд╕рдВрдЦреНрдпрд╛**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ **PLT рддрд╛рд▓рд┐рдХрд╛ рдХрд╣рд╛рдБ рд╣реИ** рдФрд░ рдЗрд╕рдХреЗ **рд╡реНрдпрд╡рд╣рд╛рд░** рдХреЗ рдЖрдзрд╛рд░ рдкрд░ write рдХреЛ рдЦреЛрдЬрдирд╛ рд╕рдВрднрд╡ рд╣реИред рдФрд░ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде **рдХрдИ рдХрдиреЗрдХреНрд╢рди** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ **рдЙрдЪреНрдЪ FD** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╣ рдЙрдореНрдореАрдж рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ рд╣рдорд╛рд░реЗ рдХреБрдЫ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред

рдЙрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрдпрд╡рд╣рд╛рд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░:

* `'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + p64(0) + p64(0) + (PLT + 0xb) + p64(ENTRY) + STOP` -> рдпрджрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ puts рдорд┐рд▓рд╛
* `'A' * offset + canary + rbp + (BROP + 0x9) + FD + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb) + p64(ENTRY) + STOP` -> рдпрджрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ dprintf рдорд┐рд▓рд╛
* `'A' * offset + canary + rbp + (BROP + 0x9) + RIP + (BROP + 0x7) + (RIP + 0x1) + p64(0x0) + (PLT + 0xb ) + p64(STRCMP ENTRY) + (BROP + 0x9) + FD + (BROP + 0x7) + RIP + p64(0x0) + (PLT + 0xb) + p64(ENTRY) + STOP` -> рдпрджрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ write рдорд┐рд▓рд╛

## Automatic Exploitation

* [https://github.com/Hakumarachi/Bropper](https://github.com/Hakumarachi/Bropper)

## References

* Original paper: [https://www.scs.stanford.edu/brop/bittau-brop.pdf](https://www.scs.stanford.edu/brop/bittau-brop.pdf)
* [https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/blind-return-oriented-programming-brop](https://www.ctfrecipes.com/pwn/stack-exploitation/arbitrary-code-execution/code-reuse-attack/blind-return-oriented-programming-brop)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
