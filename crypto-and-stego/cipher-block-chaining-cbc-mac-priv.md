{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


# CBC

рдпрджрд┐ **рдХреБрдХреА** **рдХреЗрд╡рд▓** **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рд╣реИ (рдпрд╛ рдХреБрдХреА рдХрд╛ рдкрд╣рд▓рд╛ рднрд╛рдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╣реИ) рдФрд░ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо "**admin**" рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдлрд┐рд░, рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо **"bdmin"** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдХреА рдХреЗ **рдкрд╣рд▓реЗ рдмрд╛рдЗрдЯ** рдХреЛ **рдмреНрд░реВрдЯрдлреЛрд░реНрд╕** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

# CBC-MAC

**рд╕рд╛рдЗрдлрд░ рдмреНрд▓реЙрдХ рдЪреЗрдирд┐рдВрдЧ рд╕рдВрджреЗрд╢ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛрдб** (**CBC-MAC**) рдПрдХ рд╡рд┐рдзрд┐ рд╣реИ рдЬреЛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред рдпрд╣ рдПрдХ рд╕рдВрджреЗрд╢ рдХреЛ рд▓реЗрддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдмреНрд▓реЙрдХ рджрд░ рдмреНрд▓реЙрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреА рд╣реИ, рдЬрд╣рд╛рдВ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЙрдХ рдХрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкрд┐рдЫрд▓реЗ рдмреНрд▓реЙрдХ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдПрдХ **рдмреНрд▓реЙрдХреЛрдВ рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛** рдмрдирд╛рддреА рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдореВрд▓ рд╕рдВрджреЗрд╢ рдХреЗ рдПрдХ рднреА рдмрд┐рдЯ рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдбреЗрдЯрд╛ рдХреЗ рдЕрдВрддрд┐рдо рдмреНрд▓реЙрдХ рдореЗрдВ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛрдЧрд╛ред рдРрд╕рд╛ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдпрд╛ рдЙрд▓рдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИред

рд╕рдВрджреЗрд╢ m рдХрд╛ CBC-MAC рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, m рдХреЛ рд╢реВрдиреНрдп рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╡реЗрдХреНрдЯрд░ рдХреЗ рд╕рд╛рде CBC рдореЛрдб рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЕрдВрддрд┐рдо рдмреНрд▓реЙрдХ рдХреЛ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд┐рддреНрд░ рдПрдХ рдЧреБрдкреНрдд рдХреБрдВрдЬреА k рдФрд░ рдПрдХ рдмреНрд▓реЙрдХ рд╕рд╛рдЗрдлрд░ E рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмреНрд▓реЙрдХреЛрдВ рд╕реЗ рдмрдиреЗ рд╕рдВрджреЗрд╢ рдХрд╛ CBC-MAC рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ![https://wikimedia.org/api/rest\_v1/media/math/render/svg/bbafe7330a5e40a04f01cc776c9d94fe914b17f5](https://wikimedia.org/api/rest\_v1/media/math/render/svg/bbafe7330a5e40a04f01cc776c9d94fe914b17f5) 

![https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/CBC-MAC\_structure\_\(en\).svg/570px-CBC-MAC\_structure\_\(en\).svg.png](https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/CBC-MAC\_structure\_\(en\).svg/570px-CBC-MAC\_structure\_\(en\).svg.png)

# Vulnerability

CBC-MAC рдХреЗ рд╕рд╛рде рдЖрдорддреМрд░ рдкрд░ **IV 0** рд╣реЛрддрд╛ рд╣реИред\
рдпрд╣ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ 2 рдЬреНрдЮрд╛рдд рд╕рдВрджреЗрд╢ (`m1` рдФрд░ `m2`) рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ 2 рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (`s1` рдФрд░ `s2`) рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗред рддреЛ:

* `E(m1 XOR 0) = s1`
* `E(m2 XOR 0) = s2`

рдлрд┐рд░ m1 рдФрд░ m2 рдХреЗ рд╕рдВрдпреЛрдЬрди рд╕реЗ рдмрдирд╛ рдПрдХ рд╕рдВрджреЗрд╢ (m3) 2 рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (s31 рдФрд░ s32) рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛:

* `E(m1 XOR 0) = s31 = s1`
* `E(m2 XOR s1) = s32`

**рдЬрд┐рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреА рдХреБрдВрдЬреА рдХреЛ рдЬрд╛рдиреЗ рдмрд┐рдирд╛ рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред**

рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдирд╛рдо **Administrator** рдХреЛ **8bytes** рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ:

* `Administ`
* `rator\00\00\00`

рдЖрдк рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо **Administ** (m1) рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (s1) рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдлрд┐рд░, рдЖрдк рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ `rator\00\00\00 XOR s1` рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИред рдпрд╣ `E(m2 XOR s1 XOR 0)` рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬреЛ s32 рд╣реИред\
рдЕрдм, рдЖрдк s32 рдХреЛ рдкреВрд░реНрдг рдирд╛рдо **Administrator** рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Summary

1. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо **Administ** (m1) рдХрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬреЛ s1 рд╣реИ
2. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо **rator\x00\x00\x00 XOR s1 XOR 0** рдХрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬреЛ s32 рд╣реИ**.**
3. рдХреБрдХреА рдХреЛ s32 рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **Administrator** рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп рдХреБрдХреА рд╣реЛрдЧреАред

# Attack Controlling IV

рдпрджрд┐ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП IV рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рд╣рдорд▓рд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред\
рдпрджрд┐ рдХреБрдХреА рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реИ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "**administrator**" рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ "**Administrator**" рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ рдЗрд╕рдХреА рдХреБрдХреА рдорд┐рд▓ рдЬрд╛рдПрдЧреАред\
рдЕрдм, рдпрджрд┐ рдЖрдк IV рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк IV рдХреЗ рдкрд╣рд▓реЗ рдмрд╛рдЗрдЯ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **IV\[0] XOR "A" == IV'\[0] XOR "a"** рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **Administrator** рдХреЗ рд▓рд┐рдП рдХреБрдХреА рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХреЗрдВред рдпрд╣ рдХреБрдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ **IV** рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **administrator** рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рд╣реЛрдЧреАред

## References

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://en.wikipedia.org/wiki/CBC-MAC](https://en.wikipedia.org/wiki/CBC-MAC)


{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
