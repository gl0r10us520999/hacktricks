# ASLR

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informazioni di Base

**Address Space Layout Randomization (ASLR)** √® una tecnica di sicurezza utilizzata nei sistemi operativi per **randomizzare gli indirizzi di memoria** utilizzati dai processi di sistema e delle applicazioni. In questo modo, rende significativamente pi√π difficile per un attaccante prevedere la posizione di processi e dati specifici, come lo stack, l'heap e le librerie, riducendo cos√¨ certi tipi di exploit, in particolare gli overflow di buffer.

### **Verifica dello Stato di ASLR**

Per **verificare** lo stato di ASLR su un sistema Linux, √® possibile leggere il valore dal file `/proc/sys/kernel/randomize_va_space`. Il valore memorizzato in questo file determina il tipo di ASLR applicato:

* **0**: Nessuna randomizzazione. Tutto √® statico.
* **1**: Randomizzazione conservativa. Le librerie condivise, lo stack, mmap(), la pagina VDSO sono randomizzati.
* **2**: Randomizzazione completa. Oltre agli elementi randomizzati dalla randomizzazione conservativa, la memoria gestita tramite `brk()` √® randomizzata.

√à possibile verificare lo stato di ASLR con il seguente comando:
```bash
bashCopy codecat /proc/sys/kernel/randomize_va_space
```
### **Disabilitazione di ASLR**

Per **disabilitare** ASLR, imposti il valore di `/proc/sys/kernel/randomize_va_space` a **0**. Disabilitare ASLR di solito non √® consigliato al di fuori di scenari di test o debug. Ecco come puoi disabilitarlo:
```bash
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
```
Puoi anche disabilitare ASLR per un'esecuzione con:
```bash
setarch `arch` -R ./bin args
setarch `uname -m` -R ./bin args
```
### **Abilitazione di ASLR**

Per **abilitare** ASLR, √® possibile scrivere un valore di **2** nel file `/proc/sys/kernel/randomize_va_space`. Di solito √® necessario disporre dei privilegi di root. √à possibile abilitare la piena randomizzazione con il seguente comando:
```bash
echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
```
### **Persistenza attraverso i riavvii**

Le modifiche apportate con i comandi `echo` sono temporanee e verranno ripristinate al riavvio. Per rendere la modifica persistente, √® necessario modificare il file `/etc/sysctl.conf` e aggiungere o modificare la seguente riga:
```tsconfig
kernel.randomize_va_space=2 # Enable ASLR
# or
kernel.randomize_va_space=0 # Disable ASLR
```
Dopo aver modificato `/etc/sysctl.conf`, applica le modifiche con:
```bash
sudo sysctl -p
```
Questo assicurer√† che le impostazioni del ASLR rimangano attive anche dopo i riavvii.

## **Bypassing 32bits ASLR**&#x20;

### Forzatura a 32 bit

PaX divide lo spazio degli indirizzi del processo in **3 gruppi**:

* **Codice e dati** (inizializzati e non inizializzati): `.text`, `.data`, e `.bss` ‚Äî> **16 bit** di entropia nella variabile `delta_exec`. Questa variabile viene inizializzata casualmente con ogni processo e aggiunta agli indirizzi iniziali.
* **Memoria** allocata da `mmap()` e **librerie condivise** ‚Äî> **16 bit**, chiamati `delta_mmap`.
* **Lo stack** ‚Äî> **24 bit**, indicato come `delta_stack`. Tuttavia, utilizza effettivamente **11 bit** (dal decimo al ventesimo byte incluso), allineati a **16 byte** ‚Äî> Ci√≤ porta a **524.288 possibili indirizzi reali dello stack**.

I dati precedenti sono per sistemi a 32 bit e la ridotta entropia finale rende possibile aggirare il ASLR riprovando l'esecuzione pi√π volte fino a quando l'exploit viene completato con successo.

#### Idee per la forzatura:

* Se l'exploit √® locale, puoi provare a forzare l'indirizzo di base di libc (utile per sistemi a 32 bit):
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
* Se si attacca un server remoto, potresti provare a **forzare l'indirizzo della funzione `usleep` della `libc`**, passando come argomento 10 (ad esempio). Se a un certo punto il **server impiega 10 secondi in pi√π per rispondere**, hai trovato l'indirizzo di questa funzione.

{% hint style="success" %}
Nei sistemi a 64 bit l'entropia √® molto pi√π alta e questo non √® possibile.
{% endhint %}

### Ret2ret

Prova a bypassare ASLR abusando degli indirizzi all'interno dello stack:

{% content-ref url="../stack-overflow/ret2ret.md" %}
[ret2ret.md](../stack-overflow/ret2ret.md)
{% endcontent-ref %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
