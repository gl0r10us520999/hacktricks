# Ret2ret & Reo2pop

{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** 上关注我们。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}

## Ret2ret

该技术的主要目标是尝试 **通过滥用栈中现有指针来绕过 ASLR**。

基本上，栈溢出通常是由字符串引起的，**字符串在内存中以空字节结尾**。这允许尝试减少由栈中已存在的指针指向的位置。因此，如果栈包含 `0xbfffffdd`，则此溢出可以将其转换为 `0xbfffff00`（注意最后一个零字节）。

如果该地址指向我们在栈中的 shellcode，则可以通过 **向 `ret` 指令添加地址** 使流程到达该地址，直到到达该地址。

因此，攻击将如下所示：

* NOP 滑梯
* Shellcode
* 从 EIP 开始用 **`ret` 的地址覆盖栈**（RET 滑梯）
* 由字符串添加的 0x00 修改栈中的一个地址，使其指向 NOP 滑梯

通过 [**此链接**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2ret.c) 您可以看到一个易受攻击的二进制示例， [**在这个链接中**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2retexploit.c) 是利用该漏洞的示例。

## Ret2pop

如果您可以找到一个 **完美的指针而不想修改**（在 `ret2ret` 中我们将最后最低字节更改为 `0x00`），您可以执行相同的 `ret2ret` 攻击，但 **RET 滑梯的长度必须减少 1**（因此最后的 `0x00` 会覆盖完美指针之前的数据），并且 **RET 滑梯的最后** 地址必须指向 **`pop <reg>; ret`**。\
这样，**完美指针之前的数据将从栈中删除**（这是受 `0x00` 影响的数据），并且 **最后的 `ret` 将指向栈中的完美地址**，没有任何更改。

通过 [**此链接**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2pop.c) 您可以看到一个易受攻击的二进制示例， [**在这个链接中**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2popexploit.c) 是利用该漏洞的示例。

## References

* [https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md)

{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** 上关注我们。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
