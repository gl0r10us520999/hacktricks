# AW2Exec - GOT/PLT

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## **Informa√ß√µes B√°sicas**

### **GOT: Tabela de Deslocamento Global**

A **Tabela de Deslocamento Global (GOT)** √© um mecanismo usado em bin√°rios vinculados dinamicamente para gerenciar os **endere√ßos de fun√ß√µes externas**. Como esses **endere√ßos n√£o s√£o conhecidos at√© o tempo de execu√ß√£o** (devido ao v√≠nculo din√¢mico), a GOT fornece uma maneira de **atualizar dinamicamente os endere√ßos desses s√≠mbolos externos** uma vez que s√£o resolvidos.

Cada entrada na GOT corresponde a um s√≠mbolo nas bibliotecas externas que o bin√°rio pode chamar. Quando uma **fun√ß√£o √© chamada pela primeira vez, seu endere√ßo real √© resolvido pelo vinculador din√¢mico e armazenado na GOT**. Chamadas subsequentes para a mesma fun√ß√£o usam o endere√ßo armazenado na GOT, evitando assim a sobrecarga de resolver o endere√ßo novamente.

### **PLT: Tabela de Liga√ß√£o de Procedimentos**

A **Tabela de Liga√ß√£o de Procedimentos (PLT)** trabalha em estreita colabora√ß√£o com a GOT e serve como um trampolim para lidar com chamadas a fun√ß√µes externas. Quando um bin√°rio **chama uma fun√ß√£o externa pela primeira vez, o controle √© passado para uma entrada na PLT associada a essa fun√ß√£o**. Esta entrada da PLT √© respons√°vel por invocar o vinculador din√¢mico para resolver o endere√ßo da fun√ß√£o, caso ainda n√£o tenha sido resolvido. Ap√≥s o endere√ßo ser resolvido, ele √© armazenado na GOT.

**Portanto,** as entradas da GOT s√£o usadas diretamente uma vez que o endere√ßo de uma fun√ß√£o ou vari√°vel externa √© resolvido. **As entradas da PLT s√£o usadas para facilitar a resolu√ß√£o inicial** desses endere√ßos via o vinculador din√¢mico.

## Obter Execu√ß√£o

### Verifique a GOT

Obtenha o endere√ßo da tabela GOT com: **`objdump -s -j .got ./exec`**

![](<../../../.gitbook/assets/image (619).png>)

Observe como ap√≥s **carregar** o **execut√°vel** no GEF voc√™ pode **ver** as **fun√ß√µes** que est√£o na **GOT**: `gef‚û§ x/20x 0xADDR_GOT`

![](<../../../.gitbook/assets/image (620) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (5).png>)

Usando o GEF voc√™ pode **iniciar** uma sess√£o de **debugging** e executar **`got`** para ver a tabela got:

![](<../../../.gitbook/assets/image (621).png>)

### GOT2Exec

Em um bin√°rio, a GOT tem os **endere√ßos para as fun√ß√µes ou** para a **se√ß√£o PLT** que ir√° carregar o endere√ßo da fun√ß√£o. O objetivo desta escrita arbitr√°ria √© **substituir uma entrada da GOT** de uma fun√ß√£o que ser√° executada mais tarde **com** o **endere√ßo** da PLT da **fun√ß√£o** **`system`** por exemplo.

Idealmente, voc√™ ir√° **substituir** a **GOT** de uma **fun√ß√£o** que est√° **prestes a ser chamada com par√¢metros controlados por voc√™** (assim voc√™ poder√° controlar os par√¢metros enviados para a fun√ß√£o system).

Se **`system`** **n√£o for usado** pelo script, a fun√ß√£o system **n√£o ter√°** uma entrada na PLT. Nesse cen√°rio, voc√™ precisar√° **vazar primeiro o endere√ßo** da fun√ß√£o `system` e ent√£o sobrescrever a GOT para apontar para esse endere√ßo.

Voc√™ pode ver os endere√ßos da PLT com **`objdump -j .plt -d ./vuln_binary`**

## **One Gadget**

{% content-ref url="../one-gadget.md" %}
[one-gadget.md](../one-gadget.md)
{% endcontent-ref %}

## **Prote√ß√µes**

A prote√ß√£o **Full RELRO** √© destinada a proteger contra esse tipo de t√©cnica resolvendo todos os endere√ßos das fun√ß√µes quando o bin√°rio √© iniciado e tornando a **tabela GOT somente leitura** ap√≥s isso:

{% content-ref url="../common-binary-protections-and-bypasses/relro.md" %}
[relro.md](../common-binary-protections-and-bypasses/relro.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite](https://ir0nstone.gitbook.io/notes/types/stack/got-overwrite/exploiting-a-got-overwrite)
* [https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook](https://ir0nstone.gitbook.io/notes/types/stack/one-gadgets-and-malloc-hook)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
